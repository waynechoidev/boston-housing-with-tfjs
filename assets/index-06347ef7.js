var M2e=Object.defineProperty;var L2e=(e,t,n)=>t in e?M2e(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;var P2e=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports);var js=(e,t,n)=>(L2e(e,typeof t!="symbol"?t+"":t,n),n);var d9t=P2e((_9t,AW)=>{function B2e(e,t){for(var n=0;n<t.length;n++){const r=t[n];if(typeof r!="string"&&!Array.isArray(r)){for(const i in r)if(i!=="default"&&!(i in e)){const s=Object.getOwnPropertyDescriptor(r,i);s&&Object.defineProperty(e,i,s.get?s:{enumerable:!0,get:()=>r[i]})}}}return Object.freeze(Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}))}(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const s of i)if(s.type==="childList")for(const o of s.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function n(i){const s={};return i.integrity&&(s.integrity=i.integrity),i.referrerPolicy&&(s.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?s.credentials="include":i.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(i){if(i.ep)return;i.ep=!0;const s=n(i);fetch(i.href,s)}})();var Je=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function k2(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function Qp(e){if(e.__esModule)return e;var t=e.default;if(typeof t=="function"){var n=function r(){return this instanceof r?Reflect.construct(t,arguments,this.constructor):t.apply(this,arguments)};n.prototype=t.prototype}else n={};return Object.defineProperty(n,"__esModule",{value:!0}),Object.keys(e).forEach(function(r){var i=Object.getOwnPropertyDescriptor(e,r);Object.defineProperty(n,r,i.get?i:{enumerable:!0,get:function(){return e[r]}})}),n}var fee={exports:{}};/* @license
Papa Parse
v5.4.1
https://github.com/mholt/PapaParse
License: MIT
*/(function(e,t){(function(n,r){e.exports=r()})(Je,function n(){var r=typeof self<"u"?self:typeof window<"u"?window:r!==void 0?r:{},i=!r.document&&!!r.postMessage,s=r.IS_PAPA_WORKER||!1,o={},a=0,u={parse:function(S,k){var E=(k=k||{}).dynamicTyping||!1;if($(E)&&(k.dynamicTypingFunction=E,E={}),k.dynamicTyping=E,k.transform=!!$(k.transform)&&k.transform,k.worker&&u.WORKERS_SUPPORTED){var _=function(){if(!u.WORKERS_SUPPORTED)return!1;var A=(I=r.URL||r.webkitURL||null,F=n.toString(),u.BLOB_URL||(u.BLOB_URL=I.createObjectURL(new Blob(["var global = (function() { if (typeof self !== 'undefined') { return self; } if (typeof window !== 'undefined') { return window; } if (typeof global !== 'undefined') { return global; } return {}; })(); global.IS_PAPA_WORKER=true; ","(",F,")();"],{type:"text/javascript"})))),T=new r.Worker(A),I,F;return T.onmessage=b,T.id=a++,o[T.id]=T}();return _.userStep=k.step,_.userChunk=k.chunk,_.userComplete=k.complete,_.userError=k.error,k.step=$(k.step),k.chunk=$(k.chunk),k.complete=$(k.complete),k.error=$(k.error),delete k.worker,void _.postMessage({input:S,config:k,workerId:_.id})}var D=null;return u.NODE_STREAM_INPUT,typeof S=="string"?(S=function(A){return A.charCodeAt(0)===65279?A.slice(1):A}(S),D=k.download?new f(k):new d(k)):S.readable===!0&&$(S.read)&&$(S.on)?D=new p(k):(r.File&&S instanceof File||S instanceof Object)&&(D=new h(k)),D.stream(S)},unparse:function(S,k){var E=!1,_=!0,D=",",A=`\r
`,T='"',I=T+T,F=!1,R=null,L=!1;(function(){if(typeof k=="object"){if(typeof k.delimiter!="string"||u.BAD_DELIMITERS.filter(function(G){return k.delimiter.indexOf(G)!==-1}).length||(D=k.delimiter),(typeof k.quotes=="boolean"||typeof k.quotes=="function"||Array.isArray(k.quotes))&&(E=k.quotes),typeof k.skipEmptyLines!="boolean"&&typeof k.skipEmptyLines!="string"||(F=k.skipEmptyLines),typeof k.newline=="string"&&(A=k.newline),typeof k.quoteChar=="string"&&(T=k.quoteChar),typeof k.header=="boolean"&&(_=k.header),Array.isArray(k.columns)){if(k.columns.length===0)throw new Error("Option columns is empty");R=k.columns}k.escapeChar!==void 0&&(I=k.escapeChar+T),(typeof k.escapeFormulae=="boolean"||k.escapeFormulae instanceof RegExp)&&(L=k.escapeFormulae instanceof RegExp?k.escapeFormulae:/^[=+\-@\t\r].*$/)}})();var P=new RegExp(m(T),"g");if(typeof S=="string"&&(S=JSON.parse(S)),Array.isArray(S)){if(!S.length||Array.isArray(S[0]))return q(null,S,F);if(typeof S[0]=="object")return q(R||Object.keys(S[0]),S,F)}else if(typeof S=="object")return typeof S.data=="string"&&(S.data=JSON.parse(S.data)),Array.isArray(S.data)&&(S.fields||(S.fields=S.meta&&S.meta.fields||R),S.fields||(S.fields=Array.isArray(S.data[0])?S.fields:typeof S.data[0]=="object"?Object.keys(S.data[0]):[]),Array.isArray(S.data[0])||typeof S.data[0]=="object"||(S.data=[S.data])),q(S.fields||[],S.data||[],F);throw new Error("Unable to serialize unrecognized input");function q(G,J,Q){var ee="";typeof G=="string"&&(G=JSON.parse(G)),typeof J=="string"&&(J=JSON.parse(J));var ue=Array.isArray(G)&&0<G.length,ge=!Array.isArray(J[0]);if(ue&&_){for(var xe=0;xe<G.length;xe++)0<xe&&(ee+=D),ee+=X(G[xe],xe);0<J.length&&(ee+=A)}for(var B=0;B<J.length;B++){var H=ue?G.length:J[B].length,Y=!1,M=ue?Object.keys(J[B]).length===0:J[B].length===0;if(Q&&!ue&&(Y=Q==="greedy"?J[B].join("").trim()==="":J[B].length===1&&J[B][0].length===0),Q==="greedy"&&ue){for(var he=[],ae=0;ae<H;ae++){var me=ge?G[ae]:ae;he.push(J[B][me])}Y=he.join("").trim()===""}if(!Y){for(var de=0;de<H;de++){0<de&&!M&&(ee+=D);var Oe=ue&&ge?G[de]:de;ee+=X(J[B][Oe],de)}B<J.length-1&&(!Q||0<H&&!M)&&(ee+=A)}}return ee}function X(G,J){if(G==null)return"";if(G.constructor===Date)return JSON.stringify(G).slice(1,25);var Q=!1;L&&typeof G=="string"&&L.test(G)&&(G="'"+G,Q=!0);var ee=G.toString().replace(P,I);return(Q=Q||E===!0||typeof E=="function"&&E(G,J)||Array.isArray(E)&&E[J]||function(ue,ge){for(var xe=0;xe<ge.length;xe++)if(-1<ue.indexOf(ge[xe]))return!0;return!1}(ee,u.BAD_DELIMITERS)||-1<ee.indexOf(D)||ee.charAt(0)===" "||ee.charAt(ee.length-1)===" ")?T+ee+T:ee}}};if(u.RECORD_SEP=String.fromCharCode(30),u.UNIT_SEP=String.fromCharCode(31),u.BYTE_ORDER_MARK="\uFEFF",u.BAD_DELIMITERS=["\r",`
`,'"',u.BYTE_ORDER_MARK],u.WORKERS_SUPPORTED=!i&&!!r.Worker,u.NODE_STREAM_INPUT=1,u.LocalChunkSize=10485760,u.RemoteChunkSize=5242880,u.DefaultDelimiter=",",u.Parser=y,u.ParserHandle=g,u.NetworkStreamer=f,u.FileStreamer=h,u.StringStreamer=d,u.ReadableStreamStreamer=p,r.jQuery){var l=r.jQuery;l.fn.parse=function(S){var k=S.config||{},E=[];return this.each(function(A){if(!(l(this).prop("tagName").toUpperCase()==="INPUT"&&l(this).attr("type").toLowerCase()==="file"&&r.FileReader)||!this.files||this.files.length===0)return!0;for(var T=0;T<this.files.length;T++)E.push({file:this.files[T],inputElem:this,instanceConfig:l.extend({},k)})}),_(),this;function _(){if(E.length!==0){var A,T,I,F,R=E[0];if($(S.before)){var L=S.before(R.file,R.inputElem);if(typeof L=="object"){if(L.action==="abort")return A="AbortError",T=R.file,I=R.inputElem,F=L.reason,void($(S.error)&&S.error({name:A},T,I,F));if(L.action==="skip")return void D();typeof L.config=="object"&&(R.instanceConfig=l.extend(R.instanceConfig,L.config))}else if(L==="skip")return void D()}var P=R.instanceConfig.complete;R.instanceConfig.complete=function(q){$(P)&&P(q,R.file,R.inputElem),D()},u.parse(R.file,R.instanceConfig)}else $(S.complete)&&S.complete()}function D(){E.splice(0,1),_()}}}function c(S){this._handle=null,this._finished=!1,this._completed=!1,this._halted=!1,this._input=null,this._baseIndex=0,this._partialLine="",this._rowCount=0,this._start=0,this._nextChunk=null,this.isFirstChunk=!0,this._completeResults={data:[],errors:[],meta:{}},(function(k){var E=w(k);E.chunkSize=parseInt(E.chunkSize),k.step||k.chunk||(E.chunkSize=null),this._handle=new g(E),(this._handle.streamer=this)._config=E}).call(this,S),this.parseChunk=function(k,E){if(this.isFirstChunk&&$(this._config.beforeFirstChunk)){var _=this._config.beforeFirstChunk(k);_!==void 0&&(k=_)}this.isFirstChunk=!1,this._halted=!1;var D=this._partialLine+k;this._partialLine="";var A=this._handle.parse(D,this._baseIndex,!this._finished);if(!this._handle.paused()&&!this._handle.aborted()){var T=A.meta.cursor;this._finished||(this._partialLine=D.substring(T-this._baseIndex),this._baseIndex=T),A&&A.data&&(this._rowCount+=A.data.length);var I=this._finished||this._config.preview&&this._rowCount>=this._config.preview;if(s)r.postMessage({results:A,workerId:u.WORKER_ID,finished:I});else if($(this._config.chunk)&&!E){if(this._config.chunk(A,this._handle),this._handle.paused()||this._handle.aborted())return void(this._halted=!0);A=void 0,this._completeResults=void 0}return this._config.step||this._config.chunk||(this._completeResults.data=this._completeResults.data.concat(A.data),this._completeResults.errors=this._completeResults.errors.concat(A.errors),this._completeResults.meta=A.meta),this._completed||!I||!$(this._config.complete)||A&&A.meta.aborted||(this._config.complete(this._completeResults,this._input),this._completed=!0),I||A&&A.meta.paused||this._nextChunk(),A}this._halted=!0},this._sendError=function(k){$(this._config.error)?this._config.error(k):s&&this._config.error&&r.postMessage({workerId:u.WORKER_ID,error:k,finished:!1})}}function f(S){var k;(S=S||{}).chunkSize||(S.chunkSize=u.RemoteChunkSize),c.call(this,S),this._nextChunk=i?function(){this._readChunk(),this._chunkLoaded()}:function(){this._readChunk()},this.stream=function(E){this._input=E,this._nextChunk()},this._readChunk=function(){if(this._finished)this._chunkLoaded();else{if(k=new XMLHttpRequest,this._config.withCredentials&&(k.withCredentials=this._config.withCredentials),i||(k.onload=C(this._chunkLoaded,this),k.onerror=C(this._chunkError,this)),k.open(this._config.downloadRequestBody?"POST":"GET",this._input,!i),this._config.downloadRequestHeaders){var E=this._config.downloadRequestHeaders;for(var _ in E)k.setRequestHeader(_,E[_])}if(this._config.chunkSize){var D=this._start+this._config.chunkSize-1;k.setRequestHeader("Range","bytes="+this._start+"-"+D)}try{k.send(this._config.downloadRequestBody)}catch(A){this._chunkError(A.message)}i&&k.status===0&&this._chunkError()}},this._chunkLoaded=function(){k.readyState===4&&(k.status<200||400<=k.status?this._chunkError():(this._start+=this._config.chunkSize?this._config.chunkSize:k.responseText.length,this._finished=!this._config.chunkSize||this._start>=function(E){var _=E.getResponseHeader("Content-Range");return _===null?-1:parseInt(_.substring(_.lastIndexOf("/")+1))}(k),this.parseChunk(k.responseText)))},this._chunkError=function(E){var _=k.statusText||E;this._sendError(new Error(_))}}function h(S){var k,E;(S=S||{}).chunkSize||(S.chunkSize=u.LocalChunkSize),c.call(this,S);var _=typeof FileReader<"u";this.stream=function(D){this._input=D,E=D.slice||D.webkitSlice||D.mozSlice,_?((k=new FileReader).onload=C(this._chunkLoaded,this),k.onerror=C(this._chunkError,this)):k=new FileReaderSync,this._nextChunk()},this._nextChunk=function(){this._finished||this._config.preview&&!(this._rowCount<this._config.preview)||this._readChunk()},this._readChunk=function(){var D=this._input;if(this._config.chunkSize){var A=Math.min(this._start+this._config.chunkSize,this._input.size);D=E.call(D,this._start,A)}var T=k.readAsText(D,this._config.encoding);_||this._chunkLoaded({target:{result:T}})},this._chunkLoaded=function(D){this._start+=this._config.chunkSize,this._finished=!this._config.chunkSize||this._start>=this._input.size,this.parseChunk(D.target.result)},this._chunkError=function(){this._sendError(k.error)}}function d(S){var k;c.call(this,S=S||{}),this.stream=function(E){return k=E,this._nextChunk()},this._nextChunk=function(){if(!this._finished){var E,_=this._config.chunkSize;return _?(E=k.substring(0,_),k=k.substring(_)):(E=k,k=""),this._finished=!k,this.parseChunk(E)}}}function p(S){c.call(this,S=S||{});var k=[],E=!0,_=!1;this.pause=function(){c.prototype.pause.apply(this,arguments),this._input.pause()},this.resume=function(){c.prototype.resume.apply(this,arguments),this._input.resume()},this.stream=function(D){this._input=D,this._input.on("data",this._streamData),this._input.on("end",this._streamEnd),this._input.on("error",this._streamError)},this._checkIsFinished=function(){_&&k.length===1&&(this._finished=!0)},this._nextChunk=function(){this._checkIsFinished(),k.length?this.parseChunk(k.shift()):E=!0},this._streamData=C(function(D){try{k.push(typeof D=="string"?D:D.toString(this._config.encoding)),E&&(E=!1,this._checkIsFinished(),this.parseChunk(k.shift()))}catch(A){this._streamError(A)}},this),this._streamError=C(function(D){this._streamCleanUp(),this._sendError(D)},this),this._streamEnd=C(function(){this._streamCleanUp(),_=!0,this._streamData("")},this),this._streamCleanUp=C(function(){this._input.removeListener("data",this._streamData),this._input.removeListener("end",this._streamEnd),this._input.removeListener("error",this._streamError)},this)}function g(S){var k,E,_,D=Math.pow(2,53),A=-D,T=/^\s*-?(\d+\.?|\.\d+|\d+\.\d+)([eE][-+]?\d+)?\s*$/,I=/^((\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d\.\d+([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z)))$/,F=this,R=0,L=0,P=!1,q=!1,X=[],G={data:[],errors:[],meta:{}};if($(S.step)){var J=S.step;S.step=function(B){if(G=B,ue())ee();else{if(ee(),G.data.length===0)return;R+=B.data.length,S.preview&&R>S.preview?E.abort():(G.data=G.data[0],J(G,F))}}}function Q(B){return S.skipEmptyLines==="greedy"?B.join("").trim()==="":B.length===1&&B[0].length===0}function ee(){return G&&_&&(xe("Delimiter","UndetectableDelimiter","Unable to auto-detect delimiting character; defaulted to '"+u.DefaultDelimiter+"'"),_=!1),S.skipEmptyLines&&(G.data=G.data.filter(function(B){return!Q(B)})),ue()&&function(){if(!G)return;function B(Y,M){$(S.transformHeader)&&(Y=S.transformHeader(Y,M)),X.push(Y)}if(Array.isArray(G.data[0])){for(var H=0;ue()&&H<G.data.length;H++)G.data[H].forEach(B);G.data.splice(0,1)}else G.data.forEach(B)}(),function(){if(!G||!S.header&&!S.dynamicTyping&&!S.transform)return G;function B(Y,M){var he,ae=S.header?{}:[];for(he=0;he<Y.length;he++){var me=he,de=Y[he];S.header&&(me=he>=X.length?"__parsed_extra":X[he]),S.transform&&(de=S.transform(de,me)),de=ge(me,de),me==="__parsed_extra"?(ae[me]=ae[me]||[],ae[me].push(de)):ae[me]=de}return S.header&&(he>X.length?xe("FieldMismatch","TooManyFields","Too many fields: expected "+X.length+" fields but parsed "+he,L+M):he<X.length&&xe("FieldMismatch","TooFewFields","Too few fields: expected "+X.length+" fields but parsed "+he,L+M)),ae}var H=1;return!G.data.length||Array.isArray(G.data[0])?(G.data=G.data.map(B),H=G.data.length):G.data=B(G.data,0),S.header&&G.meta&&(G.meta.fields=X),L+=H,G}()}function ue(){return S.header&&X.length===0}function ge(B,H){return Y=B,S.dynamicTypingFunction&&S.dynamicTyping[Y]===void 0&&(S.dynamicTyping[Y]=S.dynamicTypingFunction(Y)),(S.dynamicTyping[Y]||S.dynamicTyping)===!0?H==="true"||H==="TRUE"||H!=="false"&&H!=="FALSE"&&(function(M){if(T.test(M)){var he=parseFloat(M);if(A<he&&he<D)return!0}return!1}(H)?parseFloat(H):I.test(H)?new Date(H):H===""?null:H):H;var Y}function xe(B,H,Y,M){var he={type:B,code:H,message:Y};M!==void 0&&(he.row=M),G.errors.push(he)}this.parse=function(B,H,Y){var M=S.quoteChar||'"';if(S.newline||(S.newline=function(me,de){me=me.substring(0,1048576);var Oe=new RegExp(m(de)+"([^]*?)"+m(de),"gm"),Ye=(me=me.replace(Oe,"")).split("\r"),Wn=me.split(`
`),Ht=1<Wn.length&&Wn[0].length<Ye[0].length;if(Ye.length===1||Ht)return`
`;for(var Ln=0,pt=0;pt<Ye.length;pt++)Ye[pt][0]===`
`&&Ln++;return Ln>=Ye.length/2?`\r
`:"\r"}(B,M)),_=!1,S.delimiter)$(S.delimiter)&&(S.delimiter=S.delimiter(B),G.meta.delimiter=S.delimiter);else{var he=function(me,de,Oe,Ye,Wn){var Ht,Ln,pt,qt;Wn=Wn||[",","	","|",";",u.RECORD_SEP,u.UNIT_SEP];for(var tr=0;tr<Wn.length;tr++){var gt=Wn[tr],Fi=0,xr=0,ei=0;pt=void 0;for(var os=new y({comments:Ye,delimiter:gt,newline:de,preview:10}).parse(me),ho=0;ho<os.data.length;ho++)if(Oe&&Q(os.data[ho]))ei++;else{var po=os.data[ho].length;xr+=po,pt!==void 0?0<po&&(Fi+=Math.abs(po-pt),pt=po):pt=po}0<os.data.length&&(xr/=os.data.length-ei),(Ln===void 0||Fi<=Ln)&&(qt===void 0||qt<xr)&&1.99<xr&&(Ln=Fi,Ht=gt,qt=xr)}return{successful:!!(S.delimiter=Ht),bestDelimiter:Ht}}(B,S.newline,S.skipEmptyLines,S.comments,S.delimitersToGuess);he.successful?S.delimiter=he.bestDelimiter:(_=!0,S.delimiter=u.DefaultDelimiter),G.meta.delimiter=S.delimiter}var ae=w(S);return S.preview&&S.header&&ae.preview++,k=B,E=new y(ae),G=E.parse(k,H,Y),ee(),P?{meta:{paused:!0}}:G||{meta:{paused:!1}}},this.paused=function(){return P},this.pause=function(){P=!0,E.abort(),k=$(S.chunk)?"":k.substring(E.getCharIndex())},this.resume=function(){F.streamer._halted?(P=!1,F.streamer.parseChunk(k,!0)):setTimeout(F.resume,3)},this.aborted=function(){return q},this.abort=function(){q=!0,E.abort(),G.meta.aborted=!0,$(S.complete)&&S.complete(G),k=""}}function m(S){return S.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function y(S){var k,E=(S=S||{}).delimiter,_=S.newline,D=S.comments,A=S.step,T=S.preview,I=S.fastMode,F=k=S.quoteChar===void 0||S.quoteChar===null?'"':S.quoteChar;if(S.escapeChar!==void 0&&(F=S.escapeChar),(typeof E!="string"||-1<u.BAD_DELIMITERS.indexOf(E))&&(E=","),D===E)throw new Error("Comment character same as delimiter");D===!0?D="#":(typeof D!="string"||-1<u.BAD_DELIMITERS.indexOf(D))&&(D=!1),_!==`
`&&_!=="\r"&&_!==`\r
`&&(_=`
`);var R=0,L=!1;this.parse=function(P,q,X){if(typeof P!="string")throw new Error("Input must be a string");var G=P.length,J=E.length,Q=_.length,ee=D.length,ue=$(A),ge=[],xe=[],B=[],H=R=0;if(!P)return as();if(S.header&&!q){var Y=P.split(_)[0].split(E),M=[],he={},ae=!1;for(var me in Y){var de=Y[me];$(S.transformHeader)&&(de=S.transformHeader(de,me));var Oe=de,Ye=he[de]||0;for(0<Ye&&(ae=!0,Oe=de+"_"+Ye),he[de]=Ye+1;M.includes(Oe);)Oe=Oe+"_"+Ye;M.push(Oe)}if(ae){var Wn=P.split(_);Wn[0]=M.join(E),P=Wn.join(_)}}if(I||I!==!1&&P.indexOf(k)===-1){for(var Ht=P.split(_),Ln=0;Ln<Ht.length;Ln++){if(B=Ht[Ln],R+=B.length,Ln!==Ht.length-1)R+=_.length;else if(X)return as();if(!D||B.substring(0,ee)!==D){if(ue){if(ge=[],ei(B.split(E)),vl(),L)return as()}else ei(B.split(E));if(T&&T<=Ln)return ge=ge.slice(0,T),as(!0)}}return as()}for(var pt=P.indexOf(E,R),qt=P.indexOf(_,R),tr=new RegExp(m(F)+m(k),"g"),gt=P.indexOf(k,R);;)if(P[R]!==k)if(D&&B.length===0&&P.substring(R,R+ee)===D){if(qt===-1)return as();R=qt+Q,qt=P.indexOf(_,R),pt=P.indexOf(E,R)}else if(pt!==-1&&(pt<qt||qt===-1))B.push(P.substring(R,pt)),R=pt+J,pt=P.indexOf(E,R);else{if(qt===-1)break;if(B.push(P.substring(R,qt)),po(qt+Q),ue&&(vl(),L))return as();if(T&&ge.length>=T)return as(!0)}else for(gt=R,R++;;){if((gt=P.indexOf(k,gt+1))===-1)return X||xe.push({type:"Quotes",code:"MissingQuotes",message:"Quoted field unterminated",row:ge.length,index:R}),ho();if(gt===G-1)return ho(P.substring(R,gt).replace(tr,k));if(k!==F||P[gt+1]!==F){if(k===F||gt===0||P[gt-1]!==F){pt!==-1&&pt<gt+1&&(pt=P.indexOf(E,gt+1)),qt!==-1&&qt<gt+1&&(qt=P.indexOf(_,gt+1));var Fi=os(qt===-1?pt:Math.min(pt,qt));if(P.substr(gt+1+Fi,J)===E){B.push(P.substring(R,gt).replace(tr,k)),P[R=gt+1+Fi+J]!==k&&(gt=P.indexOf(k,R)),pt=P.indexOf(E,R),qt=P.indexOf(_,R);break}var xr=os(qt);if(P.substring(gt+1+xr,gt+1+xr+Q)===_){if(B.push(P.substring(R,gt).replace(tr,k)),po(gt+1+xr+Q),pt=P.indexOf(E,R),gt=P.indexOf(k,R),ue&&(vl(),L))return as();if(T&&ge.length>=T)return as(!0);break}xe.push({type:"Quotes",code:"InvalidQuotes",message:"Trailing quote on quoted field is malformed",row:ge.length,index:R}),gt++}}else gt++}return ho();function ei(us){ge.push(us),H=R}function os(us){var CC=0;if(us!==-1){var ZF=P.substring(gt+1,us);ZF&&ZF.trim()===""&&(CC=ZF.length)}return CC}function ho(us){return X||(us===void 0&&(us=P.substring(R)),B.push(us),R=G,ei(B),ue&&vl()),as()}function po(us){R=us,ei(B),B=[],qt=P.indexOf(_,R)}function as(us){return{data:ge,errors:xe,meta:{delimiter:E,linebreak:_,aborted:L,truncated:!!us,cursor:H+(q||0)}}}function vl(){A(as()),ge=[],xe=[]}},this.abort=function(){L=!0},this.getCharIndex=function(){return R}}function b(S){var k=S.data,E=o[k.workerId],_=!1;if(k.error)E.userError(k.error,k.file);else if(k.results&&k.results.data){var D={abort:function(){_=!0,v(k.workerId,{data:[],errors:[],meta:{aborted:!0}})},pause:x,resume:x};if($(E.userStep)){for(var A=0;A<k.results.data.length&&(E.userStep({data:k.results.data[A],errors:k.results.errors,meta:k.results.meta},D),!_);A++);delete k.results}else $(E.userChunk)&&(E.userChunk(k.results,D,k.file),delete k.results)}k.finished&&!_&&v(k.workerId,k.results)}function v(S,k){var E=o[S];$(E.userComplete)&&E.userComplete(k),E.terminate(),delete o[S]}function x(){throw new Error("Not implemented.")}function w(S){if(typeof S!="object"||S===null)return S;var k=Array.isArray(S)?[]:{};for(var E in S)k[E]=w(S[E]);return k}function C(S,k){return function(){S.apply(k,arguments)}}function $(S){return typeof S=="function"}return s&&(r.onmessage=function(S){var k=S.data;if(u.WORKER_ID===void 0&&k&&(u.WORKER_ID=k.workerId),typeof k.input=="string")r.postMessage({workerId:u.WORKER_ID,results:u.parse(k.input,k.config),finished:!0});else if(r.File&&k.input instanceof File||k.input instanceof Object){var E=u.parse(k.input,k.config);E&&r.postMessage({workerId:u.WORKER_ID,results:E,finished:!0})}}),(f.prototype=Object.create(c.prototype)).constructor=f,(h.prototype=Object.create(c.prototype)).constructor=h,(d.prototype=Object.create(d.prototype)).constructor=d,(p.prototype=Object.create(c.prototype)).constructor=p,u})})(fee);var z2e=fee.exports;const U2e="https://storage.googleapis.com/tfjs-examples/multivariate-linear-regression/data/",j2e="train-data.csv",W2e="train-target.csv",V2e="test-data.csv",G2e="test-target.csv";var nu=(e=>(e[e.LinearRegressionModel=1]="LinearRegressionModel",e[e.MultiLayerPerceptronRegressionModel1Hidden=2]="MultiLayerPerceptronRegressionModel1Hidden",e[e.MultiLayerPerceptronRegressionModel2Hidden=3]="MultiLayerPerceptronRegressionModel2Hidden",e[e.multiLayerPerceptronRegressionModel1HiddenNoSigmoid=4]="multiLayerPerceptronRegressionModel1HiddenNoSigmoid",e))(nu||{});class H2e{constructor(){js(this,"_trainFeatures");js(this,"_trainTarget");js(this,"_testFeatures");js(this,"_testTarget")}async loadData(){const t=document.getElementById("load-process"),n=document.getElementById("load-button");t||console.error("There is no element to show process"),t.innerHTML="It is loading now.",n.disabled=!0,[this._trainFeatures,this._trainTarget,this._testFeatures,this._testTarget]=await Promise.all([this.loadCsv(j2e),this.loadCsv(W2e),this.loadCsv(V2e),this.loadCsv(G2e)]),this.shuffle(this._trainFeatures,this._trainTarget),this.shuffle(this._testFeatures,this._testTarget),this._testFeatures||this._trainTarget||this._testFeatures||this._testTarget?t.innerHTML="It is done!":n.disabled=!1}get dataset(){return{trainFeatures:this._trainFeatures??[],trainTarget:this._trainTarget??[],testFeatures:this._testFeatures??[],testTarget:this._testTarget??[]}}async loadCsv(t){return new Promise(n=>{const r=`${U2e}${t}`;z2e.parse(r,{download:!0,header:!0,complete:i=>{n(this.parseCsv(i.data))}})})}async parseCsv(t){return new Promise(n=>{const r=t.map(i=>Object.values(i).map(s=>parseFloat(s)));n(r)})}async shuffle(t,n){let r=t.length;for(;r--;){const i=Math.random()*r|0,s=t[r];t[r]=t[i],t[i]=s;const o=n[r];n[r]=n[i],n[i]=o}}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const q2e=1e-7,X2e=1e-4;class KP{constructor(t,n){this.backend=t,this.dataMover=n,this.data=new WeakMap,this.dataIdsCount=0}get(t){return this.data.has(t)||this.dataMover.moveData(this.backend,t),this.data.get(t)}set(t,n){this.dataIdsCount++,this.data.set(t,n)}has(t){return this.data.has(t)}delete(t){return this.dataIdsCount--,this.data.delete(t)}numDataIds(){return this.dataIdsCount}}class AA{refCount(t){return ls("refCount")}incRef(t){return ls("incRef")}timerAvailable(){return!0}time(t){return ls("time")}read(t){return ls("read")}readSync(t){return ls("readSync")}readToGPU(t,n){return ls("readToGPU")}numDataIds(){return ls("numDataIds")}disposeData(t,n){return ls("disposeData")}write(t,n,r){return ls("write")}move(t,n,r,i,s){return ls("move")}createTensorFromGPUData(t,n,r){return ls("createTensorFromGPUData")}memory(){return ls("memory")}floatPrecision(){return ls("floatPrecision")}epsilon(){return this.floatPrecision()===32?q2e:X2e}dispose(){return ls("dispose")}}function ls(e){throw new Error(`'${e}' not yet implemented or not found in the registry. This kernel may not be supported by the tfjs backend you have chosen`)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ZP(e){let t=e.length,n=0;for(;t>0;)n=Math.random()*t|0,t--,Rl(e,t,n)}function Y2e(e,t){if(e.length!==t.length)throw new Error(`Array sizes must match to be shuffled together First array length was ${e.length}Second array length was ${t.length}`);let n=e.length,r=0;for(;n>0;)r=Math.random()*n|0,n--,Rl(e,n,r),Rl(t,n,r)}function Ff(e,t,n){return Math.max(e,Math.min(t,n))}function TA(e){return e%2===0?e:e+1}function Rl(e,t,n){const r=e[t];e[t]=e[n],e[n]=r}function hee(e){let t=0;for(let n=0;n<e.length;n++)t+=e[n];return t}function K2e(e,t){const n=Math.random();return t*n+(1-n)*e}function Z2e(e,t){let n=0;for(let r=0;r<e.length;r++){const i=Number(e[r])-Number(t[r]);n+=i*i}return n}function N(e,t){if(!e)throw new Error(typeof t=="string"?t:t())}function Fr(e,t,n=""){N(bt(e,t),()=>n+` Shapes ${e} and ${t} must match`)}function eg(e){N(e!=null,()=>"The input to the tensor constructor must be a non-null value.")}function te(e){if(e.length===0)return 1;let t=e[0];for(let n=1;n<e.length;n++)t*=e[n];return t}function J2e(e){return e.length===0}function dee(e,t){if(e===t)return!0;if(e==null||t==null||e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(e[n]!==null&&t[n]!==null&&e[n]!==t[n])return!1;return!0}function bt(e,t){if(e===t)return!0;if(e==null||t==null||e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}function dp(e){return e%1===0}function Q2e(e){if(Math.tanh!=null)return Math.tanh(e);if(e===1/0)return 1;if(e===-1/0)return-1;{const t=Math.exp(2*e);return(t-1)/(t+1)}}function Ak(e){const t=Math.ceil(Math.sqrt(e));return[t,Math.ceil(e/t)]}function ewe(e){const t=new Uint32Array(e);for(let n=0;n<e;++n)t[n]=n;return ZP(t),t}function Yd(e,t){return t<=e.length?e:e+" ".repeat(t-e.length)}function RR(e,t=i=>0,n,r){return new Promise((i,s)=>{let o=0;const a=()=>{if(e()){i();return}o++;const u=t(o);if(n!=null&&o>=n){s();return}r!=null?r(a,u):setTimeout(a,u)};a()})}function JP(e,t){let n=1,r=-1;for(let s=0;s<e.length;++s)if(e[s]>=0)n*=e[s];else if(e[s]===-1){if(r!==-1)throw Error(`Shapes can only have 1 implicit size. Found -1 at dim ${r} and dim ${s}`);r=s}else if(e[s]<0)throw Error(`Shapes can not be < 0. Found ${e[s]} at dim ${s}`);if(r===-1){if(t>0&&t!==n)throw Error(`Size(${t}) must match the product of shape ${e}`);return e}if(n===0)throw Error(`Cannot infer the missing size in [${e}] when there are 0 elements`);if(t%n!==0)throw Error(`The implicit shape can't be a fractional number. Got ${t} / ${n}`);const i=e.slice();return i[r]=t/n,i}function st(e,t){const n=t.length;return e=e==null?t.map((r,i)=>i):[].concat(e),N(e.every(r=>r>=-n&&r<n),()=>`All values in axis param must be in range [-${n}, ${n}) but got axis ${e}`),N(e.every(r=>dp(r)),()=>`All values in axis param must be integers but got axis ${e}`),e.map(r=>r<0?n+r:r)}function bc(e,t){const n=[],r=[],i=t!=null&&Array.isArray(t)&&t.length===0,s=t==null||i?null:st(t,e).sort();let o=0;for(let a=0;a<e.length;++a){if(s!=null){if(s[o]===a&&e[a]!==1)throw new Error(`Can't squeeze axis ${a} since its dim '${e[a]}' is not 1`);(s[o]==null||s[o]>a)&&e[a]===1&&(n.push(e[a]),r.push(a)),s[o]<=a&&o++}e[a]!==1&&(n.push(e[a]),r.push(a))}return{newShape:n,keptDims:r}}function hr(e,t){return En(e,t)}function En(e,t){let n=null;if(e==null||e==="float32")n=new Float32Array(t);else if(e==="int32")n=new Int32Array(t);else if(e==="bool")n=new Uint8Array(t);else if(e==="string")n=new Array(t);else throw new Error(`Unknown data type ${e}`);return n}function pee(e,t){for(let n=0;n<e.length;n++){const r=e[n];if(isNaN(r)||!isFinite(r))throw Error(`A tensor of type ${t} being uploaded contains ${r}.`)}}function gee(e){return e==="bool"||e==="complex64"||e==="float32"||e==="int32"||e==="string"}function QP(e,t){return!(t==="complex64"||t==="float32"&&e!=="complex64"||t==="int32"&&e!=="float32"&&e!=="complex64"||t==="bool"&&e==="bool")}function Rx(e){if(e==="float32"||e==="int32")return 4;if(e==="complex64")return 8;if(e==="bool")return 1;throw new Error(`Unknown dtype ${e}`)}function mee(e){if(e==null)return 0;let t=0;return e.forEach(n=>t+=n.length),t}function mu(e){return typeof e=="string"||e instanceof String}function yee(e){return typeof e=="boolean"}function Tk(e){return typeof e=="number"}function tg(e){return Array.isArray(e)?tg(e[0]):e instanceof Float32Array?"float32":e instanceof Int32Array||e instanceof Uint8Array||e instanceof Uint8ClampedArray?"int32":Tk(e)?"float32":mu(e)?"string":yee(e)?"bool":"float32"}function Of(e){return!!(e&&e.constructor&&e.call&&e.apply)}function Ik(e,t){for(let n=t;n<e;++n)if(e%n===0)return n;return e}function Me(e){const t=e.length;if(t<2)return[];const n=new Array(t-1);n[t-2]=e[t-1];for(let r=t-3;r>=0;--r)n[r]=n[r+1]*e[r+1];return n}function bee(e,t,n,r=!1){const i=new Array;if(t.length===1){const s=t[0]*(r?2:1);for(let o=0;o<s;o++)i[o]=n[e+o]}else{const s=t[0],o=t.slice(1),a=o.reduce((u,l)=>u*l)*(r?2:1);for(let u=0;u<s;u++)i[u]=bee(e+u*a,o,n,r)}return i}function Fo(e,t,n=!1){if(e.length===0)return t[0];const r=e.reduce((i,s)=>i*s)*(n?2:1);if(r===0)return[];if(r!==t.length)throw new Error(`[${e}] does not match the input size ${t.length}${n?" for a complex tensor":""}.`);return bee(0,e,t,n)}function xee(e,t){if(Array.isArray(e))return e;if(t==="float32")return e instanceof Float32Array?e:new Float32Array(e);if(t==="int32")return e instanceof Int32Array?e:new Int32Array(e);if(t==="bool"||t==="string")return Uint8Array.from(new Int32Array(e));throw new Error(`Unknown dtype ${t}`)}function IA(e,t){const n=Ir(e,t);for(let r=0;r<n.length;r++)n[r]=1;return n}function Ir(e,t){if(t==null||t==="float32"||t==="complex64")return new Float32Array(e);if(t==="int32")return new Int32Array(e);if(t==="bool")return new Uint8Array(e);throw new Error(`Unknown data type ${t}`)}function eB(e,t){const n=e.reduce((r,i)=>r*i,1);if(t==null||t==="float32")return Fo(e,new Float32Array(n));if(t==="int32")return Fo(e,new Int32Array(n));if(t==="bool")return Fo(e,new Uint8Array(n));throw new Error(`Unknown data type ${t}`)}function Ps(e){e.forEach(t=>{N(Number.isInteger(t)&&t>=0,()=>`Tensor must have a shape comprised of positive integers but got shape [${e}].`)})}function $a(e,t,n){if(t===0)return 0;if(t===1)return e[0];let r=e[e.length-1];for(let i=0;i<e.length-1;++i)r+=n[i]*e[i];return r}function ng(e,t,n){if(t===0)return[];if(t===1)return[e];const r=new Array(t);for(let i=0;i<r.length-1;++i)r[i]=Math.floor(e/n[i]),e-=r[i]*n[i];return r[r.length-1]=e,r}function DA(e){return e&&e.then&&typeof e.then=="function"}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const fV="tfjsflags";class vee{constructor(t){this.global=t,this.flags={},this.flagRegistry={},this.urlFlags={},this.getQueryParams=twe,this.populateURLFlags()}setPlatform(t,n){this.platform!=null&&(K().getBool("IS_TEST")||K().getBool("PROD")||console.warn(`Platform ${this.platformName} has already been set. Overwriting the platform with ${t}.`)),this.platformName=t,this.platform=n}registerFlag(t,n,r){if(this.flagRegistry[t]={evaluationFn:n,setHook:r},this.urlFlags[t]!=null){const i=this.urlFlags[t];K().getBool("IS_TEST")||K().getBool("PROD")||console.warn(`Setting feature override from URL ${t}: ${i}.`),this.set(t,i)}}async getAsync(t){return t in this.flags?this.flags[t]:(this.flags[t]=await this.evaluateFlag(t),this.flags[t])}get(t){if(t in this.flags)return this.flags[t];const n=this.evaluateFlag(t);if(DA(n))throw new Error(`Flag ${t} cannot be synchronously evaluated. Please use getAsync() instead.`);return this.flags[t]=n,this.flags[t]}getNumber(t){return this.get(t)}getBool(t){return this.get(t)}getString(t){return this.get(t)}getFlags(){return this.flags}get features(){return this.flags}set(t,n){if(this.flagRegistry[t]==null)throw new Error(`Cannot set flag ${t} as it has not been registered.`);this.flags[t]=n,this.flagRegistry[t].setHook!=null&&this.flagRegistry[t].setHook(n)}evaluateFlag(t){if(this.flagRegistry[t]==null)throw new Error(`Cannot evaluate flag '${t}': no evaluation function found.`);return this.flagRegistry[t].evaluationFn()}setFlags(t){this.flags=Object.assign({},t)}reset(){this.flags={},this.urlFlags={},this.populateURLFlags()}populateURLFlags(){if(typeof this.global>"u"||typeof this.global.location>"u"||typeof this.global.location.search>"u")return;const t=this.getQueryParams(this.global.location.search);fV in t&&t[fV].split(",").forEach(r=>{const[i,s]=r.split(":");this.urlFlags[i]=rwe(i,s)})}}function twe(e){const t={};return e.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,(n,...r)=>(nwe(t,r[0],r[1]),r.join("="))),t}function nwe(e,t,n){e[decodeURIComponent(t)]=decodeURIComponent(n||"")}function rwe(e,t){const n=t.toLowerCase();return n==="true"||n==="false"?n==="true":`${+n}`===n?+n:t}function K(){return tB}let tB=null;function iwe(e){tB=e}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */let JF;function wee(){if(JF==null){let e;if(typeof window<"u")e=window;else if(typeof global<"u")e=global;else if(typeof process<"u")e=process;else if(typeof self<"u")e=self;else throw new Error("Could not find a global object");JF=e}return JF}function swe(){const e=wee();return e._tfGlobals==null&&(e._tfGlobals=new Map),e._tfGlobals}function nB(e,t){const n=swe();if(n.has(e))return n.get(e);{const r=t();return n.set(e,r),n.get(e)}}const E2="Abs",H0="Acos",q0="Acosh",rg="Add",_2="AddN",NA="All",FA="Any",A2="ArgMax",T2="ArgMin",X0="Asin",Y0="Asinh",K0="Atan",Z0="Atanh",J0="Atan2",I2="AvgPool",OA="AvgPoolGrad",D2="AvgPool3D",RA="AvgPool3DGrad",N2="BatchMatMul",F2="BatchToSpaceND",MA="Bincount",O2="BitwiseAnd",$ee="BroadcastTo",LA="BroadcastArgs",Q0="Cast",e1="Ceil",t1="ClipByValue",PA="Complex",R2="ComplexAbs",M2="Concat",L2="Conv2D",BA="Conv2DBackpropFilter",P2="Conv2DBackpropInput",B2="Conv3D",zA="Conv3DBackpropFilterV2",UA="Conv3DBackpropInputV2",n1="Cos",r1="Cosh",jA="Cumprod",z2="Cumsum",WA="CropAndResize",VA="DenseBincount",GA="DepthToSpace",U2="DepthwiseConv2dNative",HA="DepthwiseConv2dNativeBackpropFilter",qA="DepthwiseConv2dNativeBackpropInput",XA="Diag",j2="Dilation2D",Dk="Dilation2DBackpropInput",Nk="Dilation2DBackpropFilter",YA="Draw",i1="RealDiv",KA="Einsum",s1="Elu",ZA="EluGrad",o1="Erf",W2="Equal",a1="Exp",V2="ExpandDims",u1="Expm1",JA="FFT",QA="Fill",eT="FlipLeftRight",l1="Floor",c1="FloorDiv",G2="FusedBatchNorm",H2="GatherV2",tT="GatherNd",q2="Greater",f1="GreaterEqual",h1="Identity",nT="IFFT",rT="Imag",d1="IsFinite",p1="IsInf",g1="IsNan",X2="LeakyRelu",Y2="Less",K2="LessEqual",iT="LinSpace",m1="Log",y1="Log1p",Z2="LogicalAnd",J2="LogicalNot",Q2="LogicalOr",owe="LogicalXor",Cee="LogSoftmax",awe="LowerBound",ew="LRN",sT="LRNGrad",uwe="MatrixBandPart",tw="Max",b1="Maximum",nw="MaxPool",oT="MaxPoolGrad",rw="MaxPool3D",aT="MaxPool3DGrad",uT="MaxPoolWithArgmax",iw="Mean",sw="Min",x1="Minimum",ow="MirrorPad",v1="Mod",lT="Multinomial",w1="Multiply",aw="Neg",uw="NotEqual",cT="NonMaxSuppressionV3",fT="NonMaxSuppressionV4",hT="NonMaxSuppressionV5",lw="OnesLike",cw="OneHot",fw="Pack",hw="PadV2",lwe="Pool",$1="Pow",dw="Prelu",pw="Prod",dT="RaggedGather",pT="RaggedRange",gT="RaggedTensorToTensor",mT="Range",yT="Real",C1="Reciprocal",S1="Relu",gw="Reshape",mw="ResizeNearestNeighbor",bT="ResizeNearestNeighborGrad",yw="ResizeBilinear",xT="ResizeBilinearGrad",k1="Relu6",bw="Reverse",E1="Round",_1="Rsqrt",vT="ScatterNd",wT="TensorScatterUpdate",$T="SearchSorted",xw="Select",A1="Selu",vw="Slice",T1="Sin",I1="Sinh",D1="Sign",N1="Sigmoid",F1="Softplus",O1="Sqrt",ww="Sum",$w="SpaceToBatchND",Cw="SplitV",Sw="Softmax",CT="SparseFillEmptyRows",ST="SparseReshape",kT="SparseSegmentMean",ET="SparseSegmentSum",_T="SparseToDense",R1="SquaredDifference",AT="Square",kw="StaticRegexReplace",TT="StridedSlice",IT="StringNGrams",DT="StringSplit",NT="StringToHashBucketFast",M1="Sub",L1="Tan",P1="Tanh",B1="Tile",FT="TopK",OT="Transform",Kd="Transpose",RT="Unique",Ew="Unpack",_w="UnsortedSegmentSum",cwe="UpperBound",Aw="ZerosLike",z1="Step",Fk="FromPixels",MT="RotateWithOffset",Mx="_FusedMatMul",Lx="FusedConv2D",Px="FusedDepthwiseConv2D";/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Hs(...e){K().getBool("IS_TEST")||K().getBool("PROD")||console.warn(...e)}function fwe(...e){K().getBool("IS_TEST")||K().getBool("PROD")||console.log(...e)}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Wm=nB("kernelRegistry",()=>new Map),Bx=nB("gradRegistry",()=>new Map);function zx(e,t){const n=rB(e,t);return Wm.get(n)}function MR(e){return Bx.get(e)}function Ok(e){const t=Wm.entries(),n=[];for(;;){const{done:r,value:i}=t.next();if(r)break;const[s,o]=i,[a]=s.split("_");a===e&&n.push(o)}return n}function LT(e){const{kernelName:t,backendName:n}=e,r=rB(t,n);Wm.has(r)&&Hs(`The kernel '${t}' for backend '${n}' is already registered`),Wm.set(r,e)}function See(e){const{kernelName:t}=e;Bx.has(t)&&K().getBool("DEBUG")&&Hs(`Overriding the gradient for '${t}'`),Bx.set(t,e)}function hwe(e,t){const n=rB(e,t);if(!Wm.has(n))throw new Error(`The kernel '${e}' for backend '${t}' is not registered`);Wm.delete(n)}function dwe(e){if(!Bx.has(e))throw new Error(`The gradient '${e}' for backend is not registered`);Bx.delete(e)}function pwe(e,t){Ok(e).forEach(r=>{const i=Object.assign({},r,{backendName:t});LT(i)})}function rB(e,t){return`${t}_${e}`}/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kee(e){return e instanceof Float32Array||e instanceof Int32Array||e instanceof Uint8Array||e instanceof Uint8ClampedArray}var Eee=on,wo=null;try{wo=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch{}function on(e,t,n){this.low=e|0,this.high=t|0,this.unsigned=!!n}on.prototype.__isLong__;Object.defineProperty(on.prototype,"__isLong__",{value:!0});function Bs(e){return(e&&e.__isLong__)===!0}on.isLong=Bs;var hV={},dV={};function ig(e,t){var n,r,i;return t?(e>>>=0,(i=0<=e&&e<256)&&(r=dV[e],r)?r:(n=an(e,(e|0)<0?-1:0,!0),i&&(dV[e]=n),n)):(e|=0,(i=-128<=e&&e<128)&&(r=hV[e],r)?r:(n=an(e,e<0?-1:0,!1),i&&(hV[e]=n),n))}on.fromInt=ig;function $o(e,t){if(isNaN(e))return t?Md:Co;if(t){if(e<0)return Md;if(e>=_ee)return Iee}else{if(e<=-gV)return ws;if(e+1>=gV)return Tee}return e<0?$o(-e,t).neg():an(e%Vm|0,e/Vm|0,t)}on.fromNumber=$o;function an(e,t,n){return new on(e,t,n)}on.fromBits=an;var Rk=Math.pow;function iB(e,t,n){if(e.length===0)throw Error("empty string");if(e==="NaN"||e==="Infinity"||e==="+Infinity"||e==="-Infinity")return Co;if(typeof t=="number"?(n=t,t=!1):t=!!t,n=n||10,n<2||36<n)throw RangeError("radix");var r;if((r=e.indexOf("-"))>0)throw Error("interior hyphen");if(r===0)return iB(e.substring(1),t,n).neg();for(var i=$o(Rk(n,8)),s=Co,o=0;o<e.length;o+=8){var a=Math.min(8,e.length-o),u=parseInt(e.substring(o,o+a),n);if(a<8){var l=$o(Rk(n,a));s=s.mul(l).add($o(u))}else s=s.mul(i),s=s.add($o(u))}return s.unsigned=t,s}on.fromString=iB;function La(e,t){return typeof e=="number"?$o(e,t):typeof e=="string"?iB(e,t):an(e.low,e.high,typeof t=="boolean"?t:e.unsigned)}on.fromValue=La;var pV=65536,gwe=1<<24,Vm=pV*pV,_ee=Vm*Vm,gV=_ee/2,mV=ig(gwe),Co=ig(0);on.ZERO=Co;var Md=ig(0,!0);on.UZERO=Md;var ym=ig(1);on.ONE=ym;var Aee=ig(1,!0);on.UONE=Aee;var LR=ig(-1);on.NEG_ONE=LR;var Tee=an(-1,2147483647,!1);on.MAX_VALUE=Tee;var Iee=an(-1,-1,!0);on.MAX_UNSIGNED_VALUE=Iee;var ws=an(0,-2147483648,!1);on.MIN_VALUE=ws;var Se=on.prototype;Se.toInt=function(){return this.unsigned?this.low>>>0:this.low};Se.toNumber=function(){return this.unsigned?(this.high>>>0)*Vm+(this.low>>>0):this.high*Vm+(this.low>>>0)};Se.toString=function(t){if(t=t||10,t<2||36<t)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative())if(this.eq(ws)){var n=$o(t),r=this.div(n),i=r.mul(n).sub(this);return r.toString(t)+i.toInt().toString(t)}else return"-"+this.neg().toString(t);for(var s=$o(Rk(t,6),this.unsigned),o=this,a="";;){var u=o.div(s),l=o.sub(u.mul(s)).toInt()>>>0,c=l.toString(t);if(o=u,o.isZero())return c+a;for(;c.length<6;)c="0"+c;a=""+c+a}};Se.getHighBits=function(){return this.high};Se.getHighBitsUnsigned=function(){return this.high>>>0};Se.getLowBits=function(){return this.low};Se.getLowBitsUnsigned=function(){return this.low>>>0};Se.getNumBitsAbs=function(){if(this.isNegative())return this.eq(ws)?64:this.neg().getNumBitsAbs();for(var t=this.high!=0?this.high:this.low,n=31;n>0&&!(t&1<<n);n--);return this.high!=0?n+33:n+1};Se.isZero=function(){return this.high===0&&this.low===0};Se.eqz=Se.isZero;Se.isNegative=function(){return!this.unsigned&&this.high<0};Se.isPositive=function(){return this.unsigned||this.high>=0};Se.isOdd=function(){return(this.low&1)===1};Se.isEven=function(){return(this.low&1)===0};Se.equals=function(t){return Bs(t)||(t=La(t)),this.unsigned!==t.unsigned&&this.high>>>31===1&&t.high>>>31===1?!1:this.high===t.high&&this.low===t.low};Se.eq=Se.equals;Se.notEquals=function(t){return!this.eq(t)};Se.neq=Se.notEquals;Se.ne=Se.notEquals;Se.lessThan=function(t){return this.comp(t)<0};Se.lt=Se.lessThan;Se.lessThanOrEqual=function(t){return this.comp(t)<=0};Se.lte=Se.lessThanOrEqual;Se.le=Se.lessThanOrEqual;Se.greaterThan=function(t){return this.comp(t)>0};Se.gt=Se.greaterThan;Se.greaterThanOrEqual=function(t){return this.comp(t)>=0};Se.gte=Se.greaterThanOrEqual;Se.ge=Se.greaterThanOrEqual;Se.compare=function(t){if(Bs(t)||(t=La(t)),this.eq(t))return 0;var n=this.isNegative(),r=t.isNegative();return n&&!r?-1:!n&&r?1:this.unsigned?t.high>>>0>this.high>>>0||t.high===this.high&&t.low>>>0>this.low>>>0?-1:1:this.sub(t).isNegative()?-1:1};Se.comp=Se.compare;Se.negate=function(){return!this.unsigned&&this.eq(ws)?ws:this.not().add(ym)};Se.neg=Se.negate;Se.add=function(t){Bs(t)||(t=La(t));var n=this.high>>>16,r=this.high&65535,i=this.low>>>16,s=this.low&65535,o=t.high>>>16,a=t.high&65535,u=t.low>>>16,l=t.low&65535,c=0,f=0,h=0,d=0;return d+=s+l,h+=d>>>16,d&=65535,h+=i+u,f+=h>>>16,h&=65535,f+=r+a,c+=f>>>16,f&=65535,c+=n+o,c&=65535,an(h<<16|d,c<<16|f,this.unsigned)};Se.subtract=function(t){return Bs(t)||(t=La(t)),this.add(t.neg())};Se.sub=Se.subtract;Se.multiply=function(t){if(this.isZero())return Co;if(Bs(t)||(t=La(t)),wo){var n=wo.mul(this.low,this.high,t.low,t.high);return an(n,wo.get_high(),this.unsigned)}if(t.isZero())return Co;if(this.eq(ws))return t.isOdd()?ws:Co;if(t.eq(ws))return this.isOdd()?ws:Co;if(this.isNegative())return t.isNegative()?this.neg().mul(t.neg()):this.neg().mul(t).neg();if(t.isNegative())return this.mul(t.neg()).neg();if(this.lt(mV)&&t.lt(mV))return $o(this.toNumber()*t.toNumber(),this.unsigned);var r=this.high>>>16,i=this.high&65535,s=this.low>>>16,o=this.low&65535,a=t.high>>>16,u=t.high&65535,l=t.low>>>16,c=t.low&65535,f=0,h=0,d=0,p=0;return p+=o*c,d+=p>>>16,p&=65535,d+=s*c,h+=d>>>16,d&=65535,d+=o*l,h+=d>>>16,d&=65535,h+=i*c,f+=h>>>16,h&=65535,h+=s*l,f+=h>>>16,h&=65535,h+=o*u,f+=h>>>16,h&=65535,f+=r*c+i*l+s*u+o*a,f&=65535,an(d<<16|p,f<<16|h,this.unsigned)};Se.mul=Se.multiply;Se.divide=function(t){if(Bs(t)||(t=La(t)),t.isZero())throw Error("division by zero");if(wo){if(!this.unsigned&&this.high===-2147483648&&t.low===-1&&t.high===-1)return this;var n=(this.unsigned?wo.div_u:wo.div_s)(this.low,this.high,t.low,t.high);return an(n,wo.get_high(),this.unsigned)}if(this.isZero())return this.unsigned?Md:Co;var r,i,s;if(this.unsigned){if(t.unsigned||(t=t.toUnsigned()),t.gt(this))return Md;if(t.gt(this.shru(1)))return Aee;s=Md}else{if(this.eq(ws)){if(t.eq(ym)||t.eq(LR))return ws;if(t.eq(ws))return ym;var o=this.shr(1);return r=o.div(t).shl(1),r.eq(Co)?t.isNegative()?ym:LR:(i=this.sub(t.mul(r)),s=r.add(i.div(t)),s)}else if(t.eq(ws))return this.unsigned?Md:Co;if(this.isNegative())return t.isNegative()?this.neg().div(t.neg()):this.neg().div(t).neg();if(t.isNegative())return this.div(t.neg()).neg();s=Co}for(i=this;i.gte(t);){r=Math.max(1,Math.floor(i.toNumber()/t.toNumber()));for(var a=Math.ceil(Math.log(r)/Math.LN2),u=a<=48?1:Rk(2,a-48),l=$o(r),c=l.mul(t);c.isNegative()||c.gt(i);)r-=u,l=$o(r,this.unsigned),c=l.mul(t);l.isZero()&&(l=ym),s=s.add(l),i=i.sub(c)}return s};Se.div=Se.divide;Se.modulo=function(t){if(Bs(t)||(t=La(t)),wo){var n=(this.unsigned?wo.rem_u:wo.rem_s)(this.low,this.high,t.low,t.high);return an(n,wo.get_high(),this.unsigned)}return this.sub(this.div(t).mul(t))};Se.mod=Se.modulo;Se.rem=Se.modulo;Se.not=function(){return an(~this.low,~this.high,this.unsigned)};Se.and=function(t){return Bs(t)||(t=La(t)),an(this.low&t.low,this.high&t.high,this.unsigned)};Se.or=function(t){return Bs(t)||(t=La(t)),an(this.low|t.low,this.high|t.high,this.unsigned)};Se.xor=function(t){return Bs(t)||(t=La(t)),an(this.low^t.low,this.high^t.high,this.unsigned)};Se.shiftLeft=function(t){return Bs(t)&&(t=t.toInt()),(t&=63)===0?this:t<32?an(this.low<<t,this.high<<t|this.low>>>32-t,this.unsigned):an(0,this.low<<t-32,this.unsigned)};Se.shl=Se.shiftLeft;Se.shiftRight=function(t){return Bs(t)&&(t=t.toInt()),(t&=63)===0?this:t<32?an(this.low>>>t|this.high<<32-t,this.high>>t,this.unsigned):an(this.high>>t-32,this.high>=0?0:-1,this.unsigned)};Se.shr=Se.shiftRight;Se.shiftRightUnsigned=function(t){if(Bs(t)&&(t=t.toInt()),t&=63,t===0)return this;var n=this.high;if(t<32){var r=this.low;return an(r>>>t|n<<32-t,n>>>t,this.unsigned)}else return t===32?an(n,0,this.unsigned):an(n>>>t-32,0,this.unsigned)};Se.shru=Se.shiftRightUnsigned;Se.shr_u=Se.shiftRightUnsigned;Se.toSigned=function(){return this.unsigned?an(this.low,this.high,!1):this};Se.toUnsigned=function(){return this.unsigned?this:an(this.low,this.high,!0)};Se.toBytes=function(t){return t?this.toBytesLE():this.toBytesBE()};Se.toBytesLE=function(){var t=this.high,n=this.low;return[n&255,n>>>8&255,n>>>16&255,n>>>24,t&255,t>>>8&255,t>>>16&255,t>>>24]};Se.toBytesBE=function(){var t=this.high,n=this.low;return[t>>>24,t>>>16&255,t>>>8&255,t&255,n>>>24,n>>>16&255,n>>>8&255,n&255]};on.fromBytes=function(t,n,r){return r?on.fromBytesLE(t,n):on.fromBytesBE(t,n)};on.fromBytesLE=function(t,n){return new on(t[0]|t[1]<<8|t[2]<<16|t[3]<<24,t[4]|t[5]<<8|t[6]<<16|t[7]<<24,n)};on.fromBytesBE=function(t,n){return new on(t[4]<<24|t[5]<<16|t[6]<<8|t[7],t[0]<<24|t[1]<<16|t[2]<<8|t[3],n)};const Dee=k2(Eee),mwe=B2e({__proto__:null,default:Dee},[Eee]);/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $d=Dee||mwe;function Tw(e){return $d.fromString(e,!0,16)}const Nee=Tw("c3a5c85c97cb3127"),md=Tw("b492b66fbe98f273"),fi=Tw("9ae16a3b2f90404f");function PR(e){return e.xor(e.shru(47))}function Fee(e,t,n){const r=e.slice(t,t+n);return $d.fromBytes(Array.from(r),!0,!0)}function Qt(e,t){return Fee(e,t,8)}function yV(e,t){return Fee(e,t,4)}function nr(e,t){return t===0?e:e.shru(t).or(e.shl(64-t))}function wf(e,t,n=Tw("9ddfea08eb382d69")){let r=e.xor(t).mul(n);r=r.xor(r.shru(47));let i=t.xor(r).mul(n);return i=i.xor(i.shru(47)),i=i.mul(n),i}function ywe(e,t,n,r,i,s){i=i.add(e),s=nr(s.add(i).add(r),21);const o=i;return i=i.add(t),i=i.add(n),s=s.add(nr(i,44)),[i.add(r),s.add(o)]}function SC(e,t,n,r){return ywe(Qt(e,t),Qt(e,t+8),Qt(e,t+16),Qt(e,t+24),n,r)}function bwe(e,t=e.length){if(t>=8){const n=fi.add(t*2),r=Qt(e,0).add(fi),i=Qt(e,t-8),s=nr(i,37).mul(n).add(r),o=nr(r,25).add(i).mul(n);return wf(s,o,n)}if(t>=4){const n=fi.add(t*2),r=yV(e,0);return wf(r.shl(3).add(t),yV(e,t-4),n)}if(t>0){const n=e[0],r=e[t>>1],i=e[t-1],s=n+(r<<8),o=t+(i<<2);return PR(fi.mul(s).xor(Nee.mul(o))).mul(fi)}return fi}function xwe(e,t=e.length){const n=fi.add(t*2),r=Qt(e,0).mul(md),i=Qt(e,8),s=Qt(e,t-8).mul(n),o=Qt(e,t-16).mul(fi);return wf(nr(r.add(i),43).add(nr(s,30)).add(o),r.add(nr(i.add(fi),18)).add(s),n)}function vwe(e,t=e.length){const n=fi.add(t*2),r=Qt(e,0).mul(fi),i=Qt(e,8),s=Qt(e,t-8).mul(n),o=Qt(e,t-16).mul(fi),a=nr(r.add(i),43).add(nr(s,30)).add(o),u=wf(a,r.add(nr(i.add(fi),18)).add(s),n),l=Qt(e,16).mul(n),c=Qt(e,24),f=a.add(Qt(e,t-32)).mul(n),h=u.add(Qt(e,t-24)).mul(n);return wf(nr(l.add(c),43).add(nr(f,30)).add(h),l.add(nr(c.add(r),18)).add(f),n)}function Oee(e,t=e.length){const n=$d.fromNumber(81,!0);if(t<=32)return t<=16?bwe(e,t):xwe(e,t);if(t<=64)return vwe(e,t);let r=n,i=n.mul(md).add(113),s=PR(i.mul(fi).add(113)).mul(fi),o=[$d.UZERO,$d.UZERO],a=[$d.UZERO,$d.UZERO];r=r.mul(fi).add(Qt(e,0));let u=0;const l=(t-1>>6)*64,c=l+(t-1&63)-63;do r=nr(r.add(i).add(o[0]).add(Qt(e,u+8)),37).mul(md),i=nr(i.add(o[1]).add(Qt(e,u+48)),42).mul(md),r=r.xor(a[1]),i=i.add(o[0]).add(Qt(e,u+40)),s=nr(s.add(a[0]),33).mul(md),o=SC(e,u,o[1].mul(md),r.add(a[0])),a=SC(e,u+32,s.add(a[1]),i.add(Qt(e,u+16))),[s,r]=[r,s],u+=64;while(u!==l);const f=md.add(s.and(255).shl(1));return u=c,a[0]=a[0].add(t-1&63),o[0]=o[0].add(a[0]),a[0]=a[0].add(o[0]),r=nr(r.add(i).add(o[0]).add(Qt(e,u+8)),37).mul(f),i=nr(i.add(o[1]).add(Qt(e,u+48)),42).mul(f),r=r.xor(a[1].mul(9)),i=i.add(o[0].mul(9).add(Qt(e,u+40))),s=nr(s.add(a[0]),33).mul(f),o=SC(e,u,o[1].mul(f),r.add(a[0])),a=SC(e,u+32,s.add(a[1]),i.add(Qt(e,u+16))),[s,r]=[r,s],wf(wf(o[0],a[0],f).add(PR(i).mul(Nee)).add(s),wf(o[1],a[1],f).add(r),f)}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xc(e,t){return t==="string"?wu(e):Ch([e],t)}function wwe(e,t){return e instanceof Float32Array&&t==="float32"||e instanceof Int32Array&&t==="int32"||e instanceof Uint8Array&&t==="bool"}function Ch(e,t){if(t==="string")throw new Error("Cannot convert a string[] to a TypedArray");if(Array.isArray(e)&&(e=Ou(e)),K().getBool("DEBUG")&&pee(e,t),wwe(e,t))return e;if(t==null||t==="float32"||t==="complex64")return new Float32Array(e);if(t==="int32")return new Int32Array(e);if(t==="bool"){const n=new Uint8Array(e.length);for(let r=0;r<n.length;++r)Math.round(e[r])!==0&&(n[r]=1);return n}else throw new Error(`Unknown data type ${t}`)}function ui(){return K().platform.now()}function $we(e,t){return K().platform.fetch(e,t)}function wu(e,t="utf-8"){return t=t||"utf-8",K().platform.encode(e,t)}function oc(e,t="utf-8"){return t=t||"utf-8",K().platform.decode(e,t)}function rr(e){return K().platform.isTypedArray!=null?K().platform.isTypedArray(e):kee(e)}function Ou(e,t=[],n=!1){if(t==null&&(t=[]),typeof e=="boolean"||typeof e=="number"||typeof e=="string"||DA(e)||e==null||rr(e)&&n)t.push(e);else if(Array.isArray(e)||rr(e))for(let r=0;r<e.length;++r)Ou(e[r],t,n);else{let r=-1;for(const i of Object.keys(e))/^([1-9]+[0-9]*|0)$/.test(i)&&(r=Math.max(r,Number(i)));for(let i=0;i<=r;i++)Ou(e[i],t,n)}return t}const Cwe=Object.freeze(Object.defineProperty({__proto__:null,arraysEqual:bt,arraysEqualWithNull:dee,assert:N,assertNonNegativeIntegerDimensions:Ps,assertNonNull:eg,assertShapesMatch:Fr,bytesFromStringArray:mee,bytesPerElement:Rx,checkConversionForErrors:pee,clamp:Ff,computeStrides:Me,convertBackendValuesAndArrayBuffer:xee,createScalarValue:xc,createShuffledIndices:ewe,decodeString:oc,distSquared:Z2e,encodeString:wu,fetch:$we,fingerPrint64:Oee,flatten:Ou,getArrayFromDType:En,getTypedArrayFromDType:hr,hasEncodingLoss:QP,hexToLong:Tw,indexToLoc:ng,inferDtype:tg,inferFromImplicitShape:JP,isBoolean:yee,isFunction:Of,isInt:dp,isNumber:Tk,isPromise:DA,isScalarShape:J2e,isString:mu,isTypedArray:rr,isValidDtype:gee,locToIndex:$a,makeOnesTypedArray:IA,makeZerosNestedTypedArray:eB,makeZerosTypedArray:Ir,nearestDivisor:Ik,nearestLargerEven:TA,now:ui,parseAxisParam:st,randUniform:K2e,repeatedTry:RR,rightPad:Yd,shuffle:ZP,shuffleCombo:Y2e,sizeFromShape:te,sizeToSquarishShape:Ak,squeezeShape:bc,sum:hee,swap:Rl,tanh:Q2e,toNestedArray:Fo,toTypedArray:Ch},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Swe{constructor(t,n){this.backendTimer=t,this.logger=n,n==null&&(this.logger=new Ewe)}profileKernel(t,n,r){let i;const s=()=>{i=r()};let o;const a=ui();if(this.backendTimer.timerAvailable())o=this.backendTimer.time(s);else{s();for(const l of i)l.dataSync();o=Promise.resolve({kernelMs:ui()-a})}if(K().getBool("CHECK_COMPUTATION_FOR_ERRORS"))for(let l=0;l<i.length;l++){const c=i[l];c.data().then(f=>{kwe(f,c.dtype,t)})}return{kernelName:t,outputs:i,inputs:n,timeMs:o.then(l=>l.kernelMs),extraInfo:o.then(l=>l.getExtraProfileInfo!=null?l.getExtraProfileInfo():"")}}logKernelProfile(t){const{kernelName:n,outputs:r,timeMs:i,inputs:s,extraInfo:o}=t;r.forEach(a=>{Promise.all([a.data(),i,o]).then(u=>{this.logger.logKernelProfile(n,a,u[0],u[1],s,u[2])})})}}function kwe(e,t,n){if(t!=="float32")return!1;for(let r=0;r<e.length;r++){const i=e[r];if(isNaN(i)||!isFinite(i))return console.warn(`Found ${i} in the result of '${n}'`),!0}return!1}class Ewe{logKernelProfile(t,n,r,i,s,o){const a=typeof i=="number"?Yd(`${i}ms`,9):i.error,u=Yd(t,25),l=n.rank,c=n.size,f=Yd(n.shape.toString(),14);let h="";for(const d in s){const p=s[d];if(p!=null){const g=p.shape||n.shape,m=g.length;h+=`${d}: ${m}D ${m>0?g:""} `}}console.log(`%c${u}	%c${a}	%c${l}D ${f}	%c${c}	%c${h}	%c${o}`,"font-weight:bold","color:red","color:blue","color: orange","color: green","color: steelblue")}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _we(e,t,n){const r={},i={};for(let u=0;u<t.length;u++)r[t[u].id]=!0;for(let u=0;u<e.length;u++){const l=e[u],c=l.inputs;for(const f in c){const h=c[f];let d=!1;for(let p=0;p<t.length;p++)if(r[h.id]){l.outputs.forEach(g=>r[g.id]=!0),d=!0,i[l.id]=!0;break}if(d)break}}const s={};s[n.id]=!0;const o={};for(let u=e.length-1;u>=0;u--){const l=e[u],c=l.inputs;for(let f=0;f<l.outputs.length;f++)if(s[l.outputs[f].id]){for(const h in c)s[c[h].id]=!0,o[l.id]=!0;break}}const a=[];for(let u=0;u<e.length;u++){const l=e[u];if(i[l.id]&&o[l.id]){const c={};for(const h in l.inputs){const d=l.inputs[h];r[d.id]&&(c[h]=d)}const f=Object.assign({},l);f.inputs=c,f.outputs=l.outputs,a.push(f)}}return a}function Awe(e,t,n,r){for(let i=t.length-1;i>=0;i--){const s=t[i],o=[];if(s.outputs.forEach(u=>{const l=e[u.id];l!=null?o.push(l):o.push(null)}),s.gradient==null)throw new Error(`Cannot compute gradient: gradient function not found for ${s.kernelName}.`);const a=s.gradient(o);for(const u in s.inputs){if(!(u in a))throw new Error(`Cannot backprop through input ${u}. Available gradients found: ${Object.keys(a)}.`);const l=n(()=>a[u]());if(l.dtype!=="float32")throw new Error(`Error in gradient for op ${s.kernelName}. The gradient of input ${u} must have 'float32' dtype, but has '${l.dtype}'`);const c=s.inputs[u];if(!bt(l.shape,c.shape))throw new Error(`Error in gradient for op ${s.kernelName}. The gradient of input '${u}' has shape '${l.shape}', which does not match the shape of the input '${c.shape}'`);if(e[c.id]==null)e[c.id]=l;else{const f=e[c.id];e[c.id]=r(f,l),f.dispose()}}}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const bV=20,Uy=3,QF=7;function Twe(e,t,n,r){const i=Me(t),s=Iwe(e,t,n,i),o=t.length,a=WS(e,t,n,i,s),u=["Tensor"];return r&&(u.push(`  dtype: ${n}`),u.push(`  rank: ${o}`),u.push(`  shape: [${t}]`),u.push("  values:")),u.push(a.map(l=>"    "+l).join(`
`)),u.join(`
`)}function Iwe(e,t,n,r){const i=te(t),s=r[r.length-1],o=new Array(s).fill(0),a=t.length,u=n==="complex64"?Ab(e):e;if(a>1)for(let l=0;l<i/s;l++){const c=l*s;for(let f=0;f<s;f++)o[f]=Math.max(o[f],_b(u[c+f],0,n).length)}return o}function _b(e,t,n){let r;return Array.isArray(e)?r=`${parseFloat(e[0].toFixed(QF))} + ${parseFloat(e[1].toFixed(QF))}j`:mu(e)?r=`'${e}'`:n==="bool"?r=Ree(e):r=parseFloat(e.toFixed(QF)).toString(),Yd(r,t)}function Ree(e){return e===0?"false":"true"}function WS(e,t,n,r,i,s=!0){const o=n==="complex64"?2:1,a=t[0],u=t.length;if(u===0){if(n==="complex64"){const g=Ab(e);return[_b(g[0],0,n)]}return n==="bool"?[Ree(e[0])]:[e[0].toString()]}if(u===1){if(a>bV){const m=Uy*o;let y=Array.from(e.slice(0,m)),b=Array.from(e.slice((a-Uy)*o,a*o));return n==="complex64"&&(y=Ab(y),b=Ab(b)),["["+y.map((v,x)=>_b(v,i[x],n)).join(", ")+", ..., "+b.map((v,x)=>_b(v,i[a-Uy+x],n)).join(", ")+"]"]}return["["+(n==="complex64"?Ab(e):Array.from(e)).map((m,y)=>_b(m,i[y],n)).join(", ")+"]"]}const l=t.slice(1),c=r.slice(1),f=r[0]*o,h=[];if(a>bV){for(let g=0;g<Uy;g++){const m=g*f,y=m+f;h.push(...WS(e.slice(m,y),l,n,c,i,!1))}h.push("...");for(let g=a-Uy;g<a;g++){const m=g*f,y=m+f;h.push(...WS(e.slice(m,y),l,n,c,i,g===a-1))}}else for(let g=0;g<a;g++){const m=g*f,y=m+f;h.push(...WS(e.slice(m,y),l,n,c,i,g===a-1))}const d=u===2?",":"";h[0]="["+(a>0?h[0]+d:"");for(let g=1;g<h.length-1;g++)h[g]=" "+h[g]+d;let p=`,
`;for(let g=2;g<u;g++)p+=`
`;return h[h.length-1]=" "+h[h.length-1]+"]"+(s?"":p),h}function Ab(e){const t=[];for(let n=0;n<e.length;n+=2)t.push([e[n],e[n+1]]);return t}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class zn{constructor(t,n,r){if(this.dtype=n,this.shape=t.slice(),this.size=te(t),r!=null){const i=r.length;N(i===this.size,()=>`Length of values '${i}' does not match the size inferred by the shape '${this.size}'.`)}if(n==="complex64")throw new Error("complex64 dtype TensorBuffers are not supported. Please create a TensorBuffer for the real and imaginary parts separately and call tf.complex(real, imag).");this.values=r||En(n,this.size),this.strides=Me(t)}set(t,...n){n.length===0&&(n=[0]),N(n.length===this.rank,()=>`The number of provided coordinates (${n.length}) must match the rank (${this.rank})`);const r=this.locToIndex(n);this.values[r]=t}get(...t){t.length===0&&(t=[0]);let n=0;for(const i of t){if(i<0||i>=this.shape[n]){const s=`Requested out of range element at ${t}.   Buffer shape=${this.shape}`;throw new Error(s)}n++}let r=t[t.length-1];for(let i=0;i<t.length-1;++i)r+=this.strides[i]*t[i];return this.values[r]}locToIndex(t){if(this.rank===0)return 0;if(this.rank===1)return t[0];let n=t[t.length-1];for(let r=0;r<t.length-1;++r)n+=this.strides[r]*t[r];return n}indexToLoc(t){if(this.rank===0)return[];if(this.rank===1)return[t];const n=new Array(this.shape.length);for(let r=0;r<n.length-1;++r)n[r]=Math.floor(t/this.strides[r]),t-=n[r]*this.strides[r];return n[n.length-1]=t,n}get rank(){return this.shape.length}toTensor(){return ca().makeTensor(this.values,this.shape,this.dtype)}}let ca=null,hm=null;function Dwe(e){ca=e}function Nwe(e){hm=e}class Pt{constructor(t,n,r,i){this.kept=!1,this.isDisposedInternal=!1,this.shape=t.slice(),this.dtype=n||"float32",this.size=te(t),this.strides=Me(t),this.dataId=r,this.id=i,this.rankType=this.rank<5?this.rank.toString():"higher"}get rank(){return this.shape.length}async buffer(){const t=await this.data();return hm.buffer(this.shape,this.dtype,t)}bufferSync(){return hm.buffer(this.shape,this.dtype,this.dataSync())}async array(){const t=await this.data();return Fo(this.shape,t,this.dtype==="complex64")}arraySync(){return Fo(this.shape,this.dataSync(),this.dtype==="complex64")}async data(){this.throwIfDisposed();const t=ca().read(this.dataId);if(this.dtype==="string"){const n=await t;try{return n.map(r=>oc(r))}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}}return t}dataToGPU(t){return this.throwIfDisposed(),ca().readToGPU(this.dataId,t)}dataSync(){this.throwIfDisposed();const t=ca().readSync(this.dataId);if(this.dtype==="string")try{return t.map(n=>oc(n))}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}return t}async bytes(){this.throwIfDisposed();const t=await ca().read(this.dataId);return this.dtype==="string"?t:new Uint8Array(t.buffer)}dispose(){this.isDisposed||(ca().disposeTensor(this),this.isDisposedInternal=!0)}get isDisposed(){return this.isDisposedInternal}throwIfDisposed(){if(this.isDisposed)throw new Error("Tensor is disposed.")}print(t=!1){return hm.print(this,t)}clone(){return this.throwIfDisposed(),hm.clone(this)}toString(t=!1){const n=this.dataSync();return Twe(n,this.shape,this.dtype,t)}cast(t){return this.throwIfDisposed(),hm.cast(this,t)}variable(t=!0,n,r){return this.throwIfDisposed(),ca().makeVariable(this,t,n,r)}}Object.defineProperty(Pt,Symbol.hasInstance,{value:e=>!!e&&e.data!=null&&e.dataSync!=null&&e.throwIfDisposed!=null});function ne(){return nB("Tensor",()=>Pt)}ne();class Ux extends Pt{constructor(t,n,r,i){super(t.shape,t.dtype,t.dataId,i),this.trainable=n,this.name=r}assign(t){if(t.dtype!==this.dtype)throw new Error(`dtype of the new value (${t.dtype}) and previous value (${this.dtype}) must match`);if(!bt(t.shape,this.shape))throw new Error(`shape of the new value (${t.shape}) and previous value (${this.shape}) must match`);ca().disposeTensor(this),this.dataId=t.dataId,ca().incRef(this,null)}dispose(){ca().disposeVariable(this),this.isDisposedInternal=!0}}Object.defineProperty(Ux,Symbol.hasInstance,{value:e=>e instanceof Pt&&e.assign!=null&&e.assign instanceof Function});/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var BR;(function(e){e.R0="R0",e.R1="R1",e.R2="R2",e.R3="R3",e.R4="R4",e.R5="R5",e.R6="R6"})(BR||(BR={}));var zR;(function(e){e.float32="float32",e.int32="int32",e.bool="int32",e.complex64="complex64"})(zR||(zR={}));var UR;(function(e){e.float32="float32",e.int32="int32",e.bool="bool",e.complex64="complex64"})(UR||(UR={}));var jR;(function(e){e.float32="float32",e.int32="float32",e.bool="float32",e.complex64="complex64"})(jR||(jR={}));var WR;(function(e){e.float32="complex64",e.int32="complex64",e.bool="complex64",e.complex64="complex64"})(WR||(WR={}));const Fwe={float32:jR,int32:zR,bool:UR,complex64:WR};function qi(e,t){if(e==="string"||t==="string"){if(e==="string"&&t==="string")return"string";throw new Error(`Can not upcast ${e} with ${t}`)}return Fwe[e][t]}function PT(e){return qi(e,"int32")}function Mee(e){return e!=null&&typeof e=="object"&&"texture"in e&&e.texture instanceof WebGLTexture}function Lee(e){return typeof GPUBuffer<"u"&&e!=null&&typeof e=="object"&&"buffer"in e&&e.buffer instanceof GPUBuffer}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $n(e,t){if(e.dtype===t.dtype)return[e,t];const n=qi(e.dtype,t.dtype);return[e.cast(n),t.cast(n)]}function Pee(e,t){N(e.dtype===t.dtype,()=>`The dtypes of the first(${e.dtype}) and second(${t.dtype}) input must match`)}function Owe(e,t){return t.some(n=>n.id===e.id)}function sB(e){const t=[];return Bee(e,t,new Set),t}function Bee(e,t,n){if(e==null)return;if(e instanceof Pt){t.push(e);return}if(!Rwe(e))return;const r=e;for(const i in r){const s=r[i];n.has(s)||(n.add(s),Bee(s,t,n))}}function Rwe(e){return Array.isArray(e)||typeof e=="object"}const Mwe=Object.freeze(Object.defineProperty({__proto__:null,assertTypesMatch:Pee,getTensorsInContainer:sB,isTensorInList:Owe,makeTypesMatch:$n},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function e3(e){return e.kernelName!=null}class xV{constructor(){this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.gradientDepth=0,this.kernelDepth=0,this.scopeStack=[],this.numDataMovesStack=[],this.nextScopeId=0,this.tensorInfo=new WeakMap,this.profiling=!1,this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null,get kernelNames(){return Array.from(new Set(this.kernels.map(t=>t.name)))}}}dispose(){for(const t in this.registeredVariables)this.registeredVariables[t].dispose()}}class Gm{constructor(t){this.ENV=t,this.registry={},this.registryFactory={},this.pendingBackendInitId=0,this.state=new xV}async ready(){if(this.pendingBackendInit!=null)return this.pendingBackendInit.then(()=>{});if(this.backendInstance!=null)return;const t=this.getSortedBackends();for(let n=0;n<t.length;n++){const r=t[n];if(await this.initializeBackend(r).success){await this.setBackend(r);return}}throw new Error("Could not initialize any backends, all backend initializations failed.")}get backend(){if(this.pendingBackendInit!=null)throw new Error(`Backend '${this.backendName}' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods`);if(this.backendInstance==null){const{name:t,asyncInit:n}=this.initializeBackendsAndReturnBest();if(n)throw new Error(`The highest priority backend '${t}' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods`);this.setBackend(t)}return this.backendInstance}backendNames(){return Object.keys(this.registryFactory)}findBackend(t){if(!(t in this.registry))if(t in this.registryFactory){const{asyncInit:n}=this.initializeBackend(t);if(n)return null}else return null;return this.registry[t]}findBackendFactory(t){return t in this.registryFactory?this.registryFactory[t].factory:null}registerBackend(t,n,r=1){return t in this.registryFactory?(Hs(`${t} backend was already registered. Reusing existing backend factory.`),!1):(this.registryFactory[t]={factory:n,priority:r},!0)}async setBackend(t){if(this.registryFactory[t]==null)throw new Error(`Backend name '${t}' not found in registry`);if(this.backendName=t,this.registry[t]==null){this.backendInstance=null;const{success:n,asyncInit:r}=this.initializeBackend(t);if(!(r?await n:n))return!1}return this.backendInstance=this.registry[t],this.setupRegisteredKernels(),this.profiler=new Swe(this.backendInstance),!0}setupRegisteredKernels(){Ok(this.backendName).forEach(n=>{n.setupFunc!=null&&n.setupFunc(this.backendInstance)})}disposeRegisteredKernels(t){Ok(t).forEach(r=>{r.disposeFunc!=null&&r.disposeFunc(this.registry[t])})}initializeBackend(t){const n=this.registryFactory[t];if(n==null)throw new Error(`Cannot initialize backend ${t}, no registration found.`);try{const r=n.factory();if(r&&!(r instanceof AA)&&typeof r.then=="function"){const i=++this.pendingBackendInitId,s=r.then(o=>i<this.pendingBackendInitId?!1:(this.registry[t]=o,this.pendingBackendInit=null,!0)).catch(o=>(i<this.pendingBackendInitId||(this.pendingBackendInit=null,Hs(`Initialization of backend ${t} failed`),Hs(o.stack||o.message)),!1));return this.pendingBackendInit=s,{success:s,asyncInit:!0}}else return this.registry[t]=r,{success:!0,asyncInit:!1}}catch(r){return Hs(`Initialization of backend ${t} failed`),Hs(r.stack||r.message),{success:!1,asyncInit:!1}}}removeBackend(t){if(!(t in this.registryFactory))throw new Error(`${t} backend not found in registry`);this.backendName===t&&this.pendingBackendInit!=null&&this.pendingBackendInitId++,t in this.registry&&(this.disposeRegisteredKernels(t),this.registry[t].dispose(),delete this.registry[t]),delete this.registryFactory[t],this.backendName===t&&(this.pendingBackendInit=null,this.backendName=null,this.backendInstance=null)}getSortedBackends(){if(Object.keys(this.registryFactory).length===0)throw new Error("No backend found in registry.");return Object.keys(this.registryFactory).sort((t,n)=>this.registryFactory[n].priority-this.registryFactory[t].priority)}initializeBackendsAndReturnBest(){const t=this.getSortedBackends();for(let n=0;n<t.length;n++){const r=t[n],{success:i,asyncInit:s}=this.initializeBackend(r);if(s||i)return{name:r,asyncInit:s}}throw new Error("Could not initialize any backends, all backend initializations failed.")}moveData(t,n){const r=this.state.tensorInfo.get(n),i=r.backend,s=this.readSync(n),o=i.refCount(n);i.disposeData(n,!0),r.backend=t,t.move(n,s,r.shape,r.dtype,o),this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack[this.state.numDataMovesStack.length-1]++}tidy(t,n){let r=null;if(n==null){if(typeof t!="function")throw new Error("Please provide a function to tidy()");n=t}else{if(typeof t!="string"&&!(t instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if(typeof n!="function")throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");r=t}let i;return this.scopedRun(()=>this.startScope(r),()=>this.endScope(i),()=>(i=n(),i instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),i))}scopedRun(t,n,r){t();try{const i=r();return n(),i}catch(i){throw n(),i}}nextTensorId(){return Gm.nextTensorId++}nextVariableId(){return Gm.nextVariableId++}clone(t){const n=z.runKernel(h1,{x:t}),r={x:t},i=o=>({x:()=>{const a="float32",u={x:o},l={dtype:a};return z.runKernel(Q0,u,l)}}),s=[];return this.addTapeNode(this.state.activeScope.name,r,[n],i,s,{}),n}runKernel(t,n,r){if(this.backendName==null&&this.backend,!(zx(t,this.backendName)!=null))throw new Error(`Kernel '${t}' not registered for backend '${this.backendName}'`);return this.runKernelFunc({kernelName:t,inputs:n,attrs:r})}shouldCheckForMemLeaks(){return this.ENV.getBool("IS_TEST")}checkKernelForMemLeak(t,n,r){const i=this.backend.numDataIds();let s=0;r.forEach(u=>{s+=u.dtype==="complex64"?3:1});const o=this.state.numDataMovesStack[this.state.numDataMovesStack.length-1],a=i-n-s-o;if(a>0)throw new Error(`Backend '${this.backendName}' has an internal memory leak (${a} data ids) after running '${t}'`)}runKernelFunc(t){let n,r=[];const i=this.isTapeOn(),s=this.state.numBytes,o=this.state.numTensors;this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack.push(0);let a;this.backendName==null&&this.backend;let u;const l=e3(t)?t.kernelName:this.state.activeScope!=null?this.state.activeScope.name:"";if(e3(t)){const{kernelName:p,inputs:g,attrs:m}=t;this.backendName==null&&this.backend;const y=zx(p,this.backendName);N(y!=null,()=>`Cannot find registered kernel '${p}' for backend '${this.backendName}'`),a=()=>{const b=this.backend.numDataIds();u=y.kernelFunc({inputs:g,attrs:m,backend:this.backend});const v=Array.isArray(u)?u:[u];this.shouldCheckForMemLeaks()&&this.checkKernelForMemLeak(p,b,v);const x=v.map(w=>w.rank!=null?w:this.makeTensorFromTensorInfo(w));if(i){const w=this.getTensorsForGradient(p,g,x);r=this.saveTensorsForBackwardMode(w)}return x}}else{const{forwardFunc:p}=t,g=m=>{i&&(r=m.map(y=>this.keep(this.clone(y))))};a=()=>{const m=this.backend.numDataIds();u=this.tidy(()=>p(this.backend,g));const y=Array.isArray(u)?u:[u];return this.shouldCheckForMemLeaks()&&this.checkKernelForMemLeak(l,m,y),y}}const{inputs:c,attrs:f}=t,h=e3(t)?null:t.backwardsFunc;let d;return this.scopedRun(()=>this.state.kernelDepth++,()=>this.state.kernelDepth--,()=>{!this.ENV.getBool("DEBUG")&&!this.state.profiling?n=a():(d=this.profiler.profileKernel(l,c,()=>a()),this.ENV.getBool("DEBUG")&&this.profiler.logKernelProfile(d),n=d.outputs)}),i&&this.addTapeNode(l,c,n,h,r,f),this.state.profiling&&this.state.activeProfile.kernels.push({name:l,bytesAdded:this.state.numBytes-s,totalBytesSnapshot:this.state.numBytes,tensorsAdded:this.state.numTensors-o,totalTensorsSnapshot:this.state.numTensors,inputShapes:Object.keys(c).map(p=>c[p]!=null?c[p].shape:null),outputShapes:n.map(p=>p.shape),kernelTimeMs:d.timeMs,extraInfo:d.extraInfo}),Array.isArray(u)?n:n[0]}saveTensorsForBackwardMode(t){return t.map(r=>this.keep(this.clone(r)))}getTensorsForGradient(t,n,r){const i=MR(t);if(i!=null){const s=i.inputsToSave||[],o=i.outputsToSave||[];let a;i.saveAllInputs?(N(Array.isArray(n),()=>"saveAllInputs is true, expected inputs to be an array."),a=Object.keys(n).map(l=>n[l])):a=s.map(l=>n[l]);const u=r.filter((l,c)=>o[c]);return a.concat(u)}return[]}makeTensor(t,n,r,i){if(t==null)throw new Error("Values passed to engine.makeTensor() are null");r=r||"float32",i=i||this.backend;let s=t;r==="string"&&mu(t[0])&&(s=t.map(u=>wu(u)));const o=i.write(s,n,r),a=new Pt(n,r,o,this.nextTensorId());if(this.trackTensor(a,i),r==="string"){const u=this.state.tensorInfo.get(o),l=mee(s);this.state.numBytes+=l-u.bytes,u.bytes=l}return a}makeTensorFromDataId(t,n,r,i){r=r||"float32";const s={dataId:t,shape:n,dtype:r};return this.makeTensorFromTensorInfo(s,i)}makeTensorFromTensorInfo(t,n){const{dataId:r,shape:i,dtype:s}=t,o=new Pt(i,s,r,this.nextTensorId());return this.trackTensor(o,n),o}makeVariable(t,n=!0,r,i){r=r||this.nextVariableId().toString(),i!=null&&i!==t.dtype&&(t=t.cast(i));const s=new Ux(t,n,r,this.nextTensorId());if(this.state.registeredVariables[s.name]!=null)throw new Error(`Variable with name ${s.name} was already registered`);return this.state.registeredVariables[s.name]=s,this.incRef(s,this.backend),s}trackTensor(t,n){this.state.numTensors++,t.dtype==="string"&&this.state.numStringTensors++;let r=0;t.dtype!=="complex64"&&t.dtype!=="string"&&(r=t.size*Rx(t.dtype)),this.state.numBytes+=r,this.state.tensorInfo.has(t.dataId)||(this.state.numDataBuffers++,this.state.tensorInfo.set(t.dataId,{backend:n||this.backend,dtype:t.dtype,shape:t.shape,bytes:r})),t instanceof Ux||this.track(t)}incRef(t,n){this.trackTensor(t,n),this.backend.incRef(t.dataId)}removeDataId(t,n){this.state.tensorInfo.has(t)&&this.state.tensorInfo.get(t).backend===n&&(this.state.tensorInfo.delete(t),this.state.numDataBuffers--)}disposeTensor(t){if(!this.state.tensorInfo.has(t.dataId))return;const n=this.state.tensorInfo.get(t.dataId);if(this.state.numTensors--,t.dtype==="string"&&(this.state.numStringTensors--,this.state.numBytes-=n.bytes),t.dtype!=="complex64"&&t.dtype!=="string"){const r=t.size*Rx(t.dtype);this.state.numBytes-=r}n.backend.disposeData(t.dataId)&&this.removeDataId(t.dataId,n.backend)}disposeVariables(){for(const t in this.state.registeredVariables){const n=this.state.registeredVariables[t];this.disposeVariable(n)}}disposeVariable(t){this.disposeTensor(t),this.state.registeredVariables[t.name]!=null&&delete this.state.registeredVariables[t.name]}memory(){const t=this.backend.memory();return t.numTensors=this.state.numTensors,t.numDataBuffers=this.state.numDataBuffers,t.numBytes=this.state.numBytes,this.state.numStringTensors>0&&(t.unreliable=!0,t.reasons==null&&(t.reasons=[]),t.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),t}async profile(t){this.state.profiling=!0;const n=this.state.numBytes,r=this.state.numTensors;this.state.activeProfile.kernels=[],this.state.activeProfile.result=await t(),this.state.profiling=!1,this.state.activeProfile.peakBytes=Math.max(...this.state.activeProfile.kernels.map(i=>i.totalBytesSnapshot)),this.state.activeProfile.newBytes=this.state.numBytes-n,this.state.activeProfile.newTensors=this.state.numTensors-r;for(const i of this.state.activeProfile.kernels)i.kernelTimeMs=await i.kernelTimeMs,i.extraInfo=await i.extraInfo;return this.state.activeProfile}isTapeOn(){return this.state.gradientDepth>0&&this.state.kernelDepth===0}addTapeNode(t,n,r,i,s,o){const a={id:this.state.nextTapeNodeId++,kernelName:t,inputs:n,outputs:r,saved:s},u=MR(t);u!=null&&(i=u.gradFunc),i!=null&&(a.gradient=l=>(l=l.map((c,f)=>{if(c==null){const h=r[f],d=Ir(h.size,h.dtype);return this.makeTensor(d,h.shape,h.dtype)}return c}),i(l.length>1?l:l[0],s,o))),this.state.activeTape.push(a)}keep(t){return t.kept=!0,t}startTape(){this.state.gradientDepth===0&&(this.state.activeTape=[]),this.state.gradientDepth++}endTape(){this.state.gradientDepth--}startScope(t){const n={track:[],name:"unnamed scope",id:this.state.nextScopeId++};t&&(n.name=t),this.state.scopeStack.push(n),this.state.activeScope=n}endScope(t){const n=sB(t),r=new Set(n.map(s=>s.id));for(let s=0;s<this.state.activeScope.track.length;s++){const o=this.state.activeScope.track[s];!o.kept&&!r.has(o.id)&&o.dispose()}const i=this.state.scopeStack.pop();this.state.activeScope=this.state.scopeStack.length===0?null:this.state.scopeStack[this.state.scopeStack.length-1],n.forEach(s=>{!s.kept&&s.scopeId===i.id&&this.track(s)})}gradients(t,n,r,i=!1){if(N(n.length>0,()=>"gradients() received an empty list of xs."),r!=null&&r.dtype!=="float32")throw new Error(`dy must have 'float32' dtype, but has '${r.dtype}'`);const s=this.scopedRun(()=>this.startTape(),()=>this.endTape(),()=>this.tidy("forward",t));N(s instanceof Pt,()=>"The result y returned by f() must be a tensor.");const o=_we(this.state.activeTape,n,s);if(!i&&o.length===0&&n.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");return this.tidy("backward",()=>{const a={};a[s.id]=r??Lwe(s.shape),Awe(a,o,l=>this.tidy(l),Pwe);const u=n.map(l=>a[l.id]);return this.state.gradientDepth===0&&(this.state.activeTape.forEach(l=>{for(const c of l.saved)c.dispose()}),this.state.activeTape=null),{value:s,grads:u}})}customGrad(t){return N(Of(t),()=>"The f passed in customGrad(f) must be a function."),(...n)=>{N(n.every(a=>a instanceof Pt),()=>"The args passed in customGrad(f)(x1, x2,...) must all be tensors");let r;const i={};n.forEach((a,u)=>{i[u]=a});const s=(a,u)=>(r=t(...n,u),N(r.value instanceof Pt,()=>"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor"),N(Of(r.gradFunc),()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function."),r.value),o=(a,u)=>{const l=r.gradFunc(a,u),c=Array.isArray(l)?l:[l];N(c.length===n.length,()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...)."),N(c.every(h=>h instanceof Pt),()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors.");const f={};return c.forEach((h,d)=>{f[d]=()=>h}),f};return this.runKernelFunc({forwardFunc:s,backwardsFunc:o,inputs:i})}}readSync(t){return this.state.tensorInfo.get(t).backend.readSync(t)}read(t){return this.state.tensorInfo.get(t).backend.read(t)}readToGPU(t,n){return this.state.tensorInfo.get(t).backend.readToGPU(t,n)}async time(t){const n=ui(),r=await this.backend.time(t);return r.wallMs=ui()-n,r}track(t){return this.state.activeScope!=null&&(t.scopeId=this.state.activeScope.id,this.state.activeScope.track.push(t)),t}get registeredVariables(){return this.state.registeredVariables}reset(){this.pendingBackendInitId++,this.state.dispose(),this.ENV.reset(),this.state=new xV;for(const t in this.registry)this.disposeRegisteredKernels(t),this.registry[t].dispose(),delete this.registry[t];this.backendName=null,this.backendInstance=null,this.pendingBackendInit=null}}Gm.nextTensorId=0;Gm.nextVariableId=0;function Lwe(e){const t=IA(te(e),"float32");return z.makeTensor(t,e,"float32")}function zee(){const e=wee();if(e._tfengine==null){const t=new vee(e);e._tfengine=new Gm(t)}return iwe(e._tfengine.ENV),Dwe(()=>e._tfengine),e._tfengine}const z=zee();function Pwe(e,t){const n={a:e,b:t};return z.runKernel(rg,n)}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Bwe(){return typeof navigator<"u"&&navigator!=null}let VR;function zwe(e){VR=e}function oB(e){if(VR!==void 0)return VR;if(e||Bwe()){if(e||(e=navigator),e.product==="ReactNative")return!0;const t=e.userAgent||e.vendor||(typeof window<"u"?window.opera:"");if(!t){const n=e;return n.userAgentData&&n.userAgentData.mobile}return/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(t)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(t.substr(0,4))}return!1}function aB(){return typeof window<"u"&&window.document!=null||typeof WorkerGlobalScope<"u"}const Uwe=Object.freeze(Object.defineProperty({__proto__:null,isBrowser:aB,isMobile:oB,mockIsMobile:zwe},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Xi=K();Xi.registerFlag("DEBUG",()=>!1,e=>{e&&console.warn("Debugging mode is ON. The output of every math call will be downloaded to CPU and checked for NaNs. This significantly impacts performance.")});Xi.registerFlag("IS_BROWSER",()=>aB());Xi.registerFlag("IS_NODE",()=>typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u");Xi.registerFlag("IS_CHROME",()=>typeof navigator<"u"&&navigator!=null&&navigator.userAgent!=null&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor));Xi.registerFlag("IS_SAFARI",()=>typeof navigator<"u"&&navigator!=null&&navigator.userAgent!=null&&/Safari/.test(navigator.userAgent)&&/Apple/.test(navigator.vendor));Xi.registerFlag("PROD",()=>!1);Xi.registerFlag("TENSORLIKE_CHECK_SHAPE_CONSISTENCY",()=>Xi.getBool("DEBUG"));Xi.registerFlag("DEPRECATION_WARNINGS_ENABLED",()=>!0);Xi.registerFlag("IS_TEST",()=>!1);Xi.registerFlag("CHECK_COMPUTATION_FOR_ERRORS",()=>Xi.getBool("DEBUG"));Xi.registerFlag("WRAP_TO_IMAGEBITMAP",()=>!1);Xi.registerFlag("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU",()=>!1);Xi.registerFlag("USE_SETTIMEOUTCUSTOM",()=>!1);/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ru(e,t){let n=e;if(rr(e))return t==="string"?[]:[e.length];if(Mee(e)){const i=e.channels||"RGBA";return[e.height,e.width*i.length]}else if(Lee(e))return[e.buffer.size/(t==null?4:Rx(t))];if(!Array.isArray(e))return[];const r=[];for(;Array.isArray(n)||rr(n)&&t!=="string";)r.push(n.length),n=n[0];return Array.isArray(e)&&K().getBool("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&Uee(e,r,[]),r}function Uee(e,t,n){if(n=n||[],!Array.isArray(e)&&!rr(e)){N(t.length===0,()=>`Element arr[${n.join("][")}] is a primitive, but should be an array/TypedArray of ${t[0]} elements`);return}N(t.length>0,()=>`Element arr[${n.join("][")}] should be a primitive, but is an array of ${e.length} elements`),N(e.length===t[0],()=>`Element arr[${n.join("][")}] should have ${t[0]} elements, but has ${e.length} elements`);const r=t.slice(1);for(let i=0;i<e.length;++i)Uee(e[i],r,n.concat(i))}function vV(e,t,n,r){if(e!=="string_or_numeric"){if(e==null)throw new Error("Expected dtype cannot be null.");if(e!=="numeric"&&e!==t||e==="numeric"&&t==="string")throw new Error(`Argument '${n}' passed to '${r}' must be ${e} tensor, but got ${t} tensor`)}}function O(e,t,n,r="numeric"){if(e instanceof Pt)return vV(r,e.dtype,t,n),e;let i=tg(e);if(i!=="string"&&["bool","int32","float32"].indexOf(r)>=0&&(i=r),vV(r,i,t,n),e==null||!rr(e)&&!Array.isArray(e)&&typeof e!="number"&&typeof e!="boolean"&&typeof e!="string"){const u=e==null?"null":e.constructor.name;throw new Error(`Argument '${t}' passed to '${n}' must be a Tensor or TensorLike, but got '${u}'`)}const s=Ru(e,i);!rr(e)&&!Array.isArray(e)&&(e=[e]);const a=i!=="string"?Ch(e,i):Ou(e,[],!0);return z.makeTensor(a,s,i)}function jx(e,t,n,r="numeric"){if(!Array.isArray(e))throw new Error(`Argument ${t} passed to ${n} must be a \`Tensor[]\` or \`TensorLike[]\``);return e.map((s,o)=>O(s,`${t}[${o}]`,n,r))}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const jee="__op";function U(e){const t=Object.keys(e);if(t.length!==1)throw new Error(`Please provide an object with a single key (operation name) mapping to a function. Got an object with ${t.length} keys.`);let n=t[0];const r=e[n];n.endsWith("_")&&(n=n.substring(0,n.length-1)),n=n+jee;const i=(...s)=>{z.startScope(n);try{const o=r(...s);return DA(o)&&console.error("Cannot return a Promise inside of tidy."),z.endScope(o),o}catch(o){throw z.endScope(null),o}};return Object.defineProperty(i,"name",{value:n,configurable:!0}),i}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jwe(e,t){const n=O(e,"real","complex"),r=O(t,"imag","complex");Fr(n.shape,r.shape,`real and imag shapes, ${n.shape} and ${r.shape}, must match in call to tf.complex().`);const i={real:n,imag:r};return z.runKernel(PA,i)}const Rf=U({complex_:jwe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Sh(e,t,n,r){if(r==null)r=tg(e);else if(r==="complex64")throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(Lee(e)||Mee(e)){if(r!=="float32"&&r!=="int32")throw new Error(`Creating tensor from GPU data only supports 'float32'|'int32' dtype, while the dtype is ${r}.`);return z.backend.createTensorFromGPUData(e,t||n,r)}if(!rr(e)&&!Array.isArray(e)&&typeof e!="number"&&typeof e!="boolean"&&typeof e!="string")throw new Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");if(t!=null){Ps(t);const i=te(t),s=te(n);N(i===s,()=>`Based on the provided shape, [${t}], the tensor should have ${i} values but has ${s}`);for(let o=0;o<n.length;++o){const a=n[o],u=o===n.length-1?a!==te(t.slice(o)):!0;N(n[o]===t[o]||!u,()=>`Error creating a new Tensor. Inferred shape (${n}) does not match the provided shape (${t}). `)}}return!rr(e)&&!Array.isArray(e)&&(e=[e]),t=t||n,e=r!=="string"?Ch(e,r):Ou(e,[],!0),z.makeTensor(e,t,r)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Zd(e,t,n){const r=Ru(e,n);return Sh(e,t,r,n)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const GR={float32:4,float16:2,int32:4,uint16:2,uint8:1,bool:1,complex64:8};class Pa{static join(t){return new Pa(t).slice()}constructor(t){if(this.shards=[],this.previousShardIndex=0,t==null||(t instanceof Array||(t=[t]),t=t.map(r=>rr(r)?r.buffer:r),t.length===0))return;this.bufferUniformSize=t[0].byteLength;let n=0;for(let r=0;r<t.length;r++){const i=t[r];r!==t.length-1&&i.byteLength!==this.bufferUniformSize&&(this.bufferUniformSize=void 0);const s=n+i.byteLength;this.shards.push({buffer:i,start:n,end:s}),n=s}this.shards.length===0&&(this.byteLength=0),this.byteLength=this.shards[this.shards.length-1].end}slice(t=0,n=this.byteLength){if(this.shards.length===0)return new ArrayBuffer(0);if(t=isNaN(Number(t))?0:t,n=isNaN(Number(n))?0:n,t=Math.max(0,t),n=Math.min(this.byteLength,n),n<=t)return new ArrayBuffer(0);const r=this.findShardForByte(t);if(r===-1)throw new Error(`Could not find start shard for byte ${t}`);const i=n-t,s=new ArrayBuffer(i),o=new Uint8Array(s);let a=0;for(let u=r;u<this.shards.length;u++){const l=this.shards[u],f=t+a-l.start,h=a,p=Math.min(n,l.end)-l.start,g=new Uint8Array(l.buffer,f,p-f);if(o.set(g,h),a+=g.length,n<l.end)break}return s}findShardForByte(t){if(this.shards.length===0||t<0||t>=this.byteLength)return-1;if(this.bufferUniformSize!=null)return this.previousShardIndex=Math.floor(t/this.bufferUniformSize),this.previousShardIndex;function n(i){return t<i.start?-1:t>=i.end?1:0}if(n(this.shards[this.previousShardIndex])===0)return this.previousShardIndex;const r=Wwe(this.shards,n);return r===-1?-1:(this.previousShardIndex=r,this.previousShardIndex)}}function Wwe(e,t){let n=0,r=e.length;for(;n<=r;){const i=Math.floor((r-n)/2)+n,s=t(e[i]);if(s===0)return i;s<0?r=i:n=i+1}return-1}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Mk=4;async function HR(e,t){const n=[],r=[],i=Array.isArray(e)?e.map(o=>o.name):Object.keys(e);for(let o=0;o<i.length;++o){const a=i[o],u=Array.isArray(e)?e[o].tensor:e[a];if(u.dtype!=="float32"&&u.dtype!=="int32"&&u.dtype!=="bool"&&u.dtype!=="string"&&u.dtype!=="complex64")throw new Error(`Unsupported dtype in weight '${a}': ${u.dtype}`);const l={name:a,shape:u.shape,dtype:u.dtype};if(u.dtype==="string"){const c=new Promise(async f=>{const h=await u.bytes(),d=h.reduce((m,y)=>m+y.length,0)+Mk*h.length,p=new Uint8Array(d);let g=0;for(let m=0;m<h.length;m++){const y=h[m],b=new Uint8Array(new Uint32Array([y.length]).buffer);p.set(b,g),g+=Mk,p.set(y,g),g+=y.length}f(p)});r.push(c)}else r.push(u.data());t!=null&&(l.group=t),n.push(l)}const s=await Promise.all(r);return{data:Vwe(s),specs:n}}function Wee(e,t){const n=new Pa(e),r={};let i,s=0;for(const o of t){const a=o.name,u=o.dtype,l=o.shape,c=te(l);let f;if("quantization"in o){const h=o.quantization;if(h.dtype==="uint8"||h.dtype==="uint16"){if(!("min"in h&&"scale"in h))throw new Error(`Weight ${o.name} with quantization ${h.dtype} doesn't have corresponding metadata min and scale.`)}else if(h.dtype==="float16"){if(u!=="float32")throw new Error(`Weight ${o.name} is quantized with ${h.dtype} which only supports weights of type float32 not ${u}.`)}else throw new Error(`Weight ${o.name} has unknown quantization dtype ${h.dtype}. Supported quantization dtypes are: 'uint8', 'uint16', and 'float16'.`);const d=GR[h.dtype],p=n.slice(s,s+c*d),g=h.dtype==="uint8"?new Uint8Array(p):new Uint16Array(p);if(u==="float32")if(h.dtype==="uint8"||h.dtype==="uint16"){f=new Float32Array(g.length);for(let m=0;m<g.length;m++){const y=g[m];f[m]=y*h.scale+h.min}}else if(h.dtype==="float16")i===void 0&&(i=Kwe()),f=i(g);else throw new Error(`Unsupported quantization type ${h.dtype} for weight type float32.`);else if(u==="int32"){if(h.dtype!=="uint8"&&h.dtype!=="uint16")throw new Error(`Unsupported quantization type ${h.dtype} for weight type int32.`);f=new Int32Array(g.length);for(let m=0;m<g.length;m++){const y=g[m];f[m]=Math.round(y*h.scale+h.min)}}else throw new Error(`Unsupported dtype in weight '${a}': ${u}`);s+=c*d}else if(u==="string"){const h=te(o.shape);f=[];for(let d=0;d<h;d++){const p=new Uint32Array(n.slice(s,s+Mk))[0];s+=Mk;const g=new Uint8Array(n.slice(s,s+p));f.push(g),s+=p}}else{const h=GR[u],d=n.slice(s,s+c*h);if(u==="float32")f=new Float32Array(d);else if(u==="int32")f=new Int32Array(d);else if(u==="bool")f=new Uint8Array(d);else if(u==="complex64"){f=new Float32Array(d);const p=new Float32Array(f.length/2),g=new Float32Array(f.length/2);for(let b=0;b<p.length;b++)p[b]=f[b*2],g[b]=f[b*2+1];const m=Zd(p,l,"float32"),y=Zd(g,l,"float32");r[a]=Rf(m,y),m.dispose(),y.dispose()}else throw new Error(`Unsupported dtype in weight '${a}': ${u}`);s+=c*h}u!=="complex64"&&(r[a]=Zd(f,l,u))}return r}function Vwe(e){if(e===null)throw new Error(`Invalid input value: ${JSON.stringify(e)}`);let t=0;const n=[];e.forEach(s=>{if(t+=s.byteLength,n.push(s.byteLength===s.buffer.byteLength?s:new s.constructor(s)),!(s instanceof Float32Array||s instanceof Int32Array||s instanceof Uint8Array))throw new Error(`Unsupported TypedArray subtype: ${s.constructor.name}`)});const r=new Uint8Array(t);let i=0;return n.forEach(s=>{r.set(new Uint8Array(s.buffer),i),i+=s.byteLength}),r.buffer}const uB=typeof Buffer<"u"&&(typeof Blob>"u"||typeof atob>"u"||typeof btoa>"u");function wV(e){return uB?Buffer.byteLength(e,"utf8"):new Blob([e]).size}function Gwe(e){if(uB)return Buffer.from(e).toString("base64");const t=new Uint8Array(e);let n="";for(let r=0,i=t.length;r<i;r++)n+=String.fromCharCode(t[r]);return btoa(n)}function Hwe(e){if(uB){const r=Buffer.from(e,"base64");return r.buffer.slice(r.byteOffset,r.byteOffset+r.byteLength)}const t=atob(e),n=new Uint8Array(t.length);for(let r=0;r<t.length;++r)n.set([t.charCodeAt(r)],r);return n.buffer}function Vee(e){return Pa.join(e)}function $V(e){const t="/";for(e=e.trim();e.endsWith(t);)e=e.slice(0,e.length-1);const n=e.split(t);return n[n.length-1]}function Gee(e,t){const n={modelTopology:e.modelTopology,format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,weightsManifest:t};return e.signature!=null&&(n.signature=e.signature),e.userDefinedMetadata!=null&&(n.userDefinedMetadata=e.userDefinedMetadata),e.modelInitializer!=null&&(n.modelInitializer=e.modelInitializer),e.initializerSignature!=null&&(n.initializerSignature=e.initializerSignature),e.trainingConfig!=null&&(n.trainingConfig=e.trainingConfig),n}function Hee(e,t,n){const r={modelTopology:e.modelTopology,format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy};if(e.trainingConfig!=null&&(r.trainingConfig=e.trainingConfig),e.weightsManifest!=null){if(!t)throw new Error("modelJSON has weightsManifest but weightSpecs is null");if(!n)throw new Error("modelJSON has weightsManifest but weightData is null");r.weightSpecs=t,r.weightData=n}return e.signature!=null&&(r.signature=e.signature),e.userDefinedMetadata!=null&&(r.userDefinedMetadata=e.userDefinedMetadata),e.modelInitializer!=null&&(r.modelInitializer=e.modelInitializer),e.initializerSignature!=null&&(r.initializerSignature=e.initializerSignature),r}async function lB(e,t){let n,r;return e.weightsManifest!=null&&([n,r]=await t(e.weightsManifest)),Hee(e,n,r)}function Iw(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("Expected JSON model topology, received ArrayBuffer.");return{dateSaved:new Date,modelTopologyType:"JSON",modelTopologyBytes:e.modelTopology==null?0:wV(JSON.stringify(e.modelTopology)),weightSpecsBytes:e.weightSpecs==null?0:wV(JSON.stringify(e.weightSpecs)),weightDataBytes:e.weightData==null?0:new Pa(e.weightData).byteLength}}function qee(e){const t=[];for(const n of e)t.push(...n.weights);return t}function qwe(){const e=n=>{let r=n<<13,i=0;for(;!(r&8388608);)i-=8388608,r<<=1;return r&=-8388609,i+=947912704,r|i},t=new Uint32Array(2048);t[0]=0;for(let n=1;n<1024;n++)t[n]=e(n);for(let n=1024;n<2048;n++)t[n]=939524096+(n-1024<<13);return t}function Xwe(){const e=new Uint32Array(64);e[0]=0,e[31]=1199570944,e[32]=2147483648,e[63]=3347054592;for(let t=1;t<31;t++)e[t]=t<<23;for(let t=33;t<63;t++)e[t]=2147483648+(t-32<<23);return e}function Ywe(){const e=new Uint32Array(64);for(let t=0;t<64;t++)e[t]=1024;return e[0]=e[32]=0,e}function Kwe(){const e=qwe(),t=Xwe(),n=Ywe();return r=>{const i=new ArrayBuffer(4*r.length),s=new Uint32Array(i);for(let o=0;o<r.length;o++){const a=r[o],u=e[n[a>>10]+(a&1023)]+t[a>>10];s[o]=u}return new Float32Array(i)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class bn{constructor(){this.saveRouters=[],this.loadRouters=[]}static getInstance(){return bn.instance==null&&(bn.instance=new bn),bn.instance}static registerSaveRouter(t){bn.getInstance().saveRouters.push(t)}static registerLoadRouter(t){bn.getInstance().loadRouters.push(t)}static getSaveHandlers(t){return bn.getHandlers(t,"save")}static getLoadHandlers(t,n){return bn.getHandlers(t,"load",n)}static getHandlers(t,n,r){const i=[];return(n==="load"?bn.getInstance().loadRouters:bn.getInstance().saveRouters).forEach(o=>{const a=o(t,r);a!==null&&i.push(a)}),i}}const Zwe=e=>bn.registerSaveRouter(e),Jwe=e=>bn.registerLoadRouter(e),Xee=e=>bn.getSaveHandlers(e),Qwe=(e,t)=>bn.getLoadHandlers(e,t);/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qR="tensorflowjs",XR=1,Ld="models_store",nf="model_info_store";function Yee(){if(!K().getBool("IS_BROWSER"))throw new Error("Failed to obtain IndexedDB factory because the current environmentis not a web browser.");const e=typeof window>"u"?self:window,t=e.indexedDB||e.mozIndexedDB||e.webkitIndexedDB||e.msIndexedDB||e.shimIndexedDB;if(t==null)throw new Error("The current browser does not appear to support IndexedDB.");return t}function YR(e){const t=e.result;t.createObjectStore(Ld,{keyPath:"modelPath"}),t.createObjectStore(nf,{keyPath:"modelPath"})}class pp{constructor(t){if(this.indexedDB=Yee(),t==null||!t)throw new Error("For IndexedDB, modelPath must not be null, undefined or empty.");this.modelPath=t}async save(t){if(t.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");return this.databaseAction(this.modelPath,t)}async load(){return this.databaseAction(this.modelPath)}databaseAction(t,n){return new Promise((r,i)=>{const s=this.indexedDB.open(qR,XR);s.onupgradeneeded=()=>YR(s),s.onsuccess=()=>{const o=s.result;if(n==null){const a=o.transaction(Ld,"readonly"),l=a.objectStore(Ld).get(this.modelPath);l.onsuccess=()=>{if(l.result==null)return o.close(),i(new Error(`Cannot find model with path '${this.modelPath}' in IndexedDB.`));r(l.result.modelArtifacts)},l.onerror=c=>(o.close(),i(l.error)),a.oncomplete=()=>o.close()}else{n.weightData=Pa.join(n.weightData);const a=Iw(n),u=o.transaction(nf,"readwrite");let l=u.objectStore(nf),c;try{c=l.put({modelPath:this.modelPath,modelArtifactsInfo:a})}catch(h){return i(h)}let f;c.onsuccess=()=>{f=o.transaction(Ld,"readwrite");const h=f.objectStore(Ld);let d;try{d=h.put({modelPath:this.modelPath,modelArtifacts:n,modelArtifactsInfo:a})}catch(p){return i(p)}d.onsuccess=()=>r({modelArtifactsInfo:a}),d.onerror=p=>{l=u.objectStore(nf);const g=l.delete(this.modelPath);g.onsuccess=()=>(o.close(),i(d.error)),g.onerror=m=>(o.close(),i(d.error))}},c.onerror=h=>(o.close(),i(c.error)),u.oncomplete=()=>{f==null?o.close():f.oncomplete=()=>o.close()}}},s.onerror=o=>i(s.error)})}}pp.URL_SCHEME="indexeddb://";const Kee=e=>K().getBool("IS_BROWSER")&&!Array.isArray(e)&&e.startsWith(pp.URL_SCHEME)?e$e(e.slice(pp.URL_SCHEME.length)):null;bn.registerSaveRouter(Kee);bn.registerLoadRouter(Kee);function e$e(e){return new pp(e)}function t$e(e){return e.startsWith(pp.URL_SCHEME)?e.slice(pp.URL_SCHEME.length):e}class n$e{constructor(){this.indexedDB=Yee()}async listModels(){return new Promise((t,n)=>{const r=this.indexedDB.open(qR,XR);r.onupgradeneeded=()=>YR(r),r.onsuccess=()=>{const i=r.result,s=i.transaction(nf,"readonly"),a=s.objectStore(nf).getAll();a.onsuccess=()=>{const u={};for(const l of a.result)u[l.modelPath]=l.modelArtifactsInfo;t(u)},a.onerror=u=>(i.close(),n(a.error)),s.oncomplete=()=>i.close()},r.onerror=i=>n(r.error)})}async removeModel(t){return t=t$e(t),new Promise((n,r)=>{const i=this.indexedDB.open(qR,XR);i.onupgradeneeded=()=>YR(i),i.onsuccess=()=>{const s=i.result,o=s.transaction(nf,"readwrite"),a=o.objectStore(nf),u=a.get(t);let l;u.onsuccess=()=>{if(u.result==null)return s.close(),r(new Error(`Cannot find model with path '${t}' in IndexedDB.`));{const c=a.delete(t),f=()=>{l=s.transaction(Ld,"readwrite");const d=l.objectStore(Ld).delete(t);d.onsuccess=()=>n(u.result.modelArtifactsInfo),d.onerror=p=>r(u.error)};c.onsuccess=f,c.onerror=h=>(f(),s.close(),r(u.error))}},u.onerror=c=>(s.close(),r(u.error)),o.oncomplete=()=>{l==null?s.close():l.oncomplete=()=>s.close()}},i.onerror=s=>r(i.error)})}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ml="/",dm="tensorflowjs_models",Zee="info",r$e="model_topology",i$e="weight_specs",s$e="weight_data",o$e="model_metadata";function Jee(e){return{info:[dm,e,Zee].join(Ml),topology:[dm,e,r$e].join(Ml),weightSpecs:[dm,e,i$e].join(Ml),weightData:[dm,e,s$e].join(Ml),modelMetadata:[dm,e,o$e].join(Ml)}}function Qee(e){for(const t of Object.values(e))window.localStorage.removeItem(t)}function a$e(e){const t=e.split(Ml);if(t.length<3)throw new Error(`Invalid key format: ${e}`);return t.slice(1,t.length-1).join(Ml)}function u$e(e){return e.startsWith(gp.URL_SCHEME)?e.slice(gp.URL_SCHEME.length):e}class gp{constructor(t){if(!K().getBool("IS_BROWSER")||typeof window>"u"||typeof window.localStorage>"u")throw new Error("The current environment does not support local storage.");if(this.LS=window.localStorage,t==null||!t)throw new Error("For local storage, modelPath must not be null, undefined or empty.");this.modelPath=t,this.keys=Jee(this.modelPath)}async save(t){if(t.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");{const n=JSON.stringify(t.modelTopology),r=JSON.stringify(t.weightSpecs),i=Iw(t),s=Pa.join(t.weightData);try{this.LS.setItem(this.keys.info,JSON.stringify(i)),this.LS.setItem(this.keys.topology,n),this.LS.setItem(this.keys.weightSpecs,r),this.LS.setItem(this.keys.weightData,Gwe(s));const o={format:t.format,generatedBy:t.generatedBy,convertedBy:t.convertedBy,signature:t.signature!=null?t.signature:void 0,userDefinedMetadata:t.userDefinedMetadata!=null?t.userDefinedMetadata:void 0,modelInitializer:t.modelInitializer!=null?t.modelInitializer:void 0,initializerSignature:t.initializerSignature!=null?t.initializerSignature:void 0,trainingConfig:t.trainingConfig!=null?t.trainingConfig:void 0};return this.LS.setItem(this.keys.modelMetadata,JSON.stringify(o)),{modelArtifactsInfo:i}}catch{throw Qee(this.keys),new Error(`Failed to save model '${this.modelPath}' to local storage: size quota being exceeded is a possible cause of this failure: modelTopologyBytes=${i.modelTopologyBytes}, weightSpecsBytes=${i.weightSpecsBytes}, weightDataBytes=${i.weightDataBytes}.`)}}}async load(){const t=JSON.parse(this.LS.getItem(this.keys.info));if(t==null)throw new Error(`In local storage, there is no model with name '${this.modelPath}'`);if(t.modelTopologyType!=="JSON")throw new Error("BrowserLocalStorage does not support loading non-JSON model topology yet.");const n={},r=JSON.parse(this.LS.getItem(this.keys.topology));if(r==null)throw new Error(`In local storage, the topology of model '${this.modelPath}' is missing.`);n.modelTopology=r;const i=JSON.parse(this.LS.getItem(this.keys.weightSpecs));if(i==null)throw new Error(`In local storage, the weight specs of model '${this.modelPath}' are missing.`);n.weightSpecs=i;const s=this.LS.getItem(this.keys.modelMetadata);if(s!=null){const a=JSON.parse(s);n.format=a.format,n.generatedBy=a.generatedBy,n.convertedBy=a.convertedBy,a.signature!=null&&(n.signature=a.signature),a.userDefinedMetadata!=null&&(n.userDefinedMetadata=a.userDefinedMetadata),a.modelInitializer!=null&&(n.modelInitializer=a.modelInitializer),a.initializerSignature!=null&&(n.initializerSignature=a.initializerSignature),a.trainingConfig!=null&&(n.trainingConfig=a.trainingConfig)}const o=this.LS.getItem(this.keys.weightData);if(o==null)throw new Error(`In local storage, the binary weight values of model '${this.modelPath}' are missing.`);return n.weightData=Hwe(o),n}}gp.URL_SCHEME="localstorage://";const ete=e=>K().getBool("IS_BROWSER")&&!Array.isArray(e)&&e.startsWith(gp.URL_SCHEME)?l$e(e.slice(gp.URL_SCHEME.length)):null;bn.registerSaveRouter(ete);bn.registerLoadRouter(ete);function l$e(e){return new gp(e)}class c$e{constructor(){N(K().getBool("IS_BROWSER"),()=>"Current environment is not a web browser"),N(typeof window>"u"||typeof window.localStorage<"u",()=>"Current browser does not appear to support localStorage"),this.LS=window.localStorage}async listModels(){const t={},n=dm+Ml,r=Ml+Zee;for(let i=0;i<this.LS.length;++i){const s=this.LS.key(i);if(s.startsWith(n)&&s.endsWith(r)){const o=a$e(s);t[o]=JSON.parse(this.LS.getItem(s))}}return t}async removeModel(t){t=u$e(t);const n=Jee(t);if(this.LS.getItem(n.info)==null)throw new Error(`Cannot find model at path '${t}'`);const r=JSON.parse(this.LS.getItem(n.info));return Qee(n),r}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const km="://";class li{constructor(){this.managers={}}static getInstance(){return li.instance==null&&(li.instance=new li),li.instance}static registerManager(t,n){N(t!=null,()=>"scheme must not be undefined or null."),t.endsWith(km)&&(t=t.slice(0,t.indexOf(km))),N(t.length>0,()=>"scheme must not be an empty string.");const r=li.getInstance();N(r.managers[t]==null,()=>`A model store manager is already registered for scheme '${t}'.`),r.managers[t]=n}static getManager(t){const n=li.getInstance().managers[t];if(n==null)throw new Error(`Cannot find model manager for scheme '${t}'`);return n}static getSchemes(){return Object.keys(li.getInstance().managers)}}function VS(e){if(e.indexOf(km)===-1)throw new Error(`The url string provided does not contain a scheme. Supported schemes are: ${li.getSchemes().join(",")}`);return{scheme:e.split(km)[0],path:e.split(km)[1]}}async function tte(e,t,n=!1){N(e!==t,()=>`Old path and new path are the same: '${e}'`);const r=bn.getLoadHandlers(e);N(r.length>0,()=>`Copying failed because no load handler is found for source URL ${e}.`),N(r.length<2,()=>`Copying failed because more than one (${r.length}) load handlers for source URL ${e}.`);const i=r[0],s=bn.getSaveHandlers(t);N(s.length>0,()=>`Copying failed because no save handler is found for destination URL ${t}.`),N(s.length<2,()=>`Copying failed because more than one (${r.length}) save handlers for destination URL ${t}.`);const o=s[0],a=VS(e).scheme,u=VS(e).path,l=a===VS(e).scheme,c=await i.load();n&&l&&await li.getManager(a).removeModel(u);const f=await o.save(c);return n&&!l&&await li.getManager(a).removeModel(u),f.modelArtifactsInfo}async function f$e(){const e=li.getSchemes(),t={};for(const n of e){const r=await li.getManager(n).listModels();for(const i in r){const s=n+km+i;t[s]=r[i]}}return t}async function h$e(e){const t=VS(e);return li.getManager(t.scheme).removeModel(t.path)}async function d$e(e,t){return tte(e,t,!1)}async function p$e(e,t){return tte(e,t,!0)}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class g$e{constructor(){this.messageName="setTimeoutCustom",this.functionRefs=[],this.handledMessageCount=0,this.hasEventListener=!1}fetch(t,n){return fetch(t,n)}now(){return performance.now()}encode(t,n){if(n!=="utf-8"&&n!=="utf8")throw new Error(`Browser's encoder only supports utf-8, but got ${n}`);return this.textEncoder==null&&(this.textEncoder=new TextEncoder),this.textEncoder.encode(t)}decode(t,n){return new TextDecoder(n).decode(t)}setTimeoutCustom(t,n){if(typeof window>"u"||!K().getBool("USE_SETTIMEOUTCUSTOM")){setTimeout(t,n);return}this.functionRefs.push(t),setTimeout(()=>{window.postMessage({name:this.messageName,index:this.functionRefs.length-1},"*")},n),this.hasEventListener||(this.hasEventListener=!0,window.addEventListener("message",r=>{if(r.source===window&&r.data.name===this.messageName){r.stopPropagation();const i=this.functionRefs[r.data.index];i(),this.handledMessageCount++,this.handledMessageCount===this.functionRefs.length&&(this.functionRefs=[],this.handledMessageCount=0)}},!0))}isTypedArray(t){return kee(t)}}if(K().get("IS_BROWSER")){K().setPlatform("browser",new g$e);try{li.registerManager(gp.URL_SCHEME,new c$e)}catch{}try{li.registerManager(pp.URL_SCHEME,new n$e)}catch{}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const m$e={importFetch:()=>require("node-fetch")};let t3;class y$e{constructor(){this.util=require("util"),this.textEncoder=new this.util.TextEncoder}fetch(t,n){return K().global.fetch!=null?K().global.fetch(t,n):(t3==null&&(t3=m$e.importFetch()),t3(t,n))}now(){const t=process.hrtime();return t[0]*1e3+t[1]/1e6}encode(t,n){if(n!=="utf-8"&&n!=="utf8")throw new Error(`Node built-in encoder only supports utf-8, but got ${n}`);return this.textEncoder.encode(t)}decode(t,n){return t.length===0?"":new this.util.TextDecoder(n).decode(t)}isTypedArray(t){return this.util.types.isFloat32Array(t)||this.util.types.isInt32Array(t)||this.util.types.isUint8Array(t)||this.util.types.isUint8ClampedArray(t)}}K().get("IS_NODE")&&!K().get("IS_BROWSER")&&K().setPlatform("node",new y$e);/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rt(e,t="float32",n){return t=t||"float32",Ps(e),new zn(e,t,n)}/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function b$e(e,t){const n=O(e,"x","cast");if(!gee(t))throw new Error(`Failed to cast to unknown dtype ${t}`);if(t==="string"&&n.dtype!=="string"||t!=="string"&&n.dtype==="string")throw new Error("Only strings can be casted to strings");const r={x:n},i={dtype:t};return z.runKernel(Q0,r,i)}const we=U({cast_:b$e});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function x$e(e){const n={x:O(e,"x","clone","string_or_numeric")};return z.runKernel(h1,n)}const $f=U({clone_:x$e});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nte(e,t=!1){console.log(e.toString(t))}/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */zee();const v$e={buffer:rt,cast:we,clone:$f,print:nte};Nwe(v$e);/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function w$e(){K().set("PROD",!0)}function $$e(){K().set("DEBUG",!0)}function C$e(){K().set("DEPRECATION_WARNINGS_ENABLED",!1),console.warn("TensorFlow.js deprecation warnings have been disabled.")}function S$e(e){K().getBool("DEPRECATION_WARNINGS_ENABLED")&&console.warn(e+" You can disable deprecation warnings with tf.disableDeprecationWarnings().")}function k$e(){z.disposeVariables()}function aa(){return z}function Lk(){return z.memory()}function E$e(e){return z.profile(e)}function Z(e,t){return z.tidy(e,t)}function at(e){sB(e).forEach(n=>n.dispose())}function Ca(e){return z.keep(e)}function _$e(e){return z.time(e)}function A$e(e){return z.setBackend(e)}function T$e(){return z.ready()}function I$e(){return z.backendName}function D$e(e){z.removeBackend(e)}function N$e(e){return z.findBackend(e)}function F$e(e){return z.findBackendFactory(e)}function cB(e,t,n=1){return z.registerBackend(e,t,n)}function rte(){return z.backend}function O$e(e,t){K().setPlatform(e,t)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function R$e(e,t){let n=O(e,"a","add"),r=O(t,"b","add");[n,r]=$n(n,r);const i={a:n,b:r};return z.runKernel(rg,i)}const ce=U({add_:R$e});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function M$e(e,t){let n=O(e,"a","floorDiv"),r=O(t,"b","floorDiv");[n,r]=$n(n,r);const i={a:n,b:r};return z.runKernel(c1,i)}const fB=U({floorDiv_:M$e});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function L$e(e,t){let n=O(e,"a","div"),r=O(t,"b","div");if([n,r]=$n(n,r),n.dtype==="int32"&&r.dtype==="int32")return fB(n,r);const i={a:n,b:r},s={};return z.runKernel(i1,i,s)}const Re=U({div_:L$e});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function P$e(e,t){let n=O(e,"a","mul"),r=O(t,"b","mul");[n,r]=$n(n,r);const i={a:n,b:r};return z.runKernel(w1,i)}const j=U({mul_:P$e});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function B$e(e){const t=O(e,"x","abs");if(t.dtype==="complex64"){const n={x:t};return z.runKernel(R2,n)}else{const n={x:t};return z.runKernel(E2,n)}}const Gn=U({abs_:B$e});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function z$e(e){const n={x:O(e,"x","acos")};return z.runKernel(H0,n)}const ite=U({acos_:z$e});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function U$e(e){const n={x:O(e,"x","acosh")};return z.runKernel(q0,n)}const ste=U({acosh_:U$e});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function j$e(e){N(Array.isArray(e),()=>"The argument passed to tf.addN() must be a list of tensors"),N(e.length>=1,()=>`Must pass at least one tensor to tf.addN(), but got ${e.length}`);const t=e.map((i,s)=>O(i,`tensors${s}`,"addN")),n=t[0];t.forEach(i=>{if(i.dtype!==n.dtype)throw new Error("All tensors passed to tf.addN() must have the same dtype")}),t.forEach(i=>{if(!bt(i.shape,n.shape))throw new Error("All tensors passed to tf.addN() must have the same shape")});const r=t;return z.runKernel(_2,r)}const W$e=U({addN_:j$e});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function V$e(e,t=null,n=!1){const i={x:O(e,"x","all","bool")},s={axis:t,keepDims:n};return z.runKernel(NA,i,s)}const hB=U({all_:V$e});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function G$e(e,t=null,n=!1){const i={x:O(e,"x","any","bool")},s={axis:t,keepDims:n};return z.runKernel(FA,i,s)}const Pk=U({any_:G$e});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function H$e(e,t=0){const r={x:O(e,"x","argMax")},i={axis:t};return z.runKernel(A2,r,i)}const Hm=U({argMax_:H$e});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function q$e(e,t=0){const r={x:O(e,"x","argMin")},i={axis:t};return z.runKernel(T2,r,i)}const ote=U({argMin_:q$e});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function X$e(e){const n={x:O(e,"x","asin")};return z.runKernel(X0,n)}const ate=U({asin_:X$e});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Y$e(e){const n={x:O(e,"x","asinh")};return z.runKernel(Y0,n)}const ute=U({asinh_:Y$e});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function K$e(e){const n={x:O(e,"x","atan")};return z.runKernel(K0,n)}const lte=U({atan_:K$e});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Z$e(e,t){let n=O(e,"a","atan2"),r=O(t,"b","atan2");[n,r]=$n(n,r);const i={a:n,b:r};return z.runKernel(J0,i)}const cte=U({atan2_:Z$e});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function J$e(e){const n={x:O(e,"x","atanh")};return z.runKernel(Z0,n)}const fte=U({atanh_:J$e});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Dw(e,t,n,r,i="NHWC",s){const o=e[3],a=[...t,o],u=wc(i);return dr(e,a,n,s,r,null,null,u)}function Ho(e,t,n,r,i,s,o="channelsLast"){const[a,u]=Wx(t);let l;if(o==="channelsLast")l=[a,u,e[3],e[3]];else if(o==="channelsFirst")l=[a,u,e[1],e[1]];else throw new Error(`Unknown dataFormat ${o}`);return dr(e,l,n,r,i,s,!1,o)}function vc(e,t,n,r,i,s,o="NDHWC"){const[a,u,l]=KR(t);let c,f;if(o==="NDHWC")f="channelsLast",c=[a,u,l,e[4],e[4]];else if(o==="NCDHW")f="channelsFirst",c=[a,u,l,e[1],e[1]];else throw new Error(`Unknown dataFormat ${o}`);return kh(e,c,n,r,i,!1,f,s)}function dr(e,t,n,r,i,s,o=!1,a="channelsLast"){let[u,l,c,f]=[-1,-1,-1,-1];if(a==="channelsLast")[u,l,c,f]=e;else if(a==="channelsFirst")[u,f,l,c]=e;else throw new Error(`Unknown dataFormat ${a}`);const[h,d,,p]=t,[g,m]=Wx(n),[y,b]=Wx(r),v=Em(h,y),x=Em(d,b),{padInfo:w,outHeight:C,outWidth:$}=tCe(i,l,c,g,m,v,x,s,a),S=o?p*f:p;let k;return a==="channelsFirst"?k=[u,S,C,$]:a==="channelsLast"&&(k=[u,C,$,S]),{batchSize:u,dataFormat:a,inHeight:l,inWidth:c,inChannels:f,outHeight:C,outWidth:$,outChannels:S,padInfo:w,strideHeight:g,strideWidth:m,filterHeight:h,filterWidth:d,effectiveFilterHeight:v,effectiveFilterWidth:x,dilationHeight:y,dilationWidth:b,inShape:e,outShape:k,filterShape:t}}function kh(e,t,n,r,i,s=!1,o="channelsLast",a){let[u,l,c,f,h]=[-1,-1,-1,-1,-1];if(o==="channelsLast")[u,l,c,f,h]=e;else if(o==="channelsFirst")[u,h,l,c,f]=e;else throw new Error(`Unknown dataFormat ${o}`);const[d,p,g,,m]=t,[y,b,v]=KR(n),[x,w,C]=KR(r),$=Em(d,x),S=Em(p,w),k=Em(g,C),{padInfo:E,outDepth:_,outHeight:D,outWidth:A}=nCe(i,l,c,f,y,b,v,$,S,k,a),T=s?m*h:m;let I;return o==="channelsFirst"?I=[u,T,_,D,A]:o==="channelsLast"&&(I=[u,_,D,A,T]),{batchSize:u,dataFormat:o,inDepth:l,inHeight:c,inWidth:f,inChannels:h,outDepth:_,outHeight:D,outWidth:A,outChannels:T,padInfo:E,strideDepth:y,strideHeight:b,strideWidth:v,filterDepth:d,filterHeight:p,filterWidth:g,effectiveFilterDepth:$,effectiveFilterHeight:S,effectiveFilterWidth:k,dilationDepth:x,dilationHeight:w,dilationWidth:C,inShape:e,outShape:I,filterShape:t}}function Q$e(e,t,n,r,i){r==null&&(r=dB(e,t,n));const s=e[0],o=e[1],a=Vx((s-t+2*r)/n+1,i),u=Vx((o-t+2*r)/n+1,i);return[a,u]}function eCe(e,t,n,r,i,s){i==null&&(i=dB(e,t[0],r[0]));const o=[0,0,0,n];for(let a=0;a<3;a++)e[a]+2*i>=t[a]&&(o[a]=Vx((e[a]-t[a]+2*i)/r[a]+1,s));return o}function dB(e,t,n,r=1){const i=Em(t,r);return Math.floor((e[0]*(n-1)-n+i)/2)}function Wx(e){return typeof e=="number"?[e,e,e]:e.length===2?[e[0],e[1],1]:e}function KR(e){return typeof e=="number"?[e,e,e]:e}function Em(e,t){return t<=1?e:e+(e-1)*(t-1)}function tCe(e,t,n,r,i,s,o,a,u){let l,c,f;if(typeof e=="number"){l={top:e,bottom:e,left:e,right:e,type:e===0?"VALID":"NUMBER"};const d=Q$e([t,n],s,r,e,a);c=d[0],f=d[1]}else if(e==="same"){c=Math.ceil(t/r),f=Math.ceil(n/i);const h=Math.max(0,(c-1)*r+s-t),d=Math.max(0,(f-1)*i+o-n),p=Math.floor(h/2),g=h-p,m=Math.floor(d/2),y=d-m;l={top:p,bottom:g,left:m,right:y,type:"SAME"}}else if(e==="valid")l={top:0,bottom:0,left:0,right:0,type:"VALID"},c=Math.ceil((t-s+1)/r),f=Math.ceil((n-o+1)/i);else if(typeof e=="object"){const h=u==="channelsLast"?e[1][0]:e[2][0],d=u==="channelsLast"?e[1][1]:e[2][1],p=u==="channelsLast"?e[2][0]:e[3][0],g=u==="channelsLast"?e[2][1]:e[3][1];l={top:h,bottom:d,left:p,right:g,type:h===0&&d===0&&p===0&&g===0?"VALID":"EXPLICIT"},c=Vx((t-s+h+d)/r+1,a),f=Vx((n-o+p+g)/i+1,a)}else throw Error(`Unknown padding parameter: ${e}`);return{padInfo:l,outHeight:c,outWidth:f}}function nCe(e,t,n,r,i,s,o,a,u,l,c){let f,h,d,p;if(e==="valid"&&(e=0),typeof e=="number"){f={top:e,bottom:e,left:e,right:e,front:e,back:e,type:e===0?"VALID":"NUMBER"};const m=eCe([t,n,r,1],[a,u,l],1,[i,s,o],e,c);h=m[0],d=m[1],p=m[2]}else if(e==="same"){h=Math.ceil(t/i),d=Math.ceil(n/s),p=Math.ceil(r/o);const g=(h-1)*i+a-t,m=(d-1)*s+u-n,y=(p-1)*o+l-r,b=Math.floor(g/2),v=g-b,x=Math.floor(m/2),w=m-x,C=Math.floor(y/2),$=y-C;f={top:x,bottom:w,left:C,right:$,front:b,back:v,type:"SAME"}}else throw Error(`Unknown padding parameter: ${e}`);return{padInfo:f,outDepth:h,outHeight:d,outWidth:p}}function Vx(e,t){if(!t)return Math.trunc(e);switch(t){case"round":return Math.round(e);case"ceil":return Math.ceil(e);case"floor":return Math.floor(e);default:throw new Error(`Unknown roundingMode ${t}`)}}function Mf(e){const[t,n,r]=Wx(e);return t===1&&n===1&&r===1}function Or(e,t){return Mf(e)||Mf(t)}function mp(e){return Wx(e).every(t=>t>0)}function wc(e){if(e==="NHWC")return"channelsLast";if(e==="NCHW")return"channelsFirst";throw new Error(`Unknown dataFormat ${e}`)}function Di(e,t,n){if(n!=null){if(typeof t=="string")throw Error(`Error in ${e}: pad must be an integer when using dimRoundingMode ${n} but got pad ${t}.`);if(typeof t=="number")N(dp(t),()=>`Error in ${e}: pad must be an integer when using dimRoundingMode ${n} but got pad ${t}.`);else if(typeof t=="object")t.forEach(r=>{r.forEach(i=>{N(dp(i),()=>`Error in ${e}: pad must be an integer when using dimRoundingMode ${n} but got pad ${i}.`)})});else throw Error(`Error in ${e}: Unknown padding parameter: ${t}`)}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rCe(e,t){const r={x:O(e,"x","reshape","string_or_numeric")},i={shape:t};return z.runKernel(gw,r,i)}const V=U({reshape_:rCe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function iCe(e,t,n,r,i){const s=O(e,"x","avgPool","float32"),o=1;N(Or(n,o),()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${n} and dilations '${o}'`);let a=s,u=!1;s.rank===3&&(u=!0,a=V(s,[1,s.shape[0],s.shape[1],s.shape[2]])),N(a.rank===4,()=>`Error in avgPool: x must be rank 4 but got rank ${a.rank}.`),Di("avgPool",r,i);const l={x:a},c={filterSize:t,strides:n,pad:r,dimRoundingMode:i};let f=z.runKernel(I2,l,c);return f=we(f,s.dtype),u?V(f,[f.shape[1],f.shape[2],f.shape[3]]):f}const BT=U({avgPool_:iCe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sCe(e,t,n,r,i,s="NDHWC"){const o=O(e,"x","avgPool3d","float32");let a=o,u=!1;o.rank===4&&(u=!0,a=V(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]])),N(a.rank===5,()=>`Error in avgPool3d: x must be rank 5 but got rank ${a.rank}.`),N(s==="NDHWC",()=>`Error in avgPool3d: Only NDHWC is currently supported, but got dataFormat of ${s}`),N(typeof n=="number"&&n>0||Array.isArray(n)&&n[0]>0&&n[1]>0&&n[2]>0,()=>`Error in avgPool3d: Stride must be > 0, but got '${n}'`),Di("avgPool3d",r,i);const l={x:a},c={filterSize:t,strides:n,pad:r,dimRoundingMode:i,dataFormat:s};let f=z.runKernel(D2,l,c);return f=we(f,a.dtype),u?V(f,[f.shape[1],f.shape[2],f.shape[3],f.shape[4]]):f}const hte=U({avgPool3d_:sCe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function oCe(e,t=0){N(e.length>=1,()=>"Pass at least one tensor to concat");const n=jx(e,"tensors","concat","string_or_numeric");if(n[0].dtype==="complex64"&&n.forEach(s=>{if(s.dtype!=="complex64")throw new Error(`Cannot concatenate complex64 tensors with a tensor
          with dtype ${s.dtype}. `)}),n.length===1)return $f(n[0]);const r=n,i={axis:t};return z.runKernel(M2,r,i)}const lr=U({concat_:oCe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function aCe(e,t,n=!1,r=!1){let i=O(e,"a","matMul"),s=O(t,"b","matMul");[i,s]=$n(i,s);const o={a:i,b:s},a={transposeA:n,transposeB:r};return z.runKernel(N2,o,a)}const ot=U({matMul_:aCe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uCe(e){const n={x:O(e,"x","sigmoid","float32")};return z.runKernel(N1,n)}const $u=U({sigmoid_:uCe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lCe(e,t,n){const r=O(e,"x","slice","string_or_numeric");if(r.rank===0)throw new Error("Slicing scalar is not possible");const i={x:r},s={begin:t,size:n};return z.runKernel(vw,i,s)}const wt=U({slice_:lCe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cCe(e){const n={x:O(e,"x","tanh","float32")};return z.runKernel(P1,n)}const qm=U({tanh_:cCe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fCe(e,t,n,r,i,s){const o=O(e,"forgetBias","basicLSTMCell"),a=O(t,"lstmKernel","basicLSTMCell"),u=O(n,"lstmBias","basicLSTMCell"),l=O(r,"data","basicLSTMCell"),c=O(i,"c","basicLSTMCell"),f=O(s,"h","basicLSTMCell"),h=lr([l,f],1),d=ot(h,a),p=ce(d,u),g=p.shape[0],m=p.shape[1]/4,y=[g,m],b=wt(p,[0,0],y),v=wt(p,[0,m],y),x=wt(p,[0,m*2],y),w=wt(p,[0,m*3],y),C=ce(j($u(b),qm(v)),j(c,$u(ce(o,x)))),$=j(qm(C),$u(w));return[C,$]}const hCe=U({basicLSTMCell_:fCe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dCe(e,t,n){const r=O(e,"x","batchToSpaceND"),i=t.reduce((a,u)=>a*u);N(r.rank>=1+t.length,()=>`input rank is ${r.rank} but should be > than blockShape.length ${t.length}`),N(n.length===t.length,()=>`crops.length is ${n.length} but should be equal to blockShape.length  ${t.length}`),N(r.shape[0]%i===0,()=>`input tensor batch is ${r.shape[0]} but is not divisible by the product of the elements of blockShape ${t.join(" * ")} === ${i}`);const s={x:r},o={blockShape:t,crops:n};return z.runKernel(F2,s,o)}const zT=U({batchToSpaceND_:dCe});function pCe(e){let t;return e.rank===0||e.rank===1?t=V(e,[1,1,1,e.size]):e.rank===2?t=V(e,[1,1,e.shape[0],e.shape[1]]):e.rank===3?t=V(e,[1,e.shape[0],e.shape[1],e.shape[2]]):t=e,t}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gCe(e,t,n,r,i,s){s==null&&(s=.001);const o=O(e,"x","batchNorm"),a=O(t,"mean","batchNorm"),u=O(n,"variance","batchNorm");let l;i!=null&&(l=O(i,"scale","batchNorm"));let c;r!=null&&(c=O(r,"offset","batchNorm")),N(a.rank===u.rank,()=>"Batch normalization gradient requires mean and variance to have equal ranks."),N(c==null||a.rank===c.rank,()=>"Batch normalization gradient requires mean and offset to have equal ranks."),N(l==null||a.rank===l.rank,()=>"Batch normalization gradient requires mean and scale to have equal ranks.");const h={x:pCe(o),scale:l,offset:c,mean:a,variance:u},d={varianceEpsilon:s},p=z.runKernel(G2,h,d);return V(p,o.shape)}const Nw=U({batchNorm_:gCe});function mCe(e,t,n,r,i,s){const o=O(e,"x","batchNorm"),a=O(t,"mean","batchNorm"),u=O(n,"variance","batchNorm");let l;i!=null&&(l=O(i,"scale","batchNorm"));let c;return r!=null&&(c=O(r,"offset","batchNorm")),N(o.rank===2,()=>`Error in batchNorm2D: x must be rank 2 but got rank ${o.rank}.`),N(a.rank===2||a.rank===1,()=>`Error in batchNorm2D: mean must be rank 2 or rank 1 but got rank ${a.rank}.`),N(u.rank===2||u.rank===1,()=>`Error in batchNorm2D: variance must be rank 2 or rank 1 but got rank ${u.rank}.`),l!=null&&N(l.rank===2||l.rank===1,()=>`Error in batchNorm2D: scale must be rank 2 or rank 1 but got rank ${l.rank}.`),c!=null&&N(c.rank===2||c.rank===1,()=>`Error in batchNorm2D: offset must be rank 2 or rank 1 but got rank ${c.rank}.`),Nw(o,a,u,c,l,s)}const dte=U({batchNorm2d_:mCe});function yCe(e,t,n,r,i,s){const o=O(e,"x","batchNorm"),a=O(t,"mean","batchNorm"),u=O(n,"variance","batchNorm");let l;i!=null&&(l=O(i,"scale","batchNorm"));let c;return r!=null&&(c=O(r,"offset","batchNorm")),N(o.rank===3,()=>`Error in batchNorm3D: x must be rank 3 but got rank ${o.rank}.`),N(a.rank===3||a.rank===1,()=>`Error in batchNorm3D: mean must be rank 3 or rank 1 but got rank ${a.rank}.`),N(u.rank===3||u.rank===1,()=>`Error in batchNorm3D: variance must be rank 3 or rank 1 but got rank ${u.rank}.`),l!=null&&N(l.rank===3||l.rank===1,()=>`Error in batchNorm3D: scale must be rank 3 or rank 1 but got rank ${l.rank}.`),c!=null&&N(c.rank===3||c.rank===1,()=>`Error in batchNorm3D: offset must be rank 3 or rank 1 but got rank ${c.rank}.`),Nw(o,a,u,c,l,s)}const pte=U({batchNorm3d_:yCe});function bCe(e,t,n,r,i,s){const o=O(e,"x","batchNorm"),a=O(t,"mean","batchNorm"),u=O(n,"variance","batchNorm");let l;i!=null&&(l=O(i,"scale","batchNorm"));let c;return r!=null&&(c=O(r,"offset","batchNorm")),N(o.rank===4,()=>`Error in batchNorm4D: x must be rank 4 but got rank ${o.rank}.`),N(a.rank===4||a.rank===1,()=>`Error in batchNorm4D: mean must be rank 4 or rank 1 but got rank ${a.rank}.`),N(u.rank===4||u.rank===1,()=>`Error in batchNorm4D: variance must be rank 4 or rank 1 but got rank ${u.rank}.`),l!=null&&N(l.rank===4||l.rank===1,()=>`Error in batchNorm4D: scale must be rank 4 or rank 1 but got rank ${l.rank}.`),c!=null&&N(c.rank===4||c.rank===1,()=>`Error in batchNorm4D: offset must be rank 4 or rank 1 but got rank ${c.rank}.`),Nw(o,a,u,c,l,s)}const gte=U({batchNorm4d_:bCe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xCe(e,t,n){const r=O(e,"x","bincount"),i=O(t,"weights","bincount");N(r.dtype==="int32",()=>`Error in bincount: input dtype must be int32, but got ${r.dtype}`),N(n>=0,()=>`size must be non-negative, but got ${n}.`),N(i.size===r.size||i.size===0,()=>`Error in bincount: weights must have the same size as input or0-length, but got input shape: ${r.shape}, weights shape: ${i.shape}.`);const s={x:r,weights:i},o={size:n};return z.runKernel(MA,s,o)}const mte=U({bincount_:xCe});/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vCe(e,t){const n=O(e,"x","bitwiseAnd"),r=O(t,"y","bitwiseAnd");if(!bt(n.shape,r.shape))throw new Error(`BitwiseAnd: Tensors must have the same shape. x: ${n.shape}, y: ${r.shape}`);if(n.dtype!=="int32"||r.dtype!=="int32")throw new Error(`BitwiseAnd: Only supports 'int32' values in tensor, found type of x: ${n.dtype} and type of y: ${r.dtype}`);const i={a:n,b:r};return z.runKernel(O2,i)}const wCe=U({bitwiseAnd_:vCe});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $Ce(e,t){const n=O(e,"s0","broadcastArgs","int32"),r=O(t,"s1","broadcastArgs","int32");if(n.rank!==1)throw new Error(`broadcastArgs(): first input must be a vector (rank=1). Has rank ${n.rank}`);if(r.rank!==1)throw new Error(`broadcastArgs(): second input must be a vector (rank=1). Has rank ${r.rank}`);const i={s0:n,s1:r};return z.runKernel(LA,i)}const CCe=U({broadcastArgs_:$Ce});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function SCe(e,t){let n=O(e,"broadcastTo","x");const r=n.shape;if(Ps(t),t.length<n.rank)throw new Error(`broadcastTo(): shape.length=${t.length} < input.rank=${n.rank}.`);if(t.length>n.rank){const l=n.shape.slice();for(;l.length<t.length;)l.unshift(1);n=V(n,l)}const i=n.shape,s=Array.from(t);for(let l=t.length-1;l>=0;l--)if(i[l]===t[l])s[l]=1;else if(n.shape[l]!==1)throw new Error(`broadcastTo(): [${r}] cannot be broadcast to [${t}].`);if(s.map((l,c)=>l>1?c:-1).filter(l=>l>=0).length===0)return $f(n);const a={x:n},u={reps:s};return z.runKernel(B1,a,u)}const _m=U({broadcastTo_:SCe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kCe(e){const n={x:O(e,"x","ceil","float32")};return z.runKernel(e1,n)}const yte=U({ceil_:kCe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function U1(e,t,n){Ps(e),n=n||tg(t);const r={shape:e,value:t,dtype:n};return z.runKernel(QA,{},r)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ECe(e,t,n){const r=O(e,"x","clipByValue");if(N(t<=n,()=>`Error in clip: min (${t}) must be less than or equal to max (${n}).`),t===n)return U1(r.shape,t,r.dtype);const i={x:r},s={clipValueMin:t,clipValueMax:n};return z.runKernel(t1,i,s)}const _s=U({clipByValue_:ECe});function _Ce(e){return lr(e,0)}const bte=U({concat1d_:_Ce});function ACe(e,t){return lr(e,t)}const xte=U({concat2d_:ACe});function TCe(e,t){return lr(e,t)}const vte=U({concat3d_:TCe});function ICe(e,t){return lr(e,t)}const wte=U({concat4d_:ICe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function DCe(e,t,n,r,i="NHWC",s=[1,1],o){const a=O(e,"x","conv2d","float32"),u=O(t,"filter","conv2d","float32");let l=a,c=!1;a.rank===3&&(c=!0,l=V(a,[1,a.shape[0],a.shape[1],a.shape[2]])),N(l.rank===4,()=>`Error in conv2d: input must be rank 4, but got rank ${l.rank}.`),N(u.rank===4,()=>`Error in conv2d: filter must be rank 4, but got rank ${u.rank}.`),Di("conv2d",r,o);const f=i==="NHWC"?l.shape[3]:l.shape[1];N(f===u.shape[2],()=>`Error in conv2d: depth of input (${f}) must match input depth for filter ${u.shape[2]}.`),N(Or(n,s),()=>`Error in conv2D: Either strides or dilations must be 1. Got strides ${n} and dilations '${s}'`),N(mp(s),()=>"Error in conv2D: Dilated rates should be larger than 0."),N(mp(n),()=>"Error in conv2D: Strides should be larger than 0.");const h={x:l,filter:u},d={strides:n,pad:r,dataFormat:i,dilations:s,dimRoundingMode:o},p=z.runKernel(L2,h,d);return c?V(p,[p.shape[1],p.shape[2],p.shape[3]]):p}const Lf=U({conv2d_:DCe});function NCe(e,t,n,r,i="NWC",s=1,o){const a=O(e,"x","conv1d"),u=O(t,"filter","conv1d");let l=a,c=!1;a.rank===2&&(c=!0,l=V(a,[1,a.shape[0],a.shape[1]])),N(l.rank===3,()=>`Error in conv1d: input must be rank 3, but got rank ${l.rank}.`),N(u.rank===3,()=>`Error in conv1d: filter must be rank 3, but got rank ${u.rank}.`),Di("conv1d",r,o),N(l.shape[2]===u.shape[1],()=>`Error in conv1d: depth of input (${l.shape[2]}) must match input depth for filter ${u.shape[1]}.`),N(Or(n,s),()=>`Error in conv1D: Either stride or dilation must be 1. Got stride ${n} and dilation '${s}'`),N(mp(s),()=>"Error in conv1D: Dilated rates should be larger than 0."),N(mp(n),()=>"Error in conv1D: Stride should be larger than 0."),N(i==="NWC",()=>`Error in conv1d: got dataFormat of ${i} but only NWC is currently supported.`);const f=V(u,[1,u.shape[0],u.shape[1],u.shape[2]]),h=V(l,[l.shape[0],1,l.shape[1],l.shape[2]]),m=Lf(h,f,[1,n],r,"NHWC",[1,s],o);return c?V(m,[m.shape[2],m.shape[3]]):V(m,[m.shape[0],m.shape[2],m.shape[3]])}const pB=U({conv1d_:NCe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function FCe(e,t,n,r,i,s="NHWC",o){N(e.length===t.rank,()=>`Length of inShape (${e.length}) and rank of dy (${t.rank}) must match`);let a=e,u=t,l=!1;t.rank===3&&(l=!0,u=V(t,[1,t.shape[0],t.shape[1],t.shape[2]]),a=[1,e[0],e[1],e[2]]),N(a.length===4,()=>`Error in conv2dDerInput: inShape must be length 4, but got length ${a.length}.`),N(u.rank===4,()=>`Error in conv2dDerInput: dy must be rank 4, but got rank ${u.rank}`),N(n.rank===4,()=>`Error in conv2dDerInput: filter must be rank 4, but got rank ${n.rank}`);const c=s==="NHWC"?a[3]:a[1],f=s==="NHWC"?u.shape[3]:u.shape[1];N(c===n.shape[2],()=>`Error in conv2dDerInput: depth of input (${c}) must match input depth for filter ${n.shape[2]}.`),N(f===n.shape[3],()=>`Error in conv2dDerInput: depth of output (${f}) must match output depth for filter ${n.shape[3]}.`),Di("conv2dDerInput",i,o);const h={dy:u,filter:n},d={strides:r,pad:i,dataFormat:s,dimRoundingMode:o,inputShape:a},p=z.runKernel(P2,h,d);return l?V(p,[p.shape[1],p.shape[2],p.shape[3]]):p}const gB=U({conv2DBackpropInput_:FCe});function OCe(e,t,n,r,i,s){const o=O(e,"x","conv2dTranspose"),a=O(t,"filter","conv2dTranspose");return gB(n,o,a,r,i,"NHWC",s)}const mB=U({conv2dTranspose_:OCe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function RCe(e,t,n,r,i="NDHWC",s=[1,1,1]){const o=O(e,"x","conv3d"),a=O(t,"filter","conv3d");let u=o,l=!1;o.rank===4&&(l=!0,u=V(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]])),N(u.rank===5,()=>`Error in conv3d: input must be rank 5, but got rank ${u.rank}.`),N(a.rank===5,()=>`Error in conv3d: filter must be rank 5, but got rank ${a.rank}.`),N(u.shape[4]===a.shape[3],()=>`Error in conv3d: depth of input (${u.shape[4]}) must match input depth for filter ${a.shape[3]}.`),N(Or(n,s),()=>`Error in conv3D: Either strides or dilations must be 1. Got strides ${n} and dilations '${s}'`),N(i==="NDHWC",()=>`Error in conv3d: got dataFormat of ${i} but only NDHWC is currently supported.`),N(mp(s),()=>"Error in conv3D: Dilated rates should be larger than 0."),N(mp(n),()=>"Error in conv3D: Strides should be larger than 0.");const c={x:u,filter:a},f={strides:n,pad:r,dataFormat:i,dilations:s},h=z.runKernel(B2,c,f);return l?V(h,[h.shape[1],h.shape[2],h.shape[3],h.shape[4]]):h}const $te=U({conv3d_:RCe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function MCe(e,t,n,r,i){N(e.length===t.rank,()=>`Length of inShape (${e.length}) and rank of dy (${t.rank}) must match`);let s=e,o=t,a=!1;t.rank===4&&(a=!0,o=V(t,[1,t.shape[0],t.shape[1],t.shape[2],t.shape[3]]),s=[1,e[0],e[1],e[2],e[3]]);const u=s[4],l=o.shape[4];N(s.length===5,()=>`Error in conv3dDerInput: inShape must be length 5, but got length ${s.length}.`),N(o.rank===5,()=>`Error in conv3dDerInput: dy must be rank 5, but got rank ${o.rank}`),N(n.rank===5,()=>`Error in conv3dDerInput: filter must be rank 5, but got rank ${n.rank}`),N(u===n.shape[3],()=>`Error in conv3dDerInput: depth of input (${u}) must match input depth for filter ${n.shape[3]}.`),N(l===n.shape[4],()=>`Error in conv3dDerInput: depth of output (${l}) must match output depth for filter ${n.shape[4]}.`);const c={dy:o,filter:n},f={pad:i,strides:r,inputShape:s},h=z.runKernel(UA,c,f);return a?V(h,[h.shape[1],h.shape[2],h.shape[3],h.shape[4]]):h}const Cte=U({conv3DBackpropInput_:MCe});function LCe(e,t,n,r,i){const s=O(e,"x","conv3dTranspose"),o=O(t,"filter","conv3dTranspose");return Cte(n,s,o,r,i)}const Ste=U({conv3dTranspose_:LCe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function PCe(e){const n={x:O(e,"x","cos","float32")};return z.runKernel(n1,n)}const UT=U({cos_:PCe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function BCe(e){const n={x:O(e,"x","cosh","float32")};return z.runKernel(r1,n)}const yB=U({cosh_:BCe});/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zCe(e,t=0,n=!1,r=!1){const s={x:O(e,"x","cumprod")},o={axis:t,exclusive:n,reverse:r};return z.runKernel(jA,s,o)}const Bk=U({cumprod_:zCe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function UCe(e,t=0,n=!1,r=!1){const s={x:O(e,"x","cumsum")},o={axis:t,exclusive:n,reverse:r};return z.runKernel(z2,s,o)}const bB=U({cumsum_:UCe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jCe(e,t,n,r=!1){const i=O(e,"x","denseBincount"),s=O(t,"weights","denseBincount");N(i.dtype==="int32",()=>`Error in denseBincount: input dtype must be int32, but got ${i.dtype}`),N(i.rank<=2,()=>`Error in denseBincount: input must be at most rank 2, but got rank ${i.rank}.`),N(n>=0,()=>`size must be non-negative, but got ${n}.`),N(s.size===i.size||s.size===0,()=>`Error in denseBincount: weights must have the same shape as x or 0-length, but got x shape: ${i.shape}, weights shape: ${s.shape}.`);const o={x:i,weights:s},a={size:n,binaryOutput:r};return z.runKernel(VA,o,a)}const ZR=U({denseBincount_:jCe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function WCe(e,t,n="NHWC"){const r=O(e,"x","depthToSpace","float32"),i=n==="NHWC"?r.shape[1]:r.shape[2],s=n==="NHWC"?r.shape[2]:r.shape[3],o=n==="NHWC"?r.shape[3]:r.shape[1];N(t>1,()=>`blockSize should be > 1 for depthToSpace, but was: ${t}`),N(i*t>=0,()=>`Negative dimension size caused by overflow when multiplying
    ${i} and ${t}  for depthToSpace with input shape
    ${r.shape}`),N(s*t>=0,()=>`Negative dimension size caused by overflow when multiplying
    ${s} and ${t} for depthToSpace with input shape
        ${r.shape}`),N(o%(t*t)===0,()=>`Dimension size must be evenly divisible by ${t*t} but is ${o} for depthToSpace with input shape ${r.shape}`);const a={x:r},u={blockSize:t,dataFormat:n};return z.runKernel(GA,a,u)}const kte=U({depthToSpace_:WCe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function VCe(e,t,n,r,i="NHWC",s=[1,1],o){const a=O(e,"x","depthwiseConv2d","float32"),u=O(t,"filter","depthwiseConv2d","float32");let l=a,c=!1;a.rank===3&&(c=!0,l=V(a,[1,a.shape[0],a.shape[1],a.shape[2]])),N(l.rank===4,()=>`Error in depthwiseConv2d: input must be rank 4, but got rank ${l.rank}.`),N(u.rank===4,()=>`Error in depthwiseConv2d: filter must be rank 4, but got rank ${u.rank}.`);const f=i==="NHWC"?l.shape[3]:l.shape[1];N(f===u.shape[2],()=>`Error in depthwiseConv2d: number of input channels (${f}) must match the inChannels dimension in filter ${u.shape[2]}.`),Di("depthwiseConv2d",r,o);const h={x:l,filter:u},d={strides:n,pad:r,dataFormat:i,dilations:s,dimRoundingMode:o},p=z.runKernel(U2,h,d);return c?V(p,[p.shape[1],p.shape[2],p.shape[3]]):p}const Fw=U({depthwiseConv2d_:VCe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function GCe(e){const n={x:O(e,"x","diag")};return z.runKernel(XA,n)}const HCe=U({diag_:GCe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qCe(e,t,n,r,i=[1,1],s="NHWC"){const o=O(e,"x","dilation2d"),a=O(t,"filter","dilation2d");N(o.rank===3||o.rank===4,()=>`Error in dilation2d: input must be rank 3 or 4, but got rank ${o.rank}.`),N(a.rank===3,()=>`Error in dilation2d: filter must be rank 3, but got rank ${a.rank}.`),N(s==="NHWC",()=>`Error in dilation2d: Only NHWC is currently supported, but got dataFormat of ${s}`);let u=o,l=!1;o.rank===3&&(u=V(o,[1,o.shape[0],o.shape[1],o.shape[2]]),l=!0),N(u.shape[3]===a.shape[2],()=>`Error in dilation2d:  input and filter must have the same depth: ${u.shape[3]} vs ${a.shape[2]}`);const c={x:u,filter:a},f={strides:n,pad:r,dilations:i},h=z.runKernel(j2,c,f);return l?V(h,[h.shape[1],h.shape[2],h.shape[3]]):h}const Ete=U({dilation2d_:qCe});/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yp(e,t){const n=e.length,r=[];for(let i=0;i<n;i++){const s=n-1-i,o=e[s]||1;(t[t.length-1-i]||1)>1&&o===1&&r.unshift(s)}return r}function Un(e,t){const n=[];for(let r=0;r<t.length;r++){const i=e[e.length-r-1],s=t.length-r-1,o=t[s];(i==null||i===1&&o>1)&&n.unshift(s)}return n}function Ze(e,t){const n=Math.max(e.length,t.length),r=new Array(n);for(let i=0;i<n;i++){let s=e[e.length-i-1];s==null&&(s=1);let o=t[t.length-i-1];if(o==null&&(o=1),s===1)r[n-i-1]=o;else if(o===1)r[n-i-1]=s;else if(s!==o){const a=`Operands could not be broadcast together with shapes ${e} and ${t}.`;throw Error(a)}else r[n-i-1]=s}return r}const XCe=Object.freeze(Object.defineProperty({__proto__:null,assertAndGetBroadcastShape:Ze,getBroadcastDims:yp,getReductionAxes:Un},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function YCe(e,t){let n=O(e,"a","equal","string_or_numeric"),r=O(t,"b","equal","string_or_numeric");[n,r]=$n(n,r),Ze(n.shape,r.shape);const i={a:n,b:r};return z.runKernel(W2,i)}const Ia=U({equal_:YCe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function KCe(e,t,n){const r=O(t,"a","where"),i=O(n,"b","where"),s=O(e,"condition","where","bool"),o=Ze(Ze(s.shape,r.shape),i.shape),a=_m(s,o),u=_m(r,o),l=_m(i,o),c={condition:a,t:u,e:l};return z.runKernel(xw,c)}const Xr=U({where_:KCe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ZCe(e){const n={x:O(e,"x","zerosLike")};return z.runKernel(Aw,n)}const xt=U({zerosLike_:ZCe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function JCe(e,t){let n=O(e,"a","div"),r=O(t,"b","div");[n,r]=$n(n,r);const i=Re(n,r),s=xt(i),o=Ia(r,s);return Xr(o,s,i)}const _te=U({divNoNan_:JCe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function QCe(e,t){const n=O(e,"t1","dot"),r=O(t,"t2","dot");N((n.rank===1||n.rank===2)&&(r.rank===1||r.rank===2),()=>`Error in dot: inputs must all be rank 1 or 2, but got ranks ${n.rank} and ${r.rank}.`);const i=n.rank===1?n.size:n.shape[1],s=r.rank===1?r.size:r.shape[0];if(N(i===s,()=>`Error in dot: inner dimensions of inputs must match, but got ${i} and ${s}.`),n.rank===1&&r.rank===1){const o=V(n,[1,-1]),a=V(r,[-1,1]),u=ot(o,a);return V(u,[])}else if(n.rank===1&&r.rank===2){const o=V(n,[1,-1]),a=V(r,[r.shape[0],r.shape[1]]),u=ot(o,a);return V(u,[u.size])}else if(n.rank===2&&r.rank===1){const o=V(r,[-1,1]),a=ot(n,o);return V(a,[a.size])}else{const o=V(r,[r.shape[0],r.shape[1]]);return ot(n,o)}}const Ate=U({dot_:QCe});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function eSe(e,...t){const n=t.map((i,s)=>O(i,`tensors${s}`,"einsum")),r={equation:e};return z.runKernel(KA,n,r)}const pm=U({einsum_:eSe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tSe(e){const n={x:O(e,"x","elu","float32")};return z.runKernel(s1,n)}const Ow=U({elu_:tSe});/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nSe(e,t){const n=O(e,"x","ensureShape","string_or_numeric");if(!dee(n.shape,t))throw new Error(`EnsureShape: Shape of tensor ${n.shape} is not compatible with expected shape ${t}`);return e}const rSe=U({ensureShape_:nSe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function iSe(e){let t=O(e,"x","erf");N(t.dtype==="int32"||t.dtype==="float32",()=>"Input dtype must be `int32` or `float32`."),t.dtype==="int32"&&(t=we(t,"float32"));const n={x:t};return z.runKernel(o1,n)}const Tte=U({erf_:iSe});/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xB(e,t){for(let n=0;n<e.length;++n)if(e[e.length-n-1]!==t-1-n)return!1;return!0}function Ite(e,t,n){const r=e.length+t.length,i=[];let s=0,o=0;for(let a=0;a<r;a++)n.indexOf(a)===-1?i.push(e[s++]):i.push(t[o++]);return i}function pr(e,t){const n=[],r=e.length;for(let s=0;s<r;s++)t.indexOf(s)===-1&&n.push(e[s]);const i=t.map(s=>e[s]);return[n,i]}function Fn(e,t){const n=t.map(r=>1);return Ite(e,n,t)}function Rr(e,t,n){N(xB(t,n),()=>`${e} supports only inner-most axes for now. Got axes ${t} and rank-${n} input.`)}function Cn(e,t){if(xB(e,t))return null;const n=[];for(let r=0;r<t;++r)e.indexOf(r)===-1&&n.push(r);return e.forEach(r=>n.push(r)),n}function Eh(e){return e.map((t,n)=>[n,t]).sort((t,n)=>t[1]-n[1]).map(t=>t[0])}function On(e,t){const n=[];for(let r=t-e;r<t;++r)n.push(r);return n}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sSe(e,t=null,n=!1){const i={x:O(e,"x","max")},s={reductionIndices:t,keepDims:n};return z.runKernel(tw,i,s)}const Oo=U({max_:sSe});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function oSe(e,t=null,n=!1){const i={x:O(e,"x","min")},s={axis:t,keepDims:n};return z.runKernel(sw,i,s)}const Gx=U({min_:oSe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function aSe(e,t){let n=O(e,"base","pow"),r=O(t,"exp","pow");[n,r]=$n(n,r);const i={a:n,b:r};return z.runKernel($1,i)}const Pf=U({pow_:aSe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qe(e,t){if((rr(e)&&t!=="string"||Array.isArray(e))&&t!=="complex64")throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");if(t==="string"&&rr(e)&&!(e instanceof Uint8Array))throw new Error("When making a scalar from encoded string, the value must be `Uint8Array`.");return Sh(e,[],[],t)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uSe(e){const n={x:O(e,"x","sqrt","float32")};return z.runKernel(O1,n)}const Kr=U({sqrt_:uSe});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lSe(e){const t=O(e,"x","square"),n={};return z.runKernel("Square",{x:t},n)}const Xt=U({square_:lSe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cSe(e,t=null,n=!1){let r=O(e,"x","sum");r.dtype==="bool"&&(r=we(r,"int32"));const i={x:r},s={axis:t,keepDims:n};return z.runKernel(ww,i,s)}const Ae=U({sum_:cSe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fSe(e,t="euclidean",n=null,r=!1){e=O(e,"x","norm");const i=Dte(e,t,n);let s=i.shape;if(r){const o=st(n,e.shape);s=Fn(i.shape,o)}return V(i,s)}function Dte(e,t,n=null){if(e.rank===0)return Gn(e);if(e.rank!==1&&n===null)return Dte(V(e,[-1]),t,n);if(e.rank===1||typeof n=="number"||Array.isArray(n)&&n.length===1){if(t===1)return Ae(Gn(e),n);if(t===1/0)return Oo(Gn(e),n);if(t===-1/0)return Gx(Gn(e),n);if(t==="euclidean"||t===2)return Kr(Ae(Pf(Gn(e),qe(2,"int32")),n));throw new Error(`Error in norm: invalid ord value: ${t}`)}if(Array.isArray(n)&&n.length===2){if(t===1)return Oo(Ae(Gn(e),n[0]),n[1]-1);if(t===1/0)return Oo(Ae(Gn(e),n[1]),n[0]);if(t===-1/0)return Gx(Ae(Gn(e),n[1]),n[0]);if(t==="fro"||t==="euclidean")return Kr(Ae(Xt(e),n));throw new Error(`Error in norm: invalid ord value: ${t}`)}throw new Error(`Error in norm: invalid axis: ${n}`)}const Rw=U({norm_:fSe});/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hSe(e,t=null,n=!1){return Rw(e,"euclidean",t,n)}const Nte=U({euclideanNorm_:hSe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dSe(e){const n={x:O(e,"x","exp")};return z.runKernel(a1,n)}const no=U({exp_:dSe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pSe(e,t=0){const n=O(e,"x","expandDims","string_or_numeric");N(t<=n.rank,()=>"Axis must be <= rank of the tensor");const r={input:n},i={dim:t};return z.runKernel(V2,r,i)}const hi=U({expandDims_:pSe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gSe(e){const n={x:O(e,"x","expm1")};return z.runKernel(u1,n)}const Fte=U({expm1_:gSe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mSe(e,t){const n=O(e,"x","tile","string_or_numeric");N(n.rank===t.length,()=>`Error in transpose: rank of input ${n.rank} must match length of reps ${t}.`);const r={x:n},i={reps:t};return z.runKernel(B1,r,i)}const So=U({tile_:mSe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ySe(e,t,n,r="float32"){t==null&&(t=e);const i=rt([e,t],r),s=e<=t?e:t;for(let a=0;a<s;++a)i.set(1,a,a);const o=V(i.toTensor(),[e,t]);if(n==null)return o;if(n.length===1)return So(hi(o,0),[n[0],1,1]);if(n.length===2)return So(hi(hi(o,0),0),[n[0],n[1],1,1]);if(n.length===3)return So(hi(hi(hi(o,0),0),0),[n[0],n[1],n[2],1,1]);throw new Error(`eye() currently supports only 1D and 2D batchShapes, but received ${n.length}D.`)}const vB=U({eye_:ySe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bSe(e){const n={x:O(e,"x","floor","float32")};return z.runKernel(l1,n)}const Mw=U({floor_:bSe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xSe(e,t,n=0,r=0){const i=O(e,"x","gather"),s=O(t,"indices","gather","int32"),o={x:i,indices:s},a={axis:n,batchDims:r};return z.runKernel(H2,o,a)}const Lw=U({gather_:xSe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vSe(e,t){let n=O(e,"a","greater","string_or_numeric"),r=O(t,"b","greater","string_or_numeric");[n,r]=$n(n,r),Ze(n.shape,r.shape);const i={a:n,b:r};return z.runKernel(q2,i)}const zs=U({greater_:vSe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wSe(e,t){let n=O(e,"a","greaterEqual","string_or_numeric"),r=O(t,"b","greaterEqual","string_or_numeric");[n,r]=$n(n,r),Ze(n.shape,r.shape);const i={a:n,b:r};return z.runKernel(f1,i)}const _h=U({greaterEqual_:wSe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $Se(e){const n={input:O(e,"input","imag")};return z.runKernel(rT,n)}const jT=U({imag_:$Se});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function CSe(e){const n={x:O(e,"x","isFinite")};return z.runKernel(d1,n)}const Ote=U({isFinite_:CSe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function SSe(e){const n={x:O(e,"x","isInf")};return z.runKernel(p1,n)}const Rte=U({isInf_:SSe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kSe(e){const n={x:O(e,"x","isNaN")};return z.runKernel(g1,n)}const Mte=U({isNaN_:kSe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ESe(e,t=.2){const r={x:O(e,"x","leakyRelu")},i={alpha:t};return z.runKernel(X2,r,i)}const WT=U({leakyRelu_:ESe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _Se(e,t){let n=O(e,"a","less","string_or_numeric"),r=O(t,"b","less","string_or_numeric");[n,r]=$n(n,r),Ze(n.shape,r.shape);const i={a:n,b:r};return z.runKernel(Y2,i)}const Hx=U({less_:_Se});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ASe(e,t){let n=O(e,"a","lessEqual","string_or_numeric"),r=O(t,"b","lessEqual","string_or_numeric");[n,r]=$n(n,r),Ze(n.shape,r.shape);const i={a:n,b:r};return z.runKernel(K2,i)}const sg=U({lessEqual_:ASe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function TSe(e,t,n){if(n<=0)throw new Error("The number of values should be positive.");const r={start:e,stop:t,num:n};return z.runKernel(iT,{},r)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ISe(e,t=5,n=1,r=1,i=.5){const s=O(e,"x","localResponseNormalization");N(s.rank===4||s.rank===3,()=>`Error in localResponseNormalization: x must be rank 3 or 4 but got
               rank ${s.rank}.`),N(dp(t),()=>`Error in localResponseNormalization: depthRadius must be an integer but got depthRadius ${t}.`);let o=s,a=!1;s.rank===3&&(a=!0,o=V(s,[1,s.shape[0],s.shape[1],s.shape[2]]));const u={x:o},l={depthRadius:t,bias:n,alpha:r,beta:i},c=z.runKernel(ew,u,l);return a?V(c,[c.shape[1],c.shape[2],c.shape[3]]):c}const Lte=U({localResponseNormalization_:ISe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function DSe(e){const n={x:O(e,"x","log","float32")};return z.runKernel(m1,n)}const ro=U({log_:DSe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function NSe(e){const n={x:O(e,"x","log1p")};return z.runKernel(y1,n)}const VT=U({log1p_:NSe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function FSe(e){return N(Of(e),()=>"The f passed in grad(f) must be a function"),(t,n)=>{const r=O(t,"x","tf.grad","string_or_numeric"),i=n!=null?O(n,"dy","tf.grad"):null;return z.tidy(()=>{const{value:s,grads:o}=z.gradients(()=>e(r),[r],i);return i!=null&&Fr(s.shape,i.shape,"The shape of dy passed in grad(f)(x, dy) must match the shape returned by f(x)"),GT(o),o[0]})}}function OSe(e){return N(Of(e),()=>"The f passed in grads(f) must be a function"),(t,n)=>{N(Array.isArray(t),()=>"The args passed in grads(f)(args) must be an array of `Tensor`s or `TensorLike`s");const r=jx(t,"args","tf.grads","string_or_numeric"),i=n!=null?O(n,"dy","tf.grads"):null;return z.tidy(()=>{const{value:s,grads:o}=z.gradients(()=>e(...r),r,i);return i!=null&&Fr(s.shape,i.shape,"The shape of dy passed in grads(f)([x1,...], dy) must match the shape returned by f([x1,...])"),GT(o),o})}}function RSe(e){return N(Of(e),()=>"The f passed in valueAndGrad(f) must be a function"),(t,n)=>{N(t instanceof Pt,()=>"The x passed in valueAndGrad(f)(x) must be a tensor"),N(n==null||n instanceof Pt,()=>"The dy passed in valueAndGrad(f)(x, dy) must be a tensor");const{grads:r,value:i}=z.gradients(()=>e(t),[t],n);return GT(r),{grad:r[0],value:i}}}function MSe(e){return N(Of(e),()=>"The f passed in valueAndGrads(f) must be a function"),(t,n)=>{N(Array.isArray(t)&&t.every(i=>i instanceof Pt),()=>"The args passed in valueAndGrads(f)(args) must be array of tensors"),N(n==null||n instanceof Pt,()=>"The dy passed in valueAndGrads(f)(args, dy) must be a tensor");const r=z.gradients(()=>e(...t),t,n);return n!=null&&Fr(r.value.shape,n.shape,"The shape of dy passed in valueAndGrads(f)([x1,...], dy) must match the shape returned by f([x1,...])"),GT(r.grads),r}}function Pte(e,t){N(Of(e),()=>"The f passed in variableGrads(f) must be a function"),N(t==null||Array.isArray(t)&&t.every(l=>l instanceof Ux),()=>"The varList passed in variableGrads(f, varList) must be an array of variables");const n=t!=null;if(!n){t=[];for(const l in z.registeredVariables)t.push(z.registeredVariables[l])}const r=n?t.filter(l=>!l.trainable):null,i=t.length;t=t.filter(l=>l.trainable),N(t.length>0,()=>`variableGrads() expects at least one of the input variables to be trainable, but none of the ${i} variables is trainable.`);const s=!0,{value:o,grads:a}=z.gradients(e,t,null,s);N(a.some(l=>l!=null),()=>"Cannot find a connection between any variable and the result of the loss function y=f(x). Please make sure the operations that use variables are inside the function f passed to minimize()."),N(o.rank===0,()=>`The f passed in variableGrads(f) must return a scalar, but it returned a rank-${o.rank} tensor`);const u={};return t.forEach((l,c)=>{a[c]!=null&&(u[l.name]=a[c])}),r!=null&&r.forEach(l=>u[l.name]=null),{value:o,grads:u}}function Mu(e){return z.customGrad(e)}function GT(e){if(e.filter(n=>n==null).length>0)throw new Error(`Cannot compute gradient of y=f(x) with respect to x. Make sure that
    the f you passed encloses all operations that lead from x to y.`)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function LSe(e){const n={x:O(e,"x","neg")};return z.runKernel(aw,n)}const un=U({neg_:LSe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function PSe(e){const n={x:O(e,"x","softplus")};return z.runKernel(F1,n)}const j1=U({softplus_:PSe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function BSe(e){const t=O(e,"x","logSigmoid");return Mu(r=>({value:un(j1(un(r))),gradFunc:o=>j(o,$u(un(r)))}))(t)}const Bte=U({logSigmoid_:BSe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zSe(e,t){let n=O(e,"a","sub"),r=O(t,"b","sub");[n,r]=$n(n,r);const i={a:n,b:r};return z.runKernel(M1,i)}const _e=U({sub_:zSe});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function USe(e,t=-1){const n=O(e,"logits","logSoftmax");if(t===-1&&(t=n.rank-1),t!==n.rank-1)throw Error(`Log Softmax along a non-last dimension is not yet supported. Logits was rank ${n.rank} and axis was ${t}`);return Mu((i,s)=>{const a=Oo(i,t,!0),u=_e(i,a),l=_e(we(u,"float32"),ro(Ae(no(u),t,!0)));return s([l]),{value:l,gradFunc:(f,h)=>{const[d]=h,p=!0,g=no(d);return _e(f,j(Ae(f,t,p),g))}}})(n)}const wB=U({logSoftmax_:USe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jSe(e,t=null,n=!1){const r=O(e,"x","logSumExp"),i=st(t,r.shape),s=Oo(r,i,!0),o=_e(r,s),a=no(o),u=Ae(a,i),l=ro(u),c=ce(V(s,l.shape),l);if(n){const f=Fn(c.shape,i);return V(c,f)}return c}const $B=U({logSumExp_:jSe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function WSe(e,t){const n=O(e,"a","logicalAnd","bool"),r=O(t,"b","logicalAnd","bool");Ze(n.shape,r.shape);const i={a:n,b:r};return z.runKernel(Z2,i)}const Lu=U({logicalAnd_:WSe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function VSe(e){const n={x:O(e,"x","logicalNot","bool")};return z.runKernel(J2,n)}const HT=U({logicalNot_:VSe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function GSe(e,t){const n=O(e,"a","logicalOr","bool"),r=O(t,"b","logicalOr","bool");Ze(n.shape,r.shape);const i={a:n,b:r};return z.runKernel(Q2,i)}const CB=U({logicalOr_:GSe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function HSe(e,t){const n=O(e,"a","logicalXor","bool"),r=O(t,"b","logicalXor","bool");return Ze(n.shape,r.shape),Lu(CB(e,t),HT(Lu(e,t)))}const zte=U({logicalXor_:HSe});/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const kC=2147483648;function qSe(e,t,n="left"){const r=O(e,"sortedSequence","searchSorted"),i=O(t,"values","searchSorted"),s=r.shape[r.shape.length-1],o=i.shape[i.shape.length-1],a=V(r,[-1,s]),u=V(i,[-1,o]);if(a.rank<2)throw new Error("Sorted input argument must be at least 2-dimensional");if(a.shape[0]!==u.shape[0])throw new Error("Leading dimension of 'sortedSequence' and 'values' must match.");if(te(u.shape)>=kC)throw new Error(`values tensor size must less than ${kC}`);if(a.shape[1]>=kC)throw new Error(`trailing dim_size must less than ${kC} for int32 output type, was ${a.shape[1]}`);const l={sortedSequence:a,values:u},c={side:n};return z.runKernel($T,l,c)}const SB=U({searchSorted_:qSe});/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function XSe(e,t){return SB(e,t,"left")}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function YSe(e,t,n,r,i){const s=O(e,"x","maxPool"),o=1;let a=s,u=!1;s.rank===3&&(u=!0,a=V(s,[1,s.shape[0],s.shape[1],s.shape[2]])),N(a.rank===4,()=>`Error in maxPool: input must be rank 4 but got rank ${a.rank}.`),N(Or(n,o),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${n} and dilations '${o}'`),Di("maxPool",r,i);const l={x:a},c={filterSize:t,strides:n,pad:r,dimRoundingMode:i},f=z.runKernel(nw,l,c);return u?V(f,[f.shape[1],f.shape[2],f.shape[3]]):f}const qT=U({maxPool_:YSe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function KSe(e,t=[1,1,1],n,r,i,s="NDHWC"){const o=O(e,"x","maxPool3d");let a=o,u=!1;o.rank===4&&(u=!0,a=V(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]])),N(a.rank===5,()=>`Error in maxPool3d: x must be rank 5 but got rank ${a.rank}.`),N(s==="NDHWC",()=>`Error in maxPool3d: Only NDHWC is currently supported, but got dataFormat of ${s}`),Di("maxPool3d",r,i);const l={x:a},c={filterSize:t,strides:n,pad:r,dimRoundingMode:i,dataFormat:s},f=z.runKernel(rw,l,c);return u?V(f,[f.shape[1],f.shape[2],f.shape[3],f.shape[4]]):f}const Ute=U({maxPool3d_:KSe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ZSe(e,t,n,r,i=!1){const o={x:O(e,"x","maxPoolWithArgmax")},a={filterSize:t,strides:n,pad:r,includeBatchInIndex:i},u=z.runKernel(uT,o,a);return{result:u[0],indexes:u[1]}}const JSe=U({maxPoolWithArgmax_:ZSe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function QSe(e,t){let n=O(e,"a","maximum"),r=O(t,"b","maximum");[n,r]=$n(n,r),n.dtype==="bool"&&(n=we(n,"int32"),r=we(r,"int32")),Ze(n.shape,r.shape);const i={a:n,b:r};return z.runKernel(b1,i)}const $c=U({maximum_:QSe});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function eke(e,t=null,n=!1){const i={x:O(e,"x","mean")},s={axis:t,keepDims:n};return z.runKernel(iw,i,s)}const kn=U({mean_:eke});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Hn(e,t="float32"){if(Ps(e),t==="complex64"){const r=Hn(e,"float32"),i=Hn(e,"float32");return Rf(r,i)}const n=Ir(te(e),t);return z.makeTensor(n,e,t)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ys(e,t="float32"){if(Ps(e),t==="complex64"){const r=Ys(e,"float32"),i=Hn(e,"float32");return Rf(r,i)}const n=IA(te(e),t);return z.makeTensor(n,e,t)}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tke(e,t,{indexing:n="xy"}={}){if(n!=="xy"&&n!=="ij")throw new TypeError(`${n} is not a valid third argument to meshgrid`);if(e===void 0)return[];let r=O(e,"x","meshgrid",e instanceof Pt?e.dtype:"float32");if(t===void 0)return[r];let i=O(t,"y","meshgrid",t instanceof Pt?t.dtype:"float32");const s=te(r.shape),o=te(i.shape);return n==="xy"?(r=V(r,[1,-1]),i=V(i,[-1,1]),[ot(Ys([o,1],r.dtype),r),ot(i,Ys([1,s],i.dtype))]):(r=V(r,[-1,1]),i=V(i,[1,-1]),[ot(r,Ys([1,o],r.dtype)),ot(Ys([s,1],i.dtype),i)])}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nke(e,t){let n=O(e,"a","minimum"),r=O(t,"b","minimum");[n,r]=$n(n,r),n.dtype==="bool"&&(n=we(n,"int32"),r=we(r,"int32")),Ze(n.shape,r.shape);const i={a:n,b:r};return z.runKernel(x1,i)}const bp=U({minimum_:nke});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rke(e,t,n){N(n==="reflect"||n==="symmetric",()=>`Invalid mode. Mode must be either reflect or symmetric. Got ${n}.`);const r=O(e,"x","mirrorPad");if(r.rank===0)throw new Error("mirrorPad(scalar) is not defined. Pass non-scalar to mirrorPad");N(t.length===r.rank,()=>`Padding doesn't match input. Must be ${r.rank}. Got ${t.length}.`);const i=n==="reflect"?1:0;for(let a=0;a<r.rank;a++)N(t[a].length===2,()=>"Invalid number of paddings. Must be length of 2 each."),N(t[a][0]>=0&&t[a][0]<=r.shape[a]-i&&t[a][1]>=0&&t[a][1]<=r.shape[a]-i,()=>`Padding in dimension ${a} cannot be greater than or equal to ${r.shape[a]-i} or less than 0 for input of shape ${r.shape}`);const s={paddings:t,mode:n},o={x:r};return z.runKernel(ow,o,s)}const jte=U({mirrorPad_:rke});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ike(e,t){let n=O(e,"a","mod"),r=O(t,"b","mod");[n,r]=$n(n,r);const i={a:n,b:r};return z.runKernel(v1,i)}const Wte=U({mod_:ike});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ske(e,t=null,n=!1){e=O(e,"x","moments");const r=st(t,e.shape),i=kn(e,r,n);let s=i.shape;n||(s=Fn(i.shape,r));const o=Xt(_e(we(e,"float32"),V(i,s))),a=kn(o,r,n);return{mean:i,variance:a}}const XT=U({moments_:ske});function oke(e,t,n,r){const i=O(t,"data","multiRNNCell"),s=jx(n,"c","multiRNNCell"),o=jx(r,"h","multiRNNCell");let a=i;const u=[];for(let f=0;f<e.length;f++){const h=e[f](a,s[f],o[f]);u.push(h[0]),u.push(h[1]),a=h[1]}const l=[],c=[];for(let f=0;f<u.length;f+=2)l.push(u[f]),c.push(u[f+1]);return[l,c]}const ake=U({multiRNNCell_:oke});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uke(e,t,n,r=!1){const i=O(e,"logits","multinomial"),s=i.size,o=i.rank;if(s<2)throw new Error(`Error in multinomial: you need at least 2 outcomes, but got ${s}.`);if(o>2)throw new Error(`Rank of probabilities must be 1 or 2, but is ${o}`);n=n||Math.random();const u={logits:o===1?V(i,[1,-1]):i},l={numSamples:t,seed:n,normalized:r},c=z.runKernel(lT,u,l);return o===1?V(c,[c.size]):c}const lke=U({multinomial_:uke});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cke(e,t){let n=O(e,"a","notEqual","string_or_numeric"),r=O(t,"b","notEqual","string_or_numeric");[n,r]=$n(n,r),Ze(n.shape,r.shape);const i={a:n,b:r};return z.runKernel(uw,i)}const Xm=U({notEqual_:cke});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fke(e,t,n=1,r=0,i="int32"){if(t<2)throw new Error(`Error in oneHot: depth must be >=2, but it is ${t}`);const o={indices:O(e,"indices","oneHot","int32")},a={dtype:i,depth:t,onValue:n,offValue:r};return z.runKernel(cw,o,a)}const qx=U({oneHot_:fke});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hke(e){const n={x:O(e,"x","onesLike")};return z.runKernel(lw,n)}const io=U({onesLike_:hke});function dke(e,t){const n=O(e,"v1","outerProduct"),r=O(t,"v2","outerProduct");N(n.rank===1&&r.rank===1,()=>`Error in outerProduct: inputs must be rank 1, but got ranks ${n.rank} and ${r.rank}.`);const i=V(n,[-1,1]),s=V(r,[1,-1]);return ot(i,s)}const pke=U({outerProduct_:dke});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gke(e,t,n=0){const r=O(e,"x","pad");if(r.rank===0)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");const i={paddings:t,constantValue:n},s={x:r};return z.runKernel(hw,s,i)}const Ah=U({pad_:gke});function mke(e,t,n=0){return N(t.length===2,()=>"Invalid number of paddings. Must be length of 2."),Ah(e,[t],n)}const yke=U({pad1d_:mke});function bke(e,t,n=0){return N(t.length===2&&t[0].length===2&&t[1].length===2,()=>"Invalid number of paddings. Must be length of 2 each."),Ah(e,t,n)}const xke=U({pad2d_:bke});function vke(e,t,n=0){return N(t.length===3&&t[0].length===2&&t[1].length===2&&t[2].length===2,()=>"Invalid number of paddings. Must be length of 2 each."),Ah(e,t,n)}const wke=U({pad3d_:vke});function $ke(e,t,n=0){return N(t.length===4&&t[0].length===2&&t[1].length===2&&t[2].length===2&&t[3].length===2,()=>"Invalid number of paddings. Must be length of 2 each."),Ah(e,t,n)}const Cke=U({pad4d_:$ke});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ske(e,t,n){const r=O(e,"x","spaceToBatchND");N(r.rank>=1+t.length,()=>`input rank ${r.rank} should be > than [blockShape] ${t.length}`),N(n.length===t.length,()=>`paddings.shape[0] ${n.length} must be equal to [blockShape] ${t.length}`),N(r.shape.reduce((o,a,u)=>u>0&&u<=t.length?o&&(a+n[u-1][0]+n[u-1][1])%t[u-1]===0:o,!0),()=>`input spatial dimensions ${r.shape.slice(1)} with paddings ${n.toString()} must be divisible by blockShapes ${t.toString()}`);const i={x:r},s={blockShape:t,paddings:n};return z.runKernel($w,i,s)}const YT=U({spaceToBatchND_:Ske});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kke(e,t,n,r,i,s,o){i==null&&(i=[1,1]),s==null&&(s=1),r===0&&(r="valid");const a=O(e,"x","maxPool");let u=a,l=!1;a.rank===3&&(l=!0,u=V(a,[1,a.shape[0],a.shape[1],a.shape[2]])),N(Or(s,i),()=>`Error in pool: Either strides or dilations must be 1. Got strides ${s} and dilations '${i}'`);const c=Ho(u.shape,t,s,i,r),f=[c.dilationHeight,c.dilationWidth];let h;r==="same"?h=_ke([c.filterHeight,c.filterWidth],f):h=[[0,0],[0,0]];const d=f[0]===1&&f[1]===1,[p,g]=Eke([c.inHeight,c.inWidth],f,h),m=d?r:"valid",y=d?u:YT(u,f,p),v=(n==="avg"?()=>BT(y,t,s,m,o):()=>qT(y,t,s,m,o))(),x=d?v:zT(v,f,g);return l?V(x,[x.shape[1],x.shape[2],x.shape[3]]):x}function Eke(e,t,n){const r=n.map(c=>c[0]),i=n.map(c=>c[1]),s=e.concat(r,i),o=t.map((c,f)=>(c-s[f]%c)%c),a=i.map((c,f)=>c+o[f]),u=t.map((c,f)=>[r[f],a[f]]),l=t.map((c,f)=>[0,o[f]]);return[u,l]}function _ke(e,t){const r=e.map((o,a)=>o+(o-1)*(t[a]-1)).map(o=>o-1),i=r.map(o=>Math.floor(o/2)),s=r.map((o,a)=>o-i[a]);return r.map((o,a)=>[i[a],s[a]])}const Vte=U({pool_:kke});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ake(e,t){const n=O(e,"x","prelu"),r=O(t,"alpha","prelu"),i={x:n,alpha:r};return z.runKernel(dw,i)}const KT=U({prelu_:Ake});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Tke(e,t=null,n=!1){let r=O(e,"x","prod");r.dtype==="bool"&&(r=we(r,"int32"));const i={x:r},s={axis:t,keepDims:n};return z.runKernel(pw,i,s)}const Gte=U({prod_:Tke});/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ike(e,t,n,r){const i=e.map((c,f)=>O(c,`tensors${f}`,"raggedGather","int32")),s=O(t,"paramsDenseValues","raggedGather"),o=O(n,"indices","raggedGather","int32"),a={paramsNestedSplits:i,paramsDenseValues:s,indices:o},u={outputRaggedRank:r},l=z.runKernel(dT,a,u);return{outputNestedSplits:l.slice(0,l.length-1),outputDenseValues:l[l.length-1]}}const Dke=U({raggedGather_:Ike});/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Nke(e,t,n){const r=O(e,"starts","raggedRange"),i=O(t,"limits","raggedRange",r.dtype),s=O(n,"deltas","raggedRange",r.dtype),o={starts:r,limits:i,deltas:s},a=z.runKernel(pT,o);return{rtNestedSplits:a[0],rtDenseValues:a[1]}}const Fke=U({raggedRange_:Nke});/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Oke(e,t,n,r,i){const s=O(e,"shape","raggedTensorToTensor","int32"),o=O(t,"values","raggedTensorToTensor"),a=O(n,"defaultValue","raggedTensorToTensor",o.dtype),u=r.map((f,h)=>O(f,`tensors${h}`,"raggedTensorToTensor","int32")),l={shape:s,values:o,defaultValue:a,rowPartitionTensors:u},c={rowPartitionTypes:i};return z.runKernel(gT,l,c)}const Rke=U({raggedTensorToTensor_:Oke});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Mke(e,t,n){Ps(e);const r=te(e);let i=null;if(n==null||n==="float32")i=new Float32Array(r);else if(n==="int32")i=new Int32Array(r);else if(n==="bool")i=new Uint8Array(r);else throw new Error(`Unknown data type ${n}`);for(let s=0;s<r;s++)i[s]=t();return z.makeTensor(i,e,n)}const Lke=U({rand_:Mke});var kB={exports:{}};kB.exports;(function(e){(function(t,n,r){function i(u){var l=this,c=a();l.next=function(){var f=2091639*l.s0+l.c*23283064365386963e-26;return l.s0=l.s1,l.s1=l.s2,l.s2=f-(l.c=f|0)},l.c=1,l.s0=c(" "),l.s1=c(" "),l.s2=c(" "),l.s0-=c(u),l.s0<0&&(l.s0+=1),l.s1-=c(u),l.s1<0&&(l.s1+=1),l.s2-=c(u),l.s2<0&&(l.s2+=1),c=null}function s(u,l){return l.c=u.c,l.s0=u.s0,l.s1=u.s1,l.s2=u.s2,l}function o(u,l){var c=new i(u),f=l&&l.state,h=c.next;return h.int32=function(){return c.next()*4294967296|0},h.double=function(){return h()+(h()*2097152|0)*11102230246251565e-32},h.quick=h,f&&(typeof f=="object"&&s(f,c),h.state=function(){return s(c,{})}),h}function a(){var u=4022871197,l=function(c){c=String(c);for(var f=0;f<c.length;f++){u+=c.charCodeAt(f);var h=.02519603282416938*u;u=h>>>0,h-=u,h*=u,u=h>>>0,h-=u,u+=h*4294967296}return(u>>>0)*23283064365386963e-26};return l}n&&n.exports?n.exports=o:r&&r.amd?r(function(){return o}):this.alea=o})(Je,e,!1)})(kB);var Pke=kB.exports,EB={exports:{}};EB.exports;(function(e){(function(t,n,r){function i(a){var u=this,l="";u.x=0,u.y=0,u.z=0,u.w=0,u.next=function(){var f=u.x^u.x<<11;return u.x=u.y,u.y=u.z,u.z=u.w,u.w^=u.w>>>19^f^f>>>8},a===(a|0)?u.x=a:l+=a;for(var c=0;c<l.length+64;c++)u.x^=l.charCodeAt(c)|0,u.next()}function s(a,u){return u.x=a.x,u.y=a.y,u.z=a.z,u.w=a.w,u}function o(a,u){var l=new i(a),c=u&&u.state,f=function(){return(l.next()>>>0)/4294967296};return f.double=function(){do var h=l.next()>>>11,d=(l.next()>>>0)/4294967296,p=(h+d)/(1<<21);while(p===0);return p},f.int32=l.next,f.quick=f,c&&(typeof c=="object"&&s(c,l),f.state=function(){return s(l,{})}),f}n&&n.exports?n.exports=o:r&&r.amd?r(function(){return o}):this.xor128=o})(Je,e,!1)})(EB);var Bke=EB.exports,_B={exports:{}};_B.exports;(function(e){(function(t,n,r){function i(a){var u=this,l="";u.next=function(){var f=u.x^u.x>>>2;return u.x=u.y,u.y=u.z,u.z=u.w,u.w=u.v,(u.d=u.d+362437|0)+(u.v=u.v^u.v<<4^(f^f<<1))|0},u.x=0,u.y=0,u.z=0,u.w=0,u.v=0,a===(a|0)?u.x=a:l+=a;for(var c=0;c<l.length+64;c++)u.x^=l.charCodeAt(c)|0,c==l.length&&(u.d=u.x<<10^u.x>>>4),u.next()}function s(a,u){return u.x=a.x,u.y=a.y,u.z=a.z,u.w=a.w,u.v=a.v,u.d=a.d,u}function o(a,u){var l=new i(a),c=u&&u.state,f=function(){return(l.next()>>>0)/4294967296};return f.double=function(){do var h=l.next()>>>11,d=(l.next()>>>0)/4294967296,p=(h+d)/(1<<21);while(p===0);return p},f.int32=l.next,f.quick=f,c&&(typeof c=="object"&&s(c,l),f.state=function(){return s(l,{})}),f}n&&n.exports?n.exports=o:r&&r.amd?r(function(){return o}):this.xorwow=o})(Je,e,!1)})(_B);var zke=_B.exports,AB={exports:{}};AB.exports;(function(e){(function(t,n,r){function i(a){var u=this;u.next=function(){var c=u.x,f=u.i,h,d;return h=c[f],h^=h>>>7,d=h^h<<24,h=c[f+1&7],d^=h^h>>>10,h=c[f+3&7],d^=h^h>>>3,h=c[f+4&7],d^=h^h<<7,h=c[f+7&7],h=h^h<<13,d^=h^h<<9,c[f]=d,u.i=f+1&7,d};function l(c,f){var h,d=[];if(f===(f|0))d[0]=f;else for(f=""+f,h=0;h<f.length;++h)d[h&7]=d[h&7]<<15^f.charCodeAt(h)+d[h+1&7]<<13;for(;d.length<8;)d.push(0);for(h=0;h<8&&d[h]===0;++h);for(h==8?d[7]=-1:d[h],c.x=d,c.i=0,h=256;h>0;--h)c.next()}l(u,a)}function s(a,u){return u.x=a.x.slice(),u.i=a.i,u}function o(a,u){a==null&&(a=+new Date);var l=new i(a),c=u&&u.state,f=function(){return(l.next()>>>0)/4294967296};return f.double=function(){do var h=l.next()>>>11,d=(l.next()>>>0)/4294967296,p=(h+d)/(1<<21);while(p===0);return p},f.int32=l.next,f.quick=f,c&&(c.x&&s(c,l),f.state=function(){return s(l,{})}),f}n&&n.exports?n.exports=o:r&&r.amd?r(function(){return o}):this.xorshift7=o})(Je,e,!1)})(AB);var Uke=AB.exports,TB={exports:{}};TB.exports;(function(e){(function(t,n,r){function i(a){var u=this;u.next=function(){var c=u.w,f=u.X,h=u.i,d,p;return u.w=c=c+1640531527|0,p=f[h+34&127],d=f[h=h+1&127],p^=p<<13,d^=d<<17,p^=p>>>15,d^=d>>>12,p=f[h]=p^d,u.i=h,p+(c^c>>>16)|0};function l(c,f){var h,d,p,g,m,y=[],b=128;for(f===(f|0)?(d=f,f=null):(f=f+"\0",d=0,b=Math.max(b,f.length)),p=0,g=-32;g<b;++g)f&&(d^=f.charCodeAt((g+32)%f.length)),g===0&&(m=d),d^=d<<10,d^=d>>>15,d^=d<<4,d^=d>>>13,g>=0&&(m=m+1640531527|0,h=y[g&127]^=d+m,p=h==0?p+1:0);for(p>=128&&(y[(f&&f.length||0)&127]=-1),p=127,g=4*128;g>0;--g)d=y[p+34&127],h=y[p=p+1&127],d^=d<<13,h^=h<<17,d^=d>>>15,h^=h>>>12,y[p]=d^h;c.w=m,c.X=y,c.i=p}l(u,a)}function s(a,u){return u.i=a.i,u.w=a.w,u.X=a.X.slice(),u}function o(a,u){a==null&&(a=+new Date);var l=new i(a),c=u&&u.state,f=function(){return(l.next()>>>0)/4294967296};return f.double=function(){do var h=l.next()>>>11,d=(l.next()>>>0)/4294967296,p=(h+d)/(1<<21);while(p===0);return p},f.int32=l.next,f.quick=f,c&&(c.X&&s(c,l),f.state=function(){return s(l,{})}),f}n&&n.exports?n.exports=o:r&&r.amd?r(function(){return o}):this.xor4096=o})(Je,e,!1)})(TB);var jke=TB.exports,IB={exports:{}};IB.exports;(function(e){(function(t,n,r){function i(a){var u=this,l="";u.next=function(){var f=u.b,h=u.c,d=u.d,p=u.a;return f=f<<25^f>>>7^h,h=h-d|0,d=d<<24^d>>>8^p,p=p-f|0,u.b=f=f<<20^f>>>12^h,u.c=h=h-d|0,u.d=d<<16^h>>>16^p,u.a=p-f|0},u.a=0,u.b=0,u.c=-1640531527,u.d=1367130551,a===Math.floor(a)?(u.a=a/4294967296|0,u.b=a|0):l+=a;for(var c=0;c<l.length+20;c++)u.b^=l.charCodeAt(c)|0,u.next()}function s(a,u){return u.a=a.a,u.b=a.b,u.c=a.c,u.d=a.d,u}function o(a,u){var l=new i(a),c=u&&u.state,f=function(){return(l.next()>>>0)/4294967296};return f.double=function(){do var h=l.next()>>>11,d=(l.next()>>>0)/4294967296,p=(h+d)/(1<<21);while(p===0);return p},f.int32=l.next,f.quick=f,c&&(typeof c=="object"&&s(c,l),f.state=function(){return s(l,{})}),f}n&&n.exports?n.exports=o:r&&r.amd?r(function(){return o}):this.tychei=o})(Je,e,!1)})(IB);var Wke=IB.exports,Hte={exports:{}};const Vke={},Gke=Object.freeze(Object.defineProperty({__proto__:null,default:Vke},Symbol.toStringTag,{value:"Module"})),Hke=Qp(Gke);(function(e){(function(t,n,r){var i=256,s=6,o=52,a="random",u=r.pow(i,s),l=r.pow(2,o),c=l*2,f=i-1,h;function d(x,w,C){var $=[];w=w==!0?{entropy:!0}:w||{};var S=y(m(w.entropy?[x,v(n)]:x??b(),3),$),k=new p($),E=function(){for(var _=k.g(s),D=u,A=0;_<l;)_=(_+A)*i,D*=i,A=k.g(1);for(;_>=c;)_/=2,D/=2,A>>>=1;return(_+A)/D};return E.int32=function(){return k.g(4)|0},E.quick=function(){return k.g(4)/4294967296},E.double=E,y(v(k.S),n),(w.pass||C||function(_,D,A,T){return T&&(T.S&&g(T,k),_.state=function(){return g(k,{})}),A?(r[a]=_,D):_})(E,S,"global"in w?w.global:this==r,w.state)}function p(x){var w,C=x.length,$=this,S=0,k=$.i=$.j=0,E=$.S=[];for(C||(x=[C++]);S<i;)E[S]=S++;for(S=0;S<i;S++)E[S]=E[k=f&k+x[S%C]+(w=E[S])],E[k]=w;($.g=function(_){for(var D,A=0,T=$.i,I=$.j,F=$.S;_--;)D=F[T=f&T+1],A=A*i+F[f&(F[T]=F[I=f&I+D])+(F[I]=D)];return $.i=T,$.j=I,A})(i)}function g(x,w){return w.i=x.i,w.j=x.j,w.S=x.S.slice(),w}function m(x,w){var C=[],$=typeof x,S;if(w&&$=="object")for(S in x)try{C.push(m(x[S],w-1))}catch{}return C.length?C:$=="string"?x:x+"\0"}function y(x,w){for(var C=x+"",$,S=0;S<C.length;)w[f&S]=f&($^=w[f&S]*19)+C.charCodeAt(S++);return v(w)}function b(){try{var x;return h&&(x=h.randomBytes)?x=x(i):(x=new Uint8Array(i),(t.crypto||t.msCrypto).getRandomValues(x)),v(x)}catch{var w=t.navigator,C=w&&w.plugins;return[+new Date,t,C,t.screen,v(n)]}}function v(x){return String.fromCharCode.apply(0,x)}if(y(r.random(),n),e.exports){e.exports=d;try{h=Hke}catch{}}else r["seed"+a]=d})(typeof self<"u"?self:Je,[],Math)})(Hte);var qke=Hte.exports,Xke=Pke,Yke=Bke,Kke=zke,Zke=Uke,Jke=jke,Qke=Wke,og=qke;og.alea=Xke;og.xor128=Yke;og.xorwow=Kke;og.xorshift7=Zke;og.xor4096=Jke;og.tychei=Qke;var ZT=og;/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const eEe=.001,qte=.1;function tEe(e,t,n){return n==null&&(n=DB()),JR(e,t,(r,i)=>NB(r,i,n))}function DB(){return z.backend.floatPrecision()===32?eEe:qte}function JR(e,t,n){let r=!0;if((rr(e)||rr(t))&&(r=!1),rr(e)&&rr(t)&&(r=!0),r){const o=e.constructor.name,a=t.constructor.name;if(o!==a)throw new Error(`Arrays are of different type. Actual: ${o}. Expected: ${a}`)}if(Array.isArray(e)&&Array.isArray(t)){const o=Ru(e),a=Ru(t);if(!bt(o,a))throw new Error(`Arrays have different shapes. Actual: [${o}]. Expected: [${a}]`)}const i=rr(e)?e:Ou(e),s=rr(t)?t:Ou(t);if(i.length!==s.length)throw new Error(`Arrays have different lengths actual: ${i.length} vs expected: ${s.length}.
Actual:   ${i}.
Expected: ${s}.`);for(let o=0;o<s.length;++o){const a=i[o],u=s[o];if(!n(a,u))throw new Error(`Arrays differ: actual[${o}] = ${a}, expected[${o}] = ${u}.
Actual:   ${i}.
Expected: ${s}.`)}typeof expect<"u"&&expect().nothing()}function nEe(e,t){e().then(()=>t.fail(),()=>t()),typeof expect<"u"&&expect().nothing()}function rEe(e,t){const n=typeof t=="string"||typeof t=="number"||typeof t=="boolean"?[t]:t;return mu(e)||mu(e[0])||mu(t)||mu(t[0])?JR(e,n,(r,i)=>r==i):JR(e,t,(r,i)=>NB(r,i,0))}function iEe(e,t,n){if(n==null&&(n=DB()),!NB(e,t,n))throw new Error(`Numbers differ: actual === ${e}, expected === ${t}`);typeof expect<"u"&&expect().nothing()}function NB(e,t,n){return!isFinite(e)&&!isFinite(t)?!0:!(isNaN(e)||isNaN(t)||Math.abs(e-t)>n)}function sEe(e,t,n){for(let r=0;r<e.length;r++)if(e[r]<t||e[r]>n)throw new Error(`Value out of range:${e[r]} low: ${t}, high: ${n}`)}function oEe(e,t){const n=new Float32Array(e),r=new Float32Array(t);if(n.length!==r.length)throw new Error(`Expected ArrayBuffer to be of length ${r.length}, but it was ${n.length}`);for(let i=0;i<r.length;i++)if(n[i]!==r[i])throw new Error(`Expected ArrayBuffer value at ${i} to be ${r[i]} but got ${n[i]} instead`)}function Xte(e){for(let t=0;t<e.length;t++){const n=e[t];Array.isArray(n)?Xte(n):e[t]=wu(n)}return e}function aEe(e){const t=document.createElement("video");return"playsInline"in t&&(t.playsInline=!0),t.muted=!0,t.loop=!0,t.style.position="fixed",t.style.left="0px",t.style.top="0px",t.preload="auto",t.appendChild(e),new Promise(n=>{t.addEventListener("loadeddata",r=>n(t)),t.load()})}async function uEe(e){await e.play(),"requestVideoFrameCallback"in e&&await new Promise(t=>{e.requestVideoFrameCallback(t)})}const lEe=Object.freeze(Object.defineProperty({__proto__:null,TEST_EPSILON_FLOAT16:qte,createVideoElement:aEe,encodeStrings:Xte,expectArrayBuffersEqual:oEe,expectArraysClose:tEe,expectArraysEqual:rEe,expectNumbersClose:iEe,expectPromiseToFail:nEe,expectValuesInRange:sEe,play:uEe,testEpsilon:DB},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class FB{constructor(t,n,r,i,s){this.mean=t,this.stdDev=n,this.dtype=r,this.nextVal=NaN,this.truncated=i,this.truncated&&(this.upper=this.mean+this.stdDev*2,this.lower=this.mean-this.stdDev*2);const o=s||Math.random();this.random=ZT.alea(o.toString())}nextValue(){if(!isNaN(this.nextVal)){const i=this.nextVal;return this.nextVal=NaN,i}let t,n,r=!1;for(;!r;){let i,s,o;do i=2*this.random()-1,s=2*this.random()-1,o=i*i+s*s;while(o>=1||o===0);const a=Math.sqrt(-2*Math.log(o)/o);t=this.mean+this.stdDev*i*a,n=this.mean+this.stdDev*s*a,(!this.truncated||this.isValidTruncated(t))&&(r=!0)}return(!this.truncated||this.isValidTruncated(n))&&(this.nextVal=this.convertValue(n)),this.convertValue(t)}convertValue(t){return this.dtype==null||this.dtype==="float32"?t:Math.round(t)}isValidTruncated(t){return t<=this.upper&&t>=this.lower}}class cEe{constructor(t,n,r,i){this.alpha=t,this.beta=1/n,this.dtype=r;const s=i||Math.random();this.randu=ZT.alea(s.toString()),this.randn=new FB(0,1,r,!1,this.randu()),t<1?this.d=t+2/3:this.d=t-1/3,this.c=1/Math.sqrt(9*this.d)}nextValue(){let t,n,r,i,s,o;for(;;){do i=this.randn.nextValue(),o=1+this.c*i;while(o<=0);if(o*=o*o,t=i*i,n=1-.331*t*t,r=.5*t+this.d*(1-o+Math.log(o)),s=this.randu(),s<n||Math.log(s)<r)break}return o=1/this.beta*this.d*o,this.alpha<1&&(o*=Math.pow(this.randu(),1/this.alpha)),this.convertValue(o)}convertValue(t){return this.dtype==="float32"?t:Math.round(t)}}class fEe{constructor(t=0,n=1,r,i){if(this.canReturnFloat=()=>this.dtype==null||this.dtype==="float32",this.min=t,this.range=n-t,this.dtype=r,i==null&&(i=Math.random()),typeof i=="number"&&(i=i.toString()),!this.canReturnFloat()&&this.range<=1)throw new Error(`The difference between ${t} - ${n} <= 1 and dtype is not float`);this.random=ZT.alea(i)}convertValue(t){return this.canReturnFloat()?t:Math.round(t)}nextValue(){return this.convertValue(this.min+this.range*this.random())}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hEe(e,t,n=1,r="float32",i){if(Ps(e),n==null&&(n=1),r==null&&(r="float32"),r!=="float32"&&r!=="int32")throw new Error(`Unsupported data type ${r}`);const s=new cEe(t,n,r,i),o=rt(e,r);for(let a=0;a<o.values.length;a++)o.values[a]=s.nextValue();return o.toTensor()}const dEe=U({randomGamma_:hEe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pEe(e,t=0,n=1,r,i){if(Ps(e),r!=null&&r==="bool")throw new Error(`Unsupported data type ${r}`);const s=new FB(t,n,r,!1,i),o=rt(e,r);for(let a=0;a<o.values.length;a++)o.values[a]=s.nextValue();return o.toTensor()}const OB=U({randomNormal_:pEe});/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gEe(e,t,n){if(t!=null&&t==="bool")throw new Error(`Unsupported data type ${t}`);return OB(e,0,1,t,n)}const mEe=U({randomStandardNormal_:gEe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yEe(e,t=0,n=1,r="float32",i){Ps(e);const s=rt(e,r),o=new fEe(t,n,null,i);for(let a=0;a<s.values.length;a++)s.values[a]=o.nextValue();return s.toTensor()}const ag=U({randomUniform_:yEe});/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bEe(e,t,n,r){return ag(e,t,n,"int32",r)}const xEe=U({randomUniformInt_:bEe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ym(e,t,n=1,r="float32"){if(n===0)throw new Error("Cannot have a step of zero");const i={start:e,stop:t,step:n,dtype:r};return z.runKernel(mT,{},i)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vEe(e){const n={input:O(e,"input","real")};return z.runKernel(yT,n)}const Xx=U({real_:vEe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wEe(e){const n={x:O(e,"x","reciprocal")};return z.runKernel(C1,n)}const Yte=U({reciprocal_:wEe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $Ee(e){const n={x:O(e,"x","relu")};return z.runKernel(S1,n)}const Zu=U({relu_:$Ee});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function CEe(e){const n={x:O(e,"x","relu6")};return z.runKernel(k1,n)}const RB=U({relu6_:CEe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function SEe(e,t){const r={x:O(e,"x","reverse")},i={dims:t};return z.runKernel(bw,r,i)}const Lo=U({reverse_:SEe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kEe(e){const t=O(e,"x","reverse");return N(t.rank===1,()=>`Error in reverse1D: x must be rank 1 but got rank ${t.rank}.`),Lo(t,0)}const EEe=U({reverse1d_:kEe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _Ee(e,t){const n=O(e,"x","reverse");return N(n.rank===2,()=>`Error in reverse2D: x must be rank 2 but got rank ${n.rank}.`),Lo(n,t)}const AEe=U({reverse2d_:_Ee});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function TEe(e,t){const n=O(e,"x","reverse");return N(n.rank===3,()=>`Error in reverse3D: x must be rank 3 but got rank ${n.rank}.`),Lo(n,t)}const IEe=U({reverse3d_:TEe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function DEe(e,t){const n=O(e,"x","reverse");return N(n.rank===4,()=>`Error in reverse4D: x must be rank 4 but got rank ${n.rank}.`),Lo(n,t)}const NEe=U({reverse4d_:DEe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function FEe(e){const n={x:O(e,"x","round")};return z.runKernel(E1,n)}const MB=U({round_:FEe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function OEe(e){const n={x:O(e,"x","rsqrt","float32")};return z.runKernel(_1,n)}const LB=U({rsqrt_:OEe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function REe(e){const n={x:O(e,"x","selu")};return z.runKernel(A1,n)}const PB=U({selu_:REe});function MEe(e,t,n,r,i,s=[1,1],o="NHWC"){const a=O(e,"x","separableConv2d"),u=O(t,"depthwiseFilter","separableConv2d"),l=O(n,"pointwiseFilter","separableConv2d");let c=a,f=!1;if(a.rank===3&&(f=!0,c=V(a,[1,a.shape[0],a.shape[1],a.shape[2]])),o==="NCHW")throw new Error("separableConv2d currently does not support dataFormat NCHW; only NHWC is supported");N(c.rank===4,()=>`Error in separableConv2d: input must be rank 4, but got rank ${c.rank}.`),N(u.rank===4,()=>`Error in separableConv2d: depthwise filter must be rank 4, but got rank ${u.rank}.`),N(l.rank===4,()=>`Error in separableConv2d: pointwise filter must be rank 4, but got rank ${u.rank}.`),N(l.shape[0]===1,()=>`Error in separableConv2d: the first dimension of pointwise filter  must be 1, but got ${l.shape[0]}.`),N(l.shape[1]===1,()=>`Error in separableConv2d: the second dimension of pointwise filter must be 1, but got ${l.shape[1]}.`);const h=u.shape[2],d=u.shape[3];N(l.shape[2]===h*d,()=>`Error in separableConv2d: the third dimension of pointwise filter must be ${h*d}, but got ${l.shape[2]}.`);const p=Fw(c,u,r,i,o,s),m=Lf(p,l,1,"valid",o);return f?V(m,[m.shape[1],m.shape[2],m.shape[3]]):m}const BB=U({separableConv2d_:MEe});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function LEe(e,t){const n=O(e,"x","setdiff1d"),r=O(t,"y","setdiff1d");N(n.dtype===r.dtype,()=>`x and y should have the same dtype, but got x (${n.dtype}) and y (${r.dtype}).`),N(n.rank===1,()=>`x should be 1D tensor, but got x (${n.shape}).`),N(r.rank===1,()=>`y should be 1D tensor, but got y (${r.shape}).`);const i=await n.data(),s=await r.data(),o=new Set(s);let a=0;for(let c=0;c<i.length;c++)o.has(i[c])||a++;const u=new zn([a],n.dtype),l=new zn([a],"int32");for(let c=0,f=0;c<i.length;c++)o.has(i[c])||(u.values[f]=i[c],l.values[f]=c,f++);return[u.toTensor(),l.toTensor()]}const PEe=LEe;/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function BEe(e){const n={x:O(e,"x","sign")};return z.runKernel(D1,n)}const Kte=U({sign_:BEe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zEe(e){const n={x:O(e,"x","sin","float32")};return z.runKernel(T1,n)}const zB=U({sin_:zEe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function UEe(e){const n={x:O(e,"x","sinh")};return z.runKernel(I1,n)}const UB=U({sinh_:UEe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jEe(e,t,n){const r=O(e,"x","slice1d");return N(r.rank===1,()=>`slice1d expects a rank-1 tensor, but got a rank-${r.rank} tensor`),wt(r,[t],[n])}const JT=U({slice1d_:jEe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function WEe(e,t,n){const r=O(e,"x","slice2d");return N(r.rank===2,()=>`slice2d expects a rank-2 tensor, but got a rank-${r.rank} tensor`),wt(r,t,n)}const jB=U({slice2d_:WEe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function VEe(e,t,n){const r=O(e,"x","slice3d");return N(r.rank===3,()=>`slice3d expects a rank-3 tensor, but got a rank-${r.rank} tensor`),wt(r,t,n)}const QT=U({slice3d_:VEe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function GEe(e,t,n){const r=O(e,"x","slice4d");return N(r.rank===4,()=>`slice4d expects a rank-4 tensor, but got a rank-${r.rank} tensor`),wt(r,t,n)}const Yx=U({slice4d_:GEe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function HEe(e,t=-1){const n=O(e,"logits","softmax","float32");if(t===-1&&(t=n.rank-1),t!==n.rank-1)throw Error(`Softmax along a non-last dimension is not yet supported. Logits was rank ${n.rank} and dim was ${t}`);const r={logits:n},i={dim:t};return z.runKernel(Sw,r,i)}const eI=U({softmax_:HEe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qEe(e){N(e.dtype==="complex64",()=>`The dtype for tf.spectral.fft() must be complex64 but got ${e.dtype}.`);const t={input:e};return z.runKernel(JA,t)}const tI=U({fft_:qEe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function XEe(e){N(e.dtype==="complex64",()=>`The dtype for tf.spectral.ifft() must be complex64 but got ${e.dtype}.`);const t={input:e};return z.runKernel(nT,t)}const Kx=U({ifft_:XEe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function YEe(e){const t=e.shape[e.shape.length-1],n=e.size/t;let r;if(t<=2){const i=V(e,[n,t]);r=Kx(i)}else{const i=[n,2*(t-1)],s=V(Xx(e),[n,t]),o=V(jT(e),[n,t]),a=Lo(wt(s,[0,1],[n,t-2]),1),u=j(Lo(wt(o,[0,1],[n,t-2]),1),qe(-1)),l=lr([s,a],1),c=lr([o,u],1),f=V(Rf(l,c),[i[0],i[1]]);r=Kx(f)}if(r=Xx(r),e.rank===3&&e.shape[0]!==0){const i=r,s=e.shape[0];r=V(r,[s,r.shape[0]/s,r.shape[1]]),i.dispose()}return r}const WB=U({irfft_:YEe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function KEe(e,t,n=0){const i={x:O(e,"x","split")},s={numOrSizeSplits:t,axis:n};return z.runKernel(Cw,i,s)}const ks=U({split_:KEe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ZEe(e,t){N(e.dtype==="float32",()=>`The dtype for rfft() must be real value but got ${e.dtype}`);let n=e.shape[e.shape.length-1];const r=e.size/n;let i;if(t!=null&&t<n){const p=e.shape.map(m=>0),g=e.shape.map(m=>m);g[e.shape.length-1]=t,i=wt(e,p,g),n=t}else if(t!=null&&t>n){const p=e.shape.map(g=>g);p[e.shape.length-1]=t-n,i=lr([e,Hn(p)],e.shape.length-1),n=t}else i=e;const s=xt(i),o=V(Rf(i,s),[r,n]),a=tI(o),u=Math.floor(n/2)+1,l=Xx(a),c=jT(a),f=ks(l,[u,n-u],l.shape.length-1),h=ks(c,[u,n-u],c.shape.length-1),d=i.shape.slice();return d[i.shape.length-1]=u,V(Rf(f[0],h[0]),d)}const nI=U({rfft_:ZEe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function JEe(e,t){let n=O(e,"a","squaredDifference"),r=O(t,"b","squaredDifference");[n,r]=$n(n,r),Ze(n.shape,r.shape);const i={a:n,b:r},s={};return z.runKernel(R1,i,s)}const VB=U({squaredDifference_:JEe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function QEe(e,t){const n=O(e,"x","squeeze","string_or_numeric");return V(n,bc(n.shape,t).newShape)}const ug=U({squeeze_:QEe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function e_e(e,t=0){const n=jx(e,"tensors","stack","string_or_numeric");N(n.length>=1,()=>"Pass at least one tensor to tf.stack"),n.length>0&&N(t<=n[0].rank,()=>"Axis must be <= rank of the tensor");const r=n,i={axis:t};return z.runKernel(fw,r,i)}const ac=U({stack_:e_e});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function t_e(e,t=0){const r={x:O(e,"x","step")},i={alpha:t};return z.runKernel(z1,r,i)}const W1=U({step_:t_e});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function n_e(e,t,n,r,i=0,s=0,o=0,a=0,u=0){const c={x:O(e,"x","stridedSlice","string_or_numeric")},f={begin:t,end:n,strides:r,beginMask:i,endMask:s,ellipsisMask:o,newAxisMask:a,shrinkAxisMask:u};return z.runKernel(TT,c,f)}const Zte=U({stridedSlice_:n_e});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function r_e(e){const n={x:O(e,"x","tan","float32")};return z.runKernel(L1,n)}const Jte=U({tan_:r_e});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mi(e,t){eg(e);const n=Ru(e,t);if(n.length!==1)throw new Error("tensor1d() requires values to be a flat/TypedArray");return Sh(e,null,n,t)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Bl(e,t,n){if(eg(e),t!=null&&t.length!==2)throw new Error("tensor2d() requires shape to have two numbers");const r=Ru(e,n);if(r.length!==2&&r.length!==1)throw new Error("tensor2d() requires values to be number[][] or flat/TypedArray");if(r.length===1&&t==null)throw new Error("tensor2d() requires shape to be provided when `values` are a flat/TypedArray");return Sh(e,t,r,n)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Qte(e,t,n){if(eg(e),t!=null&&t.length!==3)throw new Error("tensor3d() requires shape to have three numbers");const r=Ru(e,n);if(r.length!==3&&r.length!==1)throw new Error("tensor3d() requires values to be number[][][] or flat/TypedArray");if(r.length===1&&t==null)throw new Error("tensor3d() requires shape to be provided when `values` are a flat array");return Sh(e,t,r,n)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function i_e(e,t,n){if(eg(e),t!=null&&t.length!==4)throw new Error("tensor4d() requires shape to have four numbers");const r=Ru(e,n);if(r.length!==4&&r.length!==1)throw new Error("tensor4d() requires values to be number[][][][] or flat/TypedArray");if(r.length===1&&t==null)throw new Error("tensor4d() requires shape to be provided when `values` are a flat array");return Sh(e,t,r,n)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function s_e(e,t,n){if(eg(e),t!=null&&t.length!==5)throw new Error("tensor5d() requires shape to have five numbers");const r=Ru(e,n);if(r.length!==5&&r.length!==1)throw new Error("tensor5d() requires values to be number[][][][][] or flat/TypedArray");if(r.length===1&&t==null)throw new Error("tensor5d() requires shape to be provided when `values` are a flat array");return Sh(e,t,r,n)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function o_e(e,t,n){if(eg(e),t!=null&&t.length!==6)throw new Error("tensor6d() requires shape to have six numbers");const r=Ru(e,n);if(r.length!==6&&r.length!==1)throw new Error("tensor6d() requires values to be number[][][][][][] or flat/TypedArray");if(r.length===1&&t==null)throw new Error("tensor6d() requires shape to be provided when `values` are a flat array");return t=t||r,Sh(e,t,r,n)}function GB(e,t,n){const r=t.rank>1?t.shape[t.rank-1]:1,i=t.rank>1?t.rank-1:1,s=`Must have updates.shape = indices.shape[:batchDim] + shape[sliceDim:], got updates.shape: ${n.shape}, indices.shape: ${t.shape}, shape: ${e}, sliceDim: ${r}, and batchDim: ${i}.`;if(n.rank<i)throw new Error(s+` update.rank < ${i}. `);if(e.length<r+(n.rank-i))throw new Error(s+` Output shape length < ${r+(n.rank-i)}`);if(n.rank!==i+e.length-r)throw new Error(s+` update.rank != ${i+e.length-r}`);for(let o=0;o<i;++o)if(n.shape[o]!==t.shape[o])throw new Error(s+` updates.shape[${o}] (${n.shape[o]}) != indices.shape[${o}] (${t.shape[o]}).`);for(let o=0;o<n.rank-i;++o)if(n.shape[o+i]!==e[o+r])throw new Error(s+` updates.shape[${o+i}] (${n.shape[o+i]}) != shape[${o+i}] (${e[o+i]})`)}function rI(e,t,n){if(t.rank<1)throw new Error(`tf.scatterND() expects the indices to be rank 1 or higher, but the rank was ${t.rank}.`);if(e.rank<1)throw new Error(`tf.scatterND() expects the updates to be rank 1 or higher, but the rank was ${e.rank}.`);if(t.dtype!=="int32")throw new Error(`The dtype of 'indices' should be int32, but got dtype: ${t.dtype}`);if(n.length<1)throw new Error(`Output rank must be greater or equal to 1, but got shape: ${n}`);if(n.length===0){if(t.size===0)throw new Error(`Indices specified for empty output. indices shape: ${t.shape}`);if(e.size===0)throw new Error(`Updates specified for empty output. updates shape: ${e.shape}`)}GB(n,t,e)}function Th(e,t,n){const r=t.shape.length,i=r>1?t.shape[r-1]:1,s=n.length;let o=1;for(let f=i;f<s;++f)o*=n[f];const a=i<1?1:i,u=te(t.shape)/a,l=[...Me(n.slice(0,i)),1],c=te(n);return{sliceRank:i,numUpdates:u,sliceSize:o,strides:l,outputSize:c}}const a_e=Object.freeze(Object.defineProperty({__proto__:null,calculateShapes:Th,validateInput:rI,validateUpdateShape:GB},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function u_e(e,t,n){const r=O(e,"tensor","tensorScatterupdate"),i=O(t,"indices","tensorScatterupdate","int32"),s=O(n,"updates","tensorScatterupdate");if(rI(s,i,r.shape),r.dtype!==s.dtype)throw new Error(`tensor and updates must have the same dtype, instead they are ${r.dtype} and ${s.dtype}.`);const o={tensor:r,indices:i,updates:s},a={};return z.runKernel(wT,o,a)}const l_e=U({tensorScatterUpdate_:u_e});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function c_e(e,t=1,n=!0){const r=O(e,"x","topk");if(r.rank===0)throw new Error("topk() expects the input to be of rank 1 or higher");const i=r.shape[r.shape.length-1];if(t<0)throw new Error(`'k' passed to topk() must be >= 0 but got ${t}`);if(t>i)throw new Error(`'k' passed to topk() must be <= the last dimension (${i}) but got ${t}`);const s={x:r},o={k:t,sorted:n},[a,u]=z.runKernel(FT,s,o);return{values:a,indices:u}}const ene=U({topk_:c_e});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function f_e(e,t=0,n=1,r,i){if(Ps(e),r!=null&&r==="bool")throw new Error("Unsupported data type $ { dtype }");const s=new FB(t,n,r,!0,i),o=rt(e,r);for(let a=0;a<o.values.length;a++)o.values[a]=s.nextValue();return o.toTensor()}const HB=U({truncatedNormal_:f_e});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function h_e(e,t=0){const n=O(e,"x","unique","string_or_numeric");N(n.rank>0,()=>"The input tensor must be at least 1D");const r={x:n},i={axis:t},[s,o]=z.runKernel(RT,r,i);return{values:s,indices:o}}const tne=U({unique_:h_e});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function d_e(e,t,n){const r=O(e,"x","unsortedSegmentSum"),i=O(t,"segmentIds","unsortedSegmentSum","int32");N(dp(n),()=>"numSegments must be of dtype int");const s={x:r,segmentIds:i},o={numSegments:n};return z.runKernel(_w,s,o)}const qB=U({unsortedSegmentSum_:d_e});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function p_e(e,t=0){const n=O(e,"x","unstack","string_or_numeric");N(t>=-n.shape.length&&t<n.shape.length,()=>`Axis = ${t} is not in [-${n.shape.length}, ${n.shape.length})`);const r={value:n},i={axis:t};return z.runKernel(Ew,r,i)}const Bf=U({unstack_:p_e});/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function g_e(e,t){return SB(e,t,"right")}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nne(e,t=!0,n,r){return z.makeVariable(e,t,n,r)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function iI(e,t){const n=[];for(let s=0;s<t.length;s++)t[s]&&n.push(s);const r=rt(e,"int32"),i=rt([n.length,e.length],"int32");for(let s=0;s<n.length;s++){const o=r.indexToLoc(n[s]),a=s*e.length;i.values.set(o,a)}return i.toTensor()}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function m_e(e){const t=O(e,"condition","whereAsync","bool"),n=await t.data(),r=iI(t.shape,n);return e!==t&&t.dispose(),r}const rne=m_e;/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function y_e(e,t,n){const r=O(e,"tensor","boolMask"),i=O(t,"mask","boolMask","bool"),s=n??0,o=i.rank,a=r.shape;N(o>0,()=>"mask cannot be scalar"),Fr(a.slice(s,s+o),i.shape,"mask's shape must match the first K dimensions of tensor's shape,");let u=1;for(let g=s;g<s+o;g++)u*=a[g];const l=a.slice(0,s).concat([u],a.slice(s+o)),c=V(r,l),f=V(i,[-1]),h=await rne(f),d=ug(h,[1]),p=Lw(c,d,s);return e!==r&&r.dispose(),t!==i&&i.dispose(),d.dispose(),c.dispose(),f.dispose(),h.dispose(),p}const b_e=y_e;/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function x_e(e,t,n){const r=O(e,"x","transpose");if(t==null&&(t=r.shape.map((o,a)=>a).reverse()),N(r.rank===t.length,()=>`Error in transpose: rank of input ${r.rank} must match length of perm ${t}.`),t.forEach(o=>{N(o>=0&&o<r.rank,()=>`All entries in 'perm' must be between 0 and ${r.rank-1} but got ${t}`)}),r.rank<=1)return r.clone();const i={x:r},s={perm:t};return r.dtype==="complex64"?Z(()=>{let o=Xx(r),a=jT(r);return o=z.runKernel(Kd,{x:o},s),a=z.runKernel(Kd,{x:a},s),n&&(a=un(a)),Rf(o,a)}):z.runKernel(Kd,i,s)}const mt=U({transpose_:x_e});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function v_e(e,t,n,r,i=!0){const s=O(e,"v","movingAverage"),o=O(t,"x","movingAverage"),a=O(n,"decay","movingAverage");Pee(s,o),N(bt(s.shape,o.shape),()=>"Shape mismatch in v and x");const u=qe(1),l=_e(u,a);let c=j(_e(o,s),l);if(i){N(r!=null,()=>"When using zeroDebias: true, step is required.");const f=O(r,"step","movingAverage");c=Re(c,_e(u,Pf(a,f)))}return ce(s,c)}const w_e=U({movingAverage_:v_e});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $_e(e,t,n){Ps(n);const r=O(e,"indices","scatterND","int32"),i=O(t,"updates","scatterND");rI(i,r,n);const s={indices:r,updates:i},o={shape:n};return z.runKernel(vT,s,o)}const C_e=U({scatterND_:$_e});function S_e(e,t,n,r){if(e.dtype!=="int32")throw new Error(`tf.sparseToDense() expects the indices to be int32 type, but the dtype was ${e.dtype}.`);if(e.rank>2)throw new Error(`sparseIndices should be a scalar, vector, or matrix, but got shape ${e.shape}.`);const i=e.rank>0?e.shape[0]:1,s=e.rank>1?e.shape[1]:1;if(n.length!==s)throw new Error(`outputShape has incorrect number of elements:, ${n.length}, should be: ${s}.`);const o=t.size;if(!(t.rank===0||t.rank===1&&o===i))throw new Error(`sparseValues has incorrect shape ${t.shape}, should be [] or [${i}]`);if(t.dtype!==r.dtype)throw new Error("sparseValues.dtype must match defaultValues.dtype")}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function k_e(e,t,n,r=0){Ps(n);const i=O(e,"sparseIndices","sparseToDense","int32"),s=O(t,"sparseValues","sparseToDense","string_or_numeric"),o=O(r,"defaultValue","sparseToDense",s.dtype);S_e(i,s,n,o);const a={sparseIndices:i,sparseValues:s,defaultValue:o},u={outputShape:n};return z.runKernel(_T,a,u)}const E_e=U({sparseToDense_:k_e});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function __e(e,t){const n=O(t,"indices","gatherND","int32"),i={params:O(e,"x","gatherND","string_or_numeric"),indices:n};return z.runKernel(tT,i)}const A_e=U({gatherND_:__e});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function T_e(e,t){if(t==null)return e.shape.slice();if(bt(e.shape,t))return t;if(e.shape.length===t.length){const n=[];for(let r=0;r<e.shape.length;r++)t[r]==null&&e.shape[r]!=null?n.push(e.shape[r]):n.push(t[r]);return n}return t}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function I_e(e,t,n,r){const i=O(e,"x","dropout");if(N(i.dtype==="float32",()=>`x has to be a floating point tensor since it's going to be scaled, but got a ${i.dtype} tensor instead.`),N(t>=0&&t<1,()=>`rate must be a float in the range [0, 1), but got ${t}.`),t===0)return e instanceof Pt?i.clone():i;const s=T_e(i,n),o=1-t,a=Re(Mw(ce(ag(s,0,1,"float32",r),o)),o);return j(i,a)}const ine=U({dropout_:I_e});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sne(e){return Math.floor(Math.pow(2,Math.ceil(Math.log(e)/Math.log(2))))}function XB(e,t,n){const r=1-e%2,i=new Float32Array(e);for(let s=0;s<e;++s){const o=2*Math.PI*s/(e+r-1);i[s]=t-n*Math.cos(o)}return mi(i,"float32")}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function D_e(e,t,n=1){const r=O(e,"predictions","inTopK"),i=O(t,"targets","inTopK");N(r.rank>1,()=>`inTopK() expects the predictions to be of rank 2 or higher, but got ${r.rank}`),N(r.rank-1===i.rank,()=>`predictions rank should be 1 larger than targets rank, but got predictions rank ${r.rank} and targets rank ${i.rank}`),Fr(r.shape.slice(0,r.shape.length-1),i.shape,"predictions's shape should be align with the targets' shape, except the last dimension.");const s=r.shape[r.shape.length-1];N(n>0&&n<=s,()=>`'k' passed to inTopK() must be > 0 && <= the predictions last dimension (${s}), but got ${n}`);const o=await r.data(),a=await i.data(),[u,l]=[o.length/s,s],c=hr("bool",u);for(let f=0;f<u;f++){const h=f*l,d=o.subarray(h,h+l),p=[];for(let g=0;g<d.length;g++)p.push({value:d[g],index:g});p.sort((g,m)=>m.value-g.value),c[f]=0;for(let g=0;g<n;g++)if(p[g].index===a[f]){c[f]=1;break}}return e!==r&&r.dispose(),t!==i&&i.dispose(),Zd(c,i.shape,"bool")}const N_e=D_e;/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function F_e(e,t,n,r,i,s="NHWC",o){let a=e;e.rank===3&&(a=V(e,[1,e.shape[0],e.shape[1],e.shape[2]]));let u=t;u.rank===3&&(u=V(t,[1,t.shape[0],t.shape[1],t.shape[2]])),N(a.rank===4,()=>`Error in conv2dDerFilter: input must be rank 4, but got shape ${a.shape}.`),N(u.rank===4,()=>`Error in conv2dDerFilter: dy must be rank 4, but got shape ${u.shape}.`),N(n.length===4,()=>`Error in conv2dDerFilter: filterShape must be length 4, but got ${n}.`);const l=s==="NHWC"?a.shape[3]:a.shape[1],c=s==="NHWC"?u.shape[3]:u.shape[1];N(l===n[2],()=>`Error in conv2dDerFilter: depth of input ${l}) must match input depth in filter (${n[2]}.`),N(c===n[3],()=>`Error in conv2dDerFilter: depth of dy (${c}) must match output depth for filter (${n[3]}).`),Di("conv2dDerFilter",i,o);const f={x:a,dy:u},h={strides:r,pad:i,dataFormat:s,dimRoundingMode:o,filterShape:n};return z.runKernel(BA,f,h)}const YB=U({conv2DBackpropFilter_:F_e});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sI(e,t,n){if(n==null||n==="linear")return e;if(n==="relu")return j(e,W1(t));throw new Error(`Cannot compute gradient for fused activation ${n}.`)}function oI(e,t){let n=t;const r=Un(e.shape,t.shape);return r.length>0&&(n=Ae(n,r)),V(n,e.shape)}function aI(e,t,n,r){if(t==="linear")return e;if(t==="relu")return Zu(e);if(t==="elu")return Ow(e);if(t==="relu6")return RB(e);if(t==="prelu")return KT(e,n);if(t==="leakyrelu")return WT(e,r);if(t==="sigmoid")return $u(e);throw new Error(`Unknown fused activation ${t}.`)}const uI=(e,t)=>!(e>0)||t==="linear";/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function O_e({x:e,filter:t,strides:n,pad:r,dataFormat:i="NHWC",dilations:s=[1,1],dimRoundingMode:o,bias:a,activation:u="linear",preluActivationWeights:l,leakyreluAlpha:c}){if(u=u||"linear",uI(z.state.gradientDepth,u)===!1){N(i==="NHWC",()=>`Error in fused conv2d: got dataFormat of ${i} but only NHWC is currently supported for the case of gradient depth is 0 and the activation is not linear.`);let C=Lf(e,t,n,r,i,s,o);return a!=null&&(C=ce(C,a)),aI(C,u,l,c)}const f=O(e,"x","conv2d","float32"),h=O(t,"filter","conv2d","float32");let d=f,p=!1;f.rank===3&&(p=!0,d=V(f,[1,f.shape[0],f.shape[1],f.shape[2]])),N(d.rank===4,()=>`Error in fused conv2d: input must be rank 4, but got rank ${d.rank}.`),N(h.rank===4,()=>`Error in fused conv2d: filter must be rank 4, but got rank ${h.rank}.`),Di("fused conv2d",r,o);const g=i==="NHWC"?d.shape[3]:d.shape[1];N(h.shape[2]===g,()=>`Error in conv2d: depth of input (${g}) must match input depth for filter ${h.shape[2]}.`),N(Or(n,s),()=>`Error in conv2D: Either strides or dilations must be 1. Got strides ${n} and dilations '${s}'`);const m=dr(d.shape,h.shape,n,s,r,o);let y;a!=null&&(y=O(a,"bias","fused conv2d"),[y]=$n(y,f),i==="NHWC"?Ze(m.outShape,y.shape):(N(y.shape.length<=1,()=>`Error in fused conv2d: only supports scalar or 1-D Tensor bias for NCHW format but got the bias of rank-${y.shape.length}.`),N(y.shape.length===0||y.shape[0]===m.outChannels||y.shape[0]===1,()=>`Error in fused conv2d: bias shape (${y.shape}) is not compatible with the number of output channels (${m.outChannels})`)));let b;if(l!=null){const C=l.shape;if(N(C.length<=1||C.length===3,()=>`Error in fused conv2d: only supports scalar, 1-D Tensor or 3-D Tensor PReLU activation weights but got a tensor of rank-${C.length}.`),C.length===1)N(C[0]===1||C[0]===m.outChannels,()=>`Error in fused conv2d: PReLU activation weights (${C}) is not compatible with the number of output channels (${m.outChannels}).`);else if(C.length===3)try{Ze(C,m.outShape)}catch{const S=`Error in fused conv2d: PReLU activation weights (${C}) is not compatible with the output shape of the conv2d (${m.outShape}).`;throw Error(S)}b=O(l,"prelu weights","fused conv2d")}const v=(C,$)=>{N(i==="NHWC",()=>`Error in gradient of fused conv2D: got dataFormat of ${i} but only NHWC is currently supported.`);const[S,k,E,_]=$,D=sI(C,E,u);N(Mf(s),()=>`Error in gradient of fused conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${s}'`);const A=gB(k.shape,D,S,n,r),T=YB(k,D,S.shape,n,r),I=[A,T];if(_!=null){const F=oI(_,D);I.push(F)}return I},x={x:d,filter:h,bias:y,preluActivationWeights:b},w={strides:n,pad:r,dataFormat:i,dilations:s,dimRoundingMode:o,activation:u,leakyreluAlpha:c};return a==null?Mu(($,S,k)=>{let E=z.runKernel(Lx,x,w);return k([S,$,E]),p&&(E=V(E,[E.shape[1],E.shape[2],E.shape[3]])),{value:E,gradFunc:v}})(d,h):Mu(($,S,k,E)=>{let _=z.runKernel(Lx,x,w);return E([S,$,_,k]),p&&(_=V(_,[_.shape[1],_.shape[2],_.shape[3]])),{value:_,gradFunc:v}})(d,h,y)}const one=U({fusedConv2d_:O_e});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function R_e(e,t,n,r,i,s=[1,1],o){let a=e;e.rank===3&&(a=V(e,[1,e.shape[0],e.shape[1],e.shape[2]]));let u=t;u.rank===3&&(u=V(t,[1,t.shape[0],t.shape[1],t.shape[2]]));const l={x:a,dy:u},c={strides:r,pad:i,dimRoundingMode:o,dilations:s,filterShape:n};return z.runKernel(HA,l,c)}const ane=U({depthwiseConv2dNativeBackpropFilter_:R_e});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function M_e(e,t,n,r,i,s=[1,1],o){let a=t,u=!1;t.rank===3&&(u=!0,a=V(t,[1,t.shape[0],t.shape[1],t.shape[2]]));const l={dy:a,filter:n},c={strides:r,pad:i,dimRoundingMode:o,dilations:s,inputShape:e},f=z.runKernel(qA,l,c);return u?V(f,[f.shape[1],f.shape[2],f.shape[3]]):f}const une=U({depthwiseConv2dNativeBackpropInput_:M_e});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function L_e({x:e,filter:t,strides:n,pad:r,dataFormat:i="NHWC",dilations:s=[1,1],dimRoundingMode:o,bias:a,activation:u="linear",preluActivationWeights:l,leakyreluAlpha:c}){if(uI(z.state.gradientDepth,u)===!1){let w=Fw(e,t,n,r,i,s,o);return a!=null&&(w=ce(w,a)),aI(w,u,l,c)}const f=O(e,"x","depthwiseConv2d","float32"),h=O(t,"filter","depthwiseConv2d","float32");let d=f,p=!1;f.rank===3&&(p=!0,d=V(f,[1,f.shape[0],f.shape[1],f.shape[2]])),N(d.rank===4,()=>`Error in fused depthwiseConv2d: input must be rank 4, but got rank ${d.rank}.`),N(h.rank===4,()=>`Error in fused depthwiseConv2d: filter must be rank 4, but got rank ${h.rank}.`),N(d.shape[3]===h.shape[2],()=>`Error in fused depthwiseConv2d: number of input channels (${d.shape[3]}) must match the inChannels dimension in filter ${h.shape[2]}.`),s==null&&(s=[1,1]),N(Or(n,s),()=>`Error in fused depthwiseConv2d: Either strides or dilations must be 1. Got strides ${n} and dilations '${s}'`),Di("fused depthwiseConv2d",r,o);const g=dr(d.shape,h.shape,n,s,r,o,!0);let m;a!=null&&(m=O(a,"bias","fused conv2d"),[m]=$n(m,f),Ze(g.outShape,m.shape));let y;l!=null&&(y=O(l,"prelu weights","fused depthwiseConv2d"));const b=(w,C)=>{N(Mf(s),()=>`Error in gradient of fused depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations '${s}'`);const[$,S,k,E]=C,_=sI(w,k,u),D=une(S.shape,_,$,n,r,s,o),A=ane(S,_,$.shape,n,r,s,o);if(E!=null){const T=oI(m,_);return[D,A,T]}return[D,A]},v={x:d,filter:h,bias:m,preluActivationWeights:y},x={strides:n,pad:r,dataFormat:i,dilations:s,dimRoundingMode:o,activation:u,leakyreluAlpha:c};return a==null?Mu((C,$,S)=>{let k=z.runKernel(Px,v,x);return S([$,C,k]),p&&(k=V(k,[k.shape[1],k.shape[2],k.shape[3]])),{value:k,gradFunc:b}})(d,h):Mu((C,$,S,k)=>{let E=z.runKernel(Px,v,x);return k([$,C,E,S]),p&&(E=V(E,[E.shape[1],E.shape[2],E.shape[3]])),{value:E,gradFunc:b}})(d,h,m)}const P_e=U({fusedDepthwiseConv2d_:L_e});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function B_e({a:e,b:t,transposeA:n=!1,transposeB:r=!1,bias:i,activation:s="linear",preluActivationWeights:o,leakyreluAlpha:a=.2}){if(uI(z.state.gradientDepth,s)===!1){let _=ot(e,t,n,r);return i!=null&&(_=ce(_,i)),aI(_,s,o,a)}let u=O(e,"a","fused matMul"),l=O(t,"b","fused matMul");[u,l]=$n(u,l);const c=n?u.shape[u.rank-2]:u.shape[u.rank-1],f=r?l.shape[l.rank-1]:l.shape[l.rank-2],h=n?u.shape[u.rank-1]:u.shape[u.rank-2],d=r?l.shape[l.rank-2]:l.shape[l.rank-1],p=u.shape.slice(0,-2),g=l.shape.slice(0,-2),m=te(p),y=te(g);N(c===f,()=>`Error in fused matMul: inner shapes (${c}) and (${f}) of Tensors with shapes ${u.shape} and ${l.shape} and transposeA=${n} and transposeB=${r} must match.`);const v=Ze(u.shape.slice(0,-2),l.shape.slice(0,-2)).concat([h,d]),x=n?V(u,[m,c,h]):V(u,[m,h,c]),w=r?V(l,[y,d,f]):V(l,[y,f,d]);let C;i!=null&&(C=O(i,"bias","fused matMul"),[C]=$n(C,u),Ze(v,C.shape));let $;o!=null&&($=O(o,"prelu weights","fused matMul"));const S=(_,D)=>{const[A,T,I,F]=D,R=sI(V(_,I.shape),I,s);let L,P;if(!n&&!r?(L=ot(R,T,!1,!0),P=ot(A,R,!0,!1)):!n&&r?(L=ot(R,T,!1,!1),P=ot(R,A,!0,!1)):n&&!r?(L=ot(T,R,!1,!0),P=ot(A,R,!1,!1)):(L=ot(T,R,!0,!0),P=ot(R,A,!0,!0)),i!=null){const q=oI(F,R);return[L,P,q]}else return[L,P]},k={a:x,b:w,bias:C,preluActivationWeights:$},E={transposeA:n,transposeB:r,activation:s,leakyreluAlpha:a};return i==null?Mu((D,A,T)=>{const I=z.runKernel(Mx,k,E);return T([D,A,I]),{value:V(I,v),gradFunc:S}})(x,w):Mu((D,A,T,I)=>{const F=z.runKernel(Mx,k,E);return I([D,A,F,T]),{value:V(F,v),gradFunc:S}})(x,w,C)}const QR=U({fusedMatMul_:B_e});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const z_e=Object.freeze(Object.defineProperty({__proto__:null,conv2d:one,depthwiseConv2d:P_e,matMul:QR},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function U_e(e){return XB(e,.54,.46)}const j_e=U({hammingWindow_:U_e});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function W_e(e){return XB(e,.5,.5)}const lne=U({hannWindow_:W_e});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function V_e(e,t,n,r=!1,i=0){let s=0;const o=[];for(;s+t<=e.size;)o.push(wt(e,s,t)),s+=n;if(r)for(;s<e.size;){const a=s+t-e.size,u=lr([wt(e,s,t-a),U1([a],i)]);o.push(u),s+=n}return o.length===0?Bl([],[0,t]):V(lr(o),[o.length,t])}const cne=U({frame_:V_e});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function G_e(e,t,n,r,i=lne){r==null&&(r=sne(t));const s=cne(e,t,n),o=j(s,i(t));return nI(o,r)}const H_e=U({stft_:G_e});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function q_e(e,t,n,r,i="bilinear",s=0){const o=O(e,"image","cropAndResize"),a=O(t,"boxes","cropAndResize","float32"),u=O(n,"boxInd","cropAndResize","int32"),l=a.shape[0];N(o.rank===4,()=>`Error in cropAndResize: image must be rank 4,but got rank ${o.rank}.`),N(a.rank===2&&a.shape[1]===4,()=>`Error in cropAndResize: boxes must be have size [${l},4] but had shape ${a.shape}.`),N(u.rank===1&&u.shape[0]===l,()=>`Error in cropAndResize: boxInd must be have size [${l}] but had shape ${a.shape}.`),N(r.length===2,()=>`Error in cropAndResize: cropSize must be of length 2, but got length ${r.length}.`),N(r[0]>=1&&r[1]>=1,()=>`cropSize must be atleast [1,1], but was ${r}`),N(i==="bilinear"||i==="nearest",()=>`method must be bilinear or nearest, but was ${i}`);const c={image:o,boxes:a,boxInd:u},f={method:i,extrapolationValue:s,cropSize:r};return z.runKernel(WA,c,f)}const X_e=U({cropAndResize_:q_e});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Y_e(e){const t=O(e,"image","flipLeftRight","float32");N(t.rank===4,()=>`Error in flipLeftRight: image must be rank 4,but got rank ${t.rank}.`);const n={image:t};return z.runKernel(eT,n,{})}const K_e=U({flipLeftRight_:Y_e});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Z_e(e){const t=O(e,"image","grayscaleToRGB"),n=t.rank-1,r=t.shape[n];N(t.rank>=2,()=>`Error in grayscaleToRGB: images must be at least rank 2, but got rank ${t.rank}.`),N(r===1,()=>`Error in grayscaleToRGB: last dimension of a grayscale image should be size 1, but got size ${r}.`);const i=new Array(t.rank);return i.fill(1,0,n),i[n]=3,So(t,i)}const J_e=U({grayscaleToRGB_:Z_e});/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Q_e(e){const t=O(e,"image","RGBToGrayscale"),n=t.rank-1,r=t.shape[n];N(t.rank>=2,()=>`Error in RGBToGrayscale: images must be at least rank 2, but got rank ${t.rank}.`),N(r===3,()=>`Error in RGBToGrayscale: last dimension of an RGB image should be size 3, but got size ${r}.`);const i=t.dtype,s=we(t,"float32"),o=mi([.2989,.587,.114]);let a;switch(t.rank){case 2:a=pm("ij,j->i",s,o);break;case 3:a=pm("ijk,k->ij",s,o);break;case 4:a=pm("ijkl,l->ijk",s,o);break;case 5:a=pm("ijklm,m->ijkl",s,o);break;case 6:a=pm("ijklmn,n->ijklm",s,o);break;default:throw new Error("Not a valid tensor rank.")}return a=hi(a,-1),we(a,i)}const eAe=U({rgbToGrayscale_:Q_e});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tAe(e,t,n=0,r=.5){const i=O(e,"image","rotateWithOffset","float32");N(i.rank===4,()=>`Error in rotateWithOffset: image must be rank 4,but got rank ${i.rank}.`);const s={image:i},o={radians:t,fillValue:n,center:r};return z.runKernel(MT,s,o)}const nAe=U({rotateWithOffset_:tAe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function V1(e,t,n,r,i,s){r==null&&(r=.5),i==null&&(i=Number.NEGATIVE_INFINITY),s==null&&(s=0);const o=e.shape[0];return n=Math.min(n,o),N(0<=r&&r<=1,()=>`iouThreshold must be in [0, 1], but was '${r}'`),N(e.rank===2,()=>`boxes must be a 2D tensor, but was of rank '${e.rank}'`),N(e.shape[1]===4,()=>`boxes must have 4 columns, but 2nd dimension was ${e.shape[1]}`),N(t.rank===1,()=>"scores must be a 1D tensor"),N(t.shape[0]===o,()=>`scores has incompatible shape with boxes. Expected ${o}, but was ${t.shape[0]}`),N(0<=s&&s<=1,()=>`softNmsSigma must be in [0, 1], but was '${s}'`),{maxOutputSize:n,iouThreshold:r,scoreThreshold:i,softNmsSigma:s}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rAe(e,t,n,r=.5,i=Number.NEGATIVE_INFINITY){const s=O(e,"boxes","nonMaxSuppression","float32"),o=O(t,"scores","nonMaxSuppression","float32"),a=V1(s,o,n,r,i);n=a.maxOutputSize,r=a.iouThreshold,i=a.scoreThreshold;const u={maxOutputSize:n,iouThreshold:r,scoreThreshold:i};return z.runKernel(cT,{boxes:s,scores:o},u)}const iAe=U({nonMaxSuppression_:rAe});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sAe(e,t,n){const r=oAe(e,t,n),i=r<0?-(r+1):r;e.splice(i,0,t)}function oAe(e,t,n){return uAe(e,t,n||aAe)}function aAe(e,t){return e>t?1:e<t?-1:0}function uAe(e,t,n){let r=0,i=e.length,s=0,o=!1;for(;r<i;){s=r+(i-r>>>1);const a=n(t,e[s]);a>0?r=s+1:(i=s,o=!a)}return o?r:-r-1}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lI(e,t,n,r,i){return KB(e,t,n,r,i,0)}function cI(e,t,n,r,i,s){return KB(e,t,n,r,i,0,!1,s,!0)}function fI(e,t,n,r,i,s){return KB(e,t,n,r,i,s,!0)}function KB(e,t,n,r,i,s,o=!1,a=!1,u=!1){const l=[];for(let m=0;m<t.length;m++)t[m]>i&&l.push({score:t[m],boxIndex:m,suppressBeginIndex:0});l.sort(CV);const c=s>0?-.5/s:0,f=[],h=[];for(;f.length<n&&l.length>0;){const m=l.pop(),{score:y,boxIndex:b,suppressBeginIndex:v}=m;if(y<i)break;let x=!1;for(let w=f.length-1;w>=v;--w){const C=lAe(e,b,f[w]);if(C>=r){x=!0;break}if(m.score=m.score*cAe(r,c,C),m.score<=i)break}m.suppressBeginIndex=f.length,x||(m.score===y?(f.push(b),h.push(m.score)):m.score>i&&sAe(l,m,CV))}const d=f.length,p=n-d;a&&p>0&&(f.push(...new Array(p).fill(0)),h.push(...new Array(p).fill(0)));const g={selectedIndices:f};return o&&(g.selectedScores=h),u&&(g.validOutputs=d),g}function lAe(e,t,n){const r=e.subarray(t*4,t*4+4),i=e.subarray(n*4,n*4+4),s=Math.min(r[0],r[2]),o=Math.min(r[1],r[3]),a=Math.max(r[0],r[2]),u=Math.max(r[1],r[3]),l=Math.min(i[0],i[2]),c=Math.min(i[1],i[3]),f=Math.max(i[0],i[2]),h=Math.max(i[1],i[3]),d=(a-s)*(u-o),p=(f-l)*(h-c);if(d<=0||p<=0)return 0;const g=Math.max(s,l),m=Math.max(o,c),y=Math.min(a,f),b=Math.min(u,h),v=Math.max(y-g,0)*Math.max(b-m,0);return v/(d+p-v)}function cAe(e,t,n){const r=Math.exp(t*n*n);return n<=e?r:0}function CV(e,t){return e.score-t.score||e.score===t.score&&t.boxIndex-e.boxIndex}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function fAe(e,t,n,r=.5,i=Number.NEGATIVE_INFINITY){const s=O(e,"boxes","nonMaxSuppressionAsync"),o=O(t,"scores","nonMaxSuppressionAsync"),a=V1(s,o,n,r,i);n=a.maxOutputSize,r=a.iouThreshold,i=a.scoreThreshold;const u=await Promise.all([s.data(),o.data()]),l=u[0],c=u[1],{selectedIndices:f}=lI(l,c,n,r,i);return s!==e&&s.dispose(),o!==t&&o.dispose(),mi(f,"int32")}const hAe=fAe;/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dAe(e,t,n,r=.5,i=Number.NEGATIVE_INFINITY,s=0){const o=O(e,"boxes","nonMaxSuppression"),a=O(t,"scores","nonMaxSuppression"),u=V1(o,a,n,r,i,s);n=u.maxOutputSize,r=u.iouThreshold,i=u.scoreThreshold,s=u.softNmsSigma;const l={boxes:o,scores:a},c={maxOutputSize:n,iouThreshold:r,scoreThreshold:i,softNmsSigma:s},f=z.runKernel(hT,l,c);return{selectedIndices:f[0],selectedScores:f[1]}}const pAe=U({nonMaxSuppressionWithScore_:dAe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function gAe(e,t,n,r=.5,i=Number.NEGATIVE_INFINITY,s=0){const o=O(e,"boxes","nonMaxSuppressionAsync"),a=O(t,"scores","nonMaxSuppressionAsync"),u=V1(o,a,n,r,i,s);n=u.maxOutputSize,r=u.iouThreshold,i=u.scoreThreshold,s=u.softNmsSigma;const l=await Promise.all([o.data(),a.data()]),c=l[0],f=l[1],{selectedIndices:h,selectedScores:d}=fI(c,f,n,r,i,s);return o!==e&&o.dispose(),a!==t&&a.dispose(),{selectedIndices:mi(h,"int32"),selectedScores:mi(d)}}const mAe=gAe;/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yAe(e,t,n,r=.5,i=Number.NEGATIVE_INFINITY,s=!1){const o=O(e,"boxes","nonMaxSuppression"),a=O(t,"scores","nonMaxSuppression"),u=V1(o,a,n,r,i,null),l=u.maxOutputSize,c=u.iouThreshold,f=u.scoreThreshold,h={boxes:o,scores:a},d={maxOutputSize:l,iouThreshold:c,scoreThreshold:f,padToMaxOutputSize:s},p=z.runKernel(fT,h,d);return{selectedIndices:p[0],validOutputs:p[1]}}const bAe=U({nonMaxSuppressionPadded_:yAe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function xAe(e,t,n,r=.5,i=Number.NEGATIVE_INFINITY,s=!1){const o=O(e,"boxes","nonMaxSuppressionAsync"),a=O(t,"scores","nonMaxSuppressionAsync"),u=V1(o,a,n,r,i,null),l=u.maxOutputSize,c=u.iouThreshold,f=u.scoreThreshold,[h,d]=await Promise.all([o.data(),a.data()]),{selectedIndices:p,validOutputs:g}=cI(h,d,l,c,f,s);return o!==e&&o.dispose(),a!==t&&a.dispose(),{selectedIndices:mi(p,"int32"),validOutputs:qe(g,"int32")}}const vAe=xAe;/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wAe(e,t,n=!1,r=!1){const i=O(e,"images","resizeBilinear");N(i.rank===3||i.rank===4,()=>`Error in resizeBilinear: x must be rank 3 or 4, but got rank ${i.rank}.`),N(t.length===2,()=>`Error in resizeBilinear: new shape must 2D, but got shape ${t}.`),N(r===!1||n===!1,()=>"Error in resizeBilinear: If halfPixelCenters is true, alignCorners must be false.");let s=i,o=!1;i.rank===3&&(o=!0,s=V(i,[1,i.shape[0],i.shape[1],i.shape[2]]));const a={images:s},u={alignCorners:n,halfPixelCenters:r,size:t},l=z.runKernel(yw,a,u);return o?V(l,[l.shape[1],l.shape[2],l.shape[3]]):l}const fne=U({resizeBilinear_:wAe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $Ae(e,t,n=!1,r=!1){const i=O(e,"images","resizeNearestNeighbor");N(i.rank===3||i.rank===4,()=>`Error in resizeNearestNeighbor: x must be rank 3 or 4, but got rank ${i.rank}.`),N(t.length===2,()=>`Error in resizeNearestNeighbor: new shape must 2D, but got shape ${t}.`),N(i.dtype==="float32"||i.dtype==="int32",()=>"`images` must have `int32` or `float32` as dtype"),N(r===!1||n===!1,()=>"Error in resizeNearestNeighbor: If halfPixelCenters is true, alignCorners must be false.");let s=i,o=!1;i.rank===3&&(o=!0,s=V(i,[1,i.shape[0],i.shape[1],i.shape[2]]));const a={images:s},u={alignCorners:n,halfPixelCenters:r,size:t},l=z.runKernel(mw,a,u);return o?V(l,[l.shape[1],l.shape[2],l.shape[3]]):l}const hne=U({resizeNearestNeighbor_:$Ae});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function CAe(e,t="binary",n=!1,r=.5){const i=O(e,"image","threshold"),s=.2989,o=.587,a=.114,u=i.shape[0]*i.shape[1];let l=j(mi([r]),255),c,f,h,d;if(N(i.rank===3,()=>`Error in threshold: image must be rank 3,but got rank ${i.rank}.`),N(i.shape[2]===3||i.shape[2]===1,()=>`Error in threshold: image color channel must be equal to 3 or 1but got ${i.shape[2]}.`),N(i.dtype==="int32"||i.dtype==="float32",()=>`Error in dtype: image dtype must be int32 or float32,but got dtype ${i.dtype}.`),N(t==="otsu"||t==="binary",()=>`Method must be binary or otsu, but was ${t}`),i.shape[2]===3){[c,f,h]=ks(i,[1,1,1],-1);const m=j(c,s),y=j(f,o),b=j(h,a);d=ce(ce(m,y),b)}else d=e;if(t==="otsu"){const m=mte(we(MB(d),"int32"),Zd([]),256);l=SAe(m,u)}const p=n?sg(d,l):zs(d,l);return we(j(p,255),"int32")}function SAe(e,t){let n=mi([-1]),r=mi([0]),i=mi([0]),s,o,a,u,l,c;for(let f=0;f<e.size-1;f++){s=wt(e,0,f+1),o=wt(e,f+1),l=Re(Ae(s),t),c=Re(Ae(o),t);const h=Ae(j(s,Ym(0,s.size)));a=Re(h,Ae(s));const d=U1(o.shape,s.size),p=ce(Ym(0,o.size),d),g=j(o,p);u=Re(Ae(g),Ae(o));const m=_e(a,u),y=_e(a,u),b=j(l,c);i=j(j(b,m),y);const v=zs(i,r);r=Xr(v,i,r),n=Xr(v,mi([f]),n)}return n}const kAe=U({threshold_:CAe});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function EAe(e,t,n="nearest",r="constant",i=0,s){const o=O(e,"image","transform","float32"),a=O(t,"transforms","transform","float32");N(o.rank===4,()=>`Error in transform: image must be rank 4,but got rank ${o.rank}.`),N(a.rank===2&&(a.shape[0]===o.shape[0]||a.shape[0]===1)&&a.shape[1]===8,()=>"Error in transform: Input transform should be batch x 8 or 1 x 8"),N(s==null||s.length===2,()=>`Error in transform: outputShape must be [height, width] or null, but got ${s}.`);const u={image:o,transforms:a},l={interpolation:n,fillMode:r,fillValue:i,outputShape:s};return z.runKernel(OT,u,l)}const _Ae=U({transform_:EAe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function AAe(e,t,n){const r=O(e,"a","bandPart");N(r.rank>=2,()=>`bandPart(): Rank must be at least 2, got ${r.rank}.`);const i=r.shape,[s,o]=r.shape.slice(-2);let a,u;typeof t=="number"?(N(t%1===0,()=>`bandPart(): numLower must be an integer, got ${t}.`),N(t<=s,()=>`bandPart(): numLower (${t}) must not be greater than the number of rows (${s}).`),a=O(t<0?s:t,"numLower","bandPart")):(N(t.dtype==="int32",()=>"bandPart(): numLower's dtype must be an int32."),a=Xr(Hx(t,0),s,bp(t,s))),typeof n=="number"?(N(n%1===0,()=>`bandPart(): numUpper must be an integer, got ${n}.`),N(n<=o,()=>`bandPart(): numUpper (${n}) must not be greater than the number of columns (${o}).`),u=O(n<0?o:n,"numUpper","bandPart")):(N(n.dtype==="int32",()=>"bandPart(): numUpper's dtype must be an int32."),u=Xr(Hx(n,0),o,bp(n,o)));const l=V(Ym(0,s,1,"int32"),[-1,1]),c=Ym(0,o,1,"int32"),f=_e(l,c),h=Lu(sg(f,a),_h(f,un(u))),d=Hn([s,o],r.dtype);return V(ac(Bf(V(r,[-1,s,o])).map(p=>Xr(h,p,d))),i)}const TAe=U({bandPart_:AAe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function IAe(e){let t;if(Array.isArray(e)){t=!1,N(e!=null&&e.length>0,()=>"Gram-Schmidt process: input must not be null, undefined, or empty");const i=e[0].shape[0];for(let s=1;s<e.length;++s)N(e[s].shape[0]===i,()=>`Gram-Schmidt: Non-unique lengths found in the input vectors: (${e[s].shape[0]} vs. ${i})`)}else t=!0,e=ks(e,e.shape[0],0).map(i=>ug(i,[0]));N(e.length<=e[0].shape[0],()=>`Gram-Schmidt: Number of vectors (${e.length}) exceeds number of dimensions (${e[0].shape[0]}).`);const n=[],r=e;for(let i=0;i<e.length;++i)n.push(z.tidy(()=>{let s=r[i];if(i>0)for(let o=0;o<i;++o){const a=j(Ae(j(n[o],s)),n[o]);s=_e(s,a)}return Re(s,Rw(s,"euclidean"))}));return t?ac(n,0):n}const DAe=U({gramSchmidt_:IAe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function NAe(e,t=!1){if(N(e.rank>=2,()=>`qr() requires input tensor to have a rank >= 2, but got rank ${e.rank}`),e.rank===2)return SV(e,t);{const n=e.shape.slice(0,e.shape.length-2).reduce((u,l)=>u*l),r=Bf(V(e,[n,e.shape[e.shape.length-2],e.shape[e.shape.length-1]]),0),i=[],s=[];r.forEach(u=>{const[l,c]=SV(u,t);i.push(l),s.push(c)});const o=V(ac(i,0),e.shape),a=V(ac(s,0),e.shape);return[o,a]}}function SV(e,t=!1){return z.tidy(()=>{N(e.shape.length===2,()=>`qr2d() requires a 2D Tensor, but got a ${e.shape.length}D Tensor.`);const n=e.shape[0],r=e.shape[1];let i=vB(n),s=$f(e);const o=Bl([[1]],[1,1]);let a=$f(o);const u=n>=r?r:n;for(let l=0;l<u;++l){const c=s,f=a,h=i;[a,s,i]=z.tidy(()=>{const d=wt(s,[l,l],[n-l,1]),p=Rw(d),g=wt(s,[l,l],[1,1]),m=Xr(zs(g,0),Bl([[-1]]),Bl([[1]])),y=_e(g,j(m,p)),b=Re(d,y);b.shape[0]===1?a=$f(o):a=lr([o,wt(b,[1,0],[b.shape[0]-1,b.shape[1]])],0);const v=un(Re(ot(m,y),p)),x=wt(s,[l,0],[n-l,r]),w=j(v,a),C=mt(a);if(l===0)s=_e(x,ot(w,ot(C,x)));else{const k=_e(x,ot(w,ot(C,x)));s=lr([wt(s,[0,0],[l,r]),k],0)}const $=mt(w),S=wt(i,[0,l],[n,i.shape[1]-l]);if(l===0)i=_e(S,ot(ot(S,a),$));else{const k=_e(S,ot(ot(S,a),$));i=lr([wt(i,[0,0],[n,l]),k],1)}return[a,s,i]}),at([c,f,h])}return!t&&n>r&&(i=wt(i,[0,0],[n,r]),s=wt(s,[0,0],[r,r])),[i,s]})}const FAe=U({qr_:NAe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var di;(function(e){e[e.NONE=0]="NONE",e[e.MEAN=1]="MEAN",e[e.SUM=2]="SUM",e[e.SUM_BY_NONZERO_WEIGHTS=3]="SUM_BY_NONZERO_WEIGHTS"})(di||(di={}));function OAe(e,t,n=di.SUM_BY_NONZERO_WEIGHTS){const r=O(e,"losses","computeWeightedLoss");let i=null;t!=null&&(i=O(t,"weights","computeWeightedLoss"));const s=i==null?r:j(r,i);if(n===di.NONE)return s;if(n===di.SUM)return Ae(s);if(n===di.MEAN){if(i==null)return kn(s);{const o=r.size/i.size,a=Re(Ae(s),Ae(i));return o>1?Re(a,qe(o)):a}}if(n===di.SUM_BY_NONZERO_WEIGHTS){if(i==null)return Re(Ae(s),qe(r.size));{const o=j(i,Ys(r.shape)),a=we(Ae(Xm(o,qe(0))),"float32");return Re(Ae(s),a)}}throw Error(`Unknown reduction: ${n}`)}const Cc=U({computeWeightedLoss_:OAe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function RAe(e,t,n,r=di.SUM_BY_NONZERO_WEIGHTS){const i=O(e,"labels","absoluteDifference"),s=O(t,"predictions","absoluteDifference");let o=null;n!=null&&(o=O(n,"weights","absoluteDifference")),Fr(i.shape,s.shape,"Error in absoluteDifference: ");const a=Gn(_e(i,s));return Cc(a,o,r)}const MAe=U({absoluteDifference_:RAe});function LAe(e,t,n,r,i=di.SUM_BY_NONZERO_WEIGHTS){const s=O(e,"labels","cosineDistance"),o=O(t,"predictions","cosineDistance");let a=null;r!=null&&(a=O(r,"weights","cosineDistance")),Fr(s.shape,o.shape,"Error in cosineDistance: ");const u=qe(1),l=_e(u,Ae(j(s,o),n,!0));return Cc(l,a,i)}const PAe=U({cosineDistance_:LAe});function BAe(e,t,n,r=di.SUM_BY_NONZERO_WEIGHTS){let i=O(e,"labels","hingeLoss");const s=O(t,"predictions","hingeLoss");let o=null;n!=null&&(o=O(n,"weights","hingeLoss")),Fr(i.shape,s.shape,"Error in hingeLoss: ");const a=qe(1);i=_e(j(qe(2),i),a);const u=Zu(_e(a,j(i,s)));return Cc(u,o,r)}const zAe=U({hingeLoss_:BAe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function UAe(e,t,n,r=1,i=di.SUM_BY_NONZERO_WEIGHTS){const s=O(e,"labels","huberLoss"),o=O(t,"predictions","huberLoss");let a=null;n!=null&&(a=O(n,"weights","huberLoss")),Fr(s.shape,o.shape,"Error in huberLoss: ");const u=qe(r),l=Gn(_e(o,s)),c=bp(l,u),f=_e(l,c),h=ce(j(qe(.5),Xt(c)),j(u,f));return Cc(h,a,i)}const jAe=U({huberLoss_:UAe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function WAe(e,t,n,r=1e-7,i=di.SUM_BY_NONZERO_WEIGHTS){const s=O(e,"labels","logLoss"),o=O(t,"predictions","logLoss");let a=null;n!=null&&(a=O(n,"weights","logLoss")),Fr(s.shape,o.shape,"Error in logLoss: ");const u=qe(1),l=qe(r),c=un(j(s,ro(ce(o,l)))),f=j(_e(u,s),ro(ce(_e(u,o),l))),h=_e(c,f);return Cc(h,a,i)}const VAe=U({logLoss_:WAe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function GAe(e,t,n,r=di.SUM_BY_NONZERO_WEIGHTS){const i=O(e,"labels","meanSquaredError"),s=O(t,"predictions","meanSquaredError");let o=null;n!=null&&(o=O(n,"weights","meanSquaredError")),Fr(i.shape,s.shape,"Error in meanSquaredError: ");const a=VB(i,s);return Cc(a,o,r)}const HAe=U({meanSquaredError_:GAe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qAe(e,t){const n=O(e,"labels","sigmoidCrossEntropyWithLogits"),r=O(t,"logits","sigmoidCrossEntropyWithLogits");Fr(n.shape,r.shape,"Error in sigmoidCrossEntropyWithLogits: ");const i=Zu(r),s=j(r,n),o=VT(no(un(Gn(r))));return ce(_e(i,s),o)}function XAe(e,t,n,r=0,i=di.SUM_BY_NONZERO_WEIGHTS){let s=O(e,"multiClassLabels","sigmoidCrossEntropy");const o=O(t,"logits","sigmoidCrossEntropy");let a=null;if(n!=null&&(a=O(n,"weights","sigmoidCrossEntropy")),Fr(s.shape,o.shape,"Error in sigmoidCrossEntropy: "),r>0){const l=qe(r),c=qe(1),f=qe(.5);s=ce(j(s,_e(c,l)),j(f,l))}const u=qAe(s,o);return Cc(u,a,i)}const YAe=U({sigmoidCrossEntropy_:XAe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function KAe(e,t,n=-1){if(n===-1&&(n=t.rank-1),n!==t.rank-1)throw Error(`Softmax cross entropy along a non-last dimension is not yet supported. Labels / logits was rank ${t.rank} and dim was ${n}`);return Mu((i,s,o)=>{const u=$B(s,[n],!0),l=_e(we(s,"float32"),u);o([i,l]);const c=un(j(l,i));return{value:Ae(c,[n]),gradFunc:(d,p)=>{const[g,m]=p,y=Fn(d.shape,[n]);return[j(V(d,y),_e(we(g,"float32"),no(m))),j(V(d,y),_e(no(m),we(g,"float32")))]}}})(e,t)}function ZAe(e,t,n,r=0,i=di.SUM_BY_NONZERO_WEIGHTS){let s=O(e,"onehotLabels","softmaxCrossEntropy");const o=O(t,"logits","softmaxCrossEntropy");let a=null;if(n!=null&&(a=O(n,"weights","softmaxCrossEntropy")),Fr(s.shape,o.shape,"Error in softmaxCrossEntropy: "),r>0){const l=qe(r),c=qe(1),f=qe(s.shape[1]);s=ce(j(s,_e(c,l)),Re(l,f))}const u=KAe(s,o);return Cc(u,a,i)}const JAe=U({softmaxCrossEntropy_:ZAe});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function QAe(e,t,n,r){const i=O(e,"indices","sparseFillEmptyRows","int32"),s=O(t,"values","sparseFillEmptyRows"),o=O(n,"denseShape","sparseFillEmptyRows","int32"),a=O(r,"defaultValue","sparseFillEmptyRows",s.dtype);if(i.rank!==2)throw new Error(`Indices should be Tensor2D but received shape
        ${i.shape}`);if(s.rank!==1)throw new Error(`Values should be Tensor1D but received shape ${s.shape}`);if(o.rank!==1)throw new Error(`Dense shape should be Tensor1D but received shape ${o.shape}`);if(a.rank!==0)throw new Error(`Default value should be a scalar but received shape ${a.shape}`);const u={indices:i,values:s,denseShape:o,defaultValue:a},l=z.runKernel(CT,u);return{outputIndices:l[0],outputValues:l[1],emptyRowIndicator:l[2],reverseIndexMap:l[3]}}const eTe=U({sparseFillEmptyRows_:QAe});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tTe(e,t,n){const r=O(e,"inputIndices","sparseReshape","int32"),i=O(t,"inputShape","sparseReshape","int32"),s=O(n,"newShape","sparseReshape","int32");if(r.rank!==2)throw new Error(`Input indices should be Tensor2D but received shape
        ${r.shape}`);if(i.rank!==1)throw new Error(`Input shape should be Tensor1D but received shape ${i.shape}`);if(s.rank!==1)throw new Error(`New shape should be Tensor1D but received shape ${s.shape}`);const o={inputIndices:r,inputShape:i,newShape:s},a=z.runKernel(ST,o);return{outputIndices:a[0],outputShape:a[1]}}const nTe=U({sparseReshape_:tTe});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rTe(e,t,n){const r=O(e,"data","sparseSegmentMean"),i=O(t,"indices","sparseSegmentMean","int32"),s=O(n,"segmentIds","sparseSegmentMean","int32");if(r.rank<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(i.rank!==1)throw new Error(`Indices should be Tensor1D but received shape
          ${i.shape}`);if(s.rank!==1)throw new Error(`Segment ids should be Tensor1D but received shape
          ${s.shape}`);const o={data:r,indices:i,segmentIds:s};return z.runKernel(kT,o)}const iTe=U({sparseSegmentMean_:rTe});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sTe(e,t,n){const r=O(e,"data","sparseSegmentSum"),i=O(t,"indices","sparseSegmentSum","int32"),s=O(n,"segmentIds","sparseSegmentSum","int32");if(r.rank<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(i.rank!==1)throw new Error(`Indices should be Tensor1D but received shape
         ${i.shape}`);if(s.rank!==1)throw new Error(`Segment ids should be Tensor1D but received shape
         ${s.shape}`);const o={data:r,indices:i,segmentIds:s};return z.runKernel(ET,o)}const oTe=U({sparseSegmentSum_:sTe});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function aTe(e,t,n,r,i,s,o,a){const u=O(e,"data","stringNGrams","string");if(u.dtype!=="string")throw new Error("Data must be of datatype string");if(u.shape.length!==1)throw new Error(`Data must be a vector, saw: ${u.shape}`);const l=O(t,"dataSplits","stringNGrams");if(l.dtype!=="int32")throw new Error("Data splits must be of datatype int32");const c={separator:n,nGramWidths:r,leftPad:i,rightPad:s,padWidth:o,preserveShortSequences:a},f={data:u,dataSplits:l},h=z.runKernel(IT,f,c);return{nGrams:h[0],nGramsSplits:h[1]}}const uTe=U({stringNGrams_:aTe});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lTe(e,t,n=!0){const r=O(e,"input","stringSplit","string"),i=O(t,"delimiter","stringSplit","string");if(r.rank!==1)throw new Error(`Input should be Tensor1D but received shape ${r.shape}`);if(i.rank!==0)throw new Error(`Delimiter should be a scalar but received shape ${i.shape}`);const s={skipEmpty:n},o={input:r,delimiter:i},a=z.runKernel(DT,o,s);return{indices:a[0],values:a[1],shape:a[2]}}const cTe=U({stringSplit_:lTe});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fTe(e,t){const n=O(e,"input","stringToHashBucketFast","string"),r={numBuckets:t};if(t<=0)throw new Error("Number of buckets must be at least 1");const i={input:n};return z.runKernel(NT,i,r)}const hTe=U({stringToHashBucketFast_:fTe});/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dTe(e,t,n,r=!0){const i=O(e,"input","staticRegexReplace","string"),s={pattern:t,rewrite:n,replaceGlobal:r};return z.runKernel(kw,{x:i},s)}const pTe=U({staticRegexReplace_:dTe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gTe={fft:tI,ifft:Kx,rfft:nI,irfft:WB},mTe={hammingWindow:j_e,hannWindow:lne,frame:cne,stft:H_e},yu={flipLeftRight:K_e,grayscaleToRGB:J_e,resizeNearestNeighbor:hne,resizeBilinear:fne,rgbToGrayscale:eAe,rotateWithOffset:nAe,cropAndResize:X_e,nonMaxSuppression:iAe,nonMaxSuppressionAsync:hAe,nonMaxSuppressionWithScore:pAe,nonMaxSuppressionWithScoreAsync:mAe,nonMaxSuppressionPadded:bAe,nonMaxSuppressionPaddedAsync:vAe,threshold:kAe,transform:_Ae},dne={bandPart:TAe,gramSchmidt:DAe,qr:FAe},yTe={absoluteDifference:MAe,computeWeightedLoss:Cc,cosineDistance:PAe,hingeLoss:zAe,huberLoss:jAe,logLoss:VAe,meanSquaredError:HAe,sigmoidCrossEntropy:YAe,softmaxCrossEntropy:JAe},bTe={sparseFillEmptyRows:eTe,sparseReshape:nTe,sparseSegmentMean:iTe,sparseSegmentSum:oTe},xTe={stringNGrams:uTe,stringSplit:cTe,stringToHashBucketFast:hTe,staticRegexReplace:pTe};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const vTe=new Map,eM=new Map;class lg{getClassName(){return this.constructor.className}static fromConfig(t,n){return new t(n)}}class qs{constructor(){this.classNameMap={}}static getMap(){return qs.instance==null&&(qs.instance=new qs),qs.instance}static register(t){qs.getMap().classNameMap[t.className]=[t,t.fromConfig]}}function fe(e,t,n){N(e.className!=null,()=>"Class being registered does not have the static className property defined."),N(typeof e.className=="string",()=>"className is required to be a string, but got type "+typeof e.className),N(e.className.length>0,()=>"Class being registered has an empty-string as its className, which is disallowed."),typeof t>"u"&&(t="Custom"),typeof n>"u"&&(n=e.className);const r=n,i=t+">"+r;return qs.register(e),vTe.set(i,e),eM.set(e,i),e}function wTe(e){return eM.has(e)?eM.get(e):e.className}const $Te=Object.freeze(Object.defineProperty({__proto__:null,Serializable:lg,SerializationMap:qs,getRegisteredName:wTe,registerClass:fe},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Sc extends lg{minimize(t,n=!1,r){const{value:i,grads:s}=this.computeGradients(t,r);if(r!=null){const o=r.map(a=>({name:a.name,tensor:s[a.name]}));this.applyGradients(o)}else this.applyGradients(s);return at(s),n?i:(i.dispose(),null)}get iterations(){return this.iterations_==null&&(this.iterations_=0),this.iterations_}incrementIterations(){this.iterations_=this.iterations+1}computeGradients(t,n){return Pte(t,n)}dispose(){this.iterations_!=null&&at(this.iterations_)}async saveIterations(){return this.iterations_==null&&(this.iterations_=0),{name:"iter",tensor:qe(this.iterations_,"int32")}}async getWeights(){throw new Error("getWeights() is not implemented for this optimizer yet.")}async setWeights(t){throw new Error(`setWeights() is not implemented for this optimizer class ${this.getClassName()}`)}async extractIterations(t){return this.iterations_=(await t[0].tensor.data())[0],t.slice(1)}}Object.defineProperty(Sc,Symbol.hasInstance,{value:e=>e.minimize!=null&&e.computeGradients!=null&&e.applyGradients!=null});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class ZB extends Sc{static get className(){return"Adadelta"}constructor(t,n,r=null){super(),this.learningRate=t,this.rho=n,this.epsilon=r,this.accumulatedGrads=[],this.accumulatedUpdates=[],r==null&&(this.epsilon=z.backend.epsilon())}applyGradients(t){(Array.isArray(t)?t.map(r=>r.name):Object.keys(t)).forEach((r,i)=>{const s=z.registeredVariables[r],o=!1;this.accumulatedGrads[i]==null&&(this.accumulatedGrads[i]={originalName:`${r}/accum_grad`,variable:Z(()=>xt(s).variable(o))}),this.accumulatedUpdates[i]==null&&(this.accumulatedUpdates[i]={originalName:`${r}/accum_var`,variable:Z(()=>xt(s).variable(o))});const a=Array.isArray(t)?t[i].tensor:t[r];if(a==null)return;const u=this.accumulatedGrads[i].variable,l=this.accumulatedUpdates[i].variable;Z(()=>{const c=ce(j(u,this.rho),j(Xt(a),1-this.rho)),f=j(Re(Kr(ce(l,this.epsilon)),Kr(ce(u,this.epsilon))),a),h=ce(j(l,this.rho),j(Xt(f),1-this.rho));u.assign(c),l.assign(h);const d=ce(j(f,-this.learningRate),s);s.assign(d)})}),this.incrementIterations()}dispose(){this.accumulatedUpdates!=null&&(at(this.accumulatedGrads.map(t=>t.variable)),at(this.accumulatedUpdates.map(t=>t.variable)))}async getWeights(){const t=[...this.accumulatedGrads,...this.accumulatedUpdates];return[await this.saveIterations()].concat(t.map(n=>({name:n.originalName,tensor:n.variable})))}async setWeights(t){t=await this.extractIterations(t);const n=t.length/2,r=!1;this.accumulatedGrads=t.slice(0,n).map(i=>({originalName:i.name,variable:i.tensor.variable(r)})),this.accumulatedUpdates=t.slice(n,n*2).map(i=>({originalName:i.name,variable:i.tensor.variable(r)}))}getConfig(){return{learningRate:this.learningRate,rho:this.rho,epsilon:this.epsilon}}static fromConfig(t,n){return new t(n.learningRate,n.rho,n.epsilon)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class JB extends Sc{static get className(){return"Adagrad"}constructor(t,n=.1){super(),this.learningRate=t,this.initialAccumulatorValue=n,this.accumulatedGrads=[]}applyGradients(t){(Array.isArray(t)?t.map(r=>r.name):Object.keys(t)).forEach((r,i)=>{const s=z.registeredVariables[r];this.accumulatedGrads[i]==null&&(this.accumulatedGrads[i]={originalName:`${r}/accumulator`,variable:Z(()=>U1(s.shape,this.initialAccumulatorValue).variable(!1))});const o=Array.isArray(t)?t[i].tensor:t[r];if(o==null)return;const a=this.accumulatedGrads[i].variable;Z(()=>{const u=ce(a,Xt(o));a.assign(u);const l=ce(j(Re(o,Kr(ce(u,z.backend.epsilon()))),-this.learningRate),s);s.assign(l)})}),this.incrementIterations()}dispose(){this.accumulatedGrads!=null&&at(this.accumulatedGrads.map(t=>t.variable))}async getWeights(){return[await this.saveIterations()].concat(this.accumulatedGrads.map(t=>({name:t.originalName,tensor:t.variable})))}async setWeights(t){t=await this.extractIterations(t);const n=!1;this.accumulatedGrads=t.map(r=>({originalName:r.name,variable:r.tensor.variable(n)}))}getConfig(){return{learningRate:this.learningRate,initialAccumulatorValue:this.initialAccumulatorValue}}static fromConfig(t,n){return new t(n.learningRate,n.initialAccumulatorValue)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class QB extends Sc{static get className(){return"Adam"}constructor(t,n,r,i=null){super(),this.learningRate=t,this.beta1=n,this.beta2=r,this.epsilon=i,this.accumulatedFirstMoment=[],this.accumulatedSecondMoment=[],Z(()=>{this.accBeta1=qe(n).variable(),this.accBeta2=qe(r).variable()}),i==null&&(this.epsilon=z.backend.epsilon())}applyGradients(t){const n=Array.isArray(t)?t.map(r=>r.name):Object.keys(t);Z(()=>{const r=_e(1,this.accBeta1),i=_e(1,this.accBeta2);n.forEach((s,o)=>{const a=z.registeredVariables[s],u=!1;this.accumulatedFirstMoment[o]==null&&(this.accumulatedFirstMoment[o]={originalName:`${s}/m`,variable:Z(()=>xt(a).variable(u))}),this.accumulatedSecondMoment[o]==null&&(this.accumulatedSecondMoment[o]={originalName:`${s}/v`,variable:Z(()=>xt(a).variable(u))});const l=Array.isArray(t)?t[o].tensor:t[s];if(l==null)return;const c=this.accumulatedFirstMoment[o].variable,f=this.accumulatedSecondMoment[o].variable,h=ce(j(c,this.beta1),j(l,1-this.beta1)),d=ce(j(f,this.beta2),j(Xt(l),1-this.beta2)),p=Re(h,r),g=Re(d,i);c.assign(h),f.assign(d);const m=ce(j(Re(p,ce(Kr(g),this.epsilon)),-this.learningRate),a);a.assign(m)}),this.accBeta1.assign(j(this.accBeta1,this.beta1)),this.accBeta2.assign(j(this.accBeta2,this.beta2))}),this.incrementIterations()}dispose(){this.accBeta1.dispose(),this.accBeta2.dispose(),this.accumulatedFirstMoment!=null&&at(this.accumulatedFirstMoment.map(t=>t.variable)),this.accumulatedSecondMoment!=null&&at(this.accumulatedSecondMoment.map(t=>t.variable))}async getWeights(){const t=[...this.accumulatedFirstMoment,...this.accumulatedSecondMoment];return[await this.saveIterations()].concat(t.map(n=>({name:n.originalName,tensor:n.variable})))}async setWeights(t){t=await this.extractIterations(t),Z(()=>{this.accBeta1.assign(Pf(this.beta1,this.iterations_+1)),this.accBeta2.assign(Pf(this.beta2,this.iterations_+1))});const n=t.length/2,r=!1;this.accumulatedFirstMoment=t.slice(0,n).map(i=>({originalName:i.name,variable:i.tensor.variable(r)})),this.accumulatedSecondMoment=t.slice(n,n*2).map(i=>({originalName:i.name,variable:i.tensor.variable(r)}))}getConfig(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon}}static fromConfig(t,n){return new t(n.learningRate,n.beta1,n.beta2,n.epsilon)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class e5 extends Sc{static get className(){return"Adamax"}constructor(t,n,r,i=null,s=0){super(),this.learningRate=t,this.beta1=n,this.beta2=r,this.epsilon=i,this.decay=s,this.accumulatedFirstMoment=[],this.accumulatedWeightedInfNorm=[],Z(()=>{this.iteration=qe(0).variable(),this.accBeta1=qe(n).variable()}),i==null&&(this.epsilon=z.backend.epsilon())}applyGradients(t){const n=Array.isArray(t)?t.map(r=>r.name):Object.keys(t);Z(()=>{const r=_e(1,this.accBeta1),i=Re(-this.learningRate,ce(j(this.iteration,this.decay),1));n.forEach((s,o)=>{const a=z.registeredVariables[s],u=!1;this.accumulatedFirstMoment[o]==null&&(this.accumulatedFirstMoment[o]={originalName:`${s}/m`,variable:xt(a).variable(u)}),this.accumulatedWeightedInfNorm[o]==null&&(this.accumulatedWeightedInfNorm[o]={originalName:`${s}/v`,variable:xt(a).variable(u)});const l=Array.isArray(t)?t[o].tensor:t[s];if(l==null)return;const c=this.accumulatedFirstMoment[o].variable,f=this.accumulatedWeightedInfNorm[o].variable,h=ce(j(c,this.beta1),j(l,1-this.beta1)),d=j(f,this.beta2),p=Gn(l),g=$c(d,p);c.assign(h),f.assign(g);const m=ce(j(Re(i,r),Re(h,ce(g,this.epsilon))),a);a.assign(m)}),this.iteration.assign(ce(this.iteration,1)),this.accBeta1.assign(j(this.accBeta1,this.beta1))}),this.incrementIterations()}dispose(){this.accBeta1.dispose(),this.iteration.dispose(),this.accumulatedFirstMoment!=null&&at(this.accumulatedFirstMoment.map(t=>t.variable)),this.accumulatedWeightedInfNorm!=null&&at(this.accumulatedWeightedInfNorm.map(t=>t.variable))}async getWeights(){throw new Error("getWeights() is not implemented for Adamax yet.")}async setWeights(t){throw new Error("setWeights() is not implemented for Adamax yet.")}getConfig(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon,decay:this.decay}}static fromConfig(t,n){return new t(n.learningRate,n.beta1,n.beta2,n.epsilon,n.decay)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class hI extends Sc{static get className(){return"SGD"}constructor(t){super(),this.learningRate=t,this.setLearningRate(t)}applyGradients(t){(Array.isArray(t)?t.map(r=>r.name):Object.keys(t)).forEach((r,i)=>{const s=Array.isArray(t)?t[i].tensor:t[r];if(s==null)return;const o=z.registeredVariables[r];Z(()=>{const a=ce(j(this.c,s),o);o.assign(a)})}),this.incrementIterations()}setLearningRate(t){this.learningRate=t,this.c!=null&&this.c.dispose(),this.c=Ca(qe(-t))}dispose(){this.c.dispose()}async getWeights(){return[await this.saveIterations()]}async setWeights(t){if(t=await this.extractIterations(t),t.length!==0)throw new Error("SGD optimizer does not have settable weights.")}getConfig(){return{learningRate:this.learningRate}}static fromConfig(t,n){return new t(n.learningRate)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class t5 extends hI{static get className(){return"Momentum"}constructor(t,n,r=!1){super(t),this.learningRate=t,this.momentum=n,this.useNesterov=r,this.accumulations=[],this.m=qe(this.momentum)}applyGradients(t){(Array.isArray(t)?t.map(r=>r.name):Object.keys(t)).forEach((r,i)=>{const s=z.registeredVariables[r];this.accumulations[i]==null&&(this.accumulations[i]={originalName:`${r}/momentum`,variable:Z(()=>xt(s).variable(!1))});const o=this.accumulations[i].variable,a=Array.isArray(t)?t[i].tensor:t[r];a!=null&&Z(()=>{let u;const l=ce(j(this.m,o),a);this.useNesterov?u=ce(j(this.c,ce(a,j(l,this.m))),s):u=ce(j(this.c,l),s),o.assign(l),s.assign(u)})}),this.incrementIterations()}dispose(){this.m.dispose(),this.accumulations!=null&&at(this.accumulations.map(t=>t.variable))}setMomentum(t){this.momentum=t}async getWeights(){return[await this.saveIterations()].concat(this.accumulations.map(t=>({name:t.originalName,tensor:t.variable})))}async setWeights(t){t=await this.extractIterations(t);const n=!1;this.accumulations=t.map(r=>({originalName:r.name,variable:r.tensor.variable(n)}))}getConfig(){return{learningRate:this.learningRate,momentum:this.momentum,useNesterov:this.useNesterov}}static fromConfig(t,n){return new t(n.learningRate,n.momentum,n.useNesterov)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class n5 extends Sc{static get className(){return"RMSProp"}constructor(t,n=.9,r=0,i=null,s=!1){if(super(),this.learningRate=t,this.decay=n,this.momentum=r,this.epsilon=i,this.accumulatedMeanSquares=[],this.accumulatedMoments=[],this.accumulatedMeanGrads=[],this.centered=s,i==null&&(this.epsilon=z.backend.epsilon()),t==null)throw new Error("learningRate for RMSPropOptimizer must be defined.")}applyGradients(t){(Array.isArray(t)?t.map(r=>r.name):Object.keys(t)).forEach((r,i)=>{const s=z.registeredVariables[r],o=!1;this.accumulatedMeanSquares[i]==null&&(this.accumulatedMeanSquares[i]={originalName:`${r}/rms`,variable:Z(()=>xt(s).variable(o))}),this.accumulatedMoments[i]==null&&(this.accumulatedMoments[i]={originalName:`${r}/momentum`,variable:Z(()=>xt(s).variable(o))}),this.accumulatedMeanGrads[i]==null&&this.centered&&(this.accumulatedMeanGrads[i]={originalName:`${r}/mg`,variable:Z(()=>xt(s).variable(o))});const a=Array.isArray(t)?t[i].tensor:t[r];if(a==null)return;const u=this.accumulatedMeanSquares[i].variable,l=this.accumulatedMoments[i].variable;Z(()=>{const c=ce(j(u,this.decay),j(Xt(a),1-this.decay));if(this.centered){const f=this.accumulatedMeanGrads[i].variable,h=ce(j(f,this.decay),j(a,1-this.decay)),d=Re(j(a,this.learningRate),Kr(_e(c,ce(Xt(h),this.epsilon)))),p=ce(j(l,this.momentum),d);u.assign(c),f.assign(h),l.assign(p);const g=_e(s,p);s.assign(g)}else{const f=ce(j(u,this.decay),j(Xt(a),1-this.decay)),h=ce(j(l,this.momentum),Re(j(a,this.learningRate),Kr(ce(f,this.epsilon))));u.assign(f),l.assign(h);const d=_e(s,h);s.assign(d)}})}),this.incrementIterations()}dispose(){this.accumulatedMeanSquares!=null&&at(this.accumulatedMeanSquares.map(t=>t.variable)),this.accumulatedMeanGrads!=null&&this.centered&&at(this.accumulatedMeanGrads.map(t=>t.variable)),this.accumulatedMoments!=null&&at(this.accumulatedMoments.map(t=>t.variable))}async getWeights(){const t=[...this.accumulatedMeanSquares,...this.accumulatedMoments];return this.centered&&t.push(...this.accumulatedMeanGrads),[await this.saveIterations()].concat(t.map(n=>({name:n.originalName,tensor:n.variable})))}async setWeights(t){t=await this.extractIterations(t);const n=this.centered?t.length/3:t.length/2,r=!1;this.accumulatedMeanSquares=t.slice(0,n).map(i=>({originalName:i.name,variable:i.tensor.variable(r)})),this.accumulatedMoments=t.slice(n,n*2).map(i=>({originalName:i.name,variable:i.tensor.variable(r)})),this.centered&&(this.accumulatedMeanGrads=t.slice(n*2,n*3).map(i=>({originalName:i.name,variable:i.tensor.variable(r)})))}getConfig(){return{learningRate:this.learningRate,decay:this.decay,momentum:this.momentum,epsilon:this.epsilon,centered:this.centered}}static fromConfig(t,n){return new t(n.learningRate,n.decay,n.momentum,n.epsilon,n.centered)}}/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const CTe=[ZB,JB,QB,e5,t5,n5,hI];function STe(){for(const e of CTe)fe(e)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const kTe="model",ETe=".json",_Te=".weights.bin";function kV(e){return new Promise(t=>setTimeout(t)).then(e)}class xp{constructor(t){if(!K().getBool("IS_BROWSER"))throw new Error("browserDownloads() cannot proceed because the current environment is not a browser.");t.startsWith(xp.URL_SCHEME)&&(t=t.slice(xp.URL_SCHEME.length)),(t==null||t.length===0)&&(t=kTe),this.modelJsonFileName=t+ETe,this.weightDataFileName=t+_Te}async save(t){if(typeof document>"u")throw new Error("Browser downloads are not supported in this environment since `document` is not present");const n=Pa.join(t.weightData),r=window.URL.createObjectURL(new Blob([n],{type:"application/octet-stream"}));if(t.modelTopology instanceof ArrayBuffer)throw new Error("BrowserDownloads.save() does not support saving model topology in binary formats yet.");{const i=[{paths:["./"+this.weightDataFileName],weights:t.weightSpecs}],s=Gee(t,i),o=window.URL.createObjectURL(new Blob([JSON.stringify(s)],{type:"application/json"})),a=this.modelJsonAnchor==null?document.createElement("a"):this.modelJsonAnchor;if(a.download=this.modelJsonFileName,a.href=o,await kV(()=>a.dispatchEvent(new MouseEvent("click"))),t.weightData!=null){const u=this.weightDataAnchor==null?document.createElement("a"):this.weightDataAnchor;u.download=this.weightDataFileName,u.href=r,await kV(()=>u.dispatchEvent(new MouseEvent("click")))}return{modelArtifactsInfo:Iw(t)}}}}xp.URL_SCHEME="downloads://";class ATe{constructor(t){if(t==null||t.length<1)throw new Error(`When calling browserFiles, at least 1 file is required, but received ${t}`);this.jsonFile=t[0],this.weightsFiles=t.slice(1)}async load(){return new Promise((t,n)=>{const r=new FileReader;r.onload=i=>{const s=JSON.parse(i.target.result),o=s.modelTopology;if(o==null){n(new Error(`modelTopology field is missing from file ${this.jsonFile.name}`));return}if(s.weightsManifest==null){n(new Error(`weightManifest field is missing from file ${this.jsonFile.name}`));return}if(this.weightsFiles.length===0){t({modelTopology:o});return}const u=lB(s,l=>this.loadWeights(l));t(u)},r.onerror=i=>n(`Failed to read model topology and weights manifest JSON from file '${this.jsonFile.name}'. BrowserFiles supports loading Keras-style tf.Model artifacts only.`),r.readAsText(this.jsonFile)})}loadWeights(t){const n=[],r=[];for(const o of t)n.push(...o.weights),r.push(...o.paths);const i=this.checkManifestAndWeightFiles(t),s=r.map(o=>this.loadWeightsFile(o,i[o]));return Promise.all(s).then(o=>[n,o])}loadWeightsFile(t,n){return new Promise((r,i)=>{const s=new FileReader;s.onload=o=>{const a=o.target.result;r(a)},s.onerror=o=>i(`Failed to weights data from file of path '${t}'.`),s.readAsArrayBuffer(n)})}checkManifestAndWeightFiles(t){const n=[],r=this.weightsFiles.map(s=>$V(s.name)),i={};for(const s of t)s.paths.forEach(o=>{const a=$V(o);if(n.indexOf(a)!==-1)throw new Error(`Duplicate file basename found in weights manifest: '${a}'`);if(n.push(a),r.indexOf(a)===-1)throw new Error(`Weight file with basename '${a}' is not provided.`);i[o]=this.weightsFiles[r.indexOf(a)]});if(n.length!==this.weightsFiles.length)throw new Error(`Mismatch in the number of files in weights manifest (${n.length}) and the number of weight files provided (${this.weightsFiles.length}).`);return i}}const TTe=e=>K().getBool("IS_BROWSER")&&!Array.isArray(e)&&e.startsWith(xp.URL_SCHEME)?ITe(e.slice(xp.URL_SCHEME.length)):null;bn.registerSaveRouter(TTe);function ITe(e="model"){return new xp(e)}function DTe(e){return new ATe(e)}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function EV(e,t,n,r){o(e),n=n??0,r=r??1,a(n,r);let i=0;const s=u=>(u.then(l=>{const c=n+ ++i/e.length*(r-n);return t(c),l}),u);function o(u){N(u!=null&&Array.isArray(u)&&u.length>0,()=>"promises must be a none empty array")}function a(u,l){N(u>=0&&u<=1,()=>`Progress fraction must be in range [0, 1], but got startFraction ${u}`),N(l>=0&&l<=1,()=>`Progress fraction must be in range [0, 1], but got endFraction ${l}`),N(l>=u,()=>`startFraction must be no more than endFraction, but got startFraction ${u} and endFraction ${l}`)}return Promise.all(e.map(s))}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function pne(e,t){t==null&&(t={});const n=t.fetchFunc==null?K().platform.fetch:t.fetchFunc,r=e.map(f=>n(f,t.requestInit,{isBinary:!0})),i=0,s=.5,a=(t.onProgress==null?await Promise.all(r):await EV(r,t.onProgress,i,s)).map(f=>f.arrayBuffer()),u=.5,l=1;return t.onProgress==null?await Promise.all(a):await EV(a,t.onProgress,u,l)}async function NTe(e,t="",n,r){return gne(o=>pne(o,{requestInit:r}))(e,t,n)}function gne(e){return async(t,n="",r)=>{const i=t.map(()=>!1),s={},o=r!=null?r.map(()=>!1):[],a=[];if(t.forEach((d,p)=>{let g=0;d.weights.forEach(m=>{const y="quantization"in m?m.quantization.dtype:m.dtype,b=GR[y]*te(m.shape),v=()=>{i[p]=!0,s[p]==null&&(s[p]=[]),s[p].push({manifestEntry:m,groupOffset:g,sizeBytes:b})};r!=null?r.forEach((x,w)=>{x===m.name&&(v(),o[w]=!0)}):v(),a.push(m.name),g+=b})}),!o.every(d=>d)){const d=r.filter((p,g)=>!o[g]);throw new Error(`Could not find weights in manifest with names: ${d.join(", ")}. 
Manifest JSON has weights with names: ${a.join(", ")}.`)}const u=i.reduce((d,p,g)=>(p&&d.push(g),d),[]),l=[];u.forEach(d=>{t[d].paths.forEach(p=>{const g=n+(n.endsWith("/")?"":"/")+p;l.push(g)})});const c=await e(l),f={};let h=0;return u.forEach(d=>{const p=t[d].paths.length,g=new Pa(c.slice(h,h+p));s[d].forEach(y=>{const b=g.slice(y.groupOffset,y.groupOffset+y.sizeBytes),v=Wee(b,[y.manifestEntry]);for(const x in v)f[x]=v[x]}),h+=p}),f}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const FTe="application/octet-stream",OTe="application/json";class r5{constructor(t,n){if(this.DEFAULT_METHOD="POST",n==null&&(n={}),this.weightPathPrefix=n.weightPathPrefix,this.onProgress=n.onProgress,this.weightUrlConverter=n.weightUrlConverter,n.fetchFunc!=null?(N(typeof n.fetchFunc=="function",()=>"Must pass a function that matches the signature of `fetch` (see https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API)"),this.fetch=n.fetchFunc):this.fetch=K().platform.fetch,N(t!=null&&t.length>0,()=>"URL path for http must not be null, undefined or empty."),Array.isArray(t)&&N(t.length===2,()=>`URL paths for http must have a length of 2, (actual length is ${t.length}).`),this.path=t,n.requestInit!=null&&n.requestInit.body!=null)throw new Error("requestInit is expected to have no pre-existing body, but has one.");this.requestInit=n.requestInit||{}}async save(t){if(t.modelTopology instanceof ArrayBuffer)throw new Error("BrowserHTTPRequest.save() does not support saving model topology in binary formats yet.");const n=Object.assign({method:this.DEFAULT_METHOD},this.requestInit);n.body=new FormData;const r=[{paths:["./model.weights.bin"],weights:t.weightSpecs}],i=Gee(t,r);if(n.body.append("model.json",new Blob([JSON.stringify(i)],{type:OTe}),"model.json"),t.weightData!=null){const o=Pa.join(t.weightData);n.body.append("model.weights.bin",new Blob([o],{type:FTe}),"model.weights.bin")}const s=await this.fetch(this.path,n);if(s.ok)return{modelArtifactsInfo:Iw(t),responses:[s]};throw new Error(`BrowserHTTPRequest.save() failed due to HTTP response status ${s.status}.`)}async load(){const t=await this.fetch(this.path,this.requestInit);if(!t.ok)throw new Error(`Request to ${this.path} failed with status code ${t.status}. Please verify this URL points to the model JSON of the model to load.`);let n;try{n=await t.json()}catch{let o=`Failed to parse model JSON of response from ${this.path}.`;throw this.path.endsWith(".pb")?o+=" Your path contains a .pb file extension. Support for .pb models have been removed in TensorFlow.js 1.0 in favor of .json models. You can re-convert your Python TensorFlow model using the TensorFlow.js 1.0 conversion scripts or you can convert your.pb models with the 'pb2json'NPM script in the tensorflow/tfjs-converter repository.":o+=" Please make sure the server is serving valid JSON for this request.",new Error(o)}const r=n.modelTopology,i=n.weightsManifest;if(r==null&&i==null)throw new Error(`The JSON from HTTP path ${this.path} contains neither model topology or manifest for weights.`);return lB(n,s=>this.loadWeights(s))}async loadWeights(t){const n=Array.isArray(this.path)?this.path[1]:this.path,[r,i]=RTe(n),s=this.weightPathPrefix||r,o=qee(t),a=[],u=[];for(const c of t)for(const f of c.paths)this.weightUrlConverter!=null?u.push(this.weightUrlConverter(f)):a.push(s+f+i);this.weightUrlConverter&&a.push(...await Promise.all(u));const l=await pne(a,{requestInit:this.requestInit,fetchFunc:this.fetch,onProgress:this.onProgress});return[o,l]}}r5.URL_SCHEME_REGEX=/^https?:\/\//;function RTe(e){const t=e.lastIndexOf("/"),n=e.lastIndexOf("?"),r=e.substring(0,t),i=n>t?e.substring(n):"";return[r+"/",i]}function tM(e){return e.match(r5.URL_SCHEME_REGEX)!=null}const mne=(e,t)=>{if(typeof fetch>"u"&&(t==null||t.fetchFunc==null))return null;{let n=!0;if(Array.isArray(e)?n=e.every(r=>tM(r)):n=tM(e),n)return i5(e,t)}return null};bn.registerSaveRouter(mne);bn.registerLoadRouter(mne);function i5(e,t){return new r5(e,t)}function MTe(e,t){return i5(e,t)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class n3{constructor(t){this.modelArtifacts=t}load(){return this.modelArtifacts}}class yne{constructor(t){this.saveHandler=t}save(t){return this.saveHandler(t)}}class LTe{constructor(t){t.load&&(this.load=()=>Promise.resolve(t.load())),t.save&&(this.save=n=>Promise.resolve(t.save(n)))}}function PTe(e,t,n,r){const i=arguments;return new LTe(bne(...i))}function bne(e,t,n,r){return arguments.length===1?e.modelTopology!=null||e.weightSpecs!=null?new n3(e):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new n3({modelTopology:e})):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new n3({modelTopology:e,weightSpecs:t,weightData:n,trainingConfig:r}))}function BTe(e){return new yne(e)}function zTe(e){return new yne(e)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const UTe=Object.freeze(Object.defineProperty({__proto__:null,CompositeArrayBuffer:Pa,browserFiles:DTe,browserHTTPRequest:MTe,concatenateArrayBuffers:Vee,copyModel:d$e,decodeWeights:Wee,encodeWeights:HR,fromMemory:PTe,fromMemorySync:bne,getLoadHandlers:Qwe,getModelArtifactsForJSON:lB,getModelArtifactsForJSONSync:Hee,getModelArtifactsInfoForJSON:Iw,getSaveHandlers:Xee,getWeightSpecs:qee,http:i5,isHTTPScheme:tM,listModels:f$e,loadWeights:NTe,moveModel:p$e,registerLoadRouter:Jwe,registerSaveRouter:Zwe,removeModel:h$e,weightsLoaderFactory:gne,withSaveHandler:BTe,withSaveHandlerSync:zTe},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jTe(e,t,n){const r=O(e,"labels","confusionMatrix"),i=O(t,"predictions","confusionMatrix");N(n==null||n>0&&Number.isInteger(n),()=>`If provided, numClasses must be a positive integer, but got ${n}`),N(r.rank===1,()=>`Expected the rank of labels to be 1, but got ${r.rank}`),N(i.rank===1,()=>`Expected the rank of predictions to be 1, but got ${i.rank}`),N(r.shape[0]===i.shape[0],()=>`Mismatch in the number of examples: ${r.shape[0]} vs. ${i.shape[0]}. Labels and predictions should have the same number of elements.`),N(n>0&&Number.isInteger(n),()=>`numClasses is required to be a positive integer, but got ${n}`);const s=qx(we(r,"int32"),n),o=qx(we(i,"int32"),n),a=mt(s),u=ot(a,o);return we(u,"int32")}const WTe=U({confusionMatrix_:jTe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const VTe=Object.freeze(Object.defineProperty({__proto__:null,confusionMatrix:WTe},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */let ed,_V=!1;function xne(e,t=3){if(t>4)throw new Error("Cannot construct Tensor with more than 4 channels from pixels.");if(e==null)throw new Error("pixels passed to tf.browser.fromPixels() can not be null");let n=!1,r=!1,i=!1,s=!1,o=!1,a=!1;if(e.data instanceof Uint8Array)n=!0;else if(typeof ImageData<"u"&&e instanceof ImageData)r=!0;else if(typeof HTMLVideoElement<"u"&&e instanceof HTMLVideoElement)i=!0;else if(typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement)s=!0;else if(e.getContext!=null)o=!0;else if(typeof ImageBitmap<"u"&&e instanceof ImageBitmap)a=!0;else throw new Error(`pixels passed to tf.browser.fromPixels() must be either an HTMLVideoElement, HTMLImageElement, HTMLCanvasElement, ImageData in browser, or OffscreenCanvas, ImageData in webworker or {data: Uint32Array, width: number, height: number}, but was ${e.constructor.name}`);if(zx(Fk,z.backendName)!=null){const p={pixels:e},g={numChannels:t};return z.runKernel(Fk,p,g)}const[l,c]=i?[e.videoWidth,e.videoHeight]:[e.width,e.height];let f;if(o)f=e.getContext("2d").getImageData(0,0,l,c).data;else if(r||n)f=e.data;else if(s||i||a){if(ed==null)if(typeof document>"u")if(typeof OffscreenCanvas<"u"&&typeof OffscreenCanvasRenderingContext2D<"u")ed=new OffscreenCanvas(1,1).getContext("2d");else throw new Error("Cannot parse input in current context. Reason: OffscreenCanvas Context2D rendering is not supported.");else ed=document.createElement("canvas").getContext("2d",{willReadFrequently:!0});ed.canvas.width=l,ed.canvas.height=c,ed.drawImage(e,0,0,l,c),f=ed.getImageData(0,0,l,c).data}let h;if(t===4)h=new Int32Array(f);else{const p=l*c;h=new Int32Array(p*t);for(let g=0;g<p;g++)for(let m=0;m<t;++m)h[g*t+m]=f[g*4+m]}return Qte(h,[c,l,t],"int32")}function GTe(e){return e!=null&&e.data instanceof Uint8Array}function HTe(){return typeof window<"u"&&typeof ImageBitmap<"u"&&window.hasOwnProperty("createImageBitmap")}function qTe(e){return e!=null&&e.width!==0&&e.height!==0}function XTe(e){return HTe()&&!(e instanceof ImageBitmap)&&qTe(e)&&!GTe(e)}async function YTe(e,t=3){let n=null;if(K().getBool("WRAP_TO_IMAGEBITMAP")&&XTe(e)){let r;try{r=await createImageBitmap(e,{premultiplyAlpha:"none"})}catch{r=null}r!=null&&r.width===e.width&&r.height===e.height?n=r:n=e}else n=e;return xne(n,t)}function vne(e){if(e.rank!==2&&e.rank!==3)throw new Error(`toPixels only supports rank 2 or 3 tensors, got rank ${e.rank}.`);const t=e.rank===2?1:e.shape[2];if(t>4||t===2)throw new Error(`toPixels only supports depth of size 1, 3 or 4 but got ${t}`);if(e.dtype!=="float32"&&e.dtype!=="int32")throw new Error(`Unsupported type for toPixels: ${e.dtype}. Please use float32 or int32 tensors.`)}function KTe(e){const t=(e==null?void 0:e.alpha)||1;if(t>1||t<0)throw new Error(`Alpha value ${t} is suppoed to be in range [0 - 1].`)}async function ZTe(e,t){let n=O(e,"img","toPixels");if(!(e instanceof Pt)){const l=n;n=we(l,"int32"),l.dispose()}vne(n);const[r,i]=n.shape.slice(0,2),s=n.rank===2?1:n.shape[2],o=await n.data(),a=n.dtype==="float32"?255:1,u=new Uint8ClampedArray(i*r*4);for(let l=0;l<r*i;++l){const c=[0,0,0,255];for(let h=0;h<s;h++){const d=o[l*s+h];if(n.dtype==="float32"){if(d<0||d>1)throw new Error(`Tensor values for a float32 Tensor must be in the range [0 - 1] but encountered ${d}.`)}else if(n.dtype==="int32"&&(d<0||d>255))throw new Error(`Tensor values for a int32 Tensor must be in the range [0 - 255] but encountered ${d}.`);s===1?(c[0]=d*a,c[1]=d*a,c[2]=d*a):c[h]=d*a}const f=l*4;u[f+0]=Math.round(c[0]),u[f+1]=Math.round(c[1]),u[f+2]=Math.round(c[2]),u[f+3]=Math.round(c[3])}if(t!=null){_V||zx(YA,z.backendName)!=null&&(console.warn("tf.browser.toPixels is not efficient to draw tensor on canvas. Please try tf.browser.draw instead."),_V=!0),t.width=i,t.height=r;const l=t.getContext("2d"),c=new ImageData(u,i,r);l.putImageData(c,0,0)}return n!==e&&n.dispose(),u}function JTe(e,t,n){let r=O(e,"img","draw");if(!(e instanceof Pt)){const o=r;r=we(o,"int32"),o.dispose()}vne(r),KTe(n==null?void 0:n.imageOptions);const i={image:r},s={canvas:t,options:n};z.runKernel(YA,i,s)}const QTe=U({fromPixels_:xne}),eIe=Object.freeze(Object.defineProperty({__proto__:null,draw:JTe,fromPixels:QTe,fromPixelsAsync:YTe,toPixels:ZTe},Symbol.toStringTag,{value:"Module"}));function dI(e,t){const n=e.shape.length,r=t.shape.length;if(n<1)throw new Error(`tf.gatherND() expects the input to be rank 1 or higher, but the rank was ${n}.`);if(r<1)throw new Error(`tf.gatherND() expects the indices to be rank 1 or higher, but the rank was ${r}.`);if(t.dtype!=="int32")throw new Error(`tf.gatherND() expects the indices to be int32 type, but the dtype was ${t.dtype}.`);if(t.shape[r-1]>n)throw new Error(`index innermost dimension length must be <= tensor rank; saw: ${t.shape[r-1]} vs. ${n}`);if(te(e.shape)===0)throw new Error(`Requested more than 0 entries, but input is empty. Input shape: ${e.shape}.`);const i=t.shape,s=i[i.length-1];let o=1;for(let f=0;f<i.length-1;++f)o*=i[f];const a=e.shape,u=i.slice();u.pop();let l=1;for(let f=s;f<n;++f)l*=a[f],u.push(a[f]);const c=[...Me(e.shape).map(f=>f/l),1].slice(0,s);return[u,o,l,c]}const tIe=Object.freeze(Object.defineProperty({__proto__:null,prepareAndValidate:dI},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nM=-2,nIe=-1;function s5(e,t,n){const r=e.shape.length;N(r===t.length,()=>`Error in slice${r}D: Length of begin ${t} must match the rank of the array (${r}).`),N(r===n.length,()=>`Error in slice${r}D: Length of size ${n} must match the rank of the array (${r}).`);for(let i=0;i<r;++i)N(t[i]+n[i]<=e.shape[i],()=>`Error in slice${r}D: begin[${i}] + size[${i}] (${t[i]+n[i]}) would overflow input.shape[${i}] (${e.shape[i]})`)}function rIe(e){const t=[];let n=0;for(;e>0;)e&1&&t.push(n),e/=2,n++;return t}function o5(e,t,n){const r=[];for(let i=0;i<e.length;i++)r[i]=Math.ceil((t[i]-e[i])/n[i]);return r}function wne(e,t,n,r){const i=[...e];for(let s=i.length;s<r.length;s++)i.push(1);for(let s=0;s<n;s++)s===0?i[t]=1:(i.splice(t,0,1),i.pop());return i}function $ne(e,t,n){return n<=e?n:n-(t-1)}function Cne(e,t){const n=[];for(let r=0;r<e;r++)n.push(t+r);return n}function iIe(e,t,n,r,i,s,o,a,u){const l=e.length;let c=new Array(l),f=new Array(l),h=new Array(l);if(t.length&&n>0){const d=t[0],p=n+1;c=Sne(o,d,p,r,e),f=kne(a,d,p,i,e),h=wne(s,d,p,e)}else for(let d=0;d<l;d++)c[d]=_ne(o,r,s,e,d,u),f[d]=Ane(a,i,s,e,d,u),h[d]=Ene(s,d,u);return{begin:c,end:f,strides:h}}function Sne(e,t,n,r,i){const s=[...i],o=Cne(n,t);for(let a=0;a<s.length;a++)if(o.indexOf(a)>-1)s[a]=0;else{const u=$ne(t,n,a);let l=r[u];e&1<<u&&(l=0),s[a]=l}return s}function kne(e,t,n,r,i){const s=[...i],o=Cne(n,t);for(let a=0;a<s.length;a++)if(o.indexOf(a)>-1)s[a]=Number.MAX_SAFE_INTEGER;else{const u=$ne(t,n,a);let l=r[u];e&1<<u&&(l=Number.MAX_SAFE_INTEGER),s[a]=l}for(let a=0;a<s.length;a++){const u=i[a];s[a]<0&&(s[a]+=u),s[a]=Ff(0,s[a],i[a])}return s}function Ene(e,t,n){let r=e[t];return(n&1<<t||r==null)&&(r=1),r}function _ne(e,t,n,r,i,s){let o=t[i];const a=n[i]||1;(e&1<<i||s&1<<i||o==null)&&(a>0?o=Number.MIN_SAFE_INTEGER:o=Number.MAX_SAFE_INTEGER);const u=r[i];return o<0&&(o+=u),o=Ff(0,o,u-1),o}function Ane(e,t,n,r,i,s){let o=t[i];const a=n[i]||1;(e&1<<i||s&1<<i||o==null)&&(a>0?o=Number.MAX_SAFE_INTEGER:o=Number.MIN_SAFE_INTEGER);const u=r[i];return o<0&&(o+=u),a>0?o=Ff(0,o,u):o=Ff(-1,o,u-1),o}function a5(e,t,n){let r=n.length;for(let i=0;i<n.length;i++)if(n[i]>1){r=i;break}for(let i=r+1;i<n.length;i++)if(t[i]>0||n[i]!==e[i])return!1;return!0}function u5(e,t){let n=e.length>0?e[e.length-1]:1;for(let r=0;r<e.length-1;r++)n+=e[r]*t[r];return n}function pI(e,t,n){let r;const i=e.shape.length;typeof t=="number"?r=[t,...new Array(i-1).fill(0)]:t.length<i?r=t.concat(new Array(i-t.length).fill(0)):r=t.slice(),r.forEach(o=>{N(o!==-1,()=>"slice() does not support negative begin indexing.")});let s;return n==null?s=new Array(i).fill(-1):typeof n=="number"?s=[n,...new Array(i-1).fill(-1)]:n.length<i?s=n.concat(new Array(i-n.length).fill(-1)):s=n,s=s.map((o,a)=>o>=0?o:(N(o===-1,()=>`Negative size values should be exactly -1 but got ${o} for the slice() size at index ${a}.`),e.shape[a]-r[a])),[r,s]}function l5(e,t,n,r,i,s,o,a,u){let l;if(r==null?(l=new Array(t.length),l.fill(1)):l=r,o!=null&&o&o-1)throw new Error("Multiple ellipses in slice is not allowed.");let c=!1;const f={dims:l.length,numAddAxisAfterEllipsis:0,begin:t.slice(),end:n.slice(),strides:l.slice(),beginMask:i,endMask:s,ellipsisMask:o,newAxisMask:a,shrinkAxisMask:u};for(let v=0;v<f.dims;v++)c&&1<<v&a&&f.numAddAxisAfterEllipsis++,1<<v&o&&(c=!0);c||(f.ellipsisMask|=1<<f.dims,f.dims++);const h={dims:e.length,beginMask:0,endMask:0,beginValid:!1,endValid:!1};sIe(f,h);let d=!0,p=!0,g=!0;const m=[],y=[];for(let v=0;v<e.length;++v){if(h.strides[v]===0)throw Error(`strides[${v}] must be non-zero`);const x=!!(h.shrinkAxisMask&1<<v),w=e[v];if(w===-1){m.push(x?1:-1);continue}const C=[h.beginMask&1<<v,h.endMask&1<<v],$=[h.strides[v]>0?0:-1,h.strides[v]>0?w:w-1];if(x&&h.strides[v]<=0)throw Error("only stride 1 allowed on non-range indexing.");g=g&&h.strides[v]===1;const S=!!(h.beginMask&1<<v&&h.endMask&1<<v);if(h.beginValid&&h.endValid){if(x){const D=h.begin[v]<0?w+h.begin[v]:h.begin[v];if(h.begin[v]=D,h.end[v]=h.begin[v]+1,D<0||D>=w)throw Error(`slice index ${h.begin[v]} of dimension ${v} out of bounds.`)}else h.begin[v]=AV(h.begin[v],0,h.strides[v],w,C,$),h.end[v]=AV(h.end[v],1,h.strides[v],w,C,$);const _=h.strides[v]===1&&h.begin[v]===0&&h.end[v]===w;d=d&&_,p=p&&(v===0&&h.strides[v]===1||_)}else d=d&&h.strides[v]===1&&S,p=p&&(v===0&&h.strides[v]===1||S);let k,E=!1;if(h.beginValid&&h.endValid?(k=h.end[v]-h.begin[v],E=!0):x?(k=1,E=!0):S&&w>=0&&(h.strides[v]<0?k=-w:k=w,E=!0),E){let _;k===0||k<0!=h.strides[v]<0?_=0:_=Math.trunc(k/h.strides[v])+(k%h.strides[v]!==0?1:0),m.push(_)}else m.push(-1)}for(let v=0;v<h.finalShapeGatherIndices.length;++v){const x=h.finalShapeGatherIndices[v];x>=0?y.push(m[x]):x===nM&&y.push(1)}return{finalShapeSparse:y.filter((v,x)=>h.finalShapeGatherIndices[x]!==nM),finalShape:y,isIdentity:d,sliceDim0:p,isSimpleSlice:g,begin:h.begin,end:h.end,strides:h.strides}}function sIe(e,t){t.beginMask=0,t.endMask=0,t.shrinkAxisMask=0;let n=0;t.beginValid=e.begin!=null,t.endValid=e.end!=null,t.begin=new Array(t.dims),t.end=new Array(t.dims),t.strides=new Array(t.dims),t.finalShapeGatherIndices=[],t.finalShapeGatherIndicesSparse=[],t.inputShapeGatherIndicesSparse=new Array(t.dims);for(let r=0;r<e.dims;r++)if(1<<r&e.ellipsisMask){const i=Math.min(t.dims-(e.dims-r)+1+e.numAddAxisAfterEllipsis,t.dims);for(;n<i;n++)t.begin[n]=0,t.end[n]=0,t.strides[n]=1,t.beginMask|=1<<n,t.endMask|=1<<n,t.finalShapeGatherIndices.push(n),t.finalShapeGatherIndicesSparse.push(-1),t.inputShapeGatherIndicesSparse[n]=r}else if(1<<r&e.newAxisMask)t.finalShapeGatherIndices.push(nM),t.finalShapeGatherIndicesSparse.push(-1);else{if(n===t.begin.length)throw Error(`Index out of range using input dim ${n}; input has only ${t.dims} dims, ${t.begin.length}.`);e.begin!=null&&(t.begin[n]=e.begin[r]),e.end!=null&&(t.end[n]=e.end[r]),t.strides[n]=e.strides[r],e.beginMask&1<<r&&(t.beginMask|=1<<n),e.endMask&1<<r&&(t.endMask|=1<<n),e.shrinkAxisMask&1<<r?(t.finalShapeGatherIndices.push(nIe),t.finalShapeGatherIndicesSparse.push(-1),t.shrinkAxisMask|=1<<n):(t.finalShapeGatherIndices.push(n),t.finalShapeGatherIndicesSparse.push(r)),t.inputShapeGatherIndicesSparse[n]=r,n++}}function AV(e,t,n,r,i,s){if(i[t])return n>0?s[t]:s[t+1&1];{const o=e<0?r+e:e;return o<s[0]?s[0]:o>s[1]?s[1]:o}}const Tne=Object.freeze(Object.defineProperty({__proto__:null,assertParamsValid:s5,computeFlatOffset:u5,computeOutShape:o5,getNormalizedAxes:iIe,isSliceContinous:a5,maskToAxes:rIe,parseSliceParams:pI,sliceInfo:l5,startForAxis:_ne,startIndicesWithElidedDims:Sne,stopForAxis:Ane,stopIndicesWithElidedDims:kne,stridesForAxis:Ene,stridesWithElidedDims:wne},Symbol.toStringTag,{value:"Module"}));/** @license See the LICENSE file. */const oIe="4.10.0";/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Ine{static sgd(t){return new hI(t)}static momentum(t,n,r=!1){return new t5(t,n,r)}static rmsprop(t,n=.9,r=0,i=null,s=!1){return new n5(t,n,r,i,s)}static adam(t=.001,n=.9,r=.999,i=null){return new QB(t,n,r,i)}static adadelta(t=.001,n=.95,r=null){return new ZB(t,n,r)}static adamax(t=.002,n=.9,r=.999,i=null,s=0){return new e5(t,n,r,i,s)}static adagrad(t,n=.1){return new JB(t,n)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Hc=Ine;/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const aIe=(()=>typeof requestAnimationFrame<"u"?requestAnimationFrame:typeof setImmediate<"u"?setImmediate:e=>e())();function c5(){return new Promise(e=>aIe(()=>e()))}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function f5(e,t){const n=e[0].length;e.forEach((i,s)=>{N(i.length===n,()=>`Error in concat${n}D: rank of tensors[${s}] must be the same as the rank of the rest (${n})`)}),N(t>=0&&t<n,()=>`Error in concat${n}D: axis must be between 0 and ${n-1}.`);const r=e[0];e.forEach((i,s)=>{for(let o=0;o<n;o++)N(o===t||i[o]===r[o],()=>`Error in concat${n}D: Shape of tensors[${s}] (${i}) does not match the shape of the rest (${r}) along the non-concatenated axis ${s}.`)})}function Cu(e,t){const n=e[0].slice();for(let r=1;r<e.length;r++)n[t]+=e[r][t];return n}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var fa;(function(e){e[e.FIRST_DIM_SIZE=0]="FIRST_DIM_SIZE",e[e.VALUE_ROWIDS=1]="VALUE_ROWIDS",e[e.ROW_LENGTHS=2]="ROW_LENGTHS",e[e.ROW_SPLITS=3]="ROW_SPLITS",e[e.ROW_LIMITS=4]="ROW_LIMITS",e[e.ROW_STARTS=5]="ROW_STARTS"})(fa||(fa={}));function Dne(e,t,n){let r=new Array;if(n==null&&t==null)return r;if(t==null)for(;r.length<e+n.length;)r.push(-1);else r=t.slice();if(n==null)return r;if(e+n.length!==r.length)throw new Error(`rt input.shape and shape=${t} are incompatible: rt input.rank = ${e+n.length}, but shape.rank = ${r.length}`);for(let i=1;i<n.length;++i){const s=n[i],o=r[r.length-n.length+i],a=r[o];if(s>=0)if(a>=0){if(a!==s)throw new Error(`rt input.shape and shape=${t} are incompatible: rt input.shape[${i+e}] = ${s} but shape[${i+e}] = ${a}`)}else r[o]=s}return r}function Nne(e){const t={FIRST_DIM_SIZE:fa.FIRST_DIM_SIZE,VALUE_ROWIDS:fa.VALUE_ROWIDS,ROW_LENGTHS:fa.ROW_LENGTHS,ROW_SPLITS:fa.ROW_SPLITS,ROW_LIMITS:fa.ROW_LIMITS,ROW_STARTS:fa.ROW_STARTS},n=[];for(const r of e)if(r in t)n.push(t[r]);else break;return n}function Fne(e){return e.length===0?0:e[0]===fa.FIRST_DIM_SIZE?e.length-1:e.length}function One(e,t){if(e==null||t==null)return;const n=e.length,r=t.length;if(n>=r)throw new Error(`defaultValue.shape=${e} and ragged tensor flatValues.shape=${t}, are incompatible: defaultValue.rank = ${n} must be less than ragged tensor input flatValues.rank = ${r})`);for(let i=0;i<Math.min(n,r-1);++i){const s=e[i],o=t[i+1];if(s>=0&&o>=0&&s!==1&&s!==o)throw new Error(`defaultValue.shape=${e}, and ragged tensor input flatValues.shape=${t} are incompatible: defaultValue.shape[${i-e.length}] = ${s} but ragged tensor input.flatValues.shape[${i-e.length}] = ${o}`)}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const h5=30;function gI(e){return e<=h5?e:Ik(e,Math.floor(Math.sqrt(e)))}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function d5(e,t,n){const r=n*(typeof e=="number"?e:e[0]),i=t*(typeof e=="number"?e:e[1]);return[r,i]}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Pw(e,t,n,r=!0){let i=[];if(r)i=i.concat(t.slice(0)),i.push(e[0]/n),i=i.concat(e.slice(1));else{i=i.concat(e[0]);const s=t.length;for(let o=0;o<s;++o)i=i.concat([e[o+1]/t[o],t[o]]);i=i.concat(e.slice(s+1))}return i}function Bw(e,t,n=!0){const r=[];if(n){r.push(t);for(let i=t+1;i<e;++i)i<=2*t?(r.push(i),r.push(i-(t+1))):r.push(i)}else{const i=[],s=[];for(let o=1;o<e;++o)o>=t*2+1||o%2===1?s.push(o):i.push(o);r.push(...i),r.push(0),r.push(...s)}return r}function zw(e,t,n,r=!0){const i=[];r?i.push(e[0]/n):i.push(e[0]*n);for(let s=1;s<e.length;++s)s<=t.length?r?i.push(t[s-1]*e[s]):i.push(e[s]/t[s-1]):i.push(e[s]);return i}function p5(e,t){const n=[0];for(let r=0;r<t;++r)n.push(e[r][0]);return n}function g5(e,t,n){const r=e.slice(0,1);for(let i=0;i<n;++i)r.push(e[i+1]-t[i][0]-t[i][1]);return r}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const mI=1.7580993408473768,yI=1.0507009873554805;/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const m5=.3275911,y5=.254829592,b5=-.284496736,x5=1.421413741,v5=-1.453152027,w5=1.061405429;/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uc(e,t){if(e.length!==t.length)throw new Error(`Cannot merge real and imag arrays of different lengths. real:${e.length}, imag: ${t.length}.`);const n=new Float32Array(e.length*2);for(let r=0;r<n.length;r+=2)n[r]=e[r/2],n[r+1]=t[r/2];return n}function Rne(e){const t=new Float32Array(e.length/2),n=new Float32Array(e.length/2);for(let r=0;r<e.length;r+=2)t[r/2]=e[r],n[r/2]=e[r+1];return{real:t,imag:n}}function Mne(e){const t=Math.ceil(e.length/4),n=new Float32Array(t),r=new Float32Array(t);for(let i=0;i<e.length;i+=4)n[Math.floor(i/4)]=e[i],r[Math.floor(i/4)]=e[i+1];return{real:n,imag:r}}function Lne(e){const t=Math.floor(e.length/4),n=new Float32Array(t),r=new Float32Array(t);for(let i=2;i<e.length;i+=4)n[Math.floor(i/4)]=e[i],r[Math.floor(i/4)]=e[i+1];return{real:n,imag:r}}function $5(e,t){const n=e[t*2],r=e[t*2+1];return{real:n,imag:r}}function Pne(e,t,n,r){e[r*2]=t,e[r*2+1]=n}function Bne(e,t){const n=new Float32Array(e/2),r=new Float32Array(e/2);for(let i=0;i<Math.ceil(e/2);i++){const s=(t?2:-2)*Math.PI*(i/e);n[i]=Math.cos(s),r[i]=Math.sin(s)}return{real:n,imag:r}}function zne(e,t,n){const r=(n?2:-2)*Math.PI*(e/t),i=Math.cos(r),s=Math.sin(r);return{real:i,imag:s}}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const r3="->",uIe=/->/g,TV=",",IV="...";function C5(e,t){e=e.replace(/\s/g,"");const n=(e.length-e.replace(uIe,"").length)/r3.length;if(n<1)throw new Error("Equations without an arrow are not supported.");if(n>1)throw new Error(`Equation must contain exactly one arrow ("${r3}").`);const[r,i]=e.split(r3);N(r.indexOf(IV)===-1,()=>`The ellipsis notation ("${IV}") is not supported yet.`);const s=r.split(TV),o=s.length;if(t!==o)throw new Error(`Expected ${o} input tensors, received ${t}`);if(o>2)throw new Error("Support for more than 2 input tensors is not implemented yet.");const a=[];for(let h=0;h<i.length;++h){const d=i[h];if(!s.some(p=>p.indexOf(d)!==-1))throw new Error(`Output subscripts contain the label ${d} not present in the input subscripts.`);a.indexOf(d)===-1&&a.push(d)}for(let h=0;h<r.length;++h){const d=r[h];a.indexOf(d)===-1&&d!==TV&&a.push(d)}const u=new Array(s.length);for(let h=0;h<o;++h){if(new Set(s[h].split("")).size!==s[h].length)throw new Error(`Found duplicate axes in input component ${s[h]}. Support for duplicate axes in input is not implemented yet.`);u[h]=[];for(let d=0;d<s[h].length;++d)u[h].push(a.indexOf(s[h][d]))}const l=a.length,c=i.length,f=[];for(let h=c;h<l;++h)f.push(h);return{allDims:a,summedDims:f,idDims:u}}function S5(e,t){let n=new Array(e);n.fill(-1);for(let i=0;i<t.length;++i)n[t[i]]=i;const r=[];for(let i=0;i<e;++i)n[i]===-1&&r.push(i);return n=n.filter(i=>i!==-1),{permutationIndices:n,expandDims:r}}function k5(e,t,n){const r=new Array(e);for(let i=0;i<n.length;++i){const s=n[i].shape;for(let o=0;o<t[i].length;++o)r[t[i][o]]===void 0?r[t[i][o]]=s[o]:N(r[t[i][o]]===s[o],()=>`Expected dimension ${r[t[i][o]]} at axis ${o} of input shaped ${JSON.stringify(s)}, but got dimension ${s[o]}`)}}function E5(e,t){const n=e,r=[];let i=0;e.length===0&&n.push(-1),i=e.length+1;for(let o=0;o<i;++o)r.push([]);const s=[];for(let o=0;o<n.length;++o){const a=n[o],u=lIe(t,a);for(const l of u)s.indexOf(l)===-1&&(r[o].push(l),s.push(l))}return{path:n,steps:r}}function _5(e){return e.every((t,n)=>t===n)}function lIe(e,t){const n=[];for(let r=0;r<e.length;++r)(e[r].length===0||e[r].indexOf(t)!==-1||t===-1)&&n.push(r);return n}function A5(e,t,n=0){let r=[];if(typeof t=="number")N(e.shape[n]%t===0,()=>"Number of splits must evenly divide the axis."),r=new Array(t).fill(e.shape[n]/t);else{const i=t.reduce((o,a)=>(a===-1&&(o+=1),o),0);N(i<=1,()=>"There should be only one negative value in split array.");const s=t.indexOf(-1);if(s!==-1){const o=t.reduce((a,u)=>u>0?a+u:a);t[s]=e.shape[n]-o}N(e.shape[n]===t.reduce((o,a)=>o+a),()=>"The sum of sizes must match the size of the axis dimension."),r=t}return r}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Une(e){return`Received SparseTensor with denseShape[0] = 0 but
  indices.shape[0] = ${e}`}function jne(e,t){return`indices(${e}, 0) is invalid: ${t} < 0`}function Wne(e,t,n){return`indices(${e}, 0) is invalid: ${t} >= ${n}`}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Vne(e,t){return`only one output dimension may be -1, not both ${e} and ${t}`}function Gne(e,t){return`size ${e} must be non-negative, not ${t}`}function Hne(){return"reshape cannot infer the missing input size for an empty tensor unless all specified input sizes are non-zero"}function qne(e,t){const n=te(e),r=te(t);return`Input to reshape is a SparseTensor with ${n}
  dense values, but the requested shape requires a multiple of ${r}. inputShape=${e} outputShape= ${t}`}function Xne(e,t){const n=te(e),r=te(t);return`Input to reshape is a tensor with ${n} dense values, but the requested shape has ${r}. inputShape=${e} outputShape=${t}`}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rM(){return"segment ids must be >= 0"}function Yne(){return"segment ids are not increasing"}function Kne(e,t){return`Segment id ${e} out of range [0, ${t}), possibly because segmentIds input is not sorted.`}function Zne(e,t,n){return`Bad: indices[${e}] == ${t} out of range [0, ${n})`}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Jne(e,t){let n=!1,r;for(e<=h5?(r=e,n=!0):r=Ik(e,Math.floor(Math.sqrt(e)));!n;)r>t||r===e?n=!0:r=Ik(e,r+1);return r}function Qne(e,t,n){const r=[],i=e.length;for(let s=0;s<i;s++)s!==t?r.push(e[s]):r.push(n);return r}function T5(e,t,n,r){const i=t.shape.length,s=e.shape.length;if(r!==0&&(r<-i||r>i))throw new Error(`Expect batchDims in the range of [-${i}, ${i}], but got ${r}`);if(r<0&&(r+=i),r>s)throw new Error(`batchDims (${r}) must be less than rank(x) (
    ${s}).`);if(n<r)throw new Error(`batchDims (${r}) must be less than or equal to axis (${n}).`);for(let f=0;f<r;++f)if(e.shape[f]!==t.shape[f])throw new Error(`x.shape[${f}]: ${e.shape[f]} should be equal to indices.shape[${f}]: ${t.shape[f]}.`);const o=e.shape[n],a=[];let u=1,l=1,c=1;for(let f=0;f<r;++f)a.push(e.shape[f]),u*=e.shape[f];for(let f=r;f<n;f++)a.push(e.shape[f]),l*=e.shape[f];for(let f=r;f<i;f++)a.push(t.shape[f]);for(let f=n+1;f<s;f++)a.push(e.shape[f]),c*=e.shape[f];return{batchSize:u,sliceSize:c,outerSize:l,dimSize:o,outputShape:a}}const cIe=Object.freeze(Object.defineProperty({__proto__:null,collectGatherOpShapeInfo:T5,computeOutShape:Qne,segOpComputeOptimalWindowSize:Jne},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lc(e){try{return e.map(t=>oc(t))}catch(t){throw new Error(`Failed to decode encoded string bytes into utf-8, error: ${t}`)}}function ere(e){return e.map(t=>wu(t))}const tre=Object.freeze(Object.defineProperty({__proto__:null,ERF_A1:y5,ERF_A2:b5,ERF_A3:x5,ERF_A4:v5,ERF_A5:w5,ERF_P:m5,PARALLELIZE_THRESHOLD:h5,get RowPartitionType(){return fa},SELU_SCALE:yI,SELU_SCALEALPHA:mI,applyActivation:aI,assertAndGetBroadcastShape:Ze,assertAxesAreInnerMostDims:Rr,assertParamsConsistent:f5,assignToTypedArray:Pne,axesAreInnerMostDims:xB,calculateShapes:Th,checkEinsumDimSizes:k5,checkPadOnDimRoundingMode:Di,combineLocations:Ite,combineRaggedTensorToTensorShapes:Dne,complexWithEvenIndex:Mne,complexWithOddIndex:Lne,computeConv2DInfo:dr,computeConv3DInfo:kh,computeDefaultPad:dB,computeDilation2DInfo:Dw,computeOptimalWindowSize:gI,computeOutAndReduceShapes:pr,computeOutShape:Cu,computePool2DInfo:Ho,computePool3DInfo:vc,convertConv2DDataFormat:wc,decodeEinsumEquation:C5,eitherStridesOrDilationsAreOne:Or,expandShapeToKeepDim:Fn,exponent:zne,exponents:Bne,fromStringArrayToUint8:ere,fromUint8ToStringArray:lc,getAxesPermutation:Cn,getBroadcastDims:yp,getComplexWithIndex:$5,getEinsumComputePath:E5,getEinsumPermutation:S5,getFusedBiasGradient:oI,getFusedDyActivation:sI,getImageCenter:d5,getInnerMostAxes:On,getPermuted:Bw,getRaggedRank:Fne,getReductionAxes:Un,getReshaped:Pw,getReshapedPermuted:zw,getRowPartitionTypesHelper:Nne,getSliceBeginCoords:p5,getSliceSize:g5,getSparseFillEmptyRowsIndicesDenseShapeMismatch:Une,getSparseFillEmptyRowsNegativeIndexErrorMessage:jne,getSparseFillEmptyRowsOutOfRangeIndexErrorMessage:Wne,getSparseReshapeEmptyTensorZeroOutputDimErrorMessage:Hne,getSparseReshapeInputOutputMismatchErrorMessage:Xne,getSparseReshapeInputOutputMultipleErrorMessage:qne,getSparseReshapeMultipleNegativeOneOutputDimErrorMessage:Vne,getSparseReshapeNegativeOutputDimErrorMessage:Gne,getSparseSegmentReductionIndicesOutOfRangeErrorMessage:Zne,getSparseSegmentReductionNegativeSegmentIdsErrorMessage:rM,getSparseSegmentReductionNonIncreasingSegmentIdsErrorMessage:Yne,getSparseSegmentReductionSegmentIdOutOfRangeErrorMessage:Kne,getUndoAxesPermutation:Eh,isIdentityPermutation:_5,log:fwe,mergeRealAndImagArrays:uc,prepareAndValidate:dI,prepareSplitSize:A5,segment_util:cIe,shouldFuse:uI,slice_util:Tne,splitRealAndImagArrays:Rne,stridesOrDilationsArePositive:mp,tupleValuesAreOne:Mf,upcastType:qi,validateDefaultValueShape:One,validateInput:rI,validateUpdateShape:GB,warn:Hs},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const fIe=Object.freeze(Object.defineProperty({__proto__:null,nonMaxSuppressionV3Impl:lI,nonMaxSuppressionV4Impl:cI,nonMaxSuppressionV5Impl:fI,whereImpl:iI},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */STe();const hIe=Object.freeze(Object.defineProperty({__proto__:null,Abs:E2,Acos:H0,Acosh:q0,AdadeltaOptimizer:ZB,AdagradOptimizer:JB,AdamOptimizer:QB,AdamaxOptimizer:e5,Add:rg,AddN:_2,All:NA,Any:FA,ArgMax:A2,ArgMin:T2,Asin:X0,Asinh:Y0,Atan:K0,Atan2:J0,Atanh:Z0,AvgPool:I2,AvgPool3D:D2,AvgPool3DGrad:RA,AvgPoolGrad:OA,BatchMatMul:N2,BatchToSpaceND:F2,Bincount:MA,BitwiseAnd:O2,BroadcastArgs:LA,BroadcastTo:$ee,Cast:Q0,Ceil:e1,ClipByValue:t1,Complex:PA,ComplexAbs:R2,Concat:M2,Conv2D:L2,Conv2DBackpropFilter:BA,Conv2DBackpropInput:P2,Conv3D:B2,Conv3DBackpropFilterV2:zA,Conv3DBackpropInputV2:UA,Cos:n1,Cosh:r1,CropAndResize:WA,Cumprod:jA,Cumsum:z2,DataStorage:KP,DenseBincount:VA,DepthToSpace:GA,DepthwiseConv2dNative:U2,DepthwiseConv2dNativeBackpropFilter:HA,DepthwiseConv2dNativeBackpropInput:qA,Diag:XA,Dilation2D:j2,Dilation2DBackpropFilter:Nk,Dilation2DBackpropInput:Dk,Draw:YA,get ENV(){return tB},Einsum:KA,Elu:s1,EluGrad:ZA,Environment:vee,Equal:W2,Erf:o1,Exp:a1,ExpandDims:V2,Expm1:u1,FFT:JA,Fill:QA,FlipLeftRight:eT,Floor:l1,FloorDiv:c1,FromPixels:Fk,FusedBatchNorm:G2,FusedConv2D:Lx,FusedDepthwiseConv2D:Px,GatherNd:tT,GatherV2:H2,Greater:q2,GreaterEqual:f1,IFFT:nT,Identity:h1,Imag:rT,IsFinite:d1,IsInf:p1,IsNan:g1,KernelBackend:AA,LRN:ew,LRNGrad:sT,LeakyRelu:X2,Less:Y2,LessEqual:K2,LinSpace:iT,Log:m1,Log1p:y1,LogSoftmax:Cee,LogicalAnd:Z2,LogicalNot:J2,LogicalOr:Q2,LogicalXor:owe,LowerBound:awe,MatrixBandPart:uwe,Max:tw,MaxPool:nw,MaxPool3D:rw,MaxPool3DGrad:aT,MaxPoolGrad:oT,MaxPoolWithArgmax:uT,Maximum:b1,Mean:iw,Min:sw,Minimum:x1,MirrorPad:ow,Mod:v1,MomentumOptimizer:t5,Multinomial:lT,Multiply:w1,Neg:aw,NonMaxSuppressionV3:cT,NonMaxSuppressionV4:fT,NonMaxSuppressionV5:hT,NotEqual:uw,OP_SCOPE_SUFFIX:jee,OneHot:cw,OnesLike:lw,Optimizer:Sc,OptimizerConstructors:Ine,Pack:fw,PadV2:hw,Pool:lwe,Pow:$1,Prelu:dw,Prod:pw,RMSPropOptimizer:n5,RaggedGather:dT,RaggedRange:pT,RaggedTensorToTensor:gT,Range:mT,get Rank(){return BR},Real:yT,RealDiv:i1,Reciprocal:C1,get Reduction(){return di},Relu:S1,Relu6:k1,Reshape:gw,ResizeBilinear:yw,ResizeBilinearGrad:xT,ResizeNearestNeighbor:mw,ResizeNearestNeighborGrad:bT,Reverse:bw,RotateWithOffset:MT,Round:E1,Rsqrt:_1,SGDOptimizer:hI,ScatterNd:vT,SearchSorted:$T,Select:xw,Selu:A1,Sigmoid:N1,Sign:D1,Sin:T1,Sinh:I1,Slice:vw,Softmax:Sw,Softplus:F1,SpaceToBatchND:$w,SparseFillEmptyRows:CT,SparseReshape:ST,SparseSegmentMean:kT,SparseSegmentSum:ET,SparseToDense:_T,SplitV:Cw,Sqrt:O1,Square:AT,SquaredDifference:R1,StaticRegexReplace:kw,Step:z1,StridedSlice:TT,StringNGrams:IT,StringSplit:DT,StringToHashBucketFast:NT,Sub:M1,Sum:ww,Tan:L1,Tanh:P1,Tensor:Pt,TensorBuffer:zn,TensorScatterUpdate:wT,Tile:B1,TopK:FT,Transform:OT,Transpose:Kd,Unique:RT,Unpack:Ew,UnsortedSegmentSum:_w,UpperBound:cwe,Variable:Ux,ZerosLike:Aw,_FusedMatMul:Mx,abs:Gn,acos:ite,acosh:ste,add:ce,addN:W$e,all:hB,any:Pk,argMax:Hm,argMin:ote,asin:ate,asinh:ute,atan:lte,atan2:cte,atanh:fte,avgPool:BT,avgPool3d:hte,backend:rte,backend_util:tre,basicLSTMCell:hCe,batchNorm:Nw,batchNorm2d:dte,batchNorm3d:pte,batchNorm4d:gte,batchToSpaceND:zT,bincount:mte,bitwiseAnd:wCe,booleanMaskAsync:b_e,broadcastArgs:CCe,broadcastTo:_m,broadcast_util:XCe,browser:eIe,buffer:rt,cast:we,ceil:yte,clipByValue:_s,clone:$f,complex:Rf,concat:lr,concat1d:bte,concat2d:xte,concat3d:vte,concat4d:wte,conv1d:pB,conv2d:Lf,conv2dTranspose:mB,conv3d:$te,conv3dTranspose:Ste,copyRegisteredKernels:pwe,cos:UT,cosh:yB,cosineWindow:XB,cumprod:Bk,cumsum:bB,customGrad:Mu,denseBincount:ZR,deprecationWarn:S$e,depthToSpace:kte,depthwiseConv2d:Fw,device_util:Uwe,diag:HCe,dilation2d:Ete,disableDeprecationWarnings:C$e,dispose:at,disposeVariables:k$e,div:Re,divNoNan:_te,dot:Ate,dropout:ine,einsum:pm,elu:Ow,enableDebugMode:$$e,enableProdMode:w$e,enclosingPowerOfTwo:sne,engine:aa,ensureShape:rSe,env:K,equal:Ia,erf:Tte,euclideanNorm:Nte,exp:no,expandDims:hi,expm1:Fte,eye:vB,fft:tI,fill:U1,findBackend:N$e,findBackendFactory:F$e,floor:Mw,floorDiv:fB,fused:z_e,gather:Lw,gatherND:A_e,gather_util:tIe,getBackend:I$e,getGradient:MR,getKernel:zx,getKernelsForBackend:Ok,grad:FSe,grads:OSe,greater:zs,greaterEqual:_h,ifft:Kx,imag:jT,image:yu,inTopKAsync:N_e,io:UTe,irfft:WB,isFinite:Ote,isInf:Rte,isNaN:Mte,keep:Ca,kernel_impls:fIe,leakyRelu:WT,less:Hx,lessEqual:sg,linalg:dne,linspace:TSe,localResponseNormalization:Lte,log:ro,log1p:VT,logSigmoid:Bte,logSoftmax:wB,logSumExp:$B,logicalAnd:Lu,logicalNot:HT,logicalOr:CB,logicalXor:zte,losses:yTe,lowerBound:XSe,matMul:ot,math:VTe,max:Oo,maxPool:qT,maxPool3d:Ute,maxPoolWithArgmax:JSe,maximum:$c,mean:kn,memory:Lk,meshgrid:tke,min:Gx,minimum:bp,mirrorPad:jte,mod:Wte,moments:XT,movingAverage:w_e,mul:j,multiRNNCell:ake,multinomial:lke,neg:un,nextFrame:c5,norm:Rw,notEqual:Xm,oneHot:qx,ones:Ys,onesLike:io,op:U,outerProduct:pke,pad:Ah,pad1d:yke,pad2d:xke,pad3d:wke,pad4d:Cke,pool:Vte,pow:Pf,prelu:KT,print:nte,prod:Gte,profile:E$e,raggedGather:Dke,raggedRange:Fke,raggedTensorToTensor:Rke,rand:Lke,randomGamma:dEe,randomNormal:OB,randomStandardNormal:mEe,randomUniform:ag,randomUniformInt:xEe,range:Ym,ready:T$e,real:Xx,reciprocal:Yte,registerBackend:cB,registerGradient:See,registerKernel:LT,relu:Zu,relu6:RB,removeBackend:D$e,reshape:V,reverse:Lo,reverse1d:EEe,reverse2d:AEe,reverse3d:IEe,reverse4d:NEe,rfft:nI,round:MB,rsqrt:LB,scalar:qe,scatterND:C_e,scatter_util:a_e,searchSorted:SB,selu:PB,separableConv2d:BB,serialization:$Te,setBackend:A$e,setPlatform:O$e,setdiff1dAsync:PEe,sigmoid:$u,sign:Kte,signal:mTe,sin:zB,sinh:UB,slice:wt,slice1d:JT,slice2d:jB,slice3d:QT,slice4d:Yx,slice_util:Tne,softmax:eI,softplus:j1,spaceToBatchND:YT,sparse:bTe,sparseToDense:E_e,spectral:gTe,split:ks,sqrt:Kr,square:Xt,squaredDifference:VB,squeeze:ug,stack:ac,step:W1,stridedSlice:Zte,string:xTe,sub:_e,sum:Ae,sumOutType:PT,tan:Jte,tanh:qm,tensor:Zd,tensor1d:mi,tensor2d:Bl,tensor3d:Qte,tensor4d:i_e,tensor5d:s_e,tensor6d:o_e,tensorScatterUpdate:l_e,tensor_util:Mwe,test_util:lEe,tidy:Z,tile:So,time:_$e,topk:ene,train:Hc,transpose:mt,truncatedNormal:HB,unique:tne,unregisterGradient:dwe,unregisterKernel:hwe,unsortedSegmentSum:qB,unstack:Bf,upcastType:qi,upperBound:g_e,util:Cwe,valueAndGrad:RSe,valueAndGrads:MSe,variable:nne,variableGrads:Pte,version_core:oIe,where:Xr,whereAsync:rne,zeros:Hn,zerosLike:xt},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nre={kernelName:E2,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>j(e,W1(we(n,"float32"),-1))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const dIe={kernelName:H0,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>{const r=Xt(we(n,"float32")),i=Kr(_e(qe(1),r));return un(Re(e,i))}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const pIe={kernelName:q0,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>{const r=Kr(_e(Xt(we(n,"float32")),1));return Re(e,r)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gIe={kernelName:rg,inputsToSave:["a","b"],gradFunc:(e,t)=>{const[n,r]=t,i=Ze(n.shape,r.shape);return{a:()=>{let a=e;const u=Un(n.shape,i);return u.length>0&&(a=Ae(a,u)),V(a,n.shape)},b:()=>{let a=e;const u=Un(r.shape,i);return u.length>0&&(a=Ae(a,u)),V(a,r.shape)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const mIe={kernelName:_2,saveAllInputs:!0,gradFunc:(e,t)=>{const n={};return t.forEach((r,i)=>{n[i]=()=>e.clone()}),n}};/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const yIe={kernelName:A2,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>xt(n)}}};/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const bIe={kernelName:T2,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>xt(n)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xIe={kernelName:X0,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>Re(e,Kr(_e(qe(1),Xt(we(n,"float32")))))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const vIe={kernelName:Y0,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>{const r=Kr(ce(qe(1),Xt(we(n,"float32"))));return Re(e,r)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wIe={kernelName:J0,inputsToSave:["a","b"],gradFunc:(e,t)=>{const[n,r]=t,i=Ze(n.shape,r.shape);return{a:()=>{const a=ce(Xt(n),Xt(r));let u=j(e,Re(r,a));const l=Un(n.shape,i);return l.length>0&&(u=Ae(u,l)),V(u,n.shape)},b:()=>{const a=ce(Xt(n),Xt(r));let u=un(j(e,Re(n,a)));const l=Un(r.shape,i);return l.length>0&&(u=Ae(u,l)),V(u,r.shape)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $Ie={kernelName:K0,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>Re(e,ce(Xt(we(n,"float32")),1))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const CIe={kernelName:Z0,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>Re(e,_e(qe(1),Xt(we(n,"float32"))))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function SIe(e,t,n,r,i,s){const o=O(e,"dy","avgPool3dGrad"),a=O(t,"input","avgPool3dGrad");let u=o,l=a,c=!1;a.rank===4&&(c=!0,u=V(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]]),l=V(a,[1,a.shape[0],a.shape[1],a.shape[2],a.shape[3]])),N(u.rank===5,()=>`Error in avgPool3dGrad: dy must be rank 5 but got rank ${u.rank}.`),N(l.rank===5,()=>`Error in avgPool3dGrad: input must be rank 5 but got rank ${l.rank}.`),Di("avgPool3dGrad",i,s);const f={dy:u,input:l},h={filterSize:n,strides:r,pad:i,dimRoundingMode:s},d=z.runKernel(RA,f,h);return c?V(d,[d.shape[1],d.shape[2],d.shape[3],d.shape[4]]):d}const kIe=U({avgPool3dGrad_:SIe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const EIe={kernelName:D2,inputsToSave:["x"],gradFunc:(e,t,n)=>{const[r]=t,{filterSize:i,strides:s,pad:o,dimRoundingMode:a}=n;return{x:()=>kIe(e,r,i,s,o,a)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _Ie(e,t,n,r,i){const s=O(e,"dy","avgPoolGrad"),o=O(t,"input","avgPoolGrad");N(o.rank===s.rank,()=>`Rank of input (${o.rank}) does not match rank of dy (${s.rank})`);let a=o,u=s,l=!1;o.rank===3&&(l=!0,a=V(o,[1,o.shape[0],o.shape[1],o.shape[2]]),u=V(s,[1,s.shape[0],s.shape[1],s.shape[2]])),N(u.rank===4,()=>`Error in avgPoolGrad: dy must be rank 4 but got rank ${u.rank}.`),N(a.rank===4,()=>`Error in avgPoolGrad: input must be rank 4 but got rank ${a.rank}.`);const c={dy:u,input:a},f={filterSize:n,strides:r,pad:i},h=z.runKernel(OA,c,f);return l?V(h,[h.shape[1],h.shape[2],h.shape[3]]):h}const AIe=U({avgPoolGrad_:_Ie});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const TIe={kernelName:I2,inputsToSave:["x"],gradFunc:(e,t,n)=>{const[r]=t,{filterSize:i,strides:s,pad:o}=n;return{x:()=>AIe(e,r,i,s,o)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const IIe={kernelName:N2,inputsToSave:["a","b"],gradFunc:(e,t,n)=>{const[r,i]=t,{transposeA:s,transposeB:o}=n;return!s&&!o?{a:()=>ot(e,i,!1,!0),b:()=>ot(r,e,!0,!1)}:!s&&o?{a:()=>ot(e,i,!1,!1),b:()=>ot(e,r,!0,!1)}:s&&!o?{a:()=>ot(i,e,!1,!0),b:()=>ot(r,e,!1,!1)}:{a:()=>ot(i,e,!0,!0),b:()=>ot(e,r,!0,!0)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const DIe={kernelName:F2,gradFunc:(e,t,n)=>{const{blockShape:r,crops:i}=n;return{x:()=>YT(e,r,i)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const NIe={kernelName:$ee,gradFunc:(e,t,n)=>{const r=n,i=r.inputShape,s=r.shape,o=Array.from(s);for(let u=i.length-1;u>=0;u--)if(i[u]===s[u])o[u]=1;else if(i[u]!==1)throw new Error(`broadcastTo(): [${i}] cannot be broadcast to [${s}].`);const a=[];for(let u=0;u<o.length;u++)o[u]>1&&a.push(u);return{x:()=>Ae(e,a,!0)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const FIe={kernelName:Q0,gradFunc:e=>({x:()=>e.clone()})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const OIe={kernelName:e1,gradFunc:e=>({x:()=>xt(e)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const RIe={kernelName:t1,inputsToSave:["x"],gradFunc:(e,t,n)=>{const[r]=t,{clipValueMin:i,clipValueMax:s}=n;return{x:()=>Xr(Lu(_h(r,i),sg(r,s)),e,xt(e))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const MIe={kernelName:R2,inputsToSave:["x"],gradFunc:nre.gradFunc};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const LIe={kernelName:M2,saveAllInputs:!0,gradFunc:(e,t,n)=>{const r=t.map(u=>u.shape),{axis:i}=n,s=st(i,t[0].shape)[0],o=r.map(u=>u[s]);return ks(e,o,s).map(u=>()=>u)}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const PIe={kernelName:L2,inputsToSave:["x","filter"],gradFunc:(e,t,n)=>{const[r,i]=t,{dilations:s,strides:o,pad:a,dataFormat:u}=n;return N(Mf(s),()=>`Error in gradient of conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${s}'`),{x:()=>gB(r.shape,e,i,o,a,u),filter:()=>YB(r,e,i.shape,o,a,u)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const BIe={kernelName:P2,inputsToSave:["dy","filter"],gradFunc:(e,t,n)=>{const[r,i]=t,{strides:s,pad:o,dataFormat:a,dimRoundingMode:u}=n;return{dy:()=>Lf(e,i,s,o,a,1,u),filter:()=>YB(e,r,i.shape,s,o,a,u)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zIe(e,t,n,r,i){let s=e;e.rank===4&&(s=V(e,[1,e.shape[0],e.shape[1],e.shape[2],e.shape[3]]));let o=t;o.rank===4&&(o=V(t,[1,t.shape[0],t.shape[1],t.shape[2],t.shape[3]])),N(s.rank===5,()=>`Error in conv3dDerFilter: input must be rank 5, but got shape ${s.shape}.`),N(o.rank===5,()=>`Error in conv3dDerFilter: dy must be rank 5, but got shape ${o.shape}.`),N(n.length===5,()=>`Error in conv3dDerFilter: filterShape must be length 5, but got ${n}.`),N(s.shape[4]===n[3],()=>`Error in conv3dDerFilter: depth of input ${s.shape[4]}) must match input depth in filter (${n[3]}.`),N(o.shape[4]===n[4],()=>`Error in conv3dDerFilter: depth of dy (${o.shape[4]}) must match output depth for filter (${n[4]}).`);const a={x:s,dy:o},u={strides:r,pad:i,filterShape:n};return z.runKernel(zA,a,u)}const UIe=U({conv3DBackpropFilter_:zIe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const jIe={kernelName:B2,inputsToSave:["x","filter"],gradFunc:(e,t,n)=>{const{dilations:r,strides:i,pad:s}=n;N(Mf(r),()=>`Error in gradient of conv3D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${r}'`);const[o,a]=t;return{x:()=>Cte(o.shape,e,a,i,s),filter:()=>UIe(o,e,a.shape,i,s)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const WIe={kernelName:n1,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>j(un(zB(we(n,"float32"))),e)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const VIe={kernelName:r1,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>j(UB(we(n,"float32")),e)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const GIe={kernelName:z2,inputsToSave:["x"],gradFunc:(e,t,n)=>{const[r]=t,{axis:i,exclusive:s,reverse:o}=n;return{x:()=>{const a=Cn([i],r.rank);let u=bB(e,i,s,!o);return a!=null&&(u=mt(u,a)),u}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const HIe={kernelName:U2,inputsToSave:["x","filter"],gradFunc:(e,t,n)=>{const{dilations:r,strides:i,pad:s,dimRoundingMode:o}=n,a=r??[1,1];N(Mf(a),()=>`Error in gradient of depthwiseConv2dNative: dilation rates greater than 1 are not yet supported. Got dilations '${a}'`);const[u,l]=t;return N(u.rank===4,()=>`Error in gradient of depthwiseConv2dNative: input must be rank 4, but got rank ${u.rank}.`),N(l.rank===4,()=>`Error in gradient of depthwiseConv2dNative: filter must be rank 4, but got rank ${l.rank}.`),N(u.shape[3]===l.shape[2],()=>`Error in gradient of depthwiseConv2d: number of input channels (${u.shape[3]}) must match the inChannels dimension in filter ${l.shape[2]}.`),N(Or(i,a),()=>`Error in gradient of depthwiseConv2d: Either strides or dilations must be  1. Got strides ${i} and dilations '${a}'.`),Di("depthwiseConv2d",s,o),{x:()=>une(u.shape,e,l,i,s,a,o),filter:()=>ane(u,e,l.shape,i,s,a,o)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qIe={kernelName:j2,inputsToSave:["x","filter"],gradFunc:(e,t,n)=>{const[r,i]=t,s={x:r,filter:i,dy:e},o={x:r,filter:i,dy:e};return{x:()=>z.runKernel(Dk,s,n),filter:()=>z.runKernel(Nk,o,n)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const XIe={kernelName:s1,outputsToSave:[!0],gradFunc:(e,t)=>{const[n]=t,r={dy:e,y:n};return{x:()=>z.runKernel(ZA,r)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const YIe={kernelName:o1,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t,r=j(no(un(Xt(n))),2/Math.sqrt(Math.PI));return{x:()=>j(e,r)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const KIe={kernelName:a1,outputsToSave:[!0],gradFunc:(e,t)=>{const[n]=t;return{x:()=>j(e,n)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ZIe={kernelName:V2,inputsToSave:["input"],gradFunc:(e,t)=>{const[n]=t;return{input:()=>V(e,n.shape)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const JIe={kernelName:u1,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>j(e,no(n))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const QIe={kernelName:l1,gradFunc:e=>({x:()=>xt(e)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const eDe={kernelName:c1,inputsToSave:["a","b"],gradFunc:(e,t)=>{const[n,r]=t,i=Ze(n.shape,r.shape);return{a:()=>{const a=Re(e,we(r,"float32")),u=Un(n.shape,i);return u.length>0?V(Ae(a,u),n.shape):a},b:()=>{let a=j(e,we(n,"float32"));const u=Un(r.shape,i);u.length>0&&(a=V(Ae(a,u),r.shape));const l=Xt(r);return un(Re(a,we(l,"float32")))}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const tDe={kernelName:G2,inputsToSave:["x","mean","variance","scale"],gradFunc:(e,t,n)=>{const{varianceEpsilon:r}=n,[i,s,o,a]=t,u=a??qe(1),l=Un(s.shape,i.shape),c=[];if(s.rank===1){for(let x=0;x<i.shape.length-1;++x)c.push(i.shape[x]);c.push(1)}const f=_e(i,s),h=j(e,u),d=LB(ce(o,qe(r))),p=j(j(j(d,d),d),qe(-.5));return{x:()=>s.rank===1?V(j(j(e,So(V(d,[1,1,1,s.shape[0]]),c)),u),i.shape):V(j(j(e,d),u),i.shape),mean:()=>{let x=j(j(d,qe(-1)),h);return s.rank===1&&(x=Ae(x,l)),V(x,s.shape)},variance:()=>{let x=j(j(p,f),h);return s.rank===1&&(x=Ae(x,l)),V(x,s.shape)},scale:()=>{const x=j(f,d);let w=j(e,x);return s.rank===1&&(w=Ae(w,l)),V(w,s.shape)},offset:()=>{let x=e;return s.rank===1&&(x=Ae(x,l)),V(x,s.shape)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nDe={kernelName:H2,inputsToSave:["x","indices"],gradFunc:(e,t,n)=>{const[r,i]=t,{axis:s}=n,o=st(s,r.shape)[0];return{x:()=>{const u=r.shape,l=i.size,c=u.slice(0,o),f=c.length,h=u.slice(s,u.length).slice(1),d=h.length,p=DV(0,f),g=DV(f+1,f+1+d),m=NV([c,[l],h]),y=V(e,m),b=V(i,[l]),v=NV([[f],p,g]),x=mt(y,v);let w=qB(x,b,r.shape[o]);const C=Eh(v);return w=mt(w,C),w},indices:()=>i}}};function DV(e,t){const n=[];for(let r=e;r<t;++r)n.push(r);return n}function NV(e){const t=[];for(let n=0;n<e.length;++n)for(let r=0;r<e[n].length;++r)t.push(e[n][r]);return t}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const rDe={kernelName:f1,inputsToSave:["a","b"],gradFunc:(e,t)=>{const[n,r]=t;return{a:()=>xt(n),b:()=>xt(r)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const iDe={kernelName:h1,gradFunc:e=>({x:()=>we(e,"float32")})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sDe={kernelName:d1,gradFunc:e=>({x:()=>xt(e)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const oDe={kernelName:p1,gradFunc:e=>({x:()=>xt(e)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const aDe={kernelName:g1,gradFunc:e=>({x:()=>xt(e)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const uDe={kernelName:X2,inputsToSave:["x"],gradFunc:(e,t,n)=>{const[r]=t,{alpha:i}=n,s=zs(r,0);return{x:()=>Xr(s,e,j(e,i))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lDe={kernelName:y1,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>Re(e,ce(n,1))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const cDe={kernelName:m1,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>Re(e,we(n,"float32"))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const fDe={kernelName:Cee,inputsToSave:[],outputsToSave:[!0],gradFunc:(e,t,n)=>{const[r]=t,{axis:i}=n;return{logits:()=>{const o=no(r);return _e(e,j(Ae(e,i,!0),o))}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hDe(e,t,n,r=5,i=1,s=1,o=.5){const a={x:e,y:t,dy:n},u={depthRadius:r,bias:i,alpha:s,beta:o};return z.runKernel(sT,a,u)}const dDe=U({localResponseNormalizationBackprop_:hDe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const pDe={kernelName:ew,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(e,t,n)=>{const[r,i]=t,{depthRadius:s,bias:o,alpha:a,beta:u}=n;return{x:()=>dDe(r,i,e,s,o,a,u)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rre(e,t,n,r){return t.rank<n.rank&&(t=V(t,Fn(t.shape,r))),e.rank<n.rank&&(e=V(e,Fn(e.shape,r))),{x:()=>j(e,we(Ia(n,t),e.dtype))}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const FV={kernelName:tw,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(e,t,n)=>{const r=n,{reductionIndices:i}=r,s=t[0],o=t[1],a=st(i,s.shape),u=rre(e,o,s,a);return{x:()=>u.x()}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gDe={kernelName:b1,inputsToSave:["a","b"],gradFunc:(e,t)=>{const[n,r]=t;return{a:()=>j(e,we(_h(n,r),"float32")),b:()=>j(e,we(Hx(n,r),"float32"))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mDe(e,t,n,r,i,s,o){const a=O(e,"dy","maxPool3dGrad"),u=O(t,"input","maxPool3dGrad"),l=O(n,"output","maxPool3dGrad");let c=a,f=u,h=l,d=!1;u.rank===4&&(d=!0,c=V(a,[1,a.shape[0],a.shape[1],a.shape[2],a.shape[3]]),f=V(u,[1,u.shape[0],u.shape[1],u.shape[2],u.shape[3]]),h=V(l,[1,l.shape[0],l.shape[1],l.shape[2],l.shape[3]])),N(c.rank===5,()=>`Error in maxPool3dGrad: dy must be rank 5 but got rank ${c.rank}.`),N(f.rank===5,()=>`Error in maxPool3dGrad: input must be rank 5 but got rank ${f.rank}.`),N(h.rank===5,()=>`Error in maxPool3dGrad: output must be rank 5 but got rank ${h.rank}.`),Di("maxPool3dGrad",s,o);const p={dy:c,input:f,output:h},g={filterSize:r,strides:i,pad:s,dimRoundingMode:o},m=z.runKernel(aT,p,g);return d?V(m,[m.shape[1],m.shape[2],m.shape[3],m.shape[4]]):m}const yDe=U({maxPool3dGrad_:mDe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const bDe={kernelName:rw,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(e,t,n)=>{const[r,i]=t,{filterSize:s,strides:o,pad:a,dimRoundingMode:u}=n;return{x:()=>yDe(e,r,i,s,o,a,u)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xDe(e,t,n,r,i,s,o){const a=O(e,"dy","maxPoolGrad"),u=O(t,"input","maxPoolGrad"),l=O(n,"output","maxPoolGrad");N(u.rank===a.rank,()=>`Rank of input (${u.rank}) does not match rank of dy (${a.rank})`),N(a.rank===4,()=>`Error in maxPoolGrad: dy must be rank 4 but got rank ${a.rank}.`),N(u.rank===4,()=>`Error in maxPoolGrad: input must be rank 4 but got rank ${u.rank}.`),Di("maxPoolGrad",s,o);const c={dy:a,input:u,output:l},f={filterSize:r,strides:i,pad:s,dimRoundingMode:o};return z.runKernel(oT,c,f)}const vDe=U({maxPoolGrad_:xDe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wDe={kernelName:nw,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(e,t,n)=>{const[r,i]=t,{filterSize:s,strides:o,pad:a}=n;return{x:()=>vDe(e,r,i,s,o,a)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $De={kernelName:iw,inputsToSave:["x"],gradFunc:(e,t,n)=>{const[r]=t,{axis:i}=n,s=st(i,r.shape),a=pr(r.shape,s)[1],u=te(a);return{x:()=>{const c=r.shape.slice();s.forEach(d=>{c[d]=1});const f=V(e,c);return Re(j(f,Ys(r.shape,"float32")),u)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const CDe={kernelName:sw,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(e,t,n)=>{const r=n,{axis:i}=r,[s,o]=t,a=st(i,s.shape),u=rre(e,o,s,a);return{x:()=>u.x()}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const SDe={kernelName:x1,inputsToSave:["a","b"],gradFunc:(e,t)=>{const[n,r]=t;return{a:()=>j(e,we(sg(n,r),"float32")),b:()=>j(e,we(zs(n,r),"float32"))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const kDe={kernelName:ow,inputsToSave:["x"],gradFunc:(e,t,n)=>{const r=t[0],{paddings:i}=n,s=i.map(o=>o[0]);return{x:()=>wt(e,s,r.shape)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const EDe={kernelName:v1,inputsToSave:["a","b"],gradFunc:(e,t)=>{const[n,r]=t,i=Ze(n.shape,r.shape);return{a:()=>{const a=Un(n.shape,i);return a.length>0?V(Ae(e,a),n.shape):e},b:()=>{const a=j(e,un(Mw(Re(n,r)))),u=Un(r.shape,i);return u.length>0?V(Ae(a,u),r.shape):a}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _De={kernelName:w1,inputsToSave:["a","b"],gradFunc:(e,t)=>{const[n,r]=t,i=Ze(n.shape,r.shape);return{a:()=>{const a=j(e,we(r,"float32")),u=Un(n.shape,i);return u.length>0?V(Ae(a,u),n.shape):a},b:()=>{const a=j(e,we(n,"float32")),u=Un(r.shape,i);return u.length>0?V(Ae(a,u),r.shape):a}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ADe={kernelName:aw,gradFunc:e=>({x:()=>un(e)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const TDe={kernelName:cw,inputsToSave:["indices"],gradFunc:(e,t)=>{const n=t[0];return{indices:()=>Hn(n.shape,"float32")}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const IDe={kernelName:lw,gradFunc:e=>({x:()=>xt(e)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const DDe={kernelName:fw,saveAllInputs:!0,gradFunc:(e,t,n)=>{const{axis:r}=n;return Bf(e,r).map(s=>()=>s)}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const OV={kernelName:hw,inputsToSave:["x"],gradFunc:(e,t,n)=>{const r=t[0],{paddings:i}=n,s=i.map(o=>o[0]);return{x:()=>wt(e,s,r.shape)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const NDe={kernelName:$1,inputsToSave:["a","b"],outputsToSave:[!0],gradFunc:(e,t)=>{const[n,r,i]=t,s=n,o=r,a=Ze(s.shape,o.shape);return{a:()=>{const c=we(o,"float32");let f=j(e,j(c,Pf(s,_e(c,qe(1)))));const h=Un(s.shape,a);return h.length>0&&(f=Ae(f,h)),V(f,s.shape)},b:()=>{const c=zs(s,0),f=Xr(c,ro(s),xt(s));let h=j(e,j(i,f));const d=Un(o.shape,a);return d.length>0&&(h=Ae(h,d)),V(h,o.shape)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const FDe={kernelName:dw,inputsToSave:["x","alpha"],gradFunc:(e,t)=>{const[n,r]=t,i=zs(n,0);return{x:()=>Xr(i,e,j(e,r)),alpha:()=>{let s=Xr(i,xt(e),j(e,n));const o=Un(r.shape,e.shape);return o.length>0&&(s=Ae(s,o)),V(s,r.shape)}}}};/**
 * @license
 * Copyright 2022 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ODe(e,t,n){const r=e.shape.slice();r[n]=1;const i=V(t,r),s=Bk(e,n,!0,!1),o=Bk(e,n,!0,!0),a=j(s,o);return j(i,a)}function RDe(e,t,n){const r=e.shape.length,i=r-n.length,s=Cn(n,r);let o=e;s!=null&&(o=mt(e,s));const a=o.shape.slice(),l=a.splice(r-n.length,n.length).reduce((h,d)=>h*d,1);a.push(l);const c=o.reshape(a);let f=ODe(c,t,i);if(f=f.reshape(o.shape),s!=null){const h=Eh(s);f=mt(f,h)}return f}const MDe={kernelName:pw,inputsToSave:["x"],gradFunc:(e,t,n)=>{const[r]=t,{axis:i}=n;let s=[];return i==null?s=r.shape.map((o,a)=>a):typeof i=="number"?s=[i]:s=i,{x:()=>RDe(r,e,s)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const LDe={kernelName:i1,inputsToSave:["a","b"],gradFunc:(e,t)=>{const[n,r]=t,i=Ze(n.shape,r.shape);return{a:()=>{const a=Re(e,we(r,"float32")),u=Un(n.shape,i);return u.length>0?V(Ae(a,u),n.shape):a},b:()=>{let a=j(e,we(n,"float32"));const u=Un(r.shape,i);u.length>0&&(a=V(Ae(a,u),r.shape));const l=Xt(r);return un(Re(a,we(l,"float32")))}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const PDe={kernelName:C1,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>Re(e,un(Xt(n)))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const BDe={kernelName:k1,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t,r=j(sg(n,6),W1(n));return{x:()=>j(e,we(r,"float32"))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const zDe={kernelName:S1,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>j(e,we(W1(n),"float32"))}}};/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const UDe={kernelName:gw,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>V(e,n.shape)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const jDe={kernelName:yw,inputsToSave:["images"],gradFunc:(e,t,n)=>{const[r]=t,i={dy:e,images:r};return{images:()=>z.runKernel(xT,i,n)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const WDe={kernelName:mw,inputsToSave:["images"],gradFunc:(e,t,n)=>{const[r]=t,i={dy:e,images:r};return{images:()=>z.runKernel(bT,i,n)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const VDe={kernelName:bw,gradFunc:(e,t,n)=>{const{dims:r}=n,i=st(r,e.shape);return{x:()=>Lo(e,i)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const GDe={kernelName:E1,gradFunc:e=>({x:()=>xt(e)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const HDe={kernelName:_1,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>un(Re(e,j(Pf(n,1.5),2)))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qDe={kernelName:xw,inputsToSave:["condition"],gradFunc:(e,t)=>{const[n]=t;return{condition:()=>we(xt(n),"float32"),t:()=>j(e,we(n,e.dtype)),e:()=>j(e,we(HT(n),e.dtype))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const XDe={kernelName:A1,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>{const r=zs(n,qe(0)),i=qe(mI),s=qe(yI),o=j(e,s),a=j(j(e,i),no(we(n,"float32")));return Xr(r,o,a)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const YDe={kernelName:N1,outputsToSave:[!0],gradFunc:(e,t)=>{const[n]=t;return{x:()=>j(e,j(n,_e(qe(1),n)))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const KDe={kernelName:D1,gradFunc:e=>({x:()=>xt(e)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ZDe={kernelName:T1,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>j(UT(we(n,"float32")),e)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const JDe={kernelName:I1,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>j(yB(we(n,"float32")),e)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const QDe={kernelName:vw,inputsToSave:["x"],gradFunc:(e,t,n)=>{const[r]=t,{begin:i,size:s}=n,o=r.shape,[a,u]=pI(r,i,s),l=[];for(let c=0;c<e.rank;c++)l.push([a[c],o[c]-a[c]-u[c]]);return{x:()=>Ah(e,l)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const eNe={kernelName:Sw,outputsToSave:[!0],gradFunc:(e,t,n)=>{const[r]=t,{dim:i}=n,s=!0,o=j(e,r);return{logits:()=>_e(o,j(Ae(o,[i],s),r))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const tNe={kernelName:F1,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>j(e,$u(n))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const RV={kernelName:$w,gradFunc:(e,t,n)=>{const{blockShape:r,paddings:i}=n;return{x:()=>zT(e,r,i)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const MV={kernelName:Cw,gradFunc:(e,t,n)=>{const{axis:r}=n;return{x:()=>lr(e,r)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nNe={kernelName:O1,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>Re(e,j(Kr(we(n,"float32")),2))}}};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const rNe={kernelName:AT,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>j(e,j(we(n,"float32"),2))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const iNe={kernelName:R1,inputsToSave:["a","b"],gradFunc:(e,t)=>{const[n,r]=t,i=qe(2);return{a:()=>j(e,j(i,_e(n,r))),b:()=>j(e,j(i,_e(r,n)))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sNe={kernelName:z1,gradFunc:e=>({x:()=>xt(e)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const oNe={kernelName:M1,inputsToSave:["a","b"],gradFunc:(e,t)=>{const[n,r]=t,i=Ze(n.shape,r.shape);return{a:()=>{let a=e;const u=Un(n.shape,i);return u.length>0&&(a=Ae(a,u)),V(a,n.shape)},b:()=>{let a=e;const u=Un(r.shape,i);return u.length>0&&(a=Ae(a,u)),V(un(a),r.shape)}}}};/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const aNe={kernelName:ww,inputsToSave:["x"],gradFunc:(e,t,n)=>{const[r]=t,i=r.shape.slice(),{axis:s}=n;st(s,r.shape).forEach(l=>{i[l]=1});const a=V(e,i),u=j(a,Ys(r.shape,"float32"));return{x:()=>u}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const uNe={kernelName:L1,inputsToSave:["x"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>Re(e,Xt(UT(n)))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lNe={kernelName:P1,outputsToSave:[!0],gradFunc:(e,t)=>{const[n]=t;return{x:()=>j(_e(qe(1),Xt(n)),e)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const cNe={kernelName:B1,inputsToSave:["x"],gradFunc:(e,t,n)=>{const[r]=t,{reps:i}=n;return{x:()=>{let o=xt(r);if(r.rank===1)for(let a=0;a<i[0];++a)o=ce(o,wt(e,[a*r.shape[0]],[r.shape[0]]));else if(r.rank===2)for(let a=0;a<i[0];++a)for(let u=0;u<i[1];++u)o=ce(o,wt(e,[a*r.shape[0],u*r.shape[1]],[r.shape[0],r.shape[1]]));else if(r.rank===3)for(let a=0;a<i[0];++a)for(let u=0;u<i[1];++u)for(let l=0;l<i[2];++l)o=ce(o,wt(e,[a*r.shape[0],u*r.shape[1],l*r.shape[2]],[r.shape[0],r.shape[1],r.shape[2]]));else if(r.rank===4)for(let a=0;a<i[0];++a)for(let u=0;u<i[1];++u)for(let l=0;l<i[2];++l)for(let c=0;c<i[3];++c)o=ce(o,wt(e,[a*r.shape[0],u*r.shape[1],l*r.shape[2],c*r.shape[3]],[r.shape[0],r.shape[1],r.shape[2],r.shape[3]]));else throw new Error(`Gradient for tile operation is not implemented for rank-${r.rank} tensors yet.`);return o}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const fNe={kernelName:Kd,gradFunc:(e,t,n)=>{const r=n,{perm:i}=r,s=Eh(i);return{x:()=>mt(e,s)}}};/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const hNe={kernelName:Ew,gradFunc:(e,t,n)=>{const r=n,{axis:i}=r;return{value:()=>ac(e,i)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const dNe={kernelName:_w,inputsToSave:["segmentIds"],gradFunc:(e,t)=>{const[n]=t;return{x:()=>pNe(e,n)}}};function pNe(e,t){const n=$c(t,xt(t)),r=Lw(e,n);let i=_h(t,qe(0,"int32"));const s=r.rank-i.rank;for(let a=0;a<s;++a)i=hi(i,a+1);i=Lu(i,Ys(r.shape,"bool"));const o=xt(r);return Xr(i,r,o)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gNe={kernelName:Aw,gradFunc:e=>({x:()=>xt(e)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const mNe=[nre,dIe,pIe,gIe,mIe,yIe,bIe,xIe,vIe,wIe,$Ie,CIe,EIe,TIe,IIe,DIe,NIe,FIe,OIe,RIe,MIe,LIe,BIe,PIe,jIe,WIe,VIe,GIe,HIe,qIe,LDe,XIe,YIe,KIe,ZIe,JIe,eDe,QIe,tDe,nDe,rDe,iDe,sDe,oDe,aDe,uDe,lDe,cDe,fDe,pDe,FV,FV,gDe,bDe,wDe,$De,CDe,SDe,kDe,EDe,_De,ADe,TDe,IDe,DDe,OV,OV,NDe,FDe,MDe,PDe,BDe,zDe,UDe,jDe,WDe,VDe,GDe,HDe,qDe,XDe,YDe,KDe,ZDe,JDe,QDe,eNe,tNe,RV,RV,MV,MV,nNe,iNe,rNe,sNe,oNe,aNe,uNe,lNe,cNe,fNe,hNe,dNe,gNe];for(const e of mNe)See(e);/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ne().prototype.abs=function(){return this.throwIfDisposed(),Gn(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ne().prototype.acos=function(){return this.throwIfDisposed(),ite(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ne().prototype.acosh=function(){return this.throwIfDisposed(),ste(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ne().prototype.add=function(e){return this.throwIfDisposed(),ce(this,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ne().prototype.all=function(e,t){return this.throwIfDisposed(),hB(this,e,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ne().prototype.any=function(e,t){return this.throwIfDisposed(),Pk(this,e,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ne().prototype.argMax=function(e){return this.throwIfDisposed(),Hm(this,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ne().prototype.argMin=function(e){return this.throwIfDisposed(),ote(this,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ne().prototype.asScalar=function(){return this.throwIfDisposed(),N(this.size===1,()=>"The array must have only 1 element."),V(this,[])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ne().prototype.asType=function(e){return this.throwIfDisposed(),we(this,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ne().prototype.as1D=function(){return this.throwIfDisposed(),V(this,[this.size])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ne().prototype.as2D=function(e,t){return this.throwIfDisposed(),V(this,[e,t])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ne().prototype.as3D=function(e,t,n){return this.throwIfDisposed(),V(this,[e,t,n])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ne().prototype.as4D=function(e,t,n,r){return this.throwIfDisposed(),V(this,[e,t,n,r])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ne().prototype.as5D=function(e,t,n,r,i){return this.throwIfDisposed(),V(this,[e,t,n,r,i])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ne().prototype.asin=function(){return this.throwIfDisposed(),ate(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ne().prototype.asinh=function(){return this.throwIfDisposed(),ute(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ne().prototype.atan=function(){return this.throwIfDisposed(),lte(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ne().prototype.atan2=function(e){return this.throwIfDisposed(),cte(this,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ne().prototype.atanh=function(){return this.throwIfDisposed(),fte(this)};ne().prototype.avgPool=function(e,t,n,r){return this.throwIfDisposed(),BT(this,e,t,n,r)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ne().prototype.batchToSpaceND=function(e,t){return this.throwIfDisposed(),zT(this,e,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ne().prototype.batchNorm=function(e,t,n,r,i){return this.throwIfDisposed(),Nw(this,e,t,n,r,i)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ne().prototype.broadcastTo=function(e){return this.throwIfDisposed(),_m(this,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ne().prototype.cast=function(e){return this.throwIfDisposed(),we(this,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ne().prototype.ceil=function(){return this.throwIfDisposed(),yte(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ne().prototype.clipByValue=function(e,t){return this.throwIfDisposed(),_s(this,e,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ne().prototype.concat=function(e,t){return this.throwIfDisposed(),e instanceof Pt&&(e=[e]),lr([this,...e],t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ne().prototype.conv1d=function(e,t,n,r,i,s){return this.throwIfDisposed(),pB(this,e,t,n,r,i,s)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ne().prototype.conv2dTranspose=function(e,t,n,r,i){return this.throwIfDisposed(),mB(this,e,t,n,r,i)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ne().prototype.conv2d=function(e,t,n,r,i,s){return this.throwIfDisposed(),Lf(this,e,t,n,r,i,s)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ne().prototype.cos=function(){return this.throwIfDisposed(),UT(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ne().prototype.cosh=function(){return this.throwIfDisposed(),yB(this)};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ne().prototype.cumprod=function(e,t,n){return this.throwIfDisposed(),Bk(this,e,t,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ne().prototype.cumsum=function(e,t,n){return this.throwIfDisposed(),bB(this,e,t,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ne().prototype.depthToSpace=function(e,t){return this.throwIfDisposed(),kte(this,e,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ne().prototype.depthwiseConv2d=function(e,t,n,r,i,s){return this.throwIfDisposed(),Fw(this,e,t,n,r,i,s)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ne().prototype.dilation2d=function(e,t,n,r,i){return this.throwIfDisposed(),Ete(this,e,t,n,r,i)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ne().prototype.divNoNan=function(e){return this.throwIfDisposed(),_te(this,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ne().prototype.div=function(e){return this.throwIfDisposed(),Re(this,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ne().prototype.dot=function(e){return this.throwIfDisposed(),Ate(this,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ne().prototype.elu=function(){return this.throwIfDisposed(),Ow(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ne().prototype.equal=function(e){return this.throwIfDisposed(),Ia(this,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ne().prototype.erf=function(){return this.throwIfDisposed(),Tte(this)};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ne().prototype.euclideanNorm=function(e,t){return this.throwIfDisposed(),Nte(this,e,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ne().prototype.exp=function(){return this.throwIfDisposed(),no(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ne().prototype.expandDims=function(e){return this.throwIfDisposed(),hi(this,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ne().prototype.expm1=function(){return this.throwIfDisposed(),Fte(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ne().prototype.fft=function(){return this.throwIfDisposed(),tI(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ne().prototype.flatten=function(){return this.throwIfDisposed(),V(this,[this.size])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ne().prototype.floor=function(){return this.throwIfDisposed(),Mw(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ne().prototype.floorDiv=function(e){return this.throwIfDisposed(),fB(this,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ne().prototype.gather=function(e,t,n){return this.throwIfDisposed(),Lw(this,e,t,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ne().prototype.greaterEqual=function(e){return this.throwIfDisposed(),_h(this,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ne().prototype.greater=function(e){return this.throwIfDisposed(),zs(this,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ne().prototype.ifft=function(){return this.throwIfDisposed(),Kx(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ne().prototype.irfft=function(){return this.throwIfDisposed(),WB(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ne().prototype.isFinite=function(){return this.throwIfDisposed(),Ote(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ne().prototype.isInf=function(){return this.throwIfDisposed(),Rte(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ne().prototype.isNaN=function(){return this.throwIfDisposed(),Mte(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ne().prototype.leakyRelu=function(e){return this.throwIfDisposed(),WT(this,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ne().prototype.lessEqual=function(e){return this.throwIfDisposed(),sg(this,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ne().prototype.less=function(e){return this.throwIfDisposed(),Hx(this,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ne().prototype.localResponseNormalization=function(e,t,n,r){return this.throwIfDisposed(),Lte(this,e,t,n,r)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ne().prototype.logSigmoid=function(){return this.throwIfDisposed(),Bte(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ne().prototype.logSoftmax=function(e){return this.throwIfDisposed(),wB(this,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ne().prototype.logSumExp=function(e,t){return this.throwIfDisposed(),$B(this,e,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ne().prototype.log=function(){return this.throwIfDisposed(),ro(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ne().prototype.log1p=function(){return this.throwIfDisposed(),VT(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ne().prototype.logicalAnd=function(e){return this.throwIfDisposed(),Lu(this,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ne().prototype.logicalNot=function(){return this.throwIfDisposed(),HT(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ne().prototype.logicalOr=function(e){return this.throwIfDisposed(),CB(this,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ne().prototype.logicalXor=function(e){return this.throwIfDisposed(),zte(this,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ne().prototype.matMul=function(e,t,n){return this.throwIfDisposed(),ot(this,e,t,n)};ne().prototype.maxPool=function(e,t,n,r){return this.throwIfDisposed(),qT(this,e,t,n,r)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ne().prototype.max=function(e,t){return this.throwIfDisposed(),Oo(this,e,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ne().prototype.maximum=function(e){return this.throwIfDisposed(),$c(this,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ne().prototype.mean=function(e,t){return this.throwIfDisposed(),kn(this,e,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ne().prototype.min=function(e,t){return this.throwIfDisposed(),Gx(this,e,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ne().prototype.minimum=function(e){return this.throwIfDisposed(),bp(this,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ne().prototype.mirrorPad=function(e,t){return this.throwIfDisposed(),jte(this,e,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ne().prototype.mod=function(e){return this.throwIfDisposed(),Wte(this,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ne().prototype.mul=function(e){return this.throwIfDisposed(),j(this,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ne().prototype.neg=function(){return this.throwIfDisposed(),un(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ne().prototype.norm=function(e,t,n){return this.throwIfDisposed(),Rw(this,e,t,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ne().prototype.notEqual=function(e){return this.throwIfDisposed(),Xm(this,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ne().prototype.oneHot=function(e,t=1,n=0){return this.throwIfDisposed(),qx(this,e,t,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ne().prototype.onesLike=function(){return this.throwIfDisposed(),io(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ne().prototype.pad=function(e,t){return this.throwIfDisposed(),Ah(this,e,t)};ne().prototype.pool=function(e,t,n,r,i,s){return this.throwIfDisposed(),Vte(this,e,t,n,r,i,s)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ne().prototype.pow=function(e){return this.throwIfDisposed(),Pf(this,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ne().prototype.prelu=function(e){return this.throwIfDisposed(),KT(this,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ne().prototype.prod=function(e,t){return this.throwIfDisposed(),Gte(this,e,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ne().prototype.reciprocal=function(){return this.throwIfDisposed(),Yte(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ne().prototype.relu=function(){return this.throwIfDisposed(),Zu(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ne().prototype.relu6=function(){return this.throwIfDisposed(),RB(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ne().prototype.reshapeAs=function(e){return this.throwIfDisposed(),V(this,e.shape)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ne().prototype.reshape=function(e){return this.throwIfDisposed(),V(this,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ne().prototype.resizeBilinear=function(e,t,n){return this.throwIfDisposed(),fne(this,e,t,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ne().prototype.resizeNearestNeighbor=function(e,t,n){return this.throwIfDisposed(),hne(this,e,t,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ne().prototype.reverse=function(e){return this.throwIfDisposed(),Lo(this,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ne().prototype.rfft=function(){return this.throwIfDisposed(),nI(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ne().prototype.round=function(){return this.throwIfDisposed(),MB(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ne().prototype.rsqrt=function(){return this.throwIfDisposed(),LB(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ne().prototype.selu=function(){return this.throwIfDisposed(),PB(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ne().prototype.separableConv2d=function(e,t,n,r,i,s){return this.throwIfDisposed(),BB(this,e,t,n,r,i,s)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ne().prototype.sigmoid=function(){return this.throwIfDisposed(),$u(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ne().prototype.sign=function(){return this.throwIfDisposed(),Kte(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ne().prototype.sin=function(){return this.throwIfDisposed(),zB(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ne().prototype.sinh=function(){return this.throwIfDisposed(),UB(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ne().prototype.slice=function(e,t){return this.throwIfDisposed(),wt(this,e,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ne().prototype.softmax=function(e){return this.throwIfDisposed(),eI(this,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ne().prototype.softplus=function(){return this.throwIfDisposed(),j1(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ne().prototype.spaceToBatchND=function(e,t){return this.throwIfDisposed(),YT(this,e,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ne().prototype.split=function(e,t){return this.throwIfDisposed(),ks(this,e,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ne().prototype.sqrt=function(){return this.throwIfDisposed(),Kr(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ne().prototype.square=function(){return this.throwIfDisposed(),Xt(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ne().prototype.squaredDifference=function(e){return this.throwIfDisposed(),VB(this,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ne().prototype.squeeze=function(e){return this.throwIfDisposed(),ug(this,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ne().prototype.stack=function(e,t){this.throwIfDisposed();const n=e instanceof Pt?[this,e]:[this,...e];return ac(n,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ne().prototype.step=function(e){return this.throwIfDisposed(),W1(this,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ne().prototype.stridedSlice=function(e,t,n,r,i,s,o,a){return this.throwIfDisposed(),Zte(this,e,t,n,r,i,s,o,a)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ne().prototype.sub=function(e){return this.throwIfDisposed(),_e(this,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ne().prototype.sum=function(e,t){return this.throwIfDisposed(),Ae(this,e,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ne().prototype.tan=function(){return this.throwIfDisposed(),Jte(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ne().prototype.tanh=function(){return this.throwIfDisposed(),qm(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ne().prototype.tile=function(e){return this.throwIfDisposed(),So(this,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ne().prototype.toBool=function(){return this.throwIfDisposed(),we(this,"bool")};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ne().prototype.toFloat=function(){return this.throwIfDisposed(),we(this,"float32")};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ne().prototype.toInt=function(){return this.throwIfDisposed(),we(this,"int32")};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ne().prototype.topk=function(e,t){return this.throwIfDisposed(),ene(this,e,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ne().prototype.transpose=function(e){return this.throwIfDisposed(),mt(this,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ne().prototype.unique=function(e){return this.throwIfDisposed(),tne(this,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ne().prototype.unsortedSegmentSum=function(e,t){return this.throwIfDisposed(),qB(this,e,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ne().prototype.unstack=function(e){return this.throwIfDisposed(),Bf(this,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ne().prototype.where=function(e,t){return this.throwIfDisposed(),Xr(e,this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */ne().prototype.zerosLike=function(){return this.throwIfDisposed(),xt(this)};/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class ou extends Error{constructor(t){super(t),Object.setPrototypeOf(this,ou.prototype)}}class ko extends Error{constructor(t){super(t),Object.setPrototypeOf(this,ko.prototype)}}class W extends Error{constructor(t){super(t),Object.setPrototypeOf(this,W.prototype)}}class tt extends Error{constructor(t){super(t),Object.setPrototypeOf(this,tt.prototype)}}class I5 extends Error{constructor(t){super(t),Object.setPrototypeOf(this,I5.prototype)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class ire{constructor(t){this.maxEntries=t||100,this.cache=new Map}get(t){let n;return this.cache.has(t)&&(n=this.cache.get(t),this.cache.delete(t),this.cache.set(t,n)),n}put(t,n){if(this.cache.has(t))this.cache.delete(t);else if(this.cache.size>=this.maxEntries){const r=this.cache.keys().next().value;this.cache.delete(r)}this.cache.set(t,n)}getMaxEntries(){return this.maxEntries}setMaxEntries(t){if(t<0)throw new Error(`The maxEntries of LRU caches must be at least 0, but got ${t}.`);if(this.maxEntries>t)for(let n=0;n<this.maxEntries-t;n++){const r=this.cache.keys().next().value;this.cache.delete(r)}this.maxEntries=t}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function vp(e,t){if(Array.isArray(e)){let n=[];for(let r=0;r<t;r++)n=n.concat(e);return n}else{const n=new Array(t);return n.fill(e),n}}function au(e,t){if(!e)throw new I5(t)}function LV(e,t){let n=0;for(const r of e)r===t&&n++;return n}function Pi(e){return e.length===1?e[0]:e}function sn(e){return Array.isArray(e)?e:[e]}function Al(e){const n=e.replace(/(.)([A-Z][a-z0-9]+)/g,"$1_$2").replace(/([a-z])([A-Z])/g,"$1_$2").toLowerCase();return n[0]!=="_"?n:"private"+n}function Cd(e){return e.length<=1||e.indexOf("_")===-1?e:e.replace(/[_]+(\w|$)/g,(t,n)=>n.toUpperCase())}let go={};function D5(e){if(e==null)return null;const t={};return t.className=e.getClassName(),t.config=e.getConfig(),t}function iM(e){if(!(e==null||typeof e!="object"))if(Array.isArray(e))e.forEach(t=>iM(t));else{const t=Object.keys(e);for(const n of t){const r=e[n];r!=null&&typeof r=="object"&&(!Array.isArray(r)&&r.type==="ndarray"&&typeof r.value=="number"?e[n]=r.value:iM(r))}}}function Uw(e,t={},n={},r="object",i=!1){if(typeof e=="string"){const s=e;let o;if(s in n)o=n[s];else if(s in go)o=go[s];else if(o=t[s],o==null)throw new W(`Unknown ${r}: ${e}. This may be due to one of the following reasons:
1. The ${r} is defined in Python, in which case it needs to be ported to TensorFlow.js or your JavaScript code.
2. The custom ${r} is defined in JavaScript, but is not registered properly with tf.serialization.registerClass().`);return o}else{const s=e;if(s.className==null||s.config==null)throw new W(`${r}: Improper config format: ${JSON.stringify(s)}.
'className' and 'config' must set.`);const o=s.className;let a,u;if(o in n?[a,u]=n[o]:o in go?[a,u]=go.className:o in t&&([a,u]=t[o]),a==null)throw new W(`Unknown ${r}: ${o}. This may be due to one of the following reasons:
1. The ${r} is defined in Python, in which case it needs to be ported to TensorFlow.js or your JavaScript code.
2. The custom ${r} is defined in JavaScript, but is not registered properly with tf.serialization.registerClass().`);if(u!=null){const l={};for(const d of Object.keys(go))l[d]=go[d];for(const d of Object.keys(n))l[d]=n[d];const c=s.config;c.customObjects=l;const f=Object.assign({},go);for(const d of Object.keys(n))go[d]=n[d];iM(s.config);const h=u(a,s.config,n,i);return go=Object.assign({},f),h}else{const l=Object.assign({},go);for(const f of Object.keys(n))go[f]=n[f];const c=new a(s.config);return go=Object.assign({},l),c}}}function yNe(e,t){return e<t?-1:e>t?1:0}function EC(e,t){return-1*yNe(e,t)}function Cf(e){if(e==null)return e;const t=[];for(const n of e)t.indexOf(n)===-1&&t.push(n);return t}function bNe(e){if(e==null)throw new W(`Invalid value in obj: ${JSON.stringify(e)}`);for(const t in e)if(e.hasOwnProperty(t))return!1;return!0}function cg(e,t,n){if(n!=null&&e.indexOf(n)<0)throw new W(`${n} is not a valid ${t}.  Valid values are ${e} or null/undefined.`)}function N5(e,t,n=0,r=1/0){return au(n>=0),au(r>=n),Array.isArray(e)&&e.length>=n&&e.length<=r&&e.every(i=>typeof i===t)}function or(e,t){Array.isArray(e)?(N(e.length>0,()=>`${t} is unexpectedly an empty array.`),e.forEach((n,r)=>or(n,`element ${r+1} of ${t}`))):N(Number.isInteger(e)&&e>0,()=>`Expected ${t} to be a positive integer, but got ${sre(e)}.`)}function sre(e){return e===null?"null":Array.isArray(e)?"["+e.map(t=>sre(t)).join(",")+"]":typeof e=="string"?`"${e}"`:`${e}`}function xNe(e,t,n){let r=n!=null?n():ui(),i;return(...o)=>{const a=n!=null?n():ui();return a-r<t||(r=a,i=e(...o)),i}}function ore(e){return e==="relu"?"relu":e==="linear"?"linear":e==="elu"?"elu":null}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */let vNe=0;function are(){return vNe++}const _C={};function bI(e=""){return e in _C||(_C[e]=0),_C[e]+=1,e+_C[e].toString()}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const wNe=["channelsFirst","channelsLast"],$Ne=["nearest","bilinear"],CNe=["valid","same","causal"],SNe=["max","avg"],kNe=["sum","mul","concat","ave"];/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const Yg=new Map;function Rn(e){cg(wNe,"DataFormat",e)}function ENe(e){cg($Ne,"InterpolationFormat",e)}function co(e){cg(CNe,"PaddingMode",e)}function ure(e){cg(SNe,"PoolMode",e)}const ox=[],PV="/";function Jd(e,t){ox.push(e);try{const n=t();return ox.pop(),n}catch(n){throw ox.pop(),n}}function _Ne(){return ox.length===0?"":ox.join(PV)+PV}function lre(e){if(!fre(e))throw new Error("Not a valid tensor name: '"+e+"'");return _Ne()+e}function cre(e){if(!fre(e))throw new Error("Not a valid tensor name: '"+e+"'");Yg.has(e)||Yg.set(e,0);const t=Yg.get(e);if(Yg.set(e,Yg.get(e)+1),t>0){const n=`${e}_${t}`;return Yg.set(n,1),n}else return e}const ANe=new RegExp(/^[A-Za-z0-9][-A-Za-z0-9\._\/]*$/);function fre(e){return!!e.match(ANe)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function TNe(e){return e===parseInt(e.toString(),10)}function Sf(e,t,n){t==null&&(t=0),n==null&&(n=e.length);let r=1;for(let i=t;i<n;++i)r*=e[i];return r}function Km(e){if(e.length===0)return Number.NaN;let t=Number.POSITIVE_INFINITY;for(let n=0;n<e.length;n++){const r=e[n];r<t&&(t=r)}return t}function zf(e){if(e.length===0)return Number.NaN;let t=Number.NEGATIVE_INFINITY;for(let n=0;n<e.length;n++){const r=e[n];r>t&&(t=r)}return t}function Da(e,t){if(t<e)throw new W(`end (${t}) < begin (${e}) is forbidden.`);const n=[];for(let r=e;r<t;++r)n.push(r);return n}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */let i3;function qn(){return i3==null&&(i3=rte().epsilon()),i3}function Na(){return"channelsLast"}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Su(e,t){return we(e,t)}function jw(e,t=-1){const n=e.shape.slice();return t<0&&(t=n.length+t+1),n.splice(t,0,1),V(e,n)}function INe(e,t){return Z(()=>{if(e.shape.length!==2)throw new W(`repeat() expects a rank-2 tensor, but received a rank-${e.shape.length} tensor.`);const n=jw(e,1);return sM(n,[1,t,1])})}function DNe(e){const t=[Sf(e.shape)];return V(e,t)}function NNe(e){if(e.rank<=1)throw new W(`batchFlatten requires a minimum rank of 2. Got rank: ${e.rank}.`);const t=[e.shape[0],Sf(e.shape,1)];return V(e,t)}function Qd(e,t,n){return Z(()=>{switch(e.rank){case 1:return JT(e,t,n);case 2:return jB(e,[t,0],[n,e.shape[1]]);case 3:return QT(e,[t,0,0],[n,e.shape[1],e.shape[2]]);case 4:return Yx(e,[t,0,0,0],[n,e.shape[1],e.shape[2],e.shape[3]]);case 5:return wt(e,[t,0,0,0,0],[n,e.shape[1],e.shape[2],e.shape[3],e.shape[4]]);case 6:return wt(e,[t,0,0,0,0,0],[n,e.shape[1],e.shape[2],e.shape[3],e.shape[4],e.shape[5]]);default:throw new W(`sliceAlongFirstAxis() received an unsupported tensor rank: ${e.rank}`)}})}function s3(e,t,n){return Z(()=>{switch(e.rank){case 1:return JT(e,t,n);case 2:return jB(e,[0,t],[e.shape[0],n]);case 3:return QT(e,[0,0,t],[e.shape[0],e.shape[1],n]);case 4:return Yx(e,[0,0,0,t],[e.shape[0],e.shape[1],e.shape[2],n]);default:throw new W(`sliceAlongLastAxis() received an unsupported tensor rank: ${e.rank}`)}})}function AC(e,t,n,r){return Z(()=>{switch(e.rank){case 1:return JT(e,t,n);case 2:switch(r){case 1:return Qd(e,t,n);case 2:return s3(e,t,n);default:throw new W(`The axis is not within the rank of the tensor ${r}`)}case 3:switch(r){case 1:return Qd(e,t,n);case 2:return QT(e,[0,t,0],[e.shape[0],n,e.shape[2]]);case 3:return s3(e,t,n);default:throw new W(`The axis is not within the rank of the tensor ${r}`)}case 4:switch(r){case 1:return Qd(e,t,n);case 2:return Yx(e,[0,t,0,0],[e.shape[0],n,e.shape[2],e.shape[3]]);case 3:return Yx(e,[0,0,t,0],[e.shape[0],e.shape[1],n,e.shape[3]]);case 4:return s3(e,t,n);default:throw new W(`The axis is not within the rank of the tensor ${r}`)}default:throw new W(`sliceAlongLastAxis() received an unsupported tensor rank: ${e.rank}`)}})}function F5(e,t=-1){let n;return t<0&&(n=e[0].rank,n!==0?t=n:t=0),t===e[0].rank&&(t=-1),lr(e,t)}function BV(e,t){switch(e.rank){case 1:return bte([e,t]);case 2:return xte([e,t],0);case 3:return vte([e,t],0);case 4:return wte([e,t],0);default:throw new W(`concatAlongFirstAxis() received an unsupported tensor rank: ${e.rank}`)}}function sM(e,t){if(Array.isArray(t)||(t=[t]),e.rank!==t.length)throw new W(`The length of input n (${t.length}) does not match the number of dimensions in input x (${e.rank})`);return So(e,t)}function xI(e,t=0,n=1,r,i){return OB(e,t,n,r,i)}function ku(e,t,n,r){if(e.rank<2||t.rank<2)throw new tt(`dot requires both inputs to be rank >= 2 but got x shape = ${e.shape} and y shape = ${t.shape}`);if(t.rank>=3){const i=e.shape.slice(-1)[0],s=t.shape.slice(-2)[0];if(i!==s)throw new tt(`If rank y >= 3, then the second last dim of y must equal the last dim of x but got x shape = ${e.shape} and  y shape = ${t.shape}`)}if(e.rank===2&&t.rank===2)return QR({a:e,b:t,transposeA:!1,transposeB:!1,bias:r?oM(e.rank,r,Na()):null,activation:n});{const i=e.shape.slice(),s=i.pop();e=V(e,[-1,s]);const o=t.shape.slice(),a=o.pop(),u=o.pop(),l=[...o,a],c=Array.from({length:t.rank},(p,g)=>g===0?t.rank-2:g<=t.rank-2?g-1:g);t=V(mt(t,c),[u,-1]);const f=[...i,...l];return V(QR({a:e,b:t,transposeA:!1,transposeB:!1,bias:r?oM(e.rank,r,Na()):null,activation:n}),f)}}function hre(e,t,n){return Z(()=>(Array.isArray(t)?t=mi(t,"int32"):t=we(t,"int32"),Lw(e,t,n)))}function Ww(e){return j(e,e)}function oM(e,t,n){const r=t.shape;if(t.rank!==1&&t.rank!==e)throw new W(`Unexpected bias dimensions: ${t.rank}; expected it to be 1 or ${e}`);if(e===5){if(n==="channelsFirst")return r.length===1?V(t,[1,r[0],1,1,1]):V(t,[1,r[3],r[0],r[1],r[2]]);if(n==="channelsLast")return r.length===1?V(t,[1,1,1,1,r[0]]):V(t,[1].concat(r))}else if(e===4){if(n==="channelsFirst")return r.length===1?V(t,[1,r[0],1,1]):V(t,[1,r[2],r[0],r[1]]);if(n==="channelsLast")return r.length===1?V(t,[1,1,1,r[0]]):V(t,[1].concat(r))}else if(e===3){if(n==="channelsFirst")return r.length===1?V(t,[1,r[0],1]):V(t,[1,r[1],r[0]]);if(n==="channelsLast")return r.length===1?V(t,[1,1,r[0]]):V(t,[1].concat(r))}else if(e<3)return t;throw new W(`Unsupported input rank by biasAdd: ${t.rank}`)}function Ba(e,t,n){return Z(()=>(n==null&&(n=Na()),Rn(n),ce(e,oM(e.rank,t,n))))}function FNe(e,t=1){if(t!==1)throw new tt(`Support for alpha values other than 1 (${t}) is not implemented yet.`);return Ow(e)}function ONe(e){return Z(()=>Re(e,ce(Gn(e),1)))}function dre(e,t,n,r){return Z(()=>ine(e,t,n,r))}function RNe(e){return Z(()=>{const t=ce(.5,j(.2,e));return _s(t,0,1)})}function Vw(e,t,n=!1){return n?e():t()}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const MNe=["fanIn","fanOut","fanAvg"],LNe=["normal","uniform","truncatedNormal"];/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function PNe(e){cg(MNe,"FanMode",e)}function BNe(e){cg(LNe,"Distribution",e)}class qo extends lg{fromConfigUsesCustomObjects(){return!1}getConfig(){return{}}}class pre extends qo{apply(t,n){return Hn(t,n)}}pre.className="Zeros";fe(pre);class O5 extends qo{apply(t,n){return Ys(t,n)}}O5.className="Ones";fe(O5);class gre extends qo{constructor(t){if(super(),typeof t!="object")throw new W(`Expected argument of type ConstantConfig but got ${t}`);if(t.value===void 0)throw new W(`config must have value set but got ${t}`);this.value=t.value}apply(t,n){return Z(()=>j(qe(this.value),Ys(t,n)))}getConfig(){return{value:this.value}}}gre.className="Constant";fe(gre);class mre extends qo{constructor(t){super(),this.DEFAULT_MINVAL=-.05,this.DEFAULT_MAXVAL=.05,this.minval=t.minval||this.DEFAULT_MINVAL,this.maxval=t.maxval||this.DEFAULT_MAXVAL,this.seed=t.seed}apply(t,n){return ag(t,this.minval,this.maxval,n,this.seed)}getConfig(){return{minval:this.minval,maxval:this.maxval,seed:this.seed}}}mre.className="RandomUniform";fe(mre);class yre extends qo{constructor(t){super(),this.DEFAULT_MEAN=0,this.DEFAULT_STDDEV=.05,this.mean=t.mean||this.DEFAULT_MEAN,this.stddev=t.stddev||this.DEFAULT_STDDEV,this.seed=t.seed}apply(t,n){if(n=n||"float32",n!=="float32"&&n!=="int32")throw new tt(`randomNormal does not support dType ${n}.`);return xI(t,this.mean,this.stddev,n,this.seed)}getConfig(){return{mean:this.mean,stddev:this.stddev,seed:this.seed}}}yre.className="RandomNormal";fe(yre);class bre extends qo{constructor(t){super(),this.DEFAULT_MEAN=0,this.DEFAULT_STDDEV=.05,this.mean=t.mean||this.DEFAULT_MEAN,this.stddev=t.stddev||this.DEFAULT_STDDEV,this.seed=t.seed}apply(t,n){if(n=n||"float32",n!=="float32"&&n!=="int32")throw new tt(`truncatedNormal does not support dType ${n}.`);return HB(t,this.mean,this.stddev,n,this.seed)}getConfig(){return{mean:this.mean,stddev:this.stddev,seed:this.seed}}}bre.className="TruncatedNormal";fe(bre);let xre=class extends qo{constructor(t){super(),this.gain=t.gain!=null?t.gain:1}apply(t,n){return Z(()=>{if(t.length!==2||t[0]!==t[1])throw new W("Identity matrix initializer can only be used for 2D square matrices.");return j(this.gain,vB(t[0]))})}getConfig(){return{gain:this.gain}}};xre.className="Identity";fe(xre);function zNe(e,t="channelsLast"){let n,r;if(Rn(t),e.length===2)n=e[0],r=e[1];else if([3,4,5].indexOf(e.length)!==-1){if(t==="channelsFirst"){const i=Sf(e,2);n=e[1]*i,r=e[0]*i}else if(t==="channelsLast"){const i=Sf(e,0,e.length-2);n=e[e.length-2]*i,r=e[e.length-1]*i}}else{const i=Sf(e);n=Math.sqrt(i),r=Math.sqrt(i)}return[n,r]}class As extends qo{constructor(t){if(super(),t.scale<0)throw new W(`scale must be a positive float. Got: ${t.scale}`);this.scale=t.scale==null?1:t.scale,this.mode=t.mode==null?"fanIn":t.mode,PNe(this.mode),this.distribution=t.distribution==null?"normal":t.distribution,BNe(this.distribution),this.seed=t.seed}apply(t,n){const r=zNe(t),i=r[0],s=r[1];let o=this.scale;if(this.mode==="fanIn"?o/=Math.max(1,i):this.mode==="fanOut"?o/=Math.max(1,s):o/=Math.max(1,(i+s)/2),this.distribution==="normal"){const a=Math.sqrt(o);if(n=n||"float32",n!=="float32"&&n!=="int32")throw new tt(`${this.getClassName()} does not support dType ${n}.`);return HB(t,0,a,n,this.seed)}else{const a=Math.sqrt(3*o);return ag(t,-a,a,n,this.seed)}}getConfig(){return{scale:this.scale,mode:this.mode,distribution:this.distribution,seed:this.seed}}}As.className="VarianceScaling";fe(As);class R5 extends As{constructor(t){super({scale:1,mode:"fanAvg",distribution:"uniform",seed:t==null?null:t.seed})}getClassName(){return As.className}}R5.className="GlorotUniform";fe(R5);class M5 extends As{constructor(t){super({scale:1,mode:"fanAvg",distribution:"normal",seed:t==null?null:t.seed})}getClassName(){return As.className}}M5.className="GlorotNormal";fe(M5);class L5 extends As{constructor(t){super({scale:2,mode:"fanIn",distribution:"normal",seed:t==null?null:t.seed})}getClassName(){return As.className}}L5.className="HeNormal";fe(L5);class P5 extends As{constructor(t){super({scale:2,mode:"fanIn",distribution:"uniform",seed:t==null?null:t.seed})}getClassName(){return As.className}}P5.className="HeUniform";fe(P5);class B5 extends As{constructor(t){super({scale:1,mode:"fanIn",distribution:"normal",seed:t==null?null:t.seed})}getClassName(){return As.className}}B5.className="LeCunNormal";fe(B5);class z5 extends As{constructor(t){super({scale:1,mode:"fanIn",distribution:"uniform",seed:t==null?null:t.seed})}getClassName(){return As.className}}z5.className="LeCunUniform";fe(z5);class vre extends qo{constructor(t){super(),this.DEFAULT_GAIN=1,this.ELEMENTS_WARN_SLOW=2e3,this.gain=t.gain==null?this.DEFAULT_GAIN:t.gain,this.seed=t.seed}apply(t,n){return Z(()=>{if(t.length<2)throw new tt("Shape must be at least 2D.");if(n!=="int32"&&n!=="float32"&&n!==void 0)throw new TypeError(`Unsupported data type ${n}.`);n=n;const r=te(t.slice(0,-1)),i=t[t.length-1],s=r*i;s>this.ELEMENTS_WARN_SLOW&&console.warn(`Orthogonal initializer is being called on a matrix with more than ${this.ELEMENTS_WARN_SLOW} (${s}) elements: Slowness may result.`);const o=[Math.max(i,r),Math.min(i,r)],a=xI(o,0,1,n,this.seed),u=dne.qr(a,!1);let l=u[0];const f=u[1].flatten().stridedSlice([0],[Math.min(i,r)*Math.min(i,r)],[Math.min(i,r)+1]);return l=j(l,f.sign()),r<i&&(l=l.transpose()),j(qe(this.gain),l.reshape(t))})}getConfig(){return{gain:this.gain,seed:this.seed}}}vre.className="Orthogonal";fe(vre);const zV={constant:"Constant",glorotNormal:"GlorotNormal",glorotUniform:"GlorotUniform",heNormal:"HeNormal",heUniform:"HeUniform",identity:"Identity",leCunNormal:"LeCunNormal",leCunUniform:"LeCunUniform",ones:"Ones",orthogonal:"Orthogonal",randomNormal:"RandomNormal",randomUniform:"RandomUniform",truncatedNormal:"TruncatedNormal",varianceScaling:"VarianceScaling",zeros:"Zeros"};function UV(e,t={}){return Uw(e,qs.getMap().classNameMap,t,"initializer")}function vn(e){return D5(e)}function pn(e){if(typeof e=="string"){const t=e in zV?zV[e]:e;if(t==="GlorotNormal")return new M5;if(t==="GlorotUniform")return new R5;if(t==="HeNormal")return new L5;if(t==="HeUniform")return new P5;if(t==="LeCunNormal")return new B5;if(t==="LeCunUniform")return new z5;{const n={};return n.className=t,n.config={},UV(n)}}else return e instanceof qo?e:UV(e)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function aM(e){return Array.isArray(e)&&Array.isArray(e[0])}function zk(e){return e.length===0?[]:Array.isArray(e[0])?e:[e]}function Ge(e){let t;if(Array.isArray(e)){if(e.length!==1)throw new W(`Expected Tensor length to be 1; got ${e.length}`);t=e[0]}else t=e;return t}function kt(e){if(Array.isArray(e)&&Array.isArray(e[0])){if(e.length===1)return e=e,e[0];throw new W(`Expected exactly 1 Shape; got ${e.length}`)}else return e}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Uk(e){let t=0;for(const n of e)n.shape.length===0?t+=1:t+=n.shape.reduce((r,i)=>r*i);return t}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const jV="Variable";class UNe{constructor(t,n="float32",r=jV,i=!0,s=null){this.dtype=n??"float32",this.shape=t.shape,this.id=are(),r=r??jV,this.originalName=lre(r),this.name=cre(this.originalName),this.trainable_=i,this.constraint=s,this.val=nne(t,this.trainable_,this.name,this.dtype)}read(){return this.assertNotDisposed(),this.val}write(t){return this.assertNotDisposed(),jNe(this.val,t),this.val.id!==t.id&&(this.val.assign(t),this.constraint!=null&&this.val.assign(this.constraint.apply(this.val))),this}dispose(){this.assertNotDisposed(),this.val.dispose()}assertNotDisposed(){if(this.val.isDisposed)throw new Error(`LayersVariable ${this.name} is already disposed.`)}get trainable(){return this.trainable_}set trainable(t){this.trainable_=t,this.val.trainable=t}}function jNe(e,t){if(e.shape.toString()!==t.shape.toString())throw new Error("Shape mismatch: "+JSON.stringify(e.shape)+" vs. "+JSON.stringify(t.shape))}function uM(e){return e.map(t=>t.read())}function U5(e){e.forEach(t=>{t[0].write(t[1])})}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class Xn{constructor(t){this.dtype=t.dtype,this.shape=t.shape,t.shape!=null?this.ndim=t.shape.length:this.ndim=t.ndim,this.maxNDim=t.maxNDim,this.minNDim=t.minNDim,this.axes=t.axes||{}}}class bu{constructor(t,n,r,i,s,o,a){this.dtype=t,this.shape=n,this.sourceLayer=r,this.inputs=i,this.callArgs=s,this.outputTensorIndex=a,this.id=are(),o!=null&&(this.originalName=lre(o),this.name=cre(this.originalName)),this.rank=n.length}}let WNe=0,vI=class{constructor(t,n){this.callArgs=n,this.id=WNe++,this.outboundLayer=t.outboundLayer,this.inboundLayers=t.inboundLayers,this.nodeIndices=t.nodeIndices,this.tensorIndices=t.tensorIndices,this.inputTensors=t.inputTensors,this.outputTensors=t.outputTensors,this.inputMasks=t.inputMasks,this.outputMasks=t.outputMasks,this.inputShapes=t.inputShapes,this.outputShapes=t.outputShapes;for(const r of t.inboundLayers)r!=null&&r.outboundNodes.push(this);t.outboundLayer.inboundNodes.push(this)}getConfig(){const t=[];for(const n of this.inboundLayers)n!=null?t.push(n.name):t.push(null);return{outboundLayer:this.outboundLayer?this.outboundLayer.name:null,inboundLayers:t,nodeIndices:this.nodeIndices,tensorIndices:this.tensorIndices}}},VNe=0;class ut extends lg{constructor(t={}){super(),this._callHook=null,this._addedWeightNames=[],this._stateful=!1,this.id=VNe++,this.activityRegularizer=null,this.inputSpec=null,this.supportsMasking=!1,this._trainableWeights=[],this._nonTrainableWeights=[],this._losses=[],this._updates=[],this._built=!1,this.inboundNodes=[],this.outboundNodes=[];let n=t.name;if(!n){const r=this.getClassName();n=Al(r)+"_"+bI(r)}if(this.name=n,this.trainable_=t.trainable==null?!0:t.trainable,t.inputShape!=null||t.batchInputShape!=null){let r;if(t.batchInputShape!=null)r=t.batchInputShape;else if(t.inputShape!=null){let s=null;t.batchSize!=null&&(s=t.batchSize),r=[s].concat(t.inputShape)}this.batchInputShape=r;let i=t.dtype;i==null&&(i=t.inputDType),i==null&&(i="float32"),this.dtype=i}t.weights!=null?this.initialWeights=t.weights:this.initialWeights=null,this._refCount=null,this.fastWeightInitDuringBuild=!1}static nodeKey(t,n){return t.name+"_ib-"+n.toString()}getNodeAtIndex(t,n){if(this.inboundNodes.length===0)throw new ko(`The layer has never been called and thus has no defined ${n}.`);if(this.inboundNodes.length<=t)throw new W(`Asked to get ${n} at node ${t}, but the layer has only ${this.inboundNodes.length} inbound nodes.`);return this.inboundNodes[t]}getInputAt(t){return Pi(this.getNodeAtIndex(t,"input").inputTensors)}getOutputAt(t){return Pi(this.getNodeAtIndex(t,"output").outputTensors)}get input(){if(this.inboundNodes.length>1)throw new ou(`Layer ${this.name} has multiple inbound nodes, hence the notion of "layer input" is ill-defined. Use \`getInputAt(nodeIndex)\` instead.`);if(this.inboundNodes.length===0)throw new ou(`Layer ${this.name} is not connected, no input to return.`);return Pi(this.getNodeAtIndex(0,"input").inputTensors)}get output(){if(this.inboundNodes.length===0)throw new ou(`Layer ${this.name} has no inbound nodes.`);if(this.inboundNodes.length>1)throw new ou(`Layer ${this.name} has multiple inbound nodes, hence the notion of "layer output" is ill-defined. Use \`getOutputAt(nodeIndex)\` instead.`);return Pi(this.getNodeAtIndex(0,"output").outputTensors)}get losses(){return this._losses}calculateLosses(){return this.losses.map(t=>t())}get updates(){return this._updates}get built(){return this._built}set built(t){this._built=t}get trainable(){return this.trainable_}set trainable(t){this._trainableWeights.forEach(n=>n.trainable=t),this.trainable_=t}get trainableWeights(){return this.trainable_?this._trainableWeights.filter(t=>t.trainable):[]}set trainableWeights(t){this._trainableWeights=t}get nonTrainableWeights(){return this.trainable?this._trainableWeights.filter(t=>!t.trainable).concat(this._nonTrainableWeights):this._trainableWeights.concat(this._nonTrainableWeights)}set nonTrainableWeights(t){this._nonTrainableWeights=t}get weights(){return this.trainableWeights.concat(this.nonTrainableWeights)}get stateful(){return this._stateful}resetStates(){if(!this.stateful)throw new Error("Cannot call the resetStates() method of a non-stateful Layer object.")}assertInputCompatibility(t){if(t=sn(t),this.inputSpec==null||this.inputSpec.length===0)return;const n=sn(this.inputSpec);if(t.length!==n.length)throw new W(`Layer ${this.name} expects ${n.length} inputs, but it received ${t.length} input tensors. Input received: ${t}`);for(let r=0;r<t.length;r++){const i=t[r],s=n[r];if(s==null)continue;const o=i.rank;if(s.ndim!=null&&o!==s.ndim)throw new W(`Input ${r} is incompatible with layer ${this.name}: expected ndim=${s.ndim}, found ndim=${o}`);if(s.maxNDim!=null&&o>s.maxNDim)throw new W(`Input ${r} is incompatible with layer ${this.name}: expected max_ndim=${s.maxNDim}, found ndim=${o}`);if(s.minNDim!=null&&o<s.minNDim)throw new W(`Input ${r} is incompatible with layer ${this.name}: expected min_ndim=${s.minNDim}, found ndim=${o}.`);if(s.dtype!=null&&i.dtype!==s.dtype)throw new W(`Input ${r} is incompatible with layer ${this.name} : expected dtype=${s.dtype}, found dtype=${i.dtype}.`);if(s.axes){const a=i.shape;for(const u in s.axes){const l=Number(u),c=s.axes[u],f=l>=0?a[l]:a[a.length+l];if(c!=null&&[c,null].indexOf(f)===-1)throw new W(`Input ${r} is incompatible with layer ${this.name}: expected axis ${l} of input shape to have value ${c} but got shape ${a}.`)}}if(s.shape!=null)for(let a=0;a<s.shape.length;++a){const u=s.shape[a],l=i.shape[a];if(u!=null&&l!=null&&u!==l)throw new W(`Input ${r} is incompatible with layer ${this.name}: expected shape=${s.shape}, found shape=${i.shape}.`)}}}call(t,n){return t}invokeCallHook(t,n){this._callHook!=null&&this._callHook(t,n)}setCallHook(t){this._callHook=t}clearCallHook(){this._callHook=null}apply(t,n){n=n||{},this.assertNotDisposed();const r=sn(t);let i=!0;for(const o of r)if(!(o instanceof bu)){i=!1;break}let s=!0;for(const o of r)if(o instanceof bu){s=!1;break}if(i===s)throw new W("Arguments to apply() must be all SymbolicTensors or all Tensors");return Jd(this.name,()=>{if(!this.built){this.assertInputCompatibility(t);const o=[];for(const a of sn(t))o.push(a.shape);this.build(Pi(o)),this.built=!0,this.initialWeights&&this.setWeights(this.initialWeights),this._refCount===null&&s&&(this._refCount=1)}if(this.assertInputCompatibility(t),s){let o=this.call(t,n);const a=sn(o),u=[];for(let l of a)r.indexOf(l)!==-1&&(l=l.clone()),u.push(l);if(o=Pi(u),this.activityRegularizer!=null)throw new tt("Layer invocation in the presence of activity regularizer(s) is not supported yet.");return o}else{const o=GNe(t),a=this.computeOutputShape(o);let u;const l=HNe(t);if(this.warnOnIncompatibleInputShape(Array.isArray(t)?o[0]:o),a!=null&&a.length>0&&Array.isArray(a[0])?u=a.map((c,f)=>new bu(l,c,this,sn(t),n,this.name,f)):u=new bu(l,a,this,sn(t),n,this.name),this.addInboundNode(t,u,null,null,o,a,n),this._refCount++,this.activityRegularizer!=null)throw new tt("Layer invocation in the presence of activity regularizer(s) is not supported yet.");return u}})}warnOnIncompatibleInputShape(t){if(this.batchInputShape!=null)if(t.length!==this.batchInputShape.length)console.warn(`The rank of the input tensor provided (shape: ${JSON.stringify(t)}) does not match that of the batchInputShape (${JSON.stringify(this.batchInputShape)}) of the layer ${this.name}`);else{let n=!1;this.batchInputShape.forEach((r,i)=>{r!=null&&t[i]!=null&&t[i]!==r&&(n=!0)}),n&&console.warn(`The shape of the input tensor (${JSON.stringify(t)}) does not match the expectation of layer ${this.name}: ${JSON.stringify(this.batchInputShape)}`)}}get outputShape(){if(this.inboundNodes==null||this.inboundNodes.length===0)throw new ou(`The layer ${this.name} has never been called and thus has no defined output shape.`);const t=[];for(const n of this.inboundNodes){const r=JSON.stringify(n.outputShapes);t.indexOf(r)===-1&&t.push(r)}if(t.length===1){const n=this.inboundNodes[0].outputShapes;return Array.isArray(n)&&Array.isArray(n[0])&&n.length===1?n[0]:n}else throw new ou(`The layer ${this.name} has multiple inbound nodes with different output shapes. Hence the notion of "output shape" is ill-defined for the layer.`)}countParams(){if(!this.built)throw new ko(`You tried to call countParams() on ${this.name}, but the layer is not built yet. Build it first by calling build(batchInputShape).`);return Uk(this.weights)}build(t){this.built=!0}getWeights(t=!1){return uM(t?this.trainableWeights:this.weights)}setWeights(t){Z(()=>{const n=this.weights;if(n.length!==t.length)throw new W(`You called setWeights(weights) on layer "${this.name}" with a weight list of length ${t.length}, but the layer was expecting ${n.length} weights. Provided weights: ${t}...`);if(n.length===0)return;const r=[],i=uM(n);for(let s=0;s<i.length;++s){const o=i[s],a=n[s],u=t[s];if(!bt(o.shape,u.shape))throw new W(`Layer weight shape ${o.shape} not compatible with provided weight shape ${u.shape}`);r.push([a,u])}U5(r)})}addWeight(t,n,r,i,s,o,a,u){if(this._addedWeightNames.indexOf(t)!==-1)throw new W(`Duplicate weight name ${t} for layer ${this.name}`);this._addedWeightNames.push(t),r==null&&(r="float32"),this.fastWeightInitDuringBuild&&(i=u!=null?u():pn("zeros"));const l=i.apply(n,r),c=new UNe(l,r,t,o,a);return l.dispose(),s!=null&&this.addLoss(()=>s.apply(c.read())),o==null&&(o=!0),o?this._trainableWeights.push(c):this._nonTrainableWeights.push(c),c}setFastWeightInitDuringBuild(t){this.fastWeightInitDuringBuild=t}addLoss(t){t==null||Array.isArray(t)&&t.length===0||(t=sn(t),this._losses!==void 0&&this._losses!==null&&this.losses.push(...t))}computeOutputShape(t){return t}computeMask(t,n){if(!this.supportsMasking){if(n!=null)if(Array.isArray(n))n.forEach(r=>{if(r!=null)throw new TypeError(`Layer ${this.name} does not support masking, but was passed an inputMask.`)});else throw new TypeError(`Layer ${this.name} does not support masking, but was passed an inputMask.`);return null}return n}addInboundNode(t,n,r,i,s,o,a=null){const u=sn(t);n=sn(n),r=sn(r),i=sn(i),s=zk(s),o=zk(o);const l=[],c=[],f=[];for(const h of u)l.push(h.sourceLayer),c.push(h.nodeIndex),f.push(h.tensorIndex);new vI({outboundLayer:this,inboundLayers:l,nodeIndices:c,tensorIndices:f,inputTensors:u,outputTensors:n,inputMasks:r,outputMasks:i,inputShapes:s,outputShapes:o},a);for(let h=0;h<n.length;h++)n[h].sourceLayer=this,n[h].nodeIndex=this.inboundNodes.length-1,n[h].tensorIndex=h}getConfig(){const t={name:this.name,trainable:this.trainable};return this.batchInputShape!=null&&(t.batchInputShape=this.batchInputShape),this.dtype!=null&&(t.dtype=this.dtype),t}disposeWeights(){return this.weights.forEach(t=>t.dispose()),this.weights.length}assertNotDisposed(){if(this._refCount===0)throw new Error(`Layer '${this.name}' is already disposed.`)}dispose(){if(!this.built)throw new Error(`Cannot dispose Layer ${this.name} because it has not been built yet.`);if(this._refCount===null)throw new Error(`Cannot dispose Layer ${this.name} because it has not been used yet.`);this.assertNotDisposed();let t=0;return--this._refCount===0&&(t=this.disposeWeights()),{refCountAfterDispose:this._refCount,numDisposedVariables:t}}}function GNe(e){e=sn(e);const t=[];for(const n of e)t.push(n.shape);return Pi(t)}function HNe(e){return"float32"}function wre(e,t,n){if((t==null||n!=null&&n>0)&&(t=e.sourceLayer,n=e.nodeIndex),t.inboundNodes.length===0)return[e];{const r=t.inboundNodes[n];if(r.inboundLayers.length===0)return r.inputTensors;{const i=[];for(let s=0;s<r.inboundLayers.length;s++){const o=r.inputTensors[s],a=r.inboundLayers[s],u=r.nodeIndices[s],l=wre(o,a,u);for(const c of l)i.indexOf(c)===-1&&i.push(c)}return i}}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class Gw extends ut{constructor(t){if(super({dtype:t.dtype,name:t.name!=null?t.name:bI("input").toString()}),t.batchSize==null&&(t.batchSize=null),t.sparse==null&&(t.sparse=!1),this.trainable=!1,this.built=!0,this.sparse=t.sparse,t.inputShape!=null&&t.batchInputShape!=null)throw new W("Only provide the inputShape OR batchInputShape argument to inputLayer, not both at the same time.");let n=t.batchInputShape;if(n==null){if(t.inputShape==null)throw new W("An InputLayer should be passed either a `batchInputShape` or an `inputShape`.");n=[t.batchSize].concat(t.inputShape)}else if(t.batchSize!=null)throw new W("Cannot specify batchSize if batchInputShape is specified when creating an InputLayer.");const r=t.dtype||"float32";this.batchInputShape=n,this.dtype=r,this.inputSpec=[{shape:n}];const i=new bu(this.dtype,this.batchInputShape,this,[],{},this.name);i.nodeIndex=0,i.tensorIndex=0,new vI({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:[i],outputTensors:[i],inputMasks:[null],outputMasks:[null],inputShapes:[n],outputShapes:[n]})}apply(t,n){throw new W(`Cannot pass any input to an InputLayer's apply() method. InputLayer name: ${this.name}`)}dispose(){return{refCountAfterDispose:this._refCount,numDisposedVariables:0}}getConfig(){return{batchInputShape:this.batchInputShape,dtype:this.dtype,sparse:this.sparse,name:this.name}}}Gw.className="InputLayer";fe(Gw);function qNe(e){if(e.batchShape==null&&e.shape==null)throw new Error("Please provide to Input either a `shape` or a `batchShape` argument. Note that `shape` does not include the batch dimension.");if(e.batchShape!=null&&e.shape!=null)throw new W("Please provide either a `shape` or `batchShape` argument to Input, but not both.");let t=e.batchShape;e.shape!=null&&t==null&&(t=[null].concat(e.shape));let n=e.dtype;return n==null&&(n="float32"),new Gw({batchInputShape:t,name:e.name,dtype:n,sparse:e.sparse}).inboundNodes[0].outputTensors[0]}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function XNe(e,t){if(e.dtype==null||e.dtype===t.dtype)return t;try{return we(t,e.dtype)}catch{throw new W(`The dtype of the feed (${t.dtype}) can not be cast to the dtype of the key '${e.name}' (${e.dtype}).`)}}class rf{constructor(t){if(this.id2Value={},this.id2Mask={},this.name2Id={},t instanceof rf)for(const n in t.id2Value)this.id2Value[n]=t.id2Value[n],n in t.id2Mask&&(this.id2Mask[n]=t.id2Mask[n]);else{if(t==null)return;for(const n of t)this.add(n.key,n.value)}}add(t,n,r){if(this.id2Value[t.id]==null)this.id2Value[t.id]=XNe(t,n),this.name2Id[t.name]=t.id,r!=null&&(this.id2Mask[t.id]=r);else throw new W(`Duplicate key: name=${t.name}, id=${t.id}`);return this}addFeed(t){this.add(t.key,t.value)}hasKey(t){return this.id2Value[t.id]!=null}names(){return Object.keys(this.name2Id)}getValue(t){if(t instanceof bu){if(this.id2Value[t.id]==null)throw new W(`Nonexistent key: ${t.name}`);return this.id2Value[t.id]}else{const n=this.name2Id[t];if(n==null)throw new W(`Feed dict has no SymbolicTensor name: ${t}`);return this.id2Value[n]}}getMask(t){if(t instanceof bu){if(this.id2Value[t.id]==null)throw new W(`Nonexistent key: ${t.name}`);return this.id2Mask[t.id]}else{const n=this.name2Id[t];if(n==null)throw new W(`Feed dict has no SymbolicTensor name: ${t}`);return this.id2Mask[n]}}disposeMasks(){this.id2Mask!=null&&at(this.id2Mask)}}const jk=new ire,Wk=new ire;function YNe(e){jk!=null&&jk.setMaxEntries(e),Wk!=null&&Wk.setMaxEntries(e)}function Tb(e,t,n,r){const i=n==null?!1:n.training,s=Array.isArray(e),o=s?e:[e],a=o.map(p=>p.name),u=[],l=t.names();for(const p of a)l.indexOf(p)!==-1?u.push(t.getValue(p)):u.push(null);r!=null&&(r.maxNumTensors=-1/0,r.minNumTensors=1/0);const c=a.join(",")+"|"+t.names().sort().join(",");let f=jk.get(c),h;if(f==null){const p=KNe(o,t);f=p.sorted,h=p.recipientCounts,jk.put(c,f),Wk.put(c,h)}h={},i||Object.assign(h,Wk.get(c));const d=new rf(t);for(let p=0;p<f.length;++p){if(r!=null){const k=Lk().numTensors;k>r.maxNumTensors&&(r.maxNumTensors=k),k<r.minNumTensors&&(r.minNumTensors=k)}const g=f[p],m=g.sourceLayer;if(m instanceof Gw)continue;const y=[],b=[],v=[];let x=!1;for(const k of g.inputs){const E=d.getValue(k),_=d.getMask(k);y.push(E),b.push(_),_!=null&&(x=!0),i||(h[k.name]--,h[k.name]===0&&!t.hasKey(k)&&a.indexOf(k.name)===-1&&!E.isDisposed&&k.sourceLayer.stateful!==!0&&v.push(E))}x&&(n=n||{},n.mask=b[0]);const w=sn(m.apply(y,n));let C=null;m.supportsMasking&&(C=m.computeMask(y,b));const $=JNe(g),S=Array.isArray($)?$:[$];for(let k=0;k<S.length;++k){d.hasKey(S[k])||d.add(S[k],w[k],Array.isArray(C)?C[0]:C);const E=a.indexOf(S[k].name);E!==-1&&(u[E]=w[k])}i||at(v)}return d.disposeMasks(),s?u:u[0]}function KNe(e,t){N(e!=null&&e.length>0,()=>"Expected at least one fetch, got none");let n=[],r={};if(e.length===1){const i=WV(e[0],t);n=i.sorted,r=i.recipientMap}else{const i=new Set;for(const s of e){const{sorted:o,recipientMap:a}=WV(s,t);for(const u of o)i.has(u.name)||(n.push(u),i.add(u.name));for(const u in a)r[u]==null&&(r[u]=new Set),a[u].forEach(l=>r[u].add(l))}}return{sorted:n,recipientCounts:ZNe(r)}}function ZNe(e){const t={};for(const n in e)t[n]=e[n].size;return t}function WV(e,t){const n=new Set,r=[],i={};for(const a of t.names())n.add(a);const s=[],o=[];for(s.push(e);s.length>0;){const a=s[s.length-1];if(n.has(a.name)){s.pop();continue}const u=o[o.length-1]===s.length-1;if(a.inputs.length===0||u)s.pop(),r.push(a),n.add(a.name),u&&o.pop();else{o.push(s.length-1);for(const l of a.inputs)i[l.name]==null&&(i[l.name]=new Set),i[l.name].add(a.name),!n.has(l.name)&&s.push(l)}}return{sorted:r,recipientMap:i}}function JNe(e){let t;if(e.sourceLayer.inboundNodes.length===1)t=e.sourceLayer.output;else{let n=null;for(let r=0;r<e.sourceLayer.inboundNodes.length;++r)for(const i of e.sourceLayer.inboundNodes[r].outputTensors)if(i.id===e.id){n=r;break}t=e.sourceLayer.getOutputAt(n)}return t}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const QNe=K();QNe.registerFlag("TOPOLOGICAL_SORT_CACHE_MAX_ENTRIES",()=>100,YNe);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function j5(e,t){return Z(()=>Kr(Ae(j(e,e),t,!0)))}class Hw extends lg{getConfig(){return{}}}class $re extends Hw{constructor(t){super(),this.defaultMaxValue=2,this.defaultAxis=0,this.maxValue=t.maxValue!=null?t.maxValue:this.defaultMaxValue,this.axis=t.axis!=null?t.axis:this.defaultAxis}apply(t){return Z(()=>{const n=j5(t,this.axis),r=_s(n,0,this.maxValue);return j(t,Re(r,ce(qn(),n)))})}getConfig(){return{maxValue:this.maxValue,axis:this.axis}}}$re.className="MaxNorm";fe($re);class Cre extends Hw{constructor(t){super(),this.defaultAxis=0,this.axis=t.axis!=null?t.axis:this.defaultAxis}apply(t){return Z(()=>Re(t,ce(qn(),j5(t,this.axis))))}getConfig(){return{axis:this.axis}}}Cre.className="UnitNorm";fe(Cre);class Sre extends Hw{apply(t){return Zu(t)}}Sre.className="NonNeg";fe(Sre);class kre extends Hw{constructor(t){super(),this.defaultMinValue=0,this.defaultMaxValue=1,this.defaultRate=1,this.defaultAxis=0,this.minValue=t.minValue!=null?t.minValue:this.defaultMinValue,this.maxValue=t.maxValue!=null?t.maxValue:this.defaultMaxValue,this.rate=t.rate!=null?t.rate:this.defaultRate,this.axis=t.axis!=null?t.axis:this.defaultAxis}apply(t){return Z(()=>{const n=j5(t,this.axis),r=ce(j(this.rate,_s(n,this.minValue,this.maxValue)),j(1-this.rate,n));return j(t,Re(r,ce(qn(),n)))})}getConfig(){return{minValue:this.minValue,maxValue:this.maxValue,rate:this.rate,axis:this.axis}}}kre.className="MinMaxNorm";fe(kre);const VV={maxNorm:"MaxNorm",minMaxNorm:"MinMaxNorm",nonNeg:"NonNeg",unitNorm:"UnitNorm"};function Yn(e){return D5(e)}function GV(e,t={}){return Uw(e,qs.getMap().classNameMap,t,"constraint")}function Kn(e){if(e==null)return null;if(typeof e=="string"){const n={className:e in VV?VV[e]:e,config:{}};return GV(n)}else return e instanceof Hw?e:GV(e)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */async function td(e){if(e==null)return;const t=[],n=[],r=[];for(const i in e){const s=e[i];if(typeof s!="number"){const o=s;t.push(o.data()),n.push(i),r.push(o)}}if(t.length>0){const i=await Promise.all(t);for(let s=0;s<i.length;++s)e[n[s]]=i[s][0];at(r)}}function Ere(e){if(e!=null)for(const t in e){const n=e[t];typeof n!="number"&&n.dispose()}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */var HV;(function(e){e[e.SILENT=0]="SILENT",e[e.VERBOSE=1]="VERBOSE"})(HV||(HV={}));const eFe=125;class Zx{constructor(){this.validationData=null}setParams(t){this.params=t}async onEpochBegin(t,n){}async onEpochEnd(t,n){}async onBatchBegin(t,n){}async onBatchEnd(t,n){}async onTrainBegin(t){}async onTrainEnd(t){}setModel(t){}}class tFe{constructor(t,n=10){t==null&&(t=[]),this.callbacks=t,this.queueLength=n}append(t){this.callbacks.push(t)}setParams(t){for(const n of this.callbacks)n.setParams(t)}setModel(t){for(const n of this.callbacks)n.setModel(t)}async onEpochBegin(t,n){n==null&&(n={});for(const r of this.callbacks)await r.onEpochBegin(t,n)}async onEpochEnd(t,n){n==null&&(n={});for(const r of this.callbacks)await r.onEpochEnd(t,n)}async onBatchBegin(t,n){n==null&&(n={});for(const r of this.callbacks)await r.onBatchBegin(t,n)}async onBatchEnd(t,n){n==null&&(n={});for(const r of this.callbacks)await r.onBatchEnd(t,n)}async onTrainBegin(t){t==null&&(t={});for(const n of this.callbacks)await n.onTrainBegin(t)}async onTrainEnd(t){t==null&&(t={});for(const n of this.callbacks)await n.onTrainEnd(t)}}class nFe extends Zx{constructor(){super()}async onEpochBegin(t){this.seen=0,this.totals={}}async onBatchEnd(t,n){n==null&&(n={});const r=n.size==null?0:n.size;this.seen+=r;for(const i in n){const s=n[i];if(typeof s=="number")this.totals.hasOwnProperty(i)||(this.totals[i]=0),this.totals[i]=this.totals[i]+s*r;else{let o;i in this.totals?o=this.totals[i]:this.totals[i]=0;const a=Z(()=>ce(this.totals[i],j(s,r)));this.totals[i]=a,o!=null&&o.dispose()}}}async onEpochEnd(t,n){if(n!=null)for(const r of this.params.metrics)this.totals[r]!=null&&(typeof this.totals[r]=="number"?n[r]=this.totals[r]/this.seen:Z(()=>{const i=j(Re(1,this.seen),this.totals[r]);n[r]=i,this.totals[r].dispose(),Ca(n[r])}))}}class rFe extends Zx{async onTrainBegin(t){this.epoch=[],this.history={}}async onEpochEnd(t,n){n==null&&(n={}),this.epoch.push(t);for(const r in n)this.history[r]==null&&(this.history[r]=[]),this.history[r].push(n[r])}async syncData(){const t=[],n=[],r=[];for(const s in this.history){const o=this.history[s];for(let a=0;a<o.length;++a)if(typeof o[a]!="number"){const u=o[a];t.push(u.data()),n.push(s),r.push(a)}}const i=await Promise.all(t);for(let s=0;s<i.length;++s)this.history[n[s]][r[s]].dispose(),this.history[n[s]][r[s]]=i[s][0]}}class iFe extends Zx{constructor(t,n){if(super(),this.currentEpoch=0,this.nowFunc=t.nowFunc,this.nextFrameFunc=t.nextFrameFunc||c5,this.yieldEvery=n||"auto",this.yieldEvery==="auto"&&(this.yieldEvery=eFe),this.yieldEvery==="never"&&t.onYield!=null)throw new Error("yieldEvery is `never` but you provided an `onYield` callback. Either change `yieldEvery` or remove the callback");Tk(this.yieldEvery)&&(this.maybeWait=xNe(this.maybeWait.bind(this),this.yieldEvery,this.nowFunc)),this.trainBegin=t.onTrainBegin,this.trainEnd=t.onTrainEnd,this.epochBegin=t.onEpochBegin,this.epochEnd=t.onEpochEnd,this.batchBegin=t.onBatchBegin,this.batchEnd=t.onBatchEnd,this.yield=t.onYield}async maybeWait(t,n,r){const i=[];this.yield!=null&&(await td(r),i.push(this.yield(t,n,r))),i.push(this.nextFrameFunc()),await Promise.all(i)}async onEpochBegin(t,n){this.currentEpoch=t,this.epochBegin!=null&&(await td(n),await this.epochBegin(t,n))}async onEpochEnd(t,n){const r=[];this.epochEnd!=null&&(await td(n),r.push(this.epochEnd(t,n))),this.yieldEvery==="epoch"&&r.push(this.nextFrameFunc()),await Promise.all(r)}async onBatchBegin(t,n){this.batchBegin!=null&&(await td(n),await this.batchBegin(t,n))}async onBatchEnd(t,n){const r=[];this.batchEnd!=null&&(await td(n),r.push(this.batchEnd(t,n))),this.yieldEvery==="batch"?r.push(this.nextFrameFunc()):Tk(this.yieldEvery)&&r.push(this.maybeWait(this.currentEpoch,t,n)),await Promise.all(r)}async onTrainBegin(t){this.trainBegin!=null&&(await td(t),await this.trainBegin(t))}async onTrainEnd(t){this.trainEnd!=null&&(await td(t),await this.trainEnd(t))}}function _re(e,t){return e==null&&(e={}),e instanceof Zx?[e]:Array.isArray(e)&&e[0]instanceof Zx?e:sn(e).map(r=>new iFe(r,t))}class vo{constructor(){}static registerCallbackConstructor(t,n){N(t>=0&&Number.isInteger(t),()=>`Verbosity level is expected to be an integer >= 0, but got ${t}`),vo.checkForDuplicate(n),vo.constructors[t]==null&&(vo.constructors[t]=[]),vo.constructors[t].push(n)}static checkForDuplicate(t){for(const n in vo.constructors)vo.constructors[+n].forEach(i=>{if(i===t)throw new W("Duplicate callback constructor.")})}static clear(){vo.constructors={}}static createCallbacks(t){const n=[];for(const r in vo.constructors){const i=+r;t>=i&&n.push(...vo.constructors[i])}return n.map(r=>new r)}}vo.constructors={};function Are(e,t,n,r,i,s,o,a,u){const l=new rFe,c=[new nFe,...vo.createCallbacks(t)];e!=null&&c.push(...e),c.push(l);const f=new tFe(c);return f.setParams({epochs:n,initialEpoch:r,samples:i,steps:s,batchSize:o,verbose:t,doValidation:a,metrics:u}),{callbackList:f,history:l}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Ql(e,t={},n=!1){return Uw(e,qs.getMap().classNameMap,t,"layer",n)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Vk(e,t){return Z(()=>{e.dtype!=="float32"&&(e=we(e,"float32"));const n=Ae(Ww(e),t,!0),r=U1(n.shape,qn()),i=Kr($c(n,r));return Re(e,i)})}function wI(e,t){return Z(()=>kn(Ww(_e(t,e)),-1))}function W5(e,t){return Z(()=>kn(Gn(_e(t,e)),-1))}function V5(e,t){return Z(()=>{const n=_e(e,t),r=_s(Gn(e),qn(),Number.MAX_VALUE),i=Gn(Re(n,r));return j(100,kn(i,-1))})}function sFe(e,t){return Z(()=>{const n=_s(t,qn(),Number.MAX_VALUE),r=ro(ce(1,n)),i=_s(e,qn(),Number.MAX_VALUE),s=ro(ce(1,i));return kn(Ww(_e(r,s)),-1)})}function oFe(e,t){return Z(()=>{const n=$c(0,_e(1,j(e,t)));return kn(Ww(n),-1)})}function aFe(e,t){return Z(()=>{const n=$c(0,_e(1,j(e,t)));return kn(n,-1)})}function uFe(e,t){return Z(()=>{const n=Ae(j(e,t),-1),r=Oo(j(_e(1,e),t),-1);return $c(0,ce(1,_e(r,n)))})}function lFe(e,t){return Z(()=>{const n=Math.log(2),r=_e(t,e),i=_e(ce(r,j1(j(-2,r))),n);return kn(i,-1)})}function Jx(e,t,n=!1){return Z(()=>{if(n)t=eI(t);else{const r=Ae(t,t.shape.length-1,!0);t=Re(t,r)}return t=_s(t,qn(),1-qn()),un(Ae(j(we(e,"float32"),ro(t)),t.shape.length-1))})}function Gk(e,t,n=!1){return Z(()=>{const r=we(Mw(DNe(e)),"int32");t=_s(t,qn(),1-qn());const i=t.shape,s=V(qx(r,i[i.length-1]),i);return Jx(s,t,n)})}function cFe(e,t){if(!bt(e.shape,t.shape))throw new W(`logits and labels must have the same shape, but got shapes ${JSON.stringify(e.shape)} and ${JSON.stringify(t.shape)}`);return Z(()=>{const n=Zu(t),r=un(Gn(t));return ce(_e(n,j(t,e)),VT(no(r)))})}function $I(e,t){return Z(()=>{let n;return n=_s(t,qn(),1-qn()),n=ro(Re(n,_e(1,n))),kn(cFe(e,n),-1)})}function fFe(e,t){return Z(()=>{const n=_s(e,qn(),1),r=_s(t,qn(),1);return Ae(j(e,ro(Re(n,r))),-1)})}function hFe(e,t){return Z(()=>{const n=ro(ce(qn(),t));return kn(_e(t,j(e,n)),-1)})}function Tre(e,t){return Z(()=>{const n=Vk(e,-1),r=Vk(t,-1),i=j(n,r);return un(Ae(i,-1))})}const Hk={meanSquaredError:wI,meanAbsoluteError:W5,meanAbsolutePercentageError:V5,meanSquaredLogarithmicError:sFe,squaredHinge:oFe,hinge:aFe,categoricalHinge:uFe,logcosh:lFe,categoricalCrossentropy:Jx,sparseCategoricalCrossentropy:Gk,binaryCrossentropy:$I,kullbackLeiblerDivergence:fFe,poisson:hFe,cosineProximity:Tre};function o3(e){if(typeof e=="string"){if(e in Hk)return Hk[e];let t=`Unknown loss ${e}`;throw e.toLowerCase().includes("softmaxcrossentropy")&&(t=`Unknown loss ${e}. Use "categoricalCrossentropy" as the string name for tf.losses.softmaxCrossEntropy`),new W(t)}else return e}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Ire(e,t){return Z(()=>{const n=j(.5,io(t)),r=Su(zs(t,n),e.dtype);return kn(Ia(e,r),-1)})}function Dre(e,t){return Z(()=>Su(Ia(Hm(e,-1),Hm(t,-1)),"float32"))}function dFe(e,t){return Z(()=>we(Ae(Lu(Ia(e,1),Ia(t,1))),"float32"))}function pFe(e,t){return Z(()=>we(Ae(Lu(Ia(e,0),Ia(t,1))),"float32"))}function gFe(e,t){return Z(()=>{const n=dFe(e,t),r=pFe(e,t),i=ce(n,r);return we(Xr(zs(i,0),Re(n,i),0),"float32")})}function mFe(e,t){return $I(e,t)}function yFe(e,t){return e.rank===t.rank&&(e=ug(e,[e.rank-1])),t=Hm(t,-1),t.dtype!==e.dtype&&(t=we(t,e.dtype)),we(Ia(e,t),"float32")}const bFe=wI,xFe=wI,vFe=W5,wFe=W5,$Fe=V5,CFe=V5,Nre=Jx,SFe=Tre,Fre=Gk,qk={binaryAccuracy:Ire,categoricalAccuracy:Dre,precision:gFe,categoricalCrossentropy:Nre,sparseCategoricalCrossentropy:Fre,mse:bFe,MSE:xFe,mae:vFe,MAE:wFe,mape:$Fe,MAPE:CFe,cosine:SFe};function kFe(e){if(typeof e=="string"&&e in qk)return qk[e];if(typeof e!="string"&&e!=null)return e;throw new W(`Unknown metric ${e}`)}function TC(e){if(au(e!==null,`Unknown LossOrMetricFn ${e}`),typeof e=="string")return e;{let t;for(const n of Object.keys(Hk))if(Hk[n]===e){t=n;break}if(t!==void 0)return t;for(const n of Object.keys(qk))if(qk[n]===e){t=n;break}return t!==void 0?t:e.name}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function EFe(e){const t={Adagrad:()=>Hc.adagrad(.01),Adadelta:()=>Hc.adadelta(1,.95,qn()),Adam:()=>Hc.adam(.001,.9,.999,qn()),Adamax:()=>Hc.adamax(.002,.9,.999,qn(),0),RMSProp:()=>Hc.rmsprop(.001,.9,0,qn()),SGD:()=>Hc.sgd(.01)};if(t.adagrad=t.Adagrad,t.adadelta=t.Adadelta,t.adam=t.Adam,t.adamax=t.Adamax,t.rmsprop=t.RMSProp,t.sgd=t.SGD,e in t)return t[e]();throw new W(`Unknown Optimizer ${e}`)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const qV=1*1024*1024;function XV(e,t,n=!1){if(e==null||typeof e!="object"||Object.getPrototypeOf(e)!==Object.prototype||!lM(e))throw new Error("User-defined metadata is expected to be a JSON object, but is not.");if(n){const r=JSON.stringify(e);r.length>qV&&console.warn(`User-defined metadata of model "${t}" is too large in size (length=${r.length} when serialized). It is not recommended to store such large objects in user-defined metadata. Please make sure its serialized length is <= ${qV}.`)}}function lM(e){if(e===null)return!0;if(typeof e=="object")if(Object.getPrototypeOf(e)===Object.prototype){const t=Object.keys(e);for(const n of t)if(typeof n!="string"||!lM(e[n]))return!1;return!0}else if(Array.isArray(e)){for(const t of e)if(!lM(t))return!1;return!0}else return!1;else{const t=typeof e;return t==="string"||t==="number"||t==="boolean"}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function _Fe(e,t,n,r=console.log){const i=TFe(e),s=["Layer (type)","Input Shape","Output shape","Param #"];i?(t=t||90,n=n||[.32,.61,.89,1]):(t=t||115,n=n||[.24,.48,.7,.8,1]),n[n.length-1]<=1&&(n=n.map(c=>Math.floor(t*c)));let o;if(!i){s.push("Receives inputs"),o=[];for(const c in e.nodesByDepth)o.push(...e.nodesByDepth[c])}r("_".repeat(t)),Xk(s,n,r),r("=".repeat(t));const a=e.layers;for(let c=0;c<a.length;++c)i?IFe(a[c],n,r):DFe(a[c],n,o,r),r((c===a.length-1?"=":"_").repeat(t));e.checkTrainableWeightsConsistency();const u=AFe(e),l=Uk(e.nonTrainableWeights);r(`Total params: ${u+l}`),r(`Trainable params: ${u}`),r(`Non-trainable params: ${l}`),r("_".repeat(t))}function AFe(e){let t;return e.collectedTrainableWeights!=null?t=Uk(e.collectedTrainableWeights):t=Uk(e.trainableWeights),t}function TFe(e){let t=!0;const n=[],r=[];for(const i in e.nodesByDepth)n.push(e.nodesByDepth[i]);for(const i of n){if(i.length>1||i.length===1&&i[0].inboundLayers.length>1){t=!1;break}r.push(...i)}if(t)for(const i of e.layers){let s=!1;for(const o of i.inboundNodes)if(r.indexOf(o)!==-1)if(s){t=!1;break}else s=!0;if(!t)break}return t}function Xk(e,t,n=console.log){let r="";for(let i=0;i<e.length;++i)i>0&&(r=r.slice(0,r.length-1)+" "),r+=e[i],r=r.slice(0,t[i]),r+=" ".repeat(t[i]-r.length);n(r)}function IFe(e,t,n){let r,i;try{i=e.inboundNodes.map(u=>JSON.stringify(u.inputShapes)).join(",")}catch{i="multiple"}try{r=JSON.stringify(e.outputShape)}catch{r="multiple"}const s=e.name,o=e.getClassName(),a=[`${s} (${o})`,i,r,e.countParams().toString()];Xk(a,t,n)}function DFe(e,t,n,r){let i,s;try{s=e.inboundNodes.map(f=>JSON.stringify(f.inputShapes)).join(",")}catch{s="multiple"}try{i=JSON.stringify(e.outputShape)}catch{i="multiple"}const o=[];for(const f of e.inboundNodes)if(!(n!=null&&n.length>0&&n.indexOf(f)===-1))for(let h=0;h<f.inboundLayers.length;++h){const d=f.inboundLayers[h].name,p=f.nodeIndices[h],g=f.tensorIndices[h];o.push(`${d}[${p}][${g}]`)}const a=e.name,u=e.getClassName(),l=o.length===0?"":o[0],c=[`${a} (${u})`,s,i,e.countParams().toString(),l];Xk(c,t,r);for(let f=1;f<o.length;++f)Xk(["","","","",o[f]],t,r)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Ore(e,t,n){return(e==="inboundNodes"||e==="outputLayers"||e==="inputLayers")&&t===0&&typeof n=="string"}function cM(e,t){if(e===null)return null;if(typeof e=="string")return Cd(e);if(typeof e=="number"||typeof e=="boolean")return e;if(e instanceof Array){const n=[],r=e.length;for(let i=0;i<r;++i){const s=e[i];Ore(t,i,s)?n.push(s):n.push(cM(s,t))}return n}else{const n={};for(const r of Object.keys(e)){const i=e[r];if(r==="name"&&typeof i=="string")n[r]=i;else{const s=Cd(r);n[s]=cM(i,s)}}return n}}function fM(e,t){if(e==null)return null;if(typeof e=="string")return Al(e);if(typeof e=="number"||typeof e=="boolean")return e;if(e instanceof Array){const n=[],r=e.length;for(let i=0;i<r;++i){const s=e[i];Ore(t,i,s)?n.push(s):n.push(fM(s,t))}return n}else{const n={};for(const r of Object.keys(e)){const i=e[r],s=Al(r);(r==="name"||r==="className")&&typeof i=="string"?n[s]=i:n[s]=fM(i,r)}return n}}/** @license See the LICENSE file. */const Rre="4.10.0";/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class sa extends ut{constructor(t){if(super({}),this.containerNodes=new Set,this.name=t.name,this.name==null){const b=this.getClassName().toLowerCase();this.name=bI(b)}if(this.supportsMasking=!1,this.trainable_=!0,Array.isArray(t.inputs)?this.inputs=t.inputs.slice():this.inputs=[t.inputs],Array.isArray(t.outputs)?this.outputs=t.outputs.slice():this.outputs=[t.outputs],Cf(this.inputs).length!==this.inputs.length)throw new W(`The list of inputs passed to the model is redundant. All inputs should only appear once. Found: ${this.inputs.map(b=>b.name)}`);Cf(this.outputs).length!==this.outputs.length&&console.warn(`The list of outputs passed to the model is redundant. All outputs should only appear once. Found: ${this.outputs.map(b=>b.name)}`),this.inputLayers=[],this.inputLayersNodeIndices=[],this.inputLayersTensorIndices=[],this.outputLayers=[],this.outputLayersNodeIndices=[],this.outputLayersTensorIndices=[],this.layers=[],this.internalContainerRefs=[];for(const b of this.outputs){const v=b.sourceLayer,x=b.nodeIndex,w=b.tensorIndex;this.outputLayers.push(v),this.outputLayersNodeIndices.push(x),this.outputLayersTensorIndices.push(w)}for(const b of this.inputs){const v=b.sourceLayer,x=b.nodeIndex,w=b.tensorIndex;au(x===0,"input layer has >1 nodes"),au(w===0,"input layer has >1 tensors"),this.inputLayers.push(v),this.inputLayersNodeIndices.push(x),this.inputLayersTensorIndices.push(w)}this.inputNames=[],this.outputNames=[],this.feedInputShapes=[],this.feedInputNames=[],this.feedOutputNames=[];for(let b=0;b<this.inputLayers.length;b++){const v=this.inputLayers[b];if(!(v instanceof Gw))throw new TypeError(`Input layers to a LayersModel must be InputLayer objects. Received inputs: ${t.inputs}. Input ${b} (0-based) originates from layer type ${v.getClassName()}.`);this.inputNames.push(v.name),this.feedInputShapes.push(v.batchInputShape),this.feedInputNames.push(v.name)}for(const b of this.outputLayers)this.outputNames.push(b.name);this.internalInputShapes=this.inputs.map(b=>b.shape),this.internalOutputShapes=this.outputs.map(b=>b.shape);const n={},r={},i={},s={},o={},a=[],u=(b,v,x,w,C,$)=>{(w==null||C==null||$==null)&&(w=b.sourceLayer,C=b.nodeIndex,$=b.tensorIndex);const S=w.inboundNodes[C];if(x.indexOf(S)!==-1)throw new ko(`The tensor ${b.name} at layer "${w.name}" is part of a cycle.`);if(v.indexOf(S)!==-1)return;this.containerNodes.add(sa.nodeKey(w,C)),w.id in o||(o[w.id]=Object.keys(o).length),x.indexOf(S)===-1&&x.push(S);const k=S.inboundLayers.length;for(let E=0;E<k;E++){const _=S.inputTensors[E],D=S.inboundLayers[E],A=S.nodeIndices[E],T=S.tensorIndices[E];u(_,v,x,D,A,T)}for(v.push(S);x.indexOf(S)>=0;)x.splice(x.indexOf(S),1);a.push(S)},l=[],c=[];for(const b of this.outputs)u(b,l,c);const f=a.slice().reverse();for(const b of f){r[b.id]=b,b.id in n||(n[b.id]=0);let v=n[b.id];const x=i[b.outboundLayer.id]==null?0:i[b.outboundLayer.id];v=Math.max(v,x),i[b.outboundLayer.id]=v,s[b.outboundLayer.id]=b.outboundLayer,n[b.id]=v;for(let w=0;w<b.inboundLayers.length;w++){const C=b.inboundLayers[w],$=b.nodeIndices[w],S=C.inboundNodes[$],k=n[S.id]==null?0:n[S.id];n[S.id]=Math.max(v+1,k),r[S.id]=S}}const h={};for(const b in n){const v=n[b];v in h||(h[v]=[]),h[v].push(r[b])}const d={};for(const b in i){const v=i[b];v in d||(d[v]=[]),d[v].push(s[b])}let p=Object.keys(d).map(b=>parseInt(b,10)).sort(EC);this.layers=[];for(const b of p){const v=d[b];v.sort((x,w)=>{const C=o[x.id],$=o[w.id];return C<$?-1:C>$?1:0});for(const x of v)x instanceof sa&&this.internalContainerRefs.push(x),this.layers.push(x)}this.layersByDepth=d,p=Object.keys(h).map(b=>parseInt(b,10)).sort(EC);const g=this.inputs.slice(),m=[];for(const b of p)for(const v of h[b]){const x=v.outboundLayer;if(x!=null){for(const w of v.inputTensors)if(g.indexOf(w)===-1)throw new ko(`Graph disconnected: cannot obtain value for tensor ${w} at layer "${x.name}". The following previous layers were accessed without issue: ${m}`);for(const w of v.outputTensors)g.push(w);m.push(x.name)}}this.nodesByDepth=h;const y=this.layers.map(b=>b.name);for(const b of y){const v=y.filter(x=>x===b).length;if(v!==1)throw new ko(`The name "${b}" is used ${v} times in the model. All layer names should be unique. Layer names: `+JSON.stringify(y))}this.outboundNodes=[],this.inboundNodes=[],new vI({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:this.inputs,outputTensors:this.outputs,inputMasks:this.inputs.map(b=>null),outputMasks:this.outputs.map(b=>null),inputShapes:this.inputs.map(b=>b.shape),outputShapes:this.outputs.map(b=>b.shape)}),this.built=!0,this._refCount=1}assertNotDisposed(){if(this._refCount===0)throw new Error(`Container '${this.name}' is already disposed.`)}dispose(){this.assertNotDisposed();const t={refCountAfterDispose:null,numDisposedVariables:0};if(--this._refCount===0){for(const n of this.layers)t.numDisposedVariables+=n.dispose().numDisposedVariables;for(const n of this.internalContainerRefs)t.numDisposedVariables+=n.dispose().numDisposedVariables}return t.refCountAfterDispose=this._refCount,t}get trainable(){return this.trainable_}set trainable(t){this.layers.forEach(n=>{n._trainableWeights.forEach(r=>r.trainable=t)}),this.trainable_=t}get trainableWeights(){if(this._trainableWeights.length>0)throw new W("Container instance unexpectedly contains _trainableWeights.The trainable weights of a Container are a union of the trainable weights of its consituent Layers. Its own _trainableWeights must remain an empty Array.");if(!this.trainable)return[];let t=[];for(const n of this.layers)t=t.concat(n.trainableWeights);return t}get nonTrainableWeights(){const t=[];for(const n of this.layers)t.push(...n.nonTrainableWeights);if(!this.trainable){const n=[];for(const r of this.layers)n.push(...r.trainableWeights);return n.concat(t)}return t}get weights(){return this.trainableWeights.concat(this.nonTrainableWeights)}loadWeights(t,n=!0){const r={};let i=0;const s=Object.keys(t)[0].split("/"),o=!isNaN(parseInt(s[s.length-1],10));for(const u of this.layers)for(const[l,c]of u.weights.entries()){const f=o?`${c.name.split("/").slice(0,-1).join("/")+"/"}${l}`:c.originalName;if(r[f]!=null)throw new W(`Duplicate weight name: ${f}`);r[f]=c,i++}const a=[];for(const u in t){let l=u;if(r[u]==null){const c=u.split("/");l=c.slice(0,-2).concat([c[c.length-1]]).join("/")}if(r[l]!=null)a.push([r[l],t[u]]);else if(n)throw new W(`Provided weight data has no target variable: ${u}`);delete r[l]}if(n){const u=[];for(const l in r)u.push(l);if(u.length>0)throw new W(`${u.length} of ${i} weights are not set: ${u}`)}U5(a)}updatedConfig(){const t=this.getConfig(),n={};return n.className=this.getClassName(),n.config=t,n.kerasVersion=`tfjs-layers ${Rre}`,n.backend="TensorFlow.js",n}toJSON(t,n=!0){const r=fM(this.updatedConfig());return n?JSON.stringify(r):r}call(t,n){return Z(()=>{t=sn(t);const r=new rf;for(let i=0;i<this.inputs.length;++i)r.add(this.inputs[i],t[i]);return Tb(this.outputs,r,n)})}computeMask(t,n){return Z(()=>{t=sn(t);let r;return n==null?r=vp(null,t.length):r=sn(n),this.runInternalGraph(t,r)[1]})}computeOutputShape(t){const n=zk(t);if(n.length!==this.inputLayers.length)throw new W(`Invalid inputShape argument ${t}: model has ${this.inputLayers.length} tensor inputs.`);const r={};for(let a=0;a<n.length;a++){const u=this.inputLayers[a],l=n[a],c=u.name+"_0_0";r[c]=l}const i=Object.keys(this.nodesByDepth).map(a=>parseInt(a,10)).sort(EC);if(i.length>1)for(const a of i){const u=this.nodesByDepth[a];for(const l of u){const c=l.outboundLayer;if(this.inputLayers.map(g=>g.id).indexOf(c.id)!==-1)continue;const f=[];for(let g=0;g<l.inboundLayers.length;g++){const m=l.inboundLayers[g],y=l.nodeIndices[g],b=l.tensorIndices[g],v=`${m.name}_${y}_${b}`,x=r[v];f.push(x)}const h=c.computeOutputShape(Pi(f)),d=zk(h),p=c.inboundNodes.indexOf(l);for(let g=0;g<d.length;g++){const m=`${c.name}_${p}_${g}`;r[m]=d[g]}}}const s=[],o=[];for(let a=0;a<this.outputLayers.length;a++){const u=this.outputLayers[a],l=this.outputLayersNodeIndices[a],c=this.outputLayersTensorIndices[a],f=`${u.name}_${l}_${c}`;o.push(f)}for(let a=0;a<o.length;a++){const u=o[a];au(u in r),s.push(r[u])}return Pi(s)}runInternalGraph(t,n){n==null&&(n=vp(null,t.length));const r={};for(let u=0;u<this.inputs.length;++u){const l=this.inputs[u],c=t[u],f=n[u];r[l.id]=[c,f]}const i=Object.keys(this.nodesByDepth).map(u=>parseInt(u,10)).sort(EC);for(const u of i){const l=this.nodesByDepth[u];for(const c of l){const f=c.outboundLayer,h=c.inputTensors,d=c.outputTensors,p=new Array;for(const g of h)g.id in r&&p.push(r[g.id]);if(p.length===h.length){let g={},m,y,b,v;if(c.callArgs!=null&&(g=c.callArgs),p.length===1){const[x,w]=p[0];g.mask==null&&(g.mask=w),b=sn(f.call(x,g)),v=sn(f.computeMask(x,w)),m=[x],y=[w]}else m=p.map(x=>x[0]),y=p.map(x=>x[1]),g.mask==null&&(g.mask=y),b=sn(f.call(m,g)),v=sn(f.computeMask(m,y));if(f.activityRegularizer)throw new tt("LayersModel invocation with concrete Tensor value(s) in the presence of activity regularizer(s) is not supported yet.");for(let x=0;x<d.length;++x){const w=d[x],C=b[x],$=v[x];r[w.id]=[C,$]}}}}const s=[],o=[],a=[];for(const u of this.outputs){au(u.id in r,`Could not compute output ${u.name} : ${u.id}`);const[l,c]=r[u.id];a.push(l.shape),s.push(l),o.push(c)}return[s,o,a]}buildNodeConversionMap(t){const n={};let r;for(const i of this.layers){r=i instanceof sa?1:0;for(let s=0;s<i.inboundNodes.length;s++){const o=sa.nodeKey(i,s);this.containerNodes.has(o)&&(n[o]=r,r+=1)}}return n}getLayer(t,n){if(n!=null)return this.findLayer(n);if(t==null)throw new W("Provide either a layer name or layer index");if(typeof t=="number")return this.findLayer(t);for(const r of this.layers)if(r.name===t)return r;throw new W(`No such layer: ${t}`)}findLayer(t){if(this.layers.length<=t)throw new W(`Was asked to retrieve layer at index ${t}, but model only has ${this.layers.length} layer(s).`);return this.layers[t]}calculateLosses(){return Z(()=>{const t=[];for(const n of this.layers)for(let r=0;r<n.inboundNodes.length;++r){const i=sa.nodeKey(n,r);this.containerNodes.has(i)&&t.push(...n.calculateLosses())}return t})}getConfig(){const t={name:this.name},n=this.buildNodeConversionMap(this.layers),r=[];for(const o of this.layers){const a=o.getClassName(),u=o.getConfig(),l=[];for(let f=0;f<o.inboundNodes.length;f++){const h=o.inboundNodes[f],d=sa.nodeKey(o,f);let p={};if(this.containerNodes.has(d)){if(h.callArgs)try{JSON.stringify(h.callArgs),p=h.callArgs}catch{console.warn(`Layer ${o.name} was passed non-serializable keyword arguments: ${h.callArgs}. They will not be included in the serialized model (and thus will be missing at deserialization time).`),p={}}if(h.inboundLayers.length>0){const g=[];for(let m=0;m<h.inboundLayers.length;m++){const y=h.inboundLayers[m],b=h.nodeIndices[m],v=h.tensorIndices[m],x=sa.nodeKey(y,b);let w=n[x];w==null&&(w=0),g.push([y.name,w,v,p])}l.push(g)}}}const c={};c.name=o.name,c.className=a,c.config=u,c.inboundNodes=l,r.push(c)}t.layers=r;const i=[];for(let o=0;o<this.inputLayers.length;o++){const a=this.inputLayers[o],u=this.inputLayersNodeIndices[o],l=sa.nodeKey(a,u);if(!this.containerNodes.has(l))continue;let c=n[l];c==null&&(c=0);const f=this.inputLayersTensorIndices[o];i.push([a.name,c,f])}t.inputLayers=i;const s=[];for(let o=0;o<this.outputLayers.length;o++){const a=this.outputLayers[o],u=this.outputLayersNodeIndices[o],l=sa.nodeKey(a,u);if(!this.containerNodes.has(l))continue;let c=n[l];c==null&&(c=0);const f=this.outputLayersTensorIndices[o];s.push([a.name,c,f])}return t.outputLayers=s,t}static fromConfig(t,n,r={},i=!1){const s={},o={};function a(m,y){m.name in o?o[m.name].push(y):o[m.name]=[y]}function u(m,y){const b=[];let v;for(const x of y){const w=x[0],C=x[1],$=x[2];if(v=x[3]==null?{}:x[3],!(w in s)){a(m,y);return}const S=s[w];if(S.inboundNodes.length<=C){a(m,y);return}const k=S.inboundNodes[C];b.push(k.outputTensors[$])}b.length>0&&m.apply(Pi(b),v)}function l(m){const y=m.name,b=Ql(m,n.customObjects!=null?n.customObjects:{});b.setFastWeightInitDuringBuild(i),s[y]=b,m.inboundNodes.forEach(x=>{if(!(x instanceof Array))throw new W(`Corrupted configuration, expected array for nodeData: ${x}`);a(b,x)})}const c=n.name,f=n.layers;for(const m of f)l(m);for(;!bNe(o);)for(const m of f){const y=s[m.name];if(y.name in o){const b=o[y.name];delete o[y.name];for(const v of b)u(y,v)}}const h=[],d=[],p=n.inputLayers;for(const m of p){const y=m[0],b=m[1],v=m[2];au(y in s);const w=s[y].inboundNodes[b].outputTensors;h.push(w[v])}const g=n.outputLayers;for(const m of g){const y=m[0],b=m[1],v=m[2];au(y in s);const w=s[y].inboundNodes[b].outputTensors;d.push(w[v])}return new t({inputs:h,outputs:d,name:c})}get stateful(){if(this._stateful)throw new W("Container instance unexpectedly has _stateful = true. The statefulness of a Container is determined by the Layers it contains. Its _stateful property must remain the default false.");for(const t of this.layers)if(t.stateful)return!0;return!1}resetStates(){Z(()=>{this.layers.forEach(t=>{t.stateful&&t.resetStates()})})}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function NFe(e,t,n){const r=t.length;if(e==null||Array.isArray(e)&&e.length===0)return t.map(i=>null);if(r===1)return Array.isArray(e)&&e.length===1?e:typeof e=="object"&&t[0]in e?[e[t[0]]]:[e];if(Array.isArray(e)){if(e.length!==r)throw new Error(`Provided ${n} is an array of ${e.length} element(s), but the model has ${r} outputs. Make sure a set of weights is provided for each model output.`);return e}else if(typeof e=="object"&&Object.keys(e).length>0&&typeof e[Object.keys(e)[0]]=="object"){const i=[];return t.forEach(s=>{s in e?i.push(e[s]):i.push(null)}),i}else throw new Error(`The model has multiple (${r}) outputs, so ${n} must be either an array with ${r} elements or an object with ${t} keys. Provided ${n} not understood: ${JSON.stringify(e)}`)}function Mre(e,t){return NFe(e,t,"classWeight")}async function Lre(e,t,n,r){if(t!=null||r!=null)throw new Error("Support sampleWeight is not implemented yet");if(n!=null){const i=Z(()=>{if(e.shape.length===1)return $f(e);if(e.shape.length===2){if(e.shape[1]>1)return Hm(e,1);if(e.shape[1]===1)return V(e,[e.shape[0]]);throw new Error(`Encountered unexpected last-dimension size (${e.shape[1]}) during handling of class weights. The size is expected to be >= 1.`)}else throw new Error(`Unexpected rank of target (y) tensor (${e.rank}) during handling of class weights. The rank is expected to be 1 or 2.`)}),s=Array.from(await i.data());at(i);const o=[];return s.forEach(a=>{if(n[a]==null)throw new Error(`classWeight must contain all classes in the training data. The class ${a} exists in the data but not in classWeight`);o.push(n[a])}),mi(o,"float32")}else return null}function FFe(e,t){return j(e,t)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const OFe=32;function Pre(e,t){let n,r;const i=t;n=i.xs,r=i.ys,N(n!=null&&r!=null,()=>`A Dataset iterator for fitDataset() is expected to generate objects of the form \`{xs: xVal, ys: yVal}\`, where the two values may be \`tf.Tensor\`, an array of Tensors, or a map of string to Tensor.  The provided Dataset instead generates ${t}`);const s=YV("input",e.inputNames,n),o=YV("output",e.outputNames,r),a=s[0].shape[0];N(s.length===e.inputs.length,()=>`LayersModel has ${e.inputs.length} inputs, but the dataset provides ${s.length} inputs.  (Expected input keys: ${JSON.stringify(e.inputNames)})`),N(o.length===e.outputs.length,()=>`LayersModel has ${e.outputs.length} outputs, but the dataset provides ${o.length} outputs.  (Expected output keys: ${JSON.stringify(e.outputNames)})`);for(let u=0;u<s.length;u++)N(s[u].shape[0]===a,()=>`Batch size mismatch: input ${e.inputNames[u]} has ${s[u].shape[0]}; expected  ${a} based on input ${e.inputNames[0]}.`);for(let u=0;u<o.length;u++)N(o[u].shape[0]===a,()=>`Batch size mismatch: output ${e.outputNames[u]} has ${o[u].shape[0]}; expected  ${a} based on input ${e.inputNames[0]}.`);return{xs:s,ys:o}}function YV(e,t,n){if(n instanceof Pt)return[n];if(Array.isArray(n))return N(n.length===t.length,()=>`Received an array of ${n.length} Tensors, but expected ${t.length} to match the ${e} keys ${t}.`),n;{const r=[];for(const i of t){if(n[i]==null)throw new W(`The feature data generated by the dataset lacks the required ${e} key '${i}'.`);r.push(n[i])}return r}}function RFe(e){if(e.length===3)throw new tt("Validation with sample weights is not implemented yet.");return{xs:e[0],ys:e[1]}}async function MFe(e,t,n){const r=n.batchesPerEpoch!=null;if(N(e.optimizer!=null,()=>"You must compile a model before training/testing. Use LayersModel.compile(modelCompileConfig)."),N(n!=null,()=>"For fitDataset(), the 2nd argument (config) is required, but it is not provided in this call."),N(n.epochs!=null&&n.epochs>0&&Number.isInteger(n.epochs),()=>`For fitDataset(), config.epochs is expected to be a positive integer, but got ${n.epochs}`),N(!r||n.batchesPerEpoch>0&&Number.isInteger(n.batchesPerEpoch),()=>`For fitDataset(), config.batchesPerEpoch is expected to be a positive integer if specified, but got ${n.batchesPerEpoch}`),N(n.validationSplit==null,()=>"`validationSplit` is not supported by `fitDataset()`. Use validationData instead."),e.isTraining)throw new Error("Cannot start training because another fit() call is ongoing.");e.isTraining=!0;try{const i=n.validationData!=null;let s,o;if(i)if(KV(n.validationData))N(n.validationBatches==null||n.validationBatches>0&&Number.isInteger(n.validationBatches),()=>`For fitDataset() with dataset-based validation, config.validationBatches is expected not to be provided, or to be a positive integer, but got ${n.validationBatches}`);else{const m=RFe(n.validationData);s=m.xs,o=m.ys}const a=e.makeTrainFunction(),u=e.getDedupedMetricsNames();let l;i?l=u.slice().concat(u.map(m=>"val_"+m)):l=u.slice();const c=_re(n.callbacks,n.yieldEvery),f=n.verbose==null?1:n.verbose,{callbackList:h,history:d}=Are(c,f,n.epochs,null,null,LFe(t,n),null,i,l);h.setModel(e),e.history=d,await h.onTrainBegin(),e.stopTraining_=!1;let p=n.initialEpoch==null?0:n.initialEpoch,g=await t.iterator();for(;p<n.epochs;){const m={};await h.onEpochBegin(p);let y=0,b=0;for(r||(g=await t.iterator());!r||y<n.batchesPerEpoch;){const v=await g.next();if(r&&v.done){console.warn(`You provided \`batchesPerEpoch\` as ${n.batchesPerEpoch}, but your dataset iterator ran out of data after ${y} batches; interrupting training. Make sure that your dataset can generate at least \`batchesPerEpoch * epochs\` batches (in this case, ${n.batchesPerEpoch*n.epochs} batches). You may need to use the repeat() function when building your dataset.`);break}if(v.value!=null){const{xs:x,ys:w}=Pre(e,v.value),C={};C.batch=b,C.size=x[0].shape[0],await h.onBatchBegin(b,C);const $=[];if(n.classWeight!=null){const E=Mre(n.classWeight,e.outputNames);for(let _=0;_<E.length;++_)$.push(await Lre(w[_],null,E[_]))}const S=x.concat(w).concat($),k=a(S);at(S);for(let E=0;E<u.length;++E){const _=u[E],D=k[E];C[_]=D,Ca(D)}await h.onBatchEnd(b,C),Ere(C),b++,y++}if(r?y>=n.batchesPerEpoch:v.done){if(i){let x;KV(n.validationData)?x=sn(await e.evaluateDataset(n.validationData,{batches:n.validationBatches})):x=sn(e.evaluate(s,o,{batchSize:n.validationBatchSize==null?OFe:n.validationBatchSize,verbose:0}));for(let w=0;w<e.metricsNames.length;++w)m[`val_${e.metricsNames[w]}`]=x[w]}break}if(e.stopTraining_)break}if(await h.onEpochEnd(p,m),p++,e.stopTraining_)break}return await h.onTrainEnd(),await e.history.syncData(),e.history}finally{e.isTraining=!1}}function LFe(e,t){let n=null;return t.batchesPerEpoch!=null?n=t.batchesPerEpoch:Number.isFinite(e.size)&&(n=e.size),n}function KV(e){return typeof e.iterator=="function"}function PFe(e){return typeof e.next=="function"}async function BFe(e,t,n){n=n||{};const r=n.batches!=null,i=e.testFunction;let s=[];if(n.verbose>0)throw new tt("Verbose mode is not implemented yet.");N(!r||n.batches>0&&Number.isInteger(n.batches),()=>`Test loop expects \`batches\` to be a positive integer, but received ${JSON.stringify(n.batches)}`);const o=PFe(t)?t:await t.iterator();let a=0,u=0;for(;!r||u<n.batches;){const l=await o.next();if(s=Z(()=>{if(l.value){const{xs:c,ys:f}=Pre(e,l.value),h=c.concat(f),d=Z(()=>i(h));if(at(h),u===0)for(let g=0;g<d.length;++g)s.push(qe(0));const p=h[0].shape[0];for(let g=0;g<d.length;++g){const m=d[g],y=s[g];s[g]=Z(()=>ce(s[g],j(p,m))),u>0&&at(y)}at(d),a+=p,++u}return s}),l.done){r&&console.warn(`Your dataset iterator ran out of data during evaluateDataset(). Interrupting evalution. Make sure that your dataset can generate at least \`batches\` batches (in this case, ${n.batches} batches). You may need to use the repeat() function when building your dataset.`);break}}for(let l=0;l<s.length;++l){const c=s[l];s[l]=Re(s[l],a),at(c)}return Pi(s)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function a3(e){N(e>0&&Number.isInteger(e),()=>`batchSize is required to be a positive integer, but got ${e}`)}function jy(e,t,n){return e==null?[null]:Array.isArray(e)?e.map(r=>Qd(r,t,n-t)):Qd(e,t,n-t)}function hM(e,t){return Z(()=>e==null?null:Array.isArray(e)?e.map(n=>hM(n,t)):hre(e,t.dtype==="int32"?t:we(t,"int32")))}function u3(e,t){const n=[];let r=0,i=null;for(;r<e;)i=r+t,i>=e&&(i=e),n.push([r,i]),r=i;return n}function Bre(e){const t=[];e instanceof Pt&&(e=[e]);for(let n=0;n<e.length;++n){const r=e[n];if(r.rank===1)t.push(jw(r,1));else{if(r.rank===0)throw new Error("Expected tensor to be at least 1D, but received a 0D tensor (scalar).");t.push(r)}}return t}function ea(e,t){if(e==null)return;const n=[];if(t instanceof Pt)n.push(t.id);else if(Array.isArray(t))t.forEach(i=>n.push(i.id));else if(t!=null)for(const i in t){const s=t[i];n.push(s.id)}const r=[];if(e instanceof Pt)n.indexOf(e.id)===-1&&r.push(e);else if(Array.isArray(e))e.forEach(i=>{n.indexOf(i.id)===-1&&r.push(i)});else if(e!=null)for(const i in e){const s=e[i];n.indexOf(s.id)===-1&&r.push(s)}r.forEach(i=>{i.isDisposed||i.dispose()})}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function zFe(e){return e instanceof Pt}function dM(e){return Array.isArray(e)}function ZV(e){return!zFe(e)&&!dM(e)}function JV(e,t,n,r=!0,i=""){if(t==null||t.length===0){if(e!=null){let o=!1;if(dM(e)&&e.length>0)o=!0;else if(ZV(e)){for(const a in e)if(e.hasOwnProperty(a)){o=!0;break}}else o=!0;if(o)throw new W(`Error when checking model ${i} expected no data, but got ${e}`)}return[]}if(e==null)return t.map(o=>null);let s;if(ZV(e)){e=e,s=[];for(const o of t){if(e[o]==null)throw new W(`No data provided for "${o}". Need data for each key in: ${t}`);s.push(e[o])}}else if(dM(e)){if(e=e,e.length!==t.length)throw new W(`Error when checking model ${i}: the Array of Tensors that you are passing to your model is not the size the model expected. Expected to see ${t.length} Tensor(s), but instead got the following list of Tensor(s): ${e}`);s=e}else{if(e=e,t.length>1)throw new W(`The model ${i} expects ${t.length} Tensor(s), but only received one Tensor. Found: Tensor with shape ${e.shape}`);s=[e]}if(s=Bre(s),n!=null)for(let o=0;o<t.length;++o){if(n[o]==null)continue;const a=s[o];if(a.shape.length!==n[o].length)throw new W(`Error when checking ${i}: expected ${t[o]} to have ${n[o].length} dimension(s). but got array with shape ${a.shape}`);for(let u=0;u<n[o].length;++u){if(u===0&&!r)continue;const l=a.shape[u],c=n[o][u];if(c!=null&&c>=0&&l!==c)throw new W(`${i} expected a batch of elements where each example has shape [${n[o].slice(1,n[o].length)}] (i.e.,tensor shape [*,${n[o].slice(1,n[o].length)}]) but the ${i} received an input with ${a.shape[0]} examples, each with shape [${a.shape.slice(1,a.shape.length)}] (tensor shape [${a.shape}])`)}}return s}function UFe(e,t,n){const r=Cf(e.map(s=>s.shape[0]));r.sort();const i=Cf(t.map(s=>s.shape[0]));if(i.sort(),r.length>1)throw new W(`All input Tensors (x) should have the same number of samples. Got array shapes: ${JSON.stringify(e.map(s=>s.shape))}`);if(i.length>1)throw new W(`All target Tensors (y) should have the same number of samples. Got array shapes: ${JSON.stringify(t.map(s=>s.shape))}`);if(r.length>0&&i.length>0&&!bt(r,i))throw new W(`Input Tensors should have the same number of samples as target Tensors. Found ${r[0]} input sample(s) and ${i[0]} target sample(s).`)}function jFe(e,t,n){const r=[wI,$I,Jx];for(let i=0;i<e.length;++i){const s=e[i],o=t[i],a=n[i];if(o!=null){if(o===Jx&&s.shape[s.shape.length-1]===1)throw new W(`You are passing a target array of shape ${s.shape} while using a loss 'categorical_crossentropy'. 'categorical_crossentropy'expects targets to be binary matrices (1s and 0s) of shape [samples, classes].`);if(r.indexOf(o)!==-1){const u=s.shape.slice(1),l=a.slice(1);for(let c=0;c<u.length;++c){const f=u[c],h=l[c];if(h!=null&&f!==h)throw new W(`A target Tensor with shape ${s.shape} was passed for an output of shape ${a}, while using a loss function that expects targets to have the same shape as the output.`)}}}}}function QV(e,t,n,r=!0,i=""){let s;if(Array.isArray(e)){if(e.length!==t.length)throw new W(`Error when checking model ${i}: the Array of Tensors that you are passing to your model is not the size the the model expected. Expected to see ${t.length} Tensor(s), but instead got ${e.length} Tensors(s).`);s=e}else{if(t.length>1)throw new W(`The model expects ${t.length} ${i} Tensors, but only received one Tensor. Found: array with shape ${JSON.stringify(e.shape)}.`);s=[e]}if(n!=null)for(let o=0;o<t.length;++o){if(n[o]==null)continue;const a=s[o];if(a.shape.length!==n[o].length)throw new W(`Error when checking ${i}: expected ${t[o]} to have ${n[o].length} dimension(s), but got array with shape ${JSON.stringify(a.shape)}`);for(let u=0;u<n[o].length;++u){if(u===0&&!r)continue;const l=a.shape[u],c=n[o][u];if(c!=null&&c!==l)throw new W(`Error when checking ${i}: expected ${t[o]} to have shape ${JSON.stringify(n[o])} but got array with shape ${JSON.stringify(a.shape)}.`)}}}function WFe(e,t){if(e==null||Array.isArray(e)&&e.length===0)return t.map(r=>[]);let n;if(typeof e=="string"||typeof e=="function")n=[e];else if(Array.isArray(e)||typeof e=="object")n=e;else throw new TypeError(`Type of metrics argument not understood. Expected an string,function, Array, or Object, found: ${e}`);if(Array.isArray(n))return t.map(r=>n);{const r=[];for(const i of t){let s=n.hasOwnProperty(i)?n[i]:[];Array.isArray(s)||(s=[s]),r.push(s)}return r}}const VFe="layers-model";class Am extends sa{constructor(t){super(t),this.isTraining=!1}summary(t,n,r=console.log){if(!this.built)throw new W("This model has never been called, thus its weights have not been created yet. So no summary can be displayed. Build the model first (e.g., by calling it on some test data).");_Fe(this,t,n,r)}compile(t){if(t.loss==null&&(t.loss=[]),this.loss=t.loss,typeof t.optimizer=="string")this.optimizer_=EFe(t.optimizer),this.isOptimizerOwned=!0;else{if(!(t.optimizer instanceof Sc))throw new W("User-defined optimizer must be an instance of tf.Optimizer.");this.optimizer_=t.optimizer,this.isOptimizerOwned=!1}let n=[];if(!Array.isArray(t.loss)&&typeof t.loss!="string"&&typeof t.loss!="function"){t.loss=t.loss;for(const o in t.loss)if(this.outputNames.indexOf(o)===-1)throw new W(`Unknown entry in loss dictionary: "${o}". Only expected the following keys: ${this.outputNames}`);for(const o of this.outputNames)t.loss[o]==null&&console.warn(`Output "${o}" is missing from loss dictionary. We assume this was done on purpose, and we will not be expecting data to be passed to ${o} during training`),n.push(o3(t.loss[o]))}else if(Array.isArray(t.loss)){if(t.loss.length!==this.outputs.length)throw new W(`When passing an Array as loss, it should have one entry per model output. The model has ${this.outputs.length} output(s), but you passed loss=${t.loss}.`);n=t.loss.map(a=>o3(a))}else{const o=o3(t.loss);this.outputs.forEach(a=>{n.push(o)})}this.lossFunctions=n,this.feedOutputNames=[],this.feedOutputShapes=[],this.feedLossFns=[];for(let o=0;o<this.outputs.length;++o){const a=this.internalOutputShapes[o],u=this.outputNames[o];this.feedOutputNames.push(u),this.feedOutputShapes.push(a),this.feedLossFns.push(this.lossFunctions[o])}const r=[];this.metrics=t.metrics,this.metricsNames=["loss"],this.metricsTensors=[],Jd("loss",()=>{for(let o=0;o<this.outputs.length;++o){if(r.indexOf(o)!==-1)continue;const a=this.lossFunctions[o];this.outputs.length>1&&(this.metricsTensors.push([a,o]),this.metricsNames.push(this.outputNames[o]+"_loss"))}});const i=WFe(t.metrics,this.outputNames),s=(o,a,u)=>{this.outputNames.length>1&&(a=this.outputNames[o]+"_"+a),this.metricsNames.push(a),this.metricsTensors.push([u,o])};Jd("metric",()=>{for(let o=0;o<this.outputs.length;++o){if(r.indexOf(o)!==-1)continue;const a=i[o];(l=>{const c="";let f,h,d;for(const p of l){if(typeof p=="string"&&["accuracy","acc","crossentropy","ce"].indexOf(p)!==-1){const m=this.internalOutputShapes[o];m[m.length-1]===1||this.lossFunctions[o]===$I?["accuracy","acc"].indexOf(p)!==-1?h=Ire:["crossentropy","ce"].indexOf(p)!==-1&&(h=mFe):this.lossFunctions[o]===Gk?["accuracy","acc"].indexOf(p)!==-1?h=yFe:["crossentropy","ce"].indexOf(p)!==-1&&(h=Fre):["accuracy","acc"].indexOf(p)!==-1?h=Dre:["crossentropy","ce"].indexOf(p)!==-1&&(h=Nre);let y;["accuracy","acc"].indexOf(p)!==-1?y="acc":["crossentropy","ce"].indexOf(p)!==-1&&(y="ce"),d=h,f=c+y}else d=kFe(p),f=c+TC(p);let g;Jd(f,()=>{g=d}),s(o,f,g)}})(a)}}),this.collectedTrainableWeights=this.trainableWeights}checkTrainableWeightsConsistency(){this.collectedTrainableWeights!=null&&this.trainableWeights.length!==this.collectedTrainableWeights.length&&console.warn("Discrepancy between trainableweights and collected trainable weights. Did you set `model.trainable` without calling `model.compile()` afterwards?")}evaluate(t,n,r={}){const i=r.batchSize==null?32:r.batchSize;a3(i);const s=!0,o=this.standardizeUserDataXY(t,n,s,i);try{const a=o[0].concat(o[1]);this.makeTestFunction();const u=this.testFunction,l=this.testLoop(u,a,i,r.verbose,r.steps);return Pi(l)}finally{ea(o[0],t),ea(o[1],n)}}async evaluateDataset(t,n){return this.makeTestFunction(),BFe(this,t,n)}checkNumSamples(t,n,r,i="steps"){let s;if(r!=null){if(s=null,n!=null)throw new W(`If ${i} is set, batchSize must be null or undefined.Got batchSize = ${n}`)}else if(t!=null)Array.isArray(t)?s=t[0].shape[0]:s=t.shape[0];else throw new W(`Either the input data should have a defined shape, or ${i} shoud be specified.`);return s}execute(t,n){if(Array.isArray(n)&&n.length===0)throw new W("`outputs` is an empty Array, which is not allowed.");const r=Array.isArray(n),i=r?n:[n],s=this.retrieveSymbolicTensors(i),o=new rf;if(t instanceof Pt&&(t=[t]),Array.isArray(t)){if(t.length!==this.inputs.length)throw new W(`The number of inputs provided (${t.length}) does not match the number of inputs of this model (${this.inputs.length}).`);for(let u=0;u<this.inputs.length;++u)o.add(this.inputs[u],t[u])}else for(const u of this.inputs){const l=t[u.name];if(l==null)throw new W(`No value is provided for the model's input ${u.name}`);o.add(u,l)}const a=Tb(s,o);return r?a:a[0]}retrieveSymbolicTensors(t){const n=vp(null,t.length);let r=t.length;for(const i of this.layers){const s=Array.isArray(i.output)?i.output:[i.output],o=s.map(a=>a.name);for(let a=0;a<t.length;++a){const u=o.indexOf(t[a]);if(u!==-1&&(n[a]=s[u],r--),r===0)break}if(r===0)break}if(r>0){const i=[];throw n.forEach((s,o)=>{s==null&&i.push(t[o])}),new W(`Cannot find SymbolicTensors for output name(s): ${JSON.stringify(i)}`)}return n}predictLoop(t,n=32,r=!1){return Z(()=>{const i=this.checkNumSamples(t);if(r)throw new tt("Verbose predictLoop() is not implemented yet.");const s=u3(i,n),o=this.outputs.map(a=>[]);for(let a=0;a<s.length;++a)Z(()=>{const l=s[a][0],c=s[a][1],f=jy(t,l,c),h=[];if(Array.isArray(f))for(let p=0;p<f.length;++p)h.push({key:this.inputs[p],value:f[p]});else h.push({key:this.inputs[0],value:f});const d=new rf(h);return Tb(this.outputs,d)}).forEach((l,c)=>o[c].push(l));return Pi(o.map(a=>lr(a,0)))})}predict(t,n={}){const r=Bre(t);QV(r,this.inputNames,this.feedInputShapes,!1);try{const i=n.batchSize==null?32:n.batchSize;return a3(i),this.predictLoop(r,i)}finally{ea(r,t)}}predictOnBatch(t){QV(t,this.inputNames,this.feedInputShapes,!0);const n=(Array.isArray(t)?t[0]:t).shape[0];return this.predictLoop(t,n)}standardizeUserDataXY(t,n,r=!0,i){if(this.optimizer_==null)throw new ko("You must compile a model before training/testing. Use LayersModel.compile(modelCompileArgs).");const s=[];for(let o=0;o<this.feedOutputShapes.length;++o){const a=this.feedOutputShapes[o];this.feedLossFns[o]===Gk?s.push(a.slice(0,a.length-1).concat([1])):s.push(a)}if(t=JV(t,this.feedInputNames,this.feedInputShapes,!1,"input"),n=JV(n,this.feedOutputNames,s,!1,"target"),UFe(t,n),jFe(n,this.feedLossFns,this.feedOutputShapes),this.stateful&&i!=null&&i>0&&t[0].shape[0]%i!==0)throw new W(`In a stateful network, you should only pass inputs with a number of samples that is divisible by the batch size ${i}. Found: ${t[0].shape[0]} sample(s).`);return[t,n]}async standardizeUserData(t,n,r,i,s=!0,o){const[a,u]=this.standardizeUserDataXY(t,n,s,o);if(r!=null)throw new Error("sample weight is not supported yet.");let l=null;if(i!=null){const c=Mre(i,this.outputNames);l=[];for(let f=0;f<c.length;++f)l.push(await Lre(u[f],null,c[f]))}return[a,u,l]}testLoop(t,n,r,i=0,s){return Z(()=>{const o=this.checkNumSamples(n,r,s,"steps"),a=[];if(i>0)throw new tt("Verbose mode is not implemented yet.");if(s!=null)throw new tt("steps mode in testLoop() is not implemented yet");{const u=u3(o,r),l=mi(Da(0,o));for(let c=0;c<u.length;++c){const f=u[c][0],h=u[c][1],d=Qd(l,f,h-f),p=hM(n,d),g=t(p);if(c===0)for(let m=0;m<g.length;++m)a.push(qe(0));for(let m=0;m<g.length;++m){const y=g[m];a[m]=ce(a[m],j(h-f,y))}}for(let c=0;c<a.length;++c)a[c]=Re(a[c],o)}return a})}getDedupedMetricsNames(){const t=this.metricsNames,n=[];for(let r=0;r<t.length;++r){const i=t[r];let s=i;if(LV(t,i)>1){const o=LV(t.slice(0,r),i);s+=`_${o}`}n.push(s)}return n}makeTrainFunction(){return t=>{const n=[],r=t.slice(0,this.inputs.length),i=t.slice(this.inputs.length,this.inputs.length+this.outputs.length),s=t.slice(this.inputs.length+this.outputs.length,this.inputs.length+this.outputs.length*2),o=[],a=()=>{const f=[];for(let g=0;g<this.inputs.length;++g)f.push({key:this.inputs[g],value:r[g]});const h=new rf(f),d=Tb(this.outputs,h,{training:!0});let p;for(let g=0;g<this.lossFunctions.length;++g){const m=this.lossFunctions[g];let y=m(i[g],d[g]);s[g]!=null&&(y=FFe(y,s[g]));const b=kn(y);n.push(b),g===0?p=y:p=ce(p,y)}for(let g=0;g<this.metricsTensors.length;++g){let m;if(this.outputs.length>1&&g<this.outputs.length)m=n[g];else{const y=this.metricsTensors[g][0],b=this.metricsTensors[g][1];m=kn(y(i[b],d[b]))}Ca(m),o.push(m)}return p=kn(p),this.calculateLosses().forEach(g=>{p=ce(p,g)}),p},u=this.collectedTrainableWeights.map(f=>f.read()),l=!0;return[this.optimizer_.minimize(a,l,u)].concat(o)}}makeTestFunction(){this.testFunction=t=>Z(()=>{const n=[];let r;const i=t.slice(0,this.inputs.length),s=t.slice(this.inputs.length,this.inputs.length+this.outputs.length),o=[];for(let l=0;l<this.inputs.length;++l)o.push({key:this.inputs[l],value:i[l]});const a=new rf(o),u=Tb(this.outputs,a);for(let l=0;l<this.lossFunctions.length;++l){const c=this.lossFunctions[l],f=kn(c(s[l],u[l]));l===0?r=f:r=ce(r,f),n.push(r)}for(let l=0;l<this.metricsTensors.length;++l){const c=this.metricsTensors[l][0],f=this.metricsTensors[l][1],h=kn(c(s[f],u[f]));n.push(h)}return n})}async fit(t,n,r={}){if(this.isTraining)throw new Error("Cannot start training because another fit() call is ongoing.");this.isTraining=!0;let i,s,o,a,u,l,c,f,h;try{const d=r.batchSize==null?32:r.batchSize;a3(d);const p=!1,g=await this.standardizeUserData(t,n,r.sampleWeight,r.classWeight,p,d);i=g[0],s=g[1],h=g[2];let m=!1,y;if(r.validationData!=null&&r.validationData.length>0){if(m=!0,r.validationData.length===2)u=r.validationData[0],l=r.validationData[1];else throw r.validationData.length===3?new tt("validationData including sample weights is not supported yet."):new W(`When passing validation data, it must contain 2 (valX, valY) or 3 (valX, valY, valSampleWeight) items; ${r.validationData} is invalid.`);const k=!0,E=await this.standardizeUserData(u,l,null,null,k,d);c=E[0],f=E[1],y=c.concat(f)}else if(r.validationSplit!=null&&r.validationSplit>0&&r.validationSplit<1){m=!0;const k=Math.floor(i[0].shape[0]*(1-r.validationSplit)),E=i[0].shape[0];c=jy(i,k,E),o=i,i=jy(i,0,k),f=jy(s,k,E),a=s,s=jy(s,0,k),y=c.concat(f)}else r.validationSteps!=null&&(m=!0);const b=i.concat(s).concat(h);this.checkTrainableWeightsConsistency();const v=this.makeTrainFunction(),x=this.getDedupedMetricsNames();let w,C;m?(this.makeTestFunction(),w=this.testFunction,C=x.slice().concat(x.map(k=>"val_"+k))):(w=null,y=[],C=x.slice());const $=_re(r.callbacks,r.yieldEvery);return await this.fitLoop(v,b,x,d,r.epochs,r.verbose,$,w,y,r.shuffle,C,r.initialEpoch,null,null)}finally{this.isTraining=!1,ea(i,t),ea(s,n),ea(o,t),ea(a,n),ea(c,u),ea(f,l),h!=null&&at(h)}}async fitLoop(t,n,r,i,s,o,a,u,l,c,f,h,d,p){i==null&&(i=32),s==null&&(s=1),c==null&&(c=!0),h==null&&(h=0);let g=!1;if(u!=null&&l!=null&&(g=!0),p!=null&&(g=!0,d==null))throw new W("Can only use `validationSteps` when doing step-wise training, i.e., `stepsPerEpoch` must be set.");const m=this.checkNumSamples(n,i,d,"steps_per_epoch");let y;m!=null&&(y=Da(0,m)),o==null&&(o=1);const{callbackList:b,history:v}=Are(a,o,s,h,m,d,i,g,f);b.setModel(this),this.history=v,await b.onTrainBegin(),this.stopTraining_=!1;for(let x=h;x<s;++x){await b.onEpochBegin(x);const w={};if(d!=null)throw new tt("stepsPerEpoch mode is not implemented yet.");{if(c==="batch")throw new tt("batch shuffling is not implemneted yet");c&&ZP(y);const C=mi(y),$=u3(m,i);for(let S=0;S<$.length;++S){const k={};if(await b.onBatchBegin(S,k),Z(()=>{const E=$[S][0],_=$[S][1],D=Qd(C,E,_-E);k.batch=S,k.size=_-E;const A=hM(n,D),T=t(A);for(let I=0;I<r.length;++I){const F=r[I],R=T[I];k[F]=R,Ca(R)}if(S===$.length-1&&g){const I=this.testLoop(u,l,i);for(let F=0;F<r.length;++F){const R=r[F],L=I[F];Ca(L),w["val_"+R]=L}}}),await b.onBatchEnd(S,k),Ere(k),this.stopTraining_)break}C.dispose()}if(await b.onEpochEnd(x,w),this.stopTraining_)break}return await b.onTrainEnd(),await this.history.syncData(),this.history}async fitDataset(t,n){return MFe(this,t,n)}async trainOnBatch(t,n){const r=await this.standardizeUserData(t,n),i=r[0],s=r[1],a=this.makeTrainFunction()(i.concat(s)),u=[];for(const l of a){const c=await l.data();u.push(c[0])}return at(a),ea(r[0],t),ea(r[1],n),Pi(u)}getNamedWeights(t){const n=[],r=t!=null&&t.trainableOnly,i=r?this.trainableWeights:this.weights,s=this.getWeights(r);for(let o=0;o<i.length;++o)r&&!i[o].trainable||n.push({name:i[o].originalName,tensor:s[o]});return n}set stopTraining(t){this.stopTraining_=t}get stopTraining(){return this.stopTraining_}get optimizer(){return this.optimizer_}set optimizer(t){this.optimizer_!==t&&(this.optimizer_=t,this.isOptimizerOwned=!1)}dispose(){const t=super.dispose();if(t.refCountAfterDispose===0&&this.optimizer!=null&&this.isOptimizerOwned){const n=Lk().numTensors;this.optimizer_.dispose(),t.numDisposedVariables+=n-Lk().numTensors}return t}getLossIdentifiers(){let t;if(typeof this.loss=="string")t=Al(this.loss);else if(Array.isArray(this.loss)){for(const n of this.loss)if(typeof n!="string")throw new Error("Serialization of non-string loss is not supported.");t=this.loss.map(n=>Al(n))}else{const n=Object.keys(this.loss);t={};const r=this.loss;for(const i of n)if(typeof r[i]=="string")t[i]=Al(r[i]);else throw new Error("Serialization of non-string loss is not supported.")}return t}getMetricIdentifiers(){if(typeof this.metrics=="string"||typeof this.metrics=="function")return[Al(TC(this.metrics))];if(Array.isArray(this.metrics))return this.metrics.map(t=>Al(TC(t)));{const t={};for(const n in this.metrics)t[n]=Al(TC(this.metrics[n]));return t}}getTrainingConfig(){return{loss:this.getLossIdentifiers(),metrics:this.getMetricIdentifiers(),optimizer_config:{class_name:this.optimizer.getClassName(),config:this.optimizer.getConfig()}}}loadTrainingConfig(t){if(t.weighted_metrics!=null)throw new Error("Loading weight_metrics is not supported yet.");if(t.loss_weights!=null)throw new Error("Loading loss_weights is not supported yet.");if(t.sample_weight_mode!=null)throw new Error("Loading sample_weight_mode is not supported yet.");const n=cM(t.optimizer_config),r=Ql(n);let i;if(typeof t.loss=="string")i=Cd(t.loss);else if(Array.isArray(t.loss))i=t.loss.map(o=>Cd(o));else if(t.loss!=null){i={};for(const o in t.loss)i[o]=Cd(t.loss[o])}let s;if(Array.isArray(t.metrics))s=t.metrics.map(o=>Cd(o));else if(t.metrics!=null){s={};for(const o in t.metrics)s[o]=Cd(t.metrics[o])}this.compile({loss:i,metrics:s,optimizer:r})}async save(t,n){if(typeof t=="string"){const l=Xee(t);if(l.length===0)throw new W(`Cannot find any save handlers for URL '${t}'`);if(l.length>1)throw new W(`Found more than one (${l.length}) save handlers for URL '${t}'`);t=l[0]}if(t.save==null)throw new W("LayersModel.save() cannot proceed because the IOHandler provided does not have the `save` attribute defined.");const r=await HR(this.getNamedWeights(n)),i=!1,s=null,a={modelTopology:this.toJSON(s,i),format:VFe,generatedBy:`TensorFlow.js tfjs-layers v${Rre}`,convertedBy:null};if((n==null?!1:n.includeOptimizer)&&this.optimizer!=null){a.trainingConfig=this.getTrainingConfig();const l="optimizer",{data:c,specs:f}=await HR(await this.optimizer.getWeights(),l);r.specs.push(...f),r.data=Vee([r.data,c])}return this.userDefinedMetadata!=null&&(XV(this.userDefinedMetadata,this.name,!0),a.userDefinedMetadata=this.userDefinedMetadata),a.weightData=r.data,a.weightSpecs=r.specs,t.save(a)}setUserDefinedMetadata(t){XV(t,this.name),this.userDefinedMetadata=t}getUserDefinedMetadata(){return this.userDefinedMetadata}}Am.className="Model";fe(Am);class zre extends Am{}zre.className="Functional";fe(zre);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */let G5=class pM extends Am{constructor(t){if(super({inputs:[],outputs:[]}),t=t||{},this.trainable=!0,this.built=!1,this.name=t.name!=null?t.name:bI("sequential_"),t.layers!=null)for(const n of t.layers)this.add(n)}checkShape(t){if(t.inboundNodes[0].outputTensors[0].shape.some(r=>r<0))throw new W(`Negative dimension size caused by adding layer ${t.name} with input shape [${t.inboundNodes[0].inputTensors[0].shape}]`)}add(t){const n=t instanceof pM||t instanceof Am;let r;if(n){if(r=t,r.outputs.length!==1)throw new W("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");if(r.inputs.length!==1)throw new W("All layers in a Sequential model should have a single input tensor. For multi-input layers, use the functional API.")}if(this.outputs.length===0){if(t.inboundNodes.length===0){if(t.batchInputShape==null)throw new W("The first layer in a Sequential model must get an `inputShape` or `batchInputShape` argument.");const i=qNe({batchShape:t.batchInputShape,dtype:t.dtype,name:t.name+"_input"});t.apply(i)}if(n)this.outputs=r.outputs,this.inputs=r.inputs;else{if(t.inboundNodes.length!==1)throw new W(`A layer added to a Sequential model must not already be connected somewhere else. LayersModel received layer ${t.name} which has ${t.inboundNodes.length} pre-existing inbound connections.`);if(t.inboundNodes[0].outputTensors.length!==1)throw new W("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");this.checkShape(t),this.outputs=[t.inboundNodes[0].outputTensors[0]],this.inputs=wre(this.outputs[0])}this.inboundNodes=[],new vI({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:this.inputs,outputTensors:this.outputs,inputMasks:vp(null,this.inputs.length),outputMasks:[null],inputShapes:this.inputs.map(i=>i.shape),outputShapes:this.outputs[0].shape})}else{const i=t.apply(this.outputs[0]);if(Array.isArray(i))throw new TypeError("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");this.checkShape(t),this.outputs=[i],this.inboundNodes[0].outputTensors=this.outputs,this.inboundNodes[0].outputShapes=[this.outputs[0].shape]}this.layers.push(t),this.built=!1}pop(){if(this.layers.length===0)throw new TypeError("There are no layers in the model.");if(this.layers.pop(),this.layers.length===0)this.outputs=[],this.inboundNodes=[],this.outboundNodes=[];else{const t=this.layers.length-1;this.layers[t].outboundNodes=[],this.outputs=[this.layers[t].output],this.inboundNodes[0].outputTensors=this.outputs,this.inboundNodes[0].outputShapes=[this.outputs[0].shape]}}call(t,n){return this.model==null&&this.build(),this.model.call(t,n)}build(t){if(kt(t),this.inputs.length===0||this.outputs.length===0)throw new TypeError("Sequential model cannot be built: model is empty. Add some layers first.");this.model=new Am({inputs:this.inputs,outputs:this.outputs[0],name:this.name+"_model"}),this.model.trainable=this.trainable,this.supportsMasking=this.model.supportsMasking,this.inputLayers=this.model.inputLayers,this.inputLayersNodeIndices=this.model.inputLayersNodeIndices,this.inputLayersTensorIndices=this.model.inputLayersTensorIndices,this.outputLayers=this.model.outputLayers,this.outputLayersNodeIndices=this.model.outputLayersNodeIndices,this.outputLayersTensorIndices=this.model.outputLayersTensorIndices,this.nodesByDepth=this.model.nodesByDepth,this.containerNodes=this.model.containerNodes,this.outputNames=this.model.outputNames,this.inputNames=this.model.inputNames,this.built=!0}countParams(){return this.built||this.build(),super.countParams()}summary(t,n,r=console.log){this.built||this.build(),super.summary(t,n,r)}setWeights(t){this.model==null&&this.build(),this.model.setWeights(t)}evaluate(t,n,r={}){if(!this.built)throw new ko("The model needs to be compiled before being used.");return this.model.evaluate(t,n,r)}async evaluateDataset(t,n){if(!this.built)throw new ko("The model needs to be compiled before being used.");return this.model.evaluateDataset(t,n)}predict(t,n={}){return this.model==null&&this.build(),this.model.predict(t,n)}predictOnBatch(t){return this.model==null&&this.build(),this.model.predictOnBatch(t)}compile(t){this.build(),this.model.compile(t),this.optimizer_=this.model.optimizer,this.isOptimizerOwned=this.model.isOptimizerOwned,this.loss=this.model.loss,this.metrics=this.model.metrics,this.metricsTensors=this.model.metricsTensors,this.metricsNames=this.model.metricsNames}get optimizer(){return this.model==null?void 0:this.model.optimizer}set optimizer(t){this.model.optimizer=t}async fit(t,n,r={}){if(!this.built)throw new ko("The model needs to be compiled before being used.");return this.model.fit(t,n,r)}async fitDataset(t,n){if(!this.built)throw new ko("The model needs to be compiled before being used.");return this.model.fitDataset(t,n)}async trainOnBatch(t,n){return this.model.trainOnBatch(t,n)}static fromConfig(t,n,r={},i=!1){let s,o={};if(n instanceof Array){if(n[0].className==null||n[0].className==="Merge")throw new W("Legacy serialization format not supported yet.");s=n}else N(n.layers!=null,()=>"When the config data for a Sequential model is not an Array, it must be an Object that contains the 'layers' field."),s=n.layers,delete n.layers,o=n;const a=new t(o);if(!(a instanceof pM))throw new tt(`Sequential.fromConfig called on non-Sequential input: ${a}`);for(const u of s){const c=Ql(u,void 0,i);i&&c.setFastWeightInitDuringBuild(!0),a.add(c)}return a}set stopTraining(t){if(this.model==null)throw new W("Cannot set the stopTraining property of a sequential model before it is compiled.");this.model.stopTraining=t}get stopTraining(){if(this.model==null)throw new W("Cannot get the stopTraining property of a sequential model before it is compiled.");return this.model.stopTraining}getConfig(){const t=[];for(const n of this.layers){const r={};r.className=n.getClassName(),r.config=n.getConfig(),t.push(r)}return{name:this.name,layers:t}}};G5.className="Sequential";fe(G5);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function IC(e){return new G5(e)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */let ts=class extends lg{getConfig(){return{}}};class Ure extends ts{apply(t,n=1){return FNe(t,n)}}Ure.className="elu";fe(Ure);class jre extends ts{apply(t){return PB(t)}}jre.className="selu";fe(jre);class Wre extends ts{apply(t){return Zu(t)}}Wre.className="relu";fe(Wre);class Vre extends ts{apply(t){return Z(()=>bp(6,Zu(t)))}}Vre.className="relu6";fe(Vre);let Gre=class extends ts{apply(t){return t}};Gre.className="linear";fe(Gre);class Hre extends ts{apply(t){return $u(t)}}Hre.className="sigmoid";fe(Hre);class qre extends ts{apply(t){return RNe(t)}}qre.className="hardSigmoid";fe(qre);class Xre extends ts{apply(t){return j1(t)}}Xre.className="softplus";fe(Xre);class Yre extends ts{apply(t){return ONe(t)}}Yre.className="softsign";fe(Yre);class Kre extends ts{apply(t){return qm(t)}}Kre.className="tanh";fe(Kre);let H5=class extends ts{apply(t,n=-1){return eI(t,n)}};H5.className="softmax";fe(H5);class Zre extends ts{apply(t,n=-1){return wB(t,n)}}Zre.className="logSoftmax";fe(Zre);class Jre extends ts{apply(t,n=1){return Z(()=>j($u(j(t,n)),t))}}Jre.className="swish";fe(Jre);class Qre extends ts{apply(t){return Z(()=>j(t,qm(j1(t))))}}Qre.className="mish";fe(Qre);function Uf(e){return e.getClassName()}function l3(e,t={}){return Uw(e,qs.getMap().classNameMap,t,"activation")}function jf(e){if(e==null){const t={};return t.className="linear",t.config={},l3(t)}if(typeof e=="string"){const t={};return t.className=e,t.config={},l3(t)}else return e instanceof ts?e:l3(e)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function GFe(e){if(e!=null&&typeof e!="object")throw new Error(`Argument to L1L2 regularizer's constructor is expected to be an object, but received: ${e}`)}class eie extends lg{}class tie extends eie{constructor(t){super(),GFe(t),this.l1=t==null||t.l1==null?.01:t.l1,this.l2=t==null||t.l2==null?.01:t.l2,this.hasL1=this.l1!==0,this.hasL2=this.l2!==0}apply(t){return Z(()=>{let n=Hn([1]);return this.hasL1&&(n=ce(n,Ae(j(this.l1,Gn(t))))),this.hasL2&&(n=ce(n,Ae(j(this.l2,Ww(t))))),V(n,[])})}getConfig(){return{l1:this.l1,l2:this.l2}}static fromConfig(t,n){return new t({l1:n.l1,l2:n.l2})}}tie.className="L1L2";fe(tie);const eG={l1l2:"L1L2"};function Yt(e){return D5(e)}function tG(e,t={}){return Uw(e,qs.getMap().classNameMap,t,"regularizer")}function gn(e){if(e==null)return null;if(typeof e=="string"){const n={className:e in eG?eG[e]:e,config:{}};return tG(n)}else return e instanceof eie?e:tG(e)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class nie extends ut{constructor(t){super(t??{}),this.supportsMasking=!0,t!=null&&(this.maxValue=t.maxValue)}call(t,n){t=Ge(t);let r=Zu(t);return this.maxValue!=null&&(r=_s(r,0,this.maxValue)),r}computeOutputShape(t){return t}getConfig(){const t={maxValue:this.maxValue},n=super.getConfig();return Object.assign(t,n),t}}nie.className="ReLU";fe(nie);class rie extends ut{constructor(t){super(t??{}),this.DEFAULT_ALPHA=.3,t==null&&(t={}),this.alpha=t.alpha==null?this.DEFAULT_ALPHA:t.alpha}call(t,n){const r=Ge(t);return WT(r,this.alpha)}computeOutputShape(t){return t}getConfig(){const t={alpha:this.alpha},n=super.getConfig();return Object.assign(t,n),t}}rie.className="LeakyReLU";fe(rie);class iie extends ut{constructor(t){if(super(t??{}),this.DEFAULT_ALPHA_INITIALIZER="zeros",t==null&&(t={}),this.supportsMasking=!0,this.alphaInitializer=pn(t.alphaInitializer||this.DEFAULT_ALPHA_INITIALIZER),this.alphaRegularizer=gn(t.alphaRegularizer),this.alphaConstraint=Kn(t.alphaConstraint),t.sharedAxes==null)this.sharedAxes=null;else if(Array.isArray(t.sharedAxes))this.sharedAxes=t.sharedAxes;else if(typeof t.sharedAxes=="number")this.sharedAxes=[t.sharedAxes];else throw new W(`Expected sharedAxes to be a number or an array of numbers, but got ${t.sharedAxes}`)}build(t){t=kt(t);const n=t.slice(1);if(this.sharedAxes!=null)for(const i of this.sharedAxes)n[i-1]=1;this.alpha=this.addWeight("alpha",n,"float32",this.alphaInitializer,this.alphaRegularizer,!0,this.alphaConstraint);const r={};if(this.sharedAxes!=null)for(let i=1;i<t.length;++i)r[i]=t[i];this.inputSpec=[new Xn({ndim:t.length,axes:r})],this.built=!0}call(t,n){return t=Ge(t),KT(t,this.alpha.read())}getConfig(){const t={alphaInitializer:vn(this.alphaInitializer),alphaRegularizer:Yt(this.alphaRegularizer),alphaConstraint:Yn(this.alphaConstraint),sharedAxes:this.sharedAxes},n=super.getConfig();return Object.assign(t,n),t}}iie.className="PReLU";fe(iie);let sie=class extends ut{constructor(t){if(super(t??{}),this.DEFAULT_ALPHA=1,t==null&&(t={}),t.alpha!=null&&t.alpha!==this.DEFAULT_ALPHA)throw new tt(`Non-default alpha value (${t.alpha}) is not supported by the ELU layer yet.`);this.alpha=t.alpha==null?this.DEFAULT_ALPHA:t.alpha}call(t,n){const r=Ge(t);return Ow(r)}computeOutputShape(t){return t}getConfig(){const t={alpha:this.alpha},n=super.getConfig();return Object.assign(t,n),t}};sie.className="ELU";fe(sie);class oie extends ut{constructor(t){super(t??{}),this.DEFAULT_THETA=1,t==null&&(t={}),this.theta=t.theta==null?this.DEFAULT_THETA:t.theta}call(t,n){const r=Ge(t);return j(r,we(zs(r,this.theta),"float32"))}computeOutputShape(t){return t}getConfig(){const t={theta:this.theta},n=super.getConfig();return Object.assign(t,n),t}}oie.className="ThresholdedReLU";fe(oie);class aie extends ut{constructor(t){super(t??{}),this.DEFAULT_AXIS=1,t==null&&(t={}),this.softmax=new H5().apply,this.axis=t.axis==null?this.DEFAULT_AXIS:t.axis}call(t,n){const r=Ge(t);return this.softmax(r,this.axis)}computeOutputShape(t){return t}getConfig(){const t={axis:this.axis},n=super.getConfig();return Object.assign(t,n),t}}aie.className="Softmax";fe(aie);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Tm(e,t,n){if(typeof e=="number")return vp(e,t);if(e.length!==t)throw new W(`The ${n} argument must be an integer or tuple of ${t} integers. Received: ${e.length} elements.`);for(let r=0;r<t;++r){const i=e[r];if(!TNe(i))throw new W(`The ${n} argument must be an integer or tuple of ${t} integers. Received: ${JSON.stringify(e)} including a non-integer number ${i}`)}return e}function Sa(e,t,n,r,i=1){if(e==null)return e;const s=t+(t-1)*(i-1);let o;return n==="same"?o=e:o=e-s+1,Math.floor((o+r-1)/r)}function uu(e,t,n,r){if(e==null)return null;if(r==="valid")e=e*t+zf([n-t,0]);else if(r==="same")e=e*t;else throw new W(`Unsupport padding mode: ${r}.`);return e}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function q5(e,t){return Z(()=>(Rn(t),t==="channelsFirst"?mt(e,[0,2,3,1]):e))}function uie(e,t){return Z(()=>(Rn(t),t==="channelsFirst"?mt(e,[0,2,3,4,1]):e))}function HFe(e,t,n,r=1,i="valid",s,o=1){return Z(()=>{if(s==null&&(s=Na()),Rn(s),e.shape.length!==3)throw new W(`The input of a conv1dWithBias operation should be 3, but is ${e.shape.length} instead.`);if(t.shape.length!==3)throw new W(`The kernel for a conv1dWithBias operation should be 3, but is ${t.shape.length} instead`);if(n!=null&&n.shape.length!==1)throw new W(`The bias for a conv1dWithBias operation should be 1, but is ${t.shape.length} instead`);if(s==="channelsFirst"&&(e=mt(e,[0,2,1])),i==="causal")throw new tt("The support for CAUSAL padding mode in conv1dWithBias is not implemented yet.");let a=pB(e,t,r,i==="same"?"same":"valid","NWC",o);return n!=null&&(a=Ba(a,n)),a})}function nG(e,t,n,r=[1,1],i="valid",s,o,a=null){return Z(()=>{if(s==null&&(s=Na()),Rn(s),e.rank!==3&&e.rank!==4)throw new W(`conv2dWithBiasActivation expects input to be of rank 3 or 4, but received ${e.rank}.`);if(t.rank!==3&&t.rank!==4)throw new W(`conv2dWithBiasActivation expects kernel to be of rank 3 or 4, but received ${e.rank}.`);let u=q5(e,s);if(i==="causal")throw new tt("The support for CAUSAL padding mode in conv1dWithBias is not implemented yet.");return u=one({x:u,filter:t,strides:r,pad:i==="same"?"same":"valid",dilations:o,dataFormat:"NHWC",bias:n,activation:a}),s==="channelsFirst"&&(u=mt(u,[0,3,1,2])),u})}function qFe(e,t,n,r=[1,1,1],i="valid",s,o){return Z(()=>{if(s==null&&(s=Na()),Rn(s),e.rank!==4&&e.rank!==5)throw new W(`conv3dWithBias expects input to be of rank 4 or 5, but received ${e.rank}.`);if(t.rank!==4&&t.rank!==5)throw new W(`conv3dWithBias expects kernel to be of rank 4 or 5, but received ${e.rank}.`);let a=uie(e,s);if(i==="causal")throw new tt("The support for CAUSAL padding mode in conv3dWithBias is not implemented yet.");return a=$te(a,t,r,i==="same"?"same":"valid","NDHWC",o),n!=null&&(a=Ba(a,n)),s==="channelsFirst"&&(a=mt(a,[0,4,1,2,3])),a})}class CI extends ut{constructor(t,n){if(super(n),this.bias=null,this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_BIAS_INITIALIZER="zeros",CI.verifyArgs(n),this.rank=t,or(this.rank,"rank"),this.rank!==1&&this.rank!==2&&this.rank!==3)throw new tt(`Convolution layer for rank other than 1, 2, or 3 (${this.rank}) is not implemented yet.`);if(this.kernelSize=Tm(n.kernelSize,t,"kernelSize"),this.strides=Tm(n.strides==null?1:n.strides,t,"strides"),this.padding=n.padding==null?"valid":n.padding,co(this.padding),this.dataFormat=n.dataFormat==null?"channelsLast":n.dataFormat,Rn(this.dataFormat),this.activation=jf(n.activation),this.useBias=n.useBias==null?!0:n.useBias,this.biasInitializer=pn(n.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.biasConstraint=Kn(n.biasConstraint),this.biasRegularizer=gn(n.biasRegularizer),this.activityRegularizer=gn(n.activityRegularizer),this.dilationRate=Tm(n.dilationRate==null?1:n.dilationRate,t,"dilationRate"),this.rank===1&&Array.isArray(this.dilationRate)&&this.dilationRate.length!==1)throw new W(`dilationRate must be a number or an array of a single number for 1D convolution, but received ${JSON.stringify(this.dilationRate)}`);if(this.rank===2){if(typeof this.dilationRate=="number")this.dilationRate=[this.dilationRate,this.dilationRate];else if(this.dilationRate.length!==2)throw new W(`dilationRate must be a number or array of two numbers for 2D convolution, but received ${JSON.stringify(this.dilationRate)}`)}else if(this.rank===3){if(typeof this.dilationRate=="number")this.dilationRate=[this.dilationRate,this.dilationRate,this.dilationRate];else if(this.dilationRate.length!==3)throw new W(`dilationRate must be a number or array of three numbers for 3D convolution, but received ${JSON.stringify(this.dilationRate)}`)}}static verifyArgs(t){if(au("kernelSize"in t,"required key 'kernelSize' not in config"),typeof t.kernelSize!="number"&&!N5(t.kernelSize,"number",1,3))throw new W(`BaseConv expects config.kernelSize to be number or number[] with length 1, 2, or 3, but received ${JSON.stringify(t.kernelSize)}.`)}getConfig(){const t={kernelSize:this.kernelSize,strides:this.strides,padding:this.padding,dataFormat:this.dataFormat,dilationRate:this.dilationRate,activation:Uf(this.activation),useBias:this.useBias,biasInitializer:vn(this.biasInitializer),biasRegularizer:Yt(this.biasRegularizer),activityRegularizer:Yt(this.activityRegularizer),biasConstraint:Yn(this.biasConstraint)},n=super.getConfig();return Object.assign(t,n),t}}class G1 extends CI{constructor(t,n){super(t,n),this.kernel=null,G1.verifyArgs(n),this.filters=n.filters,or(this.filters,"filters"),this.kernelInitializer=pn(n.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.kernelConstraint=Kn(n.kernelConstraint),this.kernelRegularizer=gn(n.kernelRegularizer)}build(t){t=kt(t);const n=this.dataFormat==="channelsFirst"?1:t.length-1;if(t[n]==null)throw new W(`The channel dimension of the input should be defined. Found ${t[n]}`);const r=t[n],i=this.kernelSize.concat([r,this.filters]);this.kernel=this.addWeight("kernel",i,null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[{ndim:this.rank+2,axes:{[n]:r}}],this.built=!0}call(t,n){return Z(()=>{t=Ge(t);let r;const i=this.bias==null?null:this.bias.read(),s=ore(this.activation.getClassName());if(s!=null&&this.rank===2)r=nG(t,this.kernel.read(),i,this.strides,this.padding,this.dataFormat,this.dilationRate,s);else{if(this.rank===1)r=HFe(t,this.kernel.read(),i,this.strides[0],this.padding,this.dataFormat,this.dilationRate[0]);else if(this.rank===2)r=nG(t,this.kernel.read(),i,this.strides,this.padding,this.dataFormat,this.dilationRate);else if(this.rank===3)r=qFe(t,this.kernel.read(),i,this.strides,this.padding,this.dataFormat,this.dilationRate);else throw new tt("convolutions greater than 3D are not implemented yet.");this.activation!=null&&(r=this.activation.apply(r))}return r})}computeOutputShape(t){t=kt(t);const n=[],r=this.dataFormat==="channelsLast"?t.slice(1,t.length-1):t.slice(2);for(let s=0;s<r.length;++s){const o=Sa(r[s],this.kernelSize[s],this.padding,this.strides[s],typeof this.dilationRate=="number"?this.dilationRate:this.dilationRate[s]);n.push(o)}let i=[t[0]];return this.dataFormat==="channelsLast"?(i=i.concat(n),i.push(this.filters)):(i.push(this.filters),i=i.concat(n)),i}getConfig(){const t={filters:this.filters,kernelInitializer:vn(this.kernelInitializer),kernelRegularizer:Yt(this.kernelRegularizer),kernelConstraint:Yn(this.kernelConstraint)},n=super.getConfig();return Object.assign(t,n),t}static verifyArgs(t){if(!("filters"in t)||typeof t.filters!="number"||t.filters<1)throw new W(`Convolution layer expected config.filters to be a 'number' > 0 but got ${JSON.stringify(t.filters)}`)}}class qw extends G1{constructor(t){super(2,t),qw.verifyArgs(t)}getConfig(){const t=super.getConfig();return delete t.rank,t}static verifyArgs(t){if(typeof t.kernelSize!="number"&&!N5(t.kernelSize,"number",1,2))throw new W(`Conv2D expects config.kernelSize to be number or number[] with length 1 or 2, but received ${JSON.stringify(t.kernelSize)}.`)}}qw.className="Conv2D";fe(qw);class Xw extends G1{constructor(t){super(3,t),Xw.verifyArgs(t)}getConfig(){const t=super.getConfig();return delete t.rank,t}static verifyArgs(t){if(typeof t.kernelSize!="number"&&!(Array.isArray(t.kernelSize)&&(t.kernelSize.length===1||t.kernelSize.length===3)))throw new W(`Conv3D expects config.kernelSize to be number or [number, number, number], but received ${JSON.stringify(t.kernelSize)}.`)}}Xw.className="Conv3D";fe(Xw);class lie extends qw{constructor(t){if(super(t),this.inputSpec=[new Xn({ndim:4})],this.padding!=="same"&&this.padding!=="valid")throw new W(`Conv2DTranspose currently supports only padding modes 'same' and 'valid', but received padding mode ${this.padding}`)}build(t){if(t=kt(t),t.length!==4)throw new W("Input should have rank 4; Received input shape: "+JSON.stringify(t));const n=this.dataFormat==="channelsFirst"?1:t.length-1;if(t[n]==null)throw new W("The channel dimension of the inputs should be defined. Found `None`.");const r=t[n],i=this.kernelSize.concat([this.filters,r]);this.kernel=this.addWeight("kernel",i,"float32",this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[new Xn({ndim:4,axes:{[n]:r}})],this.built=!0}call(t,n){return Z(()=>{let r=Ge(t);if(r.shape.length!==4)throw new W(`Conv2DTranspose.call() expects input tensor to be rank-4, but received a tensor of rank-${r.shape.length}`);const i=r.shape,s=i[0];let o,a;this.dataFormat==="channelsFirst"?(o=2,a=3):(o=1,a=2);const u=i[o],l=i[a],c=this.kernelSize[0],f=this.kernelSize[1],h=this.strides[0],d=this.strides[1],p=uu(u,h,c,this.padding),g=uu(l,d,f,this.padding),m=[s,p,g,this.filters];this.dataFormat!=="channelsLast"&&(r=mt(r,[0,2,3,1]));let y=mB(r,this.kernel.read(),m,this.strides,this.padding);return this.dataFormat!=="channelsLast"&&(y=mt(y,[0,3,1,2])),this.bias!=null&&(y=Ba(y,this.bias.read(),this.dataFormat)),this.activation!=null&&(y=this.activation.apply(y)),y})}computeOutputShape(t){t=kt(t);const n=t.slice();let r,i,s;this.dataFormat==="channelsFirst"?(r=1,i=2,s=3):(r=3,i=1,s=2);const o=this.kernelSize[0],a=this.kernelSize[1],u=this.strides[0],l=this.strides[1];return n[r]=this.filters,n[i]=uu(n[i],u,o,this.padding),n[s]=uu(n[s],l,a,this.padding),n}getConfig(){const t=super.getConfig();return delete t.dilationRate,t}}lie.className="Conv2DTranspose";fe(lie);class cie extends Xw{constructor(t){if(super(t),this.inputSpec=[new Xn({ndim:5})],this.padding!=="same"&&this.padding!=="valid")throw new W(`Conv3DTranspose currently supports only padding modes 'same' and 'valid', but received padding mode ${this.padding}`)}build(t){if(t=kt(t),t.length!==5)throw new W("Input should have rank 5; Received input shape: "+JSON.stringify(t));const n=this.dataFormat==="channelsFirst"?1:t.length-1;if(t[n]==null)throw new W("The channel dimension of the inputs should be defined. Found `None`.");const r=t[n],i=this.kernelSize.concat([this.filters,r]);this.kernel=this.addWeight("kernel",i,"float32",this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[new Xn({ndim:5,axes:{[n]:r}})],this.built=!0}call(t,n){return Z(()=>{let r=Ge(t);if(r.shape.length!==5)throw new W(`Conv3DTranspose.call() expects input tensor to be rank-4, but received a tensor of rank-${r.shape.length}`);const i=r.shape,s=i[0];let o,a,u;this.dataFormat==="channelsFirst"?(u=2,o=3,a=4):(u=1,o=2,a=3);const l=i[u],c=i[o],f=i[a],h=this.kernelSize[0],d=this.kernelSize[1],p=this.kernelSize[2],g=this.strides[0],m=this.strides[1],y=this.strides[2],b=uu(l,g,h,this.padding),v=uu(c,m,d,this.padding),x=uu(f,y,p,this.padding),w=[s,b,v,x,this.filters];this.dataFormat!=="channelsLast"&&(r=mt(r,[0,2,3,4,1]));let C=Ste(r,this.kernel.read(),w,this.strides,this.padding);return this.dataFormat!=="channelsLast"&&(C=mt(C,[0,4,1,2,3])),this.bias!==null&&(C=Ba(C,this.bias.read(),this.dataFormat)),this.activation!==null&&(C=this.activation.apply(C)),C})}computeOutputShape(t){t=kt(t);const n=t.slice();let r,i,s,o;this.dataFormat==="channelsFirst"?(r=1,i=2,s=3,o=4):(r=4,i=1,s=2,o=3);const a=this.kernelSize[0],u=this.kernelSize[1],l=this.kernelSize[2],c=this.strides[0],f=this.strides[1],h=this.strides[2];return n[r]=this.filters,n[i]=uu(n[i],c,a,this.padding),n[s]=uu(n[s],f,u,this.padding),n[o]=uu(n[o],h,l,this.padding),n}getConfig(){const t=super.getConfig();return delete t.dilationRate,t}}cie.className="Conv3DTranspose";fe(cie);class fie extends G1{constructor(t,n){if(super(t,n),this.DEFAULT_DEPTHWISE_INITIALIZER="glorotUniform",this.DEFAULT_POINTWISE_INITIALIZER="glorotUniform",this.depthwiseKernel=null,this.pointwiseKernel=null,n.filters==null)throw new W("The `filters` configuration field is required by SeparableConv, but is unspecified.");if(n.kernelInitializer!=null||n.kernelRegularizer!=null||n.kernelConstraint!=null)throw new W("Fields kernelInitializer, kernelRegularizer and kernelConstraint are invalid for SeparableConv2D. Use depthwiseInitializer, depthwiseRegularizer, depthwiseConstraint, pointwiseInitializer, pointwiseRegularizer and pointwiseConstraint instead.");if(n.padding!=null&&n.padding!=="same"&&n.padding!=="valid")throw new W(`SeparableConv${this.rank}D supports only padding modes: 'same' and 'valid', but received ${JSON.stringify(n.padding)}`);this.depthMultiplier=n.depthMultiplier==null?1:n.depthMultiplier,this.depthwiseInitializer=pn(n.depthwiseInitializer||this.DEFAULT_DEPTHWISE_INITIALIZER),this.depthwiseRegularizer=gn(n.depthwiseRegularizer),this.depthwiseConstraint=Kn(n.depthwiseConstraint),this.pointwiseInitializer=pn(n.depthwiseInitializer||this.DEFAULT_POINTWISE_INITIALIZER),this.pointwiseRegularizer=gn(n.pointwiseRegularizer),this.pointwiseConstraint=Kn(n.pointwiseConstraint)}build(t){if(t=kt(t),t.length<this.rank+2)throw new W(`Inputs to SeparableConv${this.rank}D should have rank ${this.rank+2}, but received input shape: ${JSON.stringify(t)}`);const n=this.dataFormat==="channelsFirst"?1:t.length-1;if(t[n]==null||t[n]<0)throw new W(`The channel dimension of the inputs should be defined, but found ${JSON.stringify(t[n])}`);const r=t[n],i=this.kernelSize.concat([r,this.depthMultiplier]),s=[];for(let a=0;a<this.rank;++a)s.push(1);s.push(r*this.depthMultiplier,this.filters);const o=!0;this.depthwiseKernel=this.addWeight("depthwise_kernel",i,"float32",this.depthwiseInitializer,this.depthwiseRegularizer,o,this.depthwiseConstraint),this.pointwiseKernel=this.addWeight("pointwise_kernel",s,"float32",this.pointwiseInitializer,this.pointwiseRegularizer,o,this.pointwiseConstraint),this.useBias?this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,o,this.biasConstraint):this.bias=null,this.inputSpec=[new Xn({ndim:this.rank+2,axes:{[n]:r}})],this.built=!0}call(t,n){return Z(()=>{t=Ge(t);let r;if(this.rank===1)throw new tt("1D separable convolution is not implemented yet.");return this.rank===2&&(this.dataFormat==="channelsFirst"&&(t=mt(t,[0,2,3,1])),r=BB(t,this.depthwiseKernel.read(),this.pointwiseKernel.read(),this.strides,this.padding,this.dilationRate,"NHWC")),this.useBias&&(r=Ba(r,this.bias.read(),this.dataFormat)),this.activation!=null&&(r=this.activation.apply(r)),this.dataFormat==="channelsFirst"&&(r=mt(r,[0,3,1,2])),r})}getConfig(){const t=super.getConfig();return delete t.rank,delete t.kernelInitializer,delete t.kernelRegularizer,delete t.kernelConstraint,t.depthwiseInitializer=vn(this.depthwiseInitializer),t.pointwiseInitializer=vn(this.pointwiseInitializer),t.depthwiseRegularizer=Yt(this.depthwiseRegularizer),t.pointwiseRegularizer=Yt(this.pointwiseRegularizer),t.depthwiseConstraint=Yn(this.depthwiseConstraint),t.pointwiseConstraint=Yn(this.pointwiseConstraint),t}}fie.className="SeparableConv";class hie extends fie{constructor(t){super(2,t)}}hie.className="SeparableConv2D";fe(hie);class SI extends G1{constructor(t){super(1,t),SI.verifyArgs(t),this.inputSpec=[{ndim:3}]}getConfig(){const t=super.getConfig();return delete t.rank,delete t.dataFormat,t}static verifyArgs(t){if(typeof t.kernelSize!="number"&&!N5(t.kernelSize,"number",1,1))throw new W(`Conv1D expects config.kernelSize to be number or number[] with length 1, but received ${JSON.stringify(t.kernelSize)}.`)}}SI.className="Conv1D";fe(SI);class die extends ut{constructor(t){super(t),typeof t.cropping=="number"?this.cropping=[[t.cropping,t.cropping],[t.cropping,t.cropping]]:typeof t.cropping[0]=="number"?this.cropping=[[t.cropping[0],t.cropping[0]],[t.cropping[1],t.cropping[1]]]:this.cropping=t.cropping,this.dataFormat=t.dataFormat===void 0?"channelsLast":t.dataFormat,this.inputSpec=[{ndim:4}]}computeOutputShape(t){return this.dataFormat==="channelsFirst"?[t[0],t[1],t[2]-this.cropping[0][0]-this.cropping[0][1],t[3]-this.cropping[1][0]-this.cropping[1][1]]:[t[0],t[1]-this.cropping[0][0]-this.cropping[0][1],t[2]-this.cropping[1][0]-this.cropping[1][1],t[3]]}call(t,n){return Z(()=>{if(t=Ge(t),this.dataFormat==="channelsLast"){const r=AC(t,this.cropping[0][0],t.shape[1]-this.cropping[0][0]-this.cropping[0][1],2);return AC(r,this.cropping[1][0],t.shape[2]-this.cropping[1][1]-this.cropping[1][0],3)}else{const r=AC(t,this.cropping[0][0],t.shape[2]-this.cropping[0][0]-this.cropping[0][1],3);return AC(r,this.cropping[1][0],t.shape[3]-this.cropping[1][1]-this.cropping[1][0],4)}})}getConfig(){const t={cropping:this.cropping,dataFormat:this.dataFormat},n=super.getConfig();return Object.assign(t,n),t}}die.className="Cropping2D";fe(die);class pie extends ut{constructor(t){super(t),this.DEFAULT_SIZE=[2,2],this.inputSpec=[{ndim:4}],this.size=t.size==null?this.DEFAULT_SIZE:t.size,this.dataFormat=t.dataFormat==null?"channelsLast":t.dataFormat,Rn(this.dataFormat),this.interpolation=t.interpolation==null?"nearest":t.interpolation,ENe(this.interpolation)}computeOutputShape(t){if(this.dataFormat==="channelsFirst"){const n=t[2]==null?null:this.size[0]*t[2],r=t[3]==null?null:this.size[1]*t[3];return[t[0],t[1],n,r]}else{const n=t[1]==null?null:this.size[0]*t[1],r=t[2]==null?null:this.size[1]*t[2];return[t[0],n,r,t[3]]}}call(t,n){return Z(()=>{let r=Ge(t);const i=r.shape;if(this.dataFormat==="channelsFirst"){r=mt(r,[0,2,3,1]);const s=this.size[0]*i[2],o=this.size[1]*i[3],a=this.interpolation==="nearest"?yu.resizeNearestNeighbor(r,[s,o]):yu.resizeBilinear(r,[s,o]);return mt(a,[0,3,1,2])}else{const s=this.size[0]*i[1],o=this.size[1]*i[2];return this.interpolation==="nearest"?yu.resizeNearestNeighbor(r,[s,o]):yu.resizeBilinear(r,[s,o])}})}getConfig(){const t={size:this.size,dataFormat:this.dataFormat,interpolation:this.interpolation},n=super.getConfig();return Object.assign(t,n),t}}pie.className="UpSampling2D";fe(pie);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function XFe(e,t,n=[1,1],r="valid",i,s){return Z(()=>{i==null&&(i=Na()),Rn(i);let o=q5(e,i);if(e.rank!==4)throw new W(`Input for depthwiseConv2d is required to be 4-D, but is instead ${e.rank}-D`);if(t.rank!==4)throw new W(`depthwiseKernel is required to be 4-D, but is instead ${t.rank}-D`);return o=Fw(o,t,n,r==="same"?"same":"valid","NHWC",s),i==="channelsFirst"&&(o=mt(o,[0,3,1,2])),o})}class gie extends CI{constructor(t){super(2,t),this.depthwiseKernel=null,this.depthMultiplier=t.depthMultiplier==null?1:t.depthMultiplier,this.depthwiseInitializer=pn(t.depthwiseInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.depthwiseConstraint=Kn(t.depthwiseConstraint),this.depthwiseRegularizer=gn(t.depthwiseRegularizer)}build(t){if(t=kt(t),t.length<4)throw new W(`Inputs to DepthwiseConv2D should have rank 4. Received input shape: ${JSON.stringify(t)}.`);const n=this.dataFormat==="channelsFirst"?1:3;if(t[n]==null||t[n]<0)throw new W(`The channel dimension of the inputs to DepthwiseConv2D should be defined, but is not (${t[n]}).`);const r=t[n],i=[this.kernelSize[0],this.kernelSize[1],r,this.depthMultiplier];this.depthwiseKernel=this.addWeight("depthwise_kernel",i,null,this.depthwiseInitializer,this.depthwiseRegularizer,!0,this.depthwiseConstraint),this.useBias?this.bias=this.addWeight("bias",[r*this.depthMultiplier],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}call(t,n){return Z(()=>{t=Ge(t);let r=XFe(t,this.depthwiseKernel.read(),this.strides,this.padding,this.dataFormat,null);return this.useBias&&(r=Ba(r,this.bias.read(),this.dataFormat)),this.activation!=null&&(r=this.activation.apply(r)),r})}computeOutputShape(t){t=kt(t);const n=this.dataFormat==="channelsFirst"?t[2]:t[1],r=this.dataFormat==="channelsFirst"?t[3]:t[2],i=this.dataFormat==="channelsFirst"?t[1]*this.depthMultiplier:t[3]*this.depthMultiplier,s=Sa(n,this.kernelSize[0],this.padding,this.strides[0]),o=Sa(r,this.kernelSize[1],this.padding,this.strides[1]);return this.dataFormat==="channelsFirst"?[t[0],i,s,o]:[t[0],s,o,i]}getConfig(){const t=super.getConfig();return t.depthMultiplier=this.depthMultiplier,t.depthwiseInitializer=vn(this.depthwiseInitializer),t.depthwiseRegularizer=Yt(this.depthwiseRegularizer),t.depthwiseConstraint=Yn(this.depthwiseRegularizer),t}}gie.className="DepthwiseConv2D";fe(gie);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function mie(e,t,n,r){if(Array.isArray(e)){if(t!=null||n!=null)throw new W("When inputs is an array, neither initialState or constants should be provided");r!=null&&(n=e.slice(e.length-r,e.length),e=e.slice(0,e.length-r)),e.length>1&&(t=e.slice(1,e.length)),e=e[0]}function i(s){return s==null||Array.isArray(s)?s:[s]}return t=i(t),n=i(n),{inputs:e,initialState:t,constants:n}}function yie(e,t,n,r=!1,i,s,o=!1,a=!1){return Z(()=>{const u=t.shape.length;if(u<3)throw new W(`Input should be at least 3D, but is ${u}D.`);const l=[1,0].concat(Da(2,u));if(t=mt(t,l),s!=null)throw new tt("The rnn() functoin of the deeplearn.js backend does not support constants yet.");o&&console.warn("Backend rnn(): the unroll = true option is not applicable to the imperative deeplearn.js backend."),i!=null&&(i=we(we(i,"bool"),"float32"),i.rank===u-1&&(i=hi(i,-1)),i=mt(i,l)),r&&(t=Lo(t,0),i!=null&&(i=Lo(i,0)));const c=[];let f,h=n;const d=t.shape[0],p=Bf(t);let g;i!=null&&(g=Bf(i));for(let y=0;y<d;++y){const b=p[y],v=Z(()=>e(b,h));if(i==null)f=v[0],h=v[1];else{const x=Z(()=>{const w=g[y],C=_e(io(w),w),$=ce(j(v[0],w),j(h[0],C)),S=h.map((k,E)=>ce(j(v[1][E],w),j(k,C)));return{output:$,newStates:S}});f=x.output,h=x.newStates}a&&c.push(f)}let m;return a&&(m=ac(c,1)),[f,m,h]})}class Ih extends ut{constructor(t){super(t);let n;if(t.cell==null)throw new W("cell property is missing for the constructor of RNN.");if(Array.isArray(t.cell)?n=new K5({cells:t.cell}):n=t.cell,n.stateSize==null)throw new W("The RNN cell should have an attribute `stateSize` (tuple of integers, one integer per RNN state).");this.cell=n,this.returnSequences=t.returnSequences==null?!1:t.returnSequences,this.returnState=t.returnState==null?!1:t.returnState,this.goBackwards=t.goBackwards==null?!1:t.goBackwards,this._stateful=t.stateful==null?!1:t.stateful,this.unroll=t.unroll==null?!1:t.unroll,this.supportsMasking=!0,this.inputSpec=[new Xn({ndim:3})],this.stateSpec=null,this.states_=null,this.numConstants=null,this.keptStates=[]}getStates(){if(this.states_==null){const t=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1;return Da(0,t).map(n=>null)}else return this.states_}setStates(t){this.states_=t}computeOutputShape(t){aM(t)&&(t=t[0]),t=t;let n=this.cell.stateSize;Array.isArray(n)||(n=[n]);const r=n[0];let i;if(this.returnSequences?i=[t[0],t[1],r]:i=[t[0],r],this.returnState){const s=[];for(const o of n)s.push([t[0],o]);return[i].concat(s)}else return i}computeMask(t,n){return Z(()=>{Array.isArray(n)&&(n=n[0]);const r=this.returnSequences?n:null;if(this.returnState){const i=this.states.map(s=>null);return[r].concat(i)}else return r})}get states(){if(this.states_==null){const t=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1,n=[];for(let r=0;r<t;++r)n.push(null);return n}else return this.states_}set states(t){this.states_=t}build(t){if(this.numConstants!=null)throw new tt("Constants support is not implemented in RNN yet.");aM(t)&&(t=t[0]),t=t;const n=this.stateful?t[0]:null,r=t.slice(2);this.inputSpec[0]=new Xn({shape:[n,null,...r]});const i=[t[0]].concat(t.slice(2));this.cell.build(i);let s;if(Array.isArray(this.cell.stateSize)?s=this.cell.stateSize:s=[this.cell.stateSize],this.stateSpec!=null){if(!bt(this.stateSpec.map(o=>o.shape[o.shape.length-1]),s))throw new W(`An initialState was passed that is not compatible with cell.stateSize. Received stateSpec=${this.stateSpec}; However cell.stateSize is ${this.cell.stateSize}`)}else this.stateSpec=s.map(o=>new Xn({shape:[null,o]}));this.stateful&&this.resetStates()}resetStates(t,n=!1){Z(()=>{if(!this.stateful)throw new ou("Cannot call resetStates() on an RNN Layer that is not stateful.");const r=this.inputSpec[0].shape[0];if(r==null)throw new W("If an RNN is stateful, it needs to know its batch size. Specify the batch size of your input tensors: \n- If using a Sequential model, specify the batch size by passing a `batchInputShape` option to your first layer.\n- If using the functional API, specify the batch size by passing a `batchShape` option to your Input layer.");if(this.states_==null)Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(i=>Hn([r,i])):this.states_=[Hn([r,this.cell.stateSize])];else if(t==null)at(this.states_),this.keptStates!=null&&(at(this.keptStates),this.keptStates=[]),Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(i=>Hn([r,i])):this.states_[0]=Hn([r,this.cell.stateSize]);else{if(Array.isArray(t)||(t=[t]),t.length!==this.states_.length)throw new W(`Layer ${this.name} expects ${this.states_.length} state(s), but it received ${t.length} state value(s). Input received: ${t}`);n===!0?this.keptStates.push(this.states_.slice()):at(this.states_);for(let i=0;i<this.states_.length;++i){const s=t[i],o=Array.isArray(this.cell.stateSize)?this.cell.stateSize[i]:this.cell.stateSize,a=[r,o];if(!bt(s.shape,a))throw new W(`State ${i} is incompatible with layer ${this.name}: expected shape=${a}, received shape=${s.shape}`);this.states_[i]=s}}this.states_=this.states_.map(i=>Ca(i.clone()))})}apply(t,n){let r=n==null?null:n.initialState,i=n==null?null:n.constants;n==null&&(n={});const s=mie(t,r,i,this.numConstants);t=s.inputs,r=s.initialState,i=s.constants;let o=[],a=[];if(r!=null){n.initialState=r,o=o.concat(r),this.stateSpec=[];for(const l of r)this.stateSpec.push(new Xn({shape:l.shape}));a=a.concat(this.stateSpec)}if(i!=null&&(n.constants=i,o=o.concat(i),this.numConstants=i.length),o[0]instanceof bu){const l=[t].concat(o),c=this.inputSpec.concat(a),f=this.inputSpec;this.inputSpec=c;const h=super.apply(l,n);return this.inputSpec=f,h}else return super.apply(t,n)}call(t,n){return Z(()=>{const r=n==null?null:n.mask,i=n==null?null:n.training;let s=n==null?null:n.initialState;t=Ge(t),s==null&&(this.stateful?s=this.states_:s=this.getInitialState(t));const o=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1;if(s.length!==o)throw new W(`RNN Layer has ${o} state(s) but was passed ${s.length} initial state(s).`);this.unroll&&console.warn("Ignoring unroll = true for RNN layer, due to imperative backend.");const a={training:i},l=yie((p,g)=>{const m=this.cell.call([p].concat(g),a);return[m[0],m.slice(1)]},t,s,this.goBackwards,r,null,this.unroll,this.returnSequences),c=l[0],f=l[1],h=l[2];this.stateful&&this.resetStates(h,i);const d=this.returnSequences?f:c;return this.returnState?[d].concat(h):d})}getInitialState(t){return Z(()=>{let n=Hn(t.shape);return n=Ae(n,[1,2]),n=jw(n),Array.isArray(this.cell.stateSize)?this.cell.stateSize.map(r=>r>1?sM(n,[1,r]):n):this.cell.stateSize>1?[sM(n,[1,this.cell.stateSize])]:[n]})}get trainableWeights(){return this.trainable?this.cell.trainableWeights:[]}get nonTrainableWeights(){return this.trainable?this.cell.nonTrainableWeights:this.cell.weights}setFastWeightInitDuringBuild(t){super.setFastWeightInitDuringBuild(t),this.cell!=null&&this.cell.setFastWeightInitDuringBuild(t)}getConfig(){const t=super.getConfig(),n={returnSequences:this.returnSequences,returnState:this.returnState,goBackwards:this.goBackwards,stateful:this.stateful,unroll:this.unroll};this.numConstants!=null&&(n.numConstants=this.numConstants);const r=this.cell.getConfig();return this.getClassName()===Ih.className&&(n.cell={className:this.cell.getClassName(),config:r}),Object.assign(Object.assign(Object.assign({},r),t),n)}static fromConfig(t,n,r={}){const i=n.cell,s=Ql(i,r);return new t(Object.assign(n,{cell:s}))}}Ih.className="RNN";fe(Ih);class kI extends ut{}class X5 extends kI{constructor(t){super(t),this.DEFAULT_ACTIVATION="tanh",this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_RECURRENT_INITIALIZER="orthogonal",this.DEFAULT_BIAS_INITIALIZER="zeros",this.units=t.units,or(this.units,"units"),this.activation=jf(t.activation==null?this.DEFAULT_ACTIVATION:t.activation),this.useBias=t.useBias==null?!0:t.useBias,this.kernelInitializer=pn(t.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.recurrentInitializer=pn(t.recurrentInitializer||this.DEFAULT_RECURRENT_INITIALIZER),this.biasInitializer=pn(t.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.kernelRegularizer=gn(t.kernelRegularizer),this.recurrentRegularizer=gn(t.recurrentRegularizer),this.biasRegularizer=gn(t.biasRegularizer),this.kernelConstraint=Kn(t.kernelConstraint),this.recurrentConstraint=Kn(t.recurrentConstraint),this.biasConstraint=Kn(t.biasConstraint),this.dropout=Km([1,zf([0,t.dropout==null?0:t.dropout])]),this.recurrentDropout=Km([1,zf([0,t.recurrentDropout==null?0:t.recurrentDropout])]),this.dropoutFunc=t.dropoutFunc,this.stateSize=this.units,this.dropoutMask=null,this.recurrentDropoutMask=null}build(t){t=kt(t),this.kernel=this.addWeight("kernel",[t[t.length-1],this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias?this.bias=this.addWeight("bias",[this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}call(t,n){return Z(()=>{if(t=t,t.length!==2)throw new W(`SimpleRNNCell expects 2 input Tensors, got ${t.length}.`);let r=t[1];t=t[0];const i=n.training==null?!1:n.training;0<this.dropout&&this.dropout<1&&this.dropoutMask==null&&(this.dropoutMask=Wf({ones:()=>io(t),rate:this.dropout,training:i,dropoutFunc:this.dropoutFunc})),0<this.recurrentDropout&&this.recurrentDropout<1&&this.recurrentDropoutMask==null&&(this.recurrentDropoutMask=Wf({ones:()=>io(r),rate:this.recurrentDropout,training:i,dropoutFunc:this.dropoutFunc}));let s;const o=this.dropoutMask,a=this.recurrentDropoutMask;o!=null?s=ku(j(t,o),this.kernel.read()):s=ku(t,this.kernel.read()),this.bias!=null&&(s=Ba(s,this.bias.read())),a!=null&&(r=j(r,a));let u=ce(s,ku(r,this.recurrentKernel.read()));return this.activation!=null&&(u=this.activation.apply(u)),[u,u]})}getConfig(){const t=super.getConfig(),n={units:this.units,activation:Uf(this.activation),useBias:this.useBias,kernelInitializer:vn(this.kernelInitializer),recurrentInitializer:vn(this.recurrentInitializer),biasInitializer:vn(this.biasInitializer),kernelRegularizer:Yt(this.kernelRegularizer),recurrentRegularizer:Yt(this.recurrentRegularizer),biasRegularizer:Yt(this.biasRegularizer),activityRegularizer:Yt(this.activityRegularizer),kernelConstraint:Yn(this.kernelConstraint),recurrentConstraint:Yn(this.recurrentConstraint),biasConstraint:Yn(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout};return Object.assign(Object.assign({},t),n)}}X5.className="SimpleRNNCell";fe(X5);class bie extends Ih{constructor(t){t.cell=new X5(t),super(t)}call(t,n){return Z(()=>{this.cell.dropoutMask!=null&&(at(this.cell.dropoutMask),this.cell.dropoutMask=null),this.cell.recurrentDropoutMask!=null&&(at(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null);const r=n==null?null:n.mask,i=n==null?null:n.training,s=n==null?null:n.initialState;return super.call(t,{mask:r,training:i,initialState:s})})}static fromConfig(t,n){return new t(n)}}bie.className="SimpleRNN";fe(bie);class Y5 extends kI{constructor(t){if(super(t),this.DEFAULT_ACTIVATION="tanh",this.DEFAULT_RECURRENT_ACTIVATION="hardSigmoid",this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_RECURRENT_INITIALIZER="orthogonal",this.DEFAULT_BIAS_INITIALIZER="zeros",t.resetAfter)throw new W("GRUCell does not support reset_after parameter set to true.");this.units=t.units,or(this.units,"units"),this.activation=jf(t.activation===void 0?this.DEFAULT_ACTIVATION:t.activation),this.recurrentActivation=jf(t.recurrentActivation===void 0?this.DEFAULT_RECURRENT_ACTIVATION:t.recurrentActivation),this.useBias=t.useBias==null?!0:t.useBias,this.kernelInitializer=pn(t.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.recurrentInitializer=pn(t.recurrentInitializer||this.DEFAULT_RECURRENT_INITIALIZER),this.biasInitializer=pn(t.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.kernelRegularizer=gn(t.kernelRegularizer),this.recurrentRegularizer=gn(t.recurrentRegularizer),this.biasRegularizer=gn(t.biasRegularizer),this.kernelConstraint=Kn(t.kernelConstraint),this.recurrentConstraint=Kn(t.recurrentConstraint),this.biasConstraint=Kn(t.biasConstraint),this.dropout=Km([1,zf([0,t.dropout==null?0:t.dropout])]),this.recurrentDropout=Km([1,zf([0,t.recurrentDropout==null?0:t.recurrentDropout])]),this.dropoutFunc=t.dropoutFunc,this.implementation=t.implementation,this.stateSize=this.units,this.dropoutMask=null,this.recurrentDropoutMask=null}build(t){t=kt(t);const n=t[t.length-1];this.kernel=this.addWeight("kernel",[n,this.units*3],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units*3],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias?this.bias=this.addWeight("bias",[this.units*3],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}call(t,n){return Z(()=>{if(t=t,t.length!==2)throw new W(`GRUCell expects 2 input Tensors (inputs, h, c), got ${t.length}.`);const r=n.training==null?!1:n.training;let i=t[1];t=t[0],0<this.dropout&&this.dropout<1&&this.dropoutMask==null&&(this.dropoutMask=Wf({ones:()=>io(t),rate:this.dropout,training:r,count:3,dropoutFunc:this.dropoutFunc})),0<this.recurrentDropout&&this.recurrentDropout<1&&this.recurrentDropoutMask==null&&(this.recurrentDropoutMask=Wf({ones:()=>io(i),rate:this.recurrentDropout,training:r,count:3,dropoutFunc:this.dropoutFunc}));const s=this.dropoutMask,o=this.recurrentDropoutMask;let a,u,l;0<this.dropout&&this.dropout<1&&(t=j(t,s[0]));let c=ku(t,this.kernel.read());this.useBias&&(c=Ba(c,this.bias.read())),0<this.recurrentDropout&&this.recurrentDropout<1&&(i=j(i,o[0]));const f=this.recurrentKernel.read(),[h,d]=ks(f,[2*this.units,this.units],f.rank-1),p=ku(i,h),[g,m,y]=ks(c,3,c.rank-1),[b,v]=ks(p,2,p.rank-1);a=this.recurrentActivation.apply(ce(g,b)),u=this.recurrentActivation.apply(ce(m,v));const x=ku(j(u,i),d);l=this.activation.apply(ce(y,x));const w=ce(j(a,i),j(ce(1,un(a)),l));return[w,w]})}getConfig(){const t=super.getConfig(),n={units:this.units,activation:Uf(this.activation),recurrentActivation:Uf(this.recurrentActivation),useBias:this.useBias,kernelInitializer:vn(this.kernelInitializer),recurrentInitializer:vn(this.recurrentInitializer),biasInitializer:vn(this.biasInitializer),kernelRegularizer:Yt(this.kernelRegularizer),recurrentRegularizer:Yt(this.recurrentRegularizer),biasRegularizer:Yt(this.biasRegularizer),activityRegularizer:Yt(this.activityRegularizer),kernelConstraint:Yn(this.kernelConstraint),recurrentConstraint:Yn(this.recurrentConstraint),biasConstraint:Yn(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation,resetAfter:!1};return Object.assign(Object.assign({},t),n)}}Y5.className="GRUCell";fe(Y5);class xie extends Ih{constructor(t){t.implementation===0&&console.warn("`implementation=0` has been deprecated, and now defaults to `implementation=1`. Please update your layer call."),t.cell=new Y5(t),super(t)}call(t,n){return Z(()=>{this.cell.dropoutMask!=null&&(at(this.cell.dropoutMask),this.cell.dropoutMask=null),this.cell.recurrentDropoutMask!=null&&(at(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null);const r=n==null?null:n.mask,i=n==null?null:n.training,s=n==null?null:n.initialState;return super.call(t,{mask:r,training:i,initialState:s})})}static fromConfig(t,n){return n.implmentation===0&&(n.implementation=1),new t(n)}}xie.className="GRU";fe(xie);class EI extends kI{constructor(t){super(t),this.DEFAULT_ACTIVATION="tanh",this.DEFAULT_RECURRENT_ACTIVATION="hardSigmoid",this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_RECURRENT_INITIALIZER="orthogonal",this.DEFAULT_BIAS_INITIALIZER="zeros",this.units=t.units,or(this.units,"units"),this.activation=jf(t.activation===void 0?this.DEFAULT_ACTIVATION:t.activation),this.recurrentActivation=jf(t.recurrentActivation===void 0?this.DEFAULT_RECURRENT_ACTIVATION:t.recurrentActivation),this.useBias=t.useBias==null?!0:t.useBias,this.kernelInitializer=pn(t.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.recurrentInitializer=pn(t.recurrentInitializer||this.DEFAULT_RECURRENT_INITIALIZER),this.biasInitializer=pn(t.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.unitForgetBias=t.unitForgetBias,this.kernelRegularizer=gn(t.kernelRegularizer),this.recurrentRegularizer=gn(t.recurrentRegularizer),this.biasRegularizer=gn(t.biasRegularizer),this.kernelConstraint=Kn(t.kernelConstraint),this.recurrentConstraint=Kn(t.recurrentConstraint),this.biasConstraint=Kn(t.biasConstraint),this.dropout=Km([1,zf([0,t.dropout==null?0:t.dropout])]),this.recurrentDropout=Km([1,zf([0,t.recurrentDropout==null?0:t.recurrentDropout])]),this.dropoutFunc=t.dropoutFunc,this.implementation=t.implementation,this.stateSize=[this.units,this.units],this.dropoutMask=null,this.recurrentDropoutMask=null}build(t){var n;t=kt(t);const r=t[t.length-1];this.kernel=this.addWeight("kernel",[r,this.units*4],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units*4],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint);let i;if(this.useBias){if(this.unitForgetBias){const s=this.biasInitializer,o=this.units;i=new(n=class extends qo{apply(u,l){const c=s.apply([o]),f=new O5().apply([o]),h=s.apply([o*2]);return BV(BV(c,f),h)}},n.className="CustomInit",n)}else i=this.biasInitializer;this.bias=this.addWeight("bias",[this.units*4],null,i,this.biasRegularizer,!0,this.biasConstraint)}else this.bias=null;this.built=!0}call(t,n){return Z(()=>{const r=n.training==null?!1:n.training;if(t=t,t.length!==3)throw new W(`LSTMCell expects 3 input Tensors (inputs, h, c), got ${t.length}.`);let i=t[1];const s=t[2];t=t[0],0<this.dropout&&this.dropout<1&&this.dropoutMask==null&&(this.dropoutMask=Wf({ones:()=>io(t),rate:this.dropout,training:r,count:4,dropoutFunc:this.dropoutFunc})),0<this.recurrentDropout&&this.recurrentDropout<1&&this.recurrentDropoutMask==null&&(this.recurrentDropoutMask=Wf({ones:()=>io(i),rate:this.recurrentDropout,training:r,count:4,dropoutFunc:this.dropoutFunc}));const o=this.dropoutMask,a=this.recurrentDropoutMask;let u,l,c,f;0<this.dropout&&this.dropout<1&&(t=j(t,o[0]));let h=ku(t,this.kernel.read());0<this.recurrentDropout&&this.recurrentDropout<1&&(i=j(i,a[0])),h=ce(h,ku(i,this.recurrentKernel.read())),this.useBias&&(h=Ba(h,this.bias.read()));const[d,p,g,m]=ks(h,4,h.rank-1);u=this.recurrentActivation.apply(d),l=this.recurrentActivation.apply(p),c=ce(j(l,s),j(u,this.activation.apply(g))),f=this.recurrentActivation.apply(m);const y=j(f,this.activation.apply(c));return[y,y,c]})}getConfig(){const t=super.getConfig(),n={units:this.units,activation:Uf(this.activation),recurrentActivation:Uf(this.recurrentActivation),useBias:this.useBias,kernelInitializer:vn(this.kernelInitializer),recurrentInitializer:vn(this.recurrentInitializer),biasInitializer:vn(this.biasInitializer),unitForgetBias:this.unitForgetBias,kernelRegularizer:Yt(this.kernelRegularizer),recurrentRegularizer:Yt(this.recurrentRegularizer),biasRegularizer:Yt(this.biasRegularizer),activityRegularizer:Yt(this.activityRegularizer),kernelConstraint:Yn(this.kernelConstraint),recurrentConstraint:Yn(this.recurrentConstraint),biasConstraint:Yn(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation};return Object.assign(Object.assign({},t),n)}}EI.className="LSTMCell";fe(EI);class vie extends Ih{constructor(t){t.implementation===0&&console.warn("`implementation=0` has been deprecated, and now defaults to `implementation=1`. Please update your layer call."),t.cell=new EI(t),super(t)}call(t,n){return Z(()=>{this.cell.dropoutMask!=null&&(at(this.cell.dropoutMask),this.cell.dropoutMask=null),this.cell.recurrentDropoutMask!=null&&(at(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null);const r=n==null?null:n.mask,i=n==null?null:n.training,s=n==null?null:n.initialState;return super.call(t,{mask:r,training:i,initialState:s})})}static fromConfig(t,n){return n.implmentation===0&&(n.implementation=1),new t(n)}}vie.className="LSTM";fe(vie);class K5 extends kI{constructor(t){super(t),this.cells=t.cells}get stateSize(){const t=[];for(const n of this.cells.slice().reverse())Array.isArray(n.stateSize)?t.push(...n.stateSize):t.push(n.stateSize);return t}call(t,n){return Z(()=>{t=t;let r=t.slice(1);const i=[];for(const a of this.cells.slice().reverse())Array.isArray(a.stateSize)?i.push(r.splice(0,a.stateSize.length)):i.push(r.splice(0,1));i.reverse();const s=[];let o;for(let a=0;a<this.cells.length;++a){const u=this.cells[a];r=i[a],a===0?o=[t[0]].concat(r):o=[o[0]].concat(r),o=u.call(o,n),s.push(o.slice(1))}r=[];for(const a of s.slice().reverse())r.push(...a);return[o[0]].concat(r)})}build(t){aM(t)&&(t=t[0]),t=t;let n;this.cells.forEach((r,i)=>{Jd(`RNNCell_${i}`,()=>{r.build(t),Array.isArray(r.stateSize)?n=r.stateSize[0]:n=r.stateSize,t=[t[0],n]})}),this.built=!0}getConfig(){const t=super.getConfig(),n=s=>({className:s.getClassName(),config:s.getConfig()}),i={cells:this.cells.map(n)};return Object.assign(Object.assign({},t),i)}static fromConfig(t,n,r={}){const i=[];for(const s of n.cells)i.push(Ql(s,r));return new t({cells:i})}get trainableWeights(){if(!this.trainable)return[];const t=[];for(const n of this.cells)t.push(...n.trainableWeights);return t}get nonTrainableWeights(){const t=[];for(const n of this.cells)t.push(...n.nonTrainableWeights);if(!this.trainable){const n=[];for(const r of this.cells)n.push(...r.trainableWeights);return n.concat(t)}return t}getWeights(){const t=[];for(const n of this.cells)t.push(...n.weights);return uM(t)}setWeights(t){const n=[];for(const r of this.cells){const i=r.weights.length,s=t.splice(i);for(let o=0;o<r.weights.length;++o)n.push([r.weights[o],s[o]])}U5(n)}}K5.className="StackedRNNCells";fe(K5);function Wf(e){const{ones:t,rate:n,training:r=!1,count:i=1,dropoutFunc:s}=e,o=()=>s!=null?s(t(),n):dre(t(),n),a=()=>Vw(o,t,r);return!i||i<=1?Ca(a().clone()):Array(i).fill(void 0).map(a).map(l=>Ca(l.clone()))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */var YFe=globalThis&&globalThis.__rest||function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]]);return n};class wie extends Ih{constructor(t){if(t.unroll)throw new tt("Unrolling is not possible with convolutional RNNs.");if(Array.isArray(t.cell))throw new tt("It is not possible at the moment to stack convolutional cells.");super(t),this.inputSpec=[new Xn({ndim:5})]}call(t,n){return Z(()=>{if(this.cell.dropoutMask!=null&&(at(this.cell.dropoutMask),this.cell.dropoutMask=null),this.cell.recurrentDropoutMask!=null&&(at(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null),n&&n.constants)throw new W("ConvRNN2D cell does not support constants");const r=n==null?null:n.mask,i=n==null?null:n.training,s=n==null?null:n.initialState;return super.call(t,{mask:r,training:i,initialState:s})})}computeOutputShape(t){let n=this.computeSingleOutputShape(t);return this.returnSequences||(n=[n[0],...n.slice(2)]),this.returnState&&(n=[n,...Array(2).fill([t[0],...n.slice(-3)])]),n}getInitialState(t){return Z(()=>{const{stateSize:n}=this.cell,r=t.shape,i=this.computeSingleOutputShape(r),s=[i[0],...i.slice(2)],o=Hn(s);return Array.isArray(n)?Array(n.length).fill(o):[o]})}resetStates(t,n=!1){Z(()=>{if(!this.stateful)throw new ou("Cannot call resetStates() on an RNN Layer that is not stateful.");const r=this.inputSpec[0].shape,i=this.computeSingleOutputShape(r),s=[i[0],...i.slice(2)];if(r[0]==null)throw new W("If an RNN is stateful, it needs to know its batch size. Specify the batch size of your input tensors: \n- If using a Sequential model, specify the batch size by passing a `batchInputShape` option to your first layer.\n- If using the functional API, specify the batch size by passing a `batchShape` option to your Input layer.");if(this.getStates()==null)Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(()=>Hn(s)):this.states_=[Hn(s)];else if(t==null)at(this.states_),this.keptStates!=null&&(at(this.keptStates),this.keptStates=[]),Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(()=>Hn(s)):this.states_[0]=Hn(s);else{if(Array.isArray(t)||(t=[t]),t.length!==this.states_.length)throw new W(`Layer ${this.name} expects ${this.states_.length} state(s), but it received ${t.length} state value(s). Input received: ${t}`);n?this.keptStates.push(this.states_.slice()):at(this.states_);for(let a=0;a<this.states_.length;++a){const u=t[a],l=s;if(!bt(u.shape,l))throw new W(`State ${a} is incompatible with layer ${this.name}: expected shape=${l}, received shape=${u.shape}`);this.states_[a]=u}}this.states_=this.states_.map(a=>Ca(a.clone()))})}computeSingleOutputShape(t){const{dataFormat:n,filters:r,kernelSize:i,padding:s,strides:o,dilationRate:a}=this.cell,u=n==="channelsFirst",l=t[u?3:2],c=t[u?4:3],f=Sa(l,i[0],s,o[0],a[0]),h=Sa(c,i[1],s,o[1],a[1]);return[...t.slice(0,2),...u?[r,f,h]:[f,h,r]]}}wie.className="ConvRNN2D";class Z5 extends EI{constructor(t){const{filters:n,kernelSize:r,strides:i,padding:s,dataFormat:o,dilationRate:a}=t;super(Object.assign(Object.assign({},t),{units:n})),this.filters=n,or(this.filters,"filters"),this.kernelSize=Tm(r,2,"kernelSize"),this.kernelSize.forEach(u=>or(u,"kernelSize")),this.strides=Tm(i||1,2,"strides"),this.strides.forEach(u=>or(u,"strides")),this.padding=s||"valid",co(this.padding),this.dataFormat=o||"channelsLast",Rn(this.dataFormat),this.dilationRate=Tm(a||1,2,"dilationRate"),this.dilationRate.forEach(u=>or(u,"dilationRate"))}build(t){var n;t=kt(t);const r=this.dataFormat==="channelsFirst"?1:t.length-1;if(t[r]==null)throw new W(`The channel dimension of the input should be defined. Found ${t[r]}`);const i=t[r],s=4,o=this.kernelSize.concat([i,this.filters*s]);this.kernel=this.addWeight("kernel",o,null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint);const a=this.kernelSize.concat([this.filters,this.filters*s]);if(this.recurrentKernel=this.addWeight("recurrent_kernel",a,null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias){let u;if(this.unitForgetBias){const l=this.biasInitializer,c=this.filters;u=new(n=class extends qo{apply(h,d){const p=l.apply([c]),g=Ys([c]),m=l.apply([c*2]);return F5([p,g,m])}},n.className="CustomInit",n)}else u=this.biasInitializer;this.bias=this.addWeight("bias",[this.filters*s],null,u,this.biasRegularizer,!0,this.biasConstraint)}this.built=!0}call(t,n){return Z(()=>{if(t.length!==3)throw new W(`ConvLSTM2DCell expects 3 input Tensors (inputs, h, c), got ${t.length}.`);const r=n.training||!1,i=t[0],s=t[1],o=t[2],a=4;0<this.dropout&&this.dropout<1&&this.dropoutMask==null&&(this.dropoutMask=Wf({ones:()=>io(i),rate:this.dropout,training:r,count:a,dropoutFunc:this.dropoutFunc}));const u=this.dropoutMask,l=(q,X,G)=>!X||!X[G]?q:j(X[G],q);let c=l(i,u,0),f=l(i,u,1),h=l(i,u,2),d=l(i,u,3);0<this.recurrentDropout&&this.recurrentDropout<1&&this.recurrentDropoutMask==null&&(this.recurrentDropoutMask=Wf({ones:()=>io(s),rate:this.recurrentDropout,training:r,count:a,dropoutFunc:this.dropoutFunc}));const p=this.recurrentDropoutMask;let g=l(s,p,0),m=l(s,p,1),y=l(s,p,2),b=l(s,p,3);const v=3,[x,w,C,$]=ks(this.kernel.read(),a,v),[S,k,E,_]=this.useBias?ks(this.bias.read(),a):[null,null,null,null];c=this.inputConv(c,x,S,this.padding),f=this.inputConv(f,w,k,this.padding),h=this.inputConv(h,C,E,this.padding),d=this.inputConv(d,$,_,this.padding);const[D,A,T,I]=ks(this.recurrentKernel.read(),a,v);g=this.recurrentConv(g,D),m=this.recurrentConv(m,A),y=this.recurrentConv(y,T),b=this.recurrentConv(b,I);const F=this.recurrentActivation.apply(ce(c,g)),R=this.recurrentActivation.apply(ce(f,m)),L=ce(j(R,o),j(F,this.activation.apply(ce(h,y)))),P=j(this.recurrentActivation.apply(ce(d,b)),this.activation.apply(L));return[P,P,L]})}getConfig(){const t=super.getConfig(),n=YFe(t,["units"]),r={filters:this.filters,kernelSize:this.kernelSize,padding:this.padding,dataFormat:this.dataFormat,dilationRate:this.dilationRate,strides:this.strides};return Object.assign(Object.assign({},n),r)}inputConv(t,n,r,i){const s=Lf(t,n,this.strides,i||"valid",this.dataFormat==="channelsFirst"?"NCHW":"NHWC",this.dilationRate);return r?Ba(s,r,this.dataFormat):s}recurrentConv(t,n){return Lf(t,n,1,"same",this.dataFormat==="channelsFirst"?"NCHW":"NHWC")}}Z5.className="ConvLSTM2DCell";fe(Z5);class $ie extends wie{constructor(t){const n=new Z5(t);super(Object.assign(Object.assign({},t),{cell:n}))}static fromConfig(t,n){return new t(n)}}$ie.className="ConvLSTM2D";fe($ie);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class J5 extends ut{constructor(t){super(t),this.rate=Math.max(Math.min(t.rate,1),0),this.noiseShape=t.noiseShape,this.seed=t.seed,this.supportsMasking=!0}getNoiseShape(t){if(this.noiseShape==null)return this.noiseShape;const n=t.shape,r=[];for(let i=0;i<this.noiseShape.length;++i)r.push(this.noiseShape[i]==null?n[i]:this.noiseShape[i]);return r}call(t,n){return Z(()=>{this.invokeCallHook(t,n);const r=Ge(t);if(0<this.rate&&this.rate<1){const i=n.training==null?!1:n.training,s=this.getNoiseShape(r);return Vw(()=>dre(r,this.rate,s,this.seed),()=>r,i)}return t})}getConfig(){const t={rate:this.rate,noiseShape:this.noiseShape,seed:this.seed},n=super.getConfig();return Object.assign(t,n),t}dispose(){return super.dispose()}}J5.className="Dropout";fe(J5);class Cie extends J5{constructor(t){super(t),this.inputSpec=[{ndim:3}]}getNoiseShape(t){const n=t.shape;return[n[0],1,n[2]]}}Cie.className="SpatialDropout1D";fe(Cie);class Q5 extends ut{constructor(t){if(super(t),this.activation=null,this.useBias=!0,this.kernel=null,this.bias=null,this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_BIAS_INITIALIZER="zeros",t.batchInputShape==null&&t.inputShape==null&&t.inputDim!=null){let n=null;t.batchSize!=null&&(n=t.batchSize),this.batchInputShape=[n,t.inputDim]}this.units=t.units,or(this.units,"units"),this.activation=jf(t.activation),t.useBias!=null&&(this.useBias=t.useBias),this.kernelInitializer=pn(t.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.biasInitializer=pn(t.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.kernelConstraint=Kn(t.kernelConstraint),this.biasConstraint=Kn(t.biasConstraint),this.kernelRegularizer=gn(t.kernelRegularizer),this.biasRegularizer=gn(t.biasRegularizer),this.activityRegularizer=gn(t.activityRegularizer),this.supportsMasking=!0,this.inputSpec=[{minNDim:2}]}build(t){t=kt(t);const n=t[t.length-1];this.kernel==null&&(this.kernel=this.addWeight("kernel",[n,this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint))),this.inputSpec=[{minNDim:2,axes:{[-1]:n}}],this.built=!0}computeOutputShape(t){t=kt(t);const n=t.slice();return n[n.length-1]=this.units,n}call(t,n){return Z(()=>{this.invokeCallHook(t,n);const r=Ge(t),i=ore(this.activation.getClassName());let s;return i!=null?s=ku(r,this.kernel.read(),i,this.bias?this.bias.read():null):(s=ku(r,this.kernel.read()),this.bias!=null&&(s=Ba(s,this.bias.read())),this.activation!=null&&(s=this.activation.apply(s))),s})}getConfig(){const t={units:this.units,activation:Uf(this.activation),useBias:this.useBias,kernelInitializer:vn(this.kernelInitializer),biasInitializer:vn(this.biasInitializer),kernelRegularizer:Yt(this.kernelRegularizer),biasRegularizer:Yt(this.biasRegularizer),activityRegularizer:Yt(this.activityRegularizer),kernelConstraint:Yn(this.kernelConstraint),biasConstraint:Yn(this.biasConstraint)},n=super.getConfig();return Object.assign(t,n),t}}Q5.className="Dense";fe(Q5);let Sie=class extends ut{constructor(t){t=t||{},super(t),this.inputSpec=[{minNDim:3}],this.dataFormat=t.dataFormat}computeOutputShape(t){t=kt(t);for(const n of t.slice(1))if(n==null)throw new W(`The shape of the input to "Flatten" is not fully defined (got ${t.slice(1)}). Make sure to pass a complete "input_shape" or "batch_input_shape" argument to the first layer in your model.`);return[t[0],Sf(t,1)]}call(t,n){return Z(()=>{this.invokeCallHook(t,n);let r=Ge(t);if(this.dataFormat==="channelsFirst"&&r.rank>1){const i=[0];for(let s=2;s<r.rank;++s)i.push(s);i.push(1),r=mt(r,i)}return NNe(r)})}getConfig(){const t={};this.dataFormat!=null&&(t.dataFormat=this.dataFormat);const n=super.getConfig();return Object.assign(t,n),t}};Sie.className="Flatten";fe(Sie);class kie extends ut{constructor(t){super(t),this.supportsMasking=!0,this.activation=jf(t.activation)}call(t,n){return Z(()=>{this.invokeCallHook(t,n);const r=Ge(t);return this.activation.apply(r)})}getConfig(){const t={activation:Uf(this.activation)},n=super.getConfig();return Object.assign(t,n),t}}kie.className="Activation";fe(kie);class Eie extends ut{constructor(t){super(t),this.n=t.n,this.inputSpec=[{ndim:2}]}computeOutputShape(t){return[t[0],this.n,t[1]]}call(t,n){return Z(()=>(t=Ge(t),INe(t,this.n)))}getConfig(){const t={n:this.n},n=super.getConfig();return Object.assign(t,n),t}}Eie.className="RepeatVector";fe(Eie);class _ie extends ut{constructor(t){super(t),this.targetShape=t.targetShape;for(let n=0;n<this.targetShape.length;++n)this.isUnknown(this.targetShape[n])&&(this.targetShape[n]=null)}isUnknown(t){return t<0||t==null}fixUnknownDimension(t,n){const r="Total size of new array must be unchanged.",i=n.slice();let s=1,o=null;for(let u=0;u<i.length;++u){const l=i[u];if(this.isUnknown(l))if(o===null)o=u;else throw new W("Can only specifiy one unknown dimension.");else s*=l}const a=Sf(t);if(o!==null){if(s===0||a%s!==0)throw new W(r);i[o]=a/s}else if(a!==s)throw new W(r);return i}computeOutputShape(t){let n=!1;for(let r=0;r<t.length;++r)if(this.isUnknown(t[r])){n=!0;break}return n?t.slice(0,1).concat(this.targetShape):t.slice(0,1).concat(this.fixUnknownDimension(t.slice(1),this.targetShape))}call(t,n){return Z(()=>{this.invokeCallHook(t,n);const r=Ge(t),i=r.shape,s=i.slice(0,1).concat(this.fixUnknownDimension(i.slice(1),this.targetShape));return V(r,s)})}getConfig(){const t={targetShape:this.targetShape},n=super.getConfig();return Object.assign(t,n),t}}_ie.className="Reshape";fe(_ie);class Aie extends ut{constructor(t){if(super(t),t.dims==null)throw new Error("Required configuration field `dims` is missing during Permute constructor call.");if(!Array.isArray(t.dims))throw new Error(`Permute constructor requires \`dims\` to be an Array, but received ${t.dims} instead.`);const n=Da(1,t.dims.length+1);if(!bt(t.dims.slice().sort(),n))throw new Error("Invalid permutation `dims`: "+JSON.stringify(t.dims)+" `dims` must contain consecutive integers starting from 1.");this.dims=t.dims,this.dimsIncludingBatch=[0].concat(this.dims),this.inputSpec=[new Xn({ndim:this.dims.length+1})]}computeOutputShape(t){t=kt(t);const n=t.slice();return this.dims.forEach((r,i)=>{n[i+1]=t[r]}),n}call(t,n){return mt(Ge(t),this.dimsIncludingBatch)}getConfig(){const t={dims:this.dims},n=super.getConfig();return Object.assign(t,n),t}}Aie.className="Permute";fe(Aie);class Tie extends ut{constructor(t){super(t??{}),this.supportsMasking=!0,t!=null?this.maskValue=t.maskValue==null?0:t.maskValue:this.maskValue=0}computeOutputShape(t){return t}getConfig(){const t=super.getConfig(),n={maskValue:this.maskValue};return Object.assign(n,t),n}computeMask(t,n){const r=Ge(t),i=-1;return Pk(Xm(r,this.maskValue),i)}call(t,n){return Z(()=>{this.invokeCallHook(t,n);const r=Ge(t),i=-1,s=!0,o=Pk(Xm(r,this.maskValue),i,s);return j(r,we(o,r.dtype))})}}Tie.className="Masking";fe(Tie);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class Iie extends ut{constructor(t){if(super(t),this.embeddings=null,this.DEFAULT_EMBEDDINGS_INITIALIZER="randomUniform",t.batchInputShape==null&&t.inputShape==null){let n=null;t.batchSize!=null&&(n=t.batchSize),t.inputLength==null?this.batchInputShape=[n,null]:this.batchInputShape=[n].concat(sn(t.inputLength))}this.inputDim=t.inputDim,or(this.inputDim,"inputDim"),this.outputDim=t.outputDim,or(this.outputDim,"outputDim"),this.embeddingsInitializer=pn(t.embeddingsInitializer||this.DEFAULT_EMBEDDINGS_INITIALIZER),this.embeddingsRegularizer=gn(t.embeddingsRegularizer),this.activityRegularizer=gn(t.activityRegularizer),this.embeddingsConstraint=Kn(t.embeddingsConstraint),this.maskZero=t.maskZero,this.supportsMasking=t.maskZero,this.inputLength=t.inputLength}build(t){this.embeddings=this.addWeight("embeddings",[this.inputDim,this.outputDim],this.dtype,this.embeddingsInitializer,this.embeddingsRegularizer,!0,this.embeddingsConstraint),this.built=!0}warnOnIncompatibleInputShape(t){}computeMask(t,n){return Z(()=>this.maskZero?(t=Ge(t),Xm(t,xt(t))):null)}computeOutputShape(t){if(t=kt(t),this.inputLength==null)return[...t,this.outputDim];const n=sn(this.inputLength);if(n.length!==t.length-1)throw new W(`"inputLength" is ${this.inputLength}, but received input shape has shape ${t}`);{let r=0;for(let i=0;i<n.length;++i){const s=n[i],o=t[i+1];if(s!=null&&o!=null&&s!==o)throw new W(`"inputLength" is ${this.inputLength}, but received input shape has shape ${t}`);s==null&&(n[r]=o),r++}}return[t[0],...n,this.outputDim]}call(t,n){return Z(()=>{this.invokeCallHook(t,n);let r=Ge(t);r.dtype!=="int32"&&(r=Su(r,"int32"));const i=hre(this.embeddings.read(),V(r,[r.size]));return V(i,kt(this.computeOutputShape(r.shape)))})}getConfig(){const t={inputDim:this.inputDim,outputDim:this.outputDim,embeddingsInitializer:vn(this.embeddingsInitializer),embeddingsRegularizer:Yt(this.embeddingsRegularizer),activityRegularizer:Yt(this.activityRegularizer),embeddingsConstraint:Yn(this.embeddingsConstraint),maskZero:this.maskZero,inputLength:this.inputLength},n=super.getConfig();return Object.assign(t,n),t}}Iie.className="Embedding";fe(Iie);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class fg extends ut{constructor(t){super(t||{}),this.supportsMasking=!0}mergeFunction(t){throw new tt}computeElementwiseOpOutputShape(t,n){if(t==null||n==null)return null;if(t.length<n.length)return this.computeElementwiseOpOutputShape(n,t);if(n.length===0)return t;const r=t.slice(0,t.length-n.length);for(let i=0;i<n.length;++i){const s=t[t.length-n.length+i],o=n[i];if(s==null||o==null||s<0||o<0)r.push(null);else if(s===1)r.push(o);else if(o===1)r.push(s);else{if(s!==o)throw new W("Operands could not be broadcast together with shapes "+JSON.stringify(t)+" "+JSON.stringify(n));r.push(s)}}return r}build(t){if(Array.isArray(t)&&!Array.isArray(t[0])&&(t=[kt(t)]),t=t,t.length<2)throw new W(`A merge layer should be called on an Array of at least 2 inputs. Got ${t.length} input(s).`);let n=[];for(const s of t)s!=null&&s[0]!==null&&n.push(s[0]);if(n=Cf(n),n.length>1)throw new W(`Can not merge tensors with different batch sizes. Got tensors with shapes: ${JSON.stringify(t)}.`);let r=t[0]==null?null:t[0].slice(1);for(let s=1;s<t.length;++s){const o=t[s]==null?null:t[s].slice(1);r=this.computeElementwiseOpOutputShape(r,o)}const i=t.map(s=>s.length);t.indexOf(null)===-1&&Cf(i).length===1?this.reshapeRequired=!1:this.reshapeRequired=!0}call(t,n){return Z(()=>{if(t=t,this.reshapeRequired){const r=[],i=t.map(s=>s.rank);if(i.indexOf(null)===-1){const s=zf(i);for(let o of t){const a=o.rank;for(let u=0;u<s-a;++u)o=jw(o,1);r.push(o)}return this.mergeFunction(r)}else{let s=!1;for(const u of t){const l=u.rank;if(l==null){const c=u.shape,f=c[0],h=c.slice(1).concat([f]);let d=V(u,[f].concat(Sf(c.slice(1))));d=mt(d,[1,0]),d=V(d,h),r.push(d),s=!0}else if(l>1){const c=Da(1,l).concat([0]);r.push(mt(u,c)),s=!0}else r.push(u)}let o=this.mergeFunction(r);const a=o.rank;if(s){if(a==null){const u=o.shape,l=u.length,c=u[l-1],f=[c].concat(u.slice(0,u.length-1));o=V(mt(V(o,[-1,c]),[1,0]),f)}else if(a>1){const u=[a-1].concat(Da(0,a-1));o=mt(o,u)}}return o}}else return this.mergeFunction(t)})}computeOutputShape(t){t=t;let n;t[0]==null?n=null:n=t[0].slice(1);for(let i=1;i<t.length;++i){const s=t[i]==null?null:t[i].slice(1);n=this.computeElementwiseOpOutputShape(n,s)}let r=[];for(const i of t)i!=null&&i[0]!==null&&r.push(i[0]);return r=Cf(r),r.length===1?n=r.concat(n):n=[null].concat(n),n}computeMask(t,n){return Z(()=>{if(n==null)return null;if(!Array.isArray(n))throw new W("`mask` should be an Array");if(!Array.isArray(t))throw new W("`inputs` should be an Array");if(n.length!==t.length)throw new W(`The Array 'inputs' and 'mask' are expected to have the same length, but have different lengths (${t.length} vs ${n.length})`);if(n.every(i=>i==null))return null;n=n.map(i=>i==null?i:hi(i,0));let r=n[0];for(let i=1;i<n.length-1;++i)r=Lu(r,n[i]);return r})}}class Die extends fg{constructor(t){super(t)}mergeFunction(t){return Z(()=>{let n=t[0].clone();for(let r=1;r<t.length;++r)n=ce(n,t[r]);return n})}}Die.className="Add";fe(Die);class Nie extends fg{constructor(t){super(t)}mergeFunction(t){return Z(()=>{let n=t[0].clone();for(let r=1;r<t.length;++r)n=j(n,t[r]);return n})}}Nie.className="Multiply";fe(Nie);class Fie extends fg{constructor(t){super(t)}mergeFunction(t){return Z(()=>{let n=t[0].clone();for(let r=1;r<t.length;++r)n=ce(n,t[r]);return j(1/t.length,n)})}}Fie.className="Average";fe(Fie);class Oie extends fg{constructor(t){super(t)}mergeFunction(t){return Z(()=>{let n=t[0];for(let r=1;r<t.length;++r)n=$c(n,t[r]);return n})}}Oie.className="Maximum";fe(Oie);class Rie extends fg{constructor(t){super(t)}mergeFunction(t){return Z(()=>{let n=t[0];for(let r=1;r<t.length;++r)n=bp(n,t[r]);return n})}}Rie.className="Minimum";fe(Rie);class Mie extends fg{constructor(t){super(t),this.DEFAULT_AXIS=-1,t==null&&(t={}),this.axis=t.axis==null?this.DEFAULT_AXIS:t.axis,this.supportsMasking=!0,this.reshapeRequired=!1}build(t){if(!(Array.isArray(t)&&Array.isArray(t[0]))||t.length===1)throw new W("A `Concatenate` layer should be called on a list of at least 2 inputs");t=t;let n=!0;for(const i of t)if(i!=null){n=!1;break}if(n)return;const r=[];for(let i=0;i<t.length;++i){const s=t[i].slice();s.splice(this.axis,1);let o=!1;for(const a of r)if(bt(a,s)){o=!0;break}o||r.push(s)}if(r.length>1)throw new W("A `Concatenate` layer requires inputs with matching shapes except for the concat axis. Got input shapes: "+JSON.stringify(t))}mergeFunction(t){return Z(()=>F5(t,this.axis))}computeOutputShape(t){if(!(Array.isArray(t)&&Array.isArray(t[0])))throw new W("A `Concatenate` layer should be called on a list of inputs.");const n=t,r=n[0].slice(),i=this.axis<0?r.length+this.axis:this.axis;for(const s of n.slice(1)){if(r[i]==null||s[i]==null){r[i]=null;break}r[i]+=s[i]}return r}computeMask(t,n){if(n==null)return null;if(!Array.isArray(n))throw new W("`mask` should be an array for Concatenate");if(!Array.isArray(t))throw new W("`inputs` should be an array for Concatenate");if(n.length!==t.length)throw new W(`Mismatch in the length of mask (${n.length}) and the legnth of inputs (${t.length})`);return Z(()=>{let r=!0;if(n.forEach(o=>{if(o!=null){r=!1;return}}),r)return null;const i=[];for(let o=0;o<t.length;++o)n[o]==null?i.push(we(io(t[o]),"bool")):n[o].rank<t[o].rank?i.push(hi(n[o],-1)):i.push(n[o]);const s=lr(i,this.axis);return hB(s,-1,!1)})}getConfig(){const t={axis:this.axis},n=super.getConfig();return Object.assign(t,n),t}}Mie.className="Concatenate";fe(Mie);function Wy(e,t){for(;e<0;)e+=t;return e}function KFe(e,t,n){if(e.shape.length>3||t.shape.length>3)throw new tt("batchDot is not implemented for tensors of 4D or higher rank yet");if(N(e.shape.length>=2,()=>`batchDot requires the rank of x to be >= 2, but got ${e.shape.length}`),N(e.shape.length>=2,()=>`batchDot requires the rank of y to be >= 2, but got ${t.shape.length}`),typeof n=="number"&&(n=[n,n]),e.dtype==="complex64"||t.dtype==="complex64")throw new tt("batchDot is not implemented for complex64-type Tensors yet.");const r=e.shape.length,i=t.shape.length;n==null&&(n=[r-1,i-2]);const s=n;return Z(()=>{let o;if(r>i){o=r-i;const u=[];for(let l=0;l<o;++l)u.push(1);t=V(t,t.shape.concat(u))}else if(i>r){o=i-r;const u=[];for(let l=0;l<o;++l)u.push(1);e=V(e,e.shape.concat(u))}else o=0;let a;if(e.shape.length===2&&t.shape.length===2)s[0]===s[1]?a=Ae(j(e,t),s[0]):a=Ae(j(mt(e,[1,0]),t),s[1]);else{const u=s[0]!==e.shape.length-1,l=s[1]===t.shape.length-1;a=ot(e,t,u,l)}if(o>0){let u;r>i?u=r+i-3:u=r-1;const l=[];for(let c=u;c<u+o;++c)l.push(c);a=ug(a,l)}return a.shape.length===1&&(a=hi(a,1)),a})}class Lie extends fg{constructor(t){super(t),this.axes=t.axes,this.normalize=t.normalize==null?!1:t.normalize,this.supportsMasking=!0,this.reshapeRequired=!1}build(t){N(Array.isArray(t)&&t.length===2&&Array.isArray(t[0])&&Array.isArray(t[1]),()=>"A `Dot` layer should be called on a list of exactly 2 inputs.");const n=t[0],r=t[1];if(n.length>3||r.length>3)throw new tt("Dot layer does not support tensors of 4D or higher rank yet.");const i=this.interpretAxes(n,r);if(n[i[0]]!==r[i[1]])throw new W(`Dimension incompatibility: ${n[i[0]]} !== ${r[i[1]]}`)}mergeFunction(t){if(t.length!==2)throw new W(`A \`Dot\` layer must be called on exactly 2 inputs, but received ${t.length} input(s).`);let n=t[0],r=t[1],i;return Array.isArray(this.axes)?i=this.axes.map((s,o)=>Wy(s,t[o].shape.length)):i=[Wy(this.axes,n.shape.length),Wy(this.axes,r.shape.length)],this.normalize&&(n=Vk(n,i[0]),r=Vk(r,i[1])),KFe(n,r,i)}interpretAxes(t,n){let r;return Array.isArray(this.axes)?r=this.axes:r=[Wy(this.axes,t.length),Wy(this.axes,n.length)],r}computeOutputShape(t){N(Array.isArray(t)&&t.length===2&&Array.isArray(t[0])&&Array.isArray(t[1]),()=>"A `Dot` layer should be called on a list of exactly 2 inputs.");const n=t[0].slice(),r=t[1].slice();if(n.length>3||r.length>3)throw new tt("Dot layer does not support tensors of 4D or higher rank yet.");const i=this.interpretAxes(n,r);n.splice(i[0],1),r.splice(i[1],1),r.splice(0,1);const s=n.concat(r);return s.length===1&&s.push(1),s}computeMask(t,n){return null}getConfig(){const t={axes:this.axes,normalize:this.normalize},n=super.getConfig();return Object.assign(t,n),t}}Lie.className="Dot";fe(Lie);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class Pie extends ut{constructor(t){super(t),this.supportsMasking=!0,this.stddev=t.stddev}computeOutputShape(t){return t}getConfig(){const t=super.getConfig(),n={stddev:this.stddev};return Object.assign(n,t),n}call(t,n){return Z(()=>{this.invokeCallHook(t,n);const r=Ge(t);return Vw(()=>ce(xI(r.shape,0,this.stddev),r),()=>r,n.training||!1)})}}Pie.className="GaussianNoise";fe(Pie);class Bie extends ut{constructor(t){super(t),this.supportsMasking=!0,this.rate=t.rate}computeOutputShape(t){return t}getConfig(){const t=super.getConfig(),n={rate:this.rate};return Object.assign(n,t),n}call(t,n){return Z(()=>{this.invokeCallHook(t,n);const r=Ge(t);return this.rate>0&&this.rate<1?Vw(()=>{const s=Math.sqrt(this.rate/(1-this.rate));return j(r,xI(r.shape,1,s))},()=>r,n.training||!1):r})}}Bie.className="GaussianDropout";fe(Bie);class zie extends ut{constructor(t){super(t),this.supportsMasking=!0,this.rate=t.rate,this.noiseShape=t.noiseShape}_getNoiseShape(t){return this.noiseShape||Ge(t).shape}computeOutputShape(t){return t}getConfig(){const t=super.getConfig(),n={rate:this.rate};return Object.assign(n,t),n}call(t,n){return Z(()=>{if(this.rate<1&&this.rate>0){const r=this._getNoiseShape(t);return Vw(()=>{const s=Ge(t),o=1.6732632423543772,a=1.0507009873554805,u=-o*a;let l=_h(ag(r),this.rate);l=Su(l,"float32");const c=((1-this.rate)*(1+this.rate*u**2))**-.5,f=-c*u*this.rate,h=ce(j(s,l),j(ce(l,-1),u));return ce(j(h,c),f)},()=>Ge(t),n.training||!1)}return t})}}zie.className="AlphaDropout";fe(zie);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Qx(e,t,n,r,i,s=.001){let o;if(e.rank===2)o=dte(e,t,n,r,i,s);else if(e.rank===3)o=pte(e,t,n,r,i,s);else if(e.rank===4)o=gte(e,t,n,r,i,s);else throw new tt(`batchNormalization is not implemented for array of rank ${e.rank} yet`);return o}function ZFe(e,t,n,r,i=.001){return Z(()=>{const s=XT(e,r),o=s.mean,a=s.variance;return[Qx(e,o,a,n,t,i),o,a]})}function JFe(e,t,n,r,i=.001){return Z(()=>{const s=XT(e,r),o=s.mean,a=s.variance,u=[];for(const p of Da(0,e.rank))r.indexOf(p)!==-1?u.push(1):u.push(e.shape[p]);const l=V(o,u),c=V(a,u),f=t==null?null:V(t,u),h=n==null?null:V(n,u);return[Qx(e,l,c,h,f,i),o,a]})}function QFe(e,t,n,r,i=.001){return bt(r.slice().sort(),Da(0,e.rank-1))?ZFe(e,t,n,r,i):JFe(e,t,n,r,i)}class Uie extends ut{constructor(t){t==null&&(t={}),super(t),this.supportsMasking=!0,this.axis=t.axis==null?-1:t.axis,this.momentum=t.momentum==null?.99:t.momentum,this.epsilon=t.epsilon==null?.001:t.epsilon,this.center=t.center==null?!0:t.center,this.scale=t.scale==null?!0:t.scale,this.betaInitializer=pn(t.betaInitializer||"zeros"),this.gammaInitializer=pn(t.gammaInitializer||"ones"),this.movingMeanInitializer=pn(t.movingMeanInitializer||"zeros"),this.movingVarianceInitializer=pn(t.movingVarianceInitializer||"ones"),this.betaConstraint=Kn(t.betaConstraint),this.gammaConstraint=Kn(t.gammaConstraint),this.betaRegularizer=gn(t.betaRegularizer),this.gammaRegularizer=gn(t.gammaRegularizer)}build(t){t=kt(t);const n=this.axis>=0?this.axis:this.axis+t.length,r=t[n];if(r==null)throw new W(`Axis ${n} of input tensor should have a defined dimension but the layer received an input with shape ${JSON.stringify(t)}.`);this.inputSpec=[new Xn({ndim:t.length,axes:{[n]:r}})];const i=[r];this.scale&&(this.gamma=this.addWeight("gamma",i,null,this.gammaInitializer,this.gammaRegularizer,!0,this.gammaConstraint)),this.center&&(this.beta=this.addWeight("beta",i,null,this.betaInitializer,this.betaRegularizer,!0,this.betaConstraint)),this.movingMean=this.addWeight("moving_mean",i,null,this.movingMeanInitializer,null,!1),this.movingVariance=this.addWeight("moving_variance",i,null,this.movingVarianceInitializer,null,!1),this.built=!0}call(t,n){return Z(()=>{const r=n.training==null?!1:n.training,i=Ge(t),s=i.shape,o=s.length,a=Da(0,o),u=this.axis>=0?this.axis:this.axis+o;a.splice(u,1);const l=vp(1,o);l[u]=s[u];const c=a.slice();c.sort();const f=!bt(c,Da(0,o).slice(0,o-1)),h=()=>{if(f){const b=V(this.movingMean.read(),l),v=V(this.movingVariance.read(),l),x=this.center?V(this.beta.read(),l):null,w=this.scale?V(this.gamma.read(),l):null;return Qx(i,b,v,x,w,this.epsilon)}else return Qx(i,this.movingMean.read(),this.movingVariance.read(),this.beta==null?null:this.beta.read(),this.gamma==null?null:this.gamma.read(),this.epsilon)};if(!r)return h();const[d,p,g]=QFe(i,this.gamma.read(),this.beta.read(),a,this.epsilon),m=(b,v,x)=>{Z(()=>{const w=1-x,C=b.read(),$=j(_e(C,v),w);b.write(_e(C,$))})};return(()=>{m(this.movingMean,p,this.momentum),m(this.movingVariance,g,this.momentum)})(),d})}getConfig(){const t={axis:this.axis,momentum:this.momentum,epsilon:this.epsilon,center:this.center,scale:this.scale,betaInitializer:vn(this.betaInitializer),gammaInitializer:vn(this.gammaInitializer),movingMeanInitializer:vn(this.movingMeanInitializer),movingVarianceInitializer:vn(this.movingVarianceInitializer),betaRegularizer:Yt(this.betaRegularizer),gammaRegularizer:Yt(this.gammaRegularizer),betaConstraint:Yn(this.betaConstraint),gammaConstraint:Yn(this.gammaConstraint)},n=super.getConfig();return Object.assign(t,n),t}}Uie.className="BatchNormalization";fe(Uie);class jie extends ut{constructor(t){if(t==null&&(t={}),super(t),this.axis=t.axis==null?-1:t.axis,typeof this.axis=="number"){if(!Number.isInteger(this.axis))throw new Error(`Expected axis to be an integer, but received ${this.axis}`)}else if(Array.isArray(this.axis)){for(const n of this.axis)if(!Number.isInteger(n))throw new Error(`Expected axis to be an array of integers, but received ${JSON.stringify(this.axis)}`)}else throw new Error(`Expected axis to be an integer or an array of integers, but received ${JSON.stringify(this.axis)}`);this.epsilon=t.epsilon==null?.001:t.epsilon,this.center=t.center==null?!0:t.center,this.scale=t.scale==null?!0:t.scale,this.betaInitializer=pn(t.betaInitializer||"zeros"),this.gammaInitializer=pn(t.gammaInitializer||"ones"),this.betaRegularizer=gn(t.betaRegularizer),this.gammaRegularizer=gn(t.gammaRegularizer),this.supportsMasking=!0}build(t){t=kt(t);const n=t.length;typeof this.axis=="number"&&(this.axis=[this.axis]);for(let s=0;s<this.axis.length;++s)this.axis[s]<0&&(this.axis[s]+=n);for(const s of this.axis)if(s<0||s>=n)throw new Error(`Invalid axis: ${s}`);if(this.axis.length!==Cf(this.axis).length)throw new Error(`Found duplicate axes in: ${this.axis}`);const r=this.axis.map(s=>t[s]),i=!0;this.scale?this.gamma=this.addWeight("gamma",r,"float32",this.gammaInitializer,this.gammaRegularizer,i):this.gamma=null,this.center?this.beta=this.addWeight("beta",r,"float32",this.betaInitializer,this.betaRegularizer,i):this.beta=null,this.built=!0}call(t,n){const r=Ge(t),i=r.shape,s=i.length;return Z(()=>{let{mean:a,variance:u}=XT(r,this.axis,!0);const l=vp(1,s);for(const g of this.axis)l[g]=i[g];const c=g=>g!=null&&g.shape.length!==s?V(g,l):g;let f=this.scale?c(this.gamma.read()):null,h=this.center?c(this.beta.read()):null;const d=[],p=[];for(let g=0;g<s;++g)this.axis.indexOf(g)!==-1?(d.push(i[g]),p.push(1)):(d.push(1),p.push(i[g]));return a=So(a,d),u=So(u,d),f!=null&&(f=So(f,p)),h!=null&&(h=So(h,p)),Qx(r,a,u,h,f,this.epsilon)})}getConfig(){const t={axis:this.axis,epsilon:this.epsilon,center:this.center,scale:this.scale,betaInitializer:vn(this.betaInitializer),gammaInitializer:vn(this.gammaInitializer),betaRegularizer:Yt(this.betaRegularizer),gammaRegularizer:Yt(this.gammaRegularizer)},n=super.getConfig();return Object.assign(t,n),t}}jie.className="LayerNormalization";fe(jie);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function e3e(e,t,n){return Z(()=>{if(e.rank!==4)throw new W(`temporalPadding expects input tensor to be 4-D, but received a ${e.rank}-D tensor.`);if(t==null&&(t=[[1,1],[1,1]]),t.length!==2||t[0].length!==2||t[1].length!==2)throw new W("spatial2dPadding expects `padding` to be an Array of two Arrays, each of which is an Array of two integers.");if(n==null&&(n=Na()),n!=="channelsLast"&&n!=="channelsFirst")throw new W(`Unknown data format: ${n}. Supported data formats are 'channelsLast' and 'channelsFirst.`);let r;return n==="channelsFirst"?r=[[0,0],[0,0],t[0],t[1]]:r=[[0,0],t[0],t[1],[0,0]],Ah(e,r)})}class Wie extends ut{constructor(t){if(t==null&&(t={}),super(t),this.dataFormat=t.dataFormat==null?Na():t.dataFormat,t.padding==null)this.padding=[[1,1],[1,1]];else if(typeof t.padding=="number")this.padding=[[t.padding,t.padding],[t.padding,t.padding]];else{if(t.padding=t.padding,t.padding.length!==2)throw new W(`ZeroPadding2D expects padding to be a length-2 array, but received a length-${t.padding.length} array.`);let n,r;if(typeof t.padding[0]=="number")n=[t.padding[0],t.padding[0]],r=[t.padding[1],t.padding[1]];else{if(t.padding=t.padding,t.padding[0].length!==2)throw new W(`ZeroPadding2D expects height padding to be a length-2 array, but received a length-${t.padding[0].length} array.`);if(n=t.padding[0],t.padding[1].length!==2)throw new W(`ZeroPadding2D expects width padding to be a length-2 array, but received a length-${t.padding[1].length} array.`);r=t.padding[1]}this.padding=[n,r]}this.inputSpec=[new Xn({ndim:4})]}computeOutputShape(t){t=kt(t);let n,r;return this.dataFormat==="channelsFirst"?(t[2]!=null&&t[2]>=0?n=t[2]+this.padding[0][0]+this.padding[0][1]:n=null,t[3]!=null&&t[3]>=0?r=t[3]+this.padding[1][0]+this.padding[1][1]:r=null,[t[0],t[1],n,r]):(t[1]!=null&&t[1]>=0?n=t[1]+this.padding[0][0]+this.padding[0][1]:n=null,t[2]!=null&&t[2]>=0?r=t[2]+this.padding[1][0]+this.padding[1][1]:r=null,[t[0],n,r,t[3]])}call(t,n){return Z(()=>e3e(Ge(t),this.padding,this.dataFormat))}getConfig(){const t={padding:this.padding,dataFormat:this.dataFormat},n=super.getConfig();return Object.assign(t,n),t}}Wie.className="ZeroPadding2D";fe(Wie);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function _I(e,t,n,r,i,s){return Z(()=>{Rn(i),ure(s),co(r),n==null&&(n=[1,1]),r==null&&(r="valid"),i==null&&(i=Na()),s==null&&(s="max"),e=q5(e,i);let o;const a=r==="same"?"same":"valid";return s==="max"?o=qT(e,t,n,a):o=BT(e,t,n,a),i==="channelsFirst"&&(o=mt(o,[0,3,1,2])),o})}function Vie(e,t,n,r,i,s){return Z(()=>{Rn(i),ure(s),co(r),n==null&&(n=[1,1,1]),r==null&&(r="valid"),i==null&&(i=Na()),s==null&&(s="max"),e=uie(e,i);let o;const a=r==="same"?"same":"valid";return s==="max"?o=Ute(e,t,n,a):o=hte(e,t,n,a),i==="channelsFirst"&&(o=mt(o,[0,4,1,2,3])),o})}class Gie extends ut{constructor(t){if(t.poolSize==null&&(t.poolSize=2),super(t),typeof t.poolSize=="number")this.poolSize=[t.poolSize];else if(Array.isArray(t.poolSize)&&t.poolSize.length===1&&typeof t.poolSize[0]=="number")this.poolSize=t.poolSize;else throw new W(`poolSize for 1D convolutional layer must be a number or an Array of a single number, but received ${JSON.stringify(t.poolSize)}`);if(or(this.poolSize,"poolSize"),t.strides==null)this.strides=this.poolSize;else if(typeof t.strides=="number")this.strides=[t.strides];else if(Array.isArray(t.strides)&&t.strides.length===1&&typeof t.strides[0]=="number")this.strides=t.strides;else throw new W(`strides for 1D convolutional layer must be a number or an Array of a single number, but received ${JSON.stringify(t.strides)}`);or(this.strides,"strides"),this.padding=t.padding==null?"valid":t.padding,co(this.padding),this.inputSpec=[new Xn({ndim:3})]}computeOutputShape(t){t=kt(t);const n=Sa(t[1],this.poolSize[0],this.padding,this.strides[0]);return[t[0],n,t[2]]}call(t,n){return Z(()=>{this.invokeCallHook(t,n),t=jw(Ge(t),2);const r=this.poolingFunction(Ge(t),[this.poolSize[0],1],[this.strides[0],1],this.padding,"channelsLast");return ug(r,[2])})}getConfig(){const t={poolSize:this.poolSize,padding:this.padding,strides:this.strides},n=super.getConfig();return Object.assign(t,n),t}}class Hie extends Gie{constructor(t){super(t)}poolingFunction(t,n,r,i,s){return Rn(s),co(i),_I(t,n,r,i,s,"max")}}Hie.className="MaxPooling1D";fe(Hie);class qie extends Gie{constructor(t){super(t)}poolingFunction(t,n,r,i,s){return Rn(s),co(i),_I(t,n,r,i,s,"avg")}}qie.className="AveragePooling1D";fe(qie);class Xie extends ut{constructor(t){if(t.poolSize==null&&(t.poolSize=[2,2]),super(t),this.poolSize=Array.isArray(t.poolSize)?t.poolSize:[t.poolSize,t.poolSize],t.strides==null)this.strides=this.poolSize;else if(Array.isArray(t.strides)){if(t.strides.length!==2)throw new W(`If the strides property of a 2D pooling layer is an Array, it is expected to have a length of 2, but received length ${t.strides.length}.`);this.strides=t.strides}else this.strides=[t.strides,t.strides];or(this.poolSize,"poolSize"),or(this.strides,"strides"),this.padding=t.padding==null?"valid":t.padding,this.dataFormat=t.dataFormat==null?"channelsLast":t.dataFormat,Rn(this.dataFormat),co(this.padding),this.inputSpec=[new Xn({ndim:4})]}computeOutputShape(t){t=kt(t);let n=this.dataFormat==="channelsFirst"?t[2]:t[1],r=this.dataFormat==="channelsFirst"?t[3]:t[2];return n=Sa(n,this.poolSize[0],this.padding,this.strides[0]),r=Sa(r,this.poolSize[1],this.padding,this.strides[1]),this.dataFormat==="channelsFirst"?[t[0],t[1],n,r]:[t[0],n,r,t[3]]}call(t,n){return Z(()=>(this.invokeCallHook(t,n),this.poolingFunction(Ge(t),this.poolSize,this.strides,this.padding,this.dataFormat)))}getConfig(){const t={poolSize:this.poolSize,padding:this.padding,strides:this.strides,dataFormat:this.dataFormat},n=super.getConfig();return Object.assign(t,n),t}}class Yie extends Xie{constructor(t){super(t)}poolingFunction(t,n,r,i,s){return Rn(s),co(i),_I(t,n,r,i,s,"max")}}Yie.className="MaxPooling2D";fe(Yie);class Kie extends Xie{constructor(t){super(t)}poolingFunction(t,n,r,i,s){return Rn(s),co(i),_I(t,n,r,i,s,"avg")}}Kie.className="AveragePooling2D";fe(Kie);class Zie extends ut{constructor(t){if(t.poolSize==null&&(t.poolSize=[2,2,2]),super(t),this.poolSize=Array.isArray(t.poolSize)?t.poolSize:[t.poolSize,t.poolSize,t.poolSize],t.strides==null)this.strides=this.poolSize;else if(Array.isArray(t.strides)){if(t.strides.length!==3)throw new W(`If the strides property of a 3D pooling layer is an Array, it is expected to have a length of 3, but received length ${t.strides.length}.`);this.strides=t.strides}else this.strides=[t.strides,t.strides,t.strides];or(this.poolSize,"poolSize"),or(this.strides,"strides"),this.padding=t.padding==null?"valid":t.padding,this.dataFormat=t.dataFormat==null?"channelsLast":t.dataFormat,Rn(this.dataFormat),co(this.padding),this.inputSpec=[new Xn({ndim:5})]}computeOutputShape(t){t=kt(t);let n=this.dataFormat==="channelsFirst"?t[2]:t[1],r=this.dataFormat==="channelsFirst"?t[3]:t[2],i=this.dataFormat==="channelsFirst"?t[4]:t[3];return n=Sa(n,this.poolSize[0],this.padding,this.strides[0]),r=Sa(r,this.poolSize[1],this.padding,this.strides[1]),i=Sa(i,this.poolSize[2],this.padding,this.strides[2]),this.dataFormat==="channelsFirst"?[t[0],t[1],n,r,i]:[t[0],n,r,i,t[4]]}call(t,n){return Z(()=>(this.invokeCallHook(t,n),this.poolingFunction(Ge(t),this.poolSize,this.strides,this.padding,this.dataFormat)))}getConfig(){const t={poolSize:this.poolSize,padding:this.padding,strides:this.strides,dataFormat:this.dataFormat},n=super.getConfig();return Object.assign(t,n),t}}class Jie extends Zie{constructor(t){super(t)}poolingFunction(t,n,r,i,s){return Rn(s),co(i),Vie(t,n,r,i,s,"max")}}Jie.className="MaxPooling3D";fe(Jie);class Qie extends Zie{constructor(t){super(t)}poolingFunction(t,n,r,i,s){return Rn(s),co(i),Vie(t,n,r,i,s,"avg")}}Qie.className="AveragePooling3D";fe(Qie);class ese extends ut{constructor(t){super(t),this.inputSpec=[new Xn({ndim:3})]}computeOutputShape(t){return[t[0],t[2]]}call(t,n){throw new tt}}class tse extends ese{constructor(t){super(t||{})}call(t,n){return Z(()=>{const r=Ge(t);return kn(r,1)})}}tse.className="GlobalAveragePooling1D";fe(tse);class nse extends ese{constructor(t){super(t||{})}call(t,n){return Z(()=>{const r=Ge(t);return Oo(r,1)})}}nse.className="GlobalMaxPooling1D";fe(nse);class rse extends ut{constructor(t){super(t),this.dataFormat=t.dataFormat==null?"channelsLast":t.dataFormat,Rn(this.dataFormat),this.inputSpec=[new Xn({ndim:4})]}computeOutputShape(t){return t=t,this.dataFormat==="channelsLast"?[t[0],t[3]]:[t[0],t[1]]}call(t,n){throw new tt}getConfig(){const t={dataFormat:this.dataFormat},n=super.getConfig();return Object.assign(t,n),t}}class ise extends rse{call(t,n){return Z(()=>{const r=Ge(t);return this.dataFormat==="channelsLast"?kn(r,[1,2]):kn(r,[2,3])})}}ise.className="GlobalAveragePooling2D";fe(ise);class sse extends rse{call(t,n){return Z(()=>{const r=Ge(t);return this.dataFormat==="channelsLast"?Oo(r,[1,2]):Oo(r,[2,3])})}}sse.className="GlobalMaxPooling2D";fe(sse);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class ose extends ut{constructor(t){super(t),this.layer=t.layer}build(t){this.built=!0}get trainable(){return this.layer!=null?this.layer.trainable:!1}set trainable(t){this.layer!=null&&(this.layer.trainable=t)}get trainableWeights(){return this.layer.trainableWeights}get nonTrainableWeights(){return this.layer.nonTrainableWeights}get updates(){return this.layer._updates}get losses(){return this.layer.losses}getWeights(){return this.layer.getWeights()}setWeights(t){this.layer.setWeights(t)}getConfig(){const t={layer:{className:this.layer.getClassName(),config:this.layer.getConfig()}},n=super.getConfig();return Object.assign(t,n),t}setFastWeightInitDuringBuild(t){super.setFastWeightInitDuringBuild(t),this.layer!=null&&this.layer.setFastWeightInitDuringBuild(t)}static fromConfig(t,n,r={}){const i=n.layer,s=Ql(i,r);delete n.layer;const o={layer:s};return Object.assign(o,n),new t(o)}}class ase extends ose{constructor(t){super(t),this.supportsMasking=!0}build(t){if(t=kt(t),t.length<3)throw new W(`TimeDistributed layer expects an input shape >= 3D, but received input shape ${JSON.stringify(t)}`);this.inputSpec=[{shape:t}];const n=[t[0]].concat(t.slice(2));this.layer.built||(this.layer.build(n),this.layer.built=!0),super.build(t)}computeOutputShape(t){t=kt(t);const n=[t[0]].concat(t.slice(2)),r=this.layer.computeOutputShape(n),i=t[1];return[r[0],i].concat(r.slice(1))}call(t,n){return Z(()=>(t=Ge(t),yie((o,a)=>[Ge(this.layer.call(o,n)),[]],t,[],!1,null,null,!1,!0)[1]))}}ase.className="TimeDistributed";fe(ase);function t3e(e){cg(kNe,"BidirectionalMergeMode",e)}const n3e="concat";class use extends ose{constructor(t){super(t);const n=t.layer.getConfig(),r={};r.className=t.layer.getClassName(),r.config=n,this.forwardLayer=Ql(r),n.goBackwards=n.goBackwards!==!0;const i={};if(i.className=t.layer.getClassName(),i.config=n,this.backwardLayer=Ql(i),this.forwardLayer.name="forward_"+this.forwardLayer.name,this.backwardLayer.name="backward_"+this.backwardLayer.name,this.mergeMode=t.mergeMode===void 0?n3e:t.mergeMode,t3e(this.mergeMode),t.weights)throw new tt("weights support is not implemented for Bidirectional layer yet.");this._stateful=t.layer.stateful,this.returnSequences=t.layer.returnSequences,this.returnState=t.layer.returnState,this.supportsMasking=!0,this._trainable=!0,this.inputSpec=t.layer.inputSpec,this.numConstants=null}get trainable(){return this._trainable}set trainable(t){this._trainable=t,this.forwardLayer!=null&&(this.forwardLayer.trainable=t),this.backwardLayer!=null&&(this.backwardLayer.trainable=t)}getWeights(){return this.forwardLayer.getWeights().concat(this.backwardLayer.getWeights())}setWeights(t){const n=t.length,r=Math.floor(n/2);this.forwardLayer.setWeights(t.slice(0,r)),this.backwardLayer.setWeights(t.slice(r))}computeOutputShape(t){let n=this.forwardLayer.computeOutputShape(t);Array.isArray(n)&&Array.isArray(n[0])||(n=[n]),n=n;let r,i,s;return this.returnState&&(s=n.slice(1)),r=n[0],r=r,this.mergeMode==="concat"?(r[r.length-1]*=2,i=[r]):this.mergeMode==null?i=[r,r.slice()]:i=[r],this.returnState?this.mergeMode==null?i.concat(s).concat(s.slice()):[r].concat(s).concat(s.slice()):Pi(i)}apply(t,n){let r=n==null?null:n.initialState,i=n==null?null:n.constants;n==null&&(n={});const s=mie(t,r,i,this.numConstants);if(t=s.inputs,r=s.initialState,i=s.constants,Array.isArray(t)&&(r=t.slice(1),t=t[0]),(r==null||r.length===0)&&i==null)return super.apply(t,n);const o=[],a=[];if(r!=null){const l=r.length;if(l%2>0)throw new W("When passing `initialState` to a Bidrectional RNN, the state should be an Array containing the states of the underlying RNNs.");n.initialState=r,o.push(...r);const c=r.map(f=>new Xn({shape:f.shape}));this.forwardLayer.stateSpec=c.slice(0,l/2),this.backwardLayer.stateSpec=c.slice(l/2),a.push(...c)}if(i!=null)throw new tt("Support for constants in Bidirectional layers is not implemented yet.");const u=o[0]instanceof bu;for(const l of o)if(l instanceof bu!==u)throw new W("The initial state of a Bidirectional layer cannot be specified as a mix of symbolic and non-symbolic tensors");if(u){const l=[t].concat(o),c=this.inputSpec.concat(a),f=this.inputSpec;this.inputSpec=c;const h=super.apply(l,n);return this.inputSpec=f,h}else return super.apply(t,n)}call(t,n){return Z(()=>{const r=n.initialState;let i,s;if(r==null)i=this.forwardLayer.call(t,n),s=this.backwardLayer.call(t,n);else{const u=r.slice(0,r.length/2),l=r.slice(r.length/2);i=this.forwardLayer.call(t,Object.assign(n,{initialState:u})),s=this.backwardLayer.call(t,Object.assign(n,{initialState:l}))}let o;this.returnState&&(Array.isArray(i)&&(o=i.slice(1).concat(s.slice(1))),i=i[0],s=s[0]),this.returnSequences&&(s=Lo(s,1));let a;return this.mergeMode==="concat"?a=F5([i,s]):this.mergeMode==="sum"?a=ce(i,s):this.mergeMode==="ave"?a=j(.5,ce(i,s)):this.mergeMode==="mul"?a=j(i,s):this.mergeMode==null&&(a=[i,s]),this.returnState?this.mergeMode==null?a.concat(o):[a].concat(o):a})}resetStates(t){this.forwardLayer.resetStates(),this.backwardLayer.resetStates()}build(t){Jd(this.forwardLayer.name,()=>{this.forwardLayer.build(t)}),Jd(this.backwardLayer.name,()=>{this.backwardLayer.build(t)}),this.built=!0}computeMask(t,n){Array.isArray(n)&&(n=n[0]);let r;if(this.returnSequences?this.mergeMode==null?r=[n,n]:r=n:this.mergeMode==null?r=[null,null]:r=null,this.returnState){const s=this.forwardLayer.states.map(o=>null);return Array.isArray(r)?r.concat(s).concat(s):[r].concat(s).concat(s)}else return r}get trainableWeights(){return this.forwardLayer.trainableWeights.concat(this.backwardLayer.trainableWeights)}get nonTrainableWeights(){return this.forwardLayer.nonTrainableWeights.concat(this.backwardLayer.nonTrainableWeights)}setFastWeightInitDuringBuild(t){super.setFastWeightInitDuringBuild(t),this.forwardLayer!=null&&this.forwardLayer.setFastWeightInitDuringBuild(t),this.backwardLayer!=null&&this.backwardLayer.setFastWeightInitDuringBuild(t)}getConfig(){const t={mergeMode:this.mergeMode},n=super.getConfig();return Object.assign(t,n),t}static fromConfig(t,n){const r=Ql(n.layer);if(delete n.layer,n.numConstants!=null)throw new tt("Deserialization of a Bidirectional layer with numConstants present is not supported yet.");const i=n;return i.layer=r,new t(i)}}use.className="Bidirectional";fe(use);/**
 * @license
 * Copyright 2022 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class lse extends ut{constructor(t){super(t),this.scale=t.scale,t.offset?this.offset=t.offset:this.offset=0}getConfig(){const t={scale:this.scale,offset:this.offset},n=super.getConfig();return Object.assign(t,n),t}call(t,n){return Z(()=>(t=Ge(t),t.dtype!=="float32"&&(t=Su(t,"float32")),ce(j(t,this.scale),this.offset)))}}lse.className="Rescaling";fe(lse);/**
 * @license
 * Copyright 2022 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const{resizeBilinear:r3e,cropAndResize:i3e}=yu;class cse extends ut{constructor(t){super(t),this.height=t.height,this.width=t.width}centerCrop(t,n,r,i,s,o,a,u){return Z(()=>{let l,c=!1;const f=n/o,h=r/a,d=(i+n)/o,p=(s+r)/a,g=[f,h,d,p],m=[];t.rank===3?(c=!0,l=ac([t])):l=t;for(let w=0;w<l.shape[0];w++)m.push(g);const y=Zd(m,[m.length,4]),b=Ym(0,m.length,1,"int32"),x=i3e(l,y,b,[i,s],"nearest");return Su(c?Ge(Bf(x)):x,u)})}upsize(t,n,r,i){return Z(()=>{const s=r3e(t,[n,r]);return Su(s,i)})}call(t,n){return Z(()=>{const r=Ge(t),i=r.dtype,s=r.shape,o=s[s.length-3],a=s[s.length-2];let u=0;o!==this.height&&(u=Math.floor((o-this.height)/2));let l=0;return a!==this.width&&(l=Math.floor((a-this.width)/2),l===0&&(l=1)),u>=0&&l>=0?this.centerCrop(r,u,l,this.height,this.width,o,a,i):this.upsize(t,this.height,this.width,i)})}getConfig(){const t={height:this.height,width:this.width},n=super.getConfig();return Object.assign(t,n),t}computeOutputShape(t){t=kt(t);const n=t.length-3,r=t.length-2;return t[n]=this.height,t[r]=this.width,t}}cse.className="CenterCrop";fe(cse);/**
 * @license
 * Copyright 2022 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function s3e(e,t,n,r){let i=Ge(e);if(i.dtype!=="int32"&&(i=Su(i,"int32")),t==="int")return i;const s=i.shape;if(i.rank===0&&(i=hi(i,-1)),t==="oneHot"&&i.shape[i.shape.length-1]!==1&&(i=hi(i,-1)),i.rank>2)throw new W(`When outputMode is not int, maximum output rank is 2 Received outputMode ${t} and input shape ${s} which would result in output rank ${i.rank}.`);const o=["multiHot","oneHot"].includes(t),a=i;let u;if(typeof r<"u"&&t==="count"?u=ZR(a,r,n,o):u=ZR(a,[],n,o),t!=="tfIdf")return u;if(r)return j(u,r);throw new W("When outputMode is 'tfIdf', weights must be provided.")}/**
 * @license
 * Copyright 2022 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class fse extends ut{constructor(t){super(t),this.numTokens=t.numTokens,t.outputMode?this.outputMode=t.outputMode:this.outputMode="multiHot"}getConfig(){const t={numTokens:this.numTokens,outputMode:this.outputMode},n=super.getConfig();return Object.assign(t,n),t}computeOutputShape(t){return t=kt(t),t==null?[this.numTokens]:this.outputMode==="oneHot"&&t[t.length-1]!==1?(t.push(this.numTokens),t):(t[t.length-1]=this.numTokens,t)}call(t,n){return Z(()=>{t=Ge(t),t.dtype!=="int32"&&(t=Su(t,"int32"));let r;if(typeof n.countWeights<"u"){if(this.outputMode!=="count")throw new W(`countWeights is not used when outputMode !== count.
              Received countWeights=${n.countWeights}`);r=Ge(n.countWeights)}const i=Oo(t),s=Gx(t),o=zs(this.numTokens,i).bufferSync().get(0),a=_h(s,0).bufferSync().get(0);if(!(o&&a))throw new W(`Input values must be between 0 < values <= numTokens with numTokens=${this.numTokens}`);return s3e(t,this.outputMode,this.numTokens,r)})}}fse.className="CategoryEncoding";fe(fse);/**
 * @license
 * Copyright 2022 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const o3e=["bilinear","nearest"],rG=new Set(o3e);class hse extends ut{constructor(t){if(super(t),this.height=t.height,this.width=t.width,t.interpolation)if(rG.has(t.interpolation))this.interpolation=t.interpolation;else throw new W(`Invalid interpolation parameter: ${t.interpolation} is not implemented`);else this.interpolation="bilinear";this.cropToAspectRatio=!!t.cropToAspectRatio}computeOutputShape(t){t=kt(t);const n=t[2];return[this.height,this.width,n]}getConfig(){const t={height:this.height,width:this.width,interpolation:this.interpolation,cropToAspectRatio:this.cropToAspectRatio},n=super.getConfig();return Object.assign(t,n),t}call(t,n){return Z(()=>{const r=[this.height,this.width];if(this.interpolation==="bilinear")return yu.resizeBilinear(t,r,!this.cropToAspectRatio);if(this.interpolation==="nearest")return yu.resizeNearestNeighbor(t,r,!this.cropToAspectRatio);throw new Error(`Interpolation is ${this.interpolation} but only ${[...rG]} are supported`)})}}hse.className="Resizing";fe(hse);/**
 * @license
 * Copyright 2023 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class dse{constructor(t){this.seed=t}next(){if(this.seed!==void 0)return this.seed++}}dse.className="RandomSeed";/**
 * @license
 * Copyright 2023 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class pse extends ut{constructor(t){super(t),this.randomGenerator=new dse(t.seed)}getConfig(){const t={seed:this.randomGenerator.seed},n=super.getConfig();return Object.assign(t,n),t}}pse.className="BaseRandomLayer";/**
 * @license
 * Copyright 2023 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const a3e=["bilinear","nearest"],iG=new Set(a3e);class gse extends pse{constructor(t){super(t);const{factor:n,interpolation:r="bilinear"}=t;if(this.factor=n,Array.isArray(this.factor)&&this.factor.length===2)this.widthLower=this.factor[0],this.widthUpper=this.factor[1];else if(!Array.isArray(this.factor)&&this.factor>0)this.widthLower=-this.factor,this.widthUpper=this.factor;else throw new W(`Invalid factor: ${this.factor}. Must be positive number or tuple of 2 numbers`);if(this.widthLower<-1||this.widthUpper<-1)throw new W(`factor must have values larger than -1. Got: ${this.factor}`);if(this.widthUpper<this.widthLower)throw new W(`factor cannot have upper bound less than lower bound.
        Got upper bound: ${this.widthUpper}.
        Got lower bound: ${this.widthLower}
      `);if(r)if(iG.has(r))this.interpolation=r;else throw new W(`Invalid interpolation parameter: ${r} is not implemented`)}getConfig(){const t={factor:this.factor,interpolation:this.interpolation},n=super.getConfig();return Object.assign(t,n),t}computeOutputShape(t){t=kt(t);const n=t[2];return[this.imgHeight,-1,n]}call(t,n){return Z(()=>{const r=Ge(t);this.imgHeight=r.shape[r.shape.length-3];const i=r.shape[r.shape.length-2];this.widthFactor=ag([1],1+this.widthLower,1+this.widthUpper,"float32",this.randomGenerator.next());let s=this.widthFactor.dataSync()[0]*i;s=Math.round(s);const o=[this.imgHeight,s];switch(this.interpolation){case"bilinear":return yu.resizeBilinear(t,o);case"nearest":return yu.resizeNearestNeighbor(t,o);default:throw new Error(`Interpolation is ${this.interpolation}
          but only ${[...iG]} are supported`)}})}}gse.className="RandomWidth";fe(gse);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Bc(e){return new Q5(e)}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const u3e=K();u3e.registerFlag("KEEP_INTERMEDIATE_TENSORS",()=>!1,e=>{e&&console.warn("Keep intermediate tensors is ON. This will print the values of all intermediate tensors during model inference. Not all models support this mode. For details, check e2e/benchmarks/ model_config.js. This significantly impacts performance.")});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * =============================================================================
 */var sG;(function(e){e[e.DT_INVALID=0]="DT_INVALID",e[e.DT_FLOAT=1]="DT_FLOAT",e[e.DT_DOUBLE=2]="DT_DOUBLE",e[e.DT_INT32=3]="DT_INT32",e[e.DT_UINT8=4]="DT_UINT8",e[e.DT_INT16=5]="DT_INT16",e[e.DT_INT8=6]="DT_INT8",e[e.DT_STRING=7]="DT_STRING",e[e.DT_COMPLEX64=8]="DT_COMPLEX64",e[e.DT_INT64=9]="DT_INT64",e[e.DT_BOOL=10]="DT_BOOL",e[e.DT_QINT8=11]="DT_QINT8",e[e.DT_QUINT8=12]="DT_QUINT8",e[e.DT_QINT32=13]="DT_QINT32",e[e.DT_BFLOAT16=14]="DT_BFLOAT16",e[e.DT_QINT16=15]="DT_QINT16",e[e.DT_QUINT16=16]="DT_QUINT16",e[e.DT_UINT16=17]="DT_UINT16",e[e.DT_COMPLEX128=18]="DT_COMPLEX128",e[e.DT_HALF=19]="DT_HALF",e[e.DT_RESOURCE=20]="DT_RESOURCE",e[e.DT_VARIANT=21]="DT_VARIANT",e[e.DT_UINT32=22]="DT_UINT32",e[e.DT_UINT64=23]="DT_UINT64",e[e.DT_FLOAT_REF=101]="DT_FLOAT_REF",e[e.DT_DOUBLE_REF=102]="DT_DOUBLE_REF",e[e.DT_INT32_REF=103]="DT_INT32_REF",e[e.DT_UINT8_REF=104]="DT_UINT8_REF",e[e.DT_INT16_REF=105]="DT_INT16_REF",e[e.DT_INT8_REF=106]="DT_INT8_REF",e[e.DT_STRING_REF=107]="DT_STRING_REF",e[e.DT_COMPLEX64_REF=108]="DT_COMPLEX64_REF",e[e.DT_INT64_REF=109]="DT_INT64_REF",e[e.DT_BOOL_REF=110]="DT_BOOL_REF",e[e.DT_QINT8_REF=111]="DT_QINT8_REF",e[e.DT_QUINT8_REF=112]="DT_QUINT8_REF",e[e.DT_QINT32_REF=113]="DT_QINT32_REF",e[e.DT_BFLOAT16_REF=114]="DT_BFLOAT16_REF",e[e.DT_QINT16_REF=115]="DT_QINT16_REF",e[e.DT_QUINT16_REF=116]="DT_QUINT16_REF",e[e.DT_UINT16_REF=117]="DT_UINT16_REF",e[e.DT_COMPLEX128_REF=118]="DT_COMPLEX128_REF",e[e.DT_HALF_REF=119]="DT_HALF_REF",e[e.DT_RESOURCE_REF=120]="DT_RESOURCE_REF",e[e.DT_VARIANT_REF=121]="DT_VARIANT_REF",e[e.DT_UINT32_REF=122]="DT_UINT32_REF",e[e.DT_UINT64_REF=123]="DT_UINT64_REF"})(sG||(sG={}));var oG;(function(e){(function(t){t[t.LEGACY=0]="LEGACY",t[t.V1=1]="V1",t[t.V2=2]="V2"})(e.CheckpointFormatVersion||(e.CheckpointFormatVersion={}))})(oG||(oG={}));/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * =============================================================================
 */var aG;(function(e){e[e.FAIL=0]="FAIL",e[e.SHORTEST=1]="SHORTEST",e[e.LONGEST=2]="LONGEST"})(aG||(aG={}));/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Te(e,t){Array.isArray(e)||(e=[e]),e.forEach(n=>{n!=null&&N(n.dtype!=="complex64",()=>`${t} does not support complex64 tensors in the CPU backend.`)})}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const l3e=iI;class AI extends AA{nextDataId(){return AI.nextDataId++}constructor(){super(),this.blockSize=48,this.firstUse=!0,this.data=new KP(this,aa())}write(t,n,r){this.firstUse&&(this.firstUse=!1,K().get("IS_NODE")&&Hs(`
============================
Hi, looks like you are running TensorFlow.js in Node.js. To speed things up dramatically, install our node backend, visit https://github.com/tensorflow/tfjs-node for more details. 
============================`));const i={id:this.nextDataId()};return this.data.set(i,{values:t,dtype:r,refCount:1}),i}makeTensorInfo(t,n,r){let i;if(n==="string"&&r!=null&&r.length>0&&mu(r[0])){const s=r.map(o=>wu(o));i=this.write(s,t,n)}else i=this.write(r,t,n);return{dataId:i,shape:t,dtype:n}}refCount(t){return this.data.has(t)?this.data.get(t).refCount:0}incRef(t){const n=this.data.get(t);n.refCount++}decRef(t){if(this.data.has(t)){const n=this.data.get(t);n.refCount--}}move(t,n,r,i,s){this.data.set(t,{values:n,dtype:i,refCount:s})}numDataIds(){return this.data.numDataIds()}async read(t){return this.readSync(t)}readSync(t){const{dtype:n,complexTensorInfos:r}=this.data.get(t);if(n==="complex64"){const i=this.readSync(r.real.dataId),s=this.readSync(r.imag.dataId);return uc(i,s)}return xee(this.data.get(t).values,n)}bufferSync(t){const n=this.readSync(t.dataId);if(t.dtype==="string")try{const r=n.map(i=>oc(i));return rt(t.shape,t.dtype,r)}catch{throw new Error("Failed to decode encoded string bytes into utf-8")}return rt(t.shape,t.dtype,n)}makeOutput(t,n,r){return aa().makeTensorFromTensorInfo(this.makeTensorInfo(n,r,t),this)}disposeData(t,n=!1){if(this.data.has(t)){if(this.data.get(t).refCount--,!n&&this.data.get(t).refCount>0)return!1;const{complexTensorInfos:r}=this.data.get(t);r!=null&&(this.disposeData(r.real.dataId,!0),this.disposeData(r.imag.dataId,!0)),this.data.delete(t)}return!0}disposeIntermediateTensorInfo(t){this.disposeData(t.dataId)}async time(t){const n=ui();return t(),{kernelMs:ui()-n}}memory(){return{unreliable:!0,reasons:["The reported memory is an upper bound. Due to automatic garbage collection, the true allocated memory may be less."]}}where(t){Te([t],"where");const n=this.readSync(t.dataId);return l3e(t.shape,n)}dispose(){}floatPrecision(){return 32}epsilon(){return super.epsilon()}}AI.nextDataId=0;/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mse(e){const t=new Float32Array(e.length);for(let n=0;n<e.length;++n)t[n]=Math.abs(e[n]);return t}const c3e=e=>{const{x:t}=e.inputs,n=e.backend;Te(t,"abs");let r=new Float32Array(te(t.shape));const i=n.data.get(t.dataId).values;return r=mse(i),n.makeOutput(r,t.shape,t.dtype)},f3e={kernelName:E2,backendName:"cpu",kernelFunc:c3e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Mn(e){return(t,n,r,i,s)=>{const o=Ze(t,n),a=o.length,u=Me(o),l=te(o),c=hr(s,l),f=t.length,h=n.length,d=Me(t),p=Me(n),g=yp(t,o),m=yp(n,o);if(g.length+m.length===0)for(let y=0;y<c.length;++y)c[y]=e(r[y%r.length],i[y%i.length]);else for(let y=0;y<c.length;++y){const b=ng(y,a,u),v=b.slice(-f);g.forEach($=>v[$]=0);const x=$a(v,f,d),w=b.slice(-h);m.forEach($=>w[$]=0);const C=$a(w,h,p);c[y]=e(r[x],i[C])}return[c,o]}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ms(e){const{inputs:t,backend:n}=e,{real:r,imag:i}=t,s=n.data.get(r.dataId).values,o=n.data.get(i.dataId).values,a=n.makeTensorInfo(r.shape,"complex64"),u=n.data.get(a.dataId);return u.complexTensorInfos={real:n.makeTensorInfo(r.shape,"float32",s),imag:n.makeTensorInfo(i.shape,"float32",o)},a}const h3e={kernelName:PA,backendName:"cpu",kernelFunc:ms};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Yk(e,t,n="float32"){if(n==="complex64"){const i=Yk(e,t,"float32"),s=Yk(e,t,"float32");return ms({inputs:{real:i,imag:s},backend:e})}const r=Ir(te(t),n);return e.makeTensorInfo(t,n,r)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Pu(e){const{inputs:t,backend:n}=e,{x:r}=t;return n.incRef(r.dataId),{dataId:r.dataId,shape:r.shape,dtype:r.dtype}}const d3e={kernelName:h1,backendName:"cpu",kernelFunc:Pu};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wp(e){const{inputs:t,backend:n}=e,{input:r}=t,i=n.data.get(r.dataId).complexTensorInfos.real,s=n.data.get(i.dataId).values;return n.makeTensorInfo(i.shape,i.dtype,s)}const p3e={kernelName:yT,backendName:"cpu",kernelFunc:wp};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yse(e,t,n,r){if(r==="int32"){const i=Int32Array.from(e);return[t,"int32",i]}if(r==="bool"){const i=Ch([0],n),[s,o]=Mn((a,u)=>a!==u?1:0)(t,[],e,i,"bool");return[o,"bool",s]}throw new Error(`Error in Cast: failed to cast ${n} to ${r}`)}function Vf(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{dtype:s}=r;if(s==="complex64"){if(i.dtype==="complex64")return Pu({inputs:{x:i},backend:n});const c=Yk(n,i.shape,i.dtype),f=Vf({inputs:{x:i},backend:n,attrs:{dtype:"float32"}}),h=ms({inputs:{real:f,imag:c},backend:n});return n.disposeIntermediateTensorInfo(c),n.disposeIntermediateTensorInfo(f),h}if(i.dtype==="complex64"){const c=wp({inputs:{input:i},backend:n}),f=Vf({inputs:{x:c},backend:n,attrs:{dtype:s}});return n.disposeIntermediateTensorInfo(c),f}if(!QP(i.dtype,s)){const c=Pu({inputs:{x:i},backend:n});return{dataId:c.dataId,shape:c.shape,dtype:s}}const o=n.data.get(i.dataId).values,[a,u,l]=yse(o,i.shape,i.dtype,s);return n.makeTensorInfo(a,u,l)}const g3e={kernelName:Q0,backendName:"cpu",kernelFunc:Vf};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Qn(e,t,n,r){return n==null?({inputs:i,backend:s})=>{const{a:o,b:a}=i,u=s;Te([o,a],e);const l=u.data.get(o.dataId).values,c=u.data.get(a.dataId).values,f=o.dtype==="string"?lc(l):l,h=o.dtype==="string"?lc(c):c,d=r||o.dtype,[p,g]=t(o.shape,a.shape,f,h,d);return u.makeTensorInfo(g,d,p)}:({inputs:i,backend:s})=>{const{a:o,b:a}=i,u=s;if(o.dtype==="complex64"||a.dtype==="complex64"){const l=Vf({inputs:{x:o},backend:u,attrs:{dtype:"complex64"}}),c=u.data.get(l.dataId),f=c.complexTensorInfos.real,h=c.complexTensorInfos.imag,d=u.data.get(f.dataId).values,p=u.data.get(h.dataId).values,g=Vf({inputs:{x:a},backend:u,attrs:{dtype:"complex64"}}),m=u.data.get(g.dataId),y=m.complexTensorInfos.real,b=m.complexTensorInfos.imag,v=u.data.get(y.dataId).values,x=u.data.get(b.dataId).values,[w,C,$]=n(o.shape,a.shape,d,p,v,x),S=u.makeTensorInfo($,"float32",w),k=u.makeTensorInfo($,"float32",C),E=ms({inputs:{real:S,imag:k},backend:u});return u.disposeIntermediateTensorInfo(l),u.disposeIntermediateTensorInfo(g),u.disposeIntermediateTensorInfo(S),u.disposeIntermediateTensorInfo(k),E}else{const l=u.data.get(o.dataId).values,c=u.data.get(a.dataId).values,f=r||o.dtype,[h,d]=t(o.shape,a.shape,l,c,f);return u.makeTensorInfo(d,f,h)}}}function e6(e){return(t,n,r,i,s,o)=>{const a=Ze(t,n),u=te(a),l=a.length,c=Me(a),f=hr("float32",u),h=hr("float32",u),d=yp(t,a),p=yp(n,a),g=uc(r,i),m=uc(s,o),y=t.length,b=Me(t),v=n.length,x=Me(n);if(d.length+p.length===0)for(let w=0;w<f.length;w++){const C=w%g.length,$=w%m.length,S=e(g[C*2],g[C*2+1],m[$*2],m[$*2+1]);f[w]=S.real,h[w]=S.imag}else for(let w=0;w<f.length;w++){const C=ng(w,l,c),$=C.slice(-y);d.forEach(D=>$[D]=0);const S=$a($,y,b),k=C.slice(-v);p.forEach(D=>k[D]=0);const E=$a(k,v,x),_=e(g[S*2],g[S*2+1],m[E*2],m[E*2+1]);f[w]=_.real,h[w]=_.imag}return[f,h,a]}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const bse=Mn((e,t)=>e+t),m3e=e6((e,t,n,r)=>({real:e+n,imag:t+r})),Zm=Qn(rg,bse,m3e),y3e={kernelName:rg,backendName:"cpu",kernelFunc:Zm};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function t6(e,t,n,r,i){const s=te(r),o=Ir(i,n);for(let a=0;a<e.length;a++){const u=e[a];if(u<0)throw new Error("Input x must be non-negative!");u>=i||(s>0?o[u]+=t[a]:o[u]+=1)}return o}function xse(e,t,n,r=!1){const i=e.shape[0],s=e.shape[1],o=rt([i,n],t.dtype);for(let a=0;a<i;a++)for(let u=0;u<s;u++){const l=e.get(a,u);if(l<0)throw new Error("Input x must be non-negative!");l>=n||(r?o.set(1,a,l):t.size>0?o.set(o.get(a,l)+t.get(a,u),a,l):o.set(o.get(a,l)+1,a,l))}return o}/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const vse=Mn((e,t)=>e&t),b3e=Qn(O2,vse),x3e={kernelName:O2,backendName:"cpu",kernelFunc:b3e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ju(e){return(t,n,r)=>{const i=En(n,t.length);for(let s=0;s<t.length;++s)i[s]=e(t[s],r);return i}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ut(e,t,n){const r=Ju(t);return Dh(e,r,n)}function Dh(e,t,n){return({inputs:r,attrs:i,backend:s})=>{const{x:o}=r;Te(o,e);const a=s,u=a.data.get(o.dataId).values;let l;if(o.dtype==="string"){if(!Array.isArray(u))throw new Error("String tensor's value was not an instance of Array");l=lc(u)}else l=u;const c=n||o.dtype,f=t(l,c,i);return a.makeTensorInfo(o.shape,c,f)}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wse=Ju(e=>Math.ceil(e)),v3e=Dh(e1,wse),w3e={kernelName:e1,backendName:"cpu",kernelFunc:v3e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $se(e,t,n,r){const i=En(n,te(t));if(r&&n!=="string"){let s=0;e.forEach(o=>{const a=te(o.shape);i.set(o.vals,s),s+=a})}else{let s=0;e.forEach(o=>{const a=n==="string"?lc(o.vals):o.vals;let u=0;for(let l=0;l<o.shape[0];++l){const c=l*t[1]+s;for(let f=0;f<o.shape[1];++f)i[c+f]=a[u++]}s+=o.shape[1]})}return i}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Cse=Mn((e,t)=>e===t?1:0),Sse=Qn(W2,Cse,null,"bool"),$3e={kernelName:W2,backendName:"cpu",kernelFunc:Sse};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const kse=Ju(e=>Math.exp(e)),Ese=Dh(a1,kse,"float32"),C3e={kernelName:a1,backendName:"cpu",kernelFunc:Ese};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _se=Ju(e=>Math.expm1(e)),S3e=Dh(u1,_se),k3e={kernelName:u1,backendName:"cpu",kernelFunc:S3e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ase=Ju(e=>Math.floor(e)),E3e=Dh(l1,Ase),_3e={kernelName:l1,backendName:"cpu",kernelFunc:E3e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Tse=Mn((e,t)=>Math.floor(e/t)),A3e=Qn(c1,Tse,null,"int32"),T3e={kernelName:c1,backendName:"cpu",kernelFunc:A3e};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ise(e,t,n,r,i,s,o,a,u){const l=rt([r,s],n);for(let c=0;c<r;c++){const f=[];let h=0;for(let d=0;d<i;d++){const p=e[c*i+d];h+=p*o[d],f.push(p)}if(h<0||h>=u/s)throw new Error(`Invalid indices: ${f} does not index into ${a}`);for(let d=0;d<s;d++)l.values[c*s+d]=t.get(...t.indexToLoc(h*s+d))}return l}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Dse(e,t,n){const r=rt(n,e.dtype);for(let i=0;i<r.size;++i){const o=r.indexToLoc(i).slice(),a=o[0],u=o[2],l=t.locToIndex([a,u]);o[2]=t.values[l];const c=e.locToIndex(o);0<=c&&c<e.values.length&&(r.values[i]=e.values[c])}return r}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Nse=Mn((e,t)=>e>t?1:0),I3e=Qn(q2,Nse,null,"bool"),D3e={kernelName:q2,backendName:"cpu",kernelFunc:I3e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Fse=Mn((e,t)=>e>=t?1:0),N3e=Qn(f1,Fse,null,"bool"),F3e={kernelName:f1,backendName:"cpu",kernelFunc:N3e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ose=Mn((e,t)=>e<t?1:0),O3e=Qn(Y2,Ose,null,"bool"),R3e={kernelName:Y2,backendName:"cpu",kernelFunc:O3e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Rse=Mn((e,t)=>e<=t?1:0),M3e=Qn(K2,Rse,null,"bool"),L3e={kernelName:K2,backendName:"cpu",kernelFunc:M3e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Mse(e,t,n){const r=(t-e)/(n-1),i=Ir(n,"float32");i[0]=e;for(let s=1;s<i.length;s++)i[s]=i[s-1]+r;return i}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Lse=Ju(e=>Math.log(e)),P3e=Dh(m1,Lse),B3e={kernelName:m1,backendName:"cpu",kernelFunc:P3e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Pse(e,t,n,r){const i=hr(r,te(n));for(let s=0;s<i.length;++s){const o=s*t;let a=e[o];for(let u=0;u<t;++u){const l=e[o+u];(Number.isNaN(l)||l>a)&&(a=l)}i[s]=a}return i}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Bse=Mn((e,t)=>Math.max(e,t)),z3e=Qn(b1,Bse),U3e={kernelName:b1,backendName:"cpu",kernelFunc:z3e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const zse=Mn((e,t)=>Math.min(e,t)),j3e=Qn(x1,zse),W3e={kernelName:x1,backendName:"cpu",kernelFunc:j3e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const n6=Mn((e,t)=>e*t),V3e=e6((e,t,n,r)=>({real:e*n-t*r,imag:e*r+t*n})),TI=Qn(w1,n6,V3e),G3e={kernelName:w1,backendName:"cpu",kernelFunc:TI};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Use(e,t,n){const r=xc(-1,n);return n6([],t,r,e,n)}function H3e(e){const{inputs:t,backend:n}=e,{x:r}=t;Te(r,"neg");const i=n.data.get(r.dataId).values,[s,o]=Use(i,r.shape,r.dtype);return n.makeTensorInfo(o,r.dtype,s)}const q3e={kernelName:aw,backendName:"cpu",kernelFunc:H3e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const jse=Mn((e,t)=>e!==t?1:0),X3e=Qn(uw,jse,null,"bool"),Y3e={kernelName:uw,backendName:"cpu",kernelFunc:X3e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function r6(e,t,n,r,i){const s=t.length,o=te(t),a=Me(t),u=Me(i),l=hr(n,te(i));for(let c=0;c<o;++c){const f=ng(c,s,a),h=new Array(f.length);for(let p=0;p<h.length;p++)h[p]=f[r[p]];const d=$a(h,s,u);l[d]=e[c]}return l}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Yi(e){const{inputs:t,attrs:n,backend:r}=e,{x:i}=t,{perm:s}=n;Te(i,"transpose");const o=i.shape.length,a=new Array(o);for(let f=0;f<a.length;f++)a[f]=i.shape[s[f]];const u=r.data.get(i.dataId).values,l=r6(u,i.shape,i.dtype,s,a);return{dataId:r.write(l,a,i.dtype),shape:a,dtype:i.dtype}}const K3e={kernelName:Kd,backendName:"cpu",kernelFunc:Yi};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Wse(e,t,n,r){const[i,s]=pr(e,r),o=qi(t,"int32"),a=Ir(te(i),o),u=te(s);for(let l=0;l<a.length;++l){const c=l*u;let f=1;for(let h=0;h<u;++h)f*=n[c+h];a[l]=f}return{outVals:a,outShape:i,outDtype:o}}function Z3e(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{axis:s,keepDims:o}=r;Te(i,"prod");const a=i.shape.length,u=st(s,i.shape),l=Cn(u,a);let c=u,f=i;const h=[];l!=null&&(f=Yi({inputs:{x:i},backend:n,attrs:{perm:l}}),h.push(f),c=On(c.length,a));const d=n.data.get(f.dataId).values,{outVals:p,outShape:g,outDtype:m}=Wse(f.shape,f.dtype,d,c);let y=g;return o&&(y=Fn(g,u)),h.forEach(b=>n.disposeIntermediateTensorInfo(b)),n.makeTensorInfo(y,m,p)}const J3e={kernelName:pw,backendName:"cpu",kernelFunc:Z3e};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Q3e(e,t,n){e.forEach((r,i)=>{if(r<0||r>=n){const s=ng(i,t.length,Me(t)).join(",");throw new Error(`indices[${s}] = ${r} is not in [0, ${n})`)}})}function eOe(e,t){for(let n=0;n<e.length;++n){const r=e[n],i=n===e.length-1?t:e[n+1].length;if(r.length===0)throw new Error("Ragged splits may not be empty");if(r[0]<0)throw new Error("Ragged splits must be non-negative");if(r[r.length-1]>i)throw new Error("Ragged splits must not point past values");for(let s=1;s<r.length;++s)if(r[s-1]>r[s])throw new Error("Ragged splits must be sorted in ascending order")}}function tOe(e,t,n,r){const i=[];let s=0;const o=t.length-1+n.length,a=new Array(o).fill(null).map(()=>[0]);eOe(n,r);let u=1;for(let l=0;l<t.length-1;++l){u*=t[l];const c=t[l+1];for(let f=1;f<u+1;++f)a[l].push(f*c)}for(let l=0;l<e.length;++l){let c=e[l],f=e[l]+1;for(let h=0;h<n.length;++h){const d=n[h],p=h+t.length-1;if(p>=0){const g=a[p],m=g[g.length-1]-d[c];for(let y=c;y<f;++y)a[p].push(d[y+1]+m)}c=d[c],f=d[f]}f!==c&&(i.push([c,f]),s+=f-c)}return{outSplits:a,valueSlices:i,numValues:s}}function nOe(e){const t=[];for(let n=0;n<e.length;++n){const r=e[n].length,i=En("int32",r);t.push(i),e[n].forEach((s,o)=>i[o]=s)}return t}function uG(e,t){const n=e.slice(0,t);for(;n.length<t;)n.push(1);for(let r=t;r<e.length;r++)n[t-1]*=e[r];return n}function rOe(e,t,n,r,i,s){const o=uG(t,2)[1],a=uG(s,2)[1];let u=0;for(const l of n)for(let c=l[0];c<l[1];++c){for(let f=0;f<r;++f)i[u*a+f]=e[c*o+f];++u}}function iOe(e,t,n,r,i){const s=t.slice();s[0]=i;const o=En(n,te(s)),a=e.length,u=a===0?0:a/t[0];return rOe(e,t,r,u,o,s),[o,s]}function Vse(e,t,n,r,i,s,o,a){if(e.length===0)throw new Error("paramsNestedSplits must be non empty");if(t[0].length===0)throw new Error("Split tensors must not be scalars");const u=t[0][0]-1;if(Q3e(s,o,u),r.length===0)throw new Error("params.rank must be nonzero");const l=r[0],{outSplits:c,valueSlices:f,numValues:h}=tOe(s,o,e,l),d=nOe(c),p=iOe(n,r,i,f,h);return[d,p[0],p[1]]}/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lG=2147483647;function Gse(e,t,n,r,i,s,o){if(t.length>1)throw new Error("starts must be a scalar or vector");if(i.length>1)throw new Error("limits must be a scalar or vector");if(o.length>1)throw new Error("deltas must be a scalar or vector");const a=t.length===0,u=i.length===0,l=o.length===0,c=[];a||c.push(t[0]),u||c.push(i[0]),l||c.push(o[0]);for(let m=1;m<c.length;++m)if(c[m]!==c[m-1])throw new Error("starts, limits, and deltas must have the same shape");const f=c.length===0?1:c[0],h=En("int32",f+1);h[0]=0;for(let m=0;m<f;++m){const y=a?e[0]:e[m],b=u?r[0]:r[m],v=l?s[0]:s[m];if(v===0)throw new Error("Requires delta != 0");let x;if(v>0&&b<y||v<0&&b>y)x=0;else if(x=Math.ceil(Math.abs((b-y)/v)),x>lG)throw new Error(`Requires ((limit - start) / delta) <= ${lG}`);h[m+1]=h[m]+x}const d=h[f],p=En(n,d);let g=0;for(let m=0;m<f;++m){const y=h[m+1]-h[m];let b=a?e[0]:e[m];const v=l?s[0]:s[m];for(let x=0;x<y;++x)p[g++]=b,b+=v}return[h,p]}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var mo=fa;class Kk{constructor(t,n,r,i,s,o,a,u,l,c){this.shape=t,this.shapeShape=n,this.values=r,this.valuesShape=i,this.valuesDType=s,this.defaultValue=o,this.defaultValueShape=a,this.rowPartitionValues=u,this.rowPartitionValuesShapes=l,this.rowPartitionTypes=Nne(c),this.raggedRank=Fne(this.rowPartitionTypes)}getRowPartitionTypeByDimension(t){return this.rowPartitionTypes[0]===mo.FIRST_DIM_SIZE?this.rowPartitionTypes[t+1]:this.rowPartitionTypes[t]}getRowPartitionTensor(t){return this.rowPartitionTypes[0]===mo.FIRST_DIM_SIZE?this.rowPartitionValues[t+1]:this.rowPartitionValues[t]}getMaxWidth(t){const n=this.getRowPartitionTensor(t-1);switch(this.getRowPartitionTypeByDimension(t-1)){case mo.VALUE_ROWIDS:return Kk.getMaxWidthValueRowID(n);case mo.ROW_SPLITS:return Kk.getMaxWidthRowSplit(n);default:throw new Error(`Cannot handle partition type ${mo[this.getRowPartitionTypeByDimension(t-1)]}`)}}static getMaxWidthRowSplit(t){const n=t.length;if(n===0||n===1)return 0;let r=0;for(let i=0;i<n-1;++i){const s=t[i+1]-t[i];s>r&&(r=s)}return r}static getMaxWidthValueRowID(t){const n=t.length;if(n===0)return 0;let r=0,i=t[0],s=0;for(let o=1;o<n;++o){const a=t[o];a!==i&&(i=a,s=Math.max(o-r,s),r=o)}return Math.max(n-r,s)}tensorShapeFromTensor(t,n,r=!0){if(n.length===0){if(t[0]===-1)return[];throw new Error("The only valid scalar shape tensor is the fully unknown shape specified as -1.")}return fG(t,r)}calculateOutputSize(t){const n=this.valuesShape,r=this.defaultValueShape;One(r,n);const i=this.tensorShapeFromTensor(this.shape,this.shapeShape),o=Dne(this.raggedRank,i,n);o[0]<0&&(o[0]=t);for(let a=1;a<=this.raggedRank;++a)o[a]<0&&(o[a]=this.getMaxWidth(a));return o}calculateFirstParentOutputIndex(t,n,r){const i=Math.min(t,r),s=[];let o=0;for(let a=0;a<i;++a,o+=n)s.push(o);for(let a=i;a<t;++a)s.push(-1);return N(s.length===t,()=>"Final length of result must be equal to firstDimension."),s}calculateOutputIndexRowSplit(t,n,r,i){const s=t.length,o=[];for(let a=0;a<s-1;++a){const u=t[a+1]-t[a];let l=Math.min(i,u),c=n[a];c===-1&&(l=0);for(let f=0;f<l;++f)o.push(c),c+=r;for(let f=0;f<u-l;++f)o.push(-1)}if(s>0&&o.length!==t[s-1])throw new Error("Invalid row split size.");return o}calculateOutputIndexValueRowID(t,n,r,i){const s=t.length,o=[];if(s===0)return[];let a=0,u=t[0];if(u>=n.length)throw new Error(`Got currentValueRowId=${u}, which is not less than ${n.length}`);let l=n[u];o.push(l);for(let c=1;c<s;++c){const f=t[c];if(f===u)l>=0&&(++a,a<i?l+=r:l=-1);else{if(a=0,u=f,f>=n.length)throw new Error(`Got nextValueRowId=${f} which is not less than ${n.length}`);l=n[f]}o.push(l)}if(o.length!==t.length)throw new Error("Invalid row ids.");return o}calculateOutputIndex(t,n,r,i){const s=this.getRowPartitionTensor(t),o=this.getRowPartitionTypeByDimension(t);switch(o){case mo.VALUE_ROWIDS:return this.calculateOutputIndexValueRowID(s,n,r,i);case mo.ROW_SPLITS:if(s.length-1>n.length)throw new Error(`Row partition size is greater than output size: ${s.length-1} > ${n.length}`);return this.calculateOutputIndexRowSplit(s,n,r,i);default:throw new Error(`Unsupported partition type: ${mo[o]}`)}}getFirstDimensionSize(){const t=this.rowPartitionValues[0];if(this.rowPartitionTypes.length===0)throw new Error("No row_partition_types given.");const n=this.rowPartitionTypes[0];switch(n){case mo.FIRST_DIM_SIZE:return t[0];case mo.VALUE_ROWIDS:throw new Error("Cannot handle VALUE_ROWIDS in first dimension.");case mo.ROW_SPLITS:return this.rowPartitionValuesShapes[0][0]-1;default:throw new Error(`Cannot handle type ${mo[n]}`)}}compute(){if(this.rowPartitionValues[0].length<=0)throw new Error("Invalid first partition input. Tensor requires at least one element.");const n=this.getFirstDimensionSize(),r=this.calculateOutputSize(n),i=new Array(this.raggedRank+1);i[i.length-1]=1;for(let u=i.length-2;u>=0;--u)i[u]=i[u+1]*r[u+1];const s=fG(r,!1),o=En(this.valuesDType,te(s));if(i[0]*r[0]>0){let u=this.calculateFirstParentOutputIndex(n,i[0],r[0]);for(let l=1;l<=this.raggedRank;++l)u=this.calculateOutputIndex(l-1,u,i[l],r[l]);this.setOutput(this.raggedRank,u,o,s)}return[s,o]}setOutput(t,n,r,i){if(r.length===0)return;const s=this.values,o=r;let a=i.slice();a=a.slice(t+1);const u=te(a),l=n.length;let c=this.defaultValue;if(c.length!==u&&c.length!==1){const p=this.defaultValueShape;Z(()=>{const g=V(c,p);c=_m(g,a).dataSync()})}let f=0,h=0,d=0;for(let p=0;p<=l;++p){let g=p<l?n[p]:-1;if(g===d){++d;continue}if(h<d){const m=s.subarray(f*u),y=o.subarray(h*u),b=(d-h)*u;cG(y,m,b)}if(p>=l){const m=r.length;g=Math.floor(m/u)}if(g>d)if(this.defaultValue.length===1)o.subarray(d*u,g*u).fill(this.defaultValue[0]),d=g;else for(;g>d;){const m=o.slice(d*u);cG(m,c,u),++d}g<0?(f=p+1,h=d):(f=p,h=d,d=h+1)}}}function cG(e,t,n){for(let r=0;r<n;r++)e[r]=t[r]}function fG(e,t){const n=[];for(let r of e){if(r<0){if(!t)throw new Error(`Dimension ${r} must be >= 0`);if(r<-1)throw new Error(`Dimension ${r} must be >= -1`);r=-1}n.push(r)}return n}function Hse(e,t,n,r,i,s,o,a,u,l){return new Kk(e,t,n,r,i,s,o,a,u,l).compute()}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qse(e,t,n,r){const i=e===t,s=e<t&&n<0,o=t<e&&n>1;if(i||s||o)return Ir(0,r);const a=Math.abs(Math.ceil((t-e)/n)),u=Ir(a,r);t<e&&n===1&&(n=-1),u[0]=e;for(let l=1;l<u.length;l++)u[l]=u[l-1]+n;return u}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Xse=Ju(e=>1/Math.sqrt(e)),sOe=Dh(_1,Xse),oOe={kernelName:_1,backendName:"cpu",kernelFunc:sOe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Pd(e,t,n,r,i,s,o,a,u,l){const c=[r/i,i],f=e.values,h=t.values;if(r===0)return rt(n,t.dtype);const d=u instanceof zn?u:rt(c,t.dtype);typeof u=="string"||typeof u=="number"?d.values.fill(u):typeof u=="boolean"&&d.values.fill(+u);for(let p=0;p<s;p++){const g=[];let m=0;for(let y=0;y<o;y++){const b=f[p*o+y];g.push(b),m+=b*a[y]}if(m<0||m>=r/i)throw new Error(`Invalid indices: ${g} does not index into ${n}`);for(let y=0;y<i;y++)l?d.values[m*i+y]+=h[p*i+y]:d.values[m*i+y]=t.rank===0?h[0]:h[p*i+y]}return d}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const aOe=Ju(e=>1/(1+Math.exp(-e))),Yse=Ut(N1,e=>1/(1+Math.exp(-e))),uOe={kernelName:N1,backendName:"cpu",kernelFunc:Yse};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Kse(e,t,n,r,i){const s=a5(r,t,n),o=te(n),a=Me(r);if(s){const f=u5(t,a);return i==="string"?e.slice(f,f+o):e.subarray(f,f+o)}const u=i==="string"?lc(e):e,l=rt(r,i,u),c=rt(n,i);for(let f=0;f<c.size;++f){const h=c.indexToLoc(f),d=h.map((p,g)=>p+t[g]);c.set(l.get(...d),...h)}return i==="string"?ere(c.values):c.values}function $p(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{begin:s,size:o}=r;Te(i,"slice");const[a,u]=pI(i,s,o);s5(i,a,u);const l=n.data.get(i.dataId).values,c=Kse(l,a,u,i.shape,i.dtype);return n.makeTensorInfo(u,i.dtype,c)}const lOe={kernelName:vw,backendName:"cpu",kernelFunc:$p};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Zse(e,t,n,r,i,s,o){const a=t[0],u=s[0],l=new Array(u),c=new Array(a),f=t[1];if(u===0){if(a!==0)throw new Error(Une(a));const m=En(n,0),y=En(i,0);return[m,[0,f],y,l,c]}let h=!0,d=0;const p=new Array(u).fill(0);for(let m=0;m<a;++m){const y=e[m*f];if(y<0)throw new Error(jne(m,y));if(y>=u)throw new Error(Wne(m,y,u));++p[y],h=h&&y>=d,d=y}let g=!0;for(let m=0;m<u;++m){const y=p[m]===0;l[m]=y,g=g&&!y,p[m]=Math.max(p[m],1),m>0&&(p[m]+=p[m-1])}if(g&&h){const m=e,y=r;for(let b=0;b<a;++b)c[b]=b;return[m,[a,f],y,l,c]}else{const m=p[u-1],y=En(n,m*f),b=En(i,m),v=new Array(u).fill(0);for(let x=0;x<a;++x){const w=e[x*f],C=v[w],$=(w===0?0:p[w-1])+C;v[w]++;for(let S=0;S<f;++S)y[$*f+S]=e[x*f+S];b[$]=r[x],c[x]=$}for(let x=0;x<u;++x)if(v[x]===0){const C=x===0?0:p[x-1];y[C*f+0]=x;for(let $=1;$<f;++$)y[C*f+$]=0;b[C]=o}return[y,[m,f],b,l,c]}}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Jse(e,t,n,r,i){const s=te(r),o=t[0],a=i.length,u=[];let l=1,c=-1;for(let m=0;m<a;++m){const y=i[m];if(y===-1){if(c!==-1)throw new Error(Vne(c,m));c=m,u.push(1)}else{if(y<0)throw new Error(Gne(m,y));l*=y,u.push(y)}}if(c!==-1){if(l<=0)throw new Error(Hne());const m=Math.trunc(s/l);if(l*m!==s)throw new Error(qne(r,u));u[c]=m}if(te(u)!==s)throw new Error(Xne(r,u));const h=r.length,d=[];if(h>0){d[h-1]=1;for(let m=h-2;m>=0;--m)d[m]=d[m+1]*r[m+1]}const p=[];if(a>0){p[a-1]=1;for(let m=a-2;m>=0;--m)p[m]=p[m+1]*u[m+1]}const g=En(n,o*a);for(let m=0;m<o;++m){let y=0;for(let b=0;b<h;++b)y+=e[m*h+b]*d[b];for(let b=0;b<a;++b)g[m*a+b]=Math.trunc(y/p[b]),y%=p[b]}return[g,[o,a],u]}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function i6(e,t,n,r,i,s=!1,o=0){const a=r.length,u=[t[0],e.length/t[0]],l=u[1],f=a>0?i[a-1]+1:0;if(f<0)throw new Error(rM());const h=t.slice();h[0]=f;const d=h.reduce((v,x)=>v*x,1),p=En(n,d);if(a===0)return f>0&&p.fill(o),[p,h];if(f<=0)throw new Error(rM());let g=0,m=1,y=0,b=i[g];for(;;){let v=0;if(m<a){if(v=i[m],b===v){++m;continue}if(b>=v)throw new Error(Yne())}if(b<0||b>=f)throw new Error(Kne(b,f));b>y&&p.fill(o,y*l,b*l);for(let x=g;x<m;++x){const w=r[x];if(w<0||w>=u[0])throw new Error(Zne(x,r[x],u[0]));for(let C=0;C<l;C++)p[b*l+C]+=e[w*l+C]}if(s)for(let x=0;x<l;x++)p[b*l+x]/=m-g;if(g=m,++m,y=b+1,b=v,m>a)break}return y<f&&p.fill(o,y*l,f*l),[p,h]}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const cOe=Ju(e=>Math.sqrt(e)),fOe=Ut(O1,e=>Math.sqrt(e)),hOe={kernelName:O1,backendName:"cpu",kernelFunc:fOe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Qse=Mn((e,t)=>{const n=e-t;return n*n}),dOe=Qn(R1,Qse),pOe={kernelName:R1,backendName:"cpu",kernelFunc:dOe};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const eoe=Ju((e,t)=>{const{pattern:n,replaceGlobal:r,rewrite:i}=t;return e.replace(new RegExp(n,r?"g":""),i)}),gOe=Dh(kw,eoe),mOe={kernelName:kw,backendName:"cpu",kernelFunc:gOe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function toe(e,t,n,r){const i=rt(e,t.dtype);for(let s=0;s<i.size;s++){const o=i.indexToLoc(s),a=new Array(o.length);for(let u=0;u<a.length;u++)a[u]=o[u]*n[u]+r[u];i.set(t.get(...a),...o)}return i}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class yOe{constructor(t,n,r,i,s,o){this.separator=wu(t),this.nGramWidths=n,this.leftPad=wu(r),this.rightPad=wu(i),this.padWidth=s,this.preserveShort=o}getPadWidth(t){return Math.min(this.padWidth<0?t-1:this.padWidth,t-1)}getNumNGrams(t,n){const r=this.getPadWidth(n);return Math.max(0,t+2*r-n+1)}createNGrams(t,n,r,i,s,o){for(let a=0;a<s;++a){const u=this.getPadWidth(o),l=Math.max(0,u-a),c=Math.max(0,u-(s-(a+1))),f=o-(l+c),h=n+(l>0?0:a-u);let d=0;d+=l*this.leftPad.length;for(let b=0;b<f;++b)d+=t[h+b].length;d+=c*this.rightPad.length;const p=l+c+f-1;d+=p*this.separator.length,r[i+a]=new Uint8Array(d);const g=r[i+a];let m=0;const y=b=>b.forEach(v=>g[m++]=v);for(let b=0;b<l;++b)y(this.leftPad),y(this.separator);for(let b=0;b<f-1;++b)y(t[h+b]),y(this.separator);if(f>0){y(t[h+f-1]);for(let b=0;b<c;++b)y(this.separator),y(this.rightPad)}else{for(let b=0;b<c-1;++b)y(this.rightPad),y(this.separator);y(this.rightPad)}}}compute(t,n){const r=t.length,i=n.length;if(i>0){let u=n[0];if(u!==0)throw new Error(`First split value must be 0, got ${u}`);for(let l=1;l<i;++l){let c=n[l]>=u;if(c=c&&n[l]<=r,!c)throw new Error(`Invalid split value ${n[l]}, must be in [${u}, ${r}]`);u=n[l]}if(u!==r)throw new Error(`Last split value must be data size. Expected ${r}, got ${u}`)}const s=i-1,o=En("int32",i);if(r===0||i===0){const u=new Array(r);for(let l=0;l<=s;++l)o[l]=0;return[u,o]}o[0]=0;for(let u=1;u<=s;++u){const l=n[u]-n[u-1];let c=0;this.nGramWidths.forEach(f=>{c+=this.getNumNGrams(l,f)}),this.preserveShort&&l>0&&c===0&&(c=1),o[u]=o[u-1]+c}const a=new Array(o[s]);for(let u=0;u<s;++u){const l=n[u];let c=o[u];if(this.nGramWidths.forEach(f=>{const h=n[u+1]-n[u],d=this.getNumNGrams(h,f);this.createNGrams(t,l,a,c,d,f),c+=d}),this.preserveShort&&c===o[u]){const f=n[u+1]-n[u];if(f===0)continue;const h=f+2*this.padWidth,d=1;this.createNGrams(t,l,a,c,d,h)}}return[a,o]}}function noe(e,t,n,r,i,s,o,a){return new yOe(n,r,i,s,o,a).compute(e,t)}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bOe(e,t,n,r){if(!e.length)return;if(t.length===0){for(let s=0;s<e.length;++s)r.push(e.subarray(s,s+1));return}if(t.length===1){const s=t[0];let o=e.indexOf(s);for(;o!==-1;){const a=e.subarray(0,o);(!n||a.length!==0)&&r.push(a),e=e.subarray(o+1),o=e.indexOf(s)}(!n||e.length!==0)&&r.push(e);return}let i=0;for(let s=0;s<e.length+1;s++)if(s===e.length||t.indexOf(e[s])!==-1){const o=e.subarray(i,s);(!n||o.length!==0)&&r.push(o),i=s+1}}function roe(e,t,n){const r=e.length,i=[];let s=0,o=0;const a=new Array(r);for(let h=0;h<r;++h){const d=i.length;bOe(e[h],t,n,i);const p=i.length-d;a[h]=p,s+=p,o=Math.max(o,p)}const u=En("int32",s*2),l=new Array(s),c=[r,o];let f=0;for(let h=0;h<r;++h)for(let d=0;d<a[h];++d)u[f*2]=h,u[f*2+1]=d,l[f]=i[f],++f;return[u,l,c]}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ioe(e,t){const n=En("int32",e.length);for(let r=0;r<e.length;++r)n[r]=Oee(e[r]).modulo(t).getLowBitsUnsigned();return n}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const soe=Mn((e,t)=>e-t),xOe=e6((e,t,n,r)=>({real:e-n,imag:t-r})),s6=Qn(M1,soe,xOe),vOe={kernelName:M1,backendName:"cpu",kernelFunc:s6};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ooe(e,t){const n=new Array(e.rank);for(let i=0;i<n.length;i++)n[i]=e.shape[i]*t[i];const r=rt(n,e.dtype);for(let i=0;i<r.values.length;++i){const s=r.indexToLoc(i),o=new Array(e.rank);for(let u=0;u<o.length;u++)o[u]=s[u]%e.shape[u];const a=e.locToIndex(o);r.values[i]=e.values[a]}return r}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ib=(e,t)=>{const n=t.value-e.value;return n===0?e.index-t.index:n};function aoe(e,t,n=0,r=e.length-1){for(;r>n;){if(r-n>600){const a=r-n+1,u=t-n+1,l=Math.log(a),c=.5*Math.exp(2*l/3),f=.5*Math.sqrt(l*c*(a-c)/a)*Math.sign(u-a/2),h=Math.max(n,Math.floor(t-u*c/a+f)),d=Math.min(r,Math.floor(t+(a-u)*c/a+f));aoe(e,t,h,d)}const i=e[t];let s=n,o=r;for(Rl(e,n,t),Ib(e[r],i)>0&&Rl(e,n,r);s<o;){for(Rl(e,s,o),s++,o--;Ib(e[s],i)<0;)s=s+1;for(;Ib(e[o],i)>0;)o=o-1}Ib(e[n],i)===0?Rl(e,n,o):(o=o+1,Rl(e,o,r)),o<=t&&(n=o+1),t<=o&&(r=o-1)}}function uoe(e,t,n,r,i){const s=t[t.length-1],[o,a]=[e.length/s,s],u=hr(n,o*r),l=hr("int32",o*r);for(let f=0;f<o;f++){const h=f*a,d=e.subarray(h,h+a);let p=new Array(d.length);d.forEach((b,v)=>p[v]={value:b,index:v}),r<p.length&&(aoe(p,r),p=p.slice(0,r)),i&&p.sort(Ib);const g=f*r,m=u.subarray(g,g+r),y=l.subarray(g,g+r);for(let b=0;b<r;b++)m[b]=p[b].value,y[b]=p[b].index}const c=t.slice();return c[c.length-1]=r,[rt(c,n,u),rt(c,"int32",l)]}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function loe(e,t,n,r){const i=st(t,n)[0],s=[1,n[0],1];for(let p=0;p<i;p++)s[0]*=n[p];s[1]=n[i];for(let p=i+1;p<n.length;p++)s[2]*=n[p];const o=new Map,a=new Int32Array(n[i]),u=new zn(s,r,e),l=[],c=s[0]===1&&s[2]===1;for(let p=0;p<n[i];p++){let g;if(c)g=e[p].toString();else{const y=[];for(let b=0;b<s[0];b++)for(let v=0;v<s[2];v++)y.push(u.get(b,p,v));g=y.join(",")}const m=o.get(g);if(m!=null)a[p]=m;else{const y=o.size;o.set(g,y),a[p]=y,l.push(p)}}const f=s.slice();f[1]=o.size;const h=new zn(f,r);l.forEach((p,g)=>{for(let m=0;m<s[0];m++)for(let y=0;y<s[2];y++)h.set(u.get(m,p,y),m,g,y)});const d=n.slice();return d[i]=f[1],{outputValues:h.values,outputShape:d,indices:a}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wOe=Object.freeze(Object.defineProperty({__proto__:null,addImpl:bse,bincountImpl:t6,bincountReduceImpl:xse,bitwiseAndImpl:vse,castImpl:yse,ceilImpl:wse,concatImpl:$se,equalImpl:Cse,expImpl:kse,expm1Impl:_se,floorDivImpl:Tse,floorImpl:Ase,gatherNdImpl:Ise,gatherV2Impl:Dse,greaterEqualImpl:Fse,greaterImpl:Nse,lessEqualImpl:Rse,lessImpl:Ose,linSpaceImpl:Mse,logImpl:Lse,maxImpl:Pse,maximumImpl:Bse,minimumImpl:zse,multiplyImpl:n6,negImpl:Use,notEqualImpl:jse,prodImpl:Wse,raggedGatherImpl:Vse,raggedRangeImpl:Gse,raggedTensorToTensorImpl:Hse,rangeImpl:qse,rsqrtImpl:Xse,scatterImpl:Pd,sigmoidImpl:aOe,simpleAbsImpl:mse,sliceImpl:Kse,sparseFillEmptyRowsImpl:Zse,sparseReshapeImpl:Jse,sparseSegmentReductionImpl:i6,sqrtImpl:cOe,squaredDifferenceImpl:Qse,staticRegexReplaceImpl:eoe,stridedSliceImpl:toe,stringNGramsImpl:noe,stringSplitImpl:roe,stringToHashBucketFastImpl:ioe,subImpl:soe,tileImpl:ooe,topKImpl:uoe,transposeImpl:r6,uniqueImpl:loe},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */cB("cpu",()=>new AI,1);/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const coe=Ut(s1,e=>e>=0?e:Math.exp(e)-1),$Oe={kernelName:s1,backendName:"cpu",kernelFunc:coe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function foe(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{alpha:s}=r;Te([i],"leakyRelu");const o=te(i.shape),a=n.data.get(i.dataId).values,u=hr("float32",o);for(let l=0;l<a.length;l++)u[l]=a[l]<0?s*a[l]:a[l];return n.makeTensorInfo(i.shape,"float32",u)}const COe={kernelName:X2,backendName:"cpu",kernelFunc:foe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const SOe=Mn((e,t)=>e<0?t*e:e);function hoe(e){const{inputs:t,backend:n}=e,{x:r,alpha:i}=t;Te([r,i],"prelu");const s=n.data.get(r.dataId).values,o=n.data.get(i.dataId).values,[a,u]=SOe(r.shape,i.shape,s,o,"float32");return n.makeTensorInfo(u,"float32",a)}const kOe={kernelName:dw,backendName:"cpu",kernelFunc:hoe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const doe=Ut(S1,e=>Math.max(0,e)),EOe={kernelName:S1,backendName:"cpu",kernelFunc:doe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const poe=Ut(k1,e=>Math.min(Math.max(0,e),6)),_Oe={kernelName:k1,backendName:"cpu",kernelFunc:poe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Zk(e,t,n,r,i){if(n==="linear")return Pu({inputs:{x:t},backend:e});if(n==="relu")return doe({inputs:{x:t},backend:e});if(n==="elu")return coe({inputs:{x:t},backend:e});if(n==="relu6")return poe({inputs:{x:t},backend:e});if(n==="prelu")return hoe({inputs:{x:t,alpha:r},backend:e});if(n==="leakyrelu")return foe({inputs:{x:t},backend:e,attrs:{alpha:i}});if(n==="sigmoid")return Yse({inputs:{x:t},backend:e});throw new Error(`Activation ${n} has not been implemented for the CPU backend.`)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nn(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{shape:s}=r,o=te(i.shape),a=JP(s,o),u=te(a);N(o===u,()=>`The new shape (${a}) has ${u} elements and the old shape (${i.shape}) has ${o} elements. The new shape and old shape must have the same number of elements.`),n.incRef(i.dataId);const l=n.data.get(i.dataId);if(l.complexTensorInfos!=null){const c=l.complexTensorInfos.real,f=l.complexTensorInfos.imag;c.shape=a,f.shape=a}return{dataId:i.dataId,shape:a,dtype:i.dtype}}const AOe={kernelName:gw,backendName:"cpu",kernelFunc:nn};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function goe(e){const{inputs:t,backend:n,attrs:r}=e,{a:i,b:s}=t,{transposeA:o,transposeB:a}=r;Te([i,s],"matMul");const u=i.shape.length,l=s.shape.length,c=o?i.shape[u-2]:i.shape[u-1],f=a?s.shape[l-1]:s.shape[l-2],h=o?i.shape[u-1]:i.shape[u-2],d=a?s.shape[l-2]:s.shape[l-1],p=i.shape.slice(0,-2),g=s.shape.slice(0,-2),m=te(p),y=te(g),v=Ze(i.shape.slice(0,-2),s.shape.slice(0,-2)).concat([h,d]);N(c===f,()=>`Error in matMul: inner shapes (${c}) and (${f}) of Tensors with shapes ${i.shape} and ${s.shape} and transposeA=${o} and transposeB=${a} must match.`);const x=o?[m,c,h]:[m,h,c],w=a?[y,d,f]:[y,f,d],C=nn({inputs:{x:i},backend:n,attrs:{shape:x}}),$=nn({inputs:{x:s},backend:n,attrs:{shape:w}}),S=o?C.shape[1]:C.shape[2],k=o?C.shape[2]:C.shape[1],E=a?$.shape[1]:$.shape[2],_=Math.max(m,y),D=n.data.get(C.dataId).values,A=n.data.get($.dataId).values,T=Me(C.shape),I=Me($.shape),[F,R,L]=o?[T[0],1,T[1]]:[T[0],T[1],1],[P,q,X]=a?[1,I[1],I[0]]:[I[1],1,I[0]],G=k*E,J=rt([_,k,E],C.dtype),Q=J.values,ee=n.blockSize;for(let ue=0;ue<_;ue++){const ge=ue%m,xe=ue%y;for(let B=0;B<k;B+=ee){const H=Math.min(B+ee,k);for(let Y=0;Y<E;Y+=ee){const M=Math.min(Y+ee,E);for(let he=0;he<S;he+=ee){const ae=Math.min(he+ee,S);for(let me=B;me<H;me++)for(let de=Y;de<M;de++){let Oe=0;for(let Ye=he;Ye<ae;Ye++){const Wn=D[ge*F+me*R+Ye*L],Ht=A[Ye*P+de*q+xe*X];Oe+=Wn*Ht}Q[ue*G+(me*E+de)]+=Oe}}}}}return n.disposeIntermediateTensorInfo(C),n.disposeIntermediateTensorInfo($),n.makeTensorInfo(v,J.dtype,J.values)}const TOe={kernelName:N2,backendName:"cpu",kernelFunc:goe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function IOe(e){const{inputs:t,backend:n,attrs:r}=e,{a:i,b:s,bias:o,preluActivationWeights:a}=t,{transposeA:u,transposeB:l,activation:c,leakyreluAlpha:f}=r;let h,d,p;const g=[];h=goe({inputs:{a:i,b:s},attrs:{transposeA:u,transposeB:l},backend:n}),o&&(d=Zm({inputs:{a:h,b:o},backend:n}),g.push(h),h=d),c&&(p=Zk(n,h,c,a,f),g.push(h),h=p);for(const y of g)n.disposeIntermediateTensorInfo(y);return h}const DOe={kernelName:Mx,backendName:"cpu",kernelFunc:IOe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const NOe=Ut(H0,e=>Math.acos(e)),FOe={kernelName:H0,backendName:"cpu",kernelFunc:NOe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const OOe=Ut(q0,e=>Math.acosh(e)),ROe={kernelName:q0,backendName:"cpu",kernelFunc:OOe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function MOe(e){const{inputs:t,backend:n}=e,r=t;Te(t,"addN");const i=r.map(a=>n.data.get(a.dataId).values),s=rt(r[0].shape,r[0].dtype),o=s.values;for(let a=0;a<r.length;a++){const u=i[a];for(let l=0;l<o.length;l++)o[l]+=u[l]}return n.makeTensorInfo(s.shape,s.dtype,s.values)}const LOe={kernelName:_2,backendName:"cpu",kernelFunc:MOe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function POe(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{axis:s,keepDims:o}=r;Te(i,"all");const a=st(s,i.shape);let u=a;const l=Cn(u,i.shape.length);let c=i;l!=null&&(c=Yi({inputs:{x:i},backend:n,attrs:{perm:l}}),u=On(u.length,i.shape.length)),Rr("all",u,c.shape.length);const[f,h]=pr(c.shape,u),d=te(h),p=Ir(te(f),c.dtype),g=n.data.get(c.dataId).values;for(let y=0;y<p.length;++y){const b=y*d;let v=g[b];for(let x=0;x<d;++x){const w=g[b+x];v=v&&w}p[y]=v}l!=null&&n.disposeIntermediateTensorInfo(c);const m=n.makeTensorInfo(f,c.dtype,p);if(o){const y=Fn(f,a),b=nn({inputs:{x:m},backend:n,attrs:{shape:y}});return n.disposeIntermediateTensorInfo(m),b}return m}const BOe={kernelName:NA,backendName:"cpu",kernelFunc:POe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zOe(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{axis:s,keepDims:o}=r;Te(i,"any");const a=st(s,i.shape);let u=a;const l=Cn(u,i.shape.length);let c=i;l!=null&&(c=Yi({inputs:{x:i},backend:n,attrs:{perm:l}}),u=On(u.length,i.shape.length)),Rr("any",u,c.shape.length);const[f,h]=pr(c.shape,u),d=te(h),p=Ir(te(f),c.dtype),g=n.data.get(c.dataId).values;for(let y=0;y<p.length;++y){const b=y*d;let v=g[b];for(let x=0;x<d;++x){const w=g[b+x];v=v||w}p[y]=v}l!=null&&n.disposeIntermediateTensorInfo(c);const m=n.makeTensorInfo(f,c.dtype,p);if(o){const y=Fn(f,a),b=nn({inputs:{x:m},backend:n,attrs:{shape:y}});return n.disposeIntermediateTensorInfo(m),b}return m}const UOe={kernelName:FA,backendName:"cpu",kernelFunc:zOe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jOe(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{axis:s}=r;Te(i,"argMax");let o=st(s,i.shape);const a=Cn(o,i.shape.length);let u=i;const l=[];a!=null&&(u=Yi({inputs:{x:i},backend:n,attrs:{perm:a}}),l.push(u),o=On(o.length,u.shape.length)),o=[o[0]],Rr("argMax",o,u.shape.length);const[c,f]=pr(u.shape,o),h=te(c),d=Ir(h,"int32"),p=te(f),g=n.data.get(u.dataId).values;for(let m=0;m<d.length;++m){const y=m*p;let b=g[y],v=0;for(let x=0;x<p;++x){const w=g[y+x];w>b&&(b=w,v=x)}d[m]=v}return l.forEach(m=>n.disposeIntermediateTensorInfo(m)),n.makeTensorInfo(c,"int32",d)}const WOe={kernelName:A2,backendName:"cpu",kernelFunc:jOe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function VOe(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{axis:s}=r;Te(i,"argMin");let o=st(s,i.shape);const a=Cn(o,i.shape.length);let u=i;const l=[];a!=null&&(u=Yi({inputs:{x:i},backend:n,attrs:{perm:a}}),l.push(u),o=On(o.length,u.shape.length)),o=[o[0]],Rr("argMin",o,u.shape.length);const[c,f]=pr(u.shape,o),h=te(c),d=Ir(h,"int32"),p=te(f),g=n.data.get(u.dataId).values;for(let m=0;m<d.length;++m){const y=m*p;let b=g[y],v=0;for(let x=0;x<p;++x){const w=g[y+x];w<b&&(b=w,v=x)}d[m]=v}return l.forEach(m=>n.disposeIntermediateTensorInfo(m)),n.makeTensorInfo(c,"int32",d)}const GOe={kernelName:T2,backendName:"cpu",kernelFunc:VOe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const HOe=Ut(X0,e=>Math.asin(e)),qOe={kernelName:X0,backendName:"cpu",kernelFunc:HOe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const XOe=Ut(Y0,e=>Math.asinh(e)),YOe={kernelName:Y0,backendName:"cpu",kernelFunc:XOe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const KOe=Ut(K0,e=>Math.atan(e)),ZOe={kernelName:K0,backendName:"cpu",kernelFunc:KOe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const JOe=Mn((e,t)=>Math.atan2(e,t)),QOe=Qn(J0,JOe),eRe={kernelName:J0,backendName:"cpu",kernelFunc:QOe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const tRe=Ut(Z0,e=>Math.atanh(e)),nRe={kernelName:Z0,backendName:"cpu",kernelFunc:tRe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function o6(e,t,n,r,i,s){const o=i.strideHeight,a=i.strideWidth,u=i.dilationHeight,l=i.dilationWidth,c=i.effectiveFilterHeight,f=i.effectiveFilterWidth,h=i.padInfo.top,d=i.padInfo.left,p=s==="max"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,g=rt(i.outShape,n),m=g.values,y=i.outShape[1]*i.outShape[2]*i.outShape[3],b=i.outShape[2]*i.outShape[3],v=i.outShape[3];for(let x=0;x<i.batchSize;++x){const w=x*y,C=x*r[0];for(let $=0;$<i.inChannels;++$)for(let S=0;S<i.outHeight;++S){const k=S*o-h,E=Math.max(0,k),_=Math.min(i.inHeight,c+k),D=w+S*b;for(let A=0;A<i.outWidth;++A){const T=A*a-d,I=Math.max(0,T),F=Math.min(i.inWidth,f+T);let R=p,L=0,P=0;for(let X=E;X<_;X+=u){const G=C+X*r[1];for(let J=I;J<F;J+=l){const Q=G+J*r[2],ee=e[Q+$];s==="max"&&ee>R?R=ee:s==="avg"&&(L+=ee,P++)}if(isNaN(R))break}const q=D+A*v+$;m[q]=s==="avg"?L/P:R}}}return g}function moe(e,t,n,r,i=!1,s=!1){const o=rt(r.outShape,"int32"),a=r.strideHeight,u=r.strideWidth,l=r.dilationHeight,c=r.dilationWidth,f=r.effectiveFilterHeight,h=r.effectiveFilterWidth,d=r.padInfo.top,p=r.padInfo.left,g=rt(t,n,e);for(let m=0;m<r.batchSize;++m)for(let y=0;y<r.inChannels;++y)for(let b=0;b<r.outHeight;++b){const v=b*a-d;let x=v;for(;x<0;)x+=l;const w=Math.min(r.inHeight,f+v);for(let C=0;C<r.outWidth;++C){const $=C*u-p;let S=$;for(;S<0;)S+=c;const k=Math.min(r.inWidth,h+$);let E=Number.NEGATIVE_INFINITY,_=-1;for(let D=x;D<w;D+=l){const A=D-v;for(let T=S;T<k;T+=c){const I=T-$,F=g.get(m,D,T,y);F>E&&(E=F,i?_=s?((m*r.inHeight+D)*r.inWidth+T)*r.inChannels+y:(D*r.inWidth+T)*r.inChannels+y:_=A*h+I)}}o.set(_,m,b,C,y)}}return o}function yoe(e,t,n,r,i,s){const o=i.strideDepth,a=i.strideHeight,u=i.strideWidth,l=i.dilationDepth,c=i.dilationHeight,f=i.dilationWidth,h=i.effectiveFilterDepth,d=i.effectiveFilterHeight,p=i.effectiveFilterWidth,g=i.padInfo.front,m=i.padInfo.top,y=i.padInfo.left,b=s==="max"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,v=rt(i.outShape,n),x=v.values,w=i.outShape[1]*i.outShape[2]*i.outShape[3]*i.outShape[4],C=i.outShape[2]*i.outShape[3]*i.outShape[4],$=i.outShape[3]*i.outShape[4],S=i.outShape[4];for(let k=0;k<i.batchSize;++k){const E=k*w,_=k*r[0];for(let D=0;D<i.inChannels;++D)for(let A=0;A<i.outDepth;++A){const T=A*o-g;let I=T;for(;I<0;)I+=l;const F=Math.min(i.inDepth,h+T),R=E+A*C;for(let L=0;L<i.outHeight;++L){const P=L*a-m;let q=P;for(;q<0;)q+=c;const X=Math.min(i.inHeight,d+P),G=R+L*$;for(let J=0;J<i.outWidth;++J){const Q=J*u-y;let ee=Q;for(;ee<0;)ee+=f;const ue=Math.min(i.inWidth,p+Q),ge=G+J*S;let xe=b,B=0,H=0;for(let M=I;M<F;M+=l){const he=_+M*r[1];for(let ae=q;ae<X;ae+=c){const me=he+ae*r[2];for(let de=ee;de<ue;de+=f){const Oe=me+de*r[3],Ye=e[Oe+D];if(s==="max"&&Ye>xe?xe=Ye:s==="avg"&&(B+=Ye,H++),isNaN(xe))break}if(isNaN(xe))break}if(isNaN(xe))break}const Y=ge+D;x[Y]=s==="avg"?B/Math.max(H,1):xe}}}}return v}function rRe(e,t){const n=rt(t.outShape,"int32"),r=t.strideDepth,i=t.strideHeight,s=t.strideWidth,o=t.dilationDepth,a=t.dilationHeight,u=t.dilationWidth,l=t.effectiveFilterDepth,c=t.effectiveFilterHeight,f=t.effectiveFilterWidth,h=t.padInfo.front,d=t.padInfo.top,p=t.padInfo.left;for(let g=0;g<t.batchSize;++g)for(let m=0;m<t.inChannels;++m)for(let y=0;y<t.outDepth;++y){const b=y*r-h;let v=b;for(;v<0;)v+=o;const x=Math.min(t.inDepth,l+b);for(let w=0;w<t.outHeight;++w){const C=w*i-d;let $=C;for(;$<0;)$+=a;const S=Math.min(t.inHeight,c+C);for(let k=0;k<t.outWidth;++k){const E=k*s-p;let _=E;for(;_<0;)_+=u;const D=Math.min(t.inWidth,f+E);let A=Number.NEGATIVE_INFINITY,T=-1;for(let I=v;I<x;I+=o){const F=I-b;for(let R=$;R<S;R+=a){const L=R-C;for(let P=_;P<D;P+=u){const q=P-E,X=e.get(g,I,R,P,m);X>=A&&(A=X,T=F*c*f+L*c+q)}}}n.set(T,g,y,w,k,m)}}}return n}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function iRe(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t;Te(i,"avgPool");const{filterSize:s,strides:o,pad:a,dimRoundingMode:u}=r,l=1;N(Or(o,l),()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${o} and dilations '${l}'`);const c=Ho(i.shape,s,o,l,a,u);let f;if(c.filterWidth===1&&c.filterHeight===1&&bt(c.inShape,c.outShape))f=Pu({inputs:{x:i},backend:n});else{const h=n.data.get(i.dataId).values,d=Me(i.shape),p=o6(h,i.shape,i.dtype,d,c,"avg");f=n.makeTensorInfo(c.outShape,i.dtype,p.values)}return f}const sRe={kernelName:I2,backendName:"cpu",kernelFunc:iRe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function oRe(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{filterSize:s,strides:o,pad:a,dimRoundingMode:u,dataFormat:l}=r;Te(i,"avgPool3d");const c=vc(i.shape,s,o,1,a,u,l),f=n.data.get(i.dataId).values,h=yoe(f,i.shape,i.dtype,Me(i.shape),c,"avg");return n.makeTensorInfo(h.shape,"float32",h.values)}const aRe={kernelName:D2,backendName:"cpu",kernelFunc:oRe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uRe(e){const{inputs:t,backend:n,attrs:r}=e,{dy:i,input:s}=t,{filterSize:o,strides:a,pad:u,dimRoundingMode:l}=r;Te([i,s],"avgPool3DGrad");const c=vc(s.shape,o,a,1,u,l),f=c.strideDepth,h=c.strideHeight,d=c.strideWidth,p=c.filterDepth,g=c.filterHeight,m=c.filterWidth,y=c.dilationDepth,b=c.dilationHeight,v=c.dilationWidth,x=c.effectiveFilterDepth,w=c.effectiveFilterHeight,C=c.effectiveFilterWidth,$=x-1-c.padInfo.front,S=C-1-c.padInfo.left,k=w-1-c.padInfo.top,E=rt(s.shape,"float32"),_=1/(p*g*m),D=n.bufferSync(i);for(let A=0;A<c.batchSize;++A)for(let T=0;T<c.inChannels;++T)for(let I=0;I<c.inDepth;++I)for(let F=0;F<c.inHeight;++F)for(let R=0;R<c.inWidth;++R){const L=I-$,P=F-k,q=R-S;let X=0;for(let G=0;G<x;G+=y){const J=(L+G)/f;if(!(J<0||J>=c.outDepth||Math.floor(J)!==J))for(let Q=0;Q<w;Q+=b){const ee=(P+Q)/h;if(!(ee<0||ee>=c.outHeight||Math.floor(ee)!==ee))for(let ue=0;ue<C;ue+=v){const ge=(q+ue)/d;if(ge<0||ge>=c.outWidth||Math.floor(ge)!==ge)continue;const xe=D.get(A,J,ee,ge,T);X+=xe}}}E.set(X*_,A,I,F,R,T)}return n.makeTensorInfo(E.shape,E.dtype,E.values)}const lRe={kernelName:RA,backendName:"cpu",kernelFunc:uRe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cRe(e){const{inputs:t,backend:n,attrs:r}=e,{dy:i,input:s}=t,o=s;Te([i,s],"avgPoolGrad");const{filterSize:a,strides:u,pad:l}=r,c=Ho(o.shape,a,u,1,l),f=c.strideHeight,h=c.strideWidth,d=c.filterHeight,p=c.filterWidth,g=c.dilationHeight,m=c.dilationWidth,y=c.effectiveFilterHeight,b=c.effectiveFilterWidth,v=b-1-c.padInfo.left,x=y-1-c.padInfo.top,w=rt(o.shape,"float32"),C=1/(d*p),$=n.data.get(i.dataId).values,S=rt(i.shape,"float32",$);for(let k=0;k<c.batchSize;++k)for(let E=0;E<c.inChannels;++E)for(let _=0;_<c.inHeight;++_)for(let D=0;D<c.inWidth;++D){const A=_-x,T=D-v;let I=0;for(let F=0;F<y;F+=g){const R=(A+F)/f;if(!(R<0||R>=c.outHeight||Math.floor(R)!==R))for(let L=0;L<b;L+=m){const P=(T+L)/h;if(P<0||P>=c.outWidth||Math.floor(P)!==P)continue;const q=S.get(k,R,P,E);I+=q}}w.set(I*C,k,_,D,E)}return n.makeTensorInfo(w.shape,w.dtype,w.values)}const fRe={kernelName:OA,backendName:"cpu",kernelFunc:cRe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hRe(e){const{inputs:t,backend:n,attrs:r}=e,{x:i,scale:s,offset:o,mean:a,variance:u}=t;N(a.shape.length===u.shape.length,()=>"Batch normalization gradient requires mean and variance to have equal ranks."),N(o==null||a.shape.length===o.shape.length,()=>"Batch normalization gradient requires mean and offset to have equal ranks."),N(s==null||a.shape.length===s.shape.length,()=>"Batch normalization gradient requires mean and scale to have equal ranks."),Te([i,a,u,s,o],"batchNorm");let{varianceEpsilon:l}=r;l==null&&(l=.001);const c=n.data.get(i.dataId).values,f=n.data.get(a.dataId).values,h=n.data.get(u.dataId).values,d=s?n.data.get(s.dataId).values:new Float32Array([1]),p=o?n.data.get(o.dataId).values:new Float32Array([0]),g=new Float32Array(c.length),m=p.length,y=d.length,b=h.length,v=f.length;let x=0,w=0,C=0,$=0;for(let S=0;S<c.length;++S)g[S]=p[x++]+(c[S]-f[w++])*d[C++]/Math.sqrt(h[$++]+l),x>=m&&(x=0),w>=v&&(w=0),C>=y&&(C=0),$>=b&&($=0);return n.makeTensorInfo(i.shape,i.dtype,g)}const dRe={kernelName:G2,backendName:"cpu",kernelFunc:hRe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pRe(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{blockShape:s,crops:o}=r;Te([i],"batchToSpaceND");const a=s.reduce((y,b)=>y*b),u=Pw(i.shape,s,a),l=Bw(u.length,s.length),c=zw(i.shape,s,a),f=p5(o,s.length),h=g5(c,o,s.length),d=nn({inputs:{x:i},backend:n,attrs:{shape:u}}),p=Yi({inputs:{x:d},backend:n,attrs:{perm:l}}),g=nn({inputs:{x:p},backend:n,attrs:{shape:c}}),m=$p({inputs:{x:g},backend:n,attrs:{begin:f,size:h}});return n.disposeIntermediateTensorInfo(d),n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(g),m}const gRe={kernelName:F2,backendName:"cpu",kernelFunc:pRe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mRe(e){const{inputs:t,backend:n,attrs:r}=e,{x:i,weights:s}=t,{size:o}=r,a=n.data.get(i.dataId).values,u=n.data.get(s.dataId).values,l=t6(a,u,s.dtype,s.shape,o);return n.makeTensorInfo([o],s.dtype,l)}const yRe={kernelName:MA,backendName:"cpu",kernelFunc:mRe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bRe(e){const{inputs:t,backend:n}=e,{s0:r,s1:i}=t,s=n.data.get(r.dataId).values,o=n.data.get(i.dataId).values,a=Ze(Array.from(s),Array.from(o));return n.makeTensorInfo([a.length],"int32",Int32Array.from(a))}const xRe={kernelName:LA,backendName:"cpu",kernelFunc:bRe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const vRe=Ut(t1,(e,t)=>{const n=t;return e>n.clipValueMax?n.clipValueMax:e<n.clipValueMin?n.clipValueMin:e}),wRe={kernelName:t1,backendName:"cpu",kernelFunc:vRe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $Re=e=>{const{x:t}=e.inputs,n=e.backend,r=new Float32Array(te(t.shape)),i=n.data.get(t.dataId),s=i.complexTensorInfos.real,o=i.complexTensorInfos.imag,a=n.data.get(s.dataId).values,u=n.data.get(o.dataId).values;for(let l=0;l<a.length;l++){const c=a[l],f=u[l];r[l]=Math.hypot(c,f)}return n.makeOutput(r,t.shape,"float32")},CRe={kernelName:R2,backendName:"cpu",kernelFunc:$Re};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Jm(e){const{inputs:t,backend:n}=e,{input:r}=t,i=n.data.get(r.dataId).complexTensorInfos.imag,s=n.data.get(i.dataId).values;return n.makeTensorInfo(i.shape,i.dtype,s)}const SRe={kernelName:rT,backendName:"cpu",kernelFunc:Jm};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Qm(e){const{inputs:t,backend:n,attrs:r}=e,{axis:i}=r,s=st(i,t[0].shape)[0],o=t.map(g=>g.shape);f5(o,s);let a=Cu(t.map(g=>g.shape),s);if(te(a)===0)return n.makeTensorInfo(a,t[0].dtype,[]);const u=t.filter(g=>te(g.shape)>0);if(u.length===1)return Pu({inputs:{x:u[0]},backend:n});if(u[0].dtype==="complex64"){const g=u.map(x=>wp({inputs:{input:x},backend:n})),m=u.map(x=>Jm({inputs:{input:x},backend:n})),y=Qm({inputs:g,backend:n,attrs:{axis:s}}),b=Qm({inputs:m,backend:n,attrs:{axis:s}}),v=ms({inputs:{real:y,imag:b},backend:n});return g.forEach(x=>n.disposeIntermediateTensorInfo(x)),m.forEach(x=>n.disposeIntermediateTensorInfo(x)),n.disposeIntermediateTensorInfo(y),n.disposeIntermediateTensorInfo(b),v}const l=u.map(g=>{const y=[-1,te(g.shape.slice(s))];return nn({inputs:{x:g},backend:n,attrs:{shape:y}})}),c=l.map(g=>({vals:n.data.get(g.dataId).values,shape:g.shape}));a=Cu(l.map(g=>g.shape),1);const f=l[0].shape[0]===1,h=$se(c,a,t[0].dtype,f),d=Cu(u.map(g=>g.shape),s),p=n.makeTensorInfo(d,t[0].dtype,h);return l.forEach(g=>n.disposeIntermediateTensorInfo(g)),p}const kRe={kernelName:M2,backendName:"cpu",kernelFunc:Qm};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function boe(e){const{inputs:t,backend:n,attrs:r}=e,{x:i,filter:s}=t,{strides:o,pad:a,dataFormat:u,dilations:l,dimRoundingMode:c}=r;Te([i,s],"conv2d");const f=wc(u),h=dr(i.shape,s.shape,o,l,a,c,!1,f),d=h.filterHeight,p=h.filterWidth,g=h.dilationHeight,m=h.dilationWidth,y=h.padInfo.left,b=h.padInfo.top,v=h.dataFormat==="channelsLast",x=new zn(h.outShape,i.dtype),w=Me(i.shape),C=Me(s.shape),$=w[0],S=v?w[1]:w[2],k=v?w[2]:1,E=v?1:w[1],_=x.strides[0],D=v?x.strides[1]:x.strides[2],A=v?x.strides[2]:1,T=v?1:x.strides[1],I=n.data.get(i.dataId).values,F=n.data.get(s.dataId).values,R=x.values;for(let L=0;L<h.batchSize;++L){const P=L*$,q=L*_;for(let X=0;X<h.outHeight;++X){const G=q+X*D,J=X*h.strideHeight-b;for(let Q=0;Q<d;++Q){const ee=J+Q*g;if(ee<0||ee>=h.inHeight)continue;const ue=Q*C[0],ge=P+ee*S;for(let xe=0;xe<h.outWidth;++xe){const B=G+xe*A,H=xe*h.strideWidth-y;for(let Y=0;Y<p;++Y){const M=H+Y*m;if(M<0||M>=h.inWidth)continue;const he=ue+Y*C[1],ae=ge+M*k;let me=he;for(let de=0;de<h.inChannels;++de){const Oe=I[ae+de*E];for(let Ye=0;Ye<h.outChannels;++Ye)R[B+Ye*T]+=Oe*F[me+Ye];me+=h.outChannels}}}}}}return n.makeTensorInfo(x.shape,x.dtype,R)}const ERe={kernelName:L2,backendName:"cpu",kernelFunc:boe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _Re(e){const{inputs:t,backend:n,attrs:r}=e,{x:i,dy:s}=t,{strides:o,pad:a,dataFormat:u,dimRoundingMode:l,filterShape:c}=r;Te([i,s],"conv2dBackpropFilter");const f=wc(u),h=dr(i.shape,c,o,1,a,l,!1,f),{strideHeight:d,strideWidth:p,filterHeight:g,filterWidth:m}=h,y=h.dataFormat==="channelsLast",b=new zn(h.filterShape,"float32"),v=h.padInfo.left,x=h.padInfo.top,w=n.data.get(i.dataId).values,C=n.data.get(s.dataId).values,$=new zn(i.shape,i.dtype,w),S=new zn(s.shape,s.dtype,C);for(let k=0;k<g;++k){const E=Math.max(0,Math.ceil((x-k)/d)),_=Math.min(h.outHeight,(h.inHeight+x-k)/d);for(let D=0;D<m;++D){const A=Math.max(0,Math.ceil((v-D)/p)),T=Math.min(h.outWidth,(h.inWidth+v-D)/p);for(let I=0;I<h.inChannels;++I)for(let F=0;F<h.outChannels;++F){let R=0;for(let L=0;L<h.batchSize;++L)for(let P=E;P<_;++P){const q=k+P*d-x;for(let X=A;X<T;++X){const G=D+X*p-v;y?R+=$.get(L,q,G,I)*S.get(L,P,X,F):R+=$.get(L,I,q,G)*S.get(L,F,P,X)}}b.set(R,k,D,I,F)}}}return n.makeTensorInfo(b.shape,b.dtype,b.values)}const ARe={kernelName:BA,backendName:"cpu",kernelFunc:_Re};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function TRe(e){const{inputs:t,backend:n,attrs:r}=e,{dy:i,filter:s}=t,{inputShape:o,strides:a,pad:u,dataFormat:l,dimRoundingMode:c}=r;Te([i,s],"conv2dBackpropInput");const f=Me(s.shape),h=Me(i.shape);let d=wc(l);const p=dr(o,s.shape,a,1,u,c,!1,d),g=new zn(p.inShape,"float32"),m=g.values,y=n.data.get(i.dataId).values,b=n.data.get(s.dataId).values,[v,x,w]=f,{batchSize:C,filterHeight:$,filterWidth:S,inChannels:k,inHeight:E,inWidth:_,outChannels:D,outHeight:A,outWidth:T,strideHeight:I,strideWidth:F}=p;d=p.dataFormat;const R=$-1-p.padInfo.top,L=S-1-p.padInfo.left,P=d==="channelsLast",q=g.strides[0],X=P?g.strides[1]:g.strides[2],G=P?g.strides[2]:1,J=P?1:g.strides[1],Q=h[0],ee=P?h[1]:h[2],ue=P?h[2]:1,ge=P?1:h[1];for(let xe=0;xe<C;++xe)for(let B=0;B<k;++B)for(let H=0;H<E;++H){const Y=H-R,M=Math.max(0,Math.ceil(Y/I)),he=Math.min(A,($+Y)/I);for(let ae=0;ae<_;++ae){const me=ae-L,de=Math.max(0,Math.ceil(me/F)),Oe=Math.min(T,(S+me)/F);let Ye=0;for(let Ht=M;Ht<he;++Ht){const Ln=Ht*I-Y;for(let pt=de;pt<Oe;++pt){const qt=pt*F-me,tr=Q*xe+ee*Ht+ue*pt,gt=v*($-1-Ln)+x*(S-1-qt)+w*B;for(let Fi=0;Fi<D;++Fi){const xr=y[tr+ge*Fi],ei=b[gt+Fi];Ye+=xr*ei}}}const Wn=q*xe+X*H+G*ae+J*B;m[Wn]=Ye}}return n.makeTensorInfo(g.shape,g.dtype,g.values)}const IRe={kernelName:P2,backendName:"cpu",kernelFunc:TRe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function DRe(e){const{inputs:t,backend:n,attrs:r}=e,{x:i,filter:s}=t,{strides:o,pad:a,dilations:u}=r;Te([i,s],"conv3d");const l=kh(i.shape,s.shape,o,u,a),{filterDepth:c,filterHeight:f,filterWidth:h,dilationDepth:d,dilationHeight:p,dilationWidth:g,padInfo:m}=l,y=m.front,b=m.left,v=m.top,x=new zn(l.outShape,i.dtype),w=n.data.get(i.dataId).values,C=n.data.get(s.dataId).values,$=x.values,S=Me(i.shape),k=Me(s.shape);for(let E=0;E<l.batchSize;++E){const _=E*S[0],D=E*x.strides[0];for(let A=0;A<l.outDepth;++A){const T=D+A*x.strides[1],I=A*l.strideDepth-y;for(let F=0;F<c;++F){const R=I+F*d;if(R<0||R>=l.inDepth)continue;const L=F*k[0],P=_+R*S[1];for(let q=0;q<l.outHeight;++q){const X=T+q*x.strides[2],G=q*l.strideHeight-v;for(let J=0;J<f;++J){const Q=G+J*p;if(Q<0||Q>=l.inHeight)continue;const ee=L+J*k[1],ue=P+Q*S[2];for(let ge=0;ge<l.outWidth;++ge){const xe=X+ge*l.outChannels,B=ge*l.strideWidth-b;for(let H=0;H<h;++H){const Y=B+H*g;if(Y<0||Y>=l.inWidth)continue;const M=ee+H*k[2],he=ue+Y*l.inChannels;let ae=M;for(let me=0;me<l.inChannels;++me){const de=w[he+me];for(let Oe=0;Oe<l.outChannels;++Oe)$[xe+Oe]+=de*C[ae+Oe];ae+=l.outChannels}}}}}}}}return n.makeTensorInfo(x.shape,x.dtype,x.values)}const NRe={kernelName:B2,backendName:"cpu",kernelFunc:DRe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function FRe(e){const{inputs:t,backend:n,attrs:r}=e,{x:i,dy:s}=t,{strides:o,pad:a,filterShape:u}=r;Te([i,s],"conv3dBackpropFilterV2");const l=Me(i.shape),c=Me(s.shape),f=kh(i.shape,u,o,1,a),h=f.strideDepth,d=f.strideHeight,p=f.strideWidth,g=f.filterDepth,m=f.filterHeight,y=f.filterWidth,b=new zn(f.filterShape,"float32"),v=b.values,[x,w,C,$]=b.strides,S=n.data.get(s.dataId).values,[k,E,_,D]=c,A=n.data.get(i.dataId).values,[T,I,F,R]=l,L=f.padInfo.front,P=f.padInfo.left,q=f.padInfo.top;for(let X=0;X<g;++X){const G=Math.max(0,Math.ceil((L-X)/h)),J=Math.min(f.outDepth,(f.inDepth+L-X)/h),Q=X*x;for(let ee=0;ee<m;++ee){const ue=Math.max(0,Math.ceil((q-ee)/d)),ge=Math.min(f.outHeight,(f.inHeight+q-ee)/d),xe=ee*w+Q;for(let B=0;B<y;++B){const H=Math.max(0,Math.ceil((P-B)/p)),Y=Math.min(f.outWidth,(f.inWidth+P-B)/p),M=B*C+xe;for(let he=0;he<f.inChannels;++he){const ae=he*$+M;for(let me=0;me<f.outChannels;++me){let de=0;for(let Oe=0;Oe<f.batchSize;++Oe){const Ye=Oe*T,Wn=Oe*k;for(let Ht=G;Ht<J;++Ht){const pt=(X+Ht*h-L)*I+Ye,qt=Ht*E+Wn;for(let tr=ue;tr<ge;++tr){const Fi=(ee+tr*d-q)*F+pt,xr=tr*_+qt;for(let ei=H;ei<Y;++ei){const ho=(B+ei*p-P)*R+Fi,po=ei*D+xr;de+=A[ho+he]*S[po+me]}}}}v[ae+me]=de}}}}}return n.makeTensorInfo(b.shape,b.dtype,b.values)}const ORe={kernelName:zA,backendName:"cpu",kernelFunc:FRe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function RRe(e){const{inputs:t,backend:n,attrs:r}=e,{dy:i,filter:s}=t,{pad:o,strides:a,inputShape:u}=r;Te([i],"conv3dBackpropInputV2");const l=Me(i.shape),c=Me(s.shape),f=kh(u,s.shape,a,1,o),h=new zn(f.inShape,"float32"),d=h.values,[p,g,m,y]=h.strides,b=n.data.get(i.dataId).values,[v,x,w,C]=l,$=n.data.get(s.dataId).values,[S,k,E,_]=c,{batchSize:D,filterDepth:A,filterHeight:T,filterWidth:I,inChannels:F,inDepth:R,inHeight:L,inWidth:P,outChannels:q,outDepth:X,outHeight:G,outWidth:J,strideDepth:Q,strideHeight:ee,strideWidth:ue}=f,ge=A-1-f.padInfo.front,xe=T-1-f.padInfo.top,B=I-1-f.padInfo.left;for(let H=0;H<D;++H)for(let Y=0;Y<F;++Y)for(let M=0;M<R;++M){const he=M-ge,ae=Math.max(0,Math.ceil(he/Q)),me=Math.min(X,(A+he)/Q);for(let de=0;de<L;++de){const Oe=de-xe,Ye=Math.max(0,Math.ceil(Oe/ee)),Wn=Math.min(G,(T+Oe)/ee);for(let Ht=0;Ht<P;++Ht){const Ln=Ht-B,pt=Math.max(0,Math.ceil(Ln/ue)),qt=Math.min(J,(I+Ln)/ue);let tr=0;for(let gt=ae;gt<me;++gt){const Fi=gt*Q-he;for(let xr=Ye;xr<Wn;++xr){const ei=xr*ee-Oe;for(let os=pt;os<qt;++os){const ho=os*ue-Ln,po=v*H+x*gt+w*xr+C*os,as=S*(A-1-Fi)+k*(T-1-ei)+E*(I-1-ho)+_*Y;for(let vl=0;vl<q;++vl){const us=b[po+vl],CC=$[as+vl];tr+=us*CC}}}}d[p*H+g*M+m*de+y*Ht+Y]=tr}}}return n.makeTensorInfo(h.shape,h.dtype,h.values)}const MRe={kernelName:UA,backendName:"cpu",kernelFunc:RRe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const LRe=Ut(n1,e=>Math.cos(e)),PRe={kernelName:n1,backendName:"cpu",kernelFunc:LRe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const BRe=Ut(r1,e=>Math.cosh(e)),zRe={kernelName:r1,backendName:"cpu",kernelFunc:BRe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function URe(e){const{inputs:t,backend:n,attrs:r}=e,{image:i,boxes:s,boxInd:o}=t,{cropSize:a,method:u,extrapolationValue:l}=r,[c,f,h,d]=i.shape,p=s.shape[0],[g,m]=a,y=rt([p,g,m,d],"float32"),b=n.data.get(s.dataId).values,v=n.data.get(o.dataId).values,x=n.data.get(i.dataId).values,w=Me(i.shape),C=Me(y.shape);for(let $=0;$<p;$++){const S=$*4,k=b[S],E=b[S+1],_=b[S+2],D=b[S+3],A=v[$];if(A>=c)continue;const T=g>1?(_-k)*(f-1)/(g-1):0,I=m>1?(D-E)*(h-1)/(m-1):0;for(let F=0;F<g;F++){const R=g>1?k*(f-1)+F*T:.5*(k+_)*(f-1);if(R<0||R>f-1){for(let L=0;L<m;L++)for(let P=0;P<d;P++){const q=P+L*C[2]+F*C[1]+$*C[0];y.values[q]=l}continue}if(u==="bilinear"){const L=Math.floor(R),P=Math.ceil(R),q=R-L;for(let X=0;X<m;X++){const G=m>1?E*(h-1)+X*I:.5*(E+D)*(h-1);if(G<0||G>h-1){for(let ue=0;ue<d;ue++){const ge=ue+X*C[2]+F*C[1]+$*C[0];y.values[ge]=l}continue}const J=Math.floor(G),Q=Math.ceil(G),ee=G-J;for(let ue=0;ue<d;ue++){let ge=ue+J*w[2]+L*w[1]+A*w[0];const xe=x[ge];ge=ue+Q*w[2]+L*w[1]+A*w[0];const B=x[ge];ge=ue+J*w[2]+P*w[1]+A*w[0];const H=x[ge];ge=ue+Q*w[2]+P*w[1]+A*w[0];const Y=x[ge],M=xe+(B-xe)*ee,he=H+(Y-H)*ee;ge=ue+X*C[2]+F*C[1]+$*C[0],y.values[ge]=M+(he-M)*q}}}else for(let L=0;L<m;++L){const P=m>1?E*(h-1)+L*I:.5*(E+D)*(h-1);if(P<0||P>h-1){for(let G=0;G<d;G++){const J=G+L*C[2]+F*C[1]+$*C[0];y.values[J]=l}continue}const q=Math.round(P),X=Math.round(R);for(let G=0;G<d;G++){const J=G+q*w[2]+X*w[1]+A*w[0],Q=G+L*C[2]+F*C[1]+$*C[0];y.values[Q]=x[J]}}}}return n.makeTensorInfo(y.shape,y.dtype,y.values)}const jRe={kernelName:WA,backendName:"cpu",kernelFunc:URe};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function WRe(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{axis:s,exclusive:o,reverse:a}=r;Te(i,"cumprod");const u=Cn([s],i.shape.length);let l=i;u!=null&&(l=Yi({inputs:{x:i},backend:n,attrs:{perm:u}}));const c=On(1,i.shape.length)[0];if(c!==l.shape.length-1)throw new Error(`backend.cumprod in CPU expects an inner-most axis=${l.shape.length-1} but got axis=${c}`);const f=qi(l.dtype,"int32"),h=IA(te(l.shape),f),d=n.data.get(l.dataId).values,p=l.shape[l.shape.length-1],g=a?(y,b)=>y+p-b-1:(y,b)=>y+b;for(let y=0;y<d.length;y+=p)for(let b=0;b<p;b++){const v=g(y,b);if(b===0)h[v]=o?1:d[v];else{const x=g(y,b-1);h[v]=o?d[x]*h[x]:d[v]*h[x]}}const m=n.makeTensorInfo(l.shape,f,h);if(u!=null){const y=Eh(u),b=Yi({inputs:{x:m},backend:n,attrs:{perm:y}});return n.disposeIntermediateTensorInfo(m),n.disposeIntermediateTensorInfo(l),b}return m}const VRe={kernelName:jA,backendName:"cpu",kernelFunc:WRe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function GRe(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{axis:s,exclusive:o,reverse:a}=r;Te(i,"cumsum");const u=Cn([s],i.shape.length);let l=i;u!=null&&(l=Yi({inputs:{x:i},backend:n,attrs:{perm:u}}));const c=On(1,i.shape.length)[0];if(c!==l.shape.length-1)throw new Error(`backend.cumsum in CPU expects an inner-most axis=${l.shape.length-1} but got axis=${c}`);const f=qi(l.dtype,"int32"),h=Ir(te(l.shape),f),d=n.data.get(l.dataId).values,p=l.shape[l.shape.length-1],g=a?(y,b)=>y+p-b-1:(y,b)=>y+b;for(let y=0;y<d.length;y+=p)for(let b=0;b<p;b++){const v=g(y,b);if(b===0)h[v]=o?0:d[v];else{const x=g(y,b-1);h[v]=o?d[x]+h[x]:d[v]+h[x]}}const m=n.makeTensorInfo(l.shape,f,h);if(u!=null){const y=Eh(u),b=Yi({inputs:{x:m},backend:n,attrs:{perm:y}});return n.disposeIntermediateTensorInfo(m),n.disposeIntermediateTensorInfo(l),b}return m}const HRe={kernelName:z2,backendName:"cpu",kernelFunc:GRe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qRe(e){const{inputs:t,backend:n,attrs:r}=e,{x:i,weights:s}=t,{size:o,binaryOutput:a}=r;if(i.shape.length===1){const u=n.data.get(i.dataId).values,l=n.data.get(s.dataId).values,c=t6(u,l,s.dtype,s.shape,o);return n.makeTensorInfo([o],s.dtype,c)}else if(i.shape.length===2){const u=n.bufferSync(i),l=n.bufferSync(s),c=xse(u,l,o,a);return n.makeTensorInfo(c.shape,s.dtype,c.values)}throw new Error(`Error in denseBincount: input must be at most rank 2, but got rank${i.shape.length}.`)}const XRe={kernelName:VA,backendName:"cpu",kernelFunc:qRe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function YRe(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{blockSize:s,dataFormat:o}=r;N(o==="NHWC",()=>`Only NHWC dataFormat supported on CPU for depthToSpace. Got ${o}`);const a=i.shape[0],u=i.shape[1],l=i.shape[2],c=i.shape[3],f=u*s,h=l*s,d=c/(s*s),p=n.data.get(i.dataId).values,g=new Float32Array(a*f*h*d);let m=0;for(let y=0;y<a;++y)for(let b=0;b<f;++b){const v=Math.floor(b/s),x=b%s;for(let w=0;w<h;++w){const C=Math.floor(w/s),$=w%s,S=(x*s+$)*d;for(let k=0;k<d;++k){const _=k+S+c*(C+l*(v+u*y));g[m++]=p[_]}}}return n.makeTensorInfo([a,f,h,d],i.dtype,g)}const KRe={kernelName:GA,backendName:"cpu",kernelFunc:YRe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xoe(e){const{inputs:t,backend:n,attrs:r}=e,{x:i,filter:s}=t,{strides:o,pad:a,dilations:u,dimRoundingMode:l}=r;Te([i,s],"depthwiseConv2DNative");const c=Me(i.shape),f=Me(s.shape);let h=u;h==null&&(h=[1,1]),N(Or(o,h),()=>`Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ${o} and dilations '${h}'`);const d=dr(i.shape,s.shape,o,h,a,l,!0),{filterHeight:p,filterWidth:g,dilationHeight:m,dilationWidth:y,padInfo:b}=d,v=b.left,x=b.top,w=d.outChannels/d.inChannels,C=new zn(d.outShape,i.dtype),$=n.data.get(i.dataId).values,S=n.data.get(s.dataId).values,k=C.values;for(let E=0;E<d.batchSize;++E){const _=E*c[0],D=E*C.strides[0];for(let A=0;A<d.outHeight;++A){const T=D+A*C.strides[1],I=A*d.strideHeight-x;for(let F=0;F<p;++F){const R=I+F*m;if(R<0||R>=d.inHeight)continue;const L=F*f[0],P=_+R*c[1];for(let q=0;q<d.outWidth;++q){const X=T+q*C.strides[2],G=q*d.strideWidth-v;for(let J=0;J<g;++J){const Q=G+J*y;if(Q<0||Q>=d.inWidth)continue;const ee=L+J*f[1],ue=P+Q*d.inChannels;let ge=X,xe=ee;for(let B=0;B<d.inChannels;++B){const H=$[ue+B];for(let Y=0;Y<w;++Y)k[ge+Y]+=H*S[xe+Y];ge+=w,xe+=w}}}}}}return n.makeTensorInfo(C.shape,C.dtype,C.values)}const ZRe={kernelName:U2,backendName:"cpu",kernelFunc:xoe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function JRe(e){const{inputs:t,backend:n,attrs:r}=e,{x:i,dy:s}=t,{strides:o,dilations:a,pad:u,dimRoundingMode:l,filterShape:c}=r;Te([i,s],"depthwiseConv2dNativeBackpropFilter");const f=dr(i.shape,c,o,a,u,l,!0),{strideHeight:h,strideWidth:d,filterHeight:p,filterWidth:g}=f,m=new zn(f.filterShape,"float32"),y=f.padInfo.left,b=f.padInfo.top,v=f.outChannels/f.inChannels,x=n.data.get(i.dataId).values,w=new zn(i.shape,i.dtype,x),C=n.data.get(s.dataId).values,$=new zn(s.shape,s.dtype,C);for(let S=0;S<p;++S){const k=Math.max(0,Math.ceil((b-S)/h)),E=Math.min(f.outHeight,(f.inHeight+b-S)/h);for(let _=0;_<g;++_){const D=Math.max(0,Math.ceil((y-_)/d)),A=Math.min(f.outWidth,(f.inWidth+y-_)/d);for(let T=0;T<f.outChannels;++T){const I=Math.trunc(T/v),F=T%v;let R=0;for(let L=0;L<f.batchSize;++L)for(let P=k;P<E;++P){const q=S+P*h-b;for(let X=D;X<A;++X){const G=_+X*d-y;R+=w.get(L,q,G,I)*$.get(L,P,X,T)}}m.set(R,S,_,I,F)}}}return n.makeTensorInfo(m.shape,m.dtype,m.values)}const QRe={kernelName:HA,backendName:"cpu",kernelFunc:JRe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function eMe(e){const{inputs:t,backend:n,attrs:r}=e,{dy:i,filter:s}=t,{strides:o,dilations:a,pad:u,dimRoundingMode:l,inputShape:c}=r;Te([i,s],"depthwiseConv2DNativeBackpropInput");const f=Me(i.shape),h=Me(s.shape),d=dr(c,s.shape,o,a,u,l,!0),p=new zn(d.inShape,"float32"),g=p.values,[m,y,b]=p.strides,v=n.data.get(i.dataId).values,[x,w,C]=f,$=n.data.get(s.dataId).values,[S,k,E]=h,{batchSize:_,filterHeight:D,filterWidth:A,inChannels:T,inHeight:I,inWidth:F,outChannels:R,outHeight:L,outWidth:P,strideHeight:q,strideWidth:X}=d,G=D-1-d.padInfo.top,J=A-1-d.padInfo.left,Q=R/T;for(let ee=0;ee<_;++ee)for(let ue=0;ue<T;++ue)for(let ge=0;ge<I;++ge){const xe=ge-G,B=Math.max(0,Math.ceil(xe/q)),H=Math.min(L,(D+xe)/q);for(let Y=0;Y<F;++Y){const M=Y-J,he=Math.max(0,Math.ceil(M/X)),ae=Math.min(P,(A+M)/X);let me=0;for(let de=B;de<H;++de){const Oe=de*q-xe;for(let Ye=he;Ye<ae;++Ye){const Wn=Ye*X-M,Ht=x*ee+w*de+C*Ye,Ln=S*(D-1-Oe)+k*(A-1-Wn)+E*ue;for(let pt=0;pt<Q;++pt){const qt=ue*Q+pt,tr=v[Ht+qt],gt=$[Ln+pt];me+=tr*gt}}}g[m*ee+y*ge+b*Y+ue]=me}}return n.makeTensorInfo(p.shape,p.dtype,p.values)}const tMe={kernelName:qA,backendName:"cpu",kernelFunc:eMe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nMe(e){const{inputs:t,backend:n}=e,{x:r}=t,i=te(r.shape),s=n.data.get(r.dataId).values,o=rt([i,i],r.dtype),a=o.values;for(let l=0;l<s.length;l++)a[l*i+l]=s[l];const u=[...r.shape,...r.shape];return n.makeTensorInfo(u,o.dtype,o.values)}const rMe={kernelName:XA,backendName:"cpu",kernelFunc:nMe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const iMe={kernelName:j2,backendName:"cpu",kernelFunc:({inputs:e,backend:t,attrs:n})=>{const{x:r,filter:i}=e,{strides:s,pad:o,dilations:a}=n,u=t,l=u.data.get(r.dataId).values,c=r.shape.length,f=u.data.get(i.dataId).values,h=i.shape.length,{batchSize:d,inHeight:p,inWidth:g,inChannels:m,outHeight:y,outWidth:b,padInfo:v,strideHeight:x,strideWidth:w,filterHeight:C,filterWidth:$,dilationHeight:S,dilationWidth:k,outShape:E}=Dw(r.shape,i.shape,s,o,"NHWC",a),_=te(E),D=E.length,A=En(r.dtype,_);for(let I=0;I<d;++I)for(let F=0;F<y;++F){const R=F*x-v.top;for(let L=0;L<b;++L){const P=L*w-v.left;for(let q=0;q<m;++q){let X=Number.MIN_SAFE_INTEGER;for(let J=0;J<C;++J){const Q=R+J*S;if(Q>=0&&Q<p)for(let ee=0;ee<$;++ee){const ue=P+ee*k;if(ue>=0&&ue<g){const ge=$a([I,Q,ue,q],c,Me(r.shape)),xe=$a([J,ee,q],h,Me(i.shape)),B=l[ge]+f[xe];B>X&&(X=B)}}}const G=$a([I,F,L,q],D,Me(E));A[G]=X}}}return{dataId:u.write(Ch(A,r.dtype),E,r.dtype),shape:E,dtype:r.dtype}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sMe={kernelName:Nk,backendName:"cpu",kernelFunc:({inputs:e,backend:t,attrs:n})=>{const{x:r,filter:i,dy:s}=e,{strides:o,pad:a,dilations:u}=n,l=t,c=Fo(r.shape,l.data.get(r.dataId).values),f=Fo(i.shape,l.data.get(i.dataId).values),{batchSize:h,inHeight:d,inWidth:p,inChannels:g,outHeight:m,outWidth:y,padInfo:b,strideHeight:v,strideWidth:x,filterHeight:w,filterWidth:C,dilationHeight:$,dilationWidth:S,outShape:k}=Dw(r.shape,i.shape,o,a,"NHWC",u);N(s.rank===k.length,()=>`Error in ${Nk}, dy must have the same rank as output ${k.length}, but got ${s.rank}`);const E=Fo(k,l.data.get(s.dataId).values),_=eB(i.shape,i.dtype);for(let A=0;A<h;++A)for(let T=0;T<m;++T){const I=T*v-b.top;for(let F=0;F<y;++F){const R=F*x-b.left;for(let L=0;L<g;++L){let P=Number.MIN_SAFE_INTEGER,q=0,X=0;for(let G=0;G<w;++G){const J=I+G*$;if(J>=0&&J<d)for(let Q=0;Q<C;++Q){const ee=R+Q*S;if(ee>=0&&ee<p){const ue=c[A][J][ee][L]+f[G][Q][L];ue>P&&(P=ue,q=G,X=Q)}}}_[q][X][L]+=E[A][T][F][L]}}}return{dataId:l.write(Ch(_,r.dtype),i.shape,i.dtype),shape:i.shape,dtype:i.dtype}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const oMe={kernelName:Dk,backendName:"cpu",kernelFunc:({inputs:e,backend:t,attrs:n})=>{const{x:r,filter:i,dy:s}=e,{strides:o,pad:a,dilations:u}=n,l=t,c=Fo(r.shape,l.data.get(r.dataId).values),f=Fo(i.shape,l.data.get(i.dataId).values),{batchSize:h,inHeight:d,inWidth:p,inChannels:g,outHeight:m,outWidth:y,padInfo:b,strideHeight:v,strideWidth:x,filterHeight:w,filterWidth:C,dilationHeight:$,dilationWidth:S,outShape:k}=Dw(r.shape,i.shape,o,a,"NHWC",u);N(s.rank===k.length,()=>`Error in ${Dk}, dy must have the same rank as output ${k.length}, but got ${s.rank}`);const E=Fo(k,l.data.get(s.dataId).values),_=eB(r.shape,r.dtype);for(let A=0;A<h;++A)for(let T=0;T<m;++T){const I=T*v-b.top;for(let F=0;F<y;++F){const R=F*x-b.left;for(let L=0;L<g;++L){let P=Number.MIN_SAFE_INTEGER,q=I<0?0:I,X=R<0?0:R;for(let G=0;G<w;++G){const J=I+G*$;if(J>=0&&J<d)for(let Q=0;Q<C;++Q){const ee=R+Q*S;if(ee>=0&&ee<p){const ue=c[A][J][ee][L]+f[G][Q][L];ue>P&&(P=ue,q=J,X=ee)}}}_[A][q][X][L]+=E[A][T][F][L]}}}return{dataId:l.write(Ch(_,r.dtype),r.shape,r.dtype),shape:r.shape,dtype:r.dtype}}};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function aMe(e){const{inputs:t,backend:n,attrs:r}=e,{image:i}=t,{canvas:s,options:o}=r,{contextOptions:a,imageOptions:u}=o||{},l=(u==null?void 0:u.alpha)||1,c=(a==null?void 0:a.contextType)||"2d";if(c!=="2d")throw new Error(`Context type ${a.contextType} is not supported by the CPU backend.`);const f=s.getContext(c,(a==null?void 0:a.contextAttributes)||{});if(f==null)throw new Error(`Could not get the context with ${c} type.`);const[h,d]=i.shape.slice(0,2),p=i.shape.length===2?1:i.shape[2],g=n.data.get(i.dataId).values,m=i.dtype==="float32"?255:1,y=new Uint8ClampedArray(d*h*4);for(let v=0;v<h*d;++v){const x=[0,0,0,255*l];for(let C=0;C<p;C++){const $=g[v*p+C];if(i.dtype==="float32"){if($<0||$>1)throw new Error(`Tensor values for a float32 Tensor must be in the range [0 - 1] but encountered ${$}.`)}else if(i.dtype==="int32"&&($<0||$>255))throw new Error(`Tensor values for a int32 Tensor must be in the range [0 - 255] but encountered ${$}.`);p===1?(x[0]=$*m,x[1]=$*m,x[2]=$*m):x[C]=$*m}const w=v*4;y[w+0]=Math.round(x[0]),y[w+1]=Math.round(x[1]),y[w+2]=Math.round(x[2]),y[w+3]=Math.round(x[3])}s.width=d,s.height=h;const b=new ImageData(y,d,h);return f.putImageData(b,0,0),i}const uMe={kernelName:YA,backendName:"cpu",kernelFunc:aMe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Yw(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{axis:s,keepDims:o}=r;Te(i,"sum");let a;i.dtype==="bool"?a=Vf({inputs:{x:i},backend:n,attrs:{dtype:"int32"}}):a=Pu({inputs:{x:i},backend:n});const u=a.shape.length,l=st(s,a.shape),c=Cn(l,u);let f=l,h=a;c!=null&&(h=Yi({inputs:{x:a},backend:n,attrs:{perm:c}}),f=On(f.length,u)),Rr("sum",f,h.shape.length);const[d,p]=pr(h.shape,f),g=qi(h.dtype,"int32");let m=Yk(n,d,g);const y=te(p),b=n.data.get(m.dataId).values,v=n.data.get(h.dataId).values;for(let x=0;x<b.length;++x){const w=x*y;let C=0;for(let $=0;$<y;++$)C+=v[w+$];b[x]=C}if(o){const x=Fn(m.shape,l),w=m;m=nn({inputs:{x:m},backend:n,attrs:{shape:x}}),n.disposeIntermediateTensorInfo(w)}return n.disposeIntermediateTensorInfo(a),c!=null&&n.disposeIntermediateTensorInfo(h),m}const lMe={kernelName:ww,backendName:"cpu",kernelFunc:Yw};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cMe(e){const{inputs:t,backend:n,attrs:r}=e,{equation:i}=r,s=t,{allDims:o,summedDims:a,idDims:u}=C5(i,s.length);k5(o.length,u,s);const{path:l,steps:c}=E5(a,u),f=c.length;let h=null,d=o.length;const p=[];for(let g=0;g<f;++g){for(const m of c[g]){const{permutationIndices:y,expandDims:b}=S5(d,u[m]);let v;_5(y)?v=s[m]:(v=Yi({inputs:{x:s[m]},backend:n,attrs:{perm:y}}),p.push(v));const x=v.shape.slice();for(let w=0;w<b.length;++w)x.splice(b[w],0,1);bt(v.shape,x)||(v=nn({inputs:{x:v},backend:n,attrs:{shape:x}}),p.push(v)),h===null?h=v:(h=TI({inputs:{a:v,b:h},backend:n}),p.push(h))}g<f-1&&(l[g]>=0&&(h=Yw({inputs:{x:h},backend:n,attrs:{axis:l[g]-(o.length-d),keepDims:!1}}),p.push(h)),d--)}for(const g of p)g!==h&&n.disposeIntermediateTensorInfo(g);return h}const fMe={kernelName:KA,backendName:"cpu",kernelFunc:cMe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hMe(e){const{inputs:t,backend:n}=e,{dy:r,y:i}=t;Te([r,i],"eluGrad");const s=new Float32Array(te(i.shape)),o=n.data.get(i.dataId).values,a=n.data.get(r.dataId).values;for(let u=0;u<o.length;++u){const l=o[u];l>=0?s[u]=a[u]:s[u]=a[u]*(l+1)}return n.makeTensorInfo(i.shape,"float32",s)}const dMe={kernelName:ZA,backendName:"cpu",kernelFunc:hMe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const pMe=m5,gMe=y5,mMe=b5,yMe=x5,bMe=v5,xMe=w5,vMe=Ut(o1,e=>{const t=Math.sign(e),n=Math.abs(e),r=1/(1+pMe*n);return t*(1-((((xMe*r+bMe)*r+yMe)*r+mMe)*r+gMe)*r*Math.exp(-n*n))}),wMe={kernelName:o1,backendName:"cpu",kernelFunc:vMe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Jk(e){const{inputs:t,backend:n,attrs:r}=e,{input:i}=t,{dim:s}=r,o=i.shape.length,a=i.shape.slice();let u=s;return s<0&&(N(-(o+1)<=s,()=>`Axis must be in the interval [${-(o+1)}, ${o}]`),u=o+s+1),a.splice(u,0,1),nn({inputs:{x:i},backend:n,attrs:{shape:a}})}const $Me={kernelName:V2,backendName:"cpu",kernelFunc:Jk};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const CMe=Mn((e,t)=>e/t),a6=Qn(i1,CMe),gM={kernelName:i1,backendName:"cpu",kernelFunc:a6};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function voe(e,t,n){const r=e.shape,i=r[0],s=r[1],o=n.data.get(e.dataId),a=o.complexTensorInfos.real,u=o.complexTensorInfos.imag,l=[i,s],c=te(l),f=hr("float32",c),h=hr("float32",c);for(let m=0;m<i;m++){const y=$p({inputs:{x:a},backend:n,attrs:{begin:[m,0],size:[1,s]}}),b=$p({inputs:{x:u},backend:n,attrs:{begin:[m,0],size:[1,s]}}),v=ms({inputs:{real:y,imag:b},backend:n}),{real:x,imag:w}=SMe(v,t,n),C=uc(x,w);for(let $=0;$<s;$++){const S=$5(C,$);f[m*s+$]=S.real,h[m*s+$]=S.imag}n.disposeIntermediateTensorInfo(y),n.disposeIntermediateTensorInfo(b),n.disposeIntermediateTensorInfo(v)}const d=n.makeTensorInfo(l,"float32",f),p=n.makeTensorInfo(l,"float32",h),g=ms({inputs:{real:d,imag:p},backend:n});return n.disposeIntermediateTensorInfo(d),n.disposeIntermediateTensorInfo(p),g}function SMe(e,t,n){const r=te(e.shape),i=n.data.get(e.dataId),s=n.data.get(i.complexTensorInfos.real.dataId).values,o=n.data.get(i.complexTensorInfos.imag.dataId).values;if(kMe(r)){const a=mM(s,o,r,t,n),u=[e.shape[0],e.shape[1]];if(t){const l=n.makeTensorInfo(u,"float32",a.real),c=n.makeTensorInfo(u,"float32",a.imag),f=n.makeTensorInfo([],"float32",xc(r,"float32")),h=Pu({inputs:{x:f},backend:n}),d=gM.kernelFunc({inputs:{a:l,b:f},backend:n}),p=gM.kernelFunc({inputs:{a:c,b:h},backend:n}),g=n.data.get(d.dataId).values,m=n.data.get(p.dataId).values;return n.disposeIntermediateTensorInfo(l),n.disposeIntermediateTensorInfo(c),n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(h),n.disposeIntermediateTensorInfo(d),n.disposeIntermediateTensorInfo(p),{real:g,imag:m}}return a}else{const a=uc(s,o),u=EMe(a,r,t);return Rne(u)}}function kMe(e){return(e&e-1)===0}function mM(e,t,n,r,i){if(n===1)return{real:e,imag:t};const s=uc(e,t),o=n/2,a=Mne(s),u=a.real,l=a.imag,c=[u.length],f=i.makeTensorInfo(c,"float32",u),h=i.makeTensorInfo(c,"float32",l),d=ms({inputs:{real:f,imag:h},backend:i}),p=Lne(s),g=p.real,m=p.imag,y=[g.length],b=i.makeTensorInfo(y,"float32",g),v=i.makeTensorInfo(y,"float32",m),x=ms({inputs:{real:b,imag:v},backend:i}),w=mM(u,l,o,r,i),C=w.real,$=w.imag,S=[C.length],k=i.makeTensorInfo(S,"float32",C),E=i.makeTensorInfo(S,"float32",$),_=ms({inputs:{real:k,imag:E},backend:i}),D=mM(g,m,o,r,i),A=D.real,T=D.imag,I=[A.length],F=i.makeTensorInfo(I,"float32",A),R=i.makeTensorInfo(I,"float32",T),L=ms({inputs:{real:F,imag:R},backend:i}),P=Bne(n,r),q=[P.real.length],X=i.makeTensorInfo(q,"float32",P.real),G=i.makeTensorInfo(q,"float32",P.imag),J=ms({inputs:{real:X,imag:G},backend:i}),Q=TI({inputs:{a:J,b:L},backend:i}),ee=Zm({inputs:{a:_,b:Q},backend:i}),ue=s6({inputs:{a:_,b:Q},backend:i}),ge=wp({inputs:{input:ee},backend:i}),xe=wp({inputs:{input:ue},backend:i}),B=Jm({inputs:{input:ee},backend:i}),H=Jm({inputs:{input:ue},backend:i}),Y=Qm({inputs:[ge,xe],backend:i,attrs:{axis:0}}),M=Qm({inputs:[B,H],backend:i,attrs:{axis:0}}),he=i.data.get(Y.dataId).values,ae=i.data.get(M.dataId).values;return i.disposeIntermediateTensorInfo(f),i.disposeIntermediateTensorInfo(h),i.disposeIntermediateTensorInfo(d),i.disposeIntermediateTensorInfo(b),i.disposeIntermediateTensorInfo(v),i.disposeIntermediateTensorInfo(x),i.disposeIntermediateTensorInfo(k),i.disposeIntermediateTensorInfo(E),i.disposeIntermediateTensorInfo(_),i.disposeIntermediateTensorInfo(F),i.disposeIntermediateTensorInfo(R),i.disposeIntermediateTensorInfo(L),i.disposeIntermediateTensorInfo(X),i.disposeIntermediateTensorInfo(G),i.disposeIntermediateTensorInfo(J),i.disposeIntermediateTensorInfo(Q),i.disposeIntermediateTensorInfo(ee),i.disposeIntermediateTensorInfo(ue),i.disposeIntermediateTensorInfo(ge),i.disposeIntermediateTensorInfo(B),i.disposeIntermediateTensorInfo(xe),i.disposeIntermediateTensorInfo(H),i.disposeIntermediateTensorInfo(Y),i.disposeIntermediateTensorInfo(M),{real:he,imag:ae}}function EMe(e,t,n){const r=new Float32Array(t*2);for(let i=0;i<t;i++){let s=0,o=0;for(let a=0;a<t;a++){const u=zne(i*a,t,n),l=$5(e,a);s+=l.real*u.real-l.imag*u.imag,o+=l.real*u.imag+l.imag*u.real}n&&(s/=t,o/=t),Pne(r,s,o,i)}return r}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _Me(e){const{inputs:t,backend:n}=e,{input:r}=t,i=te(r.shape),s=r.shape[r.shape.length-1],o=i/s,a=nn({inputs:{x:r},backend:n,attrs:{shape:[o,s]}}),u=voe(a,!1,n),l=nn({inputs:{x:u},backend:n,attrs:{shape:r.shape}});return n.disposeIntermediateTensorInfo(a),n.disposeIntermediateTensorInfo(u),l}const AMe={kernelName:JA,backendName:"cpu",kernelFunc:_Me};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function u6(e){const{backend:t,attrs:n}=e,{shape:r,value:i,dtype:s}=n,o=s||tg(i),a=En(o,te(r));return IMe(a,i,o),t.makeTensorInfo(r,o,a)}const TMe={kernelName:QA,backendName:"cpu",kernelFunc:u6};function IMe(e,t,n){e.fill(t)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const DMe={kernelName:eT,backendName:"cpu",kernelFunc:({inputs:e,attrs:t,backend:n})=>{const{image:r}=e,i=n,s=hr(r.dtype,te(r.shape)),[o,a,u,l]=r.shape,c=i.data.get(r.dataId).values;for(let h=0;h<o;h++){const d=h*u*a*l;for(let p=0;p<a;p++){const g=p*(u*l);for(let m=0;m<u;m++){const y=m*l;for(let b=0;b<l;b++){const v=Math.round(u-m-1),x=d+g+y+b;let w=c[x];if(v>=0&&v<u){const C=v*l,$=d+g+C+b;w=c[$]}s[x]=w}}}}return{dataId:i.write(s,r.shape,r.dtype),shape:r.shape,dtype:r.dtype}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function NMe(e){const{inputs:t,backend:n,attrs:r}=e,{x:i,filter:s,bias:o,preluActivationWeights:a}=t,{strides:u,pad:l,dataFormat:c,dilations:f,dimRoundingMode:h,activation:d,leakyreluAlpha:p}=r;let g=boe({inputs:{x:i,filter:s},backend:n,attrs:{strides:u,pad:l,dataFormat:c,dilations:f,dimRoundingMode:h}});if(o){const m=g;if(c==="NCHW"&&o.shape.length===1&&o.shape[0]!==1){const y=nn({inputs:{x:o},backend:n,attrs:{shape:[o.shape[0],1,1]}});g=Zm({inputs:{a:g,b:y},backend:n}),n.disposeIntermediateTensorInfo(y)}else g=Zm({inputs:{a:g,b:o},backend:n});n.disposeIntermediateTensorInfo(m)}if(d){const m=g;if(c==="NCHW"&&d==="prelu"&&a.shape.length===1&&a.shape[0]!==1){const y=nn({inputs:{x:a},backend:n,attrs:{shape:[a.shape[0],1,1]}});g=Zk(n,g,d,y,p),n.disposeIntermediateTensorInfo(y)}else g=Zk(n,g,d,a,p);n.disposeIntermediateTensorInfo(m)}return g}const FMe={kernelName:Lx,backendName:"cpu",kernelFunc:NMe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function OMe(e){const{inputs:t,backend:n,attrs:r}=e,{x:i,filter:s,bias:o,preluActivationWeights:a}=t,{strides:u,pad:l,dataFormat:c,dilations:f,dimRoundingMode:h,activation:d,leakyreluAlpha:p}=r;let g=xoe({inputs:{x:i,filter:s},backend:n,attrs:{strides:u,pad:l,dataFormat:c,dilations:f,dimRoundingMode:h}});if(o){const m=g;g=Zm({inputs:{a:g,b:o},backend:n}),n.disposeIntermediateTensorInfo(m)}if(d){const m=g;g=Zk(n,g,d,a,p),n.disposeIntermediateTensorInfo(m)}return g}const RMe={kernelName:Px,backendName:"cpu",kernelFunc:OMe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function MMe(e){const{inputs:t,backend:n}=e,{params:r,indices:i}=t,s=te(r.shape),o=i.shape,a=o[o.length-1],[u,l,c,f]=dI(r,i);if(l===0)return n.makeTensorInfo(u,r.dtype,[]);const h=n.data.get(i.dataId).values,d=n.bufferSync(r),p=Ise(h,d,r.dtype,l,a,c,f,r.shape,s);return n.makeTensorInfo(u,r.dtype,p.values)}const LMe={kernelName:tT,backendName:"cpu",kernelFunc:MMe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function PMe(e){const{inputs:t,backend:n,attrs:r}=e,{x:i,indices:s}=t,{axis:o,batchDims:a}=r;Te([i,s],"gatherV2");const u=st(o,i.shape)[0],l=n.data.get(s.dataId).values,c=i.shape[u];for(let x=0;x<l.length;++x){const w=l[x];N(w<=c-1&&w>=0,()=>`GatherV2: the index value ${w} is not in [0, ${c-1}]`)}let f=a;a==null&&(f=0);const h=te(s.shape),d=T5(i,s,u,f),p=nn({inputs:{x:i},backend:n,attrs:{shape:[d.batchSize,d.outerSize,d.dimSize,d.sliceSize]}}),g=nn({inputs:{x:s},backend:n,attrs:{shape:[d.batchSize,h/d.batchSize]}}),m=[d.batchSize,d.outerSize,h/d.batchSize,d.sliceSize],y=n.bufferSync(g),b=n.bufferSync(p),v=Dse(b,y,m);return n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(g),n.makeTensorInfo(d.outputShape,v.dtype,v.values)}const BMe={kernelName:H2,backendName:"cpu",kernelFunc:PMe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zMe(e){const{inputs:t,backend:n}=e,{input:r}=t,i=te(r.shape),s=r.shape[r.shape.length-1],o=i/s,a=nn({inputs:{x:r},backend:n,attrs:{shape:[o,s]}}),u=voe(a,!0,n),l=nn({inputs:{x:u},backend:n,attrs:{shape:r.shape}});return n.disposeIntermediateTensorInfo(a),n.disposeIntermediateTensorInfo(u),l}const UMe={kernelName:nT,backendName:"cpu",kernelFunc:zMe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const jMe=Ut(d1,e=>Number.isFinite(e)?1:0,"bool"),WMe={kernelName:d1,backendName:"cpu",kernelFunc:jMe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const VMe=Ut(p1,e=>Math.abs(e)===1/0?1:0,"bool"),GMe={kernelName:p1,backendName:"cpu",kernelFunc:VMe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const HMe=Ut(g1,e=>Number.isNaN(e)?1:0,"bool"),qMe={kernelName:g1,backendName:"cpu",kernelFunc:HMe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function XMe(e){const{backend:t,attrs:n}=e,{start:r,stop:i,num:s}=n,o=Mse(r,i,s);return t.makeTensorInfo([o.length],"float32",o)}const YMe={kernelName:iT,backendName:"cpu",kernelFunc:XMe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const KMe=Ut(y1,e=>Math.log1p(e)),ZMe={kernelName:y1,backendName:"cpu",kernelFunc:KMe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const JMe=Mn((e,t)=>e&&t),QMe=Qn(Z2,JMe,null,"bool"),e4e={kernelName:Z2,backendName:"cpu",kernelFunc:QMe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const t4e=Ut(J2,e=>e?0:1,"bool"),n4e={kernelName:J2,backendName:"cpu",kernelFunc:t4e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const r4e=Mn((e,t)=>e||t),i4e=Qn(Q2,r4e,null,"bool"),s4e={kernelName:Q2,backendName:"cpu",kernelFunc:i4e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function o4e(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{depthRadius:s,bias:o,alpha:a,beta:u}=r;Te(i,"LRN");const l=i.shape[3],c=l-1,f=n.data.get(i.dataId).values,h=te(i.shape),d=new Float32Array(h);function p(g){const m=g%l;let y=g-m+Math.max(0,m-s);const b=g-m+Math.min(m+s,c);let v=0;for(;y<=b;y++){const x=f[y];v+=x*x}return v}for(let g=0;g<h;g++){const m=p(g),y=f[g]*Math.pow(o+a*m,-u);d[g]=y}return n.makeTensorInfo(i.shape,i.dtype,d)}const a4e={kernelName:ew,backendName:"cpu",kernelFunc:o4e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function u4e(e){const{inputs:t,backend:n,attrs:r}=e,{x:i,y:s,dy:o}=t,{depthRadius:a,bias:u,alpha:l,beta:c}=r;Te(o,"LRNGrad");const f=te(o.shape),h=o.shape[3],d=n.data.get(o.dataId).values,p=n.data.get(i.dataId).values,g=n.data.get(s.dataId).values,m=new Float32Array(f),y=f;for(let b=0;b<y;b++){const v=b%h,x=b-v+Math.max(0,v-a),w=b-v+Math.min(h,v+a+1);let C=0;for(let $=x;$<w;$++)C+=Math.pow(p[$],2);C=l*C+u;for(let $=x;$<w;$++){let S=-2*l*c*p[$]*g[b]/C;b===$&&(S+=Math.pow(C,-c)),S*=d[b],m[$]+=S}}return n.makeTensorInfo(o.shape,i.dtype,m)}const l4e={kernelName:sT,backendName:"cpu",kernelFunc:u4e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function woe(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{reductionIndices:s,keepDims:o}=r,a=n;let u=i.shape;const l=u.length,c=st(s,u);let f=c;const h=Cn(f,l);let d=a.data.get(i.dataId).values;if(h!=null){const x=new Array(l);for(let w=0;w<x.length;w++)x[w]=u[h[w]];d=r6(d,u,i.dtype,h,x),f=On(f.length,l),u=x}Te(i,"max"),Rr("max",f,l);const[p,g]=pr(u,f),m=te(g),y=Pse(d,m,p,i.dtype),b=a.write(y,p,i.dtype);let v=p;return o&&(v=Fn(p,c)),{dataId:b,shape:v,dtype:i.dtype}}const c4e={kernelName:tw,backendName:"cpu",kernelFunc:woe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function f4e(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t;Te(i,"maxPool");const{filterSize:s,strides:o,pad:a,dimRoundingMode:u}=r,l=1;N(Or(o,l),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${o} and dilations '${l}'`);const c=Ho(i.shape,s,o,l,a,u);let f;if(c.filterWidth===1&&c.filterHeight===1&&bt(c.inShape,c.outShape))f=Pu({inputs:{x:i},backend:n});else{const h=n.data.get(i.dataId).values,d=Me(i.shape),p=o6(h,i.shape,i.dtype,d,c,"max");f=n.makeTensorInfo(c.outShape,i.dtype,p.values)}return f}const h4e={kernelName:nw,backendName:"cpu",kernelFunc:f4e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function d4e(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{filterSize:s,strides:o,pad:a,dimRoundingMode:u,dataFormat:l}=r;Te(i,"maxPool3d");const c=vc(i.shape,s,o,1,a,u,l),f=n.data.get(i.dataId).values,h=yoe(f,i.shape,i.dtype,Me(i.shape),c,"max");return n.makeTensorInfo(h.shape,"float32",h.values)}const p4e={kernelName:rw,backendName:"cpu",kernelFunc:d4e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function g4e(e){const{inputs:t,backend:n,attrs:r}=e,{dy:i,input:s}=t,{filterSize:o,strides:a,pad:u,dimRoundingMode:l}=r;Te([i,s],"maxPool3DGrad");const c=vc(s.shape,o,a,1,u,l),f=n.bufferSync(s),h=rRe(f,c),d=c.strideDepth,p=c.strideHeight,g=c.strideWidth,m=c.dilationDepth,y=c.dilationHeight,b=c.dilationWidth,v=c.effectiveFilterDepth,x=c.effectiveFilterHeight,w=c.effectiveFilterWidth,C=v-1-c.padInfo.front,$=w-1-c.padInfo.left,S=x-1-c.padInfo.top,k=rt(s.shape,"float32"),E=n.bufferSync(i);for(let _=0;_<c.batchSize;++_)for(let D=0;D<c.inChannels;++D)for(let A=0;A<c.inDepth;++A)for(let T=0;T<c.inHeight;++T)for(let I=0;I<c.inWidth;++I){const F=A-C,R=T-S,L=I-$;let P=0;for(let q=0;q<v;q+=m){const X=(F+q)/d;if(!(X<0||X>=c.outDepth||Math.floor(X)!==X))for(let G=0;G<x;G+=y){const J=(R+G)/p;if(!(J<0||J>=c.outHeight||Math.floor(J)!==J))for(let Q=0;Q<w;Q+=b){const ee=(L+Q)/g;if(ee<0||ee>=c.outWidth||Math.floor(ee)!==ee)continue;const ue=v*x*w-1-h.get(_,X,J,ee,D),ge=q*x*w+G*w+Q,xe=ue===ge?1:0;if(xe===0)continue;const B=E.get(_,X,J,ee,D);P+=B*xe}}}k.set(P,_,A,T,I,D)}return n.makeTensorInfo(k.shape,k.dtype,k.values)}const m4e={kernelName:aT,backendName:"cpu",kernelFunc:g4e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function y4e(e){const{inputs:t,backend:n,attrs:r}=e,{dy:i,input:s,output:o}=t,a=s;Te([s,o],"maxPoolGrad");const{filterSize:u,strides:l,pad:c,dimRoundingMode:f}=r,h=Ho(a.shape,u,l,1,c,f),d=n.data.get(a.dataId).values,p=rt(h.outShape,a.dtype,moe(d,a.shape,a.dtype,h).values),g=h.strideHeight,m=h.strideWidth,y=h.dilationHeight,b=h.dilationWidth,v=h.effectiveFilterHeight,x=h.effectiveFilterWidth,w=x-1-h.padInfo.left,C=v-1-h.padInfo.top,$=rt(a.shape,"float32"),S=n.data.get(i.dataId).values,k=rt(i.shape,"float32",S);for(let E=0;E<h.batchSize;++E)for(let _=0;_<h.inChannels;++_)for(let D=0;D<h.inHeight;++D)for(let A=0;A<h.inWidth;++A){const T=D-C,I=A-w;let F=0;for(let R=0;R<v;R+=y){const L=(T+R)/g;if(!(L<0||L>=h.outHeight||Math.floor(L)!==L))for(let P=0;P<x;P+=b){const q=(I+P)/m;if(q<0||q>=h.outWidth||Math.floor(q)!==q)continue;const X=v*x-1-p.get(E,L,q,_),G=R*x+P,J=X===G?1:0;if(J===0)continue;const Q=k.get(E,L,q,_);F+=Q*J}}$.set(F,E,D,A,_)}return n.makeTensorInfo($.shape,$.dtype,$.values)}const b4e={kernelName:oT,backendName:"cpu",kernelFunc:y4e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function x4e(e,t,n,r,i){const s=Me(t),o=o6(e,t,n,s,i,"max"),a=moe(e,t,n,i,!0,r);return[o.values,a.values]}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const v4e={kernelName:uT,backendName:"cpu",kernelFunc:({inputs:e,attrs:t,backend:n})=>{const{x:r}=e,{filterSize:i,strides:s,pad:o,includeBatchInIndex:a}=t,u=n;Te(r,"MaxPoolWithArgmax");const l=u.data.get(r.dataId).values,c=Ho(r.shape,i,s,[1,1],o),[f,h]=x4e(l,r.shape,r.dtype,a,c),d=u.write(f,c.outShape,r.dtype),p=u.write(h,c.outShape,r.dtype);return[{dataId:d,shape:c.outShape,dtype:r.dtype},{dataId:p,shape:c.outShape,dtype:"int32"}]}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function w4e(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{axis:s,keepDims:o}=r,a=st(s,i.shape),l=pr(i.shape,a)[1],c=te(l),f=[],h=n.makeTensorInfo([],"float32",new Float32Array([c]));f.push(h);const d=Vf({inputs:{x:i},backend:n,attrs:{dtype:"float32"}});f.push(d);const p=a6({inputs:{a:d,b:h},backend:n});f.push(p);const g=Yw({inputs:{x:p},backend:n,attrs:{axis:s,keepDims:o}});return f.forEach(m=>n.disposeIntermediateTensorInfo(m)),g}const $4e={kernelName:iw,backendName:"cpu",kernelFunc:w4e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function C4e(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{axis:s,keepDims:o}=r;Te(i,"min");const a=st(s,i.shape);let u=a;const l=Cn(u,i.shape.length);let c=i;l!=null&&(c=Yi({inputs:{x:i},backend:n,attrs:{perm:l}}),u=On(u.length,i.shape.length)),Rr("min",u,c.shape.length);const[f,h]=pr(c.shape,u),d=te(h),p=Ir(te(f),c.dtype),g=n.data.get(c.dataId).values;for(let y=0;y<p.length;++y){const b=y*d;let v=g[b];for(let x=0;x<d;++x){const w=g[b+x];(Number.isNaN(w)||w<v)&&(v=w)}p[y]=v}l!=null&&n.disposeIntermediateTensorInfo(c);const m=n.makeTensorInfo(f,c.dtype,p);if(o){const y=Fn(f,a),b=nn({inputs:{x:m},backend:n,attrs:{shape:y}});return n.disposeIntermediateTensorInfo(m),b}return m}const S4e={kernelName:sw,backendName:"cpu",kernelFunc:C4e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function k4e(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{paddings:s,mode:o}=r;Te(i,"mirrorPad");const a=s.map((v,x)=>v[0]+i.shape[x]+v[1]),u=s.map(v=>v[0]),l=s.map((v,x)=>v[0]+i.shape[x]),c=o==="reflect"?0:1,f=n.data.get(i.dataId).values,h=i.shape.length,d=Me(i.shape),p=te(a),g=a.length,m=Me(a),y=hr(i.dtype,p);for(let v=0;v<p;v++){let x=ng(v,g,m);for(let C=0;C<g;C++)x[C]<u[C]?x[C]=u[C]*2-x[C]-c:x[C]>=l[C]&&(x[C]=(l[C]-1)*2-x[C]+c);x=x.map((C,$)=>C-u[$]);const w=$a(x,h,d);y[v]=f[w]}return{dataId:n.write(y,a,i.dtype),shape:a,dtype:i.dtype}}const E4e={kernelName:ow,backendName:"cpu",kernelFunc:k4e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _4e=Mn((e,t)=>{const n=e%t;return e<0&&t<0||e>=0&&t>=0?n:(n+t)%t}),A4e=Qn(v1,_4e),T4e={kernelName:v1,backendName:"cpu",kernelFunc:A4e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $oe(e){const{inputs:t,backend:n,attrs:r}=e,{logits:i}=t,{dim:s}=r,o=i.shape.length;let a=s;if(a===-1&&(a=o-1),a!==o-1)throw Error(`Softmax along a non-last dimension is not yet supported. Logits was rank ${o} and dim was ${a}`);const u=st([a],i.shape),l=woe({inputs:{x:i},backend:n,attrs:{reductionIndices:u,keepDims:!1}}),c=Fn(l.shape,u),f=nn({inputs:{x:l},backend:n,attrs:{shape:c}}),h=s6({inputs:{a:i,b:f},backend:n}),d=Ese({inputs:{x:h},backend:n}),p=Yw({inputs:{x:d},backend:n,attrs:{axis:u,keepDims:!1}}),g=nn({inputs:{x:p},backend:n,attrs:{shape:c}}),m=a6({inputs:{a:d,b:g},backend:n});return n.disposeIntermediateTensorInfo(l),n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(h),n.disposeIntermediateTensorInfo(d),n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(g),m}const I4e={kernelName:Sw,backendName:"cpu",kernelFunc:$oe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function D4e(e){const{inputs:t,backend:n,attrs:r}=e,{logits:i}=t,{numSamples:s,seed:o,normalized:a}=r;Te(i,"multinomial");const u=a?i:$oe({inputs:{logits:i},backend:n,attrs:{dim:-1}}),l=u.shape[0],c=u.shape[1],f=n.data.get(u.dataId).values,h=[l,s],d=Ir(te(h),"int32");for(let p=0;p<l;++p){const g=p*c,m=new Float32Array(c-1);m[0]=f[g];for(let v=1;v<m.length;++v)m[v]=m[v-1]+f[g+v];const y=ZT.alea(o.toString()),b=p*s;for(let v=0;v<s;++v){const x=y();d[b+v]=m.length;for(let w=0;w<m.length;w++)if(x<m[w]){d[b+v]=w;break}}}return a||n.disposeIntermediateTensorInfo(u),n.makeTensorInfo(h,"int32",d)}const N4e={kernelName:lT,backendName:"cpu",kernelFunc:D4e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const F4e=lI;function O4e(e){const{inputs:t,backend:n,attrs:r}=e,{boxes:i,scores:s}=t,{maxOutputSize:o,iouThreshold:a,scoreThreshold:u}=r;Te(i,"NonMaxSuppression");const l=n.data.get(i.dataId).values,c=n.data.get(s.dataId).values,{selectedIndices:f}=F4e(l,c,o,a,u);return n.makeTensorInfo([f.length],"int32",new Int32Array(f))}const R4e={kernelName:cT,backendName:"cpu",kernelFunc:O4e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const M4e=cI;function L4e(e){const{inputs:t,backend:n,attrs:r}=e,{boxes:i,scores:s}=t,{maxOutputSize:o,iouThreshold:a,scoreThreshold:u,padToMaxOutputSize:l}=r;Te(i,"NonMaxSuppressionPadded");const c=n.data.get(i.dataId).values,f=n.data.get(s.dataId).values,{selectedIndices:h,validOutputs:d}=M4e(c,f,o,a,u,l);return[n.makeTensorInfo([h.length],"int32",new Int32Array(h)),n.makeTensorInfo([],"int32",new Int32Array([d]))]}const P4e={kernelName:fT,backendName:"cpu",kernelFunc:L4e};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const B4e=fI;function z4e(e){const{inputs:t,backend:n,attrs:r}=e,{boxes:i,scores:s}=t,{maxOutputSize:o,iouThreshold:a,scoreThreshold:u,softNmsSigma:l}=r;Te(i,"NonMaxSuppressionWithScore");const c=n.data.get(i.dataId).values,f=n.data.get(s.dataId).values,h=o,d=a,p=u,g=l,{selectedIndices:m,selectedScores:y}=B4e(c,f,h,d,p,g);return[n.makeTensorInfo([m.length],"int32",new Int32Array(m)),n.makeTensorInfo([y.length],"float32",new Float32Array(y))]}const U4e={kernelName:hT,backendName:"cpu",kernelFunc:z4e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function j4e(e){const{inputs:t,backend:n,attrs:r}=e,{indices:i}=t,{dtype:s,depth:o,onValue:a,offValue:u}=r;Te(i,"oneHot");const l=te(i.shape),c=new Float32Array(l*o);c.fill(u);const f=n.data.get(i.dataId).values;for(let h=0;h<l;++h)f[h]>=0&&f[h]<o&&(c[h*o+f[h]]=a);return n.makeTensorInfo([...i.shape,o],s,c)}const W4e={kernelName:cw,backendName:"cpu",kernelFunc:j4e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Qk(e){const{inputs:t,backend:n}=e,{x:r}=t;if(r.dtype==="string")throw new Error("zerosLike is not supported for string tensors");if(r.dtype==="complex64"){const i=wp({inputs:{input:r},backend:n}),s=Qk({inputs:{x:i},backend:n}),o=Jm({inputs:{input:r},backend:n}),a=Qk({inputs:{x:o},backend:n}),u=ms({inputs:{real:s,imag:a},backend:n});return n.disposeIntermediateTensorInfo(i),n.disposeIntermediateTensorInfo(s),n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(a),u}else return u6({backend:n,attrs:{shape:r.shape,value:0,dtype:r.dtype}})}const V4e={kernelName:Aw,backendName:"cpu",kernelFunc:Qk};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Coe(e){const{inputs:t,backend:n}=e,{x:r}=t;if(r.dtype==="string")throw new Error("onesLike is not supported for string tensors");if(r.dtype==="complex64"){const i=wp({inputs:{input:r},backend:n}),s=Coe({inputs:{x:i},backend:n}),o=Jm({inputs:{input:r},backend:n}),a=Qk({inputs:{x:o},backend:n}),u=ms({inputs:{real:s,imag:a},backend:n});return n.disposeIntermediateTensorInfo(i),n.disposeIntermediateTensorInfo(s),n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(a),u}else return u6({backend:n,attrs:{shape:r.shape,value:1,dtype:r.dtype}})}const G4e={kernelName:lw,backendName:"cpu",kernelFunc:Coe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Soe(e){const{inputs:t,backend:n,attrs:r}=e,{axis:i}=r;if(t.length===1)return Jk({inputs:{input:t[0]},backend:n,attrs:{dim:i}});const s=t[0].shape,o=t[0].dtype;t.forEach(c=>{Fr(s,c.shape,"All tensors passed to stack must have matching shapes"),N(o===c.dtype,()=>"All tensors passed to stack must have matching dtypes")});const a=[],u=t.map(c=>{const f=Jk({inputs:{input:c},backend:n,attrs:{dim:i}});return a.push(f),f}),l=Qm({inputs:u,backend:n,attrs:{axis:i}});return a.forEach(c=>n.disposeIntermediateTensorInfo(c)),l}const H4e={kernelName:fw,backendName:"cpu",kernelFunc:Soe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function q4e(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{paddings:s,constantValue:o}=r;Te(i,"pad");const a=s.map((b,v)=>b[0]+i.shape[v]+b[1]),u=s.map(b=>b[0]),l=n.data.get(i.dataId).values,c=te(i.shape),f=i.shape.length,h=Me(i.shape),d=te(a),p=a.length,g=Me(a),m=hr(i.dtype,d);o!==0&&m.fill(o);for(let b=0;b<c;b++){const x=ng(b,f,h).map((C,$)=>C+u[$]),w=$a(x,p,g);m[w]=l[b]}return{dataId:n.write(m,a,i.dtype),shape:a,dtype:i.dtype}}const koe={kernelName:hw,backendName:"cpu",kernelFunc:q4e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const X4e=Mn((e,t)=>Math.pow(e,t)),Y4e=Qn($1,X4e),K4e={kernelName:$1,backendName:"cpu",kernelFunc:Y4e};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Z4e(e){const{inputs:t,backend:n,attrs:r}=e,{paramsNestedSplits:i,paramsDenseValues:s,indices:o}=t,a=i.map(m=>n.data.get(m.dataId).values),u=i.map(m=>m.shape),l=n.data.get(s.dataId).values,c=n.data.get(o.dataId).values,[f,h,d]=Vse(a,u,l,s.shape,s.dtype,c,o.shape),p=f.map(m=>n.makeTensorInfo([m.length],"int32",m)),g=n.makeTensorInfo(d,s.dtype,h);return p.concat([g])}const J4e={kernelName:dT,backendName:"cpu",kernelFunc:Z4e};/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Q4e(e){const{inputs:t,backend:n}=e,{starts:r,limits:i,deltas:s}=t,o=n.data.get(r.dataId).values,a=n.data.get(i.dataId).values,u=n.data.get(s.dataId).values,[l,c]=Gse(o,r.shape,r.dtype,a,i.shape,u,s.shape),f=n.makeTensorInfo([l.length],"int32",l),h=n.makeTensorInfo([c.length],r.dtype,c);return[f,h]}const eLe={kernelName:pT,backendName:"cpu",kernelFunc:Q4e};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tLe(e){const{inputs:t,backend:n,attrs:r}=e,{shape:i,values:s,defaultValue:o,rowPartitionTensors:a}=t,{rowPartitionTypes:u}=r,l=n.data.get(i.dataId).values,c=n.data.get(s.dataId).values,f=n.data.get(o.dataId).values,h=a.map(m=>n.data.get(m.dataId).values),d=a.map(m=>m.shape),[p,g]=Hse(l,i.shape,c,s.shape,s.dtype,f,o.shape,h,d,u);return n.makeTensorInfo(p,s.dtype,g)}const nLe={kernelName:gT,backendName:"cpu",kernelFunc:tLe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rLe(e){const{backend:t,attrs:n}=e,{start:r,stop:i,dtype:s,step:o}=n,a=qse(r,i,o,s);return t.makeTensorInfo([a.length],s,a)}const iLe={kernelName:mT,backendName:"cpu",kernelFunc:rLe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sLe=Ut(C1,e=>1/e),oLe={kernelName:C1,backendName:"cpu",kernelFunc:sLe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function aLe(e){const{inputs:t,backend:n,attrs:r}=e,{images:i}=t,{alignCorners:s,halfPixelCenters:o,size:a}=r;Te(i,"resizeBilinear");const u=Me(i.shape),[l,c]=a,[f,h,d,p]=i.shape,g=n.data.get(i.dataId).values,m=new Float32Array(te([f,l,c,p])),y=[s&&l>1?h-1:h,s&&c>1?d-1:d],b=[s&&l>1?l-1:l,s&&c>1?c-1:c];let v=0;const x=y[0]/b[0],w=y[1]/b[1];for(let C=0;C<f;C++)for(let $=0;$<l;$++){let S;o?S=x*($+.5)-.5:S=x*$;const k=Math.max(0,Math.floor(S)),E=S-k,_=Math.min(h-1,Math.ceil(S)),D=C*u[0]+k*u[1],A=C*u[0]+_*u[1];for(let T=0;T<c;T++){let I;o?I=w*(T+.5)-.5:I=w*T;const F=Math.max(0,Math.floor(I)),R=I-F,L=Math.min(d-1,Math.ceil(I)),P=D+F*u[2],q=A+F*u[2],X=D+L*u[2],G=A+L*u[2];for(let J=0;J<p;J++){const Q=g[P+J],ee=g[q+J],ue=g[X+J],ge=g[G+J],xe=Q+(ue-Q)*R,B=ee+(ge-ee)*R,H=xe+(B-xe)*E;m[v++]=H}}}return n.makeTensorInfo([f,l,c,p],"float32",m)}const uLe={kernelName:yw,backendName:"cpu",kernelFunc:aLe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lLe(e){const{inputs:t,backend:n,attrs:r}=e,{images:i,dy:s}=t,{alignCorners:o}=r;Te([s,i],"resizeBilinearGrad");const a=Me(i.shape),[u,l,c,f]=i.shape,[,h,d]=s.shape,p=new Float32Array(u*l*c*f),g=[o&&h>1?l-1:l,o&&d>1?c-1:c],m=[o&&h>1?h-1:h,o&&d>1?d-1:d],y=g[0]/m[0],b=g[1]/m[1],v=n.data.get(s.dataId).values;let x=0;for(let w=0;w<u;w++){const C=w*a[0];for(let $=0;$<h;$++){const S=$*y,k=Math.floor(S),E=Math.min(Math.ceil(S),l-1),_=C+k*a[1],D=C+E*a[1],A=S-k,T=1-A;for(let I=0;I<d;I++){const F=I*b,R=Math.floor(F),L=Math.min(Math.ceil(F),c-1),P=F-R,q=1-P,X=_+R*a[2],G=_+L*a[2],J=D+R*a[2],Q=D+L*a[2],ee=T*q,ue=T*P,ge=A*q,xe=A*P;for(let B=0;B<f;B++){const H=v[x++];p[X+B]+=H*ee,p[G+B]+=H*ue,p[J+B]+=H*ge,p[Q+B]+=H*xe}}}}return n.makeTensorInfo([u,c,l,f],"float32",p)}const cLe={kernelName:xT,backendName:"cpu",kernelFunc:lLe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fLe(e){const{inputs:t,backend:n,attrs:r}=e,{images:i}=t,{alignCorners:s,halfPixelCenters:o,size:a}=r;Te(i,"resizeNearestNeighbor");const u=Me(i.shape),[l,c]=a,[f,h,d,p]=i.shape,g=n.data.get(i.dataId).values,m=new Float32Array(f*l*c*p),y=[s&&l>1?h-1:h,s&&c>1?d-1:d],b=[s&&l>1?l-1:l,s&&c>1?c-1:c],v=y[0]/b[0],x=y[1]/b[1];let w=0;for(let C=0;C<f;C++){const $=C*u[0];for(let S=0;S<l;S++){const k=o?v*(S+.5):v*S;let E=Math.min(h-1,s?Math.round(k):Math.floor(k));o&&(E=Math.max(0,E));const _=$+E*u[1];for(let D=0;D<c;D++){const A=o?x*(D+.5):x*D;let T=Math.min(d-1,s?Math.round(A):Math.floor(A));o&&(T=Math.max(0,T));const I=_+T*u[2];for(let F=0;F<p;F++){const R=g[I+F];m[w++]=R}}}}return n.makeTensorInfo([f,l,c,p],i.dtype,m)}const hLe={kernelName:mw,backendName:"cpu",kernelFunc:fLe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dLe(e){const{inputs:t,backend:n,attrs:r}=e,{images:i,dy:s}=t,{alignCorners:o}=r;Te([s,i],"resizeNearestNeighborGrad");const a=Me(i.shape),u=Me(s.shape),[l,c,f,h]=i.shape,[,d,p]=s.shape,g=new Float32Array(l*c*f*h),m=n.data.get(s.dataId).values,y=[o&&d>1?c-1:c,o&&p>1?f-1:f],b=[o&&d>1?d-1:d,o&&p>1?p-1:p],v=y[0]/b[0],x=y[1]/b[1],w=1/v,C=1/x,$=Math.ceil(w)*2+2,S=Math.ceil(C)*2+2;for(let k=0;k<l;k++){const E=k*a[0];for(let _=0;_<c;_++){const D=E+_*a[1],A=Math.floor(_*w),T=Math.floor(A-$/2);for(let I=0;I<f;I++){const F=D+I*a[2],R=Math.floor(I*C),L=Math.floor(R-S/2);for(let P=0;P<h;P++){let q=0;for(let X=0;X<$;X++){const G=X+T;if(G<0||G>=d)continue;const J=E+G*u[1],Q=G*v,ee=Math.min(c-1,o?Math.round(Q):Math.floor(Q));if(_===ee)for(let ue=0;ue<S;ue++){const ge=ue+L;if(ge<0||ge>=p)continue;const xe=J+ge*u[2],B=ge*x,H=Math.min(f-1,o?Math.round(B):Math.floor(B));I===H&&(q+=m[xe+P])}}g[F+P]=q}}}}return n.makeTensorInfo(i.shape,i.dtype,g)}const pLe={kernelName:bT,backendName:"cpu",kernelFunc:dLe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gLe(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{dims:s}=r;Te(i,"reverse");const o=i.shape.length,a=st(s,i.shape);if(o===0)return Pu({inputs:{x:i},backend:n});const u=new zn(i.shape,i.dtype),l=n.bufferSync(i);for(let c=0;c<u.size;c++){const f=u.indexToLoc(c),h=f.slice();a.forEach(d=>h[d]=i.shape[d]-1-h[d]),u.set(l.get(...h),...f)}return n.makeTensorInfo(u.shape,u.dtype,u.values)}const mLe={kernelName:bw,backendName:"cpu",kernelFunc:gLe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const yLe={kernelName:MT,backendName:"cpu",kernelFunc:({inputs:e,attrs:t,backend:n})=>{const{image:r}=e,{radians:i,fillValue:s,center:o}=t,a=n,u=hr(r.dtype,te(r.shape)),[l,c,f,h]=r.shape,[d,p]=d5(o,c,f),g=255,m=Math.sin(i),y=Math.cos(i),b=a.data.get(r.dataId).values;for(let x=0;x<l;x++){const w=x*f*c*h;for(let C=0;C<c;C++){const $=C*(f*h);for(let S=0;S<f;S++){const k=S*h;for(let E=0;E<h;E++){const _=[l,C,S,E],D=_[2],A=_[1];let T=(D-d)*y-(A-p)*m,I=(D-d)*m+(A-p)*y;T=Math.round(T+d),I=Math.round(I+p);let F=s;if(typeof s!="number"&&(E===3?F=g:F=s[E]),T>=0&&T<f&&I>=0&&I<c){const L=I*(f*h),P=T*h,q=w+L+P+E;F=b[q]}const R=w+$+k+E;u[R]=F}}}}return{dataId:a.write(u,r.shape,r.dtype),shape:r.shape,dtype:r.dtype}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const bLe=Ut(E1,e=>{const t=Math.floor(e);return e-t<.5?Math.floor(e):e-t>.5?Math.ceil(e):t%2===0?t:t+1}),xLe={kernelName:E1,backendName:"cpu",kernelFunc:bLe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vLe(e){const{inputs:t,backend:n,attrs:r}=e,{indices:i,updates:s}=t,{shape:o}=r,{sliceRank:a,numUpdates:u,sliceSize:l,strides:c,outputSize:f}=Th(s,i,o),h=!0,d=n.bufferSync(i),p=n.bufferSync(s),g=Pd(d,p,o,f,l,u,a,c,0,h);return n.makeTensorInfo(o,g.dtype,g.values)}const wLe={kernelName:vT,backendName:"cpu",kernelFunc:vLe};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $Le(e,t){let n=0,r=e.length,i=0;for(;n<r;)i=Math.floor((n+r)/2),e[i]<t?n=i+1:r=i;return r}function CLe(e,t){let n=0,r=e.length,i=0;for(;n<r;)i=Math.floor((n+r)/2),e[i]<=t?n=i+1:r=i;return r}function SLe(e,t,n,r,i,s){const o=En("int32",n*i);for(let a=0;a<n;++a){const u=e.slice(a*r,(a+1)*r),l=a*i;for(let c=0;c<i;++c)o[l+c]=s==="left"?$Le(u,t[c+l]):CLe(u,t[c+l])}return o}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kLe(e){const{inputs:t,backend:n,attrs:r}=e,{sortedSequence:i,values:s}=t,{side:o}=r,a=n.data.get(i.dataId).values,u=n.data.get(s.dataId).values,l=SLe(a,u,i.shape[0],i.shape[1],s.shape[1],o);return n.makeTensorInfo(s.shape,"int32",l)}const ELe={kernelName:$T,backendName:"cpu",kernelFunc:kLe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _Le(e){const{inputs:t,backend:n}=e,{condition:r,t:i,e:s}=t;Te([r,i,s],"select");const o=r.shape.length,a=n.data.get(r.dataId).values,u=n.data.get(i.dataId).values,l=n.data.get(s.dataId).values,c=qi(i.dtype,s.dtype),f=Ir(te(i.shape),c);let h=0;const d=o===0||o>1||i.shape.length===1?1:te(i.shape.slice(1));for(let p=0;p<a.length;p++)for(let g=0;g<d;g++)a[p]===1?f[h++]=u[p]:f[h++]=l[p];return n.makeTensorInfo(i.shape,c,f)}const ALe={kernelName:xw,backendName:"cpu",kernelFunc:_Le};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const TLe=mI,ILe=yI,DLe=Ut(A1,e=>e>=0?ILe*e:TLe*(Math.exp(e)-1)),NLe={kernelName:A1,backendName:"cpu",kernelFunc:DLe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const FLe=Ut(D1,e=>e<0?-1:e>0?1:0),OLe={kernelName:D1,backendName:"cpu",kernelFunc:FLe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const RLe=Ut(T1,e=>Math.sin(e)),MLe={kernelName:T1,backendName:"cpu",kernelFunc:RLe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const LLe=Ut(I1,e=>Math.sinh(e)),PLe={kernelName:I1,backendName:"cpu",kernelFunc:LLe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const BLe=11920928955078125e-23,hG=Math.log(BLe)+2,zLe=Ut(F1,e=>{const t=e>-hG,n=e<hG,r=Math.exp(e);let i;return n?i=r:t?i=e:i=Math.log(1+r),i}),ULe={kernelName:F1,backendName:"cpu",kernelFunc:zLe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jLe(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{blockShape:s,paddings:o}=r;Te([i],"spaceToBatchND");const a=te(s),u=[[0,0]];u.push(...o);for(let C=1+s.length;C<i.shape.length;++C)u.push([0,0]);const l=koe.kernelFunc({inputs:{x:i},backend:n,attrs:{paddings:u,constantValue:0}}),c=Pw(l.shape,s,a,!1),f=Bw(c.length,s.length,!1),h=zw(l.shape,s,a,!1),g=nn({inputs:{x:l},backend:n,attrs:{shape:c}}),b=Yi({inputs:{x:g},backend:n,attrs:{perm:f}}),w=nn({inputs:{x:b},backend:n,attrs:{shape:h}});return n.disposeIntermediateTensorInfo(l),n.disposeIntermediateTensorInfo(g),n.disposeIntermediateTensorInfo(b),w}const WLe={kernelName:$w,backendName:"cpu",kernelFunc:jLe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function VLe(e){const{inputs:t,backend:n}=e,{indices:r,values:i,denseShape:s,defaultValue:o}=t;if(s.shape.length!==1)throw new Error(`Dense shape must be a vector, saw:
        ${s.shape}`);if(r.shape.length!==2)throw new Error(`Indices must be a matrix, saw:
        ${r.shape}`);if(i.shape.length!==1)throw new Error(`Values must be a vector, saw:
        ${i.shape}`);if(o.shape.length!==0)throw new Error(`Default value must be a scalar, saw:
        ${o.shape}`);const a=n.data.get(r.dataId).values,u=n.data.get(i.dataId).values,l=n.data.get(s.dataId).values,c=n.data.get(o.dataId).values[0],[f,h,d,p,g]=Zse(a,r.shape,r.dtype,u,i.dtype,l,c);return[n.makeTensorInfo(h,r.dtype,f),n.makeTensorInfo([h[0]],i.dtype,d),n.makeTensorInfo([p.length],"bool",new Uint8Array(p.map(m=>Number(m)))),n.makeTensorInfo([g.length],r.dtype,new Int32Array(g))]}const GLe={kernelName:CT,backendName:"cpu",kernelFunc:VLe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function HLe(e){const{inputs:t,backend:n}=e,{inputIndices:r,inputShape:i,newShape:s}=t;if(r.shape.length!==2)throw new Error(`Input indices should be a matrix but received shape
        ${r.shape}`);if(i.shape.length!==1)throw new Error(`Input shape should be a vector but received shape
        ${i.shape}`);if(s.shape.length!==1)throw new Error(`Target shape should be a vector but received shape ${s.shape}`);const o=Array.from(n.data.get(i.dataId).values),a=n.data.get(r.dataId).values,u=Array.from(n.data.get(s.dataId).values),[l,c,f]=Jse(a,r.shape,r.dtype,o,u);return[n.makeTensorInfo(c,r.dtype,l),n.makeTensorInfo([f.length],s.dtype,new Int32Array(f))]}const qLe={kernelName:ST,backendName:"cpu",kernelFunc:HLe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function XLe(e){const{inputs:t,backend:n}=e,{data:r,indices:i,segmentIds:s}=t;if(r.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(i.shape.length!==1)throw new Error(`Indices should be a vector but received shape
          ${i.shape}`);if(s.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
          ${s.shape}`);if(i.shape[0]!==s.shape[0])throw new Error("segmentIds and indices should have same size.");const o=n.data.get(r.dataId).values,a=n.data.get(i.dataId).values,u=n.data.get(s.dataId).values,[l,c]=i6(o,r.shape,r.dtype,a,u,!0);return n.makeTensorInfo(c,r.dtype,l)}const YLe={kernelName:kT,backendName:"cpu",kernelFunc:XLe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function KLe(e){const{inputs:t,backend:n}=e,{data:r,indices:i,segmentIds:s}=t;if(r.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(i.shape.length!==1)throw new Error(`Indices should be a vector but received shape
         ${i.shape}`);if(s.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
         ${s.shape}`);if(i.shape[0]!==s.shape[0])throw new Error("segmentIds and indices should have same size.");const o=n.data.get(r.dataId).values,a=n.data.get(i.dataId).values,u=n.data.get(s.dataId).values,[l,c]=i6(o,r.shape,r.dtype,a,u);return n.makeTensorInfo(c,r.dtype,l)}const ZLe={kernelName:ET,backendName:"cpu",kernelFunc:KLe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function JLe(e){const{inputs:t,backend:n,attrs:r}=e,{sparseIndices:i,sparseValues:s,defaultValue:o}=t,{outputShape:a}=r,{sliceRank:u,numUpdates:l,sliceSize:c,strides:f,outputSize:h}=Th(s,i,a),d=!1,p=n.bufferSync(i);let g;switch(s.dtype){case"bool":{const m=n.bufferSync(s),y=!!n.data.get(o.dataId).values[0];g=Pd(p,m,a,h,c,l,u,f,y,d);break}case"float32":{const m=n.bufferSync(s),y=n.data.get(o.dataId).values[0];g=Pd(p,m,a,h,c,l,u,f,y,d);break}case"int32":{const m=n.bufferSync(s),y=n.data.get(o.dataId).values[0];g=Pd(p,m,a,h,c,l,u,f,y,d);break}case"string":{const m=n.bufferSync(s),y=oc(n.data.get(o.dataId).values[0]);g=Pd(p,m,a,h,c,l,u,f,y,d);break}default:throw new Error(`Unsupported type ${s.dtype}`)}return n.makeTensorInfo(a,g.dtype,g.values)}const QLe={kernelName:_T,backendName:"cpu",kernelFunc:JLe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ePe(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{numOrSizeSplits:s,axis:o}=r,a=st(o,i.shape)[0],u=A5(i,s,a),l=new Array(i.shape.length).fill(0),c=i.shape.slice();return u.map(f=>{const h=[...c];h[a]=f;const d=$p({inputs:{x:i},backend:n,attrs:{begin:l,size:h}});return l[a]+=f,d})}const tPe={kernelName:Cw,backendName:"cpu",kernelFunc:ePe};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nPe={kernelName:AT,backendName:"cpu",kernelFunc:({inputs:e,backend:t})=>{const{x:n}=e,r=t;Te(n,"square");const i=r.data.get(n.dataId).values,s=new Float32Array(i.length);for(let a=0;a<i.length;++a){const u=i[a];s[a]=u*u}return{dataId:r.write(s,n.shape,n.dtype),shape:n.shape,dtype:n.dtype}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const rPe=Ut(z1,(e,t)=>{const n=t;return isNaN(e)?NaN:e>0?1:n.alpha}),iPe={kernelName:z1,backendName:"cpu",kernelFunc:rPe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sPe(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{begin:s,end:o,strides:a,beginMask:u,endMask:l,ellipsisMask:c,newAxisMask:f,shrinkAxisMask:h}=r;Te(i,"stridedSlice");const{finalShapeSparse:d,finalShape:p,isIdentity:g,sliceDim0:m,isSimpleSlice:y,begin:b,end:v,strides:x}=l5(i.shape,s,o,a,u,l,c,f,h);let w;if(g)w=nn({inputs:{x:i},backend:n,attrs:{shape:p}});else if(m||y){N(i.shape.length>=1,()=>`Input must have rank at least 1, got: ${i.shape.length}`);const C=o5(b,v,x),$=$p({inputs:{x:i},backend:n,attrs:{begin:b,size:C}});w=nn({inputs:{x:$},backend:n,attrs:{shape:p}}),n.disposeIntermediateTensorInfo($)}else{const C=n.bufferSync(i),$=toe(d,C,x,b);w=n.makeTensorInfo(p,$.dtype,$.values)}return w}const oPe={kernelName:TT,backendName:"cpu",kernelFunc:sPe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function aPe(e){const{inputs:t,backend:n,attrs:r}=e,{separator:i,nGramWidths:s,leftPad:o,rightPad:a,padWidth:u,preserveShortSequences:l}=r,{data:c,dataSplits:f}=t,h=n.data.get(c.dataId).values,d=n.data.get(f.dataId).values,[p,g]=noe(h,d,i,s,o,a,u,l);return[n.makeTensorInfo([p.length],"string",p),n.makeTensorInfo(f.shape,"int32",g)]}const uPe={kernelName:IT,backendName:"cpu",kernelFunc:aPe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lPe(e){const{inputs:t,backend:n,attrs:r}=e,{skipEmpty:i}=r,{input:s,delimiter:o}=t;if(s.dtype!=="string")throw new Error("Input must be of datatype string");if(s.shape.length!==1)throw new Error(`Input must be a vector, got shape: ${s.shape}`);if(o.shape.length!==0)throw new Error(`Delimiter must be a scalar, got shape: ${o.shape}`);const a=n.data.get(s.dataId).values,u=n.data.get(o.dataId).values[0],[l,c,f]=roe(a,u,i),h=c.length;return[n.makeTensorInfo([h,2],"int32",l),n.makeTensorInfo([h],"string",c),n.makeTensorInfo([2],"int32",new Int32Array(f))]}const cPe={kernelName:DT,backendName:"cpu",kernelFunc:lPe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fPe(e){const{inputs:t,backend:n,attrs:r}=e,{numBuckets:i}=r,{input:s}=t;if(s.dtype!=="string")throw new Error("Input must be of datatype string");if(i<=0)throw new Error("Number of buckets must be at least 1");const o=n.data.get(s.dataId).values,a=ioe(o,i);return n.makeTensorInfo(s.shape,"int32",a)}const hPe={kernelName:NT,backendName:"cpu",kernelFunc:fPe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const dPe=Ut(L1,e=>Math.tan(e)),pPe={kernelName:L1,backendName:"cpu",kernelFunc:dPe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gPe=Ut(P1,e=>Math.tanh(e)),mPe={kernelName:P1,backendName:"cpu",kernelFunc:gPe};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yPe(e){const{inputs:t,backend:n}=e,{tensor:r,indices:i,updates:s}=t,{sliceRank:o,numUpdates:a,sliceSize:u,strides:l,outputSize:c}=Th(s,i,r.shape),f=!1,h=n.bufferSync(i),d=n.bufferSync(s),p=n.bufferSync(r),g=Pd(h,d,r.shape,c,u,a,o,l,p,f);return n.makeTensorInfo(r.shape,g.dtype,g.values)}const bPe={kernelName:wT,backendName:"cpu",kernelFunc:yPe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xPe(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{reps:s}=r;Te(i,"tile");const o=ooe(n.bufferSync(i),s);return n.makeTensorInfo(o.shape,o.dtype,o.values)}const vPe={kernelName:B1,backendName:"cpu",kernelFunc:xPe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wPe(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{k:s,sorted:o}=r;Te(i,"topk");const a=n.data.get(i.dataId).values,[u,l]=uoe(a,i.shape,i.dtype,s,o);return[n.makeTensorInfo(u.shape,u.dtype,u.values),n.makeTensorInfo(l.shape,l.dtype,l.values)]}const $Pe={kernelName:FT,backendName:"cpu",kernelFunc:wPe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function CPe(e){const{inputs:t,attrs:n,backend:r}=e,{image:i,transforms:s}=t,{interpolation:o,fillMode:a,fillValue:u,outputShape:l}=n,[c,f,h,d]=i.shape,[p,g]=l??[f,h],m=[c,p,g,d],y=Me(i.shape),b=y[0],v=y[1],x=y[2],w=Me(m),C=w[0],$=w[1],S=w[2],k=hr(i.dtype,te(m));k.fill(u);const E=r.data.get(i.dataId).values,_=r.data.get(s.dataId).values;for(let A=0;A<c;++A){const T=s.shape[0]===1?_:_.subarray(A*8,A*8+8);for(let I=0;I<p;++I)for(let F=0;F<g;++F)for(let R=0;R<d;++R){let L;const P=T[6]*F+T[7]*I+1;if(P===0)continue;const q=(T[0]*F+T[1]*I+T[2])/P,X=(T[3]*F+T[4]*I+T[5])/P,G=dG(q,h,a),J=dG(X,f,a);switch(o){case"nearest":L=TPe(E,f,h,b,v,x,A,J,G,R,u);break;case"bilinear":L=IPe(E,f,h,b,v,x,A,J,G,R,u);break;default:throw new Error(`Error in Transform: Expect 'nearest' or 'bilinear', but got ${o}`)}const Q=A*C+I*$+F*S+R;k[Q]=L}return r.makeTensorInfo(m,i.dtype,k)}return{dataId:r.write(k,m,i.dtype),shape:i.shape,dtype:i.dtype}}const SPe={kernelName:OT,backendName:"cpu",kernelFunc:CPe};function dG(e,t,n){switch(n){case"reflect":return kPe(e,t);case"wrap":return EPe(e,t);case"nearest":return APe(e,t);case"constant":default:return _Pe(e)}}function kPe(e,t){let n=e;if(n<0)if(t<=1)n=0;else{const r=2*t;n<r&&(n=r*Math.trunc(-n/r)+n),n=n<-t?n+r:-n-1}else if(n>t-1)if(t<=1)n=0;else{const r=2*t;n-=r*Math.trunc(n/r),n>=t&&(n=r-n-1)}return Ff(0,n,t-1)}function EPe(e,t){let n=e;if(n<0)if(t<=1)n=0;else{const r=t-1;n+=t*(Math.trunc(-n/r)+1)}else if(n>t-1)if(t<=1)n=0;else{const r=t-1;n-=t*Math.trunc(n/r)}return Ff(0,n,t-1)}function _Pe(e,t){return e}function APe(e,t){return Ff(0,e,t-1)}function Db(e,t,n,r,i,s,o,a,u,l,c){const f=o*r+a*i+u*s+l;return 0<=a&&a<t&&0<=u&&u<n?e[f]:c}function TPe(e,t,n,r,i,s,o,a,u,l,c){const f=Math.round(a),h=Math.round(u);return Db(e,t,n,r,i,s,o,f,h,l,c)}function IPe(e,t,n,r,i,s,o,a,u,l,c){const f=Math.floor(a),h=Math.floor(u),d=f+1,p=h+1,g=(p-u)*Db(e,t,n,r,i,s,o,f,h,l,c)+(u-h)*Db(e,t,n,r,i,s,o,f,p,l,c),m=(p-u)*Db(e,t,n,r,i,s,o,d,h,l,c)+(u-h)*Db(e,t,n,r,i,s,o,d,p,l,c);return(d-a)*g+(a-f)*m}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function DPe(e){const{inputs:t,attrs:n,backend:r}=e,{axis:i}=n,{x:s}=t;Te(s,"unique");const o=r.data.get(s.dataId).values,{outputValues:a,outputShape:u,indices:l}=loe(o,i,s.shape,s.dtype);return[r.makeTensorInfo(u,s.dtype,a),r.makeTensorInfo([l.length],"int32",l)]}const NPe={kernelName:RT,backendName:"cpu",kernelFunc:DPe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function FPe(e){const{inputs:t,backend:n,attrs:r}=e,{value:i}=t;let{axis:s}=r;s<0&&(s+=i.shape.length);const o=i.shape.length,a=i.shape[s],u=new Array(o-1);let l=0;for(let d=0;d<o;d++)d!==s&&(u[l++]=i.shape[d]);const c=new Array(o).fill(0),f=i.shape.slice();f[s]=1;const h=new Array(a);for(let d=0;d<h.length;d++){c[s]=d;const p=$p({inputs:{x:i},backend:n,attrs:{begin:c,size:f}});h[d]=nn({inputs:{x:p},backend:n,attrs:{shape:u}}),n.disposeIntermediateTensorInfo(p)}return h}const OPe={kernelName:Ew,backendName:"cpu",kernelFunc:FPe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function RPe(e){const{inputs:t,backend:n,attrs:r}=e,{x:i,segmentIds:s}=t,{numSegments:o}=r;Te(i,"unsortedSegmentSum");const a=i.shape.length,u=s.shape.length,l=[],c=[],f=a-u;let h=s;for(let p=0;p<f;++p){const g=Jk({inputs:{input:h},backend:n,attrs:{dim:p+1}});h=g,c.push(g)}for(let p=0;p<o;++p){const g=xc(p,"int32"),m=n.makeTensorInfo([],"int32",g),y=Sse({inputs:{a:m,b:h},backend:n}),b=Vf({inputs:{x:y},backend:n,attrs:{dtype:"float32"}}),v=TI({inputs:{a:b,b:i},backend:n}),x=Yw({inputs:{x:v},backend:n,attrs:{axis:0,keepDims:!1}});l.push(x),c.push(m),c.push(y),c.push(b),c.push(v),c.push(x)}const d=Soe({inputs:l,backend:n,attrs:{axis:0}});return c.forEach(p=>n.disposeIntermediateTensorInfo(p)),d}const MPe={kernelName:_w,backendName:"cpu",kernelFunc:RPe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const LPe=[DOe,f3e,FOe,ROe,y3e,LOe,BOe,UOe,WOe,GOe,qOe,YOe,ZOe,eRe,nRe,sRe,aRe,lRe,fRe,TOe,dRe,gRe,yRe,x3e,xRe,g3e,w3e,wRe,h3e,CRe,kRe,ERe,ARe,IRe,NRe,ORe,MRe,PRe,zRe,jRe,VRe,HRe,XRe,KRe,ZRe,QRe,tMe,rMe,iMe,sMe,oMe,uMe,fMe,$Oe,dMe,$3e,wMe,C3e,$Me,k3e,AMe,TMe,DMe,_3e,T3e,FMe,RMe,LMe,BMe,D3e,F3e,d3e,UMe,SRe,WMe,GMe,qMe,COe,R3e,L3e,YMe,B3e,ZMe,e4e,n4e,s4e,a4e,l4e,c4e,U3e,h4e,p4e,m4e,b4e,v4e,$4e,S4e,W3e,E4e,T4e,N4e,G3e,q3e,R4e,P4e,U4e,Y3e,W4e,G4e,H4e,koe,K4e,kOe,J3e,J4e,eLe,nLe,iLe,p3e,gM,oLe,EOe,_Oe,AOe,uLe,cLe,hLe,pLe,mLe,yLe,xLe,oOe,wLe,ELe,ALe,NLe,uOe,OLe,MLe,PLe,lOe,I4e,ULe,WLe,GLe,qLe,YLe,ZLe,QLe,tPe,hOe,nPe,pOe,mOe,iPe,oPe,uPe,cPe,hPe,vOe,lMe,pPe,mPe,bPe,vPe,$Pe,SPe,K3e,NPe,OPe,MPe,V4e];for(const e of LPe)LT(e);/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Sd={},DC={alpha:!1,antialias:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!1,depth:!1,stencil:!1,failIfMajorPerformanceCaveat:!0};function PPe(e,t){Sd[e]=t}function Fa(e,t){if(!(e in Sd)||t!=null){const r=zPe(e,t);if(r!==null)Sd[e]=r;else return console.log("Could not get context for WebGL version",e),null}const n=Sd[e];return n==null||n.isContextLost()?(delete Sd[e],Fa(e)):(n.disable(n.DEPTH_TEST),n.disable(n.STENCIL_TEST),n.disable(n.BLEND),n.disable(n.DITHER),n.disable(n.POLYGON_OFFSET_FILL),n.disable(n.SAMPLE_COVERAGE),n.enable(n.SCISSOR_TEST),n.enable(n.CULL_FACE),n.cullFace(n.BACK),Sd[e])}function BPe(e){if(!K().getBool("IS_SAFARI")&&typeof OffscreenCanvas<"u"&&e===2)return new OffscreenCanvas(300,150);if(typeof document<"u")return document.createElement("canvas");throw new Error("Cannot create a canvas in this context")}function zPe(e,t){if(e!==1&&e!==2)throw new Error("Cannot get WebGL rendering context, WebGL is disabled.");const n=t??BPe(e);return n.addEventListener("webglcontextlost",r=>{r.preventDefault(),delete Sd[e]},!1),K().getBool("SOFTWARE_WEBGL_ENABLED")&&(DC.failIfMajorPerformanceCaveat=!1),e===1?n.getContext("webgl",DC)||n.getContext("experimental-webgl",DC):n.getContext("webgl2",DC)}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var ev;(function(e){e[e.DENSE=0]="DENSE",e[e.SHARED_BATCH=1]="SHARED_BATCH"})(ev||(ev={}));var Ks;(function(e){e[e.RENDER=0]="RENDER",e[e.UPLOAD=1]="UPLOAD",e[e.PIXELS=2]="PIXELS",e[e.DOWNLOAD=3]="DOWNLOAD"})(Ks||(Ks={}));var wr;(function(e){e[e.UNPACKED_FLOAT16=0]="UNPACKED_FLOAT16",e[e.UNPACKED_FLOAT32=1]="UNPACKED_FLOAT32",e[e.PACKED_4X1_UNSIGNED_BYTE=2]="PACKED_4X1_UNSIGNED_BYTE",e[e.PACKED_2X2_FLOAT32=3]="PACKED_2X2_FLOAT32",e[e.PACKED_2X2_FLOAT16=4]="PACKED_2X2_FLOAT16"})(wr||(wr={}));function Kw(e,t){return[t,e]}function UPe(e,t){return e*t}function NC(e){const t=te(e),n=Math.ceil(t/4);return Ak(n)}function H1(e,t){return[Math.max(1,Math.ceil(t/2)),Math.max(1,Math.ceil(e/2))]}function jPe(e,t){const[n,r]=H1(e,t);return n*r*4}function l6(e,t){const n=e;let r,i,s,o,a,u,l,c,f,h;return K().getNumber("WEBGL_VERSION")===2?(r=n.R32F,i=n.R16F,s=n.RGBA16F,o=n.RGBA32F,a=n.RED,l=4,c=1,f=n.HALF_FLOAT,h=n.FLOAT,u=n.RGBA8):(r=e.RGBA,i=e.RGBA,s=e.RGBA,o=n.RGBA,a=e.RGBA,l=4,c=4,f=t!=null?t.HALF_FLOAT_OES:null,h=e.FLOAT,u=e.RGBA),{internalFormatFloat:r,internalFormatHalfFloat:i,internalFormatPackedHalfFloat:s,internalFormatPackedFloat:o,textureFormatFloat:a,downloadTextureFormat:u,downloadUnpackNumChannels:l,defaultNumChannels:c,textureTypeHalfFloat:f,textureTypeFloat:h}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ee(e,t){const n=t();return K().getBool("DEBUG")&&WPe(e),n}function WPe(e){const t=e.getError();if(t!==e.NO_ERROR)throw new Error("WebGL Error: "+qPe(e,t))}const VPe=596e-10,GPe=65504;function HPe(e){return!!(K().getBool("WEBGL_RENDER_FLOAT32_ENABLED")||e===0||VPe<Math.abs(e)&&Math.abs(e)<GPe)}function qPe(e,t){switch(t){case e.NO_ERROR:return"NO_ERROR";case e.INVALID_ENUM:return"INVALID_ENUM";case e.INVALID_VALUE:return"INVALID_VALUE";case e.INVALID_OPERATION:return"INVALID_OPERATION";case e.INVALID_FRAMEBUFFER_OPERATION:return"INVALID_FRAMEBUFFER_OPERATION";case e.OUT_OF_MEMORY:return"OUT_OF_MEMORY";case e.CONTEXT_LOST_WEBGL:return"CONTEXT_LOST_WEBGL";default:return`Unknown error code ${t}`}}function FC(e,t){return kc(e,()=>e.getExtension(t),'Extension "'+t+'" not supported on this browser.')}function XPe(e,t){const n=kc(e,()=>e.createShader(e.VERTEX_SHADER),"Unable to create vertex WebGLShader.");if(Ee(e,()=>e.shaderSource(n,t)),Ee(e,()=>e.compileShader(n)),e.getShaderParameter(n,e.COMPILE_STATUS)===!1)throw console.log(e.getShaderInfoLog(n)),new Error("Failed to compile vertex shader.");return n}function YPe(e,t){const n=kc(e,()=>e.createShader(e.FRAGMENT_SHADER),"Unable to create fragment WebGLShader.");if(Ee(e,()=>e.shaderSource(n,t)),Ee(e,()=>e.compileShader(n)),K().get("ENGINE_COMPILE_ONLY"))return n;if(e.getShaderParameter(n,e.COMPILE_STATUS)===!1)throw Eoe(t,e.getShaderInfoLog(n)),new Error("Failed to compile fragment shader.");return n}const KPe=/ERROR: [0-9]+:([0-9]+):/g;function Eoe(e,t){const n=KPe.exec(t);if(n==null){console.log(`Couldn't parse line number in error: ${t}`),console.log(e);return}const r=+n[1],i=e.split(`
`),s=i.length.toString().length+2,o=i.map((f,h)=>Yd((h+1).toString(),s)+f);let a=0;for(let f=0;f<o.length;f++)a=Math.max(o[f].length,a);const u=o.slice(0,r-1),l=o.slice(r-1,r),c=o.slice(r);console.log(u.join(`
`)),console.log(t.split(`
`)[0]),console.log(`%c ${Yd(l[0],a)}`,"border:1px solid red; background-color:#e3d2d2; color:#a61717"),console.log(c.join(`
`))}function ZPe(e){return kc(e,()=>e.createProgram(),"Unable to create WebGLProgram.")}function JPe(e,t){if(Ee(e,()=>e.linkProgram(t)),!K().get("ENGINE_COMPILE_ONLY")&&e.getProgramParameter(t,e.LINK_STATUS)===!1)throw console.log(e.getProgramInfoLog(t)),new Error("Failed to link vertex and fragment shaders.")}function c3(e,t){if(Ee(e,()=>e.validateProgram(t)),e.getProgramParameter(t,e.VALIDATE_STATUS)===!1)throw console.log(e.getProgramInfoLog(t)),new Error("Shader program validation failed.")}function QPe(e,t){const n=kc(e,()=>e.createBuffer(),"Unable to create WebGLBuffer");return Ee(e,()=>e.bindBuffer(e.ARRAY_BUFFER,n)),Ee(e,()=>e.bufferData(e.ARRAY_BUFFER,t,e.STATIC_DRAW)),n}function eBe(e,t){const n=kc(e,()=>e.createBuffer(),"Unable to create WebGLBuffer");return Ee(e,()=>e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,n)),Ee(e,()=>e.bufferData(e.ELEMENT_ARRAY_BUFFER,t,e.STATIC_DRAW)),n}function tBe(e){return kc(e,()=>e.createTexture(),"Unable to create WebGLTexture.")}function nBe(e,t){const n=K().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(e<=0||t<=0){const r=`[${e}x${t}]`;throw new Error("Requested texture size "+r+" is invalid.")}if(e>n||t>n){const r=`[${e}x${t}]`,i=`[${n}x${n}]`;throw new Error("Requested texture size "+r+" greater than WebGL maximum on this browser / GPU "+i+".")}}function rBe(e){return kc(e,()=>e.createFramebuffer(),"Unable to create WebGLFramebuffer.")}function pG(e,t,n,r,i,s,o){const a=e.getAttribLocation(t,n);return a===-1?!1:(Ee(e,()=>e.bindBuffer(e.ARRAY_BUFFER,r)),Ee(e,()=>e.vertexAttribPointer(a,i,e.FLOAT,!1,s,o)),Ee(e,()=>e.enableVertexAttribArray(a)),!0)}function iBe(e,t,n){lBe(e,n),Ee(e,()=>e.activeTexture(e.TEXTURE0+n)),Ee(e,()=>e.bindTexture(e.TEXTURE_2D,t))}function sBe(e,t,n){return kc(e,()=>e.getUniformLocation(t,n),'uniform "'+n+'" not present in program.')}function oBe(e,t,n){return e.getUniformLocation(t,n)}function aBe(e,t,n,r){Ee(e,()=>iBe(e,t,r)),Ee(e,()=>e.uniform1i(n,r))}function f3(e,t,n){Ee(e,()=>e.bindFramebuffer(e.FRAMEBUFFER,n)),Ee(e,()=>e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,t,0))}function gG(e,t){Ee(e,()=>e.bindFramebuffer(e.FRAMEBUFFER,t)),Ee(e,()=>e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,null,0))}function OC(e){const t=e.checkFramebufferStatus(e.FRAMEBUFFER);if(t!==e.FRAMEBUFFER_COMPLETE)throw new Error("Error binding framebuffer: "+uBe(e,t))}function uBe(e,t){switch(t){case e.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_ATTACHMENT";case e.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT";case e.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return"FRAMEBUFFER_INCOMPLETE_DIMENSIONS";case e.FRAMEBUFFER_UNSUPPORTED:return"FRAMEBUFFER_UNSUPPORTED";default:return`unknown error ${t}`}}function kc(e,t,n){const r=Ee(e,()=>t());if(r==null)throw new Error(n);return r}function lBe(e,t){const n=e.MAX_COMBINED_TEXTURE_IMAGE_UNITS-1,r=t+e.TEXTURE0;if(r<e.TEXTURE0||r>n){const i=`[gl.TEXTURE0, gl.TEXTURE${n}]`;throw new Error(`textureUnit must be in ${i}.`)}}function e0(e,t=2){return te(e.slice(0,e.length-t))}function t0(e){if(e.length===0)throw Error("Cannot get rows and columns of an empty shape array.");return[e.length>1?e[e.length-2]:1,e[e.length-1]]}function RC(e){let t=[1,1,1];return e.length===0||e.length===1&&e[0]===1||(t=[e0(e),...t0(e)]),t}function cBe(e,t=!1){let n=K().getNumber("WEBGL_MAX_TEXTURE_SIZE"),r=K().getNumber("WEBGL_MAX_SIZE_FOR_NARROW_TEXTURE");r===1/0&&K().getBool("WEBGL_AUTO_SQUARIFY_NARROW_TEXTURE_SHAPE")&&(r=n/2),t&&(n=n*2,r=r*2,e=e.map((a,u)=>u>=e.length-2?TA(e[u]):e[u]),e.length===1&&(e=[2,e[0]])),e.length!==2&&(e=bc(e).newShape);let i=te(e),s=null;e.length<=1&&i<=n?s=[1,i]:e.length===2&&e[0]<=n&&e[1]<=n?s=e:e.length===3&&e[0]*e[1]<=n&&e[2]<=n?s=[e[0]*e[1],e[2]]:e.length===3&&e[0]<=n&&e[1]*e[2]<=n?s=[e[0],e[1]*e[2]]:e.length===4&&e[0]*e[1]*e[2]<=n&&e[3]<=n?s=[e[0]*e[1]*e[2],e[3]]:e.length===4&&e[0]<=n&&e[1]*e[2]*e[3]<=n&&(s=[e[0],e[1]*e[2]*e[3]]);const o=s!=null&&Math.max(...s)>r&&Math.min(...s)<=(t?2:1)&&Math.min(...s)>0;if(s==null||o)if(t){const a=e0(e);let u=2,l=2;e.length&&([u,l]=t0(e)),i=a*(u/2)*(l/2),s=Ak(i).map(c=>c*2)}else s=Ak(i);return s}function MC(e){return e%2===0}function eE(e,t){if(e=e.slice(-2),t=t.slice(-2),bt(e,t)||!e.length||!t.length||e[0]===0||e[1]===0||t[0]===0||t[1]===0)return!0;if(e.length!==t.length){const n=e[e.length-1],r=t[t.length-1];if(n===r||MC(n)&&MC(r)&&(e[0]===1||t[0]===1))return!0}return e[1]===t[1]&&MC(e[0])&&MC(t[0])}let h3,d3;function fBe(e){if(h3==null){const t=Fa(e);h3=t.getParameter(t.MAX_TEXTURE_SIZE)}return h3}function hBe(e){if(d3==null){const t=Fa(e);d3=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS)}return Math.min(16,d3)}function dBe(e){if(e===0)return 0;let t;const n=Fa(e);return Eo(n,"EXT_disjoint_timer_query_webgl2")&&e===2?t=2:Eo(n,"EXT_disjoint_timer_query")?t=1:t=0,t}function Eo(e,t){return e.getExtension(t)!=null}function mG(e){try{if(Fa(e)!=null)return!0}catch(t){return console.log("Error when getting WebGL context: ",t),!1}return!1}function pBe(e){if(e===0)return!1;const t=Fa(e);if(e===1){if(!Eo(t,"OES_texture_float"))return!1}else if(!Eo(t,"EXT_color_buffer_float"))return!1;return yM(t)}function gBe(e){if(e===0)return!1;const t=Fa(e);if(e===1){if(!Eo(t,"OES_texture_float")||!Eo(t,"WEBGL_color_buffer_float"))return!1}else{if(Eo(t,"EXT_color_buffer_float"))return yM(t);const r="EXT_color_buffer_half_float";if(Eo(t,r)){const i=t.getExtension(r);return mBe(t,i)}return!1}return yM(t)}function yM(e){const t=l6(e),n=e.createTexture();e.bindTexture(e.TEXTURE_2D,n);const r=1,i=1;e.texImage2D(e.TEXTURE_2D,0,t.internalFormatFloat,r,i,0,t.textureFormatFloat,t.textureTypeFloat,null);const s=e.createFramebuffer();e.bindFramebuffer(e.FRAMEBUFFER,s),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,n,0);const o=e.checkFramebufferStatus(e.FRAMEBUFFER)===e.FRAMEBUFFER_COMPLETE;return e.bindTexture(e.TEXTURE_2D,null),e.bindFramebuffer(e.FRAMEBUFFER,null),e.deleteTexture(n),e.deleteFramebuffer(s),o}function mBe(e,t){const n=l6(e,t),r=e.createTexture();e.bindTexture(e.TEXTURE_2D,r);const i=1,s=1;e.texImage2D(e.TEXTURE_2D,0,n.internalFormatHalfFloat,i,s,0,n.textureFormatFloat,n.textureTypeHalfFloat,null);const o=e.createFramebuffer();e.bindFramebuffer(e.FRAMEBUFFER,o),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,r,0);const a=e.checkFramebufferStatus(e.FRAMEBUFFER)===e.FRAMEBUFFER_COMPLETE;return e.bindTexture(e.TEXTURE_2D,null),e.bindFramebuffer(e.FRAMEBUFFER,null),e.deleteTexture(r),e.deleteFramebuffer(o),a}function yBe(e){return e!==2?!1:Fa(e).fenceSync!=null}function Zw(e,t){Array.isArray(e)||(e=[e]),e.forEach(n=>{n!=null&&N(n.dtype!=="complex64",()=>`${t} does not support complex64 tensors in the WebGL backend.`)})}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Fe=K();Fe.registerFlag("HAS_WEBGL",()=>Fe.getNumber("WEBGL_VERSION")>0);Fe.registerFlag("WEBGL_VERSION",()=>mG(2)?2:mG(1)?1:0);Fe.registerFlag("WEBGL_CHECK_NUMERICAL_PROBLEMS",()=>!1);Fe.registerFlag("WEBGL_BUFFER_SUPPORTED",()=>Fe.get("WEBGL_VERSION")===2);Fe.registerFlag("WEBGL_CPU_FORWARD",()=>!0);Fe.registerFlag("WEBGL_FORCE_F16_TEXTURES",()=>!1);Fe.registerFlag("WEBGL_PACK",()=>Fe.getBool("HAS_WEBGL"));Fe.registerFlag("WEBGL_PACK_NORMALIZATION",()=>Fe.getBool("WEBGL_PACK"));Fe.registerFlag("WEBGL_PACK_CLIP",()=>Fe.getBool("WEBGL_PACK"));Fe.registerFlag("WEBGL_PACK_DEPTHWISECONV",()=>Fe.getBool("WEBGL_PACK"));Fe.registerFlag("WEBGL_PACK_BINARY_OPERATIONS",()=>Fe.getBool("WEBGL_PACK"));Fe.registerFlag("WEBGL_PACK_UNARY_OPERATIONS",()=>Fe.getBool("WEBGL_PACK"));Fe.registerFlag("WEBGL_PACK_ARRAY_OPERATIONS",()=>Fe.getBool("WEBGL_PACK"));Fe.registerFlag("WEBGL_PACK_IMAGE_OPERATIONS",()=>Fe.getBool("WEBGL_PACK"));Fe.registerFlag("WEBGL_PACK_REDUCE",()=>Fe.getBool("WEBGL_PACK"));Fe.registerFlag("WEBGL_LAZILY_UNPACK",()=>Fe.getBool("WEBGL_PACK"));Fe.registerFlag("WEBGL_CONV_IM2COL",()=>Fe.getBool("WEBGL_PACK"));Fe.registerFlag("WEBGL_MAX_TEXTURE_SIZE",()=>fBe(Fe.getNumber("WEBGL_VERSION")));Fe.registerFlag("WEBGL_MAX_TEXTURES_IN_SHADER",()=>hBe(Fe.getNumber("WEBGL_VERSION")));Fe.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION",()=>{const e=Fe.getNumber("WEBGL_VERSION");return e===0?0:dBe(e)});Fe.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE",()=>Fe.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0&&!oB());Fe.registerFlag("WEBGL_RENDER_FLOAT32_CAPABLE",()=>pBe(Fe.getNumber("WEBGL_VERSION")));Fe.registerFlag("WEBGL_RENDER_FLOAT32_ENABLED",()=>Fe.getBool("WEBGL_FORCE_F16_TEXTURES")?!1:Fe.getBool("WEBGL_RENDER_FLOAT32_CAPABLE"));Fe.registerFlag("WEBGL_DOWNLOAD_FLOAT_ENABLED",()=>gBe(Fe.getNumber("WEBGL_VERSION")));Fe.registerFlag("WEBGL_FENCE_API_ENABLED",()=>yBe(Fe.getNumber("WEBGL_VERSION")));Fe.registerFlag("WEBGL_SIZE_UPLOAD_UNIFORM",()=>Fe.getBool("WEBGL_RENDER_FLOAT32_ENABLED")?4:0);Fe.registerFlag("WEBGL_DELETE_TEXTURE_THRESHOLD",()=>-1,e=>{if(typeof e!="number")throw new Error(`WEBGL_DELETE_TEXTURE_THRESHOLD must be a number but got ${e}.`);if(e<0&&e!==-1)throw new Error(`WEBGL_DELETE_TEXTURE_THRESHOLD must be -1 (indicating never delete) or at least 0, but got ${e}.`)});Fe.registerFlag("WEBGL_FLUSH_THRESHOLD",()=>oB()?1:-1,e=>{if(typeof e!="number")throw new Error(`WEBGL_FLUSH_THRESHOLD must be a number but got ${e}.`);if(e<0&&e!==-1)throw new Error(`WEBGL_FLUSH_THRESHOLD must be -1 (indicating never manual flush) or at least 0, but got ${e}.`)});Fe.registerFlag("CPU_HANDOFF_SIZE_THRESHOLD",()=>128);Fe.registerFlag("WEBGL_USE_SHAPES_UNIFORMS",()=>!1);Fe.registerFlag("TOPK_LAST_DIM_CPU_HANDOFF_SIZE_THRESHOLD",()=>1e5);Fe.registerFlag("TOPK_K_CPU_HANDOFF_THRESHOLD",()=>128);Fe.registerFlag("WEBGL_EXP_CONV",()=>!1);Fe.registerFlag("SOFTWARE_WEBGL_ENABLED",()=>Fe.getBool("IS_TEST"));Fe.registerFlag("WEBGL_MAX_SIZE_FOR_NARROW_TEXTURE",()=>1/0);Fe.registerFlag("WEBGL_AUTO_SQUARIFY_NARROW_TEXTURE_SHAPE",()=>!1);Fe.registerFlag("WEBGL2_ISNAN_CUSTOM",()=>!1);Fe.registerFlag("ENGINE_COMPILE_ONLY",()=>!1);/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ni(){let e,t,n,r,i,s,o,a,u,l;return K().getNumber("WEBGL_VERSION")===2?(e="#version 300 es",t="in",n="out",r="in",i="texture",s="outputColor",o="out vec4 outputColor;",a=K().getBool("WEBGL2_ISNAN_CUSTOM")?`
      bool isnan_custom(float val) {
        uint floatToUint = floatBitsToUint(val);
        return (floatToUint & 0x7fffffffu) > 0x7f800000u;
      }

      bvec4 isnan_custom(vec4 val) {
        return bvec4(isnan_custom(val.x),
          isnan_custom(val.y), isnan_custom(val.z), isnan_custom(val.w));
      }

      #define isnan(value) isnan_custom(value)
    `:"",u="",l=`
      #define round(value) newRound(value)
      int newRound(float value) {
        return int(floor(value + 0.5));
      }

      ivec4 newRound(vec4 value) {
        return ivec4(floor(value + vec4(0.5)));
      }
    `):(e="",t="attribute",n="varying",r="varying",i="texture2D",s="gl_FragColor",o="",a=`
      #define isnan(value) isnan_custom(value)
      bool isnan_custom(float val) {
        return (val > 0. || val < 1. || val == 0.) ? false : true;
      }
      bvec4 isnan_custom(vec4 val) {
        return bvec4(isnan(val.x), isnan(val.y), isnan(val.z), isnan(val.w));
      }
    `,u=`
      uniform float INFINITY;

      bool isinf(float val) {
        return abs(val) == INFINITY;
      }
      bvec4 isinf(vec4 val) {
        return equal(abs(val), vec4(INFINITY));
      }
    `,l=`
      int round(float value) {
        return int(floor(value + 0.5));
      }

      ivec4 round(vec4 value) {
        return ivec4(floor(value + vec4(0.5)));
      }
    `),{version:e,attribute:t,varyingVs:n,varyingFs:r,texture2D:i,output:s,defineOutput:o,defineSpecialNaN:a,defineSpecialInf:u,defineRound:l}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hg(e,t,n="index"){const r=Me(t);return r.map((i,s)=>{const o=`int ${e[s]} = ${n} / ${i}`,a=s===r.length-1?`int ${e[s+1]} = ${n} - ${e[s]} * ${i}`:`index -= ${e[s]} * ${i}`;return`${o}; ${a};`}).join("")}function II(e,t,n="index"){const r=Me(t);return r.map((i,s)=>{const o=`int ${e[s]} = ${n} / outShapeStrides[${s}]`,a=s===r.length-1?`int ${e[s+1]} = ${n} - ${e[s]} * outShapeStrides[${s}]`:`index -= ${e[s]} * outShapeStrides[${s}]`;return`${o}; ${a};`}).join("")}function bBe(e,t){const n=e.length,r=e.map(s=>`${t}[${s}]`),i=new Array(n-1);i[n-2]=r[n-1];for(let s=n-3;s>=0;--s)i[s]=`(${i[s+1]} * ${r[s+1]})`;return i}function xBe(e,t,n="index"){const r=e.map((s,o)=>o),i=bBe(r,t);return i.map((s,o)=>{const a=`int ${e[o]} = ${n} / ${i[o]}`,u=o===i.length-1?`int ${e[o+1]} = ${n} - ${e[o]} * ${i[o]}`:`index -= ${e[o]} * ${i[o]}`;return`${a}; ${u};`}).join("")}function c6(e){const t=Me(e).map(n=>n.toString());return`
  int getFlatIndex(ivec3 coords) {
    return coords.x * ${t[0]} + coords.y * ${t[1]} + coords.z;
  }
`}function f6(){return`
  int getFlatIndex(ivec3 coords) {
    return coords.x * outShapeStrides[0] + coords.y * outShapeStrides[1] + coords.z;
  }
`}const _oe=`
  const float FLOAT_MAX = 1.70141184e38;
  const float FLOAT_MIN = 1.17549435e-38;

  lowp vec4 encode_float(highp float v) {
    if (isnan(v)) {
      return vec4(255, 255, 255, 255);
    }

    highp float av = abs(v);

    if(av < FLOAT_MIN) {
      return vec4(0.0, 0.0, 0.0, 0.0);
    } else if(v > FLOAT_MAX) {
      return vec4(0.0, 0.0, 128.0, 127.0) / 255.0;
    } else if(v < -FLOAT_MAX) {
      return vec4(0.0, 0.0,  128.0, 255.0) / 255.0;
    }

    highp vec4 c = vec4(0,0,0,0);

    highp float e = floor(log2(av));
    highp float m = exp2(fract(log2(av))) - 1.0;

    c[2] = floor(128.0 * m);
    m -= c[2] / 128.0;
    c[1] = floor(32768.0 * m);
    m -= c[1] / 32768.0;
    c[0] = floor(8388608.0 * m);

    highp float ebias = e + 127.0;
    c[3] = floor(ebias / 2.0);
    ebias -= c[3] * 2.0;
    c[2] += floor(ebias) * 128.0;

    c[3] += 128.0 * step(0.0, -v);

    return c / 255.0;
  }
`;/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const{getBroadcastDims:Aoe}=tre;function vBe(e,t,n){const r=[];if(e.forEach(d=>{const p=te(d.shapeInfo.logicalShape);if(d.shapeInfo.isUniform?r.push(`uniform float ${d.name}${p>1?`[${p}]`:""};`):(r.push(`uniform sampler2D ${d.name};`),r.push(`uniform int offset${d.name};`)),n.enableShapeUniforms){const{uniformShape:g}=h6(n.packedInputs,d.shapeInfo.logicalShape,d.shapeInfo.texShape);switch(g.length){case 1:r.push(`uniform int ${d.name}Shape;`);break;case 2:r.push(`uniform ivec2 ${d.name}Shape;`);break;case 3:r.push(`uniform ivec3 ${d.name}Shape;`);break;case 4:r.push(`uniform ivec4 ${d.name}Shape;`);break}r.push(`uniform ivec2 ${d.name}TexShape;`)}}),n.enableShapeUniforms){switch(t.logicalShape.length){case 1:r.push("uniform int outShape;");break;case 2:r.push("uniform ivec2 outShape;"),r.push("uniform int outShapeStrides;");break;case 3:r.push("uniform ivec3 outShape;"),r.push("uniform ivec2 outShapeStrides;");break;case 4:r.push("uniform ivec4 outShape;"),r.push("uniform ivec3 outShapeStrides;");break}r.push("uniform ivec2 outTexShape;")}n.customUniforms&&n.customUniforms.forEach(d=>{r.push(`uniform ${d.type} ${d.name}${d.arrayIndex?`[${d.arrayIndex}]`:""};`)});const i=r.join(`
`),s=e.map(d=>wBe(d,t,n.packedInputs,n.enableShapeUniforms)).join(`
`),o=t.texShape,a=Ni(),u=SBe(a);let l,c,f=_Be(a);return t.isPacked?(l=$Be(t.logicalShape,o,n.enableShapeUniforms),c=EBe(a)):(l=CBe(t.logicalShape,o,n.enableShapeUniforms),c=kBe(a)),n.packedInputs&&(f+=DBe),[f,u,c,i,l,s,n.userCode].join(`
`)}function q1(e,t=!1){const n=e.shapeInfo.logicalShape;switch(n.length){case 0:return WBe(e,t);case 1:return GBe(e,t);case 2:return qBe(e,t);case 3:return YBe(e,t);case 4:return ZBe(e,t);case 5:return JBe(e);case 6:return QBe(e);default:throw new Error(`${n.length}-D input sampling is not yet supported`)}}function Toe(e,t){switch(e.shapeInfo.logicalShape.length){case 0:return jBe(e);case 1:return VBe(e,t);case 2:return HBe(e,t);case 3:return XBe(e,t);default:return KBe(e,t)}}function wBe(e,t,n=!1,r){let i="";n?i+=Toe(e,r):i+=q1(e,r);const s=e.shapeInfo.logicalShape,o=t.logicalShape;return s.length<=o.length&&(n?i+=e5e(e,t):i+=t5e(e,t)),i}function $Be(e,t,n){switch(e.length){case 0:return Ioe();case 1:return NBe(e,t,n);case 2:return zBe(e,t,n);case 3:return OBe(e,t,n);default:return MBe(e,t,n)}}function CBe(e,t,n){switch(e.length){case 0:return Ioe();case 1:return FBe(e,t,n);case 2:return UBe(e,t,n);case 3:return RBe(e,t,n);case 4:return LBe(e,t,n);case 5:return PBe(e,t);case 6:return BBe(e,t);default:throw new Error(`${e.length}-D output sampling is not yet supported`)}}function SBe(e){return`
    float sampleTexture(sampler2D textureSampler, vec2 uv) {
      return ${e.texture2D}(textureSampler, uv).r;
    }
  `}function kBe(e){return`
    void setOutput(float val) {
      ${e.output} = vec4(val, 0, 0, 0);
    }
  `}function EBe(e){return`
    void setOutput(vec4 val) {
      ${e.output} = val;
    }
  `}function _Be(e){return`${e.version}
    precision highp float;
    precision highp int;
    precision highp sampler2D;
    ${e.varyingFs} vec2 resultUV;
    ${e.defineOutput}
    const vec2 halfCR = vec2(0.5, 0.5);

    struct ivec5
    {
      int x;
      int y;
      int z;
      int w;
      int u;
    };

    struct ivec6
    {
      int x;
      int y;
      int z;
      int w;
      int u;
      int v;
    };

    uniform float NAN;
    ${e.defineSpecialNaN}
    ${e.defineSpecialInf}
    ${e.defineRound}

    int imod(int x, int y) {
      return x - y * (x / y);
    }

    int idiv(int a, int b, float sign) {
      int res = a / b;
      int mod = imod(a, b);
      if (sign < 0. && mod != 0) {
        res -= 1;
      }
      return res;
    }

    //Based on the work of Dave Hoskins
    //https://www.shadertoy.com/view/4djSRW
    #define HASHSCALE1 443.8975
    float random(float seed){
      vec2 p = resultUV * seed;
      vec3 p3  = fract(vec3(p.xyx) * HASHSCALE1);
      p3 += dot(p3, p3.yzx + 19.19);
      return fract((p3.x + p3.y) * p3.z);
    }

    ${ABe}
    ${TBe}
    ${IBe}
  `}const ABe=`
vec2 uvFromFlat(int texNumR, int texNumC, int index) {
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
vec2 packedUVfrom1D(int texNumR, int texNumC, int index) {
  int texelIndex = index / 2;
  int texR = texelIndex / texNumC;
  int texC = texelIndex - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,TBe=`
vec2 packedUVfrom2D(int texelsInLogicalRow, int texNumR,
  int texNumC, int row, int col) {
  int texelIndex = (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = texelIndex / texNumC;
  int texC = texelIndex - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,IBe=`
vec2 packedUVfrom3D(int texNumR, int texNumC,
    int texelsInBatch, int texelsInLogicalRow, int b,
    int row, int col) {
  int index = b * texelsInBatch + (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,DBe=`
  float getChannel(vec4 frag, vec2 innerDims) {
    vec2 modCoord = mod(innerDims, 2.);
    return modCoord.x == 0. ?
      (modCoord.y == 0. ? frag.r : frag.g) :
      (modCoord.y == 0. ? frag.b : frag.a);
  }
  float getChannel(vec4 frag, int dim) {
    float modCoord = mod(float(dim), 2.);
    return modCoord == 0. ? frag.r : frag.g;
  }
`;function Ioe(){return`
    int getOutputCoords() {
      return 0;
    }
  `}function NBe(e,t,n){const r=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)];return r[0]===1?n?`
      int getOutputCoords() {
        return 2 * int(resultUV.x * ceil(float(outTexShape[1]) / 2.0));
      }
    `:`
      int getOutputCoords() {
        return 2 * int(resultUV.x * ${r[1]}.0);
      }
    `:r[1]===1?n?`
      int getOutputCoords() {
        return 2 * int(resultUV.y * ceil(float(outTexShape[0]) / 2.0));
      }
    `:`
      int getOutputCoords() {
        return 2 * int(resultUV.y * ${r[0]}.0);
      }
    `:n?`
    int getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));
      return 2 * (resTexRC.x * packedTexShape[1] + resTexRC.y);
    }
  `:`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${r[0]}, ${r[1]}));
      return 2 * (resTexRC.x * ${r[1]} + resTexRC.y);
    }
  `}function FBe(e,t,n){return t[0]===1?n?`
      int getOutputCoords() {
        return int(resultUV.x * float(outTexShape[1]));
      }
    `:`
      int getOutputCoords() {
        return int(resultUV.x * ${t[1]}.0);
      }
    `:t[1]===1?n?`
      int getOutputCoords() {
        return int(resultUV.y * float(outTexShape[0]));
      }
    `:`
      int getOutputCoords() {
        return int(resultUV.y * ${t[0]}.0);
      }
    `:n?`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(outTexShape[0], outTexShape[1]));
      return resTexRC.x * outTexShape[1] + resTexRC.y;
    }
  `:`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${t[0]}, ${t[1]}));
      return resTexRC.x * ${t[1]} + resTexRC.y;
    }
  `}function OBe(e,t,n){if(n)return`
    ivec3 getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      int texelsInLogicalRow = int(ceil(float(outShape[2]) / 2.0));
      int texelsInBatch = texelsInLogicalRow * int(ceil(float(outShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));
      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;

      int b = index / texelsInBatch;
      index -= b * texelsInBatch;

      int r = 2 * (index / texelsInLogicalRow);
      int c = imod(index, texelsInLogicalRow) * 2;

      return ivec3(b, r, c);
    }
  `;const r=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)],i=Math.ceil(e[2]/2),s=i*Math.ceil(e[1]/2);return`
    ivec3 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${r[0]}, ${r[1]}));
      int index = resTexRC.x * ${r[1]} + resTexRC.y;

      int b = index / ${s};
      index -= b * ${s};

      int r = 2 * (index / ${i});
      int c = imod(index, ${i}) * 2;

      return ivec3(b, r, c);
    }
  `}function RBe(e,t,n){if(n)return`
  ivec3 getOutputCoords() {
    ivec2 resTexRC = ivec2(resultUV.yx *
                           vec2(outTexShape[0], outTexShape[1]));
    int index = resTexRC.x * outTexShape[1] + resTexRC.y;
    ${II(["r","c","d"],e)}
    return ivec3(r, c, d);
  }
`;const r=hg(["r","c","d"],e);return`
    ivec3 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${t[0]}, ${t[1]}));
      int index = resTexRC.x * ${t[1]} + resTexRC.y;
      ${r}
      return ivec3(r, c, d);
    }
  `}function MBe(e,t,n){if(n)return`
    ivec4 getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));
      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;

      int texelsInLogicalRow = int(ceil(float(outShape[3]) / 2.0));
      int texelsInBatch = texelsInLogicalRow * int(ceil(float(outShape[2]) / 2.0));
      int texelsInBatchN = texelsInBatch * outShape[1];

      int b2 = index / texelsInBatchN;
      index -= b2 * texelsInBatchN;

      int b = index / texelsInBatch;
      index -= b * texelsInBatch;

      int r = 2 * (index / texelsInLogicalRow);
      int c = imod(index, texelsInLogicalRow) * 2;

      return ivec4(b2, b, r, c);
    }
  `;const r=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)],i=Math.ceil(e[e.length-1]/2),s=i*Math.ceil(e[e.length-2]/2);let o=s,a="",u="b, r, c";for(let l=2;l<e.length-1;l++)o*=e[e.length-l-1],a=`
      int b${l} = index / ${o};
      index -= b${l} * ${o};
    `+a,u=`b${l}, `+u;return`
    ivec${e.length} getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${r[0]}, ${r[1]}));
      int index = resTexRC.x * ${r[1]} + resTexRC.y;

      ${a}

      int b = index / ${s};
      index -= b * ${s};

      int r = 2 * (index / ${i});
      int c = imod(index, ${i}) * 2;

      return ivec${e.length}(${u});
    }
  `}function LBe(e,t,n){if(n)return`
    ivec4 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(outTexShape[0], outTexShape[1]));
      int index = resTexRC.x * outTexShape[1] + resTexRC.y;
      ${II(["r","c","d","d2"],e)}
      return ivec4(r, c, d, d2);
    }
  `;const r=hg(["r","c","d","d2"],e);return`
    ivec4 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(${t[0]}, ${t[1]}));
      int index = resTexRC.x * ${t[1]} + resTexRC.y;
      ${r}
      return ivec4(r, c, d, d2);
    }
  `}function PBe(e,t){const n=hg(["r","c","d","d2","d3"],e);return`
    ivec5 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx * vec2(${t[0]},
                             ${t[1]}));

      int index = resTexRC.x * ${t[1]} + resTexRC.y;

      ${n}

      ivec5 outShape = ivec5(r, c, d, d2, d3);
      return outShape;
    }
  `}function BBe(e,t){const n=hg(["r","c","d","d2","d3","d4"],e);return`
    ivec6 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(${t[0]}, ${t[1]}));
      int index = resTexRC.x * ${t[1]} + resTexRC.y;

      ${n}

      ivec6 result = ivec6(r, c, d, d2, d3, d4);
      return result;
    }
  `}function zBe(e,t,n){const r=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)];if(bt(e,t))return n?`
      ivec2 getOutputCoords() {
        ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
        return 2 * ivec2(resultUV.yx * vec2(packedTexShape[0], packedTexShape[1]));
      }
    `:`
      ivec2 getOutputCoords() {
        return 2 * ivec2(resultUV.yx * vec2(${r[0]}, ${r[1]}));
      }
    `;const i=Math.ceil(e[1]/2);return n?`
    ivec2 getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      int texelsInLogicalRow = int(ceil(float(outShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));

      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;
      int r = 2 * (index / texelsInLogicalRow);
      int c = imod(index, texelsInLogicalRow) * 2;

      return ivec2(r, c);
    }
  `:`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${r[0]}, ${r[1]}));

      int index = resTexRC.x * ${r[1]} + resTexRC.y;
      int r = 2 * (index / ${i});
      int c = imod(index, ${i}) * 2;

      return ivec2(r, c);
    }
  `}function UBe(e,t,n){return bt(e,t)?n?`
      ivec2 getOutputCoords() {
        return ivec2(resultUV.yx * vec2(outTexShape[0], outTexShape[1]));
      }
    `:`
      ivec2 getOutputCoords() {
        return ivec2(resultUV.yx * vec2(${t[0]}, ${t[1]}));
      }
    `:e[1]===1?n?`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(outTexShape[0], outTexShape[1]));
        int index = resTexRC.x * outTexShape[1] + resTexRC.y;
        return ivec2(index, 0);
      }
    `:`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(${t[0]}, ${t[1]}));
        int index = resTexRC.x * ${t[1]} + resTexRC.y;
        return ivec2(index, 0);
      }
    `:e[0]===1?n?`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(outTexShape[0], outTexShape[1]));
        int index = resTexRC.x * outTexShape[1] + resTexRC.y;
        return ivec2(0, index);
      }
    `:`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(${t[0]}, ${t[1]}));
        int index = resTexRC.x * ${t[1]} + resTexRC.y;
        return ivec2(0, index);
      }
    `:n?`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(outTexShape[0], outTexShape[1]));
      int index = resTexRC.x * outTexShape[1] + resTexRC.y;
      int r = index / outShape[1];
      int c = index - r * outShape[1];
      return ivec2(r, c);
    }
  `:`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${t[0]}, ${t[1]}));
      int index = resTexRC.x * ${t[1]} + resTexRC.y;
      int r = index / ${e[1]};
      int c = index - r * ${e[1]};
      return ivec2(r, c);
    }
  `}function dg(e){return`offset${e}`}function jBe(e){const t=e.name,n="get"+t.charAt(0).toUpperCase()+t.slice(1),r=Ni();return`
    vec4 ${n}() {
      return ${r.texture2D}(${t}, halfCR);
    }
  `}function WBe(e,t){const n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1);if(e.shapeInfo.isUniform)return`float ${r}() {return ${n};}`;const[i,s]=e.shapeInfo.texShape;if(i===1&&s===1)return`
      float ${r}() {
        return sampleTexture(${n}, halfCR);
      }
    `;const o=dg(n);if(t)return`
    float ${r}() {
      vec2 uv = uvFromFlat(${n}TexShape[0], ${n}TexShape[1], ${o});
      return sampleTexture(${n}, uv);
    }
  `;const[a,u]=e.shapeInfo.texShape;return`
    float ${r}() {
      vec2 uv = uvFromFlat(${a}, ${u}, ${o});
      return sampleTexture(${n}, uv);
    }
  `}function VBe(e,t){const n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),i=e.shapeInfo.texShape,s=Ni();if(t)return`
    vec4 ${r}(int index) {
      ivec2 packedTexShape = ivec2(ceil(float(${n}TexShape[0]) / 2.0), ceil(float(${n}TexShape[1]) / 2.0));
      vec2 uv = packedUVfrom1D(
        packedTexShape[0], packedTexShape[1], index);
      return ${s.texture2D}(${n}, uv);
    }
  `;const o=[Math.ceil(i[0]/2),Math.ceil(i[1]/2)];return`
    vec4 ${r}(int index) {
      vec2 uv = packedUVfrom1D(
        ${o[0]}, ${o[1]}, index);
      return ${s.texture2D}(${n}, uv);
    }
  `}function GBe(e,t){const n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1);if(e.shapeInfo.isUniform)return`
      float ${r}(int index) {
        ${X1(e)}
      }
    `;const i=e.shapeInfo.texShape,s=i[0],o=i[1];if(o===1&&s===1)return`
      float ${r}(int index) {
        return sampleTexture(${n}, halfCR);
      }
    `;const a=dg(n);return o===1?t?`
      float ${r}(int index) {
        vec2 uv = vec2(0.5, (float(index + ${a}) + 0.5) / float(${n}TexShape[0]));
        return sampleTexture(${n}, uv);
      }
    `:`
      float ${r}(int index) {
        vec2 uv = vec2(0.5, (float(index + ${a}) + 0.5) / ${s}.0);
        return sampleTexture(${n}, uv);
      }
    `:s===1?t?`
      float ${r}(int index) {
        vec2 uv = vec2((float(index + ${a}) + 0.5) / float(${n}TexShape[1]), 0.5);
        return sampleTexture(${n}, uv);
      }
    `:`
      float ${r}(int index) {
        vec2 uv = vec2((float(index + ${a}) + 0.5) / ${o}.0, 0.5);
        return sampleTexture(${n}, uv);
      }
    `:t?`
    float ${r}(int index) {
      vec2 uv = uvFromFlat(${n}TexShape[0], ${n}TexShape[1], index + ${a});
      return sampleTexture(${n}, uv);
    }
  `:`
    float ${r}(int index) {
      vec2 uv = uvFromFlat(${s}, ${o}, index + ${a});
      return sampleTexture(${n}, uv);
    }
  `}function HBe(e,t){const n=e.shapeInfo.logicalShape,r=e.name,i="get"+r.charAt(0).toUpperCase()+r.slice(1),s=e.shapeInfo.texShape,o=s[0],a=s[1],u=Ni();if(s!=null&&bt(n,s))return t?`
      vec4 ${i}(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(${r}TexShape[1], ${r}TexShape[0]);

        return ${u.texture2D}(${r}, uv);
      }
    `:`
      vec4 ${i}(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(${a}.0, ${o}.0);

        return ${u.texture2D}(${r}, uv);
      }
    `;if(t)return`
    vec4 ${i}(int row, int col) {
      ivec2 packedTexShape = ivec2(ceil(float(${r}TexShape[0]) / 2.0), ceil(float(${r}TexShape[1]) / 2.0));
      int valuesPerRow = int(ceil(float(${r}Shape[1]) / 2.0));
      vec2 uv = packedUVfrom2D(valuesPerRow, packedTexShape[0], packedTexShape[1], row, col);
      return ${u.texture2D}(${r}, uv);
    }
  `;const l=[Math.ceil(s[0]/2),Math.ceil(s[1]/2)],c=Math.ceil(n[1]/2);return`
    vec4 ${i}(int row, int col) {
      vec2 uv = packedUVfrom2D(${c}, ${l[0]}, ${l[1]}, row, col);
      return ${u.texture2D}(${r}, uv);
    }
  `}function qBe(e,t){const n=e.shapeInfo.logicalShape,r=e.name,i="get"+r.charAt(0).toUpperCase()+r.slice(1),s=e.shapeInfo.texShape;if(s!=null&&bt(n,s)){if(t)return`
      float ${i}(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(${r}TexShape[1], ${r}TexShape[0]);
        return sampleTexture(${r}, uv);
      }
    `;const h=s[0],d=s[1];return`
    float ${i}(int row, int col) {
      vec2 uv = (vec2(col, row) + halfCR) / vec2(${d}.0, ${h}.0);
      return sampleTexture(${r}, uv);
    }
  `}const{newShape:o,keptDims:a}=bc(n),u=o;if(u.length<n.length){const h=Y1(e,u),d=["row","col"];return`
      ${q1(h,t)}
      float ${i}(int row, int col) {
        return ${i}(${K1(d,a)});
      }
    `}if(e.shapeInfo.isUniform)return`
      float ${i}(int row, int col) {
        int index = round(dot(vec2(row, col), vec2(${n[1]}, 1)));
        ${X1(e)}
      }
    `;const l=s[0],c=s[1],f=dg(r);return c===1?t?`
      float ${i}(int row, int col) {
        float index = dot(vec3(row, col, ${f}), vec3(${r}Shape[1], 1, 1));
        vec2 uv = vec2(0.5, (index + 0.5) / float(${r}TexShape[0]));
        return sampleTexture(${r}, uv);
      }
    `:`
    float ${i}(int row, int col) {
      float index = dot(vec3(row, col, ${f}), vec3(${n[1]}, 1, 1));
      vec2 uv = vec2(0.5, (index + 0.5) / ${l}.0);
      return sampleTexture(${r}, uv);
    }
  `:l===1?t?`
      float ${i}(int row, int col) {
        float index = dot(vec3(row, col, ${f}), vec3(${r}Shape[1], 1, 1));
        vec2 uv = vec2((index + 0.5) / float(${r}TexShape[1]), 0.5);
        return sampleTexture(${r}, uv);
      }
    `:`
    float ${i}(int row, int col) {
      float index = dot(vec3(row, col, ${f}), vec3(${n[1]}, 1, 1));
      vec2 uv = vec2((index + 0.5) / ${c}.0, 0.5);
      return sampleTexture(${r}, uv);
    }
  `:t?`
      float ${i}(int row, int col) {
        // Explicitly use integer operations as dot() only works on floats.
        int index = row * ${r}Shape[1] + col + ${f};
        vec2 uv = uvFromFlat(${r}TexShape[0], ${r}TexShape[1], index);
        return sampleTexture(${r}, uv);
      }
    `:`
  float ${i}(int row, int col) {
    // Explicitly use integer operations as dot() only works on floats.
    int index = row * ${n[1]} + col + ${f};
    vec2 uv = uvFromFlat(${l}, ${c}, index);
    return sampleTexture(${r}, uv);
  }
`}function XBe(e,t){const n=e.shapeInfo.logicalShape,r=e.name,i="get"+r.charAt(0).toUpperCase()+r.slice(1),s=e.shapeInfo.texShape,o=[Math.ceil(s[0]/2),Math.ceil(s[1]/2)];if(n[0]===1){const h=n.slice(1),d=[1,2],p=Y1(e,h),g=["b","row","col"];return`
        ${Toe(p,t)}
        vec4 ${i}(int b, int row, int col) {
          return ${i}(${K1(g,d)});
        }
      `}const a=Ni();if(t)return`
    vec4 ${i}(int b, int row, int col) {
      ivec2 packedTexShape = ivec2(ceil(float(${r}TexShape[0]) / 2.0), ceil(float(${r}TexShape[1]) / 2.0));
      int valuesPerRow = int(ceil(float(${r}Shape[2]) / 2.0));
      int texelsInBatch = valuesPerRow * int(ceil(float(${r}Shape[1]) / 2.0));
      vec2 uv = packedUVfrom3D(
        packedTexShape[0], packedTexShape[1], texelsInBatch, valuesPerRow, b, row, col);
      return ${a.texture2D}(${r}, uv);
    }
  `;const u=o[0],l=o[1],c=Math.ceil(n[2]/2),f=c*Math.ceil(n[1]/2);return`
    vec4 ${i}(int b, int row, int col) {
      vec2 uv = packedUVfrom3D(
        ${u}, ${l}, ${f}, ${c}, b, row, col);
      return ${a.texture2D}(${r}, uv);
    }
  `}function YBe(e,t){const n=e.shapeInfo.logicalShape,r=e.name,i="get"+r.charAt(0).toUpperCase()+r.slice(1),s=n[1]*n[2],o=n[2],{newShape:a,keptDims:u}=bc(n),l=a;if(l.length<n.length){const g=Y1(e,l),m=["row","col","depth"];return`
        ${q1(g,t)}
        float ${i}(int row, int col, int depth) {
          return ${i}(${K1(m,u)});
        }
      `}if(e.shapeInfo.isUniform)return`
      float ${i}(int row, int col, int depth) {
        int index = round(dot(vec3(row, col, depth),
                          vec3(${s}, ${o}, 1)));
        ${X1(e)}
      }
    `;const c=e.shapeInfo.texShape,f=c[0],h=c[1],d=e.shapeInfo.flatOffset;if(h===s&&d==null)return t?`
      float ${i}(int row, int col, int depth) {
        int stride1 = ${r}Shape[2];
        float texR = float(row);
        float texC = dot(vec2(col, depth), vec2(stride1, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${r}TexShape[1], ${r}TexShape[0]);
        return sampleTexture(${r}, uv);
      }
    `:`
        float ${i}(int row, int col, int depth) {
          float texR = float(row);
          float texC = dot(vec2(col, depth), vec2(${o}, 1));
          vec2 uv = (vec2(texC, texR) + halfCR) /
                     vec2(${h}.0, ${f}.0);
          return sampleTexture(${r}, uv);
        }
      `;if(h===o&&d==null)return t?`
      float ${i}(int row, int col, int depth) {
        float texR = dot(vec2(row, col), vec2(${r}Shape[1], 1));
        float texC = float(depth);
        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${r}TexShape[1], ${r}TexShape[0]);
        return sampleTexture(${r}, uv);
      }
    `:`
    float ${i}(int row, int col, int depth) {
      float texR = dot(vec2(row, col), vec2(${n[1]}, 1));
      float texC = float(depth);
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${h}.0, ${f}.0);
      return sampleTexture(${r}, uv);
    }
  `;const p=dg(r);return t?`
    float ${i}(int row, int col, int depth) {
      // Explicitly use integer operations as dot() only works on floats.
      int stride0 = ${r}Shape[1] * ${r}Shape[2];
      int stride1 = ${r}Shape[2];
      int index = row * stride0 + col * stride1 + depth + ${p};
      vec2 uv = uvFromFlat(${r}TexShape[0], ${r}TexShape[1], index);
      return sampleTexture(${r}, uv);
    }
    `:`
      float ${i}(int row, int col, int depth) {
        // Explicitly use integer operations as dot() only works on floats.
        int index = row * ${s} + col * ${o} + depth + ${p};
        vec2 uv = uvFromFlat(${f}, ${h}, index);
        return sampleTexture(${r}, uv);
      }
  `}function KBe(e,t){const n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),i=Ni();if(t)return`
    vec4 ${r}(int b2, int b, int row, int col) {
      int valuesPerRow = int(ceil(float(${n}Shape[3]) / 2.0));
      int texelsInBatch = valuesPerRow * int(ceil(float(${n}Shape[2]) / 2.0));
      int index = b * texelsInBatch + (row / 2) * valuesPerRow + (col / 2);
      texelsInBatch *= ${n}Shape[1];
      index = b2 * texelsInBatch + index;
      ivec2 packedTexShape = ivec2(ceil(float(${n}TexShape[0]) / 2.0), ceil(float(${n}TexShape[1]) / 2.0));
      int texR = index / packedTexShape[1];
      int texC = index - texR * packedTexShape[1];
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(packedTexShape[1], packedTexShape[0]); return ${i.texture2D}(${n}, uv);
    }
  `;const s=e.shapeInfo.logicalShape,o=s.length,a=e.shapeInfo.texShape,u=[Math.ceil(a[0]/2),Math.ceil(a[1]/2)],l=u[0],c=u[1],f=Math.ceil(s[o-1]/2);let h=f*Math.ceil(s[o-2]/2),d="int b, int row, int col",p=`b * ${h} + (row / 2) * ${f} + (col / 2)`;for(let g=2;g<o-1;g++)d=`int b${g}, `+d,h*=s[o-g-1],p=`b${g} * ${h} + `+p;return`
    vec4 ${r}(${d}) {
      int index = ${p};
      int texR = index / ${c};
      int texC = index - texR * ${c};
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${c}, ${l});
      return ${i.texture2D}(${n}, uv);
    }
  `}function ZBe(e,t){const n=e.shapeInfo.logicalShape,r=e.name,i="get"+r.charAt(0).toUpperCase()+r.slice(1),s=n[3],o=n[2]*s,a=n[1]*o,{newShape:u,keptDims:l}=bc(n);if(u.length<n.length){const b=Y1(e,u),v=["row","col","depth","depth2"];return`
      ${q1(b,t)}
      float ${i}(int row, int col, int depth, int depth2) {
        return ${i}(${K1(v,l)});
      }
    `}if(e.shapeInfo.isUniform)return`
      float ${i}(int row, int col, int depth, int depth2) {
        int index = round(dot(vec4(row, col, depth, depth2),
                          vec4(${a}, ${o}, ${s}, 1)));
        ${X1(e)}
      }
    `;const c=e.shapeInfo.flatOffset,f=e.shapeInfo.texShape,h=f[0],d=f[1],p=`int stride2 = ${r}Shape[3];`,g=`int stride1 = ${r}Shape[2] * stride2;`,m=`int stride0 = ${r}Shape[1] * stride1;`;if(d===a&&c==null)return t?`
      float ${i}(int row, int col, int depth, int depth2) {
        ${p}
        ${g}
        float texR = float(row);
        float texC =
            dot(vec3(col, depth, depth2),
                vec3(stride1, stride2, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${r}TexShape[1], ${r}TexShape[0]);
        return sampleTexture(${r}, uv);
      }
    `:`
      float ${i}(int row, int col, int depth, int depth2) {
        float texR = float(row);
        float texC =
            dot(vec3(col, depth, depth2),
                vec3(${o}, ${s}, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${d}.0, ${h}.0);
        return sampleTexture(${r}, uv);
      }
    `;if(d===s&&c==null)return t?`
      float ${i}(int row, int col, int depth, int depth2) {
        float texR = dot(vec3(row, col, depth),
                         vec3(${r}Shape[1] * ${r}Shape[2], ${r}Shape[2], 1));
        float texC = float(depth2);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${r}TexShape[1], ${r}TexShape[0]);
        return sampleTexture(${r}, uv);
      }
    `:`
      float ${i}(int row, int col, int depth, int depth2) {
        float texR = dot(vec3(row, col, depth),
                         vec3(${n[1]*n[2]}, ${n[2]}, 1));
        float texC = float(depth2);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${d}.0, ${h}.0);
        return sampleTexture(${r}, uv);
      }
    `;const y=dg(r);return t?`
    float ${i}(int row, int col, int depth, int depth2) {
      // Explicitly use integer operations as dot() only works on floats.
      ${p}
      ${g}
      ${m}
      int index = row * stride0 + col * stride1 +
          depth * stride2 + depth2;
      vec2 uv = uvFromFlat(${r}TexShape[0], ${r}TexShape[1], index + ${y});
      return sampleTexture(${r}, uv);
    }
  `:`
    float ${i}(int row, int col, int depth, int depth2) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * ${a} + col * ${o} +
          depth * ${s} + depth2;
      vec2 uv = uvFromFlat(${h}, ${d}, index + ${y});
      return sampleTexture(${r}, uv);
    }
  `}function JBe(e){const t=e.shapeInfo.logicalShape,n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),i=t[4],s=t[3]*i,o=t[2]*s,a=t[1]*o,{newShape:u,keptDims:l}=bc(t);if(u.length<t.length){const g=Y1(e,u),m=["row","col","depth","depth2","depth3"];return`
      ${q1(g)}
      float ${r}(int row, int col, int depth, int depth2, int depth3) {
        return ${r}(${K1(m,l)});
      }
    `}if(e.shapeInfo.isUniform)return`
      float ${r}(int row, int col, int depth, int depth2, int depth3) {
        float index = dot(
          vec4(row, col, depth, depth2),
          vec4(${a}, ${o}, ${s}, ${i})) +
          depth3;
        ${X1(e)}
      }
    `;const c=e.shapeInfo.flatOffset,f=e.shapeInfo.texShape,h=f[0],d=f[1];if(d===a&&c==null)return`
      float ${r}(int row, int col, int depth, int depth2, int depth3) {
        int texR = row;
        float texC = dot(vec4(col, depth, depth2, depth3),
                         vec4(${o}, ${s}, ${i}, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${d}.0, ${h}.0);
        return sampleTexture(${n}, uv);
      }
    `;if(d===i&&c==null)return`
      float ${r}(int row, int col, int depth, int depth2, int depth3) {
        float texR = dot(
          vec4(row, col, depth, depth2),
          vec4(${t[1]*t[2]*t[3]},
               ${t[2]*t[3]}, ${t[3]}, 1));
        int texC = depth3;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${d}.0, ${h}.0);
        return sampleTexture(${n}, uv);
      }
    `;const p=dg(n);return`
    float ${r}(int row, int col, int depth, int depth2, int depth3) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * ${a} + col * ${o} + depth * ${s} +
          depth2 * ${i} + depth3 + ${p};
      vec2 uv = uvFromFlat(${h}, ${d}, index);
      return sampleTexture(${n}, uv);
    }
  `}function QBe(e){const t=e.shapeInfo.logicalShape,n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),{newShape:i,keptDims:s}=bc(t);if(i.length<t.length){const m=Y1(e,i),y=["row","col","depth","depth2","depth3","depth4"];return`
      ${q1(m)}
      float ${r}(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        return ${r}(${K1(y,s)});
      }
    `}const o=t[5],a=t[4]*o,u=t[3]*a,l=t[2]*u,c=t[1]*l;if(e.shapeInfo.isUniform)return`
      float ${r}(int row, int col, int depth,
                  int depth2, int depth3, int depth4) {
        int index = round(dot(
          vec4(row, col, depth, depth2),
          vec4(${c}, ${l}, ${u}, ${a})) +
          dot(
            vec2(depth3, depth4),
            vec2(${o}, 1)));
        ${X1(e)}
      }
    `;const f=e.shapeInfo.flatOffset,h=e.shapeInfo.texShape,d=h[0],p=h[1];if(p===c&&f==null)return`
      float ${r}(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        int texR = row;
        float texC = dot(vec4(col, depth, depth2, depth3),
          vec4(${l}, ${u}, ${a}, ${o})) +
               float(depth4);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${p}.0, ${d}.0);
        return sampleTexture(${n}, uv);
      }
    `;if(p===o&&f==null)return`
      float ${r}(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        float texR = dot(vec4(row, col, depth, depth2),
          vec4(${t[1]*t[2]*t[3]*t[4]},
               ${t[2]*t[3]*t[4]},
               ${t[3]*t[4]},
               ${t[4]})) + float(depth3);
        int texC = depth4;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${p}.0, ${d}.0);
        return sampleTexture(${n}, uv);
      }
    `;const g=dg(n);return`
    float ${r}(int row, int col, int depth,
                  int depth2, int depth3, int depth4) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * ${c} + col * ${l} + depth * ${u} +
          depth2 * ${a} + depth3 * ${o} + depth4 + ${g};
      vec2 uv = uvFromFlat(${d}, ${p}, index);
      return sampleTexture(${n}, uv);
    }
  `}function X1(e){const t=e.name,n=te(e.shapeInfo.logicalShape);return n<2?`return ${t};`:`
    for (int i = 0; i < ${n}; i++) {
      if (i == index) {
        return ${t}[i];
      }
    }
  `}function e5e(e,t){const n=e.name,r=n.charAt(0).toUpperCase()+n.slice(1),i="get"+r+"AtOutCoords",s=e.shapeInfo.logicalShape.length,o=t.logicalShape.length,a=Aoe(e.shapeInfo.logicalShape,t.logicalShape),u=Gt(o),l=o-s;let c;const f=["x","y","z","w","u","v"];s===0?c="":o<2&&a.length>=1?c="coords = 0;":c=a.map(b=>`coords.${f[b+l]} = 0;`).join(`
`);let h="";o<2&&s>0?h="coords":h=e.shapeInfo.logicalShape.map((b,v)=>`coords.${f[v+l]}`).join(", ");let d="return outputValue;";const g=te(e.shapeInfo.logicalShape)===1,y=te(t.logicalShape)===1;if(s===1&&!g&&!y)d=`
      return vec4(outputValue.xy, outputValue.xy);
    `;else if(g&&!y)o===1?d=`
        return vec4(outputValue.x, outputValue.x, 0., 0.);
      `:d=`
        return vec4(outputValue.x);
      `;else if(a.length){const b=s-2,v=s-1;a.indexOf(b)>-1&&a.indexOf(v)>-1?d="return vec4(outputValue.x);":a.indexOf(b)>-1?d="return vec4(outputValue.x, outputValue.y, outputValue.x, outputValue.y);":a.indexOf(v)>-1&&(d="return vec4(outputValue.xx, outputValue.zz);")}return`
    vec4 ${i}() {
      ${u} coords = getOutputCoords();
      ${c}
      vec4 outputValue = get${r}(${h});
      ${d}
    }
  `}function t5e(e,t){const n=e.name,r=n.charAt(0).toUpperCase()+n.slice(1),i="get"+r+"AtOutCoords",s=t.texShape,o=e.shapeInfo.texShape,a=e.shapeInfo.logicalShape.length,u=t.logicalShape.length;if(!e.shapeInfo.isUniform&&a===u&&e.shapeInfo.flatOffset==null&&bt(o,s))return`
      float ${i}() {
        return sampleTexture(${n}, resultUV);
      }
    `;const l=Gt(u),c=Aoe(e.shapeInfo.logicalShape,t.logicalShape),f=u-a;let h;const d=["x","y","z","w","u","v"];a===0?h="":u<2&&c.length>=1?h="coords = 0;":h=c.map(g=>`coords.${d[g+f]} = 0;`).join(`
`);let p="";return u<2&&a>0?p="coords":p=e.shapeInfo.logicalShape.map((g,m)=>`coords.${d[m+f]}`).join(", "),`
    float ${i}() {
      ${l} coords = getOutputCoords();
      ${h}
      return get${r}(${p});
    }
  `}function Gt(e){if(e<=1)return"int";if(e===2)return"ivec2";if(e===3)return"ivec3";if(e===4)return"ivec4";if(e===5)return"ivec5";if(e===6)return"ivec6";throw Error(`GPU for rank ${e} is not yet supported`)}function h6(e,t,n){const{newShape:r,keptDims:i}=bc(t),s=t.length,o=e&&s===3&&t[0]===1,a=o?t.slice(1):r,u=!e&&s>1&&!bt(t,n)&&r.length<s||o;return{useSqueezeShape:u,uniformShape:u?a:t,keptDims:i}}function Y1(e,t){const n=JSON.parse(JSON.stringify(e));return n.shapeInfo.logicalShape=t,n}function K1(e,t){return t.map(n=>e[n]).join(", ")}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function n5e(e,t,n,r){const i=n.map((c,f)=>{const h={logicalShape:c.shape,texShape:c.isUniform?null:c.texData.texShape,isUniform:c.isUniform,isPacked:c.isUniform?!1:c.texData.isPacked,flatOffset:null};return c.texData!=null&&c.texData.slice!=null&&c.texData.slice.flatOffset>0&&(h.flatOffset=c.texData.slice.flatOffset),{name:t.variableNames[f],shapeInfo:h}}),s=i.map(c=>c.shapeInfo),o={logicalShape:r.shape,texShape:r.texData.texShape,isUniform:!1,isPacked:r.texData.isPacked,flatOffset:null},a=vBe(i,o,t),u=YPe(e.gl,a),l=e.createProgram(u);return K().get("ENGINE_COMPILE_ONLY")?{program:t,fragmentShader:u,source:a,webGLProgram:l,inShapeInfos:s,outShapeInfo:o,variablesLocations:null,customUniformLocations:null,infLoc:null,nanLoc:null,outShapeLocation:null,outShapeStridesLocation:null,outTexShapeLocation:null}:(e.buildVao(l),Object.assign({program:t,fragmentShader:u,source:a,webGLProgram:l,inShapeInfos:s,outShapeInfo:o},Doe(e,t,l)))}function Doe(e,t,n){const r=[],i=[];let s,o,a,u=null,l=null;l=e.getUniformLocation(n,"NAN",!1),K().getNumber("WEBGL_VERSION")===1&&(u=e.getUniformLocation(n,"INFINITY",!1));const c=!1;for(const f of t.variableNames){const h={name:f,uniform:e.getUniformLocation(n,f,c),offset:e.getUniformLocation(n,`offset${f}`,c)};t.enableShapeUniforms&&(h.shape=e.getUniformLocation(n,`${f}Shape`,c),h.texShape=e.getUniformLocation(n,`${f}TexShape`,c)),r.push(h)}if(t.enableShapeUniforms&&(s=e.getUniformLocation(n,"outShape",c),a=e.getUniformLocation(n,"outShapeStrides",c),o=e.getUniformLocation(n,"outTexShape",c)),t.customUniforms)for(const f of t.customUniforms)i.push(e.getUniformLocation(n,f.name,c));return{variablesLocations:r,customUniformLocations:i,infLoc:u,nanLoc:l,outShapeLocation:s,outShapeStridesLocation:a,outTexShapeLocation:o}}function yG(e,t){if(e.length!==t.length)throw Error(`Binary was compiled with ${e.length} inputs, but was executed with ${t.length} inputs`);e.forEach((n,r)=>{const i=n.logicalShape,s=t[r],o=s.shape;if(!bt(i,o))throw Error(`Binary was compiled with different shapes than the current args. Shapes ${i} and ${o} must match`);if(n.isUniform&&s.isUniform)return;const a=n.texShape,u=s.isUniform?null:s.texData.texShape;if(!bt(a,u))throw Error(`Binary was compiled with different texture shapes than the current args. Shape ${a} and ${u} must match`)})}function r5e(e,t,n,r,i){t.program.enableShapeUniforms||(yG(t.inShapeInfos,n),yG([t.outShapeInfo],[r]));const s=r.texData.texture,o=r.texData.texShape;r.texData.isPacked?e.setOutputPackedMatrixTexture(s.texture,o[0],o[1]):e.setOutputMatrixTexture(s.texture,o[0],o[1]),e.setProgram(t.webGLProgram),e.bindVertexArray(t.webGLProgram.vao),K().getNumber("WEBGL_VERSION")===1&&t.infLoc!==null&&e.gl.uniform1f(t.infLoc,1/0),t.nanLoc!==null&&e.gl.uniform1f(t.nanLoc,NaN);for(let u=0;u<n.length;++u){const l=n[u],{uniform:c,offset:f,shape:h,texShape:d}=t.variablesLocations[u];if(h){const{uniformShape:p}=h6(t.program.packedInputs,l.shape,l.texData.texShape);switch(p.length){case 1:e.gl.uniform1iv(h,new Int32Array(p));break;case 2:e.gl.uniform2iv(h,new Int32Array(p));break;case 3:e.gl.uniform3iv(h,new Int32Array(p));break;case 4:e.gl.uniform4iv(h,new Int32Array(p));break}}if(d&&e.gl.uniform2i(d,l.texData.texShape[0],l.texData.texShape[1]),c!=null){if(l.isUniform){if(te(l.shape)<2)e.gl.uniform1f(c,l.uniformValues[0]);else{let p=l.uniformValues;p instanceof Float32Array||(p=new Float32Array(p)),e.gl.uniform1fv(c,p)}continue}l.texData.slice!=null&&f!=null&&e.gl.uniform1i(f,l.texData.slice.flatOffset),e.setInputMatrixTexture(l.texData.texture.texture,c,u)}}const a=t.outShapeLocation;if(a)switch(r.shape.length){case 1:e.gl.uniform1iv(a,new Int32Array(r.shape));break;case 2:e.gl.uniform2iv(a,new Int32Array(r.shape));break;case 3:e.gl.uniform3iv(a,new Int32Array(r.shape));break;case 4:e.gl.uniform4iv(a,new Int32Array(r.shape));break}if(t.outShapeStridesLocation){const u=Me(r.shape);switch(r.shape.length){case 2:e.gl.uniform1iv(t.outShapeStridesLocation,new Int32Array(u));break;case 3:e.gl.uniform2iv(t.outShapeStridesLocation,new Int32Array(u));break;case 4:e.gl.uniform3iv(t.outShapeStridesLocation,new Int32Array(u));break}}if(t.outTexShapeLocation&&e.gl.uniform2i(t.outTexShapeLocation,r.texData.texShape[0],r.texData.texShape[1]),t.program.customUniforms&&i)for(let u=0;u<t.program.customUniforms.length;++u){const l=t.program.customUniforms[u],c=t.customUniformLocations[u],f=i[u];if(l.type==="float")e.gl.uniform1fv(c,f);else if(l.type==="vec2")e.gl.uniform2fv(c,f);else if(l.type==="vec3")e.gl.uniform3fv(c,f);else if(l.type==="vec4")e.gl.uniform4fv(c,f);else if(l.type==="int")e.gl.uniform1iv(c,f);else if(l.type==="ivec2")e.gl.uniform2iv(c,f);else if(l.type==="ivec3")e.gl.uniform3iv(c,f);else if(l.type==="ivec4")e.gl.uniform4iv(c,f);else throw Error(`uniform type ${l.type} is not supported yet.`)}e.executeProgram()}function i5e(e,t,n){let r="";t.concat(n).forEach(o=>{const a=o.texData!=null&&o.texData.slice!=null&&o.texData.slice.flatOffset>0;if(e.enableShapeUniforms&&!o.isUniform){const u=o.texData.texShape,{useSqueezeShape:l,uniformShape:c,keptDims:f}=h6(e.packedInputs,o.shape,u);let h="",d="",p="";if(c.length===1&&e.packedInputs){const w=[Math.ceil(u[0]/2),Math.ceil(u[1]/2)];h=`${w[0]>1}_${w[1]>1}`}else if(c.length===2&&!e.packedInputs)d=`${c[0]>1}_${c[1]>1}`;else if(c.length>2&&!e.packedInputs){const w=Me(c);p=`${w[0]===u[1]}_${w[w.length-1]===u[1]}`}const g=o.shape.length,m=c.length===2&&bt(o.shape,u),y=te(o.shape)===1,b=yp(o.shape,n.shape),v=!e.packedInputs&&g===n.shape.length&&bt(u,n.texData.texShape),x=e.packedInputs||c.length>2?"":`${u[0]>1}_${u[1]>1}`;r+=`${g}_${v}_${l?f:""}_${c.length}_${y}_${b}_${m}_${h}_${d}_${p}_${x}_${a}`}else{const u=o.isUniform?"uniform":o.texData.texShape;r+=`${o.shape}_${u}_${a}`}});const i=e.userCode;let s=e.constructor.name;return s+="_"+r+"_"+i+`${K().getNumber("WEBGL_VERSION")}`,s}function Jr(e){return K().getBool("WEBGL_USE_SHAPES_UNIFORMS")&&e<=4}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class s5e{constructor(t){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outPackingScheme=ev.DENSE,this.customUniforms=[{name:"texShape",type:"ivec2"}];const n=Ni();this.outputShape=t,this.enableShapeUniforms=Jr(this.outputShape.length),this.userCode=`
      ivec3 outCoordsFromFlatIndex(int index) {
        ${this.enableShapeUniforms?II(["r","c","d"],t):hg(["r","c","d"],t)}
        return ivec3(r, c, d);
      }

      void main() {
        ivec2 resTexRC = ivec2(resultUV.yx * vec2(texShape[0], texShape[1]));
        int index = 4 * (resTexRC.x * texShape[1] + resTexRC.y);

        vec4 result = vec4(0.);

        for (int i=0; i<4; i++) {
          int flatIndex = index + i;
          ivec3 rc = outCoordsFromFlatIndex(flatIndex);
          result[i] = getA(rc.x, rc.y, rc.z);
        }

        ${n.output} = result;
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class o5e{constructor(t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outPackingScheme=ev.DENSE,this.customUniforms=[{name:"texShape",type:"ivec2"}];const n=Ni();this.outputShape=t,this.enableShapeUniforms=Jr(this.outputShape.length),this.userCode=`
      ivec3 outCoordsFromFlatIndex(int index) {
        ${this.enableShapeUniforms?II(["r","c","d"],t):hg(["r","c","d"],t)}
        return ivec3(r, c, d);
      }

      void main() {
        ivec2 resTexRC = ivec2(resultUV.yx * vec2(texShape[0], texShape[1]));
        int index = 4 * (resTexRC.x * texShape[1] + resTexRC.y);

        vec4 result = vec4(0.);

        for (int i=0; i<4; i++) {
          int flatIndex = index + i;
          ivec3 rc = outCoordsFromFlatIndex(flatIndex);
          result[i] = getChannel(getA(rc.x, rc.y, rc.z), vec2(rc.y, rc.z));
        }

        ${n.output} = result;
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class a5e{constructor(t){this.variableNames=["A"],this.outTexUsage=Ks.DOWNLOAD;const n=Ni();this.outputShape=t,this.userCode=`
      ${_oe}

      void main() {
        float x = getAAtOutCoords();
        ${n.output} = encode_float(x);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class u5e{constructor(t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outTexUsage=Ks.DOWNLOAD;const n=Ni();this.outputShape=t,this.userCode=`
      ${_oe}

      void main() {
        ivec3 coords = getOutputCoords();
        float x = getChannel(getAAtOutCoords(), vec2(coords.y, coords.z));
        ${n.output} = encode_float(x);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const l5e={R:0,G:1,B:2,A:3};class bG{constructor(t,n=!1,r="RGBA"){this.variableNames=["A"],this.customUniforms=[{name:"texShape",type:"ivec2"}];const i=Ni();this.outputShape=t,this.enableShapeUniforms=Jr(this.outputShape.length);let s="result";n&&(s="floor(result * 255. + 0.5)");let o="";for(let a=0;a<r.length;a++){const u=r[a];o+=`
          if(offset == ${a}) {
            result = values[${l5e[u]}];
          }`}this.userCode=`
      ${this.enableShapeUniforms?f6():c6(t)}

      void main() {
        ivec3 coords = getOutputCoords();
        int flatIndex = getFlatIndex(coords);
        float result = 0.;
        int offset = imod(flatIndex, ${r.length});

        flatIndex = idiv(flatIndex, ${r.length}, 1.);

        int r = flatIndex / texShape[1];
        if (r < texShape[0]) {
          int c = imod(flatIndex, texShape[1]);
          vec2 uv = (vec2(c, r) + halfCR) / vec2(texShape[1], texShape[0]);
          vec4 values = ${i.texture2D}(A, uv);
          ${o}
        }
        ${i.output} = vec4(${s}, 0., 0., 0.);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class c5e{constructor(t,n=!1){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.customUniforms=[{name:"texShape",type:"ivec2"}];const r=Ni();this.outputShape=t,this.enableShapeUniforms=Jr(this.outputShape.length);let i="",s="result";n&&(s="floor(result * 255. + 0.5)");for(let o=0;o<=1;o++)for(let a=0;a<=1;a++){const u=o*2+a;i+=`
          localCoords = coords;
          if(localCoords[2] + ${a} < ${this.enableShapeUniforms?"outShape[2]":`${t[2]}`}) {
          localCoords[2] += ${a};
          if (localCoords[1] + ${o} < ${this.enableShapeUniforms?"outShape[1]":`${t[1]}`}) {
            localCoords[1] += ${o};

            flatIndex = getFlatIndex(localCoords);
            offset = imod(flatIndex, 4);

            flatIndex = idiv(flatIndex, 4, 1.);

            int r = flatIndex / texShape[1];
            int c = imod(flatIndex, texShape[1]);
            vec2 uv = (vec2(c, r) + halfCR) / vec2(texShape[1], texShape[0]);
            values = ${r.texture2D}(A, uv);

            if (offset == 0) {
              result[${u}] = values[0];
            } else if (offset == 1) {
              result[${u}] = values[1];
            } else if (offset == 2) {
              result[${u}] = values[2];
            } else {
              result[${u}] = values[3];
            }
          }
        }
        `}this.userCode=`
        ${this.enableShapeUniforms?f6():c6(t)}

        void main() {
          ivec3 coords = getOutputCoords();

          vec4 result = vec4(0.);
          int flatIndex, r, c, offset;
          ivec3 localCoords;
          vec2 uv;
          vec4 values;

          ${i}

          ${r.output} = ${s};
        }
    `}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function f5e(e){const t=Ni(),n=`${t.version}
    precision highp float;
    ${t.attribute} vec3 clipSpacePos;
    ${t.attribute} vec2 uv;
    ${t.varyingVs} vec2 resultUV;

    void main() {
      gl_Position = vec4(clipSpacePos, 1);
      resultUV = uv;
    }`;return XPe(e,n)}function h5e(e){const t=new Float32Array([-1,1,0,0,1,-1,-1,0,0,0,1,1,0,1,1,1,-1,0,1,0]);return QPe(e,t)}function d5e(e){const t=new Uint16Array([0,1,2,2,1,3]);return eBe(e,t)}function Jw(e,t,n,r,i,s){nBe(t,n);const o=tBe(e),a=e.TEXTURE_2D;return Ee(e,()=>e.bindTexture(a,o)),Ee(e,()=>e.texParameteri(a,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE)),Ee(e,()=>e.texParameteri(a,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE)),Ee(e,()=>e.texParameteri(a,e.TEXTURE_MIN_FILTER,e.NEAREST)),Ee(e,()=>e.texParameteri(a,e.TEXTURE_MAG_FILTER,e.NEAREST)),K().getNumber("WEBGL_VERSION")===1?Ee(e,()=>e.texImage2D(a,0,r,t,n,0,i,s,null)):Ee(e,()=>e.texStorage2D(a,1,r,t,n)),Ee(e,()=>e.bindTexture(e.TEXTURE_2D,null)),{texture:o,texShape:[n,t]}}function Noe(e){return e.internalFormatFloat}function p5e(e,t,n,r){const[i,s]=Kw(t,n);return Jw(e,i,s,Noe(r),r.textureFormatFloat,e.FLOAT)}function Foe(e){return e.internalFormatHalfFloat}function g5e(e,t,n,r){const[i,s]=Kw(t,n);return Jw(e,i,s,Foe(r),r.textureFormatFloat,r.textureTypeHalfFloat)}function Ooe(e){return e.downloadTextureFormat}function m5e(e,t,n,r){const[i,s]=Kw(t,n);return Jw(e,i,s,Ooe(r),e.RGBA,e.UNSIGNED_BYTE)}function Roe(e){return e.internalFormatPackedFloat}function y5e(e,t,n,r){const[i,s]=H1(t,n);return Jw(e,i,s,Roe(r),e.RGBA,e.FLOAT)}function Moe(e){return e.internalFormatPackedHalfFloat}function b5e(e,t,n,r){const[i,s]=H1(t,n);return Jw(e,i,s,Moe(r),e.RGBA,r.textureTypeHalfFloat)}function x5e(e,t,n){return Ee(e,()=>e.bindBuffer(e.ARRAY_BUFFER,n)),pG(e,t,"clipSpacePos",n,3,20,0)&&pG(e,t,"uv",n,2,20,12)}function v5e(e,t,n,r,i,s){Ee(e,()=>e.bindTexture(e.TEXTURE_2D,t));let o,a,u;i instanceof Uint8Array?(o=new Uint8Array(n*r*4),a=e.UNSIGNED_BYTE,u=e.RGBA):(o=new Float32Array(n*r*4),a=e.FLOAT,u=s.internalFormatPackedFloat),o.set(i),K().getNumber("WEBGL_VERSION")===2?Ee(e,()=>e.texSubImage2D(e.TEXTURE_2D,0,0,0,n,r,e.RGBA,a,o)):Ee(e,()=>e.texImage2D(e.TEXTURE_2D,0,u,n,r,0,e.RGBA,a,o)),Ee(e,()=>e.bindTexture(e.TEXTURE_2D,null))}function w5e(e,t,n){Ee(e,()=>e.bindTexture(e.TEXTURE_2D,t)),n.data instanceof Uint8Array?K().getNumber("WEBGL_VERSION")===2?Ee(e,()=>e.texSubImage2D(e.TEXTURE_2D,0,0,0,n.width,n.height,e.RGBA,e.UNSIGNED_BYTE,n.data)):Ee(e,()=>e.texImage2D(e.TEXTURE_2D,0,e.RGBA,n.width,n.height,0,e.RGBA,e.UNSIGNED_BYTE,n.data)):K().getNumber("WEBGL_VERSION")===2?Ee(e,()=>e.texSubImage2D(e.TEXTURE_2D,0,0,0,e.RGBA,e.UNSIGNED_BYTE,n)):Ee(e,()=>e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,n)),Ee(e,()=>e.bindTexture(e.TEXTURE_2D,null))}function $5e(e,t,n,r){const i=e.createBuffer();Ee(e,()=>e.bindBuffer(e.PIXEL_PACK_BUFFER,i));const a=4*4*t*n;return Ee(e,()=>e.bufferData(e.PIXEL_PACK_BUFFER,a,e.STREAM_READ)),Ee(e,()=>e.readPixels(0,0,n,t,e.RGBA,e.FLOAT,0)),Ee(e,()=>e.bindBuffer(e.PIXEL_PACK_BUFFER,null)),i}function C5e(e,t,n){const r=e,i=new Float32Array(n);return r.bindBuffer(r.PIXEL_PACK_BUFFER,t),r.getBufferSubData(r.PIXEL_PACK_BUFFER,0,i),r.bindBuffer(r.PIXEL_PACK_BUFFER,null),i}function S5e(e,t,n,r){const[i,s]=Kw(t,n),o=4,a=new Uint8Array(UPe(t*n,o));return Ee(e,()=>e.readPixels(0,0,i,s,r.downloadTextureFormat,e.UNSIGNED_BYTE,a)),new Float32Array(a.buffer)}function k5e(e,t,n,r,i,s,o,a){const u=e,l=new Float32Array(jPe(s,o));return u.bindBuffer(u.PIXEL_PACK_BUFFER,t),u.getBufferSubData(u.PIXEL_PACK_BUFFER,0,l),u.bindBuffer(u.PIXEL_PACK_BUFFER,null),l}function E5e(e,t,n){const r=new Float32Array(t*n*4);return Ee(e,()=>e.readPixels(0,0,n,t,e.RGBA,e.FLOAT,r)),r}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class p3{constructor(t){this.outputTexture=null,this.program=null,this.disposed=!1,this.itemsToPoll=[];const n=K().getNumber("WEBGL_VERSION");if(t!=null?(this.gl=t,PPe(n,t)):this.gl=Fa(n),t=this.gl,K().getNumber("WEBGL_VERSION")===2){const s=t;this.createVertexArray=()=>Ee(s,()=>s.createVertexArray()),this.bindVertexArray=o=>Ee(s,()=>s.bindVertexArray(o)),this.deleteVertexArray=o=>Ee(s,()=>s.deleteVertexArray(o)),this.getVertexArray=()=>Ee(s,()=>s.getParameter(s.VERTEX_ARRAY_BINDING))}else if(t!=null){const s=t.getExtension("OES_vertex_array_object");if(s==null)throw new Error("All WebGL1 implementations are expected to offer OES_vertex_array_object.");this.createVertexArray=()=>Ee(t,()=>s.createVertexArrayOES()),this.bindVertexArray=o=>Ee(t,()=>s.bindVertexArrayOES(o)),this.deleteVertexArray=o=>Ee(t,()=>s.deleteVertexArrayOES(o)),this.getVertexArray=()=>Ee(t,()=>t.getParameter(s.VERTEX_ARRAY_BINDING_OES))}let r="WEBGL_color_buffer_float";const i="EXT_color_buffer_half_float";if(this.parallelCompilationExtension=this.gl.getExtension("KHR_parallel_shader_compile"),K().getNumber("WEBGL_VERSION")===1){const s="OES_texture_float",o="OES_texture_half_float";if(this.textureFloatExtension=FC(this.gl,s),Eo(this.gl,o))this.textureHalfFloatExtension=FC(this.gl,o);else if(K().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support half float textures, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.");if(this.colorBufferFloatExtension=this.gl.getExtension(r),Eo(this.gl,i))this.colorBufferHalfFloatExtension=FC(this.gl,i);else if(K().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support color renderable half floats, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.")}else if(r="EXT_color_buffer_float",Eo(this.gl,r))this.colorBufferFloatExtension=this.gl.getExtension(r);else if(Eo(this.gl,i))this.colorBufferHalfFloatExtension=this.gl.getExtension(i);else throw new Error("GL context does not support color renderable floats");this.vertexBuffer=h5e(this.gl),this.indexBuffer=d5e(this.gl),this.framebuffer=rBe(this.gl),this.textureConfig=l6(this.gl,this.textureHalfFloatExtension)}get debug(){return K().getBool("DEBUG")}dispose(){if(this.disposed)return;this.program!=null&&console.warn("Disposing a GPGPUContext that still has a bound WebGLProgram. This is probably a resource leak, delete the program with GPGPUContext.deleteProgram before disposing."),this.outputTexture!=null&&console.warn("Disposing a GPGPUContext that still has a bound output matrix texture.  This is probably a resource leak, delete the output matrix texture with GPGPUContext.deleteMatrixTexture before disposing.");const t=this.gl;Ee(t,()=>t.finish()),Ee(t,()=>t.bindFramebuffer(t.FRAMEBUFFER,null)),Ee(t,()=>t.deleteFramebuffer(this.framebuffer)),Ee(t,()=>t.bindBuffer(t.ARRAY_BUFFER,null)),Ee(t,()=>t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,null)),Ee(t,()=>t.deleteBuffer(this.indexBuffer)),this.disposed=!0}createFloat32MatrixTexture(t,n){return this.throwIfDisposed(),p5e(this.gl,t,n,this.textureConfig)}createFloat16MatrixTexture(t,n){return this.throwIfDisposed(),g5e(this.gl,t,n,this.textureConfig)}createUnsignedBytesMatrixTexture(t,n){return this.throwIfDisposed(),m5e(this.gl,t,n,this.textureConfig)}uploadPixelDataToTexture(t,n){this.throwIfDisposed(),w5e(this.gl,t,n)}uploadDenseMatrixToTexture(t,n,r,i){this.throwIfDisposed(),v5e(this.gl,t,n,r,i,this.textureConfig)}createFloat16PackedMatrixTexture(t,n){return this.throwIfDisposed(),b5e(this.gl,t,n,this.textureConfig)}createPackedMatrixTexture(t,n){return this.throwIfDisposed(),y5e(this.gl,t,n,this.textureConfig)}deleteMatrixTexture(t){this.throwIfDisposed(),this.outputTexture===t&&(gG(this.gl,this.framebuffer),this.outputTexture=null),Ee(this.gl,()=>this.gl.deleteTexture(t))}downloadByteEncodedFloatMatrixFromOutputTexture(t,n,r){return this.downloadMatrixDriver(t,()=>S5e(this.gl,n,r,this.textureConfig))}downloadPackedMatrixFromBuffer(t,n,r,i,s,o){return k5e(this.gl,t,n,r,i,s,o,this.textureConfig)}downloadFloat32MatrixFromBuffer(t,n){return C5e(this.gl,t,n)}createBufferFromTexture(t,n,r){this.bindTextureToFrameBuffer(t);const i=$5e(this.gl,n,r,this.textureConfig);return this.unbindTextureToFrameBuffer(),i}createAndWaitForFence(){const t=this.createFence(this.gl);return this.pollFence(t)}createFence(t){let n,r;if(K().getBool("WEBGL_FENCE_API_ENABLED")){const i=t,s=i.fenceSync(i.SYNC_GPU_COMMANDS_COMPLETE,0);t.flush(),r=()=>{const o=i.clientWaitSync(s,0,0);return o===i.ALREADY_SIGNALED||o===i.CONDITION_SATISFIED},n=s}else K().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?(n=this.beginQuery(),this.endQuery(),r=()=>this.isQueryAvailable(n,K().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))):r=()=>!0;return{query:n,isFencePassed:r}}downloadMatrixFromPackedTexture(t,n,r){return this.downloadMatrixDriver(t,()=>E5e(this.gl,n,r))}createProgram(t){this.throwIfDisposed();const n=this.gl;this.vertexShader==null&&(this.vertexShader=f5e(n));const r=ZPe(n);Ee(n,()=>n.attachShader(r,this.vertexShader)),Ee(n,()=>n.attachShader(r,t)),JPe(n,r);const i=Object.assign(r,{vao:this.createVertexArray()});return this.debug&&c3(n,i),i}buildVao(t){this.setProgram(t),this.bindVertexArray(t.vao);const n=this.gl;Ee(n,()=>n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,this.indexBuffer)),x5e(n,t,this.vertexBuffer)}deleteProgram(t){this.throwIfDisposed(),t===this.program&&(this.program=null),t!=null&&(Ee(this.gl,()=>this.gl.deleteProgram(t)),this.deleteVertexArray(t.vao))}setProgram(t){this.throwIfDisposed(),this.program=t,this.program!=null&&this.debug&&c3(this.gl,this.program),Ee(this.gl,()=>this.gl.useProgram(t))}getUniformLocation(t,n,r=!0){return this.throwIfDisposed(),r?sBe(this.gl,t,n):oBe(this.gl,t,n)}getAttributeLocation(t,n){return this.throwIfDisposed(),Ee(this.gl,()=>this.gl.getAttribLocation(t,n))}getUniformLocationNoThrow(t,n){return this.throwIfDisposed(),this.gl.getUniformLocation(t,n)}setInputMatrixTexture(t,n,r){this.throwIfDisposed(),this.throwIfNoProgram(),aBe(this.gl,t,n,r)}setOutputMatrixTexture(t,n,r){this.setOutputMatrixTextureDriver(t,r,n)}setOutputPackedMatrixTexture(t,n,r){this.throwIfDisposed();const[i,s]=H1(n,r);this.setOutputMatrixTextureDriver(t,i,s)}setOutputMatrixWriteRegion(t,n,r,i){this.setOutputMatrixWriteRegionDriver(r,t,i,n)}setOutputPackedMatrixWriteRegion(t,n,r,i){throw new Error("setOutputPackedMatrixWriteRegion not implemented.")}debugValidate(){this.program!=null&&c3(this.gl,this.program),OC(this.gl)}executeProgram(){this.throwIfDisposed(),this.throwIfNoProgram();const t=this.gl;if(this.debug){const n=this.getVertexArray();console.assert(n===this.program.vao,"VAO changed between setProgram and executeProgram!"),this.debugValidate()}Ee(t,()=>t.drawElements(t.TRIANGLES,6,t.UNSIGNED_SHORT,0))}blockUntilAllProgramsCompleted(){this.throwIfDisposed(),Ee(this.gl,()=>this.gl.finish())}getQueryTimerExtension(){return this.disjointQueryTimerExtension==null&&(this.disjointQueryTimerExtension=FC(this.gl,K().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2?"EXT_disjoint_timer_query_webgl2":"EXT_disjoint_timer_query")),this.disjointQueryTimerExtension}getQueryTimerExtensionWebGL2(){return this.getQueryTimerExtension()}getQueryTimerExtensionWebGL1(){return this.getQueryTimerExtension()}beginQuery(){if(K().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2){const r=this.gl,i=this.getQueryTimerExtensionWebGL2(),s=r.createQuery();return r.beginQuery(i.TIME_ELAPSED_EXT,s),s}const t=this.getQueryTimerExtensionWebGL1(),n=t.createQueryEXT();return t.beginQueryEXT(t.TIME_ELAPSED_EXT,n),n}endQuery(){if(K().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2){const n=this.gl,r=this.getQueryTimerExtensionWebGL2();n.endQuery(r.TIME_ELAPSED_EXT);return}const t=this.getQueryTimerExtensionWebGL1();t.endQueryEXT(t.TIME_ELAPSED_EXT)}async waitForQueryAndGetTime(t){return await RR(()=>this.disposed||this.isQueryAvailable(t,K().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))),this.getQueryTime(t,K().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}getQueryTime(t,n){if(n===0)return null;if(n===2){const r=this.gl;return r.getQueryParameter(t,r.QUERY_RESULT)/1e6}else{const r=this.getQueryTimerExtensionWebGL1();return r.getQueryObjectEXT(t,r.QUERY_RESULT_EXT)/1e6}}isQueryAvailable(t,n){if(n===0)return!0;if(n===2){const r=this.gl,i=this.getQueryTimerExtensionWebGL2(),s=r.getQueryParameter(t,r.QUERY_RESULT_AVAILABLE);return this.disjoint==null&&(this.disjoint=this.gl.getParameter(i.GPU_DISJOINT_EXT)),s&&!this.disjoint}else{const r=this.getQueryTimerExtensionWebGL1(),i=r.getQueryObjectEXT(t,r.QUERY_RESULT_AVAILABLE_EXT);return this.disjoint==null&&(this.disjoint=this.gl.getParameter(r.GPU_DISJOINT_EXT)),i&&!this.disjoint}}pollFence(t){return new Promise(n=>{this.addItemToPoll(()=>t.isFencePassed(),()=>n())})}pollItems(){const t=_5e(this.itemsToPoll.map(n=>n.isDoneFn));for(let n=0;n<=t;++n){const{resolveFn:r}=this.itemsToPoll[n];r()}this.itemsToPoll=this.itemsToPoll.slice(t+1)}addItemToPoll(t,n){if(this.itemsToPoll.push({isDoneFn:t,resolveFn:n}),this.itemsToPoll.length>1)return;let r;"setTimeoutCustom"in K().platform&&(r=K().platform.setTimeoutCustom.bind(K().platform)),RR(()=>(this.pollItems(),this.itemsToPoll.length===0),()=>0,null,r)}bindTextureToFrameBuffer(t){this.throwIfDisposed(),f3(this.gl,t,this.framebuffer),this.debug&&OC(this.gl)}unbindTextureToFrameBuffer(){this.outputTexture!=null?(f3(this.gl,this.outputTexture,this.framebuffer),this.debug&&OC(this.gl)):gG(this.gl,this.framebuffer)}downloadMatrixDriver(t,n){this.bindTextureToFrameBuffer(t);const r=n();return this.unbindTextureToFrameBuffer(),r}setOutputMatrixTextureDriver(t,n,r){this.throwIfDisposed();const i=this.gl;f3(i,t,this.framebuffer),this.debug&&OC(i),this.outputTexture=t,Ee(i,()=>i.viewport(0,0,n,r)),Ee(i,()=>i.scissor(0,0,n,r))}setOutputMatrixWriteRegionDriver(t,n,r,i){this.throwIfDisposed(),Ee(this.gl,()=>this.gl.scissor(t,n,r,i))}throwIfDisposed(){if(this.disposed)throw new Error("Attempted to use disposed GPGPUContext.")}throwIfNoProgram(){if(this.program==null)throw new Error("No GPU program is currently set.")}}function _5e(e){let t=0;for(;t<e.length&&e[t]();++t);return t-1}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const{addImpl:A5e,bincountImpl:Loe,bincountReduceImpl:T5e,bitwiseAndImpl:I5e,castImpl:D5e,ceilImpl:N5e,concatImpl:F5e,equalImpl:O5e,expImpl:R5e,expm1Impl:M5e,floorImpl:L5e,gatherNdImpl:P5e,gatherV2Impl:B5e,greaterImpl:z5e,greaterEqualImpl:U5e,lessImpl:j5e,lessEqualImpl:W5e,linSpaceImpl:V5e,logImpl:G5e,maxImpl:H5e,maximumImpl:q5e,minimumImpl:X5e,multiplyImpl:Y5e,negImpl:K5e,notEqualImpl:Z5e,prodImpl:J5e,raggedGatherImpl:Q5e,raggedRangeImpl:e6e,raggedTensorToTensorImpl:t6e,rangeImpl:n6e,rsqrtImpl:r6e,scatterImpl:i6e,sigmoidImpl:s6e,simpleAbsImpl:Poe,sliceImpl:o6e,sparseFillEmptyRowsImpl:a6e,sparseReshapeImpl:u6e,sparseSegmentReductionImpl:Boe,sqrtImpl:l6e,staticRegexReplaceImpl:c6e,stridedSliceImpl:f6e,stringNGramsImpl:h6e,stringSplitImpl:d6e,stringToHashBucketFastImpl:p6e,subImpl:g6e,tileImpl:m6e,topKImpl:y6e,transposeImpl:d6,uniqueImpl:b6e}=wOe;/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zoe(e,t){return["x","y","z","w","u","v"].slice(0,t).map(n=>`${e}.${n}`)}function pi(e,t){return t===1?[e]:zoe(e,t)}function x6e(e,t){if(e===1)return"rc";let n="";for(let r=0;r<e;r++)n+=t[r],r<e-1&&(n+=",");return n}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class v6e{constructor(t){if(this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outputShape=t,this.rank=t.length,this.enableShapeUniforms=Jr(this.outputShape.length),this.rank===0)this.userCode=`
        void main() {
          setOutput(vec4(getA(), 0., 0., 0.));
        }
      `;else{const n=pi("rc",this.rank),r=Gt(this.rank),i=this.getOutOfBoundsCondition(n),s=this.getSetup(n),o=this.getOutput(n);this.userCode=`
        void main() {
          ${r} rc = getOutputCoords();

          if(${i}) {
            setOutput(vec4(0));
          } else {
            ${s}

            setOutput(vec4(${o}));
          }
        }
      `}}getSourceCoordsArr(t){const n=[];for(let r=0;r<=1;r++)for(let i=0;i<=1;i++){let s=`${r===0?"r":"rp1"}, ${i===0?"c":"cp1"}`;for(let o=2;o<this.rank;o++)s=`${t[t.length-1-o]},`+s;n.push(s)}return n}getOutOfBoundsCondition(t){if(this.rank===1)return`rc > ${this.enableShapeUniforms?"outShape":this.outputShape[0]}`;let n="";for(let r=this.rank-2;r<this.rank;r++)n+=`${t[r]} >= ${this.enableShapeUniforms?`outShape[${r}]`:this.outputShape[r]}`,r<this.rank-1&&(n+="||");return n}getSetup(t){if(this.rank===1)return"";const n=t.slice(-2),r=this.enableShapeUniforms?`outShape[${this.rank} - 1]`:this.outputShape[this.rank-1],i=this.enableShapeUniforms?`outShape[${this.rank} - 2]`:this.outputShape[this.rank-2];return`
      int r = ${n[0]};
      int c = ${n[1]};
      int rp1 = r + 1;
      int cp1 = c + 1;

      bool cEdge = cp1 >= ${r};
      bool rEdge = rp1 >= ${i};
    `}getOutput(t){const n=this.getSourceCoordsArr(t);return this.rank===1?`getA(rc), (rc + 1 >= ${this.enableShapeUniforms?"outShape":this.outputShape[0]} ? 0. : getA(rc + 1)), 0, 0`:`getA(${n[0]}),
            cEdge ? 0. : getA(${n[1]}),
            rEdge ? 0. : getA(${n[2]}),
            rEdge || cEdge ? 0. : getA(${n[3]})`}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Uoe{constructor(t,n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"inputShape",type:"ivec3"}],this.outputShape=t,this.enableShapeUniforms=Jr(this.outputShape.length);let r="";for(let i=0;i<4;i++){let s="thisRC = rc;";i%2===1&&(s+="thisRC.z += 1;"),i>1&&(s+="thisRC.y += 1;"),r+=`
        ${s}
        ${i>0?"if(thisRC.y < rows && thisRC.z < cols){":""}
          int flatIndex = getFlatIndex(thisRC);

          ivec3 inputRC = inputCoordsFromReshapedOutCoords(flatIndex);
          vec2 inputRCInnerDims = vec2(float(inputRC.y),float(inputRC.z));

          result[${i}] =
            getChannel(getA(inputRC.x, inputRC.y, inputRC.z), inputRCInnerDims);
        ${i>0?"}":""}
      `}this.userCode=`
      ${w6e(n,this.enableShapeUniforms)}
      ${this.enableShapeUniforms?f6():c6(t)}

      void main() {
        ivec3 rc = getOutputCoords();

        vec4 result = vec4(0.);

        ivec3 thisRC;
        int rows = ${this.enableShapeUniforms?"outShape[1]":t[1]};
        int cols = ${this.enableShapeUniforms?"outShape[2]":t[2]};

        ${r}

        setOutput(result);
      }
    `}}function w6e(e,t){return`
    ivec3 inputCoordsFromReshapedOutCoords(int index) {
      ${t?xBe(["r","c","d"],"inputShape"):hg(["r","c","d"],e)}
      return ivec3(r, c, d);
    }
  `}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class $6e{constructor(t){this.gpgpu=t,this.numUsedTextures=0,this.numFreeTextures=0,this._numBytesAllocated=0,this._numBytesFree=0,this.freeTextures={},this.usedTextures={},this.logEnabled=!1}acquireTexture(t,n,r){const i=vG(n,r),s=wG(t,i,r);s in this.freeTextures||(this.freeTextures[s]=[]),s in this.usedTextures||(this.usedTextures[s]=[]);const o=xG(t,i,this.gpgpu.gl,this.gpgpu.textureConfig,r);if(this.freeTextures[s].length>0){this.numFreeTextures--,this.numUsedTextures++,this._numBytesFree-=o,this.log();const u=this.freeTextures[s].pop();return this.usedTextures[s].push(u),u}let a;return i===wr.PACKED_2X2_FLOAT32?a=this.gpgpu.createPackedMatrixTexture(t[0],t[1]):i===wr.PACKED_2X2_FLOAT16?a=this.gpgpu.createFloat16PackedMatrixTexture(t[0],t[1]):i===wr.UNPACKED_FLOAT32?a=this.gpgpu.createFloat32MatrixTexture(t[0],t[1]):i===wr.UNPACKED_FLOAT16?a=this.gpgpu.createFloat16MatrixTexture(t[0],t[1]):i===wr.PACKED_4X1_UNSIGNED_BYTE&&(a=this.gpgpu.createUnsignedBytesMatrixTexture(t[0],t[1])),this.usedTextures[s].push(a),this.numUsedTextures++,this._numBytesAllocated+=o,this.log(),a}releaseTexture(t,n,r,i){if(this.freeTextures==null)return;const s=vG(r,i),o=wG(n,s,i);o in this.freeTextures||(this.freeTextures[o]=[]);const a=xG(n,s,this.gpgpu.gl,this.gpgpu.textureConfig,i),u=K().getNumber("WEBGL_DELETE_TEXTURE_THRESHOLD");u!==-1&&this._numBytesAllocated>u?(this.gpgpu.deleteMatrixTexture(t.texture),this._numBytesAllocated-=a):(this.freeTextures[o].push(t),this.numFreeTextures++,this._numBytesFree+=a),this.numUsedTextures--;const l=this.usedTextures[o],c=l&&l.indexOf(t);if(c==null||c<0)throw new Error("Cannot release a texture that was never provided by this texture manager");l[c]=l[l.length-1],l.pop(),this.log()}log(){if(!this.logEnabled)return;const t=this.numFreeTextures+this.numUsedTextures;console.log("Free/Used",`${this.numFreeTextures} / ${this.numUsedTextures}`,`(${t})`);const n=this._numBytesFree/this._numBytesAllocated;console.log(`Bytes allocated: ${this._numBytesAllocated}`),console.log(`Bytes unused: ${this._numBytesFree} (${Math.round(100*n)}%)`)}get numBytesAllocated(){return this._numBytesAllocated}get numBytesFree(){return this._numBytesFree}getNumUsedTextures(){return this.numUsedTextures}getNumFreeTextures(){return this.numFreeTextures}dispose(){if(this.freeTextures!=null){for(const t in this.freeTextures)this.freeTextures[t].forEach(n=>{this.gpgpu.deleteMatrixTexture(n.texture)});for(const t in this.usedTextures)this.usedTextures[t].forEach(n=>{this.gpgpu.deleteMatrixTexture(n.texture)});this.freeTextures=null,this.usedTextures=null,this.numUsedTextures=0,this.numFreeTextures=0,this._numBytesAllocated=0,this._numBytesFree=0}}}function C6e(e,t){const n=e;if(t===n.R32F)return 4;if(t===n.R16F)return 2;if(t===n.RGBA32F)return 16;if(t===e.RGBA)return 16;if(t===n.RGBA16F)return 8;if(t===n.RGBA8)return 4;throw new Error(`Unknown internal format ${t}`)}function xG(e,t,n,r,i){const s=S6e(t,r);let o;if(i){const[u,l]=H1(e[0],e[1]);o=u*l}else{const[u,l]=Kw(e[0],e[1]);o=u*l}const a=C6e(n,s);return o*a}function S6e(e,t){switch(e){case wr.PACKED_2X2_FLOAT32:return Roe(t);case wr.PACKED_2X2_FLOAT16:return Moe(t);case wr.UNPACKED_FLOAT32:return Noe(t);case wr.UNPACKED_FLOAT16:return Foe(t);case wr.PACKED_4X1_UNSIGNED_BYTE:return Ooe(t);default:throw new Error(`Unknown physical texture type ${e}`)}}function k6e(e){return K().getBool("WEBGL_RENDER_FLOAT32_ENABLED")?e?wr.PACKED_2X2_FLOAT32:wr.UNPACKED_FLOAT32:e?wr.PACKED_2X2_FLOAT16:wr.UNPACKED_FLOAT16}function vG(e,t){if(e===Ks.UPLOAD)return wr.PACKED_2X2_FLOAT32;if(e===Ks.RENDER||e==null)return k6e(t);if(e===Ks.DOWNLOAD||e===Ks.PIXELS)return wr.PACKED_4X1_UNSIGNED_BYTE;throw new Error(`Unknown logical texture type ${e}`)}function wG(e,t,n){return`${e[0]}_${e[1]}_${t}_${n}`}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class xu{constructor(t,n){this.variableNames=["A"],this.outputShape=t,this.enableShapeUniforms=Jr(this.outputShape.length),this.userCode=`
      float unaryOperation(float x) {
        ${n}
      }

      void main() {
        float x = getAAtOutCoords();
        float y = unaryOperation(x);

        setOutput(y);
      }
    `}}const Xo="if (isnan(x)) return x;",E6e="return x;",$G="return abs(x);",_6e="return (x >= 0.0) ? x : (exp(x) - 1.0);",A6e=Xo+`
  return (x < 0.0) ? 0.0 : x;
`,T6e=Xo+`
  return (x < 0.0) ? 0.0 : min(6.0, x);
`,qc="return x;",I6e="return 1.0 / (1.0 + exp(-1.0 * x));";/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const D6e="return x;",N6e=`
  vec4 result;

  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);
  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);
  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);
  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);

  return result;
`,F6e=`
  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,O6e=`
  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,R6e="return 1.0 / (1.0 + exp(-1.0 * x));";class sf{constructor(t,n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t,this.enableShapeUniforms=Jr(this.outputShape.length),this.userCode=`
      vec4 unaryOperation(vec4 x) {
        ${n}
      }

      void main() {
        vec4 x = getAAtOutCoords();
        vec4 y = unaryOperation(x);

        setOutput(y);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class M6e{constructor(t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outputShape=t,this.enableShapeUniforms=Jr(this.outputShape.length);const n=t.length,r=pi("rc",n),i=Gt(n),s=x6e(n,r),o=r.slice(-2),a=n<=1?"rc":`vec2(${o.join(",")})`;this.userCode=`
      void main() {
        ${i} rc = getOutputCoords();
        vec4 packedInput = getA(${s});

        setOutput(getChannel(packedInput, ${a}));
      }
    `}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const L6e=iI,P6e=1e-7,B6e=1e-4,LC={};function z6e(e){return e in LC||(LC[e]={}),LC[e]}const U6e=K().getNumber("CPU_HANDOFF_SIZE_THRESHOLD"),j6e=600;function W6e(){return K().global.screen==null?1024:K().global.screen.height*K().global.screen.width*window.devicePixelRatio*j6e/1024/1024}class DI extends AA{nextDataId(){return DI.nextDataId++}constructor(t){if(super(),this.pendingRead=new WeakMap,this.pendingDisposal=new WeakSet,this.dataRefCount=new WeakMap,this.numBytesInGPU=0,this.uploadWaitMs=0,this.downloadWaitMs=0,this.lastGlFlushTime=0,this.warnedAboutMemory=!1,this.pendingDeletes=0,this.disposed=!1,!K().getBool("HAS_WEBGL"))throw new Error("WebGL is not supported on this device");let n;if(t!=null){if(t instanceof p3)n=t;else{const r=Fa(K().getNumber("WEBGL_VERSION"),t);n=new p3(r)}this.binaryCache={},this.gpgpuCreatedLocally=!1}else{const r=Fa(K().getNumber("WEBGL_VERSION"));n=new p3(r),this.binaryCache=z6e(K().getNumber("WEBGL_VERSION")),this.gpgpuCreatedLocally=!0}this.gpgpu=n,this.canvas=this.gpgpu.gl.canvas,this.textureManager=new $6e(this.gpgpu),this.numMBBeforeWarning=W6e(),this.texData=new KP(this,aa())}numDataIds(){return this.texData.numDataIds()-this.pendingDeletes}writeTexture(t,n,r,i,s,o){const a=this.makeTensorInfo(n,r),u=this.texData.get(a.dataId);u.isPacked=!1,u.texture={texture:t,texShape:[i,s]},u.texShape=[i,s];const l=RC(n),c=new bG(l,!1,o),f=this.runWebGLProgram(c,[a],r,[[i,s]]);return f.shape=n,u.texture=null,this.disposeIntermediateTensorInfo(a),f.dataId}write(t,n,r){if((K().getBool("WEBGL_CHECK_NUMERICAL_PROBLEMS")||K().getBool("DEBUG"))&&this.checkNumericalProblems(t),r==="complex64"&&t!=null)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");const i={id:this.nextDataId()};return this.texData.set(i,{shape:n,dtype:r,values:t,usage:Ks.UPLOAD,refCount:1}),i}refCount(t){return this.texData.has(t)?this.texData.get(t).refCount:0}incRef(t){const n=this.texData.get(t);n.refCount++}decRef(t){if(this.texData.has(t)){const n=this.texData.get(t);n.refCount--}}move(t,n,r,i,s){if(K().getBool("DEBUG")&&this.checkNumericalProblems(n),i==="complex64")throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");this.texData.set(t,{shape:r,dtype:i,values:n,usage:Ks.UPLOAD,refCount:s})}disposeIntermediateTensorInfo(t){this.disposeData(t.dataId)}readSync(t){const n=this.texData.get(t),{values:r,dtype:i,complexTensorInfos:s,slice:o,shape:a,isPacked:u}=n;if(o!=null){let h;u?h=new sf(a,qc):h=new xu(a,qc);const d=this.runWebGLProgram(h,[{dataId:t,shape:a,dtype:i}],i),p=this.readSync(d.dataId);return this.disposeIntermediateTensorInfo(d),p}if(r!=null)return this.convertAndCacheOnCPU(t);if(i==="string")return r;const l=this.activeTimers!=null;let c;l&&(c=ui());let f;if(i==="complex64"){const h=this.readSync(s.real.dataId),d=this.readSync(s.imag.dataId);f=uc(h,d)}else f=this.getValuesFromTexture(t);return l&&(this.downloadWaitMs+=ui()-c),this.convertAndCacheOnCPU(t,f)}async read(t){if(this.pendingRead.has(t)){const p=this.pendingRead.get(t);return new Promise(g=>p.push(g))}const n=this.texData.get(t),{values:r,shape:i,slice:s,dtype:o,complexTensorInfos:a,isPacked:u}=n;if(s!=null){let p;u?p=new sf(i,qc):p=new xu(i,qc);const g=this.runWebGLProgram(p,[{dataId:t,shape:i,dtype:o}],o),m=this.read(g.dataId);return this.disposeIntermediateTensorInfo(g),m}if(r!=null)return this.convertAndCacheOnCPU(t);if(K().getBool("DEBUG")&&!K().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")&&K().getNumber("WEBGL_VERSION")===2)throw new Error("tensor.data() with WEBGL_DOWNLOAD_FLOAT_ENABLED=false and WEBGL_VERSION=2 not yet supported.");let l=null,c;if(o!=="complex64"&&K().get("WEBGL_BUFFER_SUPPORTED")){c=this.decode(t);const p=this.texData.get(c.dataId);l=this.gpgpu.createBufferFromTexture(p.texture.texture,...NC(i))}this.pendingRead.set(t,[]),o!=="complex64"&&await this.gpgpu.createAndWaitForFence();let f;if(o==="complex64"){const p=await Promise.all([this.read(a.real.dataId),this.read(a.imag.dataId)]),g=p[0],m=p[1];f=uc(g,m)}else if(l==null)f=this.getValuesFromTexture(t);else{const p=te(i);f=this.gpgpu.downloadFloat32MatrixFromBuffer(l,p)}if(c!=null&&this.disposeIntermediateTensorInfo(c),l!=null){const p=this.gpgpu.gl;Ee(p,()=>p.deleteBuffer(l))}const h=this.convertAndCacheOnCPU(t,f),d=this.pendingRead.get(t);return this.pendingRead.delete(t),d.forEach(p=>p(h)),this.pendingDisposal.has(t)&&(this.pendingDisposal.delete(t),this.disposeData(t)&&aa().removeDataId(t,this),this.pendingDeletes--),h}readToGPU(t,n={}){const r=this.texData.get(t),{values:i,shape:s,slice:o,dtype:a,isPacked:u,texture:l}=r;if(a==="complex64")throw new Error("Does not support reading texture for complex64 dtype.");if(o!=null){let d;u?d=new sf(s,qc):d=new xu(s,qc);const p=this.runWebGLProgram(d,[{dataId:t,shape:s,dtype:a}],a),g=this.readToGPU(p,n);return this.disposeIntermediateTensorInfo(p),g}if(l==null)throw i!=null?new Error("Data is not on GPU but on CPU."):new Error("There is no data on GPU or CPU.");const c=this.decode(t,n.customTexShape),f=aa().makeTensorFromTensorInfo(c),h=this.texData.get(c.dataId);return Object.assign({tensorRef:f},h.texture)}bufferSync(t){const n=this.readSync(t.dataId);if(t.dtype==="string")try{const r=n.map(i=>oc(i));return rt(t.shape,t.dtype,r)}catch{throw new Error("Failed to decode encoded string bytes into utf-8")}return rt(t.shape,t.dtype,n)}checkNumericalProblems(t){if(t!=null)for(let n=0;n<t.length;n++){const r=t[n];if(!HPe(r))throw K().getBool("WEBGL_RENDER_FLOAT32_CAPABLE")?Error(`The value ${r} cannot be represented with your current settings. Consider enabling float32 rendering: 'tf.env().set('WEBGL_RENDER_FLOAT32_ENABLED', true);'`):Error(`The value ${r} cannot be represented on this device.`)}}getValuesFromTexture(t){const{shape:n,dtype:r,isPacked:i}=this.texData.get(t),s=te(n);if(K().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")){const h=this.decode(t),d=this.texData.get(h.dataId),p=this.gpgpu.downloadMatrixFromPackedTexture(d.texture.texture,...NC(n)).subarray(0,s);return this.disposeIntermediateTensorInfo(h),p}const o=K().getBool("WEBGL_PACK")&&i===!0,a=o?RC(n):n,u=o?new u5e(a):new a5e(a),l=this.runWebGLProgram(u,[{shape:a,dtype:r,dataId:t}],"float32"),c=this.texData.get(l.dataId),f=this.gpgpu.downloadByteEncodedFloatMatrixFromOutputTexture(c.texture.texture,c.texShape[0],c.texShape[1]).subarray(0,s);return this.disposeIntermediateTensorInfo(l),f}timerAvailable(){return K().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0}time(t){const n=this.activeTimers,r=[];let i=!1;this.programTimersStack==null?(this.programTimersStack=r,i=!0):this.activeTimers.push(r),this.activeTimers=r,t();const s=Ou(this.activeTimers.map(u=>u.query)).filter(u=>u!=null),o=Ou(this.activeTimers.map(u=>u.name)).filter(u=>u!=null);this.activeTimers=n,i&&(this.programTimersStack=null);const a={uploadWaitMs:this.uploadWaitMs,downloadWaitMs:this.downloadWaitMs,kernelMs:null,wallMs:null};return(async()=>{if(K().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0){const u=await Promise.all(s);a.kernelMs=hee(u),a.getExtraProfileInfo=()=>u.map((l,c)=>({name:o[c],ms:l})).map(l=>`${l.name}: ${l.ms}`).join(", ")}else a.kernelMs={error:"WebGL query timers are not supported in this environment."};return this.uploadWaitMs=0,this.downloadWaitMs=0,a})()}memory(){return{unreliable:!1,numBytesInGPU:this.numBytesInGPU,numBytesInGPUAllocated:this.textureManager.numBytesAllocated,numBytesInGPUFree:this.textureManager.numBytesFree}}startTimer(){return K().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?this.gpgpu.beginQuery():{startMs:ui(),endMs:null}}endTimer(t){return K().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?(this.gpgpu.endQuery(),t):(t.endMs=ui(),t)}async getQueryTime(t){if(K().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0)return this.gpgpu.waitForQueryAndGetTime(t);const n=t;return n.endMs-n.startMs}disposeData(t,n=!1){if(this.pendingDisposal.has(t))return!1;if(!this.texData.has(t))return!0;if(n?this.texData.get(t).refCount=0:this.texData.get(t).refCount--,!n&&this.texData.get(t).refCount>0)return!1;if(this.pendingRead.has(t))return this.pendingDisposal.add(t),this.pendingDeletes++,!1;this.releaseGPUData(t);const{complexTensorInfos:r}=this.texData.get(t);return r!=null&&(this.disposeData(r.real.dataId,n),this.disposeData(r.imag.dataId,n)),this.texData.delete(t),!0}releaseGPUData(t){const{texture:n,dtype:r,texShape:i,usage:s,isPacked:o,slice:a}=this.texData.get(t),u=a&&a.origDataId||t,l=this.dataRefCount.get(u);l>1?this.dataRefCount.set(u,l-1):(this.dataRefCount.delete(u),n!=null&&(this.numBytesInGPU-=this.computeBytes(i,r),this.textureManager.releaseTexture(n,i,s,o)));const c=this.texData.get(t);c.texture=null,c.texShape=null,c.isPacked=!1,c.slice=null}getTexture(t){return this.uploadToGPU(t),this.texData.get(t).texture.texture}getDataInfo(t){return this.texData.get(t)}shouldExecuteOnCPU(t,n=U6e){return K().getBool("WEBGL_CPU_FORWARD")&&t.every(r=>this.texData.get(r.dataId).texture==null&&te(r.shape)<n)}getGPGPUContext(){return this.gpgpu}where(t){Hs("tf.where() in webgl locks the UI thread. Call tf.whereAsync() instead");const n=t.dataSync();return L6e(t.shape,n)}packedUnaryOp(t,n,r){const i=new sf(t.shape,n),s=this.compileAndRun(i,[t],r);return aa().makeTensorFromTensorInfo(s)}abs(t){if(this.shouldExecuteOnCPU([t])&&t.dtype!=="complex64"){const i=Poe(this.texData.get(t.dataId).values);return this.makeOutput(t.shape,t.dtype,i)}if(K().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,$G,t.dtype);const n=new xu(t.shape,$G),r=this.compileAndRun(n,[t]);return aa().makeTensorFromTensorInfo(r)}makeTensorInfo(t,n,r){let i;if(n==="string"&&r!=null&&r.length>0&&mu(r[0])){const s=r.map(o=>wu(o));i=this.write(s,t,n)}else i=this.write(r,t,n);return this.texData.get(i).usage=null,{dataId:i,shape:t,dtype:n}}makeOutput(t,n,r){return aa().makeTensorFromTensorInfo(this.makeTensorInfo(t,n,r),this)}unpackTensor(t){const n=new M6e(t.shape);return this.runWebGLProgram(n,[t],t.dtype)}packTensor(t){const n=new v6e(t.shape),r=!0;return this.runWebGLProgram(n,[t],t.dtype,null,r)}packedReshape(t,n){const r=[e0(t.shape),...t0(t.shape)],i={dtype:t.dtype,shape:r,dataId:t.dataId},s=[e0(n),...t0(n)],o=new Uoe(s,r),a=!0,u=[r],l=this.runWebGLProgram(o,[i],t.dtype,u,a);return{dataId:l.dataId,shape:n,dtype:l.dtype}}decode(t,n){const r=this.texData.get(t),{isPacked:i,shape:s,dtype:o}=r;if(n!=null){const h=te(s),d=n[0]*n[1]*4;N(h<=d,()=>"customTexShape is too small. Row * Column * 4 should be equal or larger than the size of the tensor data.")}const a=RC(s);let u;i?u=new o5e(a):u=new s5e(a);const l=!0,c=[n??NC(a)],f=this.runWebGLProgram(u,[{shape:a,dtype:o,dataId:t}],o,c,l,n);return{dtype:o,shape:s,dataId:f.dataId}}runWebGLProgram(t,n,r,i,s=!1,o){const a=this.makeTensorInfo(t.outputShape,r),u=this.texData.get(a.dataId);if(t.packedOutput&&(u.isPacked=!0),t.outPackingScheme===ev.DENSE){const y=o??NC(t.outputShape);u.texShape=y.map(b=>b*2)}if(t.outTexUsage!=null&&(u.usage=t.outTexUsage),te(a.shape)===0)return u.values=hr(a.dtype,0),a;const l=[],c=n.map(y=>{if(y.dtype==="complex64")throw new Error("GPGPUProgram does not support complex64 input. For complex64 dtypes, please separate the program into real and imaginary parts.");let b=this.texData.get(y.dataId);if(b.texture==null){if(!t.packedInputs&&te(y.shape)<=K().getNumber("WEBGL_SIZE_UPLOAD_UNIFORM"))return{shape:y.shape,texData:null,isUniform:!0,uniformValues:b.values};t.packedInputs&&(b.isPacked=!0,b.shape=y.shape)}if(this.uploadToGPU(y.dataId),!!b.isPacked!=!!t.packedInputs)y=b.isPacked?this.unpackTensor(y):this.packTensor(y),l.push(y),b=this.texData.get(y.dataId);else if(b.isPacked&&!eE(b.shape,y.shape)){const v=y,x=y.shape;y.shape=b.shape,y=this.packedReshape(y,x),l.push(y),b=this.texData.get(y.dataId),v.shape=x}return{shape:y.shape,texData:b,isUniform:!1}});this.uploadToGPU(a.dataId);const f={shape:a.shape,texData:u,isUniform:!1},h=i5e(t,c,f),d=this.getAndSaveBinary(h,()=>n5e(this.gpgpu,t,c,f)),p=this.activeTimers!=null;let g;p&&(g=this.startTimer()),K().get("ENGINE_COMPILE_ONLY")||r5e(this.gpgpu,d,c,f,i),l.forEach(y=>this.disposeIntermediateTensorInfo(y)),p&&(g=this.endTimer(g),this.activeTimers.push({name:t.constructor.name,query:this.getQueryTime(g)}));const m=K().getNumber("WEBGL_FLUSH_THRESHOLD");if(m>0){const y=ui();y-this.lastGlFlushTime>m&&(this.gpgpu.gl.flush(),this.lastGlFlushTime=y)}if(!K().getBool("WEBGL_LAZILY_UNPACK")&&u.isPacked&&s===!1){const y=this.unpackTensor(a);return this.disposeIntermediateTensorInfo(a),y}return a}compileAndRun(t,n,r,i,s=!1){return r=r||n[0].dtype,this.runWebGLProgram(t,n,r,i,s)}getAndSaveBinary(t,n){return t in this.binaryCache||(this.binaryCache[t]=n()),this.binaryCache[t]}getTextureManager(){return this.textureManager}dispose(){this.disposed||(K().getBool("IS_TEST")||Object.keys(this.binaryCache).forEach(n=>{this.gpgpu.deleteProgram(this.binaryCache[n].webGLProgram),delete this.binaryCache[n]}),this.textureManager.dispose(),this.canvas!=null&&typeof HTMLCanvasElement<"u"&&this.canvas instanceof HTMLCanvasElement?this.canvas.remove():this.canvas=null,this.gpgpuCreatedLocally&&(this.gpgpu.program=null,this.gpgpu.dispose()),this.disposed=!0)}floatPrecision(){return this.floatPrecisionValue==null&&(this.floatPrecisionValue=Z(()=>{if(!K().get("WEBGL_RENDER_FLOAT32_ENABLED")){const t=K().getBool("DEBUG");K().set("DEBUG",!1);const n=this.abs(qe(1e-8)).dataSync()[0];if(K().set("DEBUG",t),n>0)return 32}return 16})),this.floatPrecisionValue}epsilon(){return this.floatPrecision()===32?P6e:B6e}uploadToGPU(t){const n=this.texData.get(t),{shape:r,dtype:i,values:s,texture:o,usage:a,isPacked:u}=n;if(o!=null)return;const l=this.activeTimers!=null;let c;l&&(c=ui());let f=n.texShape;if(f==null&&(f=cBe(r,u),n.texShape=f),s!=null){const h=RC(r);let d,p=f[1],g=f[0];const m=s instanceof Uint8Array||s instanceof Uint8ClampedArray;(u||!m)&&([p,g]=H1(f[0],f[1])),u?d=new c5e(h,m):d=new bG(h,m);const y=m?[g,p]:f,b=this.makeTensorInfo(y,i),v=this.texData.get(b.dataId);m?v.usage=Ks.PIXELS:v.usage=Ks.UPLOAD,v.texShape=y,this.gpgpu.uploadDenseMatrixToTexture(this.getTexture(b.dataId),p,g,s);const x=[[g,p]],w=!0,C=this.runWebGLProgram(d,[b],i,x,w),$=this.texData.get(C.dataId);n.texShape=$.texShape,n.isPacked=$.isPacked,n.usage=$.usage,K().get("ENGINE_COMPILE_ONLY")?this.disposeData(C.dataId):(n.texture=$.texture,n.values=null,this.texData.delete(C.dataId)),this.disposeIntermediateTensorInfo(b),l&&(this.uploadWaitMs+=ui()-c)}else{const h=this.acquireTexture(f,a,i,u);n.texture=h}}convertAndCacheOnCPU(t,n){const r=this.texData.get(t),{dtype:i}=r;return n!=null&&(r.values=V6e(n,i)),r.values}acquireTexture(t,n,r,i){if(this.numBytesInGPU+=this.computeBytes(t,r),!this.warnedAboutMemory&&this.numBytesInGPU>this.numMBBeforeWarning*1024*1024){const s=(this.numBytesInGPU/1024/1024).toFixed(2);this.warnedAboutMemory=!0,console.warn(`High memory usage in GPU: ${s} MB, most likely due to a memory leak`)}return this.textureManager.acquireTexture(t,n,i)}computeBytes(t,n){return t[0]*t[1]*Rx(n)}checkCompileCompletion(){for(const[,t]of Object.entries(this.binaryCache))this.checkCompletion_(t)}async checkCompileCompletionAsync(){const t=[];if(this.gpgpu.parallelCompilationExtension){for(const[,n]of Object.entries(this.binaryCache))t.push(this.checkCompletionAsync_(n));return Promise.all(t)}else{for(const[,n]of Object.entries(this.binaryCache)){const r=new Promise(i=>{try{this.checkCompletion_(n),i(!0)}catch(s){throw s}});t.push(r)}return Promise.all(t)}}async checkCompletionAsync_(t){return this.gpgpu.gl.getProgramParameter(t.webGLProgram,this.gpgpu.parallelCompilationExtension.COMPLETION_STATUS_KHR)?this.checkCompletion_(t):(await c5(),this.checkCompletionAsync_(t))}checkCompletion_(t){if(this.gpgpu.gl.getProgramParameter(t.webGLProgram,this.gpgpu.gl.LINK_STATUS)===!1)throw console.log(this.gpgpu.gl.getProgramInfoLog(t.webGLProgram)),this.gpgpu.gl.getShaderParameter(t.fragmentShader,this.gpgpu.gl.COMPILE_STATUS)===!1?(Eoe(t.source,this.gpgpu.gl.getShaderInfoLog(t.fragmentShader)),new Error("Failed to compile fragment shader.")):new Error("Failed to link vertex and fragment shaders.");return!0}getUniformLocations(){for(const t of Object.values(this.binaryCache)){this.gpgpu.buildVao(t.webGLProgram);const{variablesLocations:n,customUniformLocations:r,infLoc:i,nanLoc:s,outShapeLocation:o,outShapeStridesLocation:a,outTexShapeLocation:u}=Doe(this.gpgpu,t.program,t.webGLProgram);t.variablesLocations=n,t.customUniformLocations=r,t.infLoc=i,t.nanLoc=s,t.outShapeLocation=o,t.outShapeStridesLocation=a,t.outTexShapeLocation=u}}createTensorFromGPUData(t,n,r){t.channels=t.channels||"RGBA";const{texture:i,height:s,width:o,channels:a}=t,u=aa().backend;if(!u.gpgpu.gl.isTexture(i))throw new Error("The texture is invalid. Also, please make sure the texture and the TFJS WebGL backend are using the same canvas. If you want to use your own custom canvas, you have to create and use the custom TFJS WebGL backend created from the canvas through 'new tf.MathBackendWebGL(customCanvas)'.");const l=u.writeTexture(i,n,r,s,o,a);return aa().makeTensorFromDataId(l,n,r,u)}}DI.nextDataId=0;function V6e(e,t){if(t==="float32"||t==="complex64")return e;if(t==="int32"||t==="bool"){const n=t==="int32"?new Int32Array(e.length):new Uint8Array(e.length);for(let r=0;r<n.length;++r)n[r]=Math.round(e[r]);return n}else throw new Error(`Unknown dtype ${t}`)}/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */aB()&&cB("webgl",()=>new DI,2);/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const p6=`
  if (isnan(a)) return a;
  if (isnan(b)) return b;
`;class Cp{constructor(t,n,r){this.variableNames=["A","B"],this.outputShape=Ze(n,r),this.enableShapeUniforms=Jr(this.outputShape.length),this.userCode=`
      float binaryOperation(float a, float b) {
        ${t}
      }

      void main() {
        float a = getAAtOutCoords();
        float b = getBAtOutCoords();
        setOutput(binaryOperation(a, b));
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const pg=`
  result.r = isNaN.r ? NAN : result.r;
  result.g = isNaN.g ? NAN : result.g;
  result.b = isNaN.b ? NAN : result.b;
  result.a = isNaN.a ? NAN : result.a;
`;class Z1{constructor(t,n,r,i=!1){this.variableNames=["A","B"],this.supportsBroadcasting=!0,this.packedInputs=!0,this.packedOutput=!0,this.outputShape=Ze(n,r);const s=this.outputShape.length;this.enableShapeUniforms=Jr(s);let o="";if(i)if(s===0||te(this.outputShape)===1)o=`
          result.y = 0.;
          result.z = 0.;
          result.w = 0.;
        `;else if(o=`
          ${Gt(s)} coords = getOutputCoords();
        `,s===1)this.enableShapeUniforms?o+=`
            result.y = (coords + 1) >= outShape ? 0. : result.y;
            result.z = 0.;
            result.w = 0.;
          `:o+=`
            result.y = (coords + 1) >= ${this.outputShape[0]} ? 0. : result.y;
            result.z = 0.;
            result.w = 0.;
          `;else{const u=pi("coords",s);this.enableShapeUniforms?o+=`
            bool nextRowOutOfBounds =
              (${u[s-2]} + 1) >= outShape[${s} - 2];
            bool nextColOutOfBounds =
              (${u[s-1]} + 1) >= outShape[${s} - 1];
            result.y = nextColOutOfBounds ? 0. : result.y;
            result.z = nextRowOutOfBounds ? 0. : result.z;
            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;
          `:o+=`
            bool nextRowOutOfBounds =
              (${u[s-2]} + 1) >= ${this.outputShape[s-2]};
            bool nextColOutOfBounds =
              (${u[s-1]} + 1) >= ${this.outputShape[s-1]};
            result.y = nextColOutOfBounds ? 0. : result.y;
            result.z = nextRowOutOfBounds ? 0. : result.z;
            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;
          `}this.userCode=`
      vec4 binaryOperation(vec4 a, vec4 b) {
        ${t}
      }

      void main() {
        vec4 a = getAAtOutCoords();
        vec4 b = getBAtOutCoords();

        vec4 result = binaryOperation(a, b);
        ${o}

        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ts(e){const{inputs:t,backend:n}=e,{x:r}=t;return n.incRef(r.dataId),{dataId:r.dataId,shape:r.shape,dtype:r.dtype}}const G6e={kernelName:h1,backendName:"webgl",kernelFunc:Ts};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Nh(e){const{inputs:t,backend:n}=e,{real:r,imag:i}=t,s=n.makeTensorInfo(r.shape,"complex64"),o=n.texData.get(s.dataId),a=Ts({inputs:{x:r},backend:n}),u=Ts({inputs:{x:i},backend:n});return o.complexTensorInfos={real:a,imag:u},s}const H6e={kernelName:PA,backendName:"webgl",kernelFunc:Nh};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const joe="return (a < 0.) ? b * a : a;",Woe=`
  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));
  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);
`;function q6e(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{alpha:s}=r,o=n.makeTensorInfo([],"float32",xc(s,"float32")),a=K().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Z1(Woe,i.shape,o.shape):new Cp(joe,i.shape,o.shape),u=n.runWebGLProgram(a,[i,o],"float32");return n.disposeIntermediateTensorInfo(o),u}const X6e={kernelName:X2,backendName:"webgl",kernelFunc:q6e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Voe="return (a < 0.) ? b * a : a;",Goe=`
  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));
  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);
`;function Y6e(e){const{inputs:t,backend:n}=e,{x:r,alpha:i}=t,s=K().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Z1(Goe,r.shape,i.shape):new Cp(Voe,r.shape,i.shape);return n.runWebGLProgram(s,[r,i],"float32")}const K6e={kernelName:dw,backendName:"webgl",kernelFunc:Y6e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const J1="if (isnan(x)) return x;";function vt({opSnippet:e,packedOpSnippet:t,cpuKernelImpl:n,dtype:r}){return({inputs:i,backend:s})=>{const{x:o}=i,a=s,u=r||o.dtype;if(a.shouldExecuteOnCPU([o])&&n!=null){const f=a.texData.get(o.dataId),h=n(f.values,u);return a.makeTensorInfo(o.shape,u,h)}const l=K().getBool("WEBGL_PACK_UNARY_OPERATIONS")&&t!=null;let c;return l?c=new sf(o.shape,t):c=new xu(o.shape,e),a.runWebGLProgram(c,[o],u)}}function Mr({opSnippet:e,packedOpSnippet:t,checkOutOfBounds:n=!1,supportsComplex:r=!1,cpuKernelImpl:i,dtype:s}){return({inputs:o,backend:a})=>{const{a:u,b:l}=o,c=a;if(r&&u.dtype==="complex64"){const p=c.texData.get(u.dataId),g=c.texData.get(l.dataId),[m,y]=[[p.complexTensorInfos.real,g.complexTensorInfos.real],[p.complexTensorInfos.imag,g.complexTensorInfos.imag]].map(v=>{const[x,w]=v,C={dataId:x.dataId,dtype:x.dtype,shape:u.shape},$={dataId:w.dataId,dtype:w.dtype,shape:l.shape},S=new Cp(e,u.shape,l.shape);return c.runWebGLProgram(S,[C,$],qi(x.dtype,w.dtype))}),b=Nh({inputs:{real:m,imag:y},backend:c});return c.disposeIntermediateTensorInfo(m),c.disposeIntermediateTensorInfo(y),b}const f=s||qi(u.dtype,l.dtype);if((u.dtype==="string"||l.dtype==="string"||c.shouldExecuteOnCPU([u,l]))&&i!=null){const p=c.texData.get(u.dataId).values,g=c.texData.get(l.dataId).values,m=u.dtype==="string"?lc(p):p,y=u.dtype==="string"?lc(g):g,[b,v]=i(u.shape,l.shape,m,y,f),x=c.makeTensorInfo(v,f),w=c.texData.get(x.dataId);return w.values=b,x}const h=K().getBool("WEBGL_PACK_BINARY_OPERATIONS")&&t!=null;let d;return h?d=new Z1(t,u.shape,l.shape,n):d=new Cp(e,u.shape,l.shape),c.runWebGLProgram(d,[u,l],f)}}function tv(e,t=!1){if(e==="linear")return t?D6e:E6e;if(e==="relu")return t?F6e:A6e;if(e==="elu")return t?N6e:_6e;if(e==="relu6")return t?O6e:T6e;if(e==="prelu")return t?Goe:Voe;if(e==="leakyrelu")return t?Woe:joe;if(e==="sigmoid")return t?R6e:I6e;throw new Error(`Activation ${e} has not been implemented for the WebGL backend.`)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Hoe{constructor(t,n,r,i=!1,s=!1,o=!1,a=null,u=!1,l=!1){this.variableNames=["matrixA","matrixB"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=r,this.enableShapeUniforms=Jr(this.outputShape.length);const c=i?t[1]:t[2],f=Math.ceil(c/2),h=i?"i * 2, rc.y":"rc.y, i * 2",d=s?"rc.z, i * 2":"i * 2, rc.z",p=i?["a.xxyy","a.zzww"]:["a.xxzz","a.yyww"],g=s?["b.xzxz","b.ywyw"]:["b.xyxy","b.zwzw"];let m="",y="";a&&(u?m=`vec4 activation(vec4 a) {
          vec4 b = getPreluActivationWeightsAtOutCoords();
          ${a}
        }`:l?m=`vec4 activation(vec4 a) {
          vec4 b = getLeakyreluAlphaAtOutCoords();
          ${a}
        }`:m=`vec4 activation(vec4 x) {
          ${a}
        }`,y="result = activation(result);");const b=o?"result += getBiasAtOutCoords();":"";o&&this.variableNames.push("bias"),u&&this.variableNames.push("preluActivationWeights"),l&&this.variableNames.push("leakyreluAlpha");let v="rc.x",x="rc.x";t[0]<n[0]?v=`imod(rc.x, ${t[0]})`:n[0]<t[0]&&(x=`imod(rc.x, ${n[0]})`),this.userCode=`
      ${m}
      // Don't use uniform for sharedDimensionPacked for performance.
      const float sharedDimension = ${f}.0;

      vec4 dot2x2ARowBCol(ivec3 rc) {
        vec4 result = vec4(0);
        int batchA = ${v};
        int batchB = ${x};
        for (int i = 0; i < ${f}; i++) {
          vec4 a = getMatrixA(batchA, ${h});
          vec4 b = getMatrixB(batchB, ${d});

          // These swizzled products need to be separately added.
          // See: https://github.com/tensorflow/tfjs/issues/1735
          result += (${p[0]} * ${g[0]});
          result += (${p[1]} * ${g[1]});
        }
        return result;
      }

      void main() {
        ivec3 rc = getOutputCoords();
        vec4 result = dot2x2ARowBCol(rc);

        ${b}

        ${y}

        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const CG={REAL:"return areal * breal - aimag * bimag;",IMAG:"return areal * bimag + aimag * breal;"};class SG{constructor(t,n,r){this.variableNames=["AReal","AImag","BReal","BImag"],this.outputShape=Ze(n,r),this.userCode=`
      float binaryOpComplex(
          float areal, float aimag, float breal, float bimag) {
        ${t}
      }

      void main() {
        float areal = getARealAtOutCoords();
        float aimag = getAImagAtOutCoords();
        float breal = getBRealAtOutCoords();
        float bimag = getBImagAtOutCoords();
        setOutput(binaryOpComplex(areal, aimag, breal, bimag));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const kG="return a * b;";function g6(e){const{inputs:t,backend:n}=e,{a:r,b:i}=t,s=qi(r.dtype,i.dtype);if(r.dtype==="complex64"){const a=n.texData.get(r.dataId),u=n.texData.get(i.dataId),l=new SG(CG.REAL,r.shape,i.shape),c=new SG(CG.IMAG,r.shape,i.shape),f=[{dataId:a.complexTensorInfos.real.dataId,dtype:a.complexTensorInfos.real.dtype,shape:r.shape},{dataId:a.complexTensorInfos.imag.dataId,dtype:a.complexTensorInfos.imag.dtype,shape:r.shape},{dataId:u.complexTensorInfos.real.dataId,dtype:u.complexTensorInfos.real.dtype,shape:i.shape},{dataId:u.complexTensorInfos.imag.dataId,dtype:u.complexTensorInfos.imag.dtype,shape:i.shape}],h=n.runWebGLProgram(l,f,"float32"),d=n.runWebGLProgram(c,f,"float32"),p=Nh({inputs:{real:h,imag:d},backend:n});return n.disposeIntermediateTensorInfo(h),n.disposeIntermediateTensorInfo(d),p}if(n.shouldExecuteOnCPU([r,i])){const a=n.texData.get(r.dataId),u=n.texData.get(i.dataId),[l,c]=Y5e(r.shape,i.shape,a.values,u.values,s),f=n.makeTensorInfo(c,s),h=n.texData.get(f.dataId);return h.values=l,f}let o;return K().getBool("WEBGL_PACK_BINARY_OPERATIONS")?o=new Z1(kG,r.shape,i.shape):o=new Cp(kG,r.shape,i.shape),n.runWebGLProgram(o,[r,i],s)}const Z6e={kernelName:w1,backendName:"webgl",kernelFunc:g6};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function J6e(e,t,n){const r=[e0(e.shape),...t0(e.shape)],i={dtype:e.dtype,shape:r,dataId:e.dataId},s=[e0(t),...t0(t)],o=new Uoe(s,r),a=!0,u=[r],l=n.runWebGLProgram(o,[i],e.dtype,u,a);return{dataId:l.dataId,shape:t,dtype:l.dtype}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ce(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{shape:s}=r,o=n,a=te(i.shape),u=JP(s,a),l=te(u);N(a===l,()=>`The new shape (${u}) has ${l} elements and the old shape (${i.shape}) has ${a} elements. The new shape and old shape must have the same number of elements.`);const c=o.texData.get(i.dataId);return c.isPacked&&!eE(i.shape,u)&&!(c.texture!==null&&eE(c.shape,u))?J6e(i,u,o):(o.incRef(i.dataId),{dataId:i.dataId,shape:u,dtype:i.dtype})}const Q6e={kernelName:gw,backendName:"webgl",kernelFunc:Ce};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class EG{constructor(t,n){this.variableNames=["x"];const{windowSize:r,batchSize:i,inSize:s,outSize:o}=t;this.outputShape=[i,o];const a=Math.floor(r/4)*4,u=r%4;let l="sumValue += dot(values, ones);";if(n!=null){const f=1/n;l=`sumValue += dot(values * ${dp(f)?f.toPrecision(2):f}, ones);`}let c="";s%r>0&&(c=`
        if (inIdx < 0 || inIdx >= ${s}) {
          return 0.0;
        }
      `),this.userCode=`
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float getValue(int batch, int inIdx) {
        ${c}
        return getX(batch, inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * ${r};

        float sumValue = 0.0;

        for (int i = 0; i < ${a}; i += 4) {
          int inIdx = inOffset + i;
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          ${l}
        }

        int inIdx = inOffset + ${a};
        if (${u===1}) {
          vec4 values = vec4(getValue(batch, inIdx), 0.0, 0.0, 0.0);

          ${l}
        } else if (${u===2}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1), 0.0, 0.0);

          ${l}
        } else if (${u===3}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2), 0.0);

          ${l}
        }
        setOutput(sumValue);
      }
    `}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class eze{constructor(t,n){this.variableNames=["x"];const{windowSize:r,batchSize:i,inSize:s,outSize:o}=t;this.outputShape=[i,o];let a="0.0",u="";n==="prod"?a="1.0":n==="min"?(a="1.0 / 1e-20",u="min"):n==="max"&&(a="-1.0 / 1e-20",u="max");let l=`${n}(${n}(${n}(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])`;n==="sum"?l="sumValue":n==="prod"?l="prodValue":n==="all"?l="allValue":n==="any"&&(l="anyValue");const c=Math.floor(r/4)*4,f=r%4;let h=`
      if (${n==="sum"}) {
        sumValue += dot(values, ones);
      } else if (${n==="prod"}) {
        vec2 tmp = vec2(values[0], values[1]) * vec2(values[2], values[3]);
        prodValue *= tmp[0] * tmp[1];
      } else {
        minMaxValue = ${u}(values, minMaxValue);
        if (${n==="min"} || ${n==="max"}) {
          minMaxValue = ${u}(values, minMaxValue);
          bvec4 isNaN = isnan(values);
          if (isNaN.r || isNaN.g || isNaN.b || isNaN.a) {
            minMaxValue = vec4(NAN);
          }
        }
      }
    `,d="vec4";n==="all"?(a="1.0",h=`
        bool reducedAllValue = all(values);
        float floatedReducedAllValue = float(reducedAllValue);
        allValue = float(allValue >= 1.0 && floatedReducedAllValue >= 1.0);
      `,d="bvec4"):n==="any"&&(a="0.0",h=`
        bool reducedAnyValue = any(values);
        float floatedReducedAnyValue = float(reducedAnyValue);
        anyValue = float(anyValue >= 1.0 || floatedReducedAnyValue >= 1.0);
      `,d="bvec4");let p="";s%r>0&&(p=`
        if (inIdx < 0 || inIdx >= ${s}) {
          return initializationValue;
        }
      `),this.userCode=`
      const float initializationValue = ${a};
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float getValue(int batch, int inIdx) {
        ${p}
        return getX(batch, inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * ${r};

        vec4 minMaxValue = vec4(${a});
        float prodValue = 1.0;
        float sumValue = 0.0;
        float allValue = 1.0;
        float anyValue = 0.0;

        for (int i = 0; i < ${c}; i += 4) {
          int inIdx = inOffset + i;
          ${d} values = ${d}(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          ${h}
        }

        int inIdx = inOffset + ${c};
        if (${f===1}) {
          ${d} values = ${d}(
            getValue(batch, inIdx),
            initializationValue,
            initializationValue,
            initializationValue
          );

          ${h}
        } else if (${f===2}) {
          ${d} values = ${d}(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            initializationValue,
            initializationValue
          );

          ${h}
        } else if (${f===3}) {
          ${d} values = ${d}(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            initializationValue
          );

          ${h}
        }
        setOutput(${l});
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tze(e){const t=[];for(;t.length===0||t[t.length-1].outSize!==1;){const n=t.length?t[t.length-1].outSize:e[1],r=gI(n);t.push({inSize:n,windowSize:r,outSize:Math.ceil(n/r)})}return t}function gg(e,t,n,r){const i=tze(e.shape);let s=e;for(let o=0;o<i.length;o++){const{inSize:a,windowSize:u,outSize:l}=i[o];let c,f;n==="mean"?c=o===0?new EG({windowSize:u,inSize:a,batchSize:e.shape[0],outSize:l},a):new EG({windowSize:u,inSize:a,batchSize:e.shape[0],outSize:l}):c=new eze({windowSize:u,inSize:a,batchSize:e.shape[0],outSize:l},n),f=s,s=r.runWebGLProgram(c,[s],t),f.dataId!==e.dataId&&r.disposeIntermediateTensorInfo(f)}return s}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class nze{constructor(t,n){this.variableNames=["A"];const r=new Array(t.length);for(let o=0;o<r.length;o++)r[o]=t[n[o]];this.outputShape=r,this.rank=r.length;const i=Gt(this.rank),s=rze(n);this.userCode=`
    void main() {
      ${i} resRC = getOutputCoords();
      setOutput(getA(${s}));
    }
    `}}function rze(e){const t=e.length;if(t>6)throw Error(`Transpose for rank ${t} is not yet supported`);const n=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u","resRC.v"],r=new Array(t);for(let i=0;i<e.length;i++)r[e[i]]=n[i];return r.join()}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class ize{constructor(t,n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0;const r=new Array(t.length);for(let c=0;c<r.length;c++)r[c]=t[n[c]];if(this.outputShape=r,this.rank=r.length,this.rank>6)throw Error(`Packed transpose for rank ${this.rank} is not yet supported.`);const i=Gt(this.rank),s=zoe("rc",this.rank),o=new Array(this.rank);for(let c=0;c<n.length;c++)o[n[c]]=s[c];const a=`vec2(${o.slice(-2).join()})`,u=`++${s[this.rank-1]} < ${r[this.rank-1]}`,l=`getChannel(getA(${o.join()}), ${a})`;this.userCode=`
    void main() {
      ${i} rc = getOutputCoords();
      vec4 result = vec4(0.);
      result[0] = ${l};
      if(${u}) {
        result[1] = ${l};
      }
      --${s[this.rank-1]};
      if(++${s[this.rank-2]} < ${r[this.rank-2]}) {
        result[2] = ${l};
        if(${u}) {
          result[3] = ${l};
        }
      }
      setOutput(result);
    }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function NI(e,t,n){const r=K().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new ize(e.shape,t):new nze(e.shape,t);return n.runWebGLProgram(r,[e],e.dtype)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sze(e,t,n,r){const i=t,s=e.shape.length,o=st(i,e.shape);let a=o;const u=Cn(a,s),l=u!=null;let c=e;l&&(c=NI(e,u,r),a=On(a.length,s)),Rr("sum",a,s);const[f,h]=pr(c.shape,a);let d=f;n&&(d=Fn(f,o));const p=te(h),m=te(e.shape)/p,y=Ce({inputs:{x:c},attrs:{shape:[m,p]},backend:r}),b=PT(e.dtype),v=gg(y,b,"sum",r),x=Ce({inputs:{x:v},attrs:{shape:d},backend:r});return r.disposeIntermediateTensorInfo(y),r.disposeIntermediateTensorInfo(v),l&&r.disposeIntermediateTensorInfo(c),x}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function FI(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{axis:s,keepDims:o}=r;return sze(i,s,o,n)}const oze={kernelName:ww,backendName:"webgl",kernelFunc:FI};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ii(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{perm:s}=r,o=n,a=i.shape.length,u=new Array(a);for(let c=0;c<u.length;c++)u[c]=i.shape[s[c]];let l;if(o.shouldExecuteOnCPU([i])){const f=o.texData.get(i.dataId).values,h=d6(f,i.shape,i.dtype,s,u);l=o.makeTensorInfo(u,i.dtype);const d=o.texData.get(l.dataId);d.values=h}else l=NI(i,s,o);return l}const aze={kernelName:Kd,backendName:"webgl",kernelFunc:Ii};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qoe=1e3;function tE({a:e,b:t,transposeA:n,transposeB:r,backend:i,bias:s=null,preluActivationWeights:o=null,leakyreluAlpha:a=0,activation:u=null}){const l=e.shape.length,c=t.shape.length,f=n?e.shape[l-2]:e.shape[l-1],h=r?t.shape[c-1]:t.shape[c-2],d=n?e.shape[l-1]:e.shape[l-2],p=r?t.shape[c-2]:t.shape[c-1],g=e.shape.slice(0,-2),m=t.shape.slice(0,-2),y=te(g),b=te(m),x=Ze(e.shape.slice(0,-2),t.shape.slice(0,-2)).concat([d,p]);N(f===h,()=>`Error in matMul: inner shapes (${f}) and (${h}) of Tensors with shapes ${e.shape} and ${t.shape} and transposeA=${n} and transposeB=${r} must match.`);const w=n?[y,f,d]:[y,d,f],C=r?[b,p,h]:[b,h,p],$=Ce({inputs:{x:e},backend:i,attrs:{shape:w}}),S=Ce({inputs:{x:t},backend:i,attrs:{shape:C}}),k=[$,S],E=Math.max(y,b),_=n?$.shape[1]:$.shape[2],D=s!=null,A=o!=null,T=u==="leakyrelu",I=u!=null?tv(u,!0):null,F=D||A||T||I!=null;let R;if((d===1||p===1)&&_>qoe&&F===!1){let P=$,q=S;n&&(P=Ii({inputs:{x:$},backend:i,attrs:{perm:[0,2,1]}}),k.push(P)),r&&(q=Ii({inputs:{x:S},backend:i,attrs:{perm:[0,2,1]}}),k.push(q));const X=p!==1,G=p===1;let J=P;X&&(J=Ce({inputs:{x:P},backend:i,attrs:{shape:[E,_,1]}}),k.push(J));const Q=p===1?2:1;let ee=q;G&&(ee=Ce({inputs:{x:q},backend:i,attrs:{shape:[E,1,_]}}),k.push(ee));const ue=g6({inputs:{a:J,b:ee},backend:i});R=FI({inputs:{x:ue},backend:i,attrs:{axis:Q,keepDims:!0}}),k.push(ue)}else{const P=qi(e.dtype,t.dtype),q=new Hoe(w,C,[E,d,p],n,r,D,I,A,T),X=[$,S];if(s!=null&&X.push(s),A&&X.push(o),T){const G=i.makeTensorInfo([],"float32",xc(a,"float32"));X.push(G),k.push(G)}R=i.runWebGLProgram(q,X,P)}const L=Ce({inputs:{x:R},backend:i,attrs:{shape:x}});k.push(R);for(const P of k)i.disposeIntermediateTensorInfo(P);return L}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uze(e){const{inputs:t,backend:n,attrs:r}=e,{a:i,b:s,bias:o,preluActivationWeights:a}=t,{transposeA:u,transposeB:l,activation:c,leakyreluAlpha:f}=r;return tE({a:i,b:s,transposeA:u,transposeB:l,backend:n,bias:o,preluActivationWeights:a,leakyreluAlpha:f,activation:c})}const lze={kernelName:Mx,backendName:"webgl",kernelFunc:uze};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _G="return abs(x);";function cze(e){const{inputs:t,backend:n}=e,{x:r}=t;if(n.shouldExecuteOnCPU([r])&&r.dtype!=="complex64"){const s=n.texData.get(r.dataId),o=Poe(s.values);return n.makeTensorInfo(r.shape,r.dtype,o)}let i;return K().getBool("WEBGL_PACK_UNARY_OPERATIONS")?i=new sf(r.shape,_G):i=new xu(r.shape,_G),n.runWebGLProgram(i,[r],r.dtype)}const fze={kernelName:E2,backendName:"webgl",kernelFunc:cze};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const hze=Xo+`
  if (abs(x) > 1.) {
    return NAN;
  }
  return acos(x);
`,dze=vt({opSnippet:hze}),pze={kernelName:H0,backendName:"webgl",kernelFunc:dze};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gze=Xo+`
  if (x < 1.0) return NAN;
return log(x + sqrt(x * x - 1.0));`,mze=vt({opSnippet:gze}),yze={kernelName:q0,backendName:"webgl",kernelFunc:mze};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const AG="return a + b;",bze=Mr({opSnippet:AG,packedOpSnippet:AG,supportsComplex:!0,cpuKernelImpl:A5e}),xze={kernelName:rg,backendName:"webgl",kernelFunc:bze};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class vze{constructor(t,n){this.outputShape=[],this.outputShape=t,this.variableNames=n.map((s,o)=>`T${o}`);const r=[];this.variableNames.forEach(s=>{r.push(`float v${s} = get${s}AtOutCoords();`)});const i=this.variableNames.map(s=>`v${s}`).join(" + ");this.userCode=`
      void main() {
        ${r.join(`
        `)}

        float result = ${i};
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class wze{constructor(t,n){this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t,this.variableNames=n.map((s,o)=>`T${o}`);const r=[];this.variableNames.forEach(s=>{r.push(`vec4 v${s} = get${s}AtOutCoords();`)});const i=this.variableNames.map(s=>`v${s}`).join(" + ");this.userCode=`
      void main() {
        ${r.join(`
        `)}

        vec4 result = ${i};
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function GS(e){const{inputs:t,backend:n}=e,r=t;if(r.length===1)return Ts({inputs:{x:r[0]},backend:n});if(r.length>K().getNumber("WEBGL_MAX_TEXTURES_IN_SHADER")){const u=Math.floor(r.length/2),l=GS({inputs:r.slice(0,u),backend:n}),c=GS({inputs:r.slice(u),backend:n});return GS({inputs:[l,c],backend:n})}const i=r.map(u=>u.dtype).reduce((u,l)=>qi(u,l)),s=r.map(u=>u.shape),a=K().getBool("WEBGL_PACK")?new wze(r[0].shape,s):new vze(r[0].shape,s);return n.runWebGLProgram(a,r,i)}const $ze={kernelName:_2,backendName:"webgl",kernelFunc:GS};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Cze(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{axis:s,keepDims:o}=r,a=i.shape.length,u=st(s,i.shape);let l=u;const c=Cn(l,a);let f=i;c!=null&&(f=Ii({inputs:{x:i},backend:n,attrs:{perm:c}}),l=On(l.length,a)),Rr("all",l,a);const[h,d]=pr(f.shape,l),p=te(d),g=Ce({inputs:{x:f},backend:n,attrs:{shape:[-1,p]}}),m=gg(g,g.dtype,"all",n);let y;if(o){const b=Fn(h,u);y=Ce({inputs:{x:m},backend:n,attrs:{shape:b}})}else y=Ce({inputs:{x:m},backend:n,attrs:{shape:h}});return n.disposeIntermediateTensorInfo(g),n.disposeIntermediateTensorInfo(m),c!=null&&n.disposeIntermediateTensorInfo(f),y}const Sze={kernelName:NA,backendName:"webgl",kernelFunc:Cze};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kze(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{axis:s,keepDims:o}=r,a=i.shape.length,u=st(s,i.shape);let l=u;const c=Cn(l,a);let f=i;c!=null&&(f=Ii({inputs:{x:i},backend:n,attrs:{perm:c}}),l=On(l.length,a)),Rr("any",l,a);const[h,d]=pr(f.shape,l),p=te(d),g=Ce({inputs:{x:f},backend:n,attrs:{shape:[-1,p]}}),m=gg(g,g.dtype,"any",n);let y;if(o){const b=Fn(h,u);y=Ce({inputs:{x:m},backend:n,attrs:{shape:b}})}else y=Ce({inputs:{x:m},backend:n,attrs:{shape:h}});return n.disposeIntermediateTensorInfo(g),n.disposeIntermediateTensorInfo(m),c!=null&&n.disposeIntermediateTensorInfo(f),y}const Eze={kernelName:FA,backendName:"webgl",kernelFunc:kze};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class _ze{constructor(t,n,r){this.variableNames=["A"];const{windowSize:i,batchSize:s,outSize:o}=t;r||this.variableNames.push("bestIndicesA"),this.outputShape=[s,o];const a=n==="max"?">":"<",u=r?"inOffset + i;":"round(getBestIndicesA(batch, inOffset + i));";this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * ${i};

        int bestIndex = inOffset;
        float bestValue = getA(batch, bestIndex);

        for (int i = 0; i < ${i}; i++) {
          int inIdx = ${u};
          float candidate = getA(batch, inIdx);
          if (candidate ${a} bestValue) {
            bestValue = candidate;
            bestIndex = inIdx;
          }
        }
        setOutput(float(bestIndex));
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Aze{constructor(t,n,r,i){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,N(t.length>2,()=>`Packed arg${r.charAt(0).toUpperCase()+r.slice(1)} supports only inputs with rank above 2.`);const s=t[t.length-1],o=Math.ceil(s/n);this.outputShape=t.slice(0,-1),o>1&&this.outputShape.push(o),i||this.variableNames.push("bestIndicesA");const a=this.outputShape,u=a.length,l=Gt(u),c=pi("coords",u);let f,h;if(o===1){h=u+1;const S=Gt(h);f=`
        ${S} sourceLocR = ${S}(${c.join()}, 0);
        ++${c[u-1]};
        ${S} sourceLocG = ${S}(${c.join()}, 0);
        ++${c[u-2]};
        ${S} sourceLocA = ${S}(${c.join()}, 0);
        --${c[u-1]};
        ${S} sourceLocB = ${S}(${c.join()}, 0);
        --${c[u-2]};`}else h=u,f=`
        ${l} sourceLocR = coords;
        ++${c[u-1]};
        ${l} sourceLocG = coords;
        ++${c[u-2]};
        ${l} sourceLocA = coords;
        --${c[u-1]};
        ${l} sourceLocB = coords;
        --${c[u-2]};`;const d=["x","y","z","w","u","v"].slice(0,h),p="."+d[h-1],g=d.map(S=>"int "+S),m=pi("sourceLocR",h-1).concat("inIdx.r"),y=pi("sourceLocG",h-1).concat("inIdx.g"),b=pi("sourceLocB",h-1).concat("inIdx.b"),v=pi("sourceLocA",h-1).concat("inIdx.a"),x=r==="max"?"greaterThan":"lessThan",w=i?"":`
          inIdx = round(vec4(getBestIndicesAChannel(${m.join()}),
                             getBestIndicesAChannel(${y.join()}),
                             getBestIndicesAChannel(${b.join()}),
                             getBestIndicesAChannel(${v.join()})));`,C=`vec4(
            getAChannel(${m.join()}),
            hasNextCol ? getAChannel(${y.join()}) : 0.,
            hasNextRow ? getAChannel(${b.join()}) : 0.,
            hasNextRow && hasNextCol ? getAChannel(${v.join()}) : 0.)`,$=i?"":`
      float getBestIndicesAChannel(${g.join()}) {
        return getChannel(getBestIndicesA(${d.join()}),
                                          vec2(${d.slice(-2).join()}));
      }`;this.userCode=`
      float getAChannel(${g.join()}) {
        return getChannel(getA(${d.join()}),
                               vec2(${d.slice(-2).join()}));
      }
      ${$}
      void main() {
        ${l} coords = getOutputCoords();
        bool hasNextCol = ${c[u-1]} < ${a[u-1]-1};
        bool hasNextRow = ${c[u-2]} < ${a[u-2]-1};
        ${f}
        ivec4 srcIdx = ivec4(sourceLocR${p}, sourceLocG${p},
          sourceLocB${p}, sourceLocA${p}) * ${n};
        ivec4 inIdx = srcIdx;
        vec4 bestIndex = vec4(inIdx);
        vec4 bestValue = ${C};

        for (int i = 0; i < ${n}; i++) {
          inIdx = srcIdx;
          ${w}
          vec4 candidate = ${C};
          bvec4 nan = isnan(candidate);
          bvec4 replace = bvec4(
            vec4(${x}(candidate, bestValue)) * (vec4(1.0) - vec4(nan)));

          bestValue = vec4(replace.x  ? candidate.x : bestValue.x,
                           replace.y  ? candidate.y : bestValue.y,
                           replace.z  ? candidate.z : bestValue.z,
                           replace.w  ? candidate.w : bestValue.w);
          bestIndex = mix(bestIndex, vec4(inIdx), vec4(replace));
          srcIdx++;
        }
        setOutput(bestIndex);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Xoe(e,t,n,r=null){let i=t.shape[0],s=t.shape[1];r!=null&&(i=r.shape[0],s=r.shape[1]);const o=gI(s),a={windowSize:o,inSize:s,batchSize:i,outSize:Math.ceil(s/o)},u=new _ze(a,n,r==null),l=[t];r!=null&&l.push(r);const c=e.runWebGLProgram(u,l,"int32");if(c.shape[1]===1)return c;const f=Xoe(e,t,n,c);return e.disposeIntermediateTensorInfo(c),f}function Yoe(e,t,n,r=null){const i=r!=null?r.shape:t.shape,s=i[i.length-1],o=gI(s),a=new Aze(i,o,n,r==null),u=r==null?[t]:[t,r],l=e.runWebGLProgram(a,u,"int32");if(l.shape.length===t.shape.length){const c=Yoe(e,t,n,l);return e.disposeIntermediateTensorInfo(l),c}return l}function Koe(e,t,n,r){const i=[n];if(Rr("arg"+r.charAt(0).toUpperCase()+r.slice(1),i,t.shape.length),!K().getBool("WEBGL_PACK_REDUCE")||t.shape.length<=2){const s=[],o=e.texData.get(t.dataId),a=o!==null&&o.isPacked;let u=t;a&&(u=e.unpackTensor(t),s.push(u));const[l,c]=pr(u.shape,i),f=te(c),h=Ce({inputs:{x:u},backend:e,attrs:{shape:[-1,f]}});s.push(h);const d=Xoe(e,h,r);s.push(d);const p=Ce({inputs:{x:d},backend:e,attrs:{shape:l}});return s.forEach(g=>e.disposeIntermediateTensorInfo(g)),p}return Yoe(e,t,r)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Tze(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{axis:s}=r;let o=st(s,i.shape);const a=Cn(o,i.shape.length);let u=i;const l=[];a!=null&&(u=Ii({inputs:{x:i},backend:n,attrs:{perm:a}}),l.push(u),o=On(o.length,u.shape.length)),Rr("argMax",[o[0]],u.shape.length);const c=Koe(n,u,o[0],"max");return l.forEach(f=>n.disposeIntermediateTensorInfo(f)),c}const Ize={kernelName:A2,backendName:"webgl",kernelFunc:Tze};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Dze(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{axis:s}=r;let o=st(s,i.shape);const a=Cn(o,i.shape.length);let u=i;const l=[];a!=null&&(u=Ii({inputs:{x:i},backend:n,attrs:{perm:a}}),l.push(u),o=On(o.length,u.shape.length)),Rr("argMin",[o[0]],u.shape.length);const c=Koe(n,u,o[0],"min");return l.forEach(f=>n.disposeIntermediateTensorInfo(f)),c}const Nze={kernelName:T2,backendName:"webgl",kernelFunc:Dze};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Fze=Xo+`
  if (abs(x) > 1.) {
    return NAN;
  }
  return asin(x);
`,Oze=vt({opSnippet:Fze}),Rze={kernelName:X0,backendName:"webgl",kernelFunc:Oze};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Mze=Xo+"return log(x + sqrt(x * x + 1.0));",Lze=vt({opSnippet:Mze}),Pze={kernelName:Y0,backendName:"webgl",kernelFunc:Lze};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Bze=Xo+`
  return atan(x);
`,zze=vt({opSnippet:Bze}),Uze={kernelName:K0,backendName:"webgl",kernelFunc:zze};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const jze=p6+`
  return atan(a, b);
`,Wze=`
  vec4 result = atan(a, b);
  bvec4 isNaNA = isnan(a);
  bvec4 isNaNB = isnan(b);
  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);
  `+pg+`
  return result;
`,Vze=Mr({opSnippet:jze,packedOpSnippet:Wze}),Gze={kernelName:J0,backendName:"webgl",kernelFunc:Vze};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Hze=Xo+`
  if ((x < -1.0) || (x > 1.0)) return NAN;
return (log(1.0 + x) - log(1.0 - x)) / 2.0;`,qze=vt({opSnippet:Hze}),Xze={kernelName:Z0,backendName:"webgl",kernelFunc:qze};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class nv{constructor(t,n,r,i=!1,s=!1){if(this.variableNames=["x"],n==="avg"&&r)throw new Error("Cannot compute positions for average pool.");const o=t.filterWidth,a=t.strideHeight,u=t.strideWidth,l=t.dilationHeight,c=t.dilationWidth,f=t.effectiveFilterHeight,h=t.effectiveFilterWidth,d=t.padInfo.top,p=t.padInfo.left;this.outputShape=t.outShape;const g=n==="avg",m=`((batch  * ${t.inHeight} + xR) * ${t.inWidth} + xC) * ${t.inChannels} + d`,y=`(xR * ${t.inWidth} + xC) * ${t.inChannels} + d`;let b="0.0";if(g||(b="-1.0 / 1e-20"),r){const S=">=";this.userCode=`
        const ivec2 strides = ivec2(${a}, ${u});
        const ivec2 pads = ivec2(${d}, ${p});

        void main() {
          ivec4 coords = getOutputCoords();
          int batch = coords[0];
          int d = coords[3];

          ivec2 xRCCorner = coords.yz * strides - pads;
          int xRCorner = xRCCorner.x;
          int xCCorner = xRCCorner.y;

          // max/min x(?, ?, d) to get y(yR, yC, d).
          // ? = to be determined
          float minMaxValue = 0.0;
          float minMaxValueFound = 0.0;
          int minMaxPosition = 0;
          float avgValue = 0.0;

          for (int wR = 0; wR < ${f};
              wR += ${l}) {
            int xR = xRCorner + wR;

            if (xR < 0 || xR >= ${t.inHeight}) {
              continue;
            }

            for (int wC = 0; wC < ${h};
                wC += ${c}) {
              int xC = xCCorner + wC;

              if (xC < 0 || xC >= ${t.inWidth}) {
                continue;
              }

              float value = getX(batch, xR, xC, d);

              // If a min / max value has already been found, use it. If not,
              // use the current value.
              float currMinMaxValue = mix(
                  value, minMaxValue, minMaxValueFound);
              if (value ${S} currMinMaxValue) {
                minMaxValue = value;
                minMaxValueFound = 1.0;
                minMaxPosition = ${i?s?m:y:`wR * ${h} + wC`};
              }
            }
          }
          setOutput(float(minMaxPosition));
        }
      `;return}const v="max";let x=`${n}(${n}(${n}(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])`;n==="avg"&&(x="avgValue / max(count, 1.0)");const w=Math.floor(o/4)*4,C=o%4,$=`
      if (${g}) {
        avgValue += dot(values, ones);
      } else {
        minMaxValue = ${v}(values, minMaxValue);
      }
    `;this.userCode=`
      const ivec2 strides = ivec2(${a}, ${u});
      const ivec2 pads = ivec2(${d}, ${p});
      const float initializationValue = ${b};
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float count = 0.0;

      float getValue(int batch, int xR, int xC, int d) {
        if (xC < 0 || xC >= ${t.inWidth}) {
          return initializationValue;
        }
        count += 1.0;
        return getX(batch, xR, xC, d);
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d = coords[3];

        ivec2 xRCCorner = coords.yz * strides - pads;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // max/min x(?, ?, d) to get y(yR, yC, d).
        // ? = to be determined
        vec4 minMaxValue = vec4(${b});
        float avgValue = 0.0;
        count = 0.0;

        for (int wR = 0; wR < ${f};
            wR += ${l}) {
          int xR = xRCorner + wR;

          if (xR < 0 || xR >= ${t.inHeight}) {
            continue;
          }

          for (int wC = 0; wC < ${w}; wC += 4) {
            int xC = xCCorner + wC * ${c};

            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + ${c}, d),
              getValue(batch, xR, xC + 2 * ${c}, d),
              getValue(batch, xR, xC + 3 * ${c}, d)
            );

            ${$}
          }

          int xC = xCCorner + ${w};
          if (${C===1}) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              initializationValue,
              initializationValue,
              initializationValue
            );

            ${$}
          } else if (${C===2}) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + ${c}, d),
              initializationValue,
              initializationValue
            );

            ${$}
          } else if (${C===3}) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + ${c}, d),
              getValue(batch, xR, xC + 2 * ${c}, d),
              initializationValue
            );

            ${$}
          }
        }
        setOutput(${x});
      }
    `}}class m6{constructor(t,n,r,i=!1,s=!1){if(this.variableNames=["x"],n==="avg"&&r)throw new Error("Cannot compute positions for average pool.");const o=t.filterWidth,a=t.strideDepth,u=t.strideHeight,l=t.strideWidth,c=t.dilationDepth,f=t.dilationHeight,h=t.dilationWidth,d=t.effectiveFilterDepth,p=t.effectiveFilterHeight,g=t.effectiveFilterWidth,m=t.padInfo.front,y=t.padInfo.top,b=t.padInfo.left;this.outputShape=t.outShape;const v=n==="avg";let x="0.0";if(v||(x="-1.0 / 1e-20"),r){const E=">=";this.userCode=`
        const ivec3 strides =
            ivec3(${a}, ${u}, ${l});
        const ivec3 pads = ivec3(${m}, ${y}, ${b});

        void main() {
          ivec5 coords = getOutputCoords();
          int batch = coords.x;
          int ch = coords.u;

          ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
          int xDCorner = xCorner.x;
          int xRCorner = xCorner.y;
          int xCCorner = xCorner.z;

          // max/min x(?, ?, ?, ch) to get y(yD, yR, yC, ch).
          // ? = to be determined
          float minMaxValue = 0.0;
          float minMaxValueFound = 0.0;
          int minMaxPosition = 0;

          for (int wD = 0; wD < ${d};
              wD += ${c}) {
            int xD = xDCorner + wD;

            if (xD < 0 || xD >= ${t.inDepth}) {
              continue;
            }

            for (int wR = 0; wR < ${p};
                wR += ${f}) {
              int xR = xRCorner + wR;

              if (xR < 0 || xR >= ${t.inHeight}) {
                continue;
              }

              for (int wC = 0; wC < ${g};
                  wC += ${h}) {
                int xC = xCCorner + wC;

                if (xC < 0 || xC >= ${t.inWidth}) {
                  continue;
                }

                float value = getX(batch, xD, xR, xC, ch);

                // If a min / max value has already been found, use it. If not,
                // use the current value.
                float currMinMaxValue = mix(
                    value, minMaxValue, minMaxValueFound);
                if (value ${E} currMinMaxValue) {
                  minMaxValue = value;
                  minMaxValueFound = 1.0;
                  minMaxPosition = ${i?s?`(((batch * ${t.inDepth} + xD) * ${t.inHeight} + xR) * ${t.inWidth} + xC) * ${t.inChannels} + ch`:`((xD * ${t.inHeight} + xR) * ${t.inWidth} + xC) * ${t.inChannels} + ch`:`wD * ${p} * ${g} +
                      wR * ${g} + wC`};
                }
              }
            }
          }
          setOutput(float(minMaxPosition));
        }
      `;return}const w="max";let C=`${n}(${n}(${n}(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])`;n==="avg"&&(C="avgValue / max(count, 1.0)");const $=Math.floor(o/4)*4,S=o%4,k=`
      if (${v}) {
        avgValue += dot(values, ones);
      } else {
        minMaxValue = ${w}(values, minMaxValue);
      }
    `;this.userCode=`
      const ivec3 strides =
        ivec3(${a}, ${u}, ${l});
      const ivec3 pads = ivec3(${m}, ${y}, ${b});
      const float initializationValue = ${x};
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float count = 0.0;

      float getValue(int batch, int xD, int xR, int xC, int ch) {
        if (xC < 0 || xC >= ${t.inWidth}) {
          return initializationValue;
        }
        count += 1.0;
        return getX(batch, xD, xR, xC, ch);
      }

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
        int xDCorner = xCorner.x;
        int xRCorner = xCorner.y;
        int xCCorner = xCorner.z;

        // max/min x(?, ?, ?, d) to get y(yD, yR, yC, ch).
        // ? = to be determined
        vec4 minMaxValue = vec4(${x});
        float avgValue = 0.0;
        count = 0.0;

        for (int wD = 0; wD < ${d};
            wD += ${c}) {
          int xD = xDCorner + wD;

          if (xD < 0 || xD >= ${t.inDepth}) {
            continue;
          }

          for (int wR = 0; wR < ${p};
            wR += ${f}) {
            int xR = xRCorner + wR;

            if (xR < 0 || xR >= ${t.inHeight}) {
              continue;
            }

            for (int wC = 0; wC < ${$}; wC += 4) {
              int xC = xCCorner + wC * ${h};

              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + ${h}, ch),
                getValue(batch, xD, xR, xC + 2 * ${h}, ch),
                getValue(batch, xD, xR, xC + 3 * ${h}, ch)
              );

              ${k}
            }

            int xC = xCCorner + ${$};
            if (${S===1}) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                initializationValue,
                initializationValue,
                initializationValue
              );

              ${k}
            } else if (${S===2}) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + ${h}, ch),
                initializationValue,
                initializationValue
              );

              ${k}
            } else if (${S===3}) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + ${h}, ch),
                getValue(batch, xD, xR, xC + 2 * ${h}, ch),
                initializationValue
              );

              ${k}
            }
          }
        }
        setOutput(${C});
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Yze(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t;Zw(i,"avgPool");const{filterSize:s,strides:o,pad:a,dimRoundingMode:u}=r,l=1;N(Or(o,l),()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${o} and dilations '${l}'`);const c=Ho(i.shape,s,o,l,a,u);if(c.filterWidth===1&&c.filterHeight===1&&bt(c.inShape,c.outShape))return Ts({inputs:{x:i},backend:n});const f=new nv(c,"avg",!1);return n.runWebGLProgram(f,[i],"float32")}const Kze={kernelName:I2,backendName:"webgl",kernelFunc:Yze};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Zze(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{filterSize:s,strides:o,pad:a,dimRoundingMode:u,dataFormat:l}=r,c=[1,1,1],f=vc(i.shape,s,o,c,a,u,l),h=new m6(f,"avg",!1);return n.runWebGLProgram(h,[i],"float32")}const Jze={kernelName:D2,backendName:"webgl",kernelFunc:Zze};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Qze{constructor(t){this.variableNames=["dy"],this.outputShape=t.inShape;const n=t.filterHeight,r=t.filterWidth,i=t.strideHeight,s=t.strideWidth,o=t.dilationHeight,a=t.dilationWidth,u=t.effectiveFilterHeight,l=t.effectiveFilterWidth,c=u-1-t.padInfo.top,f=l-1-t.padInfo.left,h=1/(n*r);this.userCode=`
      const ivec2 pads = ivec2(${c}, ${f});
      const float avgMultiplier = float(${h});

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];

        ivec2 dyRCCorner = coords.yz - pads;
        int dyRCorner = dyRCCorner.x;
        int dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${u};
            wR += ${o}) {
          float dyR = float(dyRCorner + wR) / ${i}.0;

          if (dyR < 0.0 || dyR >= ${t.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          for (int wC = 0; wC < ${l};
            wC+= ${a}) {
            float dyC = float(dyCCorner + wC) / ${s}.0;

            if (dyC < 0.0 || dyC >= ${t.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            float dyValue = getDy(b, idyR, idyC, d);

            dotProd += dyValue * avgMultiplier;
          }
        }
        setOutput(dotProd);
      }
    `}}class e8e{constructor(t){this.variableNames=["dy"],this.outputShape=t.inShape;const n=t.filterDepth,r=t.filterHeight,i=t.filterWidth,s=t.strideDepth,o=t.strideHeight,a=t.strideWidth,u=t.dilationDepth,l=t.dilationHeight,c=t.dilationWidth,f=t.effectiveFilterDepth,h=t.effectiveFilterHeight,d=t.effectiveFilterWidth,p=f-1-t.padInfo.front,g=h-1-t.padInfo.top,m=d-1-t.padInfo.left,y=1/(n*r*i);this.userCode=`
      const ivec3 pads = ivec3(${p}, ${g}, ${m});
      const float avgMultiplier = float(${y});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyDCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        // Convolve dy(?, ?, ?, d) with pos mask(:, :, :, ch) to get
        // dx(xD, xR, xC, ch).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int wD = 0; wD < ${f};
            wD += ${u}) {
          float dyD = float(dyDCorner + wD) / ${s}.0;

          if (dyD < 0.0 || dyD >= ${t.outDepth}.0 || fract(dyD) > 0.0) {
            continue;
          }
          int idyD = int(dyD);

          for (int wR = 0; wR < ${h};
              wR += ${l}) {
            float dyR = float(dyRCorner + wR) / ${o}.0;

            if (dyR < 0.0 || dyR >= ${t.outHeight}.0 ||
                fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            for (int wC = 0; wC < ${d};
                wC += ${c}) {
              float dyC = float(dyCCorner + wC) / ${a}.0;

              if (dyC < 0.0 || dyC >= ${t.outWidth}.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              float dyValue = getDy(batch, idyD, idyR, idyC, ch);

              dotProd += dyValue * avgMultiplier;
            }
          }
        }
        setOutput(dotProd);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function t8e(e){const{inputs:t,backend:n,attrs:r}=e,{dy:i,input:s}=t,o=s,{filterSize:a,strides:u,pad:l,dimRoundingMode:c}=r,f=[1,1,1],h=vc(o.shape,a,u,f,l,c),d=new e8e(h);return n.runWebGLProgram(d,[i],o.dtype)}const n8e={kernelName:RA,backendName:"webgl",kernelFunc:t8e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function r8e(e){const{inputs:t,backend:n,attrs:r}=e,{dy:i,input:s}=t,o=s;Zw([i,s],"avgPoolGrad");const{filterSize:a,strides:u,pad:l}=r,c=Ho(o.shape,a,u,1,l),f=new Qze(c);return n.runWebGLProgram(f,[i],o.dtype)}const i8e={kernelName:OA,backendName:"webgl",kernelFunc:r8e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function s8e(e){const{inputs:t,backend:n,attrs:r}=e,{a:i,b:s}=t,{transposeA:o,transposeB:a}=r;return tE({a:i,b:s,transposeA:o,transposeB:a,backend:n})}const o8e={kernelName:N2,backendName:"webgl",kernelFunc:s8e};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class a8e{constructor(t,n,r,i,s,o){this.outputShape=[],this.variableNames=["x","mean","variance"],Ze(t,n),Ze(t,r);let a="0.0";i!=null&&(Ze(t,i),this.variableNames.push("offset"),a="getOffsetAtOutCoords()");let u="1.0";s!=null&&(Ze(t,s),this.variableNames.push("scale"),u="getScaleAtOutCoords()"),this.outputShape=t,this.userCode=`
      void main() {
        float x = getXAtOutCoords();
        float mean = getMeanAtOutCoords();
        float variance = getVarianceAtOutCoords();
        float offset = ${a};
        float scale = ${u};
        float inv = scale * inversesqrt(variance + float(${o}));
        setOutput(dot(vec3(x, -mean, offset), vec3(inv, inv, 1)));
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class u8e{constructor(t,n,r,i,s,o){this.packedInputs=!0,this.packedOutput=!0,this.variableNames=["x","mean","variance"],Ze(t,n),Ze(t,r);let a="vec4(0.0)";i!=null&&(Ze(t,i),this.variableNames.push("offset"),a="getOffsetAtOutCoords()");let u="vec4(1.0)";s!=null&&(Ze(t,s),this.variableNames.push("scale"),u="getScaleAtOutCoords()"),this.outputShape=t,this.userCode=`
      void main() {
        vec4 offset = ${a};
        vec4 scale = ${u};

        vec4 x = getXAtOutCoords();
        vec4 mean = getMeanAtOutCoords();
        vec4 variance = getVarianceAtOutCoords();

        vec4 inv = scale * inversesqrt(variance + vec4(${o}));

        setOutput((x - mean) * inv + offset);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const l8e=({inputs:e,backend:t,attrs:n})=>{const{x:r,mean:i,variance:s,offset:o,scale:a}=e;N(i.shape.length===s.shape.length,()=>"Batch normalization gradient requires mean and variance to have equal ranks."),N(o==null||i.shape.length===o.shape.length,()=>"Batch normalization gradient requires mean and offset to have equal ranks."),N(a==null||i.shape.length===a.shape.length,()=>"Batch normalization gradient requires mean and scale to have equal ranks.");let{varianceEpsilon:u}=n;u==null&&(u=.001);const l=[r,i,s];let c=null;o!=null&&(c=o.shape,l.push(o));let f=null;a!=null&&(f=a.shape,l.push(a));const h=K().getBool("WEBGL_PACK_NORMALIZATION")?new u8e(r.shape,i.shape,s.shape,c,f,u):new a8e(r.shape,i.shape,s.shape,c,f,u);return t.runWebGLProgram(h,l,l[0].dtype)},c8e={kernelName:G2,backendName:"webgl",kernelFunc:l8e};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class f8e{constructor(t){this.variableNames=["source"],this.outputShape=t,this.rank=t.length;const n=Gt(this.rank);this.customUniforms=[{name:"start",arrayIndex:this.rank,type:"int"}];const r=h8e(this.rank);let i;const s=t.map((o,a)=>`sourceLoc.${bM[a]} = start[${a}] + coords.${bM[a]};`);i=`
        ${n} sourceLoc;
        ${n} coords = getOutputCoords();
        ${s.join(`
`)}
      `,this.userCode=`
      void main() {
        ${i}
        setOutput(getSource(${r}));
      }
    `}}const bM=["x","y","z","w","u","v"];function h8e(e){if(e===1)return"sourceLoc";if(e<=6)return bM.slice(0,e).map(t=>"sourceLoc."+t).join(",");throw Error(`Slicing for rank ${e} is not yet supported`)}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class d8e{constructor(t){this.variableNames=["source"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t,this.rank=t.length,this.customUniforms=[{name:"start",arrayIndex:this.rank,type:"int"}];const n=Gt(this.rank),r=pi("coords",this.rank),i=pi("sourceLoc",this.rank),s=this.rank===1?"sourceLoc":`vec2(${i.slice(-2).join()})`,o=`getChannel(getSource(${i.join()}), ${s})`,a=`
      result.x = ${o};
      if (++${r[this.rank-1]} < ${t[this.rank-1]}) {
        ++${i[this.rank-1]};
        result.y = ${o};
        --${i[this.rank-1]};
      }
    `,u=this.rank===1?"":`
      --${r[this.rank-1]};
      if (++${r[this.rank-2]} < ${t[this.rank-2]}) {
        ++${i[this.rank-2]};
        result.z = ${o};
        if (++${r[this.rank-1]} < ${t[this.rank-1]}) {
          ++${i[this.rank-1]};
          result.w = ${o};
        }
      }
    `,l=this.rank<=4?`sourceLoc = coords +
            ${n}(${t.map((c,f)=>`start[${f}]`).join()});`:t.map((c,f)=>`${i[f]} = ${r[f]} + start[${f}];`).join(`
`);this.userCode=`
      void main() {
        ${n} coords = getOutputCoords();
        ${n} sourceLoc;
        ${l}
        vec4 result = vec4(0.);
        ${a}
        ${u}
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function p8e(e,t,n,r){const i=r.texData.get(e.dataId),s=r.makeTensorInfo(n,e.dtype),o=r.texData.get(s.dataId);Object.assign(o,i),o.refCount=1,o.shape=n,o.dtype=e.dtype;let a=u5(t,Me(e.shape));i.slice&&(a+=i.slice.flatOffset),o.slice={flatOffset:a,origDataId:i.slice&&i.slice.origDataId||e.dataId};const u=r.dataRefCount.get(o.slice.origDataId)||1;return r.dataRefCount.set(o.slice.origDataId,u+1),s}function Q1(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{begin:s,size:o}=r,[a,u]=pI(i,s,o);if(s5(i,a,u),te(u)===0)return n.makeTensorInfo(u,i.dtype,[]);if(n.shouldExecuteOnCPU([i])||i.dtype==="string"){const f=n.texData.get(i.dataId),h=o6e(f.values,a,u,i.shape,i.dtype);return n.makeTensorInfo(u,i.dtype,h)}const{isPacked:l}=n.texData.get(i.dataId),c=a5(i.shape,a,u);if(l||!c){const f=K().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new d8e(u):new f8e(u),h=[a];return n.runWebGLProgram(f,[i],i.dtype,h)}return n.uploadToGPU(i.dataId),p8e(i,a,u,n)}const g8e={kernelName:vw,backendName:"webgl",kernelFunc:Q1};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const m8e=e=>{const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{blockShape:s,crops:o}=r;N(i.shape.length<=4,()=>"batchToSpaceND for rank > 4 with a WebGL backend not implemented yet");const a=s.reduce((b,v)=>b*v),u=Pw(i.shape,s,a),l=Bw(u.length,s.length),c=zw(i.shape,s,a),f=p5(o,s.length),h=g5(c,o,s.length),d=[],p=Ce({inputs:{x:i},backend:n,attrs:{shape:u}}),g=Ii({inputs:{x:p},backend:n,attrs:{perm:l}}),m=Ce({inputs:{x:g},backend:n,attrs:{shape:c}}),y=Q1({inputs:{x:m},backend:n,attrs:{begin:f,size:h}});return d.push(p),d.push(g),d.push(m),d.forEach(b=>n.disposeIntermediateTensorInfo(b)),y},y8e={kernelName:F2,backendName:"webgl",kernelFunc:m8e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function b8e(e){const{inputs:t,backend:n,attrs:r}=e,{x:i,weights:s}=t,{size:o}=r,a=n.readSync(i.dataId),u=n.readSync(s.dataId),l=Loe(a,u,s.dtype,s.shape,o);return n.makeTensorInfo([o],s.dtype,l)}const x8e={kernelName:MA,backendName:"webgl",kernelFunc:b8e};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const v8e=`
  int r = int(a.r) & int(b.r);
  int g = int(a.g) & int(b.g);
  int rb = int(a.b) & int(b.b);
  int ra = int(a.a) & int(b.a);
  return vec4(r, g, rb, ra);
`,w8e=`
  return float(int(a.r) & int(b.r));
`;function $8e(e){const{inputs:t,backend:n}=e,{a:r,b:i}=t,s=K().getBool("WEBGL_PACK_BINARY_OPERATIONS"),o=K().getNumber("WEBGL_VERSION");if(n.shouldExecuteOnCPU([r,i])||o===1){const u=n.texData.get(r.dataId).values,l=n.texData.get(i.dataId).values,[c,f]=I5e(r.shape,i.shape,u,l,r.dtype),h=n.makeTensorInfo(f,r.dtype),d=n.texData.get(h.dataId);return d.values=c,h}let a;return s?a=new Z1(v8e,r.shape,i.shape,!1):a=new Cp(w8e,r.shape,i.shape),n.runWebGLProgram(a,[r,i],r.dtype)}const C8e={kernelName:O2,backendName:"webgl",kernelFunc:$8e};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function S8e(e){const{inputs:t,backend:n}=e,{s0:r,s1:i}=t,s=n.readSync(r.dataId),o=n.readSync(i.dataId),a=Ze(Array.from(s),Array.from(o));return n.makeTensorInfo([a.length],"int32",Int32Array.from(a))}const k8e={kernelName:LA,backendName:"webgl",kernelFunc:S8e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const E8e="return float(a != b);",Zoe=Mr({opSnippet:E8e,cpuKernelImpl:Z5e,dtype:"bool"}),_8e={kernelName:uw,backendName:"webgl",kernelFunc:Zoe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Qw(e){const{inputs:t,backend:n}=e,{input:r}=t,i=n.texData.get(r.dataId);return Ts({inputs:{x:i.complexTensorInfos.real},backend:n})}const A8e={kernelName:yT,backendName:"webgl",kernelFunc:Qw};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const T8e="return float(int(x));";function I8e(e,t){const n=new xu(e.shape,T8e),r=t.runWebGLProgram(n,[e],"int32");return{dataId:r.dataId,shape:r.shape,dtype:r.dtype}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xM(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{dtype:s}=r;if(s==="complex64"){if(i.dtype==="complex64")return Ts({inputs:{x:i},backend:n});const o=Hn(i.shape),a=xM({inputs:{x:i},backend:n,attrs:{dtype:"float32"}}),u=Nh({inputs:{real:a,imag:o},backend:n});return o.dispose(),n.disposeIntermediateTensorInfo(a),u}if(i.dtype==="complex64"){const o=Qw({inputs:{input:i},backend:n}),a=xM({inputs:{x:o},backend:n,attrs:{dtype:s}});return n.disposeIntermediateTensorInfo(o),a}if(!QP(i.dtype,s)){const o=Ts({inputs:{x:i},backend:n});return{dataId:o.dataId,shape:o.shape,dtype:s}}if(n.shouldExecuteOnCPU([i])){const o=n.texData.get(i.dataId).values,[a,u,l]=D5e(o,i.shape,i.dtype,s);return n.makeTensorInfo(a,u,l)}if(s==="int32")return I8e(i,n);if(s==="bool"){const o=n.makeTensorInfo([],"bool",hr("bool",1)),u=Zoe({inputs:{a:i,b:o},backend:n});return n.disposeIntermediateTensorInfo(o),u}throw new Error(`Error in Cast: failed to cast ${i.dtype} to ${s}`)}const D8e={kernelName:Q0,backendName:"webgl",kernelFunc:xM};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const TG="return ceil(x);",N8e=vt({opSnippet:TG,packedOpSnippet:TG,cpuKernelImpl:N5e}),F8e={kernelName:e1,backendName:"webgl",kernelFunc:N8e};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class O8e{constructor(t){this.variableNames=["A"],this.customUniforms=[{name:"minVal",type:"float"},{name:"maxVal",type:"float"}],this.outputShape=t,this.userCode=`

      void main() {
        float value = getAAtOutCoords();
        if (isnan(value)) {
          setOutput(value);
          return;
        }

        setOutput(clamp(value, minVal, maxVal));
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class R8e{constructor(t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"minVal",type:"float"},{name:"maxVal",type:"float"}],this.outputShape=t,this.userCode=`
      void main() {
        vec4 value = getAAtOutCoords();

        if (any(isnan(value))) {
          setOutput(value);
          return;
        }

        setOutput(clamp(value, vec4(minVal), vec4(maxVal)));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function M8e(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{clipValueMin:s,clipValueMax:o}=r;let a;K().getBool("WEBGL_PACK_CLIP")?a=new R8e(i.shape):a=new O8e(i.shape);const u=[[s],[o]];return n.runWebGLProgram(a,[i],i.dtype,u)}const L8e={kernelName:t1,backendName:"webgl",kernelFunc:M8e};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class P8e{constructor(t){this.variableNames=["real","imag"],this.outputShape=t,this.userCode=`
      void main() {
        float re = abs(getRealAtOutCoords());
        float im = abs(getImagAtOutCoords());
        float mx = max(re, im);

        // sadly the length function in glsl is not underflow-safe
        // (at least not on Intel GPUs). So the safe solution is
        // to ensure underflow-safety in all cases.
        setOutput(
          mx == 0.0 ? 0.0 : mx * length(vec2(1, min(re, im)/mx))
        );
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function IG(e,t){return{dataId:t.dataId,dtype:t.dtype,shape:e.shape}}function B8e(e){const{inputs:t,backend:n}=e,{x:r}=t,i=n.texData.get(r.dataId),s=new P8e(r.shape),o=[IG(r,i.complexTensorInfos.real),IG(r,i.complexTensorInfos.imag)];return n.runWebGLProgram(s,o,o[0].dtype)}const z8e={kernelName:R2,backendName:"webgl",kernelFunc:B8e};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class U8e{constructor(t){this.outputShape=[],this.outputShape=Cu(t,1),this.variableNames=t.map((o,a)=>`T${a}`);const n=new Array(t.length-1);n[0]=t[0][1];for(let o=1;o<n.length;o++)n[o]=n[o-1]+t[o][1];const r=[`if (yC < ${n[0]}) setOutput(getT0(yR, yC));`];for(let o=1;o<n.length;o++){const a=n[o-1];r.push(`else if (yC < ${n[o]}) setOutput(getT${o}(yR, yC-${a}));`)}const i=n.length,s=n[n.length-1];r.push(`else setOutput(getT${i}(yR, yC-${s}));`),this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int yR = coords.x;
        int yC = coords.y;

        ${r.join(`
        `)}
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class j8e{constructor(t,n){this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[],this.outputShape=Cu(t,n);const r=this.outputShape,i=r.length,s=Gt(i),o=pi("coords",i),a=["x","y","z","w","u","v"].slice(0,i);this.variableNames=t.map((g,m)=>`T${m}`);const u=new Array(t.length-1);u[0]=t[0][n];for(let g=1;g<u.length;g++)u[g]=u[g-1]+t[g][n];const l=a[n],c=a.slice(-2),f=a.join();let h=`if (${l} < ${u[0]}) {
        return getChannel(
            getT0(${f}), vec2(${c.join()}));
        }`;for(let g=1;g<u.length;g++){const m=u[g-1];h+=`
        if (${l} < ${u[g]}  && ${l} >= ${u[g-1]}) {
          return getChannel(
            getT${g}(${PC(a,l,m)}),
            vec2(${PC(c,l,m)}));
        }`}const d=u.length,p=u[u.length-1];h+=`
        return getChannel(
          getT${d}(${PC(a,l,p)}),
          vec2(${PC(c,l,p)}));`,this.userCode=`
      float getValue(${a.map(g=>"int "+g)}) {
        ${h}
      }

      void main() {
        ${s} coords = getOutputCoords();
        vec4 result = vec4(getValue(${o}), 0., 0., 0.);

        ${o[i-1]} = ${o[i-1]} + 1;
        if (${o[i-1]} < ${r[i-1]}) {
          result.g = getValue(${o});
        }

        ${o[i-2]} = ${o[i-2]} + 1;
        if (${o[i-2]} < ${r[i-2]}) {
          result.a = getValue(${o});
        }

        ${o[i-1]} = ${o[i-1]} - 1;
        if (${o[i-2]} < ${r[i-2]} &&
            ${o[i-1]} < ${r[i-1]}) {
          result.b = getValue(${o});
        }
        setOutput(result);
      }
    `}}function PC(e,t,n){const r=e.indexOf(t);return e.map((s,o)=>o===r?`${s} - ${n}`:s).join()}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function OI(e){const{inputs:t,backend:n}=e,{input:r}=t,i=n.texData.get(r.dataId);return Ts({inputs:{x:i.complexTensorInfos.imag},backend:n})}const W8e={kernelName:rT,backendName:"webgl",kernelFunc:OI};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Nb(e,t,n){const r=e[0].dtype;if(r==="complex64"){const d=e.map(b=>Qw({inputs:{input:b},backend:n})),p=e.map(b=>OI({inputs:{input:b},backend:n})),g=Nb(d,t,n),m=Nb(p,t,n),y=Nh({inputs:{real:g,imag:m},backend:n});return d.forEach(b=>n.disposeIntermediateTensorInfo(b)),p.forEach(b=>n.disposeIntermediateTensorInfo(b)),n.disposeIntermediateTensorInfo(g),n.disposeIntermediateTensorInfo(m),y}let i=n.shouldExecuteOnCPU(e);if(r==="string"&&(i=!0),i){const d=e.map(x=>{const C=[-1,te(x.shape.slice(t))];return Ce({inputs:{x},backend:n,attrs:{shape:C}})}),p=d.map(x=>({vals:n.readSync(x.dataId),shape:x.shape})),g=Cu(d.map(x=>x.shape),1),m=d[0].shape[0]===1,y=F5e(p,g,r,m),b=Cu(e.map(x=>x.shape),t),v=n.makeTensorInfo(b,r,y);return d.forEach(x=>n.disposeIntermediateTensorInfo(x)),v}const s=e.filter(d=>te(d.shape)>0),o=K().getBool("WEBGL_PACK_ARRAY_OPERATIONS")&&s[0].shape.length>1;if(s.length===1){const d=o?new xu(e[0].shape,qc):new sf(e[0].shape,qc);return n.runWebGLProgram(d,e,r)}const a=K().getNumber("WEBGL_MAX_TEXTURES_IN_SHADER");if(s.length>a){const d=[];for(let g=0;g<s.length;g+=a){const m=s.slice(g,g+a);d.push(Nb(m,t,n))}const p=Nb(d,t,n);for(const g of d)n.disposeIntermediateTensorInfo(g);return p}if(o){const d=new j8e(s.map(p=>p.shape),t);return n.runWebGLProgram(d,s,r)}const{tensors2D:u,outShape:l}=V8e(s,t,n),c=new U8e(u.map(d=>d.shape)),f=n.runWebGLProgram(c,u,r);u.forEach(d=>n.disposeIntermediateTensorInfo(d));const h=Ce({inputs:{x:f},attrs:{shape:l},backend:n});return n.disposeIntermediateTensorInfo(f),h}function V8e(e,t,n){const r=Cu(e.map(s=>s.shape),t);return{tensors2D:e.map(s=>Ce({inputs:{x:s},attrs:{shape:[-1,te(s.shape.slice(t))]},backend:n})),outShape:r}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Joe(e){const{inputs:t,backend:n,attrs:r}=e,{axis:i}=r,s=st(i,t[0].shape)[0],o=t.map(l=>l.shape);f5(o,s);const a=Cu(t.map(l=>l.shape),s);if(te(a)===0)return n.makeTensorInfo(a,t[0].dtype,[]);const u=t.filter(l=>te(l.shape)>0);return u.length===1?Ts({inputs:{x:u[0]},backend:n}):Nb(u,s,n)}const G8e={kernelName:M2,backendName:"webgl",kernelFunc:Joe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Qoe{constructor(t,n=!1,r=null,i=!1,s=!1){this.variableNames=["x","W"],this.outputShape=t.outShape;const o=t.padInfo.top,a=t.padInfo.left,u=t.strideHeight,l=t.strideWidth,c=t.dilationHeight,f=t.dilationWidth,h=t.filterHeight,d=t.filterWidth,p=Math.floor(t.inChannels/4)*4,g=t.inChannels%4,m=t.dataFormat==="channelsLast",y=m?1:2,b=m?2:3,v=m?3:1;let x="",w="";r&&(i?x=`float activation(float a) {
          float b = getPreluActivationWeightsAtOutCoords();
          ${r}
        }`:s?x=`float activation(float a) {
          float b = getLeakyreluAlphaAtOutCoords();
          ${r}
        }`:x=`
          float activation(float x) {
            ${r}
          }
        `,w="result = activation(result);");const C=n?"result += getBiasAtOutCoords();":"";n&&this.variableNames.push("bias"),i&&this.variableNames.push("preluActivationWeights"),s&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
      ${x}

      const ivec2 strides = ivec2(${u}, ${l});
      const ivec2 pads = ivec2(${o}, ${a});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d2 = coords[${v}];

        ivec2 xRCCorner =
            ivec2(coords[${y}], coords[${b}]) * strides - pads;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // Convolve x(?, ?, d1) with w(:, :, d1, d2) to get y(yR, yC, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${h}; wR++) {
          int xR = xRCorner + wR * ${c};

          if (xR < 0 || xR >= ${t.inHeight}) {
            continue;
          }

          for (int wC = 0; wC < ${d}; wC++) {
            int xC = xCCorner + wC * ${f};

            if (xC < 0 || xC >= ${t.inWidth}) {
              continue;
            }

            for (int d1 = 0; d1 < ${p}; d1 += 4) {
              vec4 wValues = vec4(
                getW(wR, wC, d1, d2),
                getW(wR, wC, d1 + 1, d2),
                getW(wR, wC, d1 + 2, d2),
                getW(wR, wC, d1 + 3, d2)
              );

              if (${m}) {
                vec4 xValues = vec4(
                  getX(batch, xR, xC, d1),
                  getX(batch, xR, xC, d1 + 1),
                  getX(batch, xR, xC, d1 + 2),
                  getX(batch, xR, xC, d1 + 3)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec4 xValues = vec4(
                  getX(batch, d1, xR, xC),
                  getX(batch, d1 + 1, xR, xC),
                  getX(batch, d1 + 2, xR, xC),
                  getX(batch, d1 + 3, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }
            }

            if (${g===1}) {

              if (${m}) {
                dotProd +=
                    getX(batch, xR, xC, ${p}) *
                    getW(wR, wC, ${p}, d2);
              } else {
                dotProd +=
                    getX(batch, ${p}, xR, xC) *
                    getW(wR, wC, ${p}, d2);
              }

            } else if (${g===2}) {
              vec2 wValues = vec2(
                getW(wR, wC, ${p}, d2),
                getW(wR, wC, ${p} + 1, d2)
              );

              if (${m}) {
                vec2 xValues = vec2(
                  getX(batch, xR, xC, ${p}),
                  getX(batch, xR, xC, ${p} + 1)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec2 xValues = vec2(
                  getX(batch, ${p}, xR, xC),
                  getX(batch, ${p} + 1, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }

            } else if (${g===3}) {
              vec3 wValues = vec3(
                getW(wR, wC, ${p}, d2),
                getW(wR, wC, ${p} + 1, d2),
                getW(wR, wC, ${p} + 2, d2)
              );

              if (${m}) {
                vec3 xValues = vec3(
                  getX(batch, xR, xC, ${p}),
                  getX(batch, xR, xC, ${p} + 1),
                  getX(batch, xR, xC, ${p} + 2)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec3 xValues = vec3(
                  getX(batch, ${p}, xR, xC),
                  getX(batch, ${p} + 1, xR, xC),
                  getX(batch, ${p} + 2, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }

            }
          }
        }

        float result = dotProd;
        ${C}
        ${w}
        setOutput(result);
      }
    `}}class H8e{constructor(t){this.variableNames=["x","W"],this.outputShape=t.outShape;const n=t.padInfo.front,r=t.padInfo.top,i=t.padInfo.left,s=t.strideDepth,o=t.strideHeight,a=t.strideWidth,u=t.dilationDepth,l=t.dilationHeight,c=t.dilationWidth,f=t.filterDepth,h=t.filterHeight,d=t.filterWidth,p=Math.floor(t.inChannels/4)*4,g=t.inChannels%4;this.userCode=`
      const ivec3 strides = ivec3(${s}, ${o}, ${a});
      const ivec3 pads = ivec3(${n}, ${r}, ${i});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int d2 = coords.u;

        ivec3 xFRCCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
        int xFCorner = xFRCCorner.x;
        int xRCorner = xFRCCorner.y;
        int xCCorner = xFRCCorner.z;

        // Convolve x(?, ?, ?, d1) with w(:, :, :, d1, d2) to get
        // y(yF, yR, yC, d2). ? = to be determined. : = across all
        // values in that axis.
        float dotProd = 0.0;
        for (int wF = 0; wF < ${f}; wF++) {
          int xF = xFCorner + wF * ${u};

          if (xF < 0 || xF >= ${t.inDepth}) {
            continue;
          }

          for (int wR = 0; wR < ${h}; wR++) {
            int xR = xRCorner + wR * ${l};

            if (xR < 0 || xR >= ${t.inHeight}) {
              continue;
            }

            for (int wC = 0; wC < ${d}; wC++) {
              int xC = xCCorner + wC * ${c};

              if (xC < 0 || xC >= ${t.inWidth}) {
                continue;
              }

              for (int d1 = 0; d1 < ${p}; d1 += 4) {
                vec4 xValues = vec4(
                  getX(batch, xF, xR, xC, d1),
                  getX(batch, xF, xR, xC, d1 + 1),
                  getX(batch, xF, xR, xC, d1 + 2),
                  getX(batch, xF, xR, xC, d1 + 3)
                );
                vec4 wValues = vec4(
                  getW(wF, wR, wC, d1, d2),
                  getW(wF, wR, wC, d1 + 1, d2),
                  getW(wF, wR, wC, d1 + 2, d2),
                  getW(wF, wR, wC, d1 + 3, d2)
                );

                dotProd += dot(xValues, wValues);
              }

              if (${g===1}) {
                dotProd +=
                  getX(batch, xF, xR, xC, ${p}) *
                  getW(wF, wR, wC, ${p}, d2);
              } else if (${g===2}) {
                vec2 xValues = vec2(
                  getX(batch, xF, xR, xC, ${p}),
                  getX(batch, xF, xR, xC, ${p} + 1)
                );
                vec2 wValues = vec2(
                  getW(wF, wR, wC, ${p}, d2),
                  getW(wF, wR, wC, ${p} + 1, d2)
                );
                dotProd += dot(xValues, wValues);
              } else if (${g===3}) {
                vec3 xValues = vec3(
                  getX(batch, xF, xR, xC, ${p}),
                  getX(batch, xF, xR, xC, ${p} + 1),
                  getX(batch, xF, xR, xC, ${p} + 2)
                );
                vec3 wValues = vec3(
                  getW(wF, wR, wC, ${p}, d2),
                  getW(wF, wR, wC, ${p} + 1, d2),
                  getW(wF, wR, wC, ${p} + 2, d2)
                );
                dotProd += dot(xValues, wValues);
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class eae{constructor(t,n=!1,r=null,i=!1,s=!1){this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=t.outShape,this.enableShapeUniforms=Jr(this.outputShape.length);const o=t.padInfo.left,a=t.strideWidth,u=t.dilationWidth,l=t.filterHeight,c=t.filterWidth,f=c;let h=`
       int xR; int xC; int xCOffset;
       vec4 wTexel; vec4 previous; vec4 final;`;for(let m=0;m<c;m++)h+=`
           vec4 xTexelC${m*2};
           int xTexelC${m*2}Ready;
           vec4 xTexelC${m*2+1};
           int xTexelC${m*2+1}Ready;
           vec4 xC${m};`;h+=`
     for (int r = 0; r < ${l}; r++) {
      for (int d1 = 0; d1 < ${t.inChannels}; d1 += 2) {
       `;for(let m=0;m<c;m++)h+=`
           xTexelC${m*2} = vec4(0.0);
           xTexelC${m*2}Ready = 0;
           xTexelC${m*2+1} = vec4(0.0);
           xTexelC${m*2+1}Ready = 0;
           xC${m} = vec4(0.0);`;h+=`
         xR = xRCorner + r * dilations[0];
         if (xR >=0 && xR < inDims[0]) {
       `;for(let m=0;m<(f+1)/2;m++){const y=m*2;if(h+=`
           xC = xCCorner + ${y*u};
           `,a===1){if(y<c&&(o%2===1?(h+=`
                 xCOffset = xC + 1;
                 if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${y}Ready == 0) {
                   xTexelC${y} = getX(batch, xR, xCOffset, d1);

                   // Need to manually clear unused channels in case
                   // we're reading from recycled texture.
                   if (xCOffset + 1 >= inDims[1]) {
                     xTexelC${y}.zw = vec2(0.0);
                   }
                   xTexelC${y}Ready = 1;
                 }
               `,u===1&&y>0?h+=`
                 xC${y} = vec4(xTexelC${y-2}.zw, xTexelC${y}.xy);
                 `:h+=`
                   xCOffset = xC + 1 - 2;

                   if (xCOffset >= 0 && xCOffset < inDims[1]) {
                     previous = getX(batch, xR, xCOffset, d1);

                     // Need to manually clear unused channels in case
                     // we're reading from recycled texture.
                     if (xCOffset + 1 >= inDims[1]) {
                       previous.zw = vec2(0.0);
                     }

                     xC${y} = vec4(previous.zw, xTexelC${y}.xy);
                   } else {
                     xC${y} = vec4(0.0, 0.0, xTexelC${y}.xy);
                   }
                   `):h+=`
                 if (xC >= 0 && xC < inDims[1] && xTexelC${y}Ready == 0) {
                   xTexelC${y} = getX(batch, xR, xC, d1);
                   if (xC + 1 >= inDims[1]) {
                     xTexelC${y}.zw = vec2(0.0);
                   }
                   xTexelC${y}Ready = 1;
                 }

                 xC${y} = xTexelC${y};
                 `,y+1<c)){const b=o%2===0?TA(u):u;u%2===0&&o%2===1||u%2!==0&&o%2!==1?(h+=`
                   xCOffset = xC + imod(pads[1], 2) + ${b};

                   if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${y+1}Ready == 0) {
                     xTexelC${y+1} = getX(batch, xR, xCOffset, d1);

                     // Need to manually clear unused channels in case
                     // we're reading from recycled texture.
                     if (xCOffset + 1 >= inDims[1]) {
                       xTexelC${y+1}.zw = vec2(0.0);
                     }
                     xTexelC${y+1}Ready = 1;
                   }
                   `,u>1?h+=`
                     xCOffset -= 2;
                     if (xCOffset >= 0 && xCOffset < inDims[1]) {
                      previous = getX(batch, xR, xCOffset, d1);
                      xC${y+1} = vec4(previous.zw, xTexelC${y+1}.xy);
                     } else {
                      xC${y+1} = vec4(0.0, 0.0, xTexelC${y+1}.xy);
                     }
                     `:h+=`
                     xC${y+1} = vec4(xTexelC${y}.zw, xTexelC${y+1}.xy);
                     `):b===1?h+=`
                     xC${y+1} = xTexelC${y};
                     `:h+=`
                     xCOffset = xC + ${b};

                     if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${y+1}Ready == 0) {
                       xTexelC${y+1} = getX(batch, xR, xCOffset, d1);
                       if (xCOffset + 1 >= inDims[1]) {
                         xTexelC${y+1}.zw = vec2(0.0);
                       }
                       xTexelC${y+1}Ready = 1;
                     }

                     xC${y+1} = xTexelC${y+1};
                     `}}else y<c&&(o%2===1?(h+=`
                 xCOffset = xC + 1 - strides[1];
                 if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${y}Ready == 0) {
                   xTexelC${y} = getX(batch, xR, xCOffset, d1);
                   // Need to manually clear unused channels in case
                   // we're reading from recycled texture.
                   if (xCOffset + 1 >= inDims[1]) {
                     xTexelC${y}.zw = vec2(0.0);
                   }
                   xTexelC${y}Ready = 1;
                 }

                 if(xC + 1 >= 0 && xC + 1 < inDims[1] && xTexelC${y+1}Ready == 0) {
                   xTexelC${y+1} = getX(batch, xR, xC + 1, d1);
                   // Need to manually clear unused channels in case
                   // we're reading from recycled texture.
                   if (xC + 2 >= inDims[1]) {
                     xTexelC${y+1}.zw = vec2(0.0);
                   }
                   xTexelC${y+1}Ready = 1;
                 }

                 xC${y} = vec4(xTexelC${y}.zw, xTexelC${y+1}.zw);
               `,y+1<c&&(h+=`
                   final = vec4(0.0);
                   xCOffset = xC + 1 + strides[1];
                   if(xCOffset >= 0 && xCOffset < inDims[1]) {
                     final = getX(batch, xR, xCOffset, d1);
                   }
                   xC${y+1} = vec4(xTexelC${y+1}.xy, final.xy);
                 `)):(h+=`
                 if(xC >= 0 && xC < inDims[1] && xTexelC${y}Ready == 0) {
                   xTexelC${y} = getX(batch, xR, xC, d1);
                   if (xC + 1 >= inDims[1]) {
                     xTexelC${y}.zw = vec2(0.0);
                   }
                   xTexelC${y}Ready = 1;
                 }

                 xCOffset = xC + strides[1];
                 if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${y+1}Ready == 0) {
                   xTexelC${y+1} = getX(batch, xR, xCOffset, d1);
                   if (xCOffset + 1 >= inDims[1]) {
                     xTexelC${y+1}.zw = vec2(0.);
                   }
                   xTexelC${y+1}Ready = 1;
                 }

                 xC${y} = vec4(
                   xTexelC${y}.xy, xTexelC${y+1}.xy);
               `,y+1<c&&(h+=`
                   xC${y+1} = vec4(xTexelC${y}.zw, xTexelC${y+1}.zw);
                 `)));y<c&&(h+=`
             wTexel = getW(r, ${y}, d1, d2);
             dotProd += xC${y}.xxzz * vec4(wTexel.xy, wTexel.xy);
             if(d1 + 1 < ${t.inChannels}) {
               dotProd += xC${y}.yyww * vec4(wTexel.zw, wTexel.zw);
             }
           `,y+1<c&&(h+=`
               wTexel = getW(r, ${y+1}, d1, d2);
               dotProd += xC${y+1}.xxzz * vec4(wTexel.xy, wTexel.xy);
               if(d1 + 1 < ${t.inChannels}) {
                 dotProd += xC${y+1}.yyww * vec4(wTexel.zw, wTexel.zw);
               }
             `))}h+=`
     }
   `,h+=`
     }
   `,h+=`
     }
   `;let d="",p="";r&&(i?d=`vec4 activation(vec4 a) {
           vec4 b = getPreluActivationWeightsAtOutCoords();
           ${r}
         }`:s?d=`vec4 activation(vec4 a) {
           vec4 b = getLeakyreluAlphaAtOutCoords();
           ${r}
         }`:d=`vec4 activation(vec4 x) {
           ${r}
         }`,p="result = activation(result);");const g=n?"result += getBiasAtOutCoords();":"";n&&this.variableNames.push("bias"),i&&this.variableNames.push("preluActivationWeights"),s&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
       ${d}

       void main() {
         ivec4 coords = getOutputCoords();
         int batch = coords.x;
         ivec2 xRCCorner = coords.yz * strides - pads;
         int d2 = coords.w;
         int xRCorner = xRCCorner.x;
         int xCCorner = xRCCorner.y;

         //intialize dotProd with a small epsilon seems to reduce GPU accuracy loss.
         vec4 dotProd = vec4(0.000000000000001);

         ${h}

         vec4 result = dotProd - vec4(0.000000000000001);
         ${g}
         ${p}
         setOutput(result);
       }
     `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class q8e{constructor(t,n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"inputShape",type:"ivec4"},{name:"pad",type:"ivec2"},{name:"stride",type:"ivec2"},{name:"dilation",type:"ivec2"},{name:"inChannels",type:"int"},{name:"itemsPerBlockRow",type:"int"},{name:"outWidth",type:"int"}],this.outputShape=t,this.enableShapeUniforms=Jr(this.outputShape.length);const{dataFormat:r}=n,i=Ni(),s=r==="channelsLast",o=s?1:2,a=s?2:3,u=this.enableShapeUniforms?"if(blockIndex < outShape[2] && pos < outShape[1]) {":`if(blockIndex < ${t[2]} && pos < ${t[1]}) {`;let l="";for(let c=0;c<=1;c++)for(let f=0;f<=1;f++)l+=`
          blockIndex = rc.z + ${f};
          pos = rc.y + ${c};

          ${u}
            offsetY = int(blockIndex / outWidth) * stride[0] - pad[0];
            d0 = offsetY + dilation[0] * (pos / itemsPerBlockRow);

            if(d0 < inputShape[${o}] && d0 >= 0) {
              // Use custom imod instead mod. On Intel GPU, mod may generate
              // unexpected value.
              // https://github.com/tensorflow/tfjs/issues/5447
              offsetX = imod(blockIndex, outWidth) * stride[1] - pad[1];
              d1 = offsetX + dilation[1] * (imod(pos, itemsPerBlockRow) /
                  inChannels);

              if(d1 < inputShape[${a}] && d1 >= 0) {

                ch = imod(pos, inChannels);

                if (${s}) {
                  innerDims = vec2(d1, ch);
                  result[${c*2+f}] = getChannel(
                    getA(rc.x, d0, int(innerDims.x),
                    int(innerDims.y)), innerDims);
                } else {
                  innerDims = vec2(d0, d1);
                  result[${c*2+f}] = getChannel(
                    getA(rc.x, ch, int(innerDims.x),
                    int(innerDims.y)), innerDims);
                }
              }
            }
          }
        `;this.userCode=`
      void main() {
        ivec3 rc = getOutputCoords();

        vec4 result = vec4(0);

        int blockIndex, pos, offsetY, d0, offsetX, d1, ch;
        vec2 innerDims;

        ${l}

        ${i.output} = result;
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nE(e,t){const n=e.length;return n>=3?t?[...e.slice(0,-3),e[n-3]*e[n-2],e[n-1]]:[...e.slice(0,-3),e[n-3],e[n-2]*e[n-1]]:!t&&n===1&&e[0]>1?[e[0],1]:null}function tae({x:e,filter:t,convInfo:n,backend:r,bias:i=null,preluActivationWeights:s=null,leakyreluAlpha:o=0,activation:a=null}){const u=e.shape,l=r.texData.get(e.dataId),c=n.inChannels,f=u[0]*u[1]*u[2],h=n.outChannels,d=n.dataFormat==="channelsLast",p=!1,g=!1;let m;const y=[];if(s!=null){const x=nE(s.shape,d);x!=null&&(s=Ce({inputs:{x:s},backend:r,attrs:{shape:x}}),y.push(s))}if(i!=null){const x=nE(i.shape,d);x!=null&&(i=Ce({inputs:{x:i},backend:r,attrs:{shape:x}}),y.push(i))}if(!((f===1||h===1)&&c>qoe)&&l.isPacked&&d&&l.texture!=null&&u[2]%2!==0&&bt(l.shape.slice(-3),u.slice(-3))){const x=u[0]*u[1]*(u[2]+1),w={dataId:e.dataId,shape:[1,x,n.inChannels],dtype:e.dtype},C=l.shape;l.shape=l.shape.slice(),l.shape[l.shape.length-2]++,N(eE(l.shape,w.shape),()=>`packed reshape ${l.shape} to ${w.shape} isn't free`);const $=Ce({inputs:{x:t},backend:r,attrs:{shape:[1,n.inChannels,n.outChannels]}});y.push($);const S=tE({a:w,b:$,backend:r,transposeA:p,transposeB:g,bias:i,activation:a,preluActivationWeights:s,leakyreluAlpha:o}),k=r.texData.get(S.dataId);N(k.isPacked,()=>"batchMatMul result is expected to be packed"),l.shape=C,k.shape=n.outShape,m=Ts({inputs:{x:S},backend:r}),m.shape=n.outShape,y.push(S)}else{const x=n.outHeight*n.outWidth,w=Ce({inputs:{x:e},backend:r,attrs:{shape:d?[n.batchSize,x,n.inChannels]:[n.batchSize,n.inChannels,x]}}),C=Ce({inputs:{x:t},backend:r,attrs:{shape:[1,n.inChannels,n.outChannels]}}),$=tE({a:d?w:C,b:d?C:w,transposeA:!d,transposeB:g,backend:r,bias:i,activation:a,preluActivationWeights:s,leakyreluAlpha:o});m=Ce({inputs:{x:$},backend:r,attrs:{shape:n.outShape}}),y.push(w),y.push(C),y.push($)}for(const x of y)r.disposeIntermediateTensorInfo(x);return m}function nae({x:e,filter:t,convInfo:n,backend:r,bias:i=null,preluActivationWeights:s=null,leakyreluAlpha:o=0,activation:a=null}){const{filterWidth:u,filterHeight:l,inChannels:c,outWidth:f,outHeight:h,dataFormat:d}=n,p=d==="channelsLast",g=u*l*c,m=h*f,y=[n.batchSize,g,m],b=!0,v=!1,x=[];if(s!=null){const L=nE(s.shape,p);L!=null&&(s=Ce({inputs:{x:s},backend:r,attrs:{shape:L}}),x.push(s))}if(i!=null){const L=nE(i.shape,p);L!=null&&(i=Ce({inputs:{x:i},backend:r,attrs:{shape:L}}),x.push(i))}const w=Ce({inputs:{x:t},backend:r,attrs:{shape:[1,g,te(t.shape)/g]}});x.push(w);const C=new q8e(y,n),$=[e.shape,[n.padInfo.top,n.padInfo.left],[n.strideHeight,n.strideWidth],[n.dilationHeight,n.dilationWidth],[n.inChannels],[n.filterWidth*n.inChannels],[n.outWidth]],S=r.runWebGLProgram(C,[e],"float32",$),k=Ce({inputs:{x:S},backend:r,attrs:{shape:y}});x.push(S),x.push(k);const E=i!=null,_=s!=null,D=a==="leakyrelu",A=a?tv(a,!0):null,T=new Hoe(p?k.shape:w.shape,p?w.shape:k.shape,p?[n.batchSize,m,n.outChannels]:[n.batchSize,n.outChannels,m],b,v,E,A,_,D),I=p?[k,w]:[w,k];if(i&&I.push(i),_&&I.push(s),D){const L=r.makeTensorInfo([],"float32",xc(o,"float32"));I.push(L),x.push(L)}const F=r.runWebGLProgram(T,I,"float32"),R=Ce({inputs:{x:F},backend:r,attrs:{shape:n.outShape}});x.push(F);for(const L of x)r.disposeIntermediateTensorInfo(L);return R}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function X8e(e){const{inputs:t,backend:n,attrs:r}=e,{x:i,filter:s}=t,{strides:o,pad:a,dataFormat:u,dilations:l,dimRoundingMode:c}=r,f=wc(u),h=dr(i.shape,s.shape,o,l,a,c,!1,f);let d;if(h.filterHeight===1&&h.filterWidth===1&&h.dilationHeight===1&&h.dilationWidth===1&&h.strideHeight===1&&h.strideWidth===1&&(h.padInfo.type==="SAME"||h.padInfo.type==="VALID"))d=tae({x:i,filter:s,convInfo:h,backend:n});else if(h.strideWidth<=2&&f==="channelsLast"&&K().getBool("WEBGL_EXP_CONV")){const g=new eae(h),m=[[h.padInfo.top,h.padInfo.left],[h.strideHeight,h.strideWidth],[h.dilationHeight,h.dilationWidth],[h.inHeight,h.inWidth]];d=n.runWebGLProgram(g,[i,s],"float32",m)}else if(K().getBool("WEBGL_CONV_IM2COL"))d=nae({x:i,filter:s,convInfo:h,backend:n});else{const g=new Qoe(h);d=n.runWebGLProgram(g,[i,s],"float32")}const p=Ce({inputs:{x:d},backend:n,attrs:{shape:h.outShape}});return n.disposeIntermediateTensorInfo(d),p}const Y8e={kernelName:L2,backendName:"webgl",kernelFunc:X8e};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class K8e{constructor(t){this.variableNames=["x","dy"],this.outputShape=t.filterShape;const n=t.strideHeight,r=t.strideWidth,i=t.padInfo.top,s=t.padInfo.left,o=t.dataFormat==="channelsLast";this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int wR = coords.x;
        int wC = coords.y;
        int d1 = coords.z;
        int d2 = coords.w;

        // Convolve x(?, ?, d1) with dy(:, :, d2) to get dw(wR, wC, d1, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int b = 0; b < ${t.batchSize}; b++) {
          for (int yR = 0; yR < ${t.outHeight}; yR++) {
            int xR = wR + yR * ${n} - ${i};

            if (xR < 0 || xR >= ${t.inHeight}) {
              continue;
            }

            for (int yC = 0; yC < ${t.outWidth}; yC++) {
              int xC = wC + yC * ${r} - ${s};

              if (xC < 0 || xC >= ${t.inWidth}) {
                continue;
              }

              ${o?`float dyValue = getDy(b, yR, yC, d2);
              float xValue = getX(b, xR, xC, d1);
              dotProd += (xValue * dyValue);`:`float dyValue = getDy(b, d2, yR, yC);
              float xValue = getX(b, d1, xR, xC);
              dotProd += (xValue * dyValue);`}
            }
          }
        }
        setOutput(dotProd);
      }
    `}}class Z8e{constructor(t){this.variableNames=["dy","W"],this.outputShape=t.inShape;const n=t.filterHeight,r=t.filterWidth,i=t.strideHeight,s=t.strideWidth,o=t.dataFormat==="channelsLast",a=n-1-t.padInfo.top,u=r-1-t.padInfo.left,l=o?1:2,c=o?2:3,f=o?3:1;this.userCode=`
      const ivec2 pads = ivec2(${a}, ${u});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[${f}];

        ivec2 dyCorner = ivec2(coords[${l}], coords[${c}]) - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${n}; wR++) {
          float dyR = float(dyRCorner + wR) / ${i}.0;

          if (dyR < 0.0 || dyR >= ${t.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          int wRPerm = ${n} - 1 - wR;

          for (int wC = 0; wC < ${r}; wC++) {
            float dyC = float(dyCCorner + wC) / ${s}.0;

            if (dyC < 0.0 || dyC >= ${t.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            int wCPerm = ${r} - 1 - wC;

            for (int d2 = 0; d2 < ${t.outChannels}; d2++) {

              if (${o}) {
                float xValue = getDy(batch, idyR, idyC, d2);
                float wValue = getW(wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              } else {
                float xValue = getDy(batch, d2, idyR, idyC);
                float wValue = getW(wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              }

            }
          }
        }
        setOutput(dotProd);
      }
    `}}class J8e{constructor(t){this.variableNames=["x","dy"],this.outputShape=t.filterShape;const n=t.strideDepth,r=t.strideHeight,i=t.strideWidth,s=t.padInfo.front,o=t.padInfo.top,a=t.padInfo.left;this.userCode=`
      void main() {
        ivec5 coords = getOutputCoords();
        int wF = coords.x;
        int wR = coords.y;
        int wC = coords.z;
        int d1 = coords.w;
        int d2 = coords.u;

        float dotProd = 0.0;

        for (int b = 0; b < ${t.batchSize}; b++) {
          for (int yF = 0; yF < ${t.outDepth}; yF++) {
            int xF = wF + yF * ${n} - ${s};

            if (xF < 0 || xF >= ${t.inDepth}) {
              continue;
            }

            for (int yR = 0; yR < ${t.outHeight}; yR++) {
              int xR = wR + yR * ${r} - ${o};

              if (xR < 0 || xR >= ${t.inHeight}) {
                continue;
              }

              for (int yC = 0; yC < ${t.outWidth}; yC++) {
                int xC = wC + yC * ${i} - ${a};

                if (xC < 0 || xC >= ${t.inWidth}) {
                  continue;
                }

                float dyValue = getDy(b, yF, yR, yC, d2);
                float xValue = getX(b, xF, xR, xC, d1);
                dotProd += (xValue * dyValue);
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}}class Q8e{constructor(t){this.variableNames=["dy","W"],this.outputShape=t.inShape;const n=t.filterDepth,r=t.filterHeight,i=t.filterWidth,s=t.strideDepth,o=t.strideHeight,a=t.strideWidth,u=n-1-t.padInfo.front,l=r-1-t.padInfo.top,c=i-1-t.padInfo.left;this.userCode=`
      const ivec3 pads = ivec3(${u}, ${l}, ${c});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int d1 = coords.u;


        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyFCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        float dotProd = 0.0;
        for (int wF = 0; wF < ${n}; wF++) {
          float dyF = float(dyFCorner + wF) / ${s}.0;

          if (dyF < 0.0 || dyF >= ${t.outDepth}.0 || fract(dyF) > 0.0) {
            continue;
          }
          int idyF = int(dyF);

          int wFPerm = ${n} - 1 - wF;

          for (int wR = 0; wR < ${r}; wR++) {
            float dyR = float(dyRCorner + wR) / ${o}.0;

            if (dyR < 0.0 || dyR >= ${t.outHeight}.0 ||
              fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            int wRPerm = ${r} - 1 - wR;

            for (int wC = 0; wC < ${i}; wC++) {
              float dyC = float(dyCCorner + wC) / ${a}.0;

              if (dyC < 0.0 || dyC >= ${t.outWidth}.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              int wCPerm = ${i} - 1 - wC;

              for (int d2 = 0; d2 < ${t.outChannels}; d2++) {
                float xValue = getDy(batch, idyF, idyR, idyC, d2);
                float wValue = getW(wFPerm, wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function e7e(e){const{inputs:t,backend:n,attrs:r}=e,{x:i,dy:s}=t,{strides:o,pad:a,dataFormat:u,dimRoundingMode:l,filterShape:c}=r,f=wc(u),h=dr(i.shape,c,o,1,a,l,!1,f),d=new K8e(h);return n.runWebGLProgram(d,[i,s],"float32")}const t7e={kernelName:BA,backendName:"webgl",kernelFunc:e7e};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class n7e{constructor(t){this.variableNames=["dy","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"strides",type:"vec2"}],this.outputShape=t.inShape,this.enableShapeUniforms=Jr(this.outputShape.length);const n=t.filterHeight,r=t.filterWidth,i=n-1-t.padInfo.top,s=r-1-t.padInfo.left;this.userCode=`
      const ivec2 pads = ivec2(${i}, ${s});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[3];

        ivec2 dyCorner = ivec2(coords[1], coords[2]) - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        vec4 result = vec4(0.);
        for (int wR = 0; wR < ${n}; wR++) {
          float dyR = float(dyRCorner + wR) / strides[0];
          if (dyR < 0.0 || dyR >= ${t.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);
          int wRPerm = ${n} - 1 - wR;

          for (int wC = 0; wC < ${r}; wC++) {
            int wCPerm = ${r} - 1 - wC;

            float dyC = float(dyCCorner + wC) / strides[1];
            bool idyCVal = (dyC >= 0.0) && (dyC < ${t.outWidth}.0)
              && (fract(dyC) == 0.0);
            int idyC = int(dyC);

            float dyC2 = float(dyCCorner + wC + 1) / strides[1];
            bool idyCVal2 = (dyC2 >= 0.0) && (dyC2 < ${t.outWidth}.0)
              && (fract(dyC2) == 0.0);
            int idyC2 = int(dyC2);

            if (idyCVal && idyCVal2) {
              for (int d2 = 0; d2 < ${t.outChannels}; d2 += 2) {
                vec4 wValue = getW(wRPerm, wCPerm, d1, d2);
                vec4 dySample = getDy(batch, idyR, idyC, d2);
                vec4 dySample2 = (idyC / 2 == idyC2 / 2) ?
                  dySample : getDy(batch, idyR, idyC2, d2);

                vec2 dyValue = mod(float(idyC), 2.) == 0. ?
                  dySample.xy : dySample.zw;
                result.xy += vec2(dot(dyValue, wValue.xy),
                  dot(dyValue, wValue.zw));

                dyValue = mod(float(idyC2), 2.) == 0. ?
                  dySample2.xy : dySample2.zw;
                result.zw += vec2(dot(dyValue, wValue.xy),
                  dot(dyValue, wValue.zw));
              }
            } else if (idyCVal) {
              for (int d2 = 0; d2 < ${t.outChannels}; d2 += 2) {
                vec4 wValue = getW(wRPerm, wCPerm, d1, d2);
                vec4 dySample = getDy(batch, idyR, idyC, d2);
                vec2 dyValue = mod(float(idyC), 2.) == 0. ?
                  dySample.xy : dySample.zw;
                result.xy += vec2(dot(dyValue, wValue.xy),
                  dot(dyValue, wValue.zw));
              }
            } else if (idyCVal2) {
              for (int d2 = 0; d2 < ${t.outChannels}; d2 += 2) {
                vec4 wValue = getW(wRPerm, wCPerm, d1, d2);
                vec4 dySample = getDy(batch, idyR, idyC2, d2);
                vec2 dyValue = mod(float(idyC2), 2.) == 0. ?
                  dySample.xy : dySample.zw;
                result.zw += vec2(dot(dyValue, wValue.xy),
                  dot(dyValue, wValue.zw));
              }
            }
          }
        }
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function r7e(e){const{inputs:t,backend:n,attrs:r}=e,{dy:i,filter:s}=t,{inputShape:o,strides:a,pad:u,dataFormat:l,dimRoundingMode:c}=r,f=wc(l),h=dr(o,s.shape,a,1,u,c,!1,f);if(K().getBool("WEBGL_PACK")&&f==="channelsLast"){const d=[[h.strideHeight,h.strideWidth]],p=new n7e(h);return n.runWebGLProgram(p,[i,s],"float32",d)}else{const d=new Z8e(h);return n.runWebGLProgram(d,[i,s],"float32")}}const i7e={kernelName:P2,backendName:"webgl",kernelFunc:r7e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function s7e(e){const{inputs:t,backend:n,attrs:r}=e,{x:i,filter:s}=t,{strides:o,pad:a,dilations:u}=r,l=kh(i.shape,s.shape,o,u,a),c=new H8e(l);return n.runWebGLProgram(c,[i,s],"float32")}const o7e={kernelName:B2,backendName:"webgl",kernelFunc:s7e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function a7e(e){const{inputs:t,backend:n,attrs:r}=e,{x:i,dy:s}=t,{strides:o,pad:a,filterShape:u}=r,l=kh(i.shape,u,o,1,a),c=new J8e(l);return n.runWebGLProgram(c,[i,s],"float32")}const u7e={kernelName:zA,backendName:"webgl",kernelFunc:a7e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function l7e(e){const{inputs:t,backend:n,attrs:r}=e,{dy:i,filter:s}=t,{pad:o,strides:a,inputShape:u}=r,l=kh(u,s.shape,a,1,o),c=new Q8e(l);return n.runWebGLProgram(c,[i,s],"float32")}const c7e={kernelName:UA,backendName:"webgl",kernelFunc:l7e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const f7e=J1+`
  return cos(x);
`,h7e=`
  vec4 result = cos(x);
  bvec4 isNaN = isnan(x);
  ${pg}
  return result;
`,d7e=vt({opSnippet:f7e,packedOpSnippet:h7e}),p7e={kernelName:n1,backendName:"webgl",kernelFunc:d7e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const g7e=`
  float e2x = exp(-x);
  return (e2x + 1.0 / e2x) / 2.0;
`,m7e=vt({opSnippet:g7e}),y7e={kernelName:r1,backendName:"webgl",kernelFunc:m7e};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class b7e{constructor(t,n,r,i,s){this.variableNames=["Image","Boxes","BoxInd"],this.outputShape=[];const[o,a,u,l]=t,[c]=n,[f,h]=r;this.outputShape=[c,f,h,l];const d=i==="bilinear"?1:0,[p,g]=[`${a-1}.0`,`${u-1}.0`],[m,y,b]=f>1?[`${(a-1)/(f-1)}`,"(y2-y1) * height_ratio",`y1*${p} + float(y)*(height_scale)`]:["0.0","0.0",`0.5 * (y1+y2) * ${p}`],[v,x,w]=h>1?[`${(u-1)/(h-1)}`,"(x2-x1) * width_ratio",`x1*${g} + float(x)*(width_scale)`]:["0.0","0.0",`0.5 * (x1+x2) * ${g}`];this.userCode=`
      const float height_ratio = float(${m});
      const float width_ratio = float(${v});
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int y = coords[1];
        int x = coords[2];
        int d = coords[3];

        // get box vals
        float y1 = getBoxes(b,0);
        float x1 = getBoxes(b,1);
        float y2 = getBoxes(b,2);
        float x2 = getBoxes(b,3);

        // get image in batch index
        int bInd = round(getBoxInd(b));
        if(bInd < 0 || bInd >= ${o}) {
          return;
        }

        float height_scale = ${y};
        float width_scale = ${x};

        float in_y = ${b};
        if( in_y < 0.0 || in_y > ${p} ) {
          setOutput(float(${s}));
          return;
        }
        float in_x = ${w};
        if( in_x < 0.0 || in_x > ${g} ) {
          setOutput(float(${s}));
          return;
        }

        vec2 sourceFracIndexCR = vec2(in_x,in_y);
        if(${d} == 1) {
          // Compute the four integer indices.
          ivec2 sourceFloorCR = ivec2(sourceFracIndexCR);
          ivec2 sourceCeilCR = ivec2(ceil(sourceFracIndexCR));

          float topLeft = getImage(b, sourceFloorCR.y, sourceFloorCR.x, d);
          float bottomLeft = getImage(b, sourceCeilCR.y, sourceFloorCR.x, d);
          float topRight = getImage(b, sourceFloorCR.y, sourceCeilCR.x, d);
          float bottomRight = getImage(b, sourceCeilCR.y, sourceCeilCR.x, d);

          vec2 fracCR = sourceFracIndexCR - vec2(sourceFloorCR);

          float top = topLeft + (topRight - topLeft) * fracCR.x;
          float bottom = bottomLeft + (bottomRight - bottomLeft) * fracCR.x;
          float newValue = top + (bottom - top) * fracCR.y;
          setOutput(newValue);
        } else {
          // Compute the coordinators of nearest neighbor point.
          ivec2 sourceNearestCR = ivec2(floor(
            sourceFracIndexCR + vec2(0.5,0.5)));
          float newValue = getImage(b, sourceNearestCR.y, sourceNearestCR.x, d);
          setOutput(newValue);
        }
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const x7e=e=>{const{inputs:t,backend:n,attrs:r}=e,{image:i,boxes:s,boxInd:o}=t,{cropSize:a,method:u,extrapolationValue:l}=r,c=new b7e(i.shape,s.shape,a,u,l);return n.runWebGLProgram(c,[i,s,o],"float32")},v7e={kernelName:WA,backendName:"webgl",kernelFunc:x7e};var rv;(function(e){e.Prod="*",e.Sum="+"})(rv||(rv={}));class DG{constructor(t,n,r,i){this.op=t,this.outputShape=n,this.variableNames=["x"],this.customUniforms=[{name:"index",type:"float"}];const s=this.outputShape.length,o=this.op===rv.Prod?"1.0":"0.0",a=r?o:`getX(${NG(s,"coords",this.op)})`,u=this.outputShape[this.outputShape.length-1];let l="",c="";r?(l=i?`end != ${u-1}`:"end != 0",c=i?"end + 1":"end - 1"):(l=i?`end + pow2 < ${u}`:"end >= pow2",c=i?"end + pow2":"end - pow2"),this.userCode=`
      void main() {
        ${Gt(s)} coords = getOutputCoords();
        int end = ${FG(s,"coords",this.op)};
        float val = ${a};
        int pow2 = int(pow(2.0, index));
        if (${l}) {
          int idx = ${c};
          ${FG(s,"coords",this.op)} = idx;
          val ${this.op}= getX(${NG(s,"coords",this.op)});
        }
        setOutput(val);
      }
    `}}function NG(e,t,n){if(e===1)return`${t}`;if(e===2)return`${t}.x, ${t}.y`;if(e===3)return`${t}.x, ${t}.y, ${t}.z`;if(e===4)return`${t}.x, ${t}.y, ${t}.z, ${t}.w`;throw new Error(`Cumulative ${n} for rank ${e} is not yet supported`)}function FG(e,t,n){if(e===1)return`${t}`;if(e===2)return`${t}.y`;if(e===3)return`${t}.z`;if(e===4)return`${t}.w`;throw new Error(`Cumulative ${n} for rank ${e} is not yet supported`)}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rae(e,t,n,r,i,s){const o=t.shape.length,a=Cn([r],o);let u=t;a!=null&&(u=Ii({inputs:{x:t},backend:n,attrs:{perm:a}}));const l=On(1,o)[0];if(l!==o-1)throw new Error(`WebGL cumprod shader expects an inner-most axis=${t.shape.length-1} but got axis=${r}`);const c=u.shape[l];let f=Ts({inputs:{x:u},backend:n});for(let h=0;h<=Math.ceil(Math.log2(c))-1;h++){const d=new DG(e,u.shape,!1,s),p=[[h]],g=f;f=n.runWebGLProgram(d,[f],f.dtype,p),n.disposeIntermediateTensorInfo(g)}if(i){const h=new DG(e,u.shape,i,s),d=f;f=n.runWebGLProgram(h,[f],f.dtype),n.disposeIntermediateTensorInfo(d)}if(a!=null){const h=Eh(a),d=Ii({inputs:{x:f},backend:n,attrs:{perm:h}});return n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(u),d}return f}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function w7e(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{axis:s,exclusive:o,reverse:a}=r;return rae(rv.Prod,i,n,s,o,a)}const $7e={kernelName:jA,backendName:"webgl",kernelFunc:w7e};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function C7e(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{axis:s,exclusive:o,reverse:a}=r;return rae(rv.Sum,i,n,s,o,a)}const S7e={kernelName:z2,backendName:"webgl",kernelFunc:C7e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function k7e(e){const{inputs:t,backend:n,attrs:r}=e,{x:i,weights:s}=t,{size:o,binaryOutput:a}=r;if(i.shape.length===1){const u=n.readSync(i.dataId),l=n.readSync(s.dataId),c=Loe(u,l,s.dtype,s.shape,o);return n.makeTensorInfo([o],s.dtype,c)}else if(i.shape.length===2){const u=n.bufferSync(i),l=n.bufferSync(s),c=T5e(u,l,o,a);return n.makeTensorInfo(c.shape,s.dtype,c.values)}throw new Error(`Error in denseBincount: input must be at most rank 2, but got rank${i.shape.length}.`)}const E7e={kernelName:VA,backendName:"webgl",kernelFunc:k7e};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class _7e{constructor(t,n,r){this.variableNames=["x"],this.outputShape=[],this.outputShape=t,this.blockSize=n,this.dataFormat=r,this.userCode=`
    void main() {
      ivec4 coords = getOutputCoords();
      int b = coords[0];
      int h = ${this.getHeightCoordString()};
      int w = ${this.getWidthCoordString()};
      int d = ${this.getDepthCoordString()};

      int in_h = h / ${n};
      int offset_h = imod(h, ${n});
      int in_w = w / ${n};
      int offset_w = imod(w, ${n});
      int offset_d = (offset_h * ${n} + offset_w) *
        ${this.getOutputDepthSize()};
      int in_d = d + offset_d;

      float result = ${this.getInputSamplingString()};
      setOutput(result);
    }
  `}getHeightCoordString(){return this.dataFormat==="NHWC"?"coords[1]":"coords[2]"}getWidthCoordString(){return this.dataFormat==="NHWC"?"coords[2]":"coords[3]"}getDepthCoordString(){return this.dataFormat==="NHWC"?"coords[3]":"coords[1]"}getOutputDepthSize(){return this.dataFormat==="NHWC"?this.outputShape[3]:this.outputShape[1]}getInputSamplingString(){return this.dataFormat==="NHWC"?"getX(b, in_h, in_w, in_d)":"getX(b, in_d, in_h, in_w)"}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function A7e(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{blockSize:s,dataFormat:o}=r,a=i.shape[0],u=o==="NHWC"?i.shape[1]:i.shape[2],l=o==="NHWC"?i.shape[2]:i.shape[3],c=o==="NHWC"?i.shape[3]:i.shape[1],f=u*s,h=l*s,d=c/(s*s),p=o==="NHWC"?[a,f,h,d]:[a,d,f,h],g=new _7e(p,s,o);return n.runWebGLProgram(g,[i],i.dtype)}const T7e={kernelName:GA,backendName:"webgl",kernelFunc:A7e};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class iae{constructor(t,n=!1,r=null,i=!1,s=!1){this.variableNames=["x","W"],this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=t.outShape,this.enableShapeUniforms=Jr(this.outputShape.length);const o=t.filterHeight,a=t.filterWidth,u=t.outChannels/t.inChannels;let l="",c="";r&&(i?l=`float activation(float a) {
          float b = getPreluActivationWeightsAtOutCoords();
          ${r}
        }`:s?l=`float activation(float a) {
          float b = getLeakyreluAlphaAtOutCoords();
          ${r}
        }`:l=`
          float activation(float x) {
            ${r}
          }
        `,c="result = activation(result);");const f=n?"result += getBiasAtOutCoords();":"";n&&this.variableNames.push("bias"),i&&this.variableNames.push("preluActivationWeights"),s&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
      ${l}

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        ivec2 xRCCorner = coords.yz * strides - pads;
        int d2 = coords.w;
        int d1 = d2 / ${u};
        int q = d2 - d1 * ${u};

        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // Convolve x(?, ?, d1) with w(:, :, d1, q) to get y(yR, yC, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        // TO DO(dsmilkov): Flatten the two for loops and vec4 the operations.
        for (int wR = 0; wR < ${o}; wR++) {
          int xR = xRCorner + wR * dilations[0];

          if (xR < 0 || xR >= inDims[0]) {
            continue;
          }

          for (int wC = 0; wC < ${a}; wC++) {
            int xC = xCCorner + wC * dilations[1];

            if (xC < 0 || xC >= inDims[1]) {
              continue;
            }

            float xVal = getX(batch, xR, xC, d1);
            float wVal = getW(wR, wC, d1, q);
            dotProd += xVal * wVal;
          }
        }

        float result = dotProd;
        ${f}
        ${c}
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class sae{constructor(t,n=!1,r=null,i=!1,s=!1){this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=t.outShape,this.enableShapeUniforms=Jr(this.outputShape.length);const o=t.outChannels/t.inChannels,a=t.padInfo.left,u=t.strideWidth,l=t.dilationWidth,c=t.filterHeight,f=t.filterWidth,h=f;let d=`
      int xR; int xC; int xCOffset;
      vec4 wTexel; vec4 previous; vec4 final;`;for(let y=0;y<f;y++)d+=`
          vec4 xTexelC${y*2};
          int xTexelC${y*2}Ready;
          vec4 xTexelC${y*2+1};
          int xTexelC${y*2+1}Ready;
          vec4 xC${y};`;d+=`
    for (int r = 0; r < ${c}; r++) {
      `;for(let y=0;y<f;y++)d+=`
          xTexelC${y*2} = vec4(0.0);
          xTexelC${y*2}Ready = 0;
          xTexelC${y*2+1} = vec4(0.0);
          xTexelC${y*2+1}Ready = 0;
          xC${y} = vec4(0.0);`;d+=`
        xR = xRCorner + r * dilations[0];
        if (xR >=0 && xR < inDims[0]) {
      `;for(let y=0;y<(h+1)/2;y++){const b=y*2;if(d+=`
          xC = xCCorner + ${b*l};
          `,u===1){if(b<f&&(a%2===1?(d+=`
                xCOffset = xC + 1;
                if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${b}Ready == 0) {
                  xTexelC${b} = getX(batch, xR, xCOffset, d1);

                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if (xCOffset + 1 >= inDims[1]) {
                    xTexelC${b}.zw = vec2(0.0);
                  }
                  xTexelC${b}Ready = 1;
                }
              `,l===1&&b>0?d+=`
                xC${b} = vec4(xTexelC${b-2}.zw, xTexelC${b}.xy);
                `:d+=`
                  xCOffset = xC + 1 - 2;

                  if (xCOffset >= 0 && xCOffset < inDims[1]) {
                    previous = getX(batch, xR, xCOffset, d1);

                    // Need to manually clear unused channels in case
                    // we're reading from recycled texture.
                    if (xCOffset + 1 >= inDims[1]) {
                      previous.zw = vec2(0.0);
                    }

                    xC${b} = vec4(previous.zw, xTexelC${b}.xy);
                  } else {
                    xC${b} = vec4(0.0, 0.0, xTexelC${b}.xy);
                  }
                  `):d+=`
                if (xC >= 0 && xC < inDims[1] && xTexelC${b}Ready == 0) {
                  xTexelC${b} = getX(batch, xR, xC, d1);
                  if (xC + 1 >= inDims[1]) {
                    xTexelC${b}.zw = vec2(0.0);
                  }
                  xTexelC${b}Ready = 1;
                }

                xC${b} = xTexelC${b};
                `,b+1<f)){const v=a%2===0?TA(l):l;l%2===0&&a%2===1||l%2!==0&&a%2!==1?(d+=`
                  xCOffset = xC + imod(pads[1], 2) + ${v};

                  if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${b+1}Ready == 0) {
                    xTexelC${b+1} = getX(batch, xR, xCOffset, d1);

                    // Need to manually clear unused channels in case
                    // we're reading from recycled texture.
                    if (xCOffset + 1 >= inDims[1]) {
                      xTexelC${b+1}.zw = vec2(0.0);
                    }
                    xTexelC${b+1}Ready = 1;
                  }
                  `,l>1?d+=`
                    xCOffset -= 2;
                    if (xCOffset >= 0 && xCOffset < inDims[1]) {
                     previous = getX(batch, xR, xCOffset, d1);
                     xC${b+1} = vec4(previous.zw, xTexelC${b+1}.xy);
                    } else {
                     xC${b+1} = vec4(0.0, 0.0, xTexelC${b+1}.xy);
                    }
                    `:d+=`
                    xC${b+1} = vec4(xTexelC${b}.zw, xTexelC${b+1}.xy);
                    `):v===1?d+=`
                    xC${b+1} = xTexelC${b};
                    `:d+=`
                    xCOffset = xC + ${v};

                    if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${b+1}Ready == 0) {
                      xTexelC${b+1} = getX(batch, xR, xCOffset, d1);
                      if (xCOffset + 1 >= inDims[1]) {
                        xTexelC${b+1}.zw = vec2(0.0);
                      }
                      xTexelC${b+1}Ready = 1;
                    }

                    xC${b+1} = xTexelC${b+1};
                    `}}else b<f&&(a%2===1?(d+=`
                xCOffset = xC + 1 - strides[1];
                if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${b}Ready == 0) {
                  xTexelC${b} = getX(batch, xR, xCOffset, d1);
                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if (xCOffset + 1 >= inDims[1]) {
                    xTexelC${b}.zw = vec2(0.0);
                  }
                  xTexelC${b}Ready = 1;
                }

                if(xC + 1 >= 0 && xC + 1 < inDims[1] && xTexelC${b+1}Ready == 0) {
                  xTexelC${b+1} = getX(batch, xR, xC + 1, d1);
                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if (xC + 2 >= inDims[1]) {
                    xTexelC${b+1}.zw = vec2(0.0);
                  }
                  xTexelC${b+1}Ready = 1;
                }

                xC${b} = vec4(xTexelC${b}.zw, xTexelC${b+1}.zw);
              `,b+1<f&&(d+=`
                  final = vec4(0.0);
                  xCOffset = xC + 1 + strides[1];
                  if(xCOffset >= 0 && xCOffset < inDims[1]) {
                    final = getX(batch, xR, xCOffset, d1);
                  }
                  xC${b+1} = vec4(xTexelC${b+1}.xy, final.xy);
                `)):(d+=`
                if(xC >= 0 && xC < inDims[1] && xTexelC${b}Ready == 0) {
                  xTexelC${b} = getX(batch, xR, xC, d1);
                  if (xC + 1 >= inDims[1]) {
                    xTexelC${b}.zw = vec2(0.0);
                  }
                  xTexelC${b}Ready = 1;
                }

                xCOffset = xC + strides[1];
                if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${b+1}Ready == 0) {
                  xTexelC${b+1} = getX(batch, xR, xCOffset, d1);
                  if (xCOffset + 1 >= inDims[1]) {
                    xTexelC${b+1}.zw = vec2(0.);
                  }
                  xTexelC${b+1}Ready = 1;
                }

                xC${b} = vec4(
                  xTexelC${b}.xy, xTexelC${b+1}.xy);
              `,b+1<f&&(d+=`
                  xC${b+1} = vec4(xTexelC${b}.zw, xTexelC${b+1}.zw);
                `)));b<f&&(d+=`
            wTexel = getW(r, ${b}, d1, q);
            dotProd += xC${b} * vec4(wTexel.xz, wTexel.xz);
          `,b+1<f&&(d+=`
              wTexel = getW(r, ${b+1}, d1, q);
              dotProd += xC${b+1} * vec4(wTexel.xz, wTexel.xz);
            `))}d+=`
    }
  `,d+=`
      }
    `;let p="",g="";r&&(i?p=`vec4 activation(vec4 a) {
          vec4 b = getPreluActivationWeightsAtOutCoords();
          ${r}
        }`:s?p=`vec4 activation(vec4 a) {
          vec4 b = getLeakyreluAlphaAtOutCoords();
          ${r}
        }`:p=`vec4 activation(vec4 x) {
          ${r}
        }`,g="result = activation(result);");const m=n?"result += getBiasAtOutCoords();":"";n&&this.variableNames.push("bias"),i&&this.variableNames.push("preluActivationWeights"),s&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
      ${p}

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        ivec2 xRCCorner = coords.yz * strides - pads;
        int d2 = coords.w;
        int d1 = d2 / ${o};
        int q = d2 - d1 * ${o};
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        //intialize dotProd with a small epsilon seems to reduce GPU accuracy loss.
        vec4 dotProd = vec4(0.000000000000001);

        ${d}

        vec4 result = dotProd - vec4(0.000000000000001);
        ${m}
        ${g}
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function I7e(e){const{inputs:t,backend:n,attrs:r}=e,{x:i,filter:s}=t,{strides:o,pad:a,dilations:u,dimRoundingMode:l}=r;let c=u;c==null&&(c=[1,1]),N(Or(o,c),()=>`Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ${o} and dilations '${c}'`);const f=dr(i.shape,s.shape,o,c,a,l,!0);let h;K().getBool("WEBGL_PACK_DEPTHWISECONV")&&f.strideWidth<=2&&f.outChannels/f.inChannels===1?h=new sae(f):h=new iae(f);const d=[[f.padInfo.top,f.padInfo.left],[f.strideHeight,f.strideWidth],[f.dilationHeight,f.dilationWidth],[f.inHeight,f.inWidth]];return n.runWebGLProgram(h,[i,s],"float32",d)}const D7e={kernelName:U2,backendName:"webgl",kernelFunc:I7e};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class N7e{constructor(t){this.variableNames=["x","dy"],this.outputShape=t.filterShape;const n=t.strideHeight,r=t.strideWidth,i=t.padInfo.top,s=t.padInfo.left,o=t.outChannels/t.inChannels;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int wR = coords.x;
        int wC = coords.y;
        int d1 = coords.z;
        int dm = coords.w;
        int d2 = d1 * ${o} + dm;

        float dotProd = 0.0;

        // TO DO: Vec4 over the batch size
        for (int b = 0; b < ${t.batchSize}; b++) {
          for (int yR = 0; yR < ${t.outHeight}; yR++) {
            int xR = wR + yR * ${n} - ${i};

            if (xR < 0 || xR >= ${t.inHeight}) {
              continue;
            }

            for (int yC = 0; yC < ${t.outWidth}; yC++) {
              int xC = wC + yC * ${r} - ${s};

              if (xC < 0 || xC >= ${t.inWidth}) {
                continue;
              }

              float dyValue = getDy(b, yR, yC, d2);
              float xValue = getX(b, xR, xC, d1);
              dotProd += (xValue * dyValue);
            }
          }
        }
        setOutput(dotProd);
      }
    `}}class F7e{constructor(t){this.variableNames=["dy","W"],this.outputShape=t.inShape;const n=t.filterHeight,r=t.filterWidth,i=t.strideHeight,s=t.strideWidth,o=n-1-t.padInfo.top,a=r-1-t.padInfo.left,u=t.outChannels/t.inChannels;this.userCode=`
      const ivec2 pads = ivec2(${o}, ${a});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[3];
        ivec2 dyCorner = coords.yz - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        float dotProd = 0.0;

        for (int wR = 0; wR < ${n}; wR++) {
          float dyR = float(dyRCorner + wR) / ${i}.0;

          if (dyR < 0.0 || dyR >= ${t.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          int wRPerm = ${n} - 1 - wR;

          for (int wC = 0; wC < ${r}; wC++) {
            float dyC = float(dyCCorner + wC) / ${s}.0;

            if (dyC < 0.0 || dyC >= ${t.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            int wCPerm = ${r} - 1 - wC;

            // TO DO: Vec4 over the channelMul
            for (int dm = 0; dm < ${u}; dm++) {
              int d2 = d1 * ${u} + dm;
              float xValue = getDy(batch, idyR, idyC, d2);
              float wValue = getW(wRPerm, wCPerm, d1, dm);
              dotProd += xValue * wValue;
            }
          }
        }
        setOutput(dotProd);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function O7e(e){const{inputs:t,backend:n,attrs:r}=e,{x:i,dy:s}=t,{strides:o,dilations:a,pad:u,dimRoundingMode:l,filterShape:c}=r,f=dr(i.shape,c,o,a,u,l,!0),h=new N7e(f);return n.runWebGLProgram(h,[i,s],"float32")}const R7e={kernelName:HA,backendName:"webgl",kernelFunc:O7e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function M7e(e){const{inputs:t,backend:n,attrs:r}=e,{dy:i,filter:s}=t,{strides:o,dilations:a,pad:u,dimRoundingMode:l,inputShape:c}=r,f=dr(c,s.shape,o,a,u,l,!0),h=new F7e(f);return n.runWebGLProgram(h,[i,s],"float32")}const L7e={kernelName:qA,backendName:"webgl",kernelFunc:M7e};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class P7e{constructor(t){this.variableNames=["X"],this.outputShape=[t,t],this.userCode=`
      void main() {
          ivec2 coords = getOutputCoords();
          float val = coords[0] == coords[1] ? getX(coords[0]) : 0.0;
          setOutput(val);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function B7e(e){const{inputs:t,backend:n}=e,{x:r}=t,i=[...r.shape,...r.shape],s=te(r.shape),o=Ce({inputs:{x:r},backend:n,attrs:{shape:[s]}}),a=new P7e(s),u=n.runWebGLProgram(a,[o],o.dtype),l=Ce({inputs:{x:u},backend:n,attrs:{shape:i}});return n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(u),l}const z7e={kernelName:XA,backendName:"webgl",kernelFunc:B7e};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class U7e{constructor(t){this.variableNames=["x","W"],this.outputShape=t.outShape;const{inHeight:n,inWidth:r,padInfo:i,strideHeight:s,strideWidth:o,filterHeight:a,filterWidth:u,dilationHeight:l,dilationWidth:c}=t,{top:f,left:h}=i;this.userCode=`
      const ivec2 strides = ivec2(${s}, ${o});
      const ivec2 pads = ivec2(${f}, ${h});
      const float neg_infinity = -3.4e38;

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        int d1 = coords.w;
        ivec2 outTopLeftCorner =
            coords.yz * strides - pads;
        int hBeg = outTopLeftCorner.x;
        int wBeg = outTopLeftCorner.y;

        float curVal = neg_infinity;
        for (int h = 0; h < ${a}; h++) {
          int hIn = hBeg + h * ${l};

          if (hIn >= 0 && hIn < ${n}) {
            for (int w = 0; w < ${u}; w++) {
              int wIn = wBeg + w * ${c};

              if (wIn >= 0 && wIn < ${r}) {
                float xVal = getX(batch, hIn, wIn, d1);
                float wVal = getW(h, w, d1);

                float val = xVal + wVal;
                if (val > curVal) {
                  curVal = val;
                }
              }
            }
          }
        }

        float result = curVal;
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function j7e(e){const{inputs:t,backend:n,attrs:r}=e,{x:i,filter:s}=t,{strides:o,pad:a,dilations:u}=r,l=Dw(i.shape,s.shape,o,a,"NHWC",u);let c;const f=new U7e(l);c=n.runWebGLProgram(f,[i,s],"float32");const h=Ce({inputs:{x:c},backend:n,attrs:{shape:l.outShape}});return n.disposeIntermediateTensorInfo(c),h}const W7e={kernelName:j2,backendName:"webgl",kernelFunc:j7e};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function V7e(e){const{inputs:t,backend:n,attrs:r}=e,{equation:i}=r,s=t,{allDims:o,summedDims:a,idDims:u}=C5(i,s.length);k5(o.length,u,s);const{path:l,steps:c}=E5(a,u),f=c.length;let h=null,d=o.length;const p=[];for(let g=0;g<f;++g){for(const m of c[g]){const{permutationIndices:y,expandDims:b}=S5(d,u[m]);let v;_5(y)?v=s[m]:(v=Ii({inputs:{x:s[m]},backend:n,attrs:{perm:y}}),p.push(v));const x=v.shape.slice();for(let w=0;w<b.length;++w)x.splice(b[w],0,1);bt(v.shape,x)||(v=Ce({inputs:{x:v},backend:n,attrs:{shape:x}}),p.push(v)),h===null?h=v:(h=g6({inputs:{a:v,b:h},backend:n}),p.push(h))}g<f-1&&(l[g]>=0&&(h=FI({inputs:{x:h},backend:n,attrs:{axis:l[g]-(o.length-d),keepDims:!1}}),p.push(h)),d--)}for(const g of p)g!==h&&n.disposeIntermediateTensorInfo(g);return h}const G7e={kernelName:KA,backendName:"webgl",kernelFunc:V7e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const H7e="return (x >= 0.0) ? x : (exp(x) - 1.0);",q7e=`
  vec4 result;

  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);
  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);
  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);
  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);

  return result;
`,X7e=vt({opSnippet:H7e,packedOpSnippet:q7e}),Y7e={kernelName:s1,backendName:"webgl",kernelFunc:X7e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const K7e="return (b >= 0.0) ? a : a * (b + 1.0);",Z7e=`
  vec4 bGTEZero = vec4(greaterThanEqual(b, vec4(0.)));
  return (bGTEZero * a) + ((vec4(1.0) - bGTEZero) * (a * (b + vec4(1.0))));
`,J7e=e=>{const{inputs:t,backend:n}=e,{dy:r,y:i}=t,s=K().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Z1(Z7e,r.shape,i.shape):new Cp(K7e,r.shape,i.shape);return n.runWebGLProgram(s,[r,i],r.dtype)},Q7e={kernelName:ZA,backendName:"webgl",kernelFunc:J7e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const e9e=`
  return vec4(equal(a, b));
`,t9e="return float(a == b);",n9e=Mr({opSnippet:t9e,packedOpSnippet:e9e,dtype:"bool",cpuKernelImpl:O5e}),r9e={kernelName:W2,backendName:"webgl",kernelFunc:n9e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const i9e=`
  // Error function is calculated approximately with elementary function.
  // See "Handbook of Mathematical Functions with Formulas,
  // Graphs, and Mathematical Tables", Abramowitz and Stegun.
  float p = ${m5};
  float a1 = ${y5};
  float a2 = ${b5};
  float a3 = ${x5};
  float a4 = ${v5};
  float a5 = ${w5};

  float sign = sign(x);
  x = abs(x);
  float t = 1.0 / (1.0 + p * x);
  return sign * (1.0 - (((((a5*t + a4)*t) + a3)*t + a2)*t + a1)*t*exp(-x*x));
`,s9e=vt({opSnippet:i9e}),o9e={kernelName:o1,backendName:"webgl",kernelFunc:s9e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const a9e=J1+`
  return exp(x);
`,u9e=`
  vec4 result = exp(x);
  bvec4 isNaN = isnan(x);
  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,oae=vt({opSnippet:a9e,packedOpSnippet:u9e,cpuKernelImpl:R5e,dtype:"float32"}),l9e={kernelName:a1,backendName:"webgl",kernelFunc:oae};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vM(e){const{inputs:t,attrs:n,backend:r}=e,{dim:i}=n,{input:s}=t,o=s.shape.length,a=s.shape.slice();let u=i;return i<0&&(N(-(o+1)<=i,()=>`Axis must be in the interval [${-(o+1)}, ${o}]`),u=o+i+1),a.splice(u,0,1),Ce({inputs:{x:s},backend:r,attrs:{shape:a}})}const c9e={kernelName:V2,backendName:"webgl",kernelFunc:vM};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const OG="return exp(x) - 1.0;",f9e=vt({opSnippet:OG,packedOpSnippet:OG,cpuKernelImpl:M5e}),h9e={kernelName:u1,backendName:"webgl",kernelFunc:f9e};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class RG{constructor(t,n,r){this.variableNames=["real","imag"];const i=n[1];this.outputShape=n;const s=r?`2.0 * ${Math.PI}`:`-2.0 * ${Math.PI}`,o=r?`${i}.0`:"1.0";let a;if(t==="real")a="return real * expR - imag * expI;";else if(t==="imag")a="return real * expI + imag * expR;";else throw new Error(`FFT component must be either "real" or "imag", got ${t}.`);this.userCode=`
      const float exponentMultiplier = ${s};

      float unaryOpComplex(float real, float expR, float imag, float expI) {
        ${a}
      }

      float mulMatDFT(int batch, int index) {
        float indexRatio = float(index) / float(${i});
        float exponentMultiplierTimesIndexRatio =
            exponentMultiplier * indexRatio;

        float result = 0.0;

        for (int i = 0; i < ${i}; i++) {
          // x = (-2|2 * PI / N) * index * i;
          float x = exponentMultiplierTimesIndexRatio * float(i);
          float expR = cos(x);
          float expI = sin(x);
          float real = getReal(batch, i);
          float imag = getImag(batch, i);

          result +=
              unaryOpComplex(real, expR, imag, expI) / ${o};
        }

        return result;
      }

      void main() {
        ivec2 coords = getOutputCoords();
        setOutput(mulMatDFT(coords[0], coords[1]));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function aae(e,t,n){const r=n.texData.get(e.dataId),i=te(e.shape),s=e.shape[e.shape.length-1],o=i/s,a=Ce({inputs:{x:e},backend:n,attrs:{shape:[o,s]}}),u=a.shape,l=new RG("real",u,t),c=new RG("imag",u,t),f=[{dataId:r.complexTensorInfos.real.dataId,dtype:r.complexTensorInfos.real.dtype,shape:u},{dataId:r.complexTensorInfos.imag.dataId,dtype:r.complexTensorInfos.imag.dtype,shape:u}],h=n.runWebGLProgram(l,f,"float32"),d=n.runWebGLProgram(c,f,"float32"),p=Nh({inputs:{real:h,imag:d},backend:n});n.disposeIntermediateTensorInfo(h),n.disposeIntermediateTensorInfo(d);const g=Ce({inputs:{x:p},backend:n,attrs:{shape:e.shape}});return n.disposeIntermediateTensorInfo(a),n.disposeIntermediateTensorInfo(p),g}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function d9e(e){const{inputs:t,backend:n}=e,{input:r}=t;return aae(r,!1,n)}const p9e={kernelName:JA,backendName:"webgl",kernelFunc:d9e};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class g9e{constructor(t,n){this.outputShape=[],this.customUniforms=[{name:"value",type:"float"}],this.variableNames=["x"],this.outputShape=t,this.userCode=`
      void main() {
        // Input can be obtained from uniform value.
        setOutput(value);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function e$(e){const{backend:t,attrs:n}=e,{shape:r,value:i}=n;let{dtype:s}=n;if(s=s||tg(i),s==="string"){const o=En(s,te(r));return o.fill(i),t.makeTensorInfo(r,s,o)}else{const o=new g9e(r,i),a=[[i]];return t.runWebGLProgram(o,[],s,a)}}const m9e={kernelName:QA,backendName:"webgl",kernelFunc:e$};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class y9e{constructor(t){this.variableNames=["Image"],this.outputShape=[];const n=t[2];this.outputShape=t,this.userCode=`
        void main() {
          ivec4 coords = getOutputCoords();
          int x = coords[2];

          int coordX = ${n} - x - 1;
          float outputValue;
          if(coordX >= 0 && coordX < ${n}) {
            outputValue = getImage(coords[0], coords[1], coordX, coords[3]);
          } else {
            outputValue = getImage(coords[0], coords[1], coords[2], coords[3]);
          }
          setOutput(outputValue);
        }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const b9e={kernelName:eT,backendName:"webgl",kernelFunc:({inputs:e,backend:t})=>{const{image:n}=e,r=t,i=new y9e(n.shape);return r.runWebGLProgram(i,[n],n.dtype)}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const MG="return floor(x);",x9e=vt({opSnippet:MG,packedOpSnippet:MG,cpuKernelImpl:L5e}),v9e={kernelName:l1,backendName:"webgl",kernelFunc:x9e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const w9e=`
  float s = sign(a) * sign(b);
  int ia = round(a);
  int ib = round(b);
  if (ib != 0) {
    // Windows (D3D) wants guaranteed non-zero int division at compile-time.
    return float(idiv(ia, ib, s));
  } else {
    return NAN;
  }
`,$9e=`
  ivec4 ia = round(a);
  ivec4 ib = round(b);
  bvec4 cond = notEqual(ib, ivec4(0));
  ivec4 result = ivec4(0);
  vec4 s = sign(a) * sign(b);

  // Windows (D3D) wants guaranteed non-zero int division at compile-time.
  if (cond[0]) {
    result[0] = idiv(ia[0], ib[0], s[0]);
  }
  if (cond[1]) {
    result[1] = idiv(ia[1], ib[1], s[1]);
  }
  if (cond[2]) {
    result[2] = idiv(ia[2], ib[2], s[2]);
  }
  if (cond[3]) {
    result[3] = idiv(ia[3], ib[3], s[3]);
  }
  return vec4(result);
`,C9e=Mr({opSnippet:w9e,packedOpSnippet:$9e,dtype:"int32"}),S9e={kernelName:c1,backendName:"webgl",kernelFunc:C9e};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class k9e{constructor(t){this.variableNames=["A"];const n=Ni(),[r,i]=t;this.outputShape=t,this.userCode=`
      void main() {
        ivec3 coords = getOutputCoords();
        int texR = coords[0];
        int texC = coords[1];
        int depth = coords[2];
        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${i}.0, ${r}.0);

        vec4 values = ${n.texture2D}(A, uv);
        float value;
        if (depth == 0) {
          value = values.r;
        } else if (depth == 1) {
          value = values.g;
        } else if (depth == 2) {
          value = values.b;
        } else if (depth == 3) {
          value = values.a;
        }

        setOutput(floor(value * 255.0 + 0.5));
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class E9e{constructor(t){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;const n=Ni(),[r,i]=t;this.outputShape=t,this.userCode=`
      void main() {
        ivec3 coords = getOutputCoords();
        int texR = coords[0];
        int texC = coords[1];
        int depth = coords[2];

        vec4 result = vec4(0.);

        for(int row=0; row<=1; row++) {
          for(int col=0; col<=1; col++) {
            texC = coords[1] + row;
            depth = coords[2] + col;

            vec2 uv = (vec2(texC, texR) + halfCR) /
                       vec2(${i}.0, ${r}.0);
            vec4 values = ${n.texture2D}(A, uv);
            float value;
            if (depth == 0) {
              value = values.r;
            } else if (depth == 1) {
              value = values.g;
            } else if (depth == 2) {
              value = values.b;
            } else if (depth == 3) {
              value = values.a;
            }

            result[row * 2 + col] = floor(value * 255.0 + 0.5);
          }
        }

        ${n.output} = result;
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _9e={kernelName:Fk,backendName:"webgl",kernelFunc:A9e};let Kg,g3=K().getBool("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU");function A9e(e){const{inputs:t,backend:n,attrs:r}=e;let{pixels:i}=t;const{numChannels:s}=r,o=typeof HTMLVideoElement<"u"&&i instanceof HTMLVideoElement,a=typeof HTMLImageElement<"u"&&i instanceof HTMLImageElement,[u,l]=o?[i.videoWidth,i.videoHeight]:[i.width,i.height],c=[l,u],f=[l,u,s];if(a||o){const g=K().getBool("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU");(Kg==null||g!==g3)&&(g3=g,Kg=document.createElement("canvas").getContext("2d",{willReadFrequently:g3})),Kg.canvas.width=u,Kg.canvas.height=l,Kg.drawImage(i,0,0,u,l),i=Kg.canvas}const h=n.makeTensorInfo(c,"int32");n.texData.get(h.dataId).usage=Ks.PIXELS,n.gpgpu.uploadPixelDataToTexture(n.getTexture(h.dataId),i);const d=K().getBool("WEBGL_PACK")?new E9e(f):new k9e(f),p=n.runWebGLProgram(d,[h],"int32");return n.disposeData(h.dataId),p}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function T9e(e){const{inputs:t,backend:n,attrs:r}=e,{x:i,filter:s,bias:o,preluActivationWeights:a}=t,{strides:u,pad:l,dataFormat:c,dilations:f,dimRoundingMode:h,activation:d,leakyreluAlpha:p}=r,g=wc(c),m=dr(i.shape,s.shape,u,f,l,h,!1,g);let y;const b=[],v=o!=null,x=a!=null,w=d==="leakyrelu",C=()=>{const S=[i,s],k=(E,_)=>{if(_==="NCHW"&&E.shape.length===1&&E.shape[0]!==1){const D=Ce({inputs:{x:E},backend:n,attrs:{shape:[E.shape[0],1,1]}});return b.push(D),D}return E};if(v&&S.push(k(o,c)),x&&S.push(k(a,c)),w){const E=n.makeTensorInfo([],"float32",xc(p,"float32"));S.push(E),b.push(E)}return S};if(m.filterHeight===1&&m.filterWidth===1&&m.dilationHeight===1&&m.dilationWidth===1&&m.strideHeight===1&&m.strideWidth===1&&(m.padInfo.type==="SAME"||m.padInfo.type==="VALID"))y=tae({x:i,filter:s,convInfo:m,backend:n,bias:o,activation:d,preluActivationWeights:a,leakyreluAlpha:p});else if(m.strideWidth<=2&&g==="channelsLast"&&K().getBool("WEBGL_EXP_CONV")){const S=d?tv(d,!0):null,k=new eae(m,v,S,x,w),E=[[m.padInfo.top,m.padInfo.left],[m.strideHeight,m.strideWidth],[m.dilationHeight,m.dilationWidth],[m.inHeight,m.inWidth]],_=C();y=n.runWebGLProgram(k,_,"float32",E)}else if(K().getBool("WEBGL_CONV_IM2COL"))y=nae({x:i,filter:s,convInfo:m,backend:n,bias:o,activation:d,preluActivationWeights:a,leakyreluAlpha:p});else{const S=d?tv(d,!1):null,k=new Qoe(m,v,S,x,w),E=C();y=n.runWebGLProgram(k,E,"float32")}const $=Ce({inputs:{x:y},backend:n,attrs:{shape:m.outShape}});return b.push(y),b.forEach(S=>n.disposeIntermediateTensorInfo(S)),$}const I9e={kernelName:Lx,backendName:"webgl",kernelFunc:T9e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function D9e(e){const{inputs:t,backend:n,attrs:r}=e,{x:i,filter:s,bias:o,preluActivationWeights:a}=t,{strides:u,pad:l,dilations:c,dimRoundingMode:f,activation:h,leakyreluAlpha:d}=r,p=[];let g=c;g==null&&(g=[1,1]),N(Or(u,g),()=>`Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ${u} and dilations '${g}'`);const m=dr(i.shape,s.shape,u,g,l,f,!0),y=K().getBool("WEBGL_PACK_DEPTHWISECONV")&&m.strideWidth<=2&&m.outChannels/m.inChannels===1,b=h?tv(h,y):null,v=[i,s],x=o!=null,w=a!=null,C=h==="leakyrelu";if(x&&v.push(o),w&&v.push(a),C){const E=n.makeTensorInfo([],"float32",xc(d,"float32"));v.push(E),p.push(E)}let $;y?$=new sae(m,x,b,w,C):$=new iae(m,x,b,w,C);const S=[[m.padInfo.top,m.padInfo.left],[m.strideHeight,m.strideWidth],[m.dilationHeight,m.dilationWidth],[m.inHeight,m.inWidth]],k=n.runWebGLProgram($,v,"float32",S);return p.forEach(E=>n.disposeIntermediateTensorInfo(E)),k}const N9e={kernelName:Px,backendName:"webgl",kernelFunc:D9e};class F9e{constructor(t,n,r,i){this.sliceDim=t,this.strides=n,this.paramsShape=i,this.variableNames=["x","indices"],this.outputShape=r;const s=Gt(r.length);let o=`
    int index;`;for(let a=0;a<this.sliceDim;a++)o+=`
          index = round(getIndices(coords[0], ${a}));
          out_of_bounds = out_of_bounds || index < 0;
          out_of_bounds = out_of_bounds || index >= ${this.paramsShape[a]};
          flattenIndex += index * ${this.strides[a]};`;this.userCode=`
         void main() {
          ${s} coords = getOutputCoords();
          int flattenIndex = 0;
          bool out_of_bounds = false;

          ${o}

          setOutput(out_of_bounds ? 0.0 : getX(flattenIndex, coords[1]));
        }
      `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function O9e(e){const{inputs:t,backend:n}=e,{params:r,indices:i}=t,s=i.shape,o=s[s.length-1],a=te(r.shape),[u,l,c,f]=dI(r,i),h=Ce({inputs:{x:i},backend:n,attrs:{shape:[l,o]}}),d=Ce({inputs:{x:r},backend:n,attrs:{shape:[te(r.shape)/c,c]}});if(n.shouldExecuteOnCPU([r,i])||r.dtype==="string"){const y=n.readSync(i.dataId),b=n.bufferSync(r),v=P5e(y,b,r.dtype,l,o,c,f,r.shape,a);return n.makeTensorInfo(u,r.dtype,v.values)}const p=new F9e(o,f,[l,c],r.shape),g=n.runWebGLProgram(p,[d,h],d.dtype),m=Ce({inputs:{x:g},backend:n,attrs:{shape:u}});return n.disposeIntermediateTensorInfo(h),n.disposeIntermediateTensorInfo(d),n.disposeIntermediateTensorInfo(g),m}const R9e={kernelName:tT,backendName:"webgl",kernelFunc:O9e};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class M9e{constructor(t,n){this.variableNames=["A","indices"],this.outputShape=n,this.rank=n.length;const r=Gt(this.rank),i=L9e(t);this.userCode=`
      void main() {
        ${r} resRC = getOutputCoords();
        int index = int(getIndices(resRC.x, resRC.z));
        float inBounds = (index >= 0) && (index < ${t[2]}) ? 1.0 : 0.0;
        setOutput(inBounds * getA(${i}));
      }
    `}}function L9e(e,t){const n=["resRC.x","resRC.y","resRC.z","resRC.w"],r=[];for(let i=0;i<e.length;i++)i===2?r.push("index"):r.push(`${n[i]}`);return r.join()}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uae(e){const{inputs:t,backend:n,attrs:r}=e,{x:i,indices:s}=t,{axis:o,batchDims:a}=r,u=st(o,i.shape)[0];if(K().get("DEBUG")){const b=n.readSync(s.dataId),v=i.shape[u];for(let x=0;x<b.length;++x){const w=b[x];N(w<=v-1&&w>=0,()=>`GatherV2: the index value ${w} is not in [0, ${v-1}]`)}}const l=T5(i,s,u,a),c=te(s.shape),f=[],h=Ce({inputs:{x:i},backend:n,attrs:{shape:[l.batchSize,l.outerSize,l.dimSize,l.sliceSize]}}),d=Ce({inputs:{x:s},backend:n,attrs:{shape:[l.batchSize,c/l.batchSize]}});f.push(h),f.push(d);const p=[l.batchSize,l.outerSize,c/l.batchSize,l.sliceSize];if(n.shouldExecuteOnCPU([i,s])||i.dtype==="string"){const b=n.bufferSync(d),v=n.bufferSync(h),x=B5e(v,b,p);return f.forEach(w=>n.disposeIntermediateTensorInfo(w)),n.makeTensorInfo(l.outputShape,x.dtype,x.values)}const g=new M9e(h.shape,p),m=n.runWebGLProgram(g,[h,d],h.dtype);f.push(m);const y=Ce({inputs:{x:m},backend:n,attrs:{shape:l.outputShape}});return f.forEach(b=>n.disposeIntermediateTensorInfo(b)),y}const P9e={kernelName:H2,backendName:"webgl",kernelFunc:uae};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const B9e="return float(a > b);",z9e=`
  return vec4(greaterThan(a, b));
`,U9e=Mr({opSnippet:B9e,packedOpSnippet:z9e,cpuKernelImpl:z5e,dtype:"bool"}),j9e={kernelName:q2,backendName:"webgl",kernelFunc:U9e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const W9e="return float(a >= b);",V9e=`
  return vec4(greaterThanEqual(a, b));
`,G9e=Mr({opSnippet:W9e,packedOpSnippet:V9e,dtype:"bool",cpuKernelImpl:U5e}),H9e={kernelName:f1,backendName:"webgl",kernelFunc:G9e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function q9e(e){const{inputs:t,backend:n}=e,{input:r}=t;return aae(r,!0,n)}const X9e={kernelName:nT,backendName:"webgl",kernelFunc:q9e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Y9e="return float(!isnan(x) && !isinf(x));",K9e=vt({opSnippet:Y9e,dtype:"bool"}),Z9e={kernelName:d1,backendName:"webgl",kernelFunc:K9e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const J9e="return float(isinf(x));",Q9e=vt({opSnippet:J9e,dtype:"bool"}),eUe={kernelName:p1,backendName:"webgl",kernelFunc:Q9e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const tUe="return float(isnan(x));",nUe=vt({opSnippet:tUe,dtype:"bool"}),rUe={kernelName:g1,backendName:"webgl",kernelFunc:nUe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const iUe="return float(a < b);",sUe=`
  return vec4(lessThan(a, b));
`,oUe=Mr({opSnippet:iUe,packedOpSnippet:sUe,cpuKernelImpl:j5e,dtype:"bool"}),aUe={kernelName:Y2,backendName:"webgl",kernelFunc:oUe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const uUe="return float(a <= b);",lUe=`
  return vec4(lessThanEqual(a, b));
`,cUe=Mr({opSnippet:uUe,packedOpSnippet:lUe,cpuKernelImpl:W5e,dtype:"bool"}),fUe={kernelName:K2,backendName:"webgl",kernelFunc:cUe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hUe(e){const{backend:t,attrs:n}=e,{start:r,stop:i,num:s}=n,o=V5e(r,i,s);return t.makeTensorInfo([o.length],"float32",o)}const dUe={kernelName:iT,backendName:"webgl",kernelFunc:hUe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const pUe=J1+`
  return x < 0.0 ? 0./0. : log(x);
`,gUe=`
  vec4 result = log(x);
  bvec4 isNaN = isnan(x);
  result.r = isNaN.r ? x.r : (x.r < 0.0 ? 0./0. : result.r);
  result.g = isNaN.g ? x.g : (x.g < 0.0 ? 0./0. : result.g);
  result.b = isNaN.b ? x.b : (x.b < 0.0 ? 0./0. : result.b);
  result.a = isNaN.a ? x.a : (x.a < 0.0 ? 0./0. : result.a);
  return result;
`,mUe=vt({opSnippet:pUe,packedOpSnippet:gUe,cpuKernelImpl:G5e}),yUe={kernelName:m1,backendName:"webgl",kernelFunc:mUe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const bUe=J1+`
  return log(1.0 + x);
`,xUe=vt({opSnippet:bUe}),vUe={kernelName:y1,backendName:"webgl",kernelFunc:xUe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wUe="return float(a >= 1.0 && b >= 1.0);",$Ue=`
  return vec4(
    vec4(greaterThanEqual(a, vec4(1.0))) *
    vec4(greaterThanEqual(b, vec4(1.0))));
`,CUe=Mr({opSnippet:wUe,packedOpSnippet:$Ue,dtype:"bool"}),SUe={kernelName:Z2,backendName:"webgl",kernelFunc:CUe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const kUe="return float(!(x >= 1.0));",EUe=vt({opSnippet:kUe}),_Ue={kernelName:J2,backendName:"webgl",kernelFunc:EUe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const AUe="return float(a >= 1.0 || b >= 1.0);",TUe=`
  return min(
    vec4(greaterThanEqual(a, vec4(1.0))) +
    vec4(greaterThanEqual(b, vec4(1.0))),
    vec4(1.0));
`,IUe=Mr({opSnippet:AUe,packedOpSnippet:TUe,dtype:"bool"}),DUe={kernelName:Q2,backendName:"webgl",kernelFunc:IUe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class NUe{constructor(t,n,r,i,s){this.variableNames=["x"],this.outputShape=[];const o=n,a=t[3]-1;this.outputShape=t;let u;const l=`float(${r}) + float(${i}) * sum`;s===.5?u=`inversesqrt(${l})`:s===1?u=`1.0/(${l})`:u=`exp(log(${l}) * float(-${s}));`,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int r = coords[1];
        int c = coords[2];
        int d = coords[3];
        float x = getX(b, r, c, d);
        float sum = 0.0;
        for (int j = -${o}; j <= ${o}; j++) {
          int idx = d + j;
          if (idx >= 0 && idx <=  ${a}) {
            float z = getX(b, r, c, idx);
            sum += z * z;
          }
        }
        float val = x * ${u};
        setOutput(val);
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class FUe{constructor(t,n,r,i,s){this.variableNames=["x"],this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0;const o=n,a=t[3]-1;this.outputShape=t;let u;const l=`float(${r}) + float(${i}) * sum`;s===.5?u=`inversesqrt(${l})`:s===1?u=`1.0/(${l})`:u=`exp(log(${l}) * float(-${s}));`,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords.x;
        int r = coords.y;
        int c = coords.z;
        int d = coords.w;

        bool hasNextCol = d < ${this.outputShape[3]};
        bool hasNextRow = c < ${this.outputShape[2]};

        vec4 sum = vec4(0.);
        vec4 xFragAtOutputCoords = getX(b, r, c, d);

        vec4 xAtOutputCoords = vec4(
          getChannel(xFragAtOutputCoords, vec2(c, d)),
          hasNextCol ?
            getChannel(xFragAtOutputCoords, vec2(c, d + 1)) : 0.0,
          hasNextRow ?
            getChannel(xFragAtOutputCoords , vec2(c + 1, d)) : 0.0,
          (hasNextRow && hasNextCol) ?
            getChannel(xFragAtOutputCoords, vec2(c + 1, d + 1)) : 0.0
        );

        int firstChannel = d - ${o};
        vec2 cache = vec2(0.);
        if(firstChannel >= 0){
          vec4 firstChannelFrag = getX(b, r, c, firstChannel);
          cache.x = getChannel(firstChannelFrag, vec2(c, firstChannel));
            if(hasNextRow){
              cache.y = getChannel(firstChannelFrag, vec2(c + 1, firstChannel));
            }
        }

        ivec2 depth = ivec2(d, d + 1);
        for (int j = - ${o}; j <= ${o}; j++) {
          ivec2 idx = depth + j;
          bvec2 aboveLowerBound = greaterThanEqual(idx, ivec2(0));
          bvec2 belowUpperBound = lessThanEqual(idx, ivec2(${a}));

          bool depthInRange = aboveLowerBound.x && belowUpperBound.x;
          bool depthPlusOneInRange = aboveLowerBound.y && belowUpperBound.y;

          if(depthInRange || depthPlusOneInRange){
            vec4 z = vec4(0.);
            vec4 xFragAtCurrentDepth;
            z.xz = cache.xy;
            if(depthPlusOneInRange && hasNextCol){
              xFragAtCurrentDepth = idx.y != d ?
                getX(b, r, c, idx.y) : xFragAtOutputCoords;
              z.y = getChannel(xFragAtCurrentDepth, vec2(c, idx.y));
              if(hasNextRow){
                z.w = getChannel(xFragAtCurrentDepth, vec2(c + 1, idx.y));
              }
            }
            cache.xy = z.yw;
            sum += z * z;
          }
        }
        vec4 result = xAtOutputCoords * ${u};
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const OUe=e=>{const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{depthRadius:s,bias:o,alpha:a,beta:u}=r,l=K().getBool("WEBGL_PACK_NORMALIZATION")?new FUe(i.shape,s,o,a,u):new NUe(i.shape,s,o,a,u);return n.runWebGLProgram(l,[i],i.dtype)},RUe={kernelName:ew,backendName:"webgl",kernelFunc:OUe};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class MUe{constructor(t,n,r,i,s){this.variableNames=["inputImage","outputImage","dy"],this.outputShape=[],this.outputShape=t,this.depth=t[3],this.depthRadius=n,this.bias=r,this.alpha=i,this.beta=s,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int r = coords[1];
        int c = coords[2];

        float result = 0.0;
        for (int d = 0; d < ${this.depth}; ++d) {
          int depthBegin = int(max(0.0, float(d - ${n})));
          int depthEnd = int(min(float(${this.depth}),
              float(d + ${n} + 1)));

          const int MIN_DEPTH_BEGIN = 0;
          const int MAX_DEPTH_END = ${this.depth};

          float norm = 0.0;
          for (int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k) {
            if (k < depthBegin){
              continue;
            }
            else if (k >= depthBegin && k < depthEnd) {
              norm += getInputImage(b, r, c, k) * getInputImage(b, r, c, k);
            }
            else {
              break;
            }
          }

          norm = float(${i}) * norm + float(${r});

          for(int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k){
            if (k < depthBegin){
              continue;
            }
            else if (k >= depthBegin && k < depthEnd){
              float dyi = -2.0 * float(${i})
                * float(${s})
                * getInputImage(b, r, c, k) * getOutputImage(b, r, c, d)
                / norm;
              if (k == d) {
                dyi += pow(norm, -1.0 * ${s});
              }
              if (k == coords[3]) {
                dyi *= getDy(b, r, c, d);
                result += dyi;
              }
            }
            else {
              break;
            }
          }
      }
      setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const LUe=e=>{const{inputs:t,backend:n,attrs:r}=e,{x:i,y:s,dy:o}=t,{depthRadius:a,bias:u,alpha:l,beta:c}=r,f=new MUe(i.shape,a,u,l,c);return n.runWebGLProgram(f,[i,s,o],i.dtype)},PUe={kernelName:sT,backendName:"webgl",kernelFunc:LUe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function BUe(e,t,n,r){const i=te(t),o=te(e.shape)/i,a=Ce({inputs:{x:e},attrs:{shape:[o,i]},backend:r}),u=gg(a,e.dtype,"max",r),l=Ce({inputs:{x:u},attrs:{shape:n},backend:r});return r.disposeIntermediateTensorInfo(a),r.disposeIntermediateTensorInfo(u),l}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lae(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{reductionIndices:s,keepDims:o}=r,a=i.shape.length,u=st(s,i.shape);let l=u;const c=Cn(l,a),f=c!=null,h=n.shouldExecuteOnCPU([i]);let d=i;if(f){if(h){const v=n.texData.get(d.dataId).values,x=new Array(a);for(let $=0;$<x.length;$++)x[$]=i.shape[c[$]];const w=d6(v,i.shape,i.dtype,c,x);d=n.makeTensorInfo(x,i.dtype);const C=n.texData.get(d.dataId);C.values=w}else d=NI(i,c,n);l=On(l.length,a)}Rr("max",l,a);const[p,g]=pr(d.shape,l);let m=p;o&&(m=Fn(p,u));let y;if(h){const v=n.texData.get(d.dataId).values,x=H5e(v,te(g),m,i.dtype);y=n.makeTensorInfo(m,i.dtype);const w=n.texData.get(y.dataId);w.values=x}else y=BUe(d,g,m,n);return f&&n.disposeIntermediateTensorInfo(d),y}const zUe={kernelName:tw,backendName:"webgl",kernelFunc:lae};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const UUe=p6+`
  return max(a, b);
`,jUe=`
  vec4 result = vec4(max(a, b));
  bvec4 isNaNA = isnan(a);
  bvec4 isNaNB = isnan(b);
  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);
  `+pg+`
  return result;
`,WUe=Mr({opSnippet:UUe,packedOpSnippet:jUe,cpuKernelImpl:q5e}),VUe={kernelName:b1,backendName:"webgl",kernelFunc:WUe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function GUe(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t;Zw(i,"maxPool");const{filterSize:s,strides:o,pad:a,dimRoundingMode:u}=r,l=1;N(Or(o,l),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${o} and dilations '${l}'`);const c=Ho(i.shape,s,o,l,a,u);if(c.filterWidth===1&&c.filterHeight===1&&bt(c.inShape,c.outShape))return Ts({inputs:{x:i},backend:n});const f=new nv(c,"max",!1);return n.runWebGLProgram(f,[i],i.dtype)}const HUe={kernelName:nw,backendName:"webgl",kernelFunc:GUe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qUe(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{filterSize:s,strides:o,pad:a,dataFormat:u,dimRoundingMode:l}=r,c=[1,1,1],f=vc(i.shape,s,o,c,a,l,u),h=new m6(f,"max",!1);return n.runWebGLProgram(h,[i],i.dtype)}const XUe={kernelName:rw,backendName:"webgl",kernelFunc:qUe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class YUe{constructor(t){this.variableNames=["dy","maxPos"],this.outputShape=t.inShape;const n=t.strideHeight,r=t.strideWidth,i=t.dilationHeight,s=t.effectiveFilterHeight,o=t.effectiveFilterWidth,a=s-1-t.padInfo.top,u=o-1-t.padInfo.left,l=s*o-1;this.userCode=`
      const ivec2 pads = ivec2(${a}, ${u});

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];

        ivec2 dyRCCorner = coords.yz - pads;
        int dyRCorner = dyRCCorner.x;
        int dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${s};
          wR += ${i}) {
          float dyR = float(dyRCorner + wR) / ${n}.0;

          if (dyR < 0.0 || dyR >= ${t.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          for (int wC = 0; wC < ${o}; wC++) {
            float dyC = float(dyCCorner + wC) / ${r}.0;

            if (dyC < 0.0 || dyC >= ${t.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            float dyValue = getDy(b, idyR, idyC, d);
            int maxPosValue = ${l} - int(getMaxPos(b, idyR, idyC, d));

            // Get the current value, check it against the value from the
            // position matrix.
            int curPosValue = wR * ${o} + wC;
            float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);

            dotProd += dyValue * mask;
          }
        }
        setOutput(dotProd);
      }
    `}}class KUe{constructor(t){this.variableNames=["dy","maxPos"],this.outputShape=t.inShape;const n=t.strideDepth,r=t.strideHeight,i=t.strideWidth,s=t.dilationDepth,o=t.dilationHeight,a=t.dilationWidth,u=t.effectiveFilterDepth,l=t.effectiveFilterHeight,c=t.effectiveFilterWidth,f=u-1-t.padInfo.front,h=l-1-t.padInfo.top,d=c-1-t.padInfo.left,p=u*l*c-1;this.userCode=`
      const ivec3 pads = ivec3(${f}, ${h}, ${d});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyDCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        // Convolve dy(?, ?, ?, ch) with pos mask(:, :, :, d) to get
        // dx(xD, xR, xC, ch).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int wD = 0; wD < ${u};
           wD += ${s}) {
          float dyD = float(dyDCorner + wD) / ${n}.0;

          if (dyD < 0.0 || dyD >= ${t.outDepth}.0 || fract(dyD) > 0.0) {
            continue;
          }
          int idyD = int(dyD);

          for (int wR = 0; wR < ${l};
              wR += ${o}) {
            float dyR = float(dyRCorner + wR) / ${r}.0;

            if (dyR < 0.0 || dyR >= ${t.outHeight}.0 ||
                fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            for (int wC = 0; wC < ${c};
                wC += ${a}) {
              float dyC = float(dyCCorner + wC) / ${i}.0;

              if (dyC < 0.0 || dyC >= ${t.outWidth}.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              float dyValue = getDy(batch, idyD, idyR, idyC, ch);
              int maxPosValue = ${p} -
                  int(getMaxPos(batch, idyD, idyR, idyC, ch));

              // Get the current value, check it against the value from the
              // position matrix.
              int curPosValue =
                  wD * ${l} * ${c} +
                  wR * ${c} + wC;
              float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);

              dotProd += dyValue * mask;
            }
          }
        }
        setOutput(dotProd);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ZUe(e){const{inputs:t,backend:n,attrs:r}=e,{dy:i,input:s}=t,o=s,{filterSize:a,strides:u,pad:l,dimRoundingMode:c}=r,f=[1,1,1],h=vc(o.shape,a,u,f,l,c),d=new m6(h,"max",!0),p=n.runWebGLProgram(d,[o],o.dtype),g=new KUe(h),m=n.runWebGLProgram(g,[i,p],o.dtype);return n.disposeIntermediateTensorInfo(p),m}const JUe={kernelName:aT,backendName:"webgl",kernelFunc:ZUe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function QUe(e){const{inputs:t,backend:n,attrs:r}=e,{dy:i,input:s,output:o}=t,a=s;Zw([s,o],"maxPoolGrad");const{filterSize:u,strides:l,pad:c,dimRoundingMode:f}=r,h=Ho(a.shape,u,l,1,c,f),d=!0,p=new nv(h,"max",d),g=n.runWebGLProgram(p,[a],a.dtype),m=new YUe(h),y=n.runWebGLProgram(m,[i,g],a.dtype);return n.disposeIntermediateTensorInfo(g),y}const eje={kernelName:oT,backendName:"webgl",kernelFunc:QUe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tje(e,t,n,r){let i=new nv(n,"max",!1);const s=r.runWebGLProgram(i,[e],"float32");i=new nv(n,"max",!0,!0,t);const o=r.runWebGLProgram(i,[e],"float32");return[s,o]}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nje={kernelName:uT,backendName:"webgl",kernelFunc:({inputs:e,attrs:t,backend:n})=>{const{x:r}=e,{filterSize:i,strides:s,pad:o,includeBatchInIndex:a}=t,u=n;N(r.shape.length===4,()=>`Error in maxPool: input must be rank 4 but got rank ${r.shape.length}.`);const l=[1,1];N(Or(s,l),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${s} and dilations '${l}'`);const c=Ho(r.shape,i,s,l,o),[f,h]=tje(r,a,c,u);return[f,h]}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rje(e,t,n,r){const i=te(t),o=te(e.shape)/i,a=Ce({inputs:{x:e},attrs:{shape:[o,i]},backend:r}),u=gg(a,"float32","mean",r),l=Ce({inputs:{x:u},attrs:{shape:n},backend:r});return r.disposeIntermediateTensorInfo(a),r.disposeIntermediateTensorInfo(u),l}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ije={kernelName:iw,backendName:"webgl",kernelFunc:({inputs:e,attrs:t,backend:n})=>{const{x:r}=e,{keepDims:i,axis:s}=t,o=n,a=r.shape.length,u=st(s,r.shape);let l=u;const c=Cn(l,a),f=c!=null,h=o.shouldExecuteOnCPU([r]),d=[];let p=r;if(f){if(h){const x=o.texData.get(p.dataId).values,w=new Array(a);for(let S=0;S<w.length;S++)w[S]=r.shape[c[S]];const C=d6(x,r.shape,r.dtype,c,w);p=o.makeTensorInfo(w,r.dtype);const $=o.texData.get(p.dataId);$.values=C}else p=NI(r,c,o);d.push(p),l=On(l.length,a)}Rr("sum",l,a);const[g,m]=pr(p.shape,l);let y=g;i&&(y=Fn(g,u));const b=rje(p,m,y,o);for(const v of d)o.disposeIntermediateTensorInfo(v);return b}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sje(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{axis:s,keepDims:o}=r,a=i.shape.length,u=st(s,i.shape);let l=u;const c=Cn(l,a);let f=i;c!=null&&(f=Ii({inputs:{x:i},backend:n,attrs:{perm:c}}),l=On(l.length,i.shape.length)),Rr("min",l,a);const[h,d]=pr(f.shape,l),p=te(d),g=Ce({inputs:{x:f},backend:n,attrs:{shape:[-1,p]}}),m=gg(g,g.dtype,"min",n);let y;if(o){const b=Fn(h,u);y=Ce({inputs:{x:m},backend:n,attrs:{shape:b}})}else y=Ce({inputs:{x:m},backend:n,attrs:{shape:h}});return n.disposeIntermediateTensorInfo(g),n.disposeIntermediateTensorInfo(m),c!=null&&n.disposeIntermediateTensorInfo(f),y}const oje={kernelName:sw,backendName:"webgl",kernelFunc:sje};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const aje=p6+`
  return min(a, b);
`,uje=`
  vec4 result = vec4(min(a, b));
  bvec4 isNaNA = isnan(a);
  bvec4 isNaNB = isnan(b);
  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);
  `+pg+`
  return result;
`,lje=Mr({opSnippet:aje,packedOpSnippet:uje,cpuKernelImpl:X5e}),cje={kernelName:x1,backendName:"webgl",kernelFunc:lje};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class fje{constructor(t,n,r){this.variableNames=["x"],this.outputShape=n.map((c,f)=>c[0]+t[f]+c[1]);const i=t.length,s=Gt(i),o=n.map(c=>c[0]).join(","),a=n.map((c,f)=>c[0]+t[f]).join(","),u=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,i),l=r==="reflect"?0:1;if(i===1){this.userCode=`
        int start = ${o};
        int end = ${a};

        void main() {
          int outC = getOutputCoords();
          if (outC < start) {
            outC = start * 2 - outC - ${l};
          } else if(outC >= end) {
            outC = (end - 1) * 2 - outC + ${l};
          }
          setOutput(getX(outC - start));
        }
      `;return}this.userCode=`
      ${s} start = ${s}(${o});
      ${s} end = ${s}(${a});

      void main() {
        ${s} outC = getOutputCoords();
        for (int i = 0; i < ${i}; i++) {
          if (outC[i] < start[i]) {
            outC[i] = start[i] * 2 - outC[i] - ${l};
          } else if(outC[i] >= end[i]) {
            outC[i] = (end[i] - 1) * 2 - outC[i] + ${l};
          }
        }
        ${s} coords = outC - start;
        setOutput(getX(${u}));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class hje{constructor(t,n,r){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=n.map((p,g)=>p[0]+t[g]+p[1]);const i=t.length,s=Gt(i),o=n.map(p=>p[0]).join(","),a=n.map((p,g)=>p[0]+t[g]).join(","),u=pi("rc",i),l=pi("source",i),c=`${u[i-1]} < ${this.outputShape[i-1]}`,f=i===1?"source":`vec2(${l.slice(-2).join()})`,h=r==="reflect"?0:1;let d="";if(i===1){const p=`
        ${s} source = rc;
        if (source < start) {
          source = start * 2 - source - ${h};
        } else if (source >= end) {
          source = (end - 1) * 2 - source + ${h};
        }
        source -= start;
      `;d=`
        ${s} rc = outputLoc;
        ${p}
        result[0] = getChannel(getX(${l.join()}), ${f});
        ${u[i-1]} += 1;
        if(${c}) {
          ${p}
          result[1] = getChannel(getX(${l.join()}), ${f});
        }
      `}else{const p=`
        ${s} source = rc;
        ${s} lt = ${s}(lessThan(source, start));
        ${s} gte = ${s}(greaterThanEqual(source, end));
        ${s} orig = 1 - (lt + gte);
        source = orig * source +
                lt * (start * 2 - source - ${h}) +
                gte * ((end - 1) * 2 - source + ${h});
        source -= start;
      `;d=`
        ${s} rc = outputLoc;
        ${p}
        result[0] = getChannel(getX(${l.join()}), ${f});
        ${u[i-1]} += 1;
        if(${c}) {
          ${p}
          result[1] = getChannel(getX(${l.join()}), ${f});
        }
        rc = outputLoc;
        ${u[i-2]} += 1;
        if(${u[i-2]} < ${this.outputShape[i-2]}) {
          ${p}
          result[2] = getChannel(getX(${l.join()}), ${f});
          ${u[i-1]} += 1;
          if(${c}) {
            ${p}
            result[3] = getChannel(getX(${l.join()}), ${f});
          }
        }
      `}this.userCode=`
      const ${s} start = ${s}(${o});
      const ${s} end = ${s}(${a});

      void main() {
        ${s} outputLoc = getOutputCoords();
        vec4 result = vec4(0.);
        ${d}
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const dje=({inputs:e,backend:t,attrs:n})=>{const{x:r}=e,{paddings:i,mode:s}=n,o=K().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new hje(r.shape,i,s):new fje(r.shape,i,s);return t.runWebGLProgram(o,[r],r.dtype)},pje={kernelName:ow,backendName:"webgl",kernelFunc:dje};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gje=`if (b == 0.0) return NAN;
  return mod(a, b);`,mje=`
  vec4 result = mod(a, b);
  bvec4 isNaN = equal(b, vec4(0.0));
  `+pg+`
  return result;
`,yje=Mr({opSnippet:gje,packedOpSnippet:mje}),bje={kernelName:v1,backendName:"webgl",kernelFunc:yje};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class xje{constructor(t,n,r){this.variableNames=["probs"],this.customUniforms=[{name:"seed",type:"float"}],this.outputShape=[t,r],this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];

        float r = random(seed);
        float cdf = 0.0;

        for (int i = 0; i < ${n-1}; i++) {
          cdf += getProbs(batch, i);

          if (r < cdf) {
            setOutput(float(i));
            return;
          }
        }

        // If no other event happened, last event happened.
        setOutput(float(${n-1}));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const vje=`
if (a == b) {
  return 1.0;
};
return a / b;`,wje=`
  // vec4 one = vec4(equal(a, b));
  // return one + (vec4(1.0) - one) * a / b;
  vec4 result = a / b;
  if(a.x == b.x) {
    result.x = 1.;
  }
  if(a.y == b.y) {
    result.y = 1.;
  }
  if(a.z == b.z) {
    result.z = 1.;
  }
  if(a.w == b.w) {
    result.w = 1.;
  }

  return result;
`,cae=Mr({opSnippet:vje,packedOpSnippet:wje,checkOutOfBounds:!0}),$je={kernelName:i1,backendName:"webgl",kernelFunc:cae};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const LG="return a - b;",fae=Mr({opSnippet:LG,packedOpSnippet:LG,supportsComplex:!0,cpuKernelImpl:g6e}),Cje={kernelName:M1,backendName:"webgl",kernelFunc:fae};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hae(e){const{inputs:t,backend:n,attrs:r}=e,{logits:i}=t,{dim:s}=r,o=st([s],i.shape),a=lae({inputs:{x:i},backend:n,attrs:{reductionIndices:o,keepDims:!1}}),u=Fn(a.shape,o),l=Ce({inputs:{x:a},backend:n,attrs:{shape:u}}),c=fae({inputs:{a:i,b:l},backend:n}),f=oae({inputs:{x:c},backend:n}),h=FI({inputs:{x:f},backend:n,attrs:{axis:o,keepDims:!1}}),d=Ce({inputs:{x:h},backend:n,attrs:{shape:u}}),p=cae({inputs:{a:f,b:d},backend:n});return n.disposeIntermediateTensorInfo(a),n.disposeIntermediateTensorInfo(l),n.disposeIntermediateTensorInfo(c),n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(h),n.disposeIntermediateTensorInfo(d),p}const Sje={kernelName:Sw,backendName:"webgl",kernelFunc:hae};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kje(e){const{inputs:t,backend:n,attrs:r}=e,{logits:i}=t,{numSamples:s,seed:o,normalized:a}=r,u=a?i:hae({inputs:{logits:i},backend:n,attrs:{dim:i.shape.length-1}}),l=u.shape[0],c=u.shape[1],f=new xje(l,c,s),h=[[o]],d=n.runWebGLProgram(f,[u],"int32",h);return a||n.disposeIntermediateTensorInfo(u),d}const Eje={kernelName:lT,backendName:"webgl",kernelFunc:kje};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _je=Xo+`
  return -x;
`,Aje=`
  vec4 result = -x;
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`;function Tje(e){const{inputs:t,backend:n}=e,{x:r}=t;if(n.shouldExecuteOnCPU([r])){const s=n.texData.get(r.dataId),[o,a]=K5e(s.values,r.shape,r.dtype);return n.makeTensorInfo(a,r.dtype,o)}let i;return K().getBool("WEBGL_PACK_UNARY_OPERATIONS")?i=new sf(r.shape,Aje):i=new xu(r.shape,_je),n.runWebGLProgram(i,[r],r.dtype)}const Ije={kernelName:aw,backendName:"webgl",kernelFunc:Tje};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Dje=lI;function Nje(e){Hs("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");const{inputs:t,backend:n,attrs:r}=e,{boxes:i,scores:s}=t,{maxOutputSize:o,iouThreshold:a,scoreThreshold:u}=r,l=n.readSync(i.dataId),c=n.readSync(s.dataId),{selectedIndices:f}=Dje(l,c,o,a,u);return n.makeTensorInfo([f.length],"int32",new Int32Array(f))}const Fje={kernelName:cT,backendName:"webgl",kernelFunc:Nje};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Oje=cI;function Rje(e){Hs("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");const{inputs:t,backend:n,attrs:r}=e,{boxes:i,scores:s}=t,{maxOutputSize:o,iouThreshold:a,scoreThreshold:u,padToMaxOutputSize:l}=r,c=n.readSync(i.dataId),f=n.readSync(s.dataId),{selectedIndices:h,validOutputs:d}=Oje(c,f,o,a,u,l);return[n.makeTensorInfo([h.length],"int32",new Int32Array(h)),n.makeTensorInfo([],"int32",new Int32Array([d]))]}const Mje={kernelName:fT,backendName:"webgl",kernelFunc:Rje};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Lje=fI;function Pje(e){Hs("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");const{inputs:t,backend:n,attrs:r}=e,{boxes:i,scores:s}=t,{maxOutputSize:o,iouThreshold:a,scoreThreshold:u,softNmsSigma:l}=r,c=n.readSync(i.dataId),f=n.readSync(s.dataId),h=o,d=a,p=u,g=l,{selectedIndices:m,selectedScores:y}=Lje(c,f,h,d,p,g);return[n.makeTensorInfo([m.length],"int32",new Int32Array(m)),n.makeTensorInfo([y.length],"float32",new Float32Array(y))]}const Bje={kernelName:hT,backendName:"webgl",kernelFunc:Pje};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class zje{constructor(t,n,r,i){this.variableNames=["indices"],this.outputShape=[t,n],this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int index = round(getIndices(coords.x));
        setOutput(mix(float(${i}), float(${r}),
                      float(index == coords.y)));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Uje=e=>{const{inputs:t,backend:n,attrs:r}=e,{indices:i}=t,{dtype:s,depth:o,onValue:a,offValue:u}=r,l=te(i.shape),c=new zje(l,o,a,u),f=Ce({inputs:{x:i},backend:n,attrs:{shape:[l]}}),h=n.runWebGLProgram(c,[f],s);n.disposeIntermediateTensorInfo(f);const d=[...i.shape,o],p=Ce({inputs:{x:h},backend:n,attrs:{shape:d}});return n.disposeIntermediateTensorInfo(h),p},jje={kernelName:cw,backendName:"webgl",kernelFunc:Uje};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rE(e){const{inputs:t,backend:n}=e,{x:r}=t;if(r.dtype==="complex64"){const i=Qw({inputs:{input:r},backend:n}),s=rE({inputs:{x:i},backend:n}),o=OI({inputs:{input:r},backend:n}),a=rE({inputs:{x:o},backend:n}),u=Nh({inputs:{real:s,imag:a},backend:n});return n.disposeIntermediateTensorInfo(i),n.disposeIntermediateTensorInfo(s),n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(a),u}else return e$({attrs:{shape:r.shape,dtype:r.dtype,value:r.dtype==="string"?"":0},backend:n})}const Wje={kernelName:Aw,backendName:"webgl",kernelFunc:rE};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dae(e){const{inputs:t,backend:n}=e,{x:r}=t;if(r.dtype==="string")throw new Error("onesLike is not supported under string dtype");if(r.dtype==="complex64"){const i=Qw({inputs:{input:r},backend:n}),s=dae({inputs:{x:i},backend:n}),o=OI({inputs:{input:r},backend:n}),a=rE({inputs:{x:o},backend:n}),u=Nh({inputs:{real:s,imag:a},backend:n});return n.disposeIntermediateTensorInfo(i),n.disposeIntermediateTensorInfo(s),n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(a),u}else return e$({attrs:{shape:r.shape,dtype:r.dtype,value:1},backend:n})}const Vje={kernelName:lw,backendName:"webgl",kernelFunc:dae};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Gje(e){const{inputs:t,backend:n,attrs:r}=e,{axis:i}=r;if(t.length===1)return vM({inputs:{input:t[0]},backend:n,attrs:{dim:i}});const s=t[0].shape,o=t[0].dtype;t.forEach(c=>{Fr(s,c.shape,"All tensors passed to stack must have matching shapes"),N(o===c.dtype,()=>"All tensors passed to stack must have matching dtypes")});const a=[],u=t.map(c=>{const f=vM({inputs:{input:c},backend:n,attrs:{dim:i}});return a.push(f),f}),l=Joe({inputs:u,backend:n,attrs:{axis:i}});return a.forEach(c=>n.disposeIntermediateTensorInfo(c)),l}const Hje={kernelName:fw,backendName:"webgl",kernelFunc:Gje};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class qje{constructor(t,n,r){this.variableNames=["x"],this.customUniforms=[{name:"value",type:"float"}],this.outputShape=n.map((l,c)=>l[0]+t[c]+l[1]);const i=t.length,s=Gt(i),o=n.map(l=>l[0]).join(","),a=n.map((l,c)=>l[0]+t[c]).join(","),u=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,i);if(i===1){this.userCode=`
        int start = ${o};
        int end = ${a};

        void main() {
          int outC = getOutputCoords();
          if (outC < start || outC >= end) {
            setOutput(value);
          } else {
            setOutput(getX(outC - start));
          }
        }
      `;return}this.userCode=`
      ${s} start = ${s}(${o});
      ${s} end = ${s}(${a});

      void main() {
        ${s} outC = getOutputCoords();
        if (any(lessThan(outC, start)) || any(greaterThanEqual(outC, end))) {
          setOutput(value);
        } else {
          ${s} coords = outC - start;
          setOutput(getX(${u}));
        }
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Xje{constructor(t,n,r){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"value",type:"float"}],this.outputShape=n.map((g,m)=>g[0]+t[m]+g[1]);const i=t.length,s=Gt(i),o=n.map(g=>g[0]).join(","),a=n.map((g,m)=>g[0]+t[m]).join(","),u=pi("rc",i),l=pi("source",i),c=`${u[i-1]} < ${this.outputShape[i-1]}`,f=i===1?"source":`vec2(${l.slice(-2).join()})`,h=[`${s} rc = outputLoc;`,`${u[i-1]} += 1;
       if(${c}) {
      `,i===1?"":`}
       rc = outputLoc;
       ${u[i-2]} += 1;
       if(${u[i-2]} < ${this.outputShape[i-2]}) {`,i===1?"":`  ${u[i-1]} += 1;
         if(${c}) {`],d=i===1?"rc < start || rc >= end":"any(lessThan(rc, start)) || any(greaterThanEqual(rc, end))";let p="";for(let g=0,m=i===1?2:4;g<m;g++)p+=`
        ${h[g]}
        if (${d}) {
          result[${g}] = float(value);
        } else {
          ${s} source = rc - start;
          result[${g}] = getChannel(getX(${l.join()}), ${f});
        }
      `;p+=i===1?"} ":"}}",this.userCode=`
      const ${s} start = ${s}(${o});
      const ${s} end = ${s}(${a});

      void main() {
        ${s} outputLoc = getOutputCoords();
        vec4 result = vec4(0.);
        ${p}
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const pae=e=>{const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{paddings:s,constantValue:o}=r;if(te(i.shape)===0){const l=s.map((c,f)=>c[0]+i.shape[f]+c[1]);return e$({backend:n,attrs:{shape:l,value:o,dtype:i.dtype}})}const a=K().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new Xje(i.shape,s,o):new qje(i.shape,s,o),u=[[o]];return n.runWebGLProgram(a,[i],i.dtype,u)},Yje={kernelName:hw,backendName:"webgl",kernelFunc:pae};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Kje=`
  if(a < 0.0 && floor(b) < b){
    return NAN;
  }
  if (b == 0.0) {
    return 1.0;
  }
  return (round(mod(b, 2.0)) != 1) ?
      pow(abs(a), b) : sign(a) * pow(abs(a), b);
`,Zje=`
  // isModRound1 has 1 for components with round(mod(b, 2.0)) == 1, 0 otherwise.
  vec4 isModRound1 = vec4(equal(round(mod(b, 2.0)), ivec4(1)));
  vec4 multiplier = sign(a) * isModRound1 + (vec4(1.0) - isModRound1);
  vec4 result = multiplier * pow(abs(a), b);

  // Ensure that a^0 = 1, including 0^0 = 1 as this correspond to TF and JS
  bvec4 isExpZero = equal(b, vec4(0.0));
  result.r = isExpZero.r ? 1.0 : result.r;
  result.g = isExpZero.g ? 1.0 : result.g;
  result.b = isExpZero.b ? 1.0 : result.b;
  result.a = isExpZero.a ? 1.0 : result.a;

  bvec4 isNaN1 = lessThan(a, vec4(0.0));
  bvec4 isNaN2 = lessThan(floor(b), b);
  bvec4 isNaN = bvec4(isNaN1.x && isNaN2.x, isNaN1.y && isNaN2.y, isNaN1.z && isNaN2.z, isNaN1.w && isNaN2.w);
  `+pg+`
  return result;
`,Jje=Mr({opSnippet:Kje,packedOpSnippet:Zje}),Qje={kernelName:$1,backendName:"webgl",kernelFunc:Jje};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function eWe(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{axis:s,keepDims:o}=r,a=i.shape.length,u=[],l=st(s,i.shape);let c=l;const f=Cn(c,a);let h=i;f!=null&&(h=Ii({inputs:{x:i},backend:n,attrs:{perm:f}}),c=On(c.length,a),u.push(h)),Rr("prod",c,a);let d;if(n.shouldExecuteOnCPU([h])){const p=n.texData.get(h.dataId).values,{outVals:g,outShape:m,outDtype:y}=J5e(h.shape,h.dtype,p,c);d=n.makeTensorInfo(m,y,g)}else{const[p,g]=pr(h.shape,c),m=te(g),y=Ce({inputs:{x:h},backend:n,attrs:{shape:[-1,m]}}),b=PT(i.dtype),v=gg(y,b,"prod",n);d=Ce({inputs:{x:v},backend:n,attrs:{shape:p}}),u.push(y),u.push(v)}if(o){u.push(d);const p=Fn(d.shape,l);d=Ce({inputs:{x:d},backend:n,attrs:{shape:p}})}return u.forEach(p=>n.disposeIntermediateTensorInfo(p)),d}const tWe={kernelName:pw,backendName:"webgl",kernelFunc:eWe};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nWe(e){const{inputs:t,backend:n,attrs:r}=e,{paramsNestedSplits:i,paramsDenseValues:s,indices:o}=t,{outputRaggedRank:a}=r,u=i.map(y=>n.readSync(y.dataId)),l=i.map(y=>y.shape),c=n.readSync(s.dataId),f=n.readSync(o.dataId),[h,d,p]=Q5e(u,l,c,s.shape,s.dtype,f,o.shape,a),g=h.map(y=>n.makeTensorInfo([y.length],"int32",y)),m=n.makeTensorInfo(p,s.dtype,d);return g.concat([m])}const rWe={kernelName:dT,backendName:"webgl",kernelFunc:nWe};/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function iWe(e){const{inputs:t,backend:n}=e,{starts:r,limits:i,deltas:s}=t,o=n.readSync(r.dataId),a=n.readSync(i.dataId),u=n.readSync(s.dataId),[l,c]=e6e(o,r.shape,r.dtype,a,i.shape,u,s.shape),f=n.makeTensorInfo([l.length],"int32",l),h=n.makeTensorInfo([c.length],r.dtype,c);return[f,h]}const sWe={kernelName:pT,backendName:"webgl",kernelFunc:iWe};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function oWe(e){const{inputs:t,backend:n,attrs:r}=e,{shape:i,values:s,defaultValue:o,rowPartitionTensors:a}=t,{rowPartitionTypes:u}=r,l=n.readSync(i.dataId),c=n.readSync(s.dataId),f=n.readSync(o.dataId),h=a.map(m=>n.readSync(m.dataId)),d=a.map(m=>m.shape),[p,g]=t6e(l,i.shape,c,s.shape,s.dtype,f,o.shape,h,d,u);return n.makeTensorInfo(p,s.dtype,g)}const aWe={kernelName:gT,backendName:"webgl",kernelFunc:oWe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gae=e=>{const{backend:t,attrs:n}=e,{start:r,stop:i,step:s,dtype:o}=n,a=n6e(r,i,s,o);return t.makeTensorInfo([a.length],o,a)},uWe={kernelName:mT,backendName:"webgl",kernelFunc:gae};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lWe="return 1.0 / x;",cWe=vt({opSnippet:lWe}),fWe={kernelName:C1,backendName:"webgl",kernelFunc:cWe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const hWe=Xo+`
  return (x < 0.0) ? 0.0 : x;
`,dWe=`
  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,pWe=vt({opSnippet:hWe,packedOpSnippet:dWe}),gWe={kernelName:S1,backendName:"webgl",kernelFunc:pWe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const mWe=Xo+`
  return (x < 0.0) ? 0.0 : min(6.0, x);
`,yWe=`
  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,bWe=vt({opSnippet:mWe,packedOpSnippet:yWe}),xWe={kernelName:k1,backendName:"webgl",kernelFunc:bWe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class vWe{constructor(t,n,r,i,s){this.variableNames=["A"],this.outputShape=[];const[o,a,u,l]=t;this.outputShape=[o,n,r,l];const c=[i&&n>1?a-1:a,i&&r>1?u-1:u],f=[i&&n>1?n-1:n,i&&r>1?r-1:r];let h;s?h="(vec2(yRC) + vec2(0.5)) * effectiveInputOverOutputRatioRC - vec2(0.5)":h="vec2(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec2 effectiveInputOverOutputRatioRC = vec2(
          ${c[0]/f[0]},
          ${c[1]/f[1]});
      const vec2 inputShapeRC = vec2(${a}.0, ${u}.0);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        ivec2 yRC = coords.yz;

        // Fractional source index.
        vec2 sourceFracIndexRC = ${h};

        // Compute the four integer indices.
        ivec2 sourceFloorRC = ivec2(max(sourceFracIndexRC, vec2(0.0)));
        ivec2 sourceCeilRC = ivec2(
          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));

        float topLeft = getA(b, sourceFloorRC.x, sourceFloorRC.y, d);
        float bottomLeft = getA(b, sourceCeilRC.x, sourceFloorRC.y, d);
        float topRight = getA(b, sourceFloorRC.x, sourceCeilRC.y, d);
        float bottomRight = getA(b, sourceCeilRC.x, sourceCeilRC.y, d);

        vec2 fracRC = sourceFracIndexRC - vec2(sourceFloorRC);

        float top = topLeft + (topRight - topLeft) * fracRC.y;
        float bottom = bottomLeft + (bottomRight - bottomLeft) * fracRC.y;
        float newValue = top + (bottom - top) * fracRC.x;

        setOutput(newValue);
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class wWe{constructor(t,n,r,i,s){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];const[o,a,u,l]=t;this.outputShape=[o,n,r,l];const c=[i&&n>1?a-1:a,i&&r>1?u-1:u],f=[i&&n>1?n-1:n,i&&r>1?r-1:r];let h;s?h="(vec3(yRC) + vec3(0.5)) * effectiveInputOverOutputRatioRC - vec3(0.5)":h="vec3(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec3 effectiveInputOverOutputRatioRC = vec3(
          ${c[0]/f[0]},
          ${c[1]/f[1]},
          ${c[1]/f[1]});
      const vec3 inputShapeRC = vec3(${a}.0, ${u}.0,
                                     ${u}.0);

      float getAValue(int b, int r, int c, int d) {
        return getChannel(getA(b, r, c, d), vec2(c, d));
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        // Calculate values for next column in yRC.z.
        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);

        // Fractional source index.
        vec3 sourceFracIndexRC = ${h};

        // Compute the four integer indices.
        ivec3 sourceFloorRC = ivec3(max(sourceFracIndexRC, vec3(0.0)));
        ivec3 sourceCeilRC = ivec3(
          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));

        // Should we calculate next column and row elements in 2x2 packed cell.
        bool hasNextCol = d < ${l-1};
        bool hasNextRow = coords.z < ${r-1};

        // In parallel, construct four corners for all four components in
        // packed 2x2 cell.
        vec4 topLeft = vec4(
          getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d),
          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d + 1) : 0.0);

        vec4 bottomLeft = vec4(
          getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d),
          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d + 1) : 0.0);

        vec4 topRight = vec4(
          getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d),
          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d + 1) : 0.0);

        vec4 bottomRight = vec4(
          getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d),
          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d + 1) : 0.0);

        vec3 fracRC = sourceFracIndexRC - vec3(sourceFloorRC);

        vec4 top = mix(topLeft, topRight, fracRC.yyzz);
        vec4 bottom = mix(bottomLeft, bottomRight, fracRC.yyzz);
        vec4 newValue = mix(top, bottom, fracRC.x);

        setOutput(newValue);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $We(e){const{inputs:t,backend:n,attrs:r}=e,{images:i}=t,{alignCorners:s,halfPixelCenters:o,size:a}=r,[u,l]=a,c=K().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new wWe(i.shape,u,l,s,o):new vWe(i.shape,u,l,s,o);return n.runWebGLProgram(c,[i],"float32")}const CWe={kernelName:yw,backendName:"webgl",kernelFunc:$We};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class SWe{constructor(t,n,r){this.variableNames=["dy"],this.outputShape=[],this.outputShape=n;const[,i,s]=n,[,o,a]=t,u=[r&&o>1?i-1:i,r&&a>1?s-1:s],l=[r&&o>1?o-1:o,r&&a>1?a-1:a],c=u[0]/l[0],f=u[1]/l[1],h=1/c,d=1/f,p=Math.ceil(h)*2+2,g=Math.ceil(d)*2+2;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        int r = coords[1];
        int c = coords[2];

        float accumulator = 0.0;

        const float heightScale = float(${c});
        const float widthScale = float(${f});

        const float invHeightScale = float(${h});
        const float invWidthScale = float(${d});

        const int winHeight = int(${p});
        const int winWidth = int(${g});

        // Compute bounds for where in dy we will look
        float startRLerp = floor(float(r) * invHeightScale);
        int startDyR = int(startRLerp - float(winHeight / 2));

        float startCLerp = floor(float(c) * invWidthScale);
        int startDyC = int(startCLerp - float(winWidth / 2));

        // Loop over dy
        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {
          int dyR = dyROffset + startDyR;

          // Guard against the window exceeding the bounds of dy
          if (dyR < 0 || dyR >= ${o}) {
            continue;
          }

          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {
            int dyC = dyCOffset + startDyC;

            // Guard against the window exceeding the bounds of dy
            if (dyC < 0 || dyC >= ${a}) {
              continue;
            }

            float dxR = float(dyR) * heightScale;
            int topDxRIndex = int(floor(dxR));
            int bottomDxRIndex = int(min(ceil(dxR), ${i-1}.0));
            float dxRLerp = dxR - float(topDxRIndex);
            float inverseDxRLerp = 1.0 - dxRLerp;

            float dxC = float(dyC) * widthScale;
            int leftDxCIndex = int(floor(dxC));
            int rightDxCIndex = int(min(ceil(dxC), ${s-1}.0));
            float dxCLerp = dxC - float(leftDxCIndex);
            float inverseDxCLerp = 1.0 - dxCLerp;

            if (r == topDxRIndex && c == leftDxCIndex) {
              // topLeft
              accumulator +=
                getDy(b, dyR, dyC, d) * inverseDxRLerp * inverseDxCLerp;
            }

            if (r == topDxRIndex && c == rightDxCIndex) {
              // topRight
              accumulator += getDy(b, dyR, dyC, d) * inverseDxRLerp * dxCLerp;
            }

            if (r == bottomDxRIndex && c == leftDxCIndex) {
              // bottomLeft
              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * inverseDxCLerp;
            }

            if (r == bottomDxRIndex && c == rightDxCIndex) {
              // bottomRight
              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * dxCLerp;
            }
          }
        }
        // End loop over dy

        setOutput(accumulator);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kWe(e){const{inputs:t,backend:n,attrs:r}=e,{images:i,dy:s}=t,{alignCorners:o}=r,a=new SWe(s.shape,i.shape,o);return n.runWebGLProgram(a,[s],s.dtype)}const EWe={kernelName:xT,backendName:"webgl",kernelFunc:kWe};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class _We{constructor(t,n,r,i,s){this.variableNames=["A"],this.outputShape=[];const[o,a,u,l]=t;this.outputShape=[o,n,r,l];const c=[i&&n>1?a-1:a,i&&r>1?u-1:u],f=[i&&n>1?n-1:n,i&&r>1?r-1:r],h=i?"0.5":"0.0";let d;s?d="max((vec2(yRC) + vec2(0.5)) * effectiveInputOverOutputRatioRC, vec2(0.0))":d="vec2(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec2 effectiveInputOverOutputRatioRC = vec2(
          ${c[0]/f[0]},
          ${c[1]/f[1]});
      const vec2 inputShapeRC = vec2(${a}.0, ${u}.0);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        ivec2 yRC = coords.yz;

        // Fractional source index.
        vec2 sourceFracIndexRC = ${d};

        // Compute the coordinators of nearest neighbor point.
        ivec2 sourceNearestRC = ivec2(
          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + ${h})));
        float newValue = getA(b, sourceNearestRC.x, sourceNearestRC.y, d);

        setOutput(newValue);
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class AWe{constructor(t,n,r,i,s){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];const[o,a,u,l]=t;this.outputShape=[o,n,r,l];const c=[i&&n>1?a-1:a,i&&r>1?u-1:u],f=[i&&n>1?n-1:n,i&&r>1?r-1:r],h=i?"0.5":"0.0";let d;s?d="max((vec3(yRC) + vec3(0.5)) * effectiveInputOverOutputRatioRC, vec3(0.0))":d="vec3(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec3 effectiveInputOverOutputRatioRC = vec3(
          ${c[0]/f[0]},
          ${c[1]/f[1]},
          ${c[1]/f[1]});
      const vec3 inputShapeRC = vec3(${a}.0, ${u}.0,
                                     ${u}.0);

      float getAValue(int b, int r, int c, int d) {
        return getChannel(getA(b, r, c, d), vec2(c, d));
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        // Calculate values for next column in yRC.z.
        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);

        // Fractional source index.
        vec3 sourceFracIndexRC = ${d};

        // Compute the coordinators of nearest neighbor point.
        ivec3 sourceNearestRC = ivec3(
          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + ${h})));

        // Should we calculate next column and row elements in 2x2 packed cell.
        bool hasNextCol = d < ${l-1};
        bool hasNextRow = coords.z < ${r-1};

        vec4 newValue = vec4(
          getAValue(b, sourceNearestRC.x, sourceNearestRC.y, d),
          hasNextCol ? getAValue(b, sourceNearestRC.x, sourceNearestRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceNearestRC.x, sourceNearestRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceNearestRC.x, sourceNearestRC.z, d + 1) : 0.0);

        setOutput(newValue);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function TWe(e){const{inputs:t,backend:n,attrs:r}=e,{images:i}=t,{alignCorners:s,halfPixelCenters:o,size:a}=r,[u,l]=a,c=K().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new AWe(i.shape,u,l,s,o):new _We(i.shape,u,l,s,o);return n.runWebGLProgram(c,[i],i.dtype)}const IWe={kernelName:mw,backendName:"webgl",kernelFunc:TWe};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class DWe{constructor(t,n,r){this.variableNames=["dy"],this.outputShape=[],this.outputShape=n;const[,i,s]=n,[,o,a]=t,u=[r&&o>1?i-1:i,r&&a>1?s-1:s],l=[r&&o>1?o-1:o,r&&a>1?a-1:a],c=u[0]/l[0],f=u[1]/l[1],h=1/c,d=1/f,p=Math.ceil(h)*2+2,g=Math.ceil(d)*2+2;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        int r = coords[1];
        int c = coords[2];

        float accumulator = 0.0;

        const float heightScale = float(${c});
        const float widthScale = float(${f});

        const float invHeightScale = float(${h});
        const float invWidthScale = float(${d});

        const int winHeight = int(${p});
        const int winWidth = int(${g});

        // Compute bounds for where in dy we will look
        float startRLerp = floor(float(r) * invHeightScale);
        int startDyR = int(floor(startRLerp - float(winHeight / 2)));

        float startCLerp = floor(float(c) * invWidthScale);
        int startDyC = int(floor(startCLerp - float(winWidth / 2)));

        // Loop over dy
        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {
          int dyR = dyROffset + startDyR;

          // Guard against the window exceeding the bounds of dy
          if (dyR < 0 || dyR >= ${o}) {
            continue;
          }

          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {
            int dyC = dyCOffset + startDyC;

            // Guard against the window exceeding the bounds of dy
            if (dyC < 0 || dyC >= ${a}) {
              continue;
            }

            float sourceFracRow =
              float(${u[0]}) *
                (float(dyR) / float(${l[0]}));

            float sourceFracCol =
                float(${u[1]}) *
                  (float(dyC) / float(${l[1]}));

            int sourceNearestRow = int(min(
                float(int(${i}) - 1),
                ${r} ? float(round(sourceFracRow)) :
                                  float(floor(sourceFracRow))));

            int sourceNearestCol = int(min(
                float(int(${s}) - 1),
                ${r} ? float(round(sourceFracCol)) :
                                  float(floor(sourceFracCol))));

            if (r == sourceNearestRow && c == sourceNearestCol) {
              accumulator += getDy(b, dyR, dyC, d);
            }
          }
        }
        // End loop over dy

        setOutput(accumulator);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function NWe(e){const{inputs:t,backend:n,attrs:r}=e,{images:i,dy:s}=t,{alignCorners:o}=r,a=new DWe(s.shape,i.shape,o);return n.runWebGLProgram(a,[s],s.dtype)}const FWe={kernelName:bT,backendName:"webgl",kernelFunc:NWe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class OWe{constructor(t,n){this.variableNames=["x"];const r=t.length;if(r>4)throw new Error(`WebGL backend: Reverse of rank-${r} tensor is not yet supported`);if(this.outputShape=t,r===1){this.userCode=`
        void main() {
          int coord = getOutputCoords();
          setOutput(getX(${t[0]} - coord - 1));
        }
      `;return}const i=a=>n.indexOf(a)!==-1&&t[a]!==1?`${t[a]} - coords[${a}] - 1`:`coords[${a}]`,s=t.map((a,u)=>i(u)).join(","),o=Gt(r);this.userCode=`
      void main() {
        ${o} coords = getOutputCoords();
        setOutput(getX(${s}));
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class RWe{constructor(t,n){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0;const r=t.length;if(r>4)throw new Error(`WebGL backend: Reverse of rank-${r} tensor is not yet supported`);this.outputShape=t;const i=pi("rc",r),s=`${i[r-1]} + 1 < ${this.outputShape[r-1]}`,o=`${i[r-2]} + 1 < ${this.outputShape[r-2]}`,a=Gt(r);r===1?this.userCode=`
        void main(){
          int rc = getOutputCoords();
          vec4 result = vec4(0.);
          result.r = getChannel(getX(${t[0]} - rc - 1),
            ${t[0]} - rc - 1);
          if(${s}){
              result.g = getChannel(getX(${t[0]} - (rc  + 1) - 1),
                ${t[0]} - (rc  + 1) - 1);
          }
          setOutput(result);
        }
      `:this.userCode=`
        void main() {
          ${a} rc = getOutputCoords();
          vec4 result = vec4(0.);
          result.r = ${u(i.slice())};
          if(${s}){
            result.g = ${l(i.slice())};
          }
          if(${o}) {
            result.b = ${c(i.slice())};
            if(${s}) {
              result.a = ${f(i.slice())};
            }
          }
          setOutput(result);
        }
    `;function u(p){return h(p)}function l(p){return p[r-1]="("+p[r-1]+" + 1)",h(p)}function c(p){return p[r-2]="("+p[r-2]+" + 1)",h(p)}function f(p){return p[r-1]="("+p[r-1]+" + 1)",p[r-2]="("+p[r-2]+" + 1)",h(p)}function h(p){const g=t.map((b,v)=>d(v,p)),m=g.join(","),y=g.slice(-2).join(",");return`getChannel(getX(${m}), vec2(${y}))`}function d(p,g){return n.indexOf(p)!==-1&&t[p]!==1?`${t[p]} - ${g[p]} - 1`:`${g[p]}`}}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function MWe(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{dims:s}=r,o=i.shape.length,a=st(s,i.shape);if(o===0)return Ts({inputs:{x:i},backend:n});const u=K().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new RWe(i.shape,a):new OWe(i.shape,a);return n.runWebGLProgram(u,[i],i.dtype)}const LWe={kernelName:bw,backendName:"webgl",kernelFunc:MWe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class PWe{constructor(t,n){this.variableNames=["Image"],this.outputShape=[],this.customUniforms=[{name:"params",type:"vec4"}];const r=t[1],i=t[2];this.outputShape=t;let s="";typeof n=="number"?s=`float outputValue = ${n.toFixed(2)};`:s=`
        vec3 fill = vec3(${n.join(",")});
        float outputValue = fill[coords[3]];`,this.userCode=`
        void main() {
          ivec4 coords = getOutputCoords();
          int x = coords[2];
          int y = coords[1];
          float coordXFloat = (float(x) - params[0]) * params[3] -
            (float(y) - params[1]) * params[2];
          float coordYFloat = (float(x) - params[0]) * params[2] +
            (float(y) - params[1]) * params[3];
          int coordX = int(round(coordXFloat + params[0]));
          int coordY = int(round(coordYFloat + params[1]));
          ${s}
          if(coordX >= 0 && coordX < ${i} && coordY >= 0 && coordY < ${r}) {
            outputValue = getImage(coords[0], coordY, coordX, coords[3]);
          }
          setOutput(outputValue);
        }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const BWe={kernelName:MT,backendName:"webgl",kernelFunc:({inputs:e,attrs:t,backend:n})=>{const{image:r}=e,{radians:i,fillValue:s,center:o}=t,a=n,u=new PWe(r.shape,s),[l,c]=d5(o,r.shape[1],r.shape[2]),f=[[l,c,Math.sin(i),Math.cos(i)]];return a.runWebGLProgram(u,[r],r.dtype,f)}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const zWe=`
  // OpenGL ES does not support round function.
  // The algorithm is based on banker's rounding.
  float base = floor(x);
  if ((x - base) < 0.5) {
    return floor(x);
  } else if ((x - base) > 0.5) {
    return ceil(x);
  } else {
    if (mod(base, 2.0) == 0.0) {
      return base;
    } else {
      return base + 1.0;
    }
  }
`,UWe=vt({opSnippet:zWe}),jWe={kernelName:E1,backendName:"webgl",kernelFunc:UWe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const WWe="return inversesqrt(x);",VWe=vt({opSnippet:WWe,cpuKernelImpl:r6e}),GWe={kernelName:_1,backendName:"webgl",kernelFunc:VWe};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class y6{constructor(t,n,r,i,s,o,a=!0,u=!1){this.variableNames=["updates","indices","defaultValue"],this.outputShape=o;const l=Gt(s.length),c=Gt(o.length);let f="";r===1?f="i":r===2&&(f="i, j");const h=`getIndices(${f})`;let d="";i===1?d="i":i===2&&(d="i, coords[1]");const p=`getUpdates(${d})`;let g="";u&&(g="coords[0], coords[1]");const m=`getDefaultValue(${g})`,y=n>1?"strides[j]":"strides";this.userCode=`
        ${l} strides = ${l}(${s});

        void main() {
          ${c} coords = getOutputCoords();
          float sum = 0.0;
          bool found = false;
          for (int i = 0; i < ${t}; i++) {
            int flattenedIndex = 0;
            for (int j = 0; j < ${n}; j++) {
              int index = round(${h});
              flattenedIndex += index * ${y};
            }
            if (flattenedIndex == coords[0]) {
              sum += ${p};
              found = true;
            }
          }
          setOutput(mix(${m}, sum, float(found)));
        }
      `}}/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class HWe{constructor(t,n,r,i,s,o,a=!0,u=!1){this.variableNames=["updates","indices","defaultValue"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=o;const l=Gt(s.length),c=Gt(o.length);let f="";r===1?f="i":r===2&&(f="i, j");const h=`getIndices(${f})`;let d="";i===1?d="i":i===2&&(d="i, coords[1]");const p=`getUpdates(${d})`;let g="";u&&(g="coords[0], coords[1]");const m=`getDefaultValue(${g})`,y=n>1?"strides[j]":"strides",b=n>1?"strides[j + 1]":"strides";this.userCode=`
        ${l} strides = ${l}(${s});

        void main() {
          ${c} coords = getOutputCoords();
          vec4 sum = vec4(0.);
          vec4 found = vec4(0.);
          for (int i = 0; i < ${t}; i+=2) {
            ivec2 flattenedIndex = ivec2(0);
            for (int j = 0; j < ${n}; j+=2) {
              ivec4 index = round(${h});
              flattenedIndex += index.xz * ${y};
              if (j + 1 < ${n}) {
                flattenedIndex += index.yw * ${b};
              }
            }
            if (flattenedIndex[0] == coords[0] || flattenedIndex[1] == coords[0] ||
                flattenedIndex[0] == coords[0] + 1 || flattenedIndex[1] == coords[0] + 1) {
              vec4 updVals = ${p};
              if (flattenedIndex[0] == coords[0]) {
                sum.xy += updVals.xy;
                found.xy = vec2(1.);
              } else if (flattenedIndex[0] == coords[0] + 1) {
                sum.zw += updVals.xy;
                found.zw = vec2(1.);
              }
              if (flattenedIndex[1] == coords[0]) {
                sum.xy += updVals.zw;
                found.xy = vec2(1.);
              } else if (flattenedIndex[1] == coords[0] + 1) {
                sum.zw += updVals.zw;
                found.zw = vec2(1.);
              }
            }
          }
          setOutput(mix(${m}, sum, found));
        }
      `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qWe(e){const{inputs:t,backend:n,attrs:r}=e,{indices:i,updates:s}=t,{shape:o}=r,{sliceRank:a,numUpdates:u,sliceSize:l,strides:c,outputSize:f}=Th(s,i,o),h=[f/l,l];if(f===0)return n.makeTensorInfo(o,i.dtype);const d=Ce({inputs:{x:i},backend:n,attrs:{shape:[u,a]}}),p=Ce({inputs:{x:s},backend:n,attrs:{shape:[u,l]}}),g=n.makeTensorInfo([],"float32",new Float32Array([0]));let m;K().getBool("WEBGL_PACK")?m=new HWe(u,a,d.shape.length,p.shape.length,c,h):m=new y6(u,a,d.shape.length,p.shape.length,c,h);const y=n.runWebGLProgram(m,[p,d,g],p.dtype),b=Ce({inputs:{x:y},backend:n,attrs:{shape:o}});return n.disposeIntermediateTensorInfo(d),n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(y),n.disposeIntermediateTensorInfo(g),b}const XWe={kernelName:vT,backendName:"webgl",kernelFunc:qWe};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class YWe{constructor(t,n,r,i){this.variableNames=["sortedSequence","values"],this.customUniforms=[{name:"numInputs",type:"int"}],this.outputShape=[t,r];const s="while (left < right) {",o=`for (int i = 0; i < ${Math.ceil(Math.log2(n+1))}; ++i) { if (left >= right) break;`,a=K().getNumber("WEBGL_VERSION")===2?s:o,u=i==="left"?"<":"<=";this.userCode=`
       int findBound(int batch, float value) {
         int left = 0;
         int right = numInputs;
         int mid;
         ${a}
           mid = (left + right) / 2;
           if (getSortedSequence(batch, mid) ${u} value) {
             left = mid + 1;
           } else {
             right = mid;
           }
         }
         return right;
       }

       void main() {
         ivec2 coords = getOutputCoords();
         int batch = coords[0];
         int valueIndex = coords[1];

         float value = getValues(batch, valueIndex);

         setOutput(float(findBound(batch, value)));
       }
     `}}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function KWe(e){const{inputs:t,backend:n,attrs:r}=e,{sortedSequence:i,values:s}=t,{side:o}=r,a=new YWe(i.shape[0],i.shape[1],s.shape[1],o),u=[[i.shape[1]]];return n.runWebGLProgram(a,[i,s],"int32",u)}const ZWe={kernelName:$T,backendName:"webgl",kernelFunc:KWe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class JWe{constructor(t,n,r){this.variableNames=["c","a","b"],this.outputShape=n;let i,s;if(r>4)throw Error(`Where for rank ${r} is not yet supported`);if(r===1)s="resRC",i="resRC";else{const a=["resRC.x","resRC.y","resRC.z","resRC.w"],u=[],l=[];for(let c=0;c<n.length;c++)l.push(`${a[c]}`),c<t&&u.push(`${a[c]}`);i=u.join(),s=l.join()}const o=Gt(r);this.userCode=`
      void main() {
        ${o} resRC = getOutputCoords();
        float cVal = getC(${i});
        if (cVal >= 1.0) {
          setOutput(getA(${s}));
        } else {
          setOutput(getB(${s}));
        }
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function QWe(e){const{inputs:t,backend:n}=e,{condition:r,t:i,e:s}=t,o=new JWe(r.shape.length,i.shape,i.shape.length);return n.runWebGLProgram(o,[r,i,s],qi(i.dtype,s.dtype))}const eVe={kernelName:xw,backendName:"webgl",kernelFunc:QWe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const tVe=`
  // Stable and Attracting Fixed Point (0, 1) for Normalized Weights.
  // see: https://arxiv.org/abs/1706.02515
  float scaleAlpha = ${mI};
  float scale = ${yI};
  return (x >= 0.0) ? scale * x : scaleAlpha * (exp(x) - 1.0);
`,nVe=vt({opSnippet:tVe}),rVe={kernelName:A1,backendName:"webgl",kernelFunc:nVe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const iVe=J1+`
  return 1.0 / (1.0 + exp(-1.0 * x));
`,sVe=`
  vec4 result = 1.0 / (1.0 + exp(-1.0 * x));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,oVe=vt({opSnippet:iVe,packedOpSnippet:sVe,cpuKernelImpl:s6e}),aVe={kernelName:N1,backendName:"webgl",kernelFunc:oVe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const uVe=`
  if (isnan(x)) { return 0.0; }
  return sign(x);
`,lVe=vt({opSnippet:uVe}),cVe={kernelName:D1,backendName:"webgl",kernelFunc:lVe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const fVe=J1+`
  return sin(x);
`,hVe=`
  vec4 result = sin(x);
  bvec4 isNaN = isnan(x);
  ${pg}
  return result;
`,dVe=vt({opSnippet:fVe,packedOpSnippet:hVe}),pVe={kernelName:T1,backendName:"webgl",kernelFunc:dVe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gVe=`
  float e2x = exp(x);
  return (e2x - 1.0 / e2x) / 2.0;
`,mVe=vt({opSnippet:gVe}),yVe={kernelName:I1,backendName:"webgl",kernelFunc:mVe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const bVe=`
  float epsilon = 1.1920928955078125e-7;
  float threshold = log(epsilon) + 2.0;

  bool too_large = x > -threshold;
  bool too_small = x < threshold;

  float result;
  float exp_x = exp(x);

  if (too_large){
    result = x;
  }
  else if (too_small){
    result = exp_x;
  }
  else{
    result = log(exp_x + 1.0);
  }
  return result;
`,xVe=vt({opSnippet:bVe}),vVe={kernelName:F1,backendName:"webgl",kernelFunc:xVe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wVe=e=>{const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{blockShape:s,paddings:o}=r;N(i.shape.length<=4,()=>"spaceToBatchND for rank > 4 with a WebGL backend not implemented yet");const a=s.reduce((y,b)=>y*b),u=[[0,0]];u.push(...o);for(let y=1+s.length;y<i.shape.length;++y)u.push([0,0]);const l=[],c=pae({inputs:{x:i},backend:n,attrs:{paddings:u,constantValue:0}}),f=Pw(c.shape,s,a,!1),h=Bw(f.length,s.length,!1),d=zw(c.shape,s,a,!1),p=Ce({inputs:{x:c},backend:n,attrs:{shape:f}}),g=Ii({inputs:{x:p},backend:n,attrs:{perm:h}}),m=Ce({inputs:{x:g},backend:n,attrs:{shape:d}});return l.push(c),l.push(p),l.push(g),l.forEach(y=>n.disposeIntermediateTensorInfo(y)),m},$Ve={kernelName:$w,backendName:"webgl",kernelFunc:wVe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function CVe(e){const{inputs:t,backend:n}=e,{indices:r,values:i,denseShape:s,defaultValue:o}=t;if(s.shape.length!==1)throw new Error(`Dense shape must be a vector, saw:
         ${s.shape}`);if(r.shape.length!==2)throw new Error(`Indices must be a matrix, saw:
         ${r.shape}`);if(i.shape.length!==1)throw new Error(`Values must be a vector, saw:
         ${i.shape}`);if(o.shape.length!==0)throw new Error(`Default value must be a scalar, saw:
        ${o.shape}`);const a=n.readSync(r.dataId),u=n.readSync(i.dataId),l=n.readSync(s.dataId),c=n.readSync(o.dataId)[0],[f,h,d,p,g]=a6e(a,r.shape,r.dtype,u,i.dtype,l,c);return[n.makeTensorInfo(h,r.dtype,f),n.makeTensorInfo([h[0]],i.dtype,d),n.makeTensorInfo([p.length],"bool",new Uint8Array(p.map(m=>Number(m)))),n.makeTensorInfo([g.length],r.dtype,new Int32Array(g))]}const SVe={kernelName:CT,backendName:"webgl",kernelFunc:CVe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kVe(e){const{inputs:t,backend:n}=e,{inputIndices:r,inputShape:i,newShape:s}=t;if(r.shape.length!==2)throw new Error(`Input indices should be a matrix but received shape ${r.shape}`);if(i.shape.length!==1)throw new Error(`Input shape should be a vector but received shape ${i.shape}`);if(s.shape.length!==1)throw new Error(`Target shape should be a vector but received shape ${s.shape}`);const o=Array.from(n.readSync(i.dataId)),a=n.readSync(r.dataId),u=Array.from(n.readSync(s.dataId)),[l,c,f]=u6e(a,r.shape,r.dtype,o,u);return[n.makeTensorInfo(c,r.dtype,l),n.makeTensorInfo([f.length],s.dtype,new Int32Array(f))]}const EVe={kernelName:ST,backendName:"webgl",kernelFunc:kVe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _Ve(e){const{inputs:t,backend:n}=e,{data:r,indices:i,segmentIds:s}=t;if(r.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(i.shape.length!==1)throw new Error(`Indices should be a vector but received shape
              ${i.shape}`);if(s.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
              ${s.shape}`);const o=n.readSync(r.dataId),a=n.readSync(i.dataId),u=n.readSync(s.dataId),[l,c]=Boe(o,r.shape,r.dtype,a,u,!0);return n.makeTensorInfo(c,r.dtype,l)}const AVe={kernelName:kT,backendName:"webgl",kernelFunc:_Ve};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function TVe(e){const{inputs:t,backend:n}=e,{data:r,indices:i,segmentIds:s}=t;if(r.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(i.shape.length!==1)throw new Error(`Indices should be a vector but received shape
             ${i.shape}`);if(s.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
             ${s.shape}`);const o=n.readSync(r.dataId),a=n.readSync(i.dataId),u=n.readSync(s.dataId),[l,c]=Boe(o,r.shape,r.dtype,a,u);return n.makeTensorInfo(c,r.dtype,l)}const IVe={kernelName:ET,backendName:"webgl",kernelFunc:TVe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function DVe(e){const{inputs:t,backend:n,attrs:r}=e,{sparseIndices:i,sparseValues:s,defaultValue:o}=t,{outputShape:a}=r,{sliceRank:u,numUpdates:l,sliceSize:c,strides:f,outputSize:h}=Th(s,i,a),d=!1;if(s.dtype==="string"){const y=n.bufferSync(i),b=n.bufferSync(s),v=oc(n.readSync(o.dataId)[0]),x=i6e(y,b,a,h,c,l,u,f,v,d);return n.makeTensorInfo(a,x.dtype,x.values)}const p=new y6(l,u,i.shape.length,s.shape.length,f,[h,1],d),g=n.runWebGLProgram(p,[s,i,o],s.dtype),m=Ce({inputs:{x:g},backend:n,attrs:{shape:a}});return n.disposeIntermediateTensorInfo(g),m}const NVe={kernelName:_T,backendName:"webgl",kernelFunc:DVe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function FVe(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{numOrSizeSplits:s,axis:o}=r,a=st(o,i.shape)[0],u=A5(i,s,a),l=i.shape.length,c=new Array(l).fill(0),f=i.shape.slice();return u.map(h=>{const d=[...f];d[a]=h;const p=Q1({inputs:{x:i},backend:n,attrs:{begin:c,size:d}});return c[a]+=h,p})}const OVe={kernelName:Cw,backendName:"webgl",kernelFunc:FVe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const PG="return sqrt(x);",RVe=vt({opSnippet:PG,packedOpSnippet:PG,cpuKernelImpl:l6e}),MVe={kernelName:O1,backendName:"webgl",kernelFunc:RVe};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const LVe="return x * x;",PVe=vt({opSnippet:LVe}),BVe={kernelName:AT,backendName:"webgl",kernelFunc:PVe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const BG="return (a - b) * (a - b);",zVe=Mr({opSnippet:BG,packedOpSnippet:BG}),UVe={kernelName:R1,backendName:"webgl",kernelFunc:zVe};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jVe(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t;if(i.dtype!=="string")throw new Error("Input must be of datatype string");const s=n.readSync(i.dataId),o=lc(s),a=c6e(o,"string",r);return n.makeTensorInfo(i.shape,"string",a)}const WVe={kernelName:kw,backendName:"webgl",kernelFunc:jVe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function VVe({inputs:e,attrs:t,backend:n}){const{x:r}=e,i=Xo+`
    return x > 0.0 ? 1.0 : float(${t.alpha});
  `,s=new xu(r.shape,i);return n.runWebGLProgram(s,[r],r.dtype)}const GVe={kernelName:z1,backendName:"webgl",kernelFunc:VVe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class HVe{constructor(t,n,r){this.variableNames=["x"],this.outputShape=r;const i=r.length,s=Gt(r.length),o=Gt(r.length);let a="";if(i===1)a="coords * strides + begin";else{let u=0;a=r.map((l,c)=>(u++,r.length===1?`coords * strides[${c}] + begin[${c}]`:`coords[${u-1}] * strides[${c}] + begin[${c}]`)).join(",")}this.userCode=`
      ${s} begin = ${s}(${t});
      ${s} strides = ${s}(${n});

      void main() {
        ${o} coords = getOutputCoords();
        setOutput(getX(${a}));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qVe(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{begin:s,end:o,strides:a,beginMask:u,endMask:l,ellipsisMask:c,newAxisMask:f,shrinkAxisMask:h}=r,{finalShapeSparse:d,finalShape:p,isIdentity:g,sliceDim0:m,isSimpleSlice:y,begin:b,end:v,strides:x}=l5(i.shape,s,o,a,u,l,c,f,h);let w;if(g)w=Ce({inputs:{x:i},backend:n,attrs:{shape:p}});else if(m||y){N(i.shape.length>=1,()=>`Input must have rank at least 1, got: ${i.shape.length}`);const $=o5(b,v,x),S=Q1({inputs:{x:i},backend:n,attrs:{begin:b,size:$}});w=Ce({inputs:{x:S},backend:n,attrs:{shape:p}}),n.disposeIntermediateTensorInfo(S)}else if(n.shouldExecuteOnCPU([i])){const S=n.readSync(i.dataId),k=rt(i.shape,i.dtype,S),E=f6e(d,k,x,b);w=n.makeTensorInfo(p,i.dtype,E.values)}else{const S=new HVe(b,x,d);w=n.runWebGLProgram(S,[i],i.dtype)}const C=Ce({inputs:{x:w},backend:n,attrs:{shape:p}});return n.disposeIntermediateTensorInfo(w),C}const XVe={kernelName:TT,backendName:"webgl",kernelFunc:qVe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function YVe(e){const{inputs:t,backend:n,attrs:r}=e,{separator:i,nGramWidths:s,leftPad:o,rightPad:a,padWidth:u,preserveShortSequences:l}=r,{data:c,dataSplits:f}=t,h=n.readSync(c.dataId),d=n.readSync(f.dataId),[p,g]=h6e(h,d,i,s,o,a,u,l);return[n.makeTensorInfo([p.length],"string",p),n.makeTensorInfo(f.shape,"int32",g)]}const KVe={kernelName:IT,backendName:"webgl",kernelFunc:YVe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ZVe(e){const{inputs:t,backend:n,attrs:r}=e,{skipEmpty:i}=r,{input:s,delimiter:o}=t;if(s.dtype!=="string")throw new Error("Input must be of datatype string");if(s.shape.length!==1)throw new Error(`Input must be a vector, got shape: ${s.shape}`);if(o.shape.length!==0)throw new Error(`Delimiter must be a scalar, got shape: ${o.shape}`);const a=n.readSync(s.dataId),u=n.readSync(o.dataId)[0],[l,c,f]=d6e(a,u,i),h=c.length;return[n.makeTensorInfo([h,2],"int32",l),n.makeTensorInfo([h],"string",c),n.makeTensorInfo([2],"int32",new Int32Array(f))]}const JVe={kernelName:DT,backendName:"webgl",kernelFunc:ZVe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function QVe(e){const{inputs:t,backend:n,attrs:r}=e,{numBuckets:i}=r,{input:s}=t;if(s.dtype!=="string")throw new Error("Input must be of datatype string");if(i<=0)throw new Error("Number of buckets must be at least 1");const o=n.readSync(s.dataId),a=p6e(o,i);return n.makeTensorInfo(s.shape,"int32",a)}const eGe={kernelName:NT,backendName:"webgl",kernelFunc:QVe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const tGe="return tan(x);",nGe=vt({opSnippet:tGe}),rGe={kernelName:L1,backendName:"webgl",kernelFunc:nGe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const iGe=`
  float e2x = exp(-2.0 * abs(x));
  return sign(x) * (1.0 - e2x) / (1.0 + e2x);
`,sGe=vt({opSnippet:iGe}),oGe={kernelName:P1,backendName:"webgl",kernelFunc:sGe};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function aGe(e){const{inputs:t,backend:n,attrs:r}=e,{tensor:i,indices:s,updates:o}=t,{sliceRank:a,numUpdates:u,sliceSize:l,strides:c,outputSize:f}=Th(o,s,i.shape),h=[f/l,l];if(f===0)return n.makeTensorInfo(i.shape,s.dtype);const d=Ce({inputs:{x:s},backend:n,attrs:{shape:[u,a]}}),p=Ce({inputs:{x:o},backend:n,attrs:{shape:[u,l]}}),g=Ce({inputs:{x:i},backend:n,attrs:{shape:h}}),m=new y6(u,a,d.shape.length,p.shape.length,c,h,!1,!0),y=n.runWebGLProgram(m,[p,d,g],g.dtype),b=Ce({inputs:{x:y},backend:n,attrs:{shape:i.shape}});return n.disposeIntermediateTensorInfo(d),n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(g),n.disposeIntermediateTensorInfo(y),b}const uGe={kernelName:wT,backendName:"webgl",kernelFunc:aGe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class lGe{constructor(t,n){this.variableNames=["A"];const r=new Array(t.length);for(let o=0;o<r.length;o++)r[o]=t[o]*n[o];this.outputShape=r,this.rank=r.length;const i=Gt(this.rank),s=cGe(t);this.userCode=`
      void main() {
        ${i} resRC = getOutputCoords();
        setOutput(getA(${s}));
      }
    `}}function cGe(e){const t=e.length;if(t>5)throw Error(`Tile for rank ${t} is not yet supported`);if(t===1)return`imod(resRC, ${e[0]})`;const n=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u"],r=[];for(let i=0;i<e.length;i++)r.push(`imod(${n[i]}, ${e[i]})`);return r.join()}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mae(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{reps:s}=r;if(i.dtype==="string"||i.shape.length>5){const u=n.readSync(i.dataId),l=i.dtype==="string"?u.map(h=>oc(h)):u,c=rt(i.shape,i.dtype,l),f=m6e(c,s);return n.makeTensorInfo(f.shape,f.dtype,f.values)}const o=new lGe(i.shape,s);return n.runWebGLProgram(o,[i],i.dtype)}const fGe={kernelName:B1,backendName:"webgl",kernelFunc:mae};class hGe{constructor(t){this.variableNames=["x","indices"],this.customUniforms=[{name:"n",type:"int"},{name:"firstPass",type:"int"},{name:"negativeInf",type:"float"},{name:"dir",type:"int"},{name:"inc",type:"int"}],this.outputShape=t,this.userCode=`
       void main() {
         ivec2 coords = getOutputCoords();
         int batch = coords[0];
         int elemIdx = coords[1];

         // We compare elements pair-wise within a group of size 2 * inc.
         // The comparing rule for each group alternates between ascending
         // and descending. Within each group, we compare each pair at
         // positions i and i+inc. To decide whether an element at position i
         // is x0 or x1, we mod it by 2 * inc, if the result is smaller than
         // inc, it is in the first half of the group, we denote it as x0,
         // otherwise we denote it as x1.
         // For example, as shown in the Bitonic top K paper referenced above,
         // Figure5(a) shows that element[1] is in the
         // second half of the group when group size is 2, but it is in the
         // first half of the group when group size is 4.

         bool isFirstInPair = imod(elemIdx, 2 * inc) < inc;
         int i = isFirstInPair ? elemIdx : elemIdx - inc;

         int i0 = firstPass == 1 ? i : int(getIndices(batch, i));
         int i1 = firstPass == 1 ? i + inc : int(getIndices(batch, i + inc));
         float x0 = i0 < n ? getX(batch, i0) : negativeInf;
         float x1 = i1 < n ? getX(batch, i1) : negativeInf;

         // Denotes which direction indices are in (ascending or descending).
         bool reverse = imod(elemIdx, 2 * dir) >= dir;
         bool isGreater = x0 > x1 || (x0 == x1 && i1 > i0);
         if (reverse == isGreater) { // Elements in opposite order of direction
           int iTemp = i0;
           i0 = i1;
           i1 = iTemp;
         }
         if (isFirstInPair) {
            setOutput(float(i0));
         } else {
            setOutput(float(i1));
         }
       }
     `}}class dGe{constructor(t){this.variableNames=["x","indices"],this.customUniforms=[{name:"n",type:"int"},{name:"firstPass",type:"int"},{name:"k",type:"int"}],this.outputShape=t,this.userCode=`
    void main() {
         // Takes max of indices (0, k), (1, k + 1), (2, k + 2) ...
         ivec2 coords = getOutputCoords();
         int batch = coords[0];
         int elemIdx = coords[1];

         // The output size is half of the previous size.
         // If the previous sequence is | | | | _ _ _ _  | | | |  _ _ _ _ (k=4),
         // we only need to output the indices at positions |, the indices at
         // positions _ can be thrown away, see Figure5(b) After Phase 2
         // (Merge phase) in the Bitonic Top K paper referenced above.
         // For example, the paper shows we only need to output the orange bars.
         // The output sequence should look like this | | | | | | | |.
         // Because the sequence is halved, to map the output index back
         // to the previous sequence to find the corresponding value,
         // we need to double the index. When we double the index,
         // we basically interpolate a position, so 2i looks like
         // | _ | _ | _ | _ | _ | _ | _. We move the | to the first k position
         // of each 2k positions by - elemIdx % k. E.g. for output at
         // index 4,5,6,7, we want to get the corresponding element at
         // original index 8,9,10,11, for output at index 8,9,10,11,
         // we want to get the corresponding element at original index
         // 16,17,18,19, so on and so forth.

         int i = elemIdx < k ? elemIdx : (elemIdx * 2 - imod(elemIdx, k));
         int i0 = firstPass == 1 ? i : int(getIndices(batch, i));
         int i1 = firstPass == 1 ? i + k : int(getIndices(batch, i + k));

         float x0 = getX(batch, i0);
         float x1 = i1 < n ? getX(batch, i1) : x0;

         setOutput(x0 >= x1 ? float(i0) : float(i1));
       }
     `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nd(e,t){t!==null&&e.disposeIntermediateTensorInfo(t)}function zG(e){let t=1;for(;t<e;)t*=2;return t}function pGe(e){const{inputs:t,backend:n,attrs:r}=e,{x:i}=t,{k:s,sorted:o}=r,a=K().getNumber("TOPK_LAST_DIM_CPU_HANDOFF_SIZE_THRESHOLD"),u=K().getNumber("TOPK_K_CPU_HANDOFF_THRESHOLD"),l=i.shape,c=l[l.length-1];if(n.shouldExecuteOnCPU([i])||c<a||s>u){const E=n.readSync(i.dataId),[_,D]=y6e(E,l,i.dtype,s,o);return[n.makeTensorInfo(_.shape,_.dtype,_.values),n.makeTensorInfo(D.shape,D.dtype,D.values)]}if(s===0)return l[l.length-1]=0,[n.makeTensorInfo(l,i.dtype,[]),n.makeTensorInfo(l,"int32",[])];if(c===1)return[i,e$({attrs:{shape:l,dtype:"int32",value:0},backend:n})];const f=n.texData.get(i.dataId),h=f!==null&&f.isPacked,d=h?n.unpackTensor(i):i,g=te(l)/c,m=Ce({inputs:{x:d},attrs:{shape:[g,c]},backend:n});h&&nd(n,d);const y=zG(s),b=zG(c);let v=null;const x=()=>v===null?[m,m]:[m,v],w=(E,_,D)=>{const A=x(),T=new hGe(D),F=[[c],[v===null?1:0],[Number.NEGATIVE_INFINITY],[E],[_]],R=v;v=n.runWebGLProgram(T,A,"int32",F),nd(n,R)};for(let E=1;E<y;E*=2){const _=E*2;for(let D=E;D>=1;D/=2)w(_,D,[g,b])}for(let E=b;E>y;E/=2){const _=x(),D=new dGe([g,E/2]),T=[[c],[v===null?1:0],[y]],I=v;v=n.runWebGLProgram(D,_,"int32",T),nd(n,I);const F=y/2,R=F*2;for(let L=F;L>=1;L/=2)w(R,L,v.shape)}let C=v;v=Q1({inputs:{x:v},backend:n,attrs:{begin:0,size:[g,s]}}),nd(n,C);let $=uae({inputs:{x:m,indices:v},backend:n,attrs:{axis:1,batchDims:1}});nd(n,m);const S=l.slice(0,-1);S.push(s),C=v,v=Ce({inputs:{x:v},attrs:{shape:S},backend:n}),nd(n,C);const k=$;return $=Ce({inputs:{x:$},attrs:{shape:S},backend:n}),nd(n,k),[$,v]}const gGe={kernelName:FT,backendName:"webgl",kernelFunc:pGe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class mGe{constructor(t,n,r,i,s,o){this.variableNames=["Image","Transforms"],this.outputShape=o;const a=r==="nearest"?1:2;let u;switch(i){case"constant":u=1;break;case"reflect":u=2;break;case"wrap":u=3;break;case"nearest":u=4;break;default:u=1;break}this.userCode=`
            float mapCoord(float outCoord, float len) {
              float inCoord = outCoord;
              if(${u} == 2) {
                if (inCoord < 0.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz2 = 2.0 * len;
                    if (inCoord < sz2) {
                      inCoord = sz2 * float(int(float(-inCoord / sz2))) +
                      inCoord;
                    }
                    inCoord = inCoord < -len ? inCoord + sz2 : -inCoord - 1.0;
                  }
                } else if (inCoord > len - 1.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz2 = 2.0 * len;
                    inCoord -= sz2 * float(int(float(inCoord / sz2)));
                    if (inCoord >= len) {
                      inCoord = sz2 - inCoord - 1.0;
                    }
                  }
                }
                return clamp(inCoord, 0.0, len - 1.0);
              } else if (${u} == 3) {
                if (inCoord < 0.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz = len - 1.0;
                    inCoord += len * (float(int(float(-inCoord / sz))) + 1.0);
                  }
                } else if (inCoord > len - 1.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz = len - 1.0;
                    inCoord -= len * float(int(float(inCoord / sz)));
                  }
                }
                return clamp(inCoord, 0.0, len - 1.0);
              } else if (${u} == 4) {
                return clamp(outCoord, 0.0, len - 1.0);
              } else {
                return outCoord;
              }
            }

            float readWithFillValue(int batch, int coordY, int coordX,
              int channel) {
              float outputValue;
              if (0 <= coordY && coordY < ${t} && 0 <= coordX && coordX < ${n}) {
                  outputValue = getImage(batch, coordY, coordX, channel);
              } else {
                outputValue = float(${s});
              }
              return outputValue;
            }

            void main() {
              ivec4 coords = getOutputCoords();
              float outputValue;
              int batch = coords[0];
              int x = coords[2];
              int y = coords[1];
              int channel = coords[3];
              float xf = float(x);
              float yf = float(y);
              float a1 = getTransforms(batch, 0);
              float a2 = getTransforms(batch, 1);
              float a3 = getTransforms(batch, 2);
              float b1 = getTransforms(batch, 3);
              float b2 = getTransforms(batch, 4);
              float b3 = getTransforms(batch, 5);
              float c1 = getTransforms(batch, 6);
              float c2 = getTransforms(batch, 7);
              float projection = c1 * xf + c2 * yf + 1.0;
              if (projection == 0.0) {
                outputValue = float(${s});
              } else {
                float inX = (a1 * xf + a2 * yf + a3) / projection;
                float inY = (b1 * xf + b2 * yf + b3) / projection;
                float mapX = mapCoord(inX, float(${n}));
                float mapY = mapCoord(inY, float(${t}));

                if (${a} == 1) {
                  int coordY = int(round(mapY));
                  int coordX = int(round(mapX));
                  outputValue = readWithFillValue(batch, coordY, coordX,
                    channel);
                } else {
                  float yFloor = floor(mapY);
                  float xFloor = floor(mapX);
                  float yCeil = yFloor + 1.0;
                  float xCeil = xFloor + 1.0;
                  float valueYFloor = (xCeil - mapX) *
                  readWithFillValue(batch, int(yFloor), int(xFloor), channel) +
                  (mapX - xFloor) *
                  readWithFillValue(batch, int(yFloor), int(xCeil), channel);
                  float valueYCeil = (xCeil - mapX) *
                  readWithFillValue(batch, int(yCeil), int(xFloor), channel) +
                  (mapX - xFloor) *
                  readWithFillValue(batch, int(yCeil), int(xCeil), channel);
                  outputValue = (yCeil - mapY) * valueYFloor +
                  (mapY - yFloor) * valueYCeil;
                }
              }
              setOutput(outputValue);
            }
        `}}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yGe(e){const{inputs:t,backend:n,attrs:r}=e,{image:i,transforms:s}=t,{interpolation:o,fillMode:a,fillValue:u,outputShape:l}=r,[c,f,h,d]=i.shape,[p,g]=l??[f,h],m=[c,p,g,d],y=new mGe(f,h,o,a,u,m);return n.runWebGLProgram(y,[i,s],"float32")}const bGe={kernelName:OT,backendName:"webgl",kernelFunc:yGe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xGe(e){const{inputs:t,attrs:n,backend:r}=e,{axis:i}=n,{x:s}=t;Zw(s,"unique"),console.warn("WARNING: ","UI might be locked temporarily as data is being downloaded");const o=r.readSync(s.dataId),{outputValues:a,outputShape:u,indices:l}=b6e(o,i,s.shape,s.dtype);return[r.makeTensorInfo(u,s.dtype,a),r.makeTensorInfo([l.length],"int32",l)]}const vGe={kernelName:RT,backendName:"webgl",kernelFunc:xGe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wGe(e){const{inputs:t,backend:n,attrs:r}=e,{value:i}=t;let{axis:s}=r;s<0&&(s+=i.shape.length);const o=i,a=o.shape.length,u=i.shape[s],l=new Array(a-1);let c=0;for(let g=0;g<a;g++)g!==s&&(l[c++]=o.shape[g]);const f=[],h=new Array(a).fill(0),d=o.shape.slice();d[s]=1;const p=new Array(u);for(let g=0;g<p.length;g++){h[s]=g;const m=Q1({inputs:{x:o},backend:n,attrs:{begin:h,size:d}}),y=Ce({inputs:{x:m},backend:n,attrs:{shape:l}});p[g]=y,f.push(m)}return f.forEach(g=>n.disposeIntermediateTensorInfo(g)),p}const $Ge={kernelName:Ew,backendName:"webgl",kernelFunc:wGe};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class CGe{constructor(t,n){this.variableNames=["x","segmentIds"];const r=t.windowSize,i=t.batchSize,s=t.inSize,o=t.numSegments,a=o*Math.ceil(s/r);this.outputShape=[i,a];const u="0.0",l="sumValue",c=Math.floor(r/4)*4,f=r%4,h=`
        sumValue += dot(values, segFilter);
    `;let d="";s%r>0&&(d=`
        if (inIdx < 0 || inIdx >= ${s}) {
          return initializationValue;
        }
      `);let p="";s%r>0&&(p=`
        if (inIdx < 0 || inIdx >= ${s}) {
          return -1.0;
        }
      `),this.userCode=`
      const float initializationValue = ${u};

      float getValue(int batch, int inIdx) {
        ${d}
        return getX(batch, inIdx);
      }

      float getSegmentIdAtIndex(int inIdx) {
        ${p}
        return getSegmentIds(inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = int(floor(float(outIdx) / float(
          ${o})) * float(${r}));
        int currentSeg = int(mod(float(outIdx), float(${o})));

        float sumValue = 0.0;

        for (int i = 0; i < ${c}; i += 4) {
          int inIdx = inOffset + i;
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 3)) == currentSeg ? 1 : 0
          );

          ${h}
        }

        int inIdx = inOffset + ${c};
        if (${f===1}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            initializationValue,
            initializationValue,
            initializationValue
          );

          int inIdxSeg = int(getSegmentIdAtIndex(inIdx));

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            0,
            0,
            0
          );

          ${h}
        } else if (${f===2}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            initializationValue,
            initializationValue
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
              0,
              0
          );

          ${h}
        } else if (${f===3}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            initializationValue
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,
            0
          );

          ${h}
        }
        setOutput(${l});
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function SGe(e){const{inputs:t,backend:n,attrs:r}=e,{x:i,segmentIds:s}=t,{numSegments:o}=r,a=i.shape.length,u=[];let l=0;const c=Cn([l],a);let f=i;c!=null&&(f=Ii({inputs:{x:i},backend:n,attrs:{perm:c}}),u.push(f),l=On(1,a)[0]);const h=Qne(f.shape,l,o),d=te([f.shape[l]]),p=Ce({inputs:{x:f},backend:n,attrs:{shape:[-1,d]}});u.push(p);const g=PT(i.dtype),m=(x,w,C,$,S)=>{const k=x.shape[0],E=x.shape[1],_=Jne(E,S),D={windowSize:_,inSize:E,batchSize:k,numSegments:S},A=new CGe(D,w),T=n.compileAndRun(A,[x,C],$);if(u.push(T),T.shape[1]===S)return T;const I=gae({backend:n,attrs:{start:0,stop:S,step:1,dtype:"float32"}}),F=mae({inputs:{x:I},backend:n,attrs:{reps:[E/_]}});return u.push(I),u.push(F),m(T,w,F,$,S)},y=m(p,"unsortedSegmentSum",s,g,o),b=Ce({inputs:{x:y},backend:n,attrs:{shape:h}});let v=b;if(c!=null){u.push(b);const x=Eh(c);v=Ii({inputs:{x:v},backend:n,attrs:{perm:x}})}return u.forEach(x=>n.disposeIntermediateTensorInfo(x)),v}const kGe={kernelName:_w,backendName:"webgl",kernelFunc:SGe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const EGe=[lze,fze,pze,yze,xze,$ze,Sze,Eze,Ize,Nze,Rze,Pze,Uze,Gze,Xze,Kze,Jze,n8e,i8e,o8e,c8e,y8e,x8e,C8e,k8e,D8e,F8e,L8e,H6e,z8e,G8e,Y8e,t7e,i7e,o7e,u7e,c7e,p7e,y7e,v7e,$7e,S7e,E7e,T7e,D7e,R7e,L7e,z7e,W7e,G7e,Y7e,Q7e,r9e,o9e,l9e,c9e,h9e,p9e,m9e,b9e,v9e,S9e,_9e,I9e,N9e,R9e,P9e,j9e,H9e,G6e,X9e,W8e,Z9e,eUe,rUe,X6e,aUe,fUe,dUe,yUe,vUe,SUe,_Ue,DUe,RUe,PUe,zUe,VUe,HUe,XUe,JUe,eje,nje,ije,oje,cje,pje,bje,Eje,Z6e,Ije,Fje,Mje,Bje,_8e,jje,Vje,Hje,Yje,Qje,K6e,tWe,rWe,sWe,aWe,uWe,A8e,$je,fWe,gWe,xWe,Q6e,CWe,EWe,IWe,FWe,LWe,BWe,jWe,GWe,XWe,ZWe,eVe,rVe,aVe,cVe,pVe,yVe,g8e,Sje,vVe,$Ve,SVe,EVe,AVe,IVe,NVe,OVe,MVe,BVe,UVe,WVe,GVe,XVe,KVe,JVe,eGe,Cje,oze,rGe,oGe,uGe,fGe,gGe,bGe,aze,vGe,$Ge,kGe,Wje];for(const e of EGe)LT(e);var yae={};const bae=Qp(hIe);var b6={};/*!
 * https://github.com/Starcounter-Jack/JSON-Patch
 * (c) 2017-2022 Joachim Wester
 * MIT licensed
 */var _Ge=globalThis&&globalThis.__extends||function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var s in i)i.hasOwnProperty(s)&&(r[s]=i[s])},e(t,n)};return function(t,n){e(t,n);function r(){this.constructor=t}t.prototype=n===null?Object.create(n):(r.prototype=n.prototype,new r)}}(),AGe=Object.prototype.hasOwnProperty;function wM(e,t){return AGe.call(e,t)}function $M(e){if(Array.isArray(e)){for(var t=new Array(e.length),n=0;n<t.length;n++)t[n]=""+n;return t}if(Object.keys)return Object.keys(e);var r=[];for(var i in e)wM(e,i)&&r.push(i);return r}function Zs(e){switch(typeof e){case"object":return JSON.parse(JSON.stringify(e));case"undefined":return null;default:return e}}function CM(e){for(var t=0,n=e.length,r;t<n;){if(r=e.charCodeAt(t),r>=48&&r<=57){t++;continue}return!1}return!0}function yd(e){return e.indexOf("/")===-1&&e.indexOf("~")===-1?e:e.replace(/~/g,"~0").replace(/\//g,"~1")}function xae(e){return e.replace(/~1/g,"/").replace(/~0/g,"~")}function SM(e){if(e===void 0)return!0;if(e){if(Array.isArray(e)){for(var t=0,n=e.length;t<n;t++)if(SM(e[t]))return!0}else if(typeof e=="object"){for(var r=$M(e),i=r.length,s=0;s<i;s++)if(SM(e[r[s]]))return!0}}return!1}function UG(e,t){var n=[e];for(var r in t){var i=typeof t[r]=="object"?JSON.stringify(t[r],null,2):t[r];typeof i<"u"&&n.push(r+": "+i)}return n.join(`
`)}var vae=function(e){_Ge(t,e);function t(n,r,i,s,o){var a=this.constructor,u=e.call(this,UG(n,{name:r,index:i,operation:s,tree:o}))||this;return u.name=r,u.index=i,u.operation=s,u.tree=o,Object.setPrototypeOf(u,a.prototype),u.message=UG(n,{name:r,index:i,operation:s,tree:o}),u}return t}(Error),Tn=vae,TGe=Zs,bm={add:function(e,t,n){return e[t]=this.value,{newDocument:n}},remove:function(e,t,n){var r=e[t];return delete e[t],{newDocument:n,removed:r}},replace:function(e,t,n){var r=e[t];return e[t]=this.value,{newDocument:n,removed:r}},move:function(e,t,n){var r=iE(n,this.path);r&&(r=Zs(r));var i=ep(n,{op:"remove",path:this.from}).removed;return ep(n,{op:"add",path:this.path,value:i}),{newDocument:n,removed:r}},copy:function(e,t,n){var r=iE(n,this.from);return ep(n,{op:"add",path:this.path,value:Zs(r)}),{newDocument:n}},test:function(e,t,n){return{newDocument:n,test:iv(e[t],this.value)}},_get:function(e,t,n){return this.value=e[t],{newDocument:n}}},IGe={add:function(e,t,n){return CM(t)?e.splice(t,0,this.value):e[t]=this.value,{newDocument:n,index:t}},remove:function(e,t,n){var r=e.splice(t,1);return{newDocument:n,removed:r[0]}},replace:function(e,t,n){var r=e[t];return e[t]=this.value,{newDocument:n,removed:r}},move:bm.move,copy:bm.copy,test:bm.test,_get:bm._get};function iE(e,t){if(t=="")return e;var n={op:"_get",path:t};return ep(e,n),n.value}function ep(e,t,n,r,i,s){if(n===void 0&&(n=!1),r===void 0&&(r=!0),i===void 0&&(i=!0),s===void 0&&(s=0),n&&(typeof n=="function"?n(t,0,e,t.path):sE(t,0)),t.path===""){var o={newDocument:e};if(t.op==="add")return o.newDocument=t.value,o;if(t.op==="replace")return o.newDocument=t.value,o.removed=e,o;if(t.op==="move"||t.op==="copy")return o.newDocument=iE(e,t.from),t.op==="move"&&(o.removed=e),o;if(t.op==="test"){if(o.test=iv(e,t.value),o.test===!1)throw new Tn("Test operation failed","TEST_OPERATION_FAILED",s,t,e);return o.newDocument=e,o}else{if(t.op==="remove")return o.removed=e,o.newDocument=null,o;if(t.op==="_get")return t.value=e,o;if(n)throw new Tn("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",s,t,e);return o}}else{r||(e=Zs(e));var a=t.path||"",u=a.split("/"),l=e,c=1,f=u.length,h=void 0,d=void 0,p=void 0;for(typeof n=="function"?p=n:p=sE;;){if(d=u[c],d&&d.indexOf("~")!=-1&&(d=xae(d)),i&&(d=="__proto__"||d=="prototype"&&c>0&&u[c-1]=="constructor"))throw new TypeError("JSON-Patch: modifying `__proto__` or `constructor/prototype` prop is banned for security reasons, if this was on purpose, please set `banPrototypeModifications` flag false and pass it to this function. More info in fast-json-patch README");if(n&&h===void 0&&(l[d]===void 0?h=u.slice(0,c).join("/"):c==f-1&&(h=t.path),h!==void 0&&p(t,0,e,h)),c++,Array.isArray(l)){if(d==="-")d=l.length;else{if(n&&!CM(d))throw new Tn("Expected an unsigned base-10 integer value, making the new referenced value the array element with the zero-based index","OPERATION_PATH_ILLEGAL_ARRAY_INDEX",s,t,e);CM(d)&&(d=~~d)}if(c>=f){if(n&&t.op==="add"&&d>l.length)throw new Tn("The specified index MUST NOT be greater than the number of elements in the array","OPERATION_VALUE_OUT_OF_BOUNDS",s,t,e);var o=IGe[t.op].call(t,l,d,e);if(o.test===!1)throw new Tn("Test operation failed","TEST_OPERATION_FAILED",s,t,e);return o}}else if(c>=f){var o=bm[t.op].call(t,l,d,e);if(o.test===!1)throw new Tn("Test operation failed","TEST_OPERATION_FAILED",s,t,e);return o}if(l=l[d],n&&c<f&&(!l||typeof l!="object"))throw new Tn("Cannot perform operation at the desired path","OPERATION_PATH_UNRESOLVABLE",s,t,e)}}}function RI(e,t,n,r,i){if(r===void 0&&(r=!0),i===void 0&&(i=!0),n&&!Array.isArray(t))throw new Tn("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");r||(e=Zs(e));for(var s=new Array(t.length),o=0,a=t.length;o<a;o++)s[o]=ep(e,t[o],n,!0,i,o),e=s[o].newDocument;return s.newDocument=e,s}function DGe(e,t,n){var r=ep(e,t);if(r.test===!1)throw new Tn("Test operation failed","TEST_OPERATION_FAILED",n,t,e);return r.newDocument}function sE(e,t,n,r){if(typeof e!="object"||e===null||Array.isArray(e))throw new Tn("Operation is not an object","OPERATION_NOT_AN_OBJECT",t,e,n);if(bm[e.op]){if(typeof e.path!="string")throw new Tn("Operation `path` property is not a string","OPERATION_PATH_INVALID",t,e,n);if(e.path.indexOf("/")!==0&&e.path.length>0)throw new Tn('Operation `path` property must start with "/"',"OPERATION_PATH_INVALID",t,e,n);if((e.op==="move"||e.op==="copy")&&typeof e.from!="string")throw new Tn("Operation `from` property is not present (applicable in `move` and `copy` operations)","OPERATION_FROM_REQUIRED",t,e,n);if((e.op==="add"||e.op==="replace"||e.op==="test")&&e.value===void 0)throw new Tn("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_REQUIRED",t,e,n);if((e.op==="add"||e.op==="replace"||e.op==="test")&&SM(e.value))throw new Tn("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_CANNOT_CONTAIN_UNDEFINED",t,e,n);if(n){if(e.op=="add"){var i=e.path.split("/").length,s=r.split("/").length;if(i!==s+1&&i!==s)throw new Tn("Cannot perform an `add` operation at the desired path","OPERATION_PATH_CANNOT_ADD",t,e,n)}else if(e.op==="replace"||e.op==="remove"||e.op==="_get"){if(e.path!==r)throw new Tn("Cannot perform the operation at a path that does not exist","OPERATION_PATH_UNRESOLVABLE",t,e,n)}else if(e.op==="move"||e.op==="copy"){var o={op:"_get",path:e.from,value:void 0},a=wae([o],n);if(a&&a.name==="OPERATION_PATH_UNRESOLVABLE")throw new Tn("Cannot perform the operation from a path that does not exist","OPERATION_FROM_UNRESOLVABLE",t,e,n)}}}else throw new Tn("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",t,e,n)}function wae(e,t,n){try{if(!Array.isArray(e))throw new Tn("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");if(t)RI(Zs(t),Zs(e),n||!0);else{n=n||sE;for(var r=0;r<e.length;r++)n(e[r],r,t,void 0)}}catch(i){if(i instanceof Tn)return i;throw i}}function iv(e,t){if(e===t)return!0;if(e&&t&&typeof e=="object"&&typeof t=="object"){var n=Array.isArray(e),r=Array.isArray(t),i,s,o;if(n&&r){if(s=e.length,s!=t.length)return!1;for(i=s;i--!==0;)if(!iv(e[i],t[i]))return!1;return!0}if(n!=r)return!1;var a=Object.keys(e);if(s=a.length,s!==Object.keys(t).length)return!1;for(i=s;i--!==0;)if(!t.hasOwnProperty(a[i]))return!1;for(i=s;i--!==0;)if(o=a[i],!iv(e[o],t[o]))return!1;return!0}return e!==e&&t!==t}const NGe=Object.freeze(Object.defineProperty({__proto__:null,JsonPatchError:Tn,_areEquals:iv,applyOperation:ep,applyPatch:RI,applyReducer:DGe,deepClone:TGe,getValueByPointer:iE,validate:wae,validator:sE},Symbol.toStringTag,{value:"Module"}));/*!
 * https://github.com/Starcounter-Jack/JSON-Patch
 * (c) 2017-2021 Joachim Wester
 * MIT license
 */var x6=new WeakMap,FGe=function(){function e(t){this.observers=new Map,this.obj=t}return e}(),OGe=function(){function e(t,n){this.callback=t,this.observer=n}return e}();function RGe(e){return x6.get(e)}function MGe(e,t){return e.observers.get(t)}function LGe(e,t){e.observers.delete(t.callback)}function PGe(e,t){t.unobserve()}function BGe(e,t){var n=[],r,i=RGe(e);if(!i)i=new FGe(e),x6.set(e,i);else{var s=MGe(i,t);r=s&&s.observer}if(r)return r;if(r={},i.value=Zs(e),t){r.callback=t,r.next=null;var o=function(){kM(r)},a=function(){clearTimeout(r.next),r.next=setTimeout(o)};typeof window<"u"&&(window.addEventListener("mouseup",a),window.addEventListener("keyup",a),window.addEventListener("mousedown",a),window.addEventListener("keydown",a),window.addEventListener("change",a))}return r.patches=n,r.object=e,r.unobserve=function(){kM(r),clearTimeout(r.next),LGe(i,r),typeof window<"u"&&(window.removeEventListener("mouseup",a),window.removeEventListener("keyup",a),window.removeEventListener("mousedown",a),window.removeEventListener("keydown",a),window.removeEventListener("change",a))},i.observers.set(t,new OGe(t,r)),r}function kM(e,t){t===void 0&&(t=!1);var n=x6.get(e.object);v6(n.value,e.object,e.patches,"",t),e.patches.length&&RI(n.value,e.patches);var r=e.patches;return r.length>0&&(e.patches=[],e.callback&&e.callback(r)),r}function v6(e,t,n,r,i){if(t!==e){typeof t.toJSON=="function"&&(t=t.toJSON());for(var s=$M(t),o=$M(e),a=!1,u=o.length-1;u>=0;u--){var l=o[u],c=e[l];if(wM(t,l)&&!(t[l]===void 0&&c!==void 0&&Array.isArray(t)===!1)){var f=t[l];typeof c=="object"&&c!=null&&typeof f=="object"&&f!=null&&Array.isArray(c)===Array.isArray(f)?v6(c,f,n,r+"/"+yd(l),i):c!==f&&(i&&n.push({op:"test",path:r+"/"+yd(l),value:Zs(c)}),n.push({op:"replace",path:r+"/"+yd(l),value:Zs(f)}))}else Array.isArray(e)===Array.isArray(t)?(i&&n.push({op:"test",path:r+"/"+yd(l),value:Zs(c)}),n.push({op:"remove",path:r+"/"+yd(l)}),a=!0):(i&&n.push({op:"test",path:r,value:e}),n.push({op:"replace",path:r,value:t}))}if(!(!a&&s.length==o.length))for(var u=0;u<s.length;u++){var l=s[u];!wM(e,l)&&t[l]!==void 0&&n.push({op:"add",path:r+"/"+yd(l),value:Zs(t[l])})}}}function zGe(e,t,n){n===void 0&&(n=!1);var r=[];return v6(e,t,r,"",n),r}const UGe=Object.freeze(Object.defineProperty({__proto__:null,compare:zGe,generate:kM,observe:BGe,unobserve:PGe},Symbol.toStringTag,{value:"Module"}));Object.assign({},NGe,UGe,{JsonPatchError:vae,deepClone:Zs,escapePathComponent:yd,unescapePathComponent:xae});var jGe=/("(?:[^\\"]|\\.)*")|[:,]/g,WGe=function(t,n){var r,i,s;return n=n||{},r=JSON.stringify([1],void 0,n.indent===void 0?2:n.indent).slice(2,-3),i=r===""?1/0:n.maxLength===void 0?80:n.maxLength,s=n.replacer,function o(a,u,l){var c,f,h,d,p,g,m,y,b,v,x,w;if(a&&typeof a.toJSON=="function"&&(a=a.toJSON()),x=JSON.stringify(a,s),x===void 0)return x;if(m=i-u.length-l,x.length<=m&&(b=x.replace(jGe,function(C,$){return $||C+" "}),b.length<=m))return b;if(s!=null&&(a=JSON.parse(x),s=void 0),typeof a=="object"&&a!==null){if(y=u+r,h=[],f=0,Array.isArray(a))for(v="[",c="]",m=a.length;f<m;f++)h.push(o(a[f],y,f===m-1?0:1)||"null");else for(v="{",c="}",g=Object.keys(a),m=g.length;f<m;f++)d=g[f],p=JSON.stringify(d)+": ",w=o(a[d],y,p.length+(f===m-1?0:1)),w!==void 0&&h.push(p+w);if(h.length>0)return[v,r+h.join(`,
`+y),c].join(`
`+u)}return x}(t,"",0)};const m3=k2(WGe);var EM={exports:{}};const VGe="2.0.0",$ae=256,GGe=Number.MAX_SAFE_INTEGER||9007199254740991,HGe=16,qGe=$ae-6,XGe=["major","premajor","minor","preminor","patch","prepatch","prerelease"];var MI={MAX_LENGTH:$ae,MAX_SAFE_COMPONENT_LENGTH:HGe,MAX_SAFE_BUILD_LENGTH:qGe,MAX_SAFE_INTEGER:GGe,RELEASE_TYPES:XGe,SEMVER_SPEC_VERSION:VGe,FLAG_INCLUDE_PRERELEASE:1,FLAG_LOOSE:2};const YGe=typeof process=="object"&&process.env&&{}.NODE_DEBUG&&/\bsemver\b/i.test({}.NODE_DEBUG)?(...e)=>console.error("SEMVER",...e):()=>{};var LI=YGe;(function(e,t){const{MAX_SAFE_COMPONENT_LENGTH:n,MAX_SAFE_BUILD_LENGTH:r,MAX_LENGTH:i}=MI,s=LI;t=e.exports={};const o=t.re=[],a=t.safeRe=[],u=t.src=[],l=t.t={};let c=0;const f="[a-zA-Z0-9-]",h=[["\\s",1],["\\d",i],[f,r]],d=g=>{for(const[m,y]of h)g=g.split(`${m}*`).join(`${m}{0,${y}}`).split(`${m}+`).join(`${m}{1,${y}}`);return g},p=(g,m,y)=>{const b=d(m),v=c++;s(g,v,m),l[g]=v,u[v]=m,o[v]=new RegExp(m,y?"g":void 0),a[v]=new RegExp(b,y?"g":void 0)};p("NUMERICIDENTIFIER","0|[1-9]\\d*"),p("NUMERICIDENTIFIERLOOSE","\\d+"),p("NONNUMERICIDENTIFIER",`\\d*[a-zA-Z-]${f}*`),p("MAINVERSION",`(${u[l.NUMERICIDENTIFIER]})\\.(${u[l.NUMERICIDENTIFIER]})\\.(${u[l.NUMERICIDENTIFIER]})`),p("MAINVERSIONLOOSE",`(${u[l.NUMERICIDENTIFIERLOOSE]})\\.(${u[l.NUMERICIDENTIFIERLOOSE]})\\.(${u[l.NUMERICIDENTIFIERLOOSE]})`),p("PRERELEASEIDENTIFIER",`(?:${u[l.NUMERICIDENTIFIER]}|${u[l.NONNUMERICIDENTIFIER]})`),p("PRERELEASEIDENTIFIERLOOSE",`(?:${u[l.NUMERICIDENTIFIERLOOSE]}|${u[l.NONNUMERICIDENTIFIER]})`),p("PRERELEASE",`(?:-(${u[l.PRERELEASEIDENTIFIER]}(?:\\.${u[l.PRERELEASEIDENTIFIER]})*))`),p("PRERELEASELOOSE",`(?:-?(${u[l.PRERELEASEIDENTIFIERLOOSE]}(?:\\.${u[l.PRERELEASEIDENTIFIERLOOSE]})*))`),p("BUILDIDENTIFIER",`${f}+`),p("BUILD",`(?:\\+(${u[l.BUILDIDENTIFIER]}(?:\\.${u[l.BUILDIDENTIFIER]})*))`),p("FULLPLAIN",`v?${u[l.MAINVERSION]}${u[l.PRERELEASE]}?${u[l.BUILD]}?`),p("FULL",`^${u[l.FULLPLAIN]}$`),p("LOOSEPLAIN",`[v=\\s]*${u[l.MAINVERSIONLOOSE]}${u[l.PRERELEASELOOSE]}?${u[l.BUILD]}?`),p("LOOSE",`^${u[l.LOOSEPLAIN]}$`),p("GTLT","((?:<|>)?=?)"),p("XRANGEIDENTIFIERLOOSE",`${u[l.NUMERICIDENTIFIERLOOSE]}|x|X|\\*`),p("XRANGEIDENTIFIER",`${u[l.NUMERICIDENTIFIER]}|x|X|\\*`),p("XRANGEPLAIN",`[v=\\s]*(${u[l.XRANGEIDENTIFIER]})(?:\\.(${u[l.XRANGEIDENTIFIER]})(?:\\.(${u[l.XRANGEIDENTIFIER]})(?:${u[l.PRERELEASE]})?${u[l.BUILD]}?)?)?`),p("XRANGEPLAINLOOSE",`[v=\\s]*(${u[l.XRANGEIDENTIFIERLOOSE]})(?:\\.(${u[l.XRANGEIDENTIFIERLOOSE]})(?:\\.(${u[l.XRANGEIDENTIFIERLOOSE]})(?:${u[l.PRERELEASELOOSE]})?${u[l.BUILD]}?)?)?`),p("XRANGE",`^${u[l.GTLT]}\\s*${u[l.XRANGEPLAIN]}$`),p("XRANGELOOSE",`^${u[l.GTLT]}\\s*${u[l.XRANGEPLAINLOOSE]}$`),p("COERCE",`(^|[^\\d])(\\d{1,${n}})(?:\\.(\\d{1,${n}}))?(?:\\.(\\d{1,${n}}))?(?:$|[^\\d])`),p("COERCERTL",u[l.COERCE],!0),p("LONETILDE","(?:~>?)"),p("TILDETRIM",`(\\s*)${u[l.LONETILDE]}\\s+`,!0),t.tildeTrimReplace="$1~",p("TILDE",`^${u[l.LONETILDE]}${u[l.XRANGEPLAIN]}$`),p("TILDELOOSE",`^${u[l.LONETILDE]}${u[l.XRANGEPLAINLOOSE]}$`),p("LONECARET","(?:\\^)"),p("CARETTRIM",`(\\s*)${u[l.LONECARET]}\\s+`,!0),t.caretTrimReplace="$1^",p("CARET",`^${u[l.LONECARET]}${u[l.XRANGEPLAIN]}$`),p("CARETLOOSE",`^${u[l.LONECARET]}${u[l.XRANGEPLAINLOOSE]}$`),p("COMPARATORLOOSE",`^${u[l.GTLT]}\\s*(${u[l.LOOSEPLAIN]})$|^$`),p("COMPARATOR",`^${u[l.GTLT]}\\s*(${u[l.FULLPLAIN]})$|^$`),p("COMPARATORTRIM",`(\\s*)${u[l.GTLT]}\\s*(${u[l.LOOSEPLAIN]}|${u[l.XRANGEPLAIN]})`,!0),t.comparatorTrimReplace="$1$2$3",p("HYPHENRANGE",`^\\s*(${u[l.XRANGEPLAIN]})\\s+-\\s+(${u[l.XRANGEPLAIN]})\\s*$`),p("HYPHENRANGELOOSE",`^\\s*(${u[l.XRANGEPLAINLOOSE]})\\s+-\\s+(${u[l.XRANGEPLAINLOOSE]})\\s*$`),p("STAR","(<|>)?=?\\s*\\*"),p("GTE0","^\\s*>=\\s*0\\.0\\.0\\s*$"),p("GTE0PRE","^\\s*>=\\s*0\\.0\\.0-0\\s*$")})(EM,EM.exports);var t$=EM.exports;const KGe=Object.freeze({loose:!0}),ZGe=Object.freeze({}),JGe=e=>e?typeof e!="object"?KGe:e:ZGe;var w6=JGe;const jG=/^[0-9]+$/,Cae=(e,t)=>{const n=jG.test(e),r=jG.test(t);return n&&r&&(e=+e,t=+t),e===t?0:n&&!r?-1:r&&!n?1:e<t?-1:1},QGe=(e,t)=>Cae(t,e);var Sae={compareIdentifiers:Cae,rcompareIdentifiers:QGe};const BC=LI,{MAX_LENGTH:WG,MAX_SAFE_INTEGER:zC}=MI,{safeRe:VG,t:GG}=t$,eHe=w6,{compareIdentifiers:Zg}=Sae;let tHe=class ru{constructor(t,n){if(n=eHe(n),t instanceof ru){if(t.loose===!!n.loose&&t.includePrerelease===!!n.includePrerelease)return t;t=t.version}else if(typeof t!="string")throw new TypeError(`Invalid version. Must be a string. Got type "${typeof t}".`);if(t.length>WG)throw new TypeError(`version is longer than ${WG} characters`);BC("SemVer",t,n),this.options=n,this.loose=!!n.loose,this.includePrerelease=!!n.includePrerelease;const r=t.trim().match(n.loose?VG[GG.LOOSE]:VG[GG.FULL]);if(!r)throw new TypeError(`Invalid Version: ${t}`);if(this.raw=t,this.major=+r[1],this.minor=+r[2],this.patch=+r[3],this.major>zC||this.major<0)throw new TypeError("Invalid major version");if(this.minor>zC||this.minor<0)throw new TypeError("Invalid minor version");if(this.patch>zC||this.patch<0)throw new TypeError("Invalid patch version");r[4]?this.prerelease=r[4].split(".").map(i=>{if(/^[0-9]+$/.test(i)){const s=+i;if(s>=0&&s<zC)return s}return i}):this.prerelease=[],this.build=r[5]?r[5].split("."):[],this.format()}format(){return this.version=`${this.major}.${this.minor}.${this.patch}`,this.prerelease.length&&(this.version+=`-${this.prerelease.join(".")}`),this.version}toString(){return this.version}compare(t){if(BC("SemVer.compare",this.version,this.options,t),!(t instanceof ru)){if(typeof t=="string"&&t===this.version)return 0;t=new ru(t,this.options)}return t.version===this.version?0:this.compareMain(t)||this.comparePre(t)}compareMain(t){return t instanceof ru||(t=new ru(t,this.options)),Zg(this.major,t.major)||Zg(this.minor,t.minor)||Zg(this.patch,t.patch)}comparePre(t){if(t instanceof ru||(t=new ru(t,this.options)),this.prerelease.length&&!t.prerelease.length)return-1;if(!this.prerelease.length&&t.prerelease.length)return 1;if(!this.prerelease.length&&!t.prerelease.length)return 0;let n=0;do{const r=this.prerelease[n],i=t.prerelease[n];if(BC("prerelease compare",n,r,i),r===void 0&&i===void 0)return 0;if(i===void 0)return 1;if(r===void 0)return-1;if(r===i)continue;return Zg(r,i)}while(++n)}compareBuild(t){t instanceof ru||(t=new ru(t,this.options));let n=0;do{const r=this.build[n],i=t.build[n];if(BC("prerelease compare",n,r,i),r===void 0&&i===void 0)return 0;if(i===void 0)return 1;if(r===void 0)return-1;if(r===i)continue;return Zg(r,i)}while(++n)}inc(t,n,r){switch(t){case"premajor":this.prerelease.length=0,this.patch=0,this.minor=0,this.major++,this.inc("pre",n,r);break;case"preminor":this.prerelease.length=0,this.patch=0,this.minor++,this.inc("pre",n,r);break;case"prepatch":this.prerelease.length=0,this.inc("patch",n,r),this.inc("pre",n,r);break;case"prerelease":this.prerelease.length===0&&this.inc("patch",n,r),this.inc("pre",n,r);break;case"major":(this.minor!==0||this.patch!==0||this.prerelease.length===0)&&this.major++,this.minor=0,this.patch=0,this.prerelease=[];break;case"minor":(this.patch!==0||this.prerelease.length===0)&&this.minor++,this.patch=0,this.prerelease=[];break;case"patch":this.prerelease.length===0&&this.patch++,this.prerelease=[];break;case"pre":{const i=Number(r)?1:0;if(!n&&r===!1)throw new Error("invalid increment argument: identifier is empty");if(this.prerelease.length===0)this.prerelease=[i];else{let s=this.prerelease.length;for(;--s>=0;)typeof this.prerelease[s]=="number"&&(this.prerelease[s]++,s=-2);if(s===-1){if(n===this.prerelease.join(".")&&r===!1)throw new Error("invalid increment argument: identifier already exists");this.prerelease.push(i)}}if(n){let s=[n,i];r===!1&&(s=[n]),Zg(this.prerelease[0],n)===0?isNaN(this.prerelease[1])&&(this.prerelease=s):this.prerelease=s}break}default:throw new Error(`invalid increment argument: ${t}`)}return this.raw=this.format(),this.build.length&&(this.raw+=`+${this.build.join(".")}`),this}};var ns=tHe;const HG=ns,nHe=(e,t,n=!1)=>{if(e instanceof HG)return e;try{return new HG(e,t)}catch(r){if(!n)return null;throw r}};var ey=nHe;const rHe=ey,iHe=(e,t)=>{const n=rHe(e,t);return n?n.version:null};var sHe=iHe;const oHe=ey,aHe=(e,t)=>{const n=oHe(e.trim().replace(/^[=v]+/,""),t);return n?n.version:null};var uHe=aHe;const qG=ns,lHe=(e,t,n,r,i)=>{typeof n=="string"&&(i=r,r=n,n=void 0);try{return new qG(e instanceof qG?e.version:e,n).inc(t,r,i).version}catch{return null}};var cHe=lHe;const XG=ey,fHe=(e,t)=>{const n=XG(e,null,!0),r=XG(t,null,!0),i=n.compare(r);if(i===0)return null;const s=i>0,o=s?n:r,a=s?r:n,u=!!o.prerelease.length;if(!!a.prerelease.length&&!u)return!a.patch&&!a.minor?"major":o.patch?"patch":o.minor?"minor":"major";const c=u?"pre":"";return n.major!==r.major?c+"major":n.minor!==r.minor?c+"minor":n.patch!==r.patch?c+"patch":"prerelease"};var hHe=fHe;const dHe=ns,pHe=(e,t)=>new dHe(e,t).major;var gHe=pHe;const mHe=ns,yHe=(e,t)=>new mHe(e,t).minor;var bHe=yHe;const xHe=ns,vHe=(e,t)=>new xHe(e,t).patch;var wHe=vHe;const $He=ey,CHe=(e,t)=>{const n=$He(e,t);return n&&n.prerelease.length?n.prerelease:null};var SHe=CHe;const YG=ns,kHe=(e,t,n)=>new YG(e,n).compare(new YG(t,n));var za=kHe;const EHe=za,_He=(e,t,n)=>EHe(t,e,n);var AHe=_He;const THe=za,IHe=(e,t)=>THe(e,t,!0);var DHe=IHe;const KG=ns,NHe=(e,t,n)=>{const r=new KG(e,n),i=new KG(t,n);return r.compare(i)||r.compareBuild(i)};var $6=NHe;const FHe=$6,OHe=(e,t)=>e.sort((n,r)=>FHe(n,r,t));var RHe=OHe;const MHe=$6,LHe=(e,t)=>e.sort((n,r)=>MHe(r,n,t));var PHe=LHe;const BHe=za,zHe=(e,t,n)=>BHe(e,t,n)>0;var PI=zHe;const UHe=za,jHe=(e,t,n)=>UHe(e,t,n)<0;var C6=jHe;const WHe=za,VHe=(e,t,n)=>WHe(e,t,n)===0;var kae=VHe;const GHe=za,HHe=(e,t,n)=>GHe(e,t,n)!==0;var Eae=HHe;const qHe=za,XHe=(e,t,n)=>qHe(e,t,n)>=0;var S6=XHe;const YHe=za,KHe=(e,t,n)=>YHe(e,t,n)<=0;var k6=KHe;const ZHe=kae,JHe=Eae,QHe=PI,eqe=S6,tqe=C6,nqe=k6,rqe=(e,t,n,r)=>{switch(t){case"===":return typeof e=="object"&&(e=e.version),typeof n=="object"&&(n=n.version),e===n;case"!==":return typeof e=="object"&&(e=e.version),typeof n=="object"&&(n=n.version),e!==n;case"":case"=":case"==":return ZHe(e,n,r);case"!=":return JHe(e,n,r);case">":return QHe(e,n,r);case">=":return eqe(e,n,r);case"<":return tqe(e,n,r);case"<=":return nqe(e,n,r);default:throw new TypeError(`Invalid operator: ${t}`)}};var _ae=rqe;const iqe=ns,sqe=ey,{safeRe:UC,t:jC}=t$,oqe=(e,t)=>{if(e instanceof iqe)return e;if(typeof e=="number"&&(e=String(e)),typeof e!="string")return null;t=t||{};let n=null;if(!t.rtl)n=e.match(UC[jC.COERCE]);else{let r;for(;(r=UC[jC.COERCERTL].exec(e))&&(!n||n.index+n[0].length!==e.length);)(!n||r.index+r[0].length!==n.index+n[0].length)&&(n=r),UC[jC.COERCERTL].lastIndex=r.index+r[1].length+r[2].length;UC[jC.COERCERTL].lastIndex=-1}return n===null?null:sqe(`${n[2]}.${n[3]||"0"}.${n[4]||"0"}`,t)};var aqe=oqe,y3,ZG;function uqe(){return ZG||(ZG=1,y3=function(e){e.prototype[Symbol.iterator]=function*(){for(let t=this.head;t;t=t.next)yield t.value}}),y3}var lqe=Tt;Tt.Node=Sp;Tt.create=Tt;function Tt(e){var t=this;if(t instanceof Tt||(t=new Tt),t.tail=null,t.head=null,t.length=0,e&&typeof e.forEach=="function")e.forEach(function(i){t.push(i)});else if(arguments.length>0)for(var n=0,r=arguments.length;n<r;n++)t.push(arguments[n]);return t}Tt.prototype.removeNode=function(e){if(e.list!==this)throw new Error("removing node which does not belong to this list");var t=e.next,n=e.prev;return t&&(t.prev=n),n&&(n.next=t),e===this.head&&(this.head=t),e===this.tail&&(this.tail=n),e.list.length--,e.next=null,e.prev=null,e.list=null,t};Tt.prototype.unshiftNode=function(e){if(e!==this.head){e.list&&e.list.removeNode(e);var t=this.head;e.list=this,e.next=t,t&&(t.prev=e),this.head=e,this.tail||(this.tail=e),this.length++}};Tt.prototype.pushNode=function(e){if(e!==this.tail){e.list&&e.list.removeNode(e);var t=this.tail;e.list=this,e.prev=t,t&&(t.next=e),this.tail=e,this.head||(this.head=e),this.length++}};Tt.prototype.push=function(){for(var e=0,t=arguments.length;e<t;e++)fqe(this,arguments[e]);return this.length};Tt.prototype.unshift=function(){for(var e=0,t=arguments.length;e<t;e++)hqe(this,arguments[e]);return this.length};Tt.prototype.pop=function(){if(this.tail){var e=this.tail.value;return this.tail=this.tail.prev,this.tail?this.tail.next=null:this.head=null,this.length--,e}};Tt.prototype.shift=function(){if(this.head){var e=this.head.value;return this.head=this.head.next,this.head?this.head.prev=null:this.tail=null,this.length--,e}};Tt.prototype.forEach=function(e,t){t=t||this;for(var n=this.head,r=0;n!==null;r++)e.call(t,n.value,r,this),n=n.next};Tt.prototype.forEachReverse=function(e,t){t=t||this;for(var n=this.tail,r=this.length-1;n!==null;r--)e.call(t,n.value,r,this),n=n.prev};Tt.prototype.get=function(e){for(var t=0,n=this.head;n!==null&&t<e;t++)n=n.next;if(t===e&&n!==null)return n.value};Tt.prototype.getReverse=function(e){for(var t=0,n=this.tail;n!==null&&t<e;t++)n=n.prev;if(t===e&&n!==null)return n.value};Tt.prototype.map=function(e,t){t=t||this;for(var n=new Tt,r=this.head;r!==null;)n.push(e.call(t,r.value,this)),r=r.next;return n};Tt.prototype.mapReverse=function(e,t){t=t||this;for(var n=new Tt,r=this.tail;r!==null;)n.push(e.call(t,r.value,this)),r=r.prev;return n};Tt.prototype.reduce=function(e,t){var n,r=this.head;if(arguments.length>1)n=t;else if(this.head)r=this.head.next,n=this.head.value;else throw new TypeError("Reduce of empty list with no initial value");for(var i=0;r!==null;i++)n=e(n,r.value,i),r=r.next;return n};Tt.prototype.reduceReverse=function(e,t){var n,r=this.tail;if(arguments.length>1)n=t;else if(this.tail)r=this.tail.prev,n=this.tail.value;else throw new TypeError("Reduce of empty list with no initial value");for(var i=this.length-1;r!==null;i--)n=e(n,r.value,i),r=r.prev;return n};Tt.prototype.toArray=function(){for(var e=new Array(this.length),t=0,n=this.head;n!==null;t++)e[t]=n.value,n=n.next;return e};Tt.prototype.toArrayReverse=function(){for(var e=new Array(this.length),t=0,n=this.tail;n!==null;t++)e[t]=n.value,n=n.prev;return e};Tt.prototype.slice=function(e,t){t=t||this.length,t<0&&(t+=this.length),e=e||0,e<0&&(e+=this.length);var n=new Tt;if(t<e||t<0)return n;e<0&&(e=0),t>this.length&&(t=this.length);for(var r=0,i=this.head;i!==null&&r<e;r++)i=i.next;for(;i!==null&&r<t;r++,i=i.next)n.push(i.value);return n};Tt.prototype.sliceReverse=function(e,t){t=t||this.length,t<0&&(t+=this.length),e=e||0,e<0&&(e+=this.length);var n=new Tt;if(t<e||t<0)return n;e<0&&(e=0),t>this.length&&(t=this.length);for(var r=this.length,i=this.tail;i!==null&&r>t;r--)i=i.prev;for(;i!==null&&r>e;r--,i=i.prev)n.push(i.value);return n};Tt.prototype.splice=function(e,t,...n){e>this.length&&(e=this.length-1),e<0&&(e=this.length+e);for(var r=0,i=this.head;i!==null&&r<e;r++)i=i.next;for(var s=[],r=0;i&&r<t;r++)s.push(i.value),i=this.removeNode(i);i===null&&(i=this.tail),i!==this.head&&i!==this.tail&&(i=i.prev);for(var r=0;r<n.length;r++)i=cqe(this,i,n[r]);return s};Tt.prototype.reverse=function(){for(var e=this.head,t=this.tail,n=e;n!==null;n=n.prev){var r=n.prev;n.prev=n.next,n.next=r}return this.head=t,this.tail=e,this};function cqe(e,t,n){var r=t===e.head?new Sp(n,null,t,e):new Sp(n,t,t.next,e);return r.next===null&&(e.tail=r),r.prev===null&&(e.head=r),e.length++,r}function fqe(e,t){e.tail=new Sp(t,e.tail,null,e),e.head||(e.head=e.tail),e.length++}function hqe(e,t){e.head=new Sp(t,null,e.head,e),e.tail||(e.tail=e.head),e.length++}function Sp(e,t,n,r){if(!(this instanceof Sp))return new Sp(e,t,n,r);this.list=r,this.value=e,t?(t.next=this,this.prev=t):this.prev=null,n?(n.prev=this,this.next=n):this.next=null}try{uqe()(Tt)}catch{}const dqe=lqe,kd=Symbol("max"),Tl=Symbol("length"),Jg=Symbol("lengthCalculator"),ax=Symbol("allowStale"),Bd=Symbol("maxAge"),El=Symbol("dispose"),JG=Symbol("noDisposeOnSet"),vr=Symbol("lruList"),oa=Symbol("cache"),Aae=Symbol("updateAgeOnGet"),b3=()=>1;class pqe{constructor(t){if(typeof t=="number"&&(t={max:t}),t||(t={}),t.max&&(typeof t.max!="number"||t.max<0))throw new TypeError("max must be a non-negative number");this[kd]=t.max||1/0;const n=t.length||b3;if(this[Jg]=typeof n!="function"?b3:n,this[ax]=t.stale||!1,t.maxAge&&typeof t.maxAge!="number")throw new TypeError("maxAge must be a number");this[Bd]=t.maxAge||0,this[El]=t.dispose,this[JG]=t.noDisposeOnSet||!1,this[Aae]=t.updateAgeOnGet||!1,this.reset()}set max(t){if(typeof t!="number"||t<0)throw new TypeError("max must be a non-negative number");this[kd]=t||1/0,Vy(this)}get max(){return this[kd]}set allowStale(t){this[ax]=!!t}get allowStale(){return this[ax]}set maxAge(t){if(typeof t!="number")throw new TypeError("maxAge must be a non-negative number");this[Bd]=t,Vy(this)}get maxAge(){return this[Bd]}set lengthCalculator(t){typeof t!="function"&&(t=b3),t!==this[Jg]&&(this[Jg]=t,this[Tl]=0,this[vr].forEach(n=>{n.length=this[Jg](n.value,n.key),this[Tl]+=n.length})),Vy(this)}get lengthCalculator(){return this[Jg]}get length(){return this[Tl]}get itemCount(){return this[vr].length}rforEach(t,n){n=n||this;for(let r=this[vr].tail;r!==null;){const i=r.prev;QG(this,t,r,n),r=i}}forEach(t,n){n=n||this;for(let r=this[vr].head;r!==null;){const i=r.next;QG(this,t,r,n),r=i}}keys(){return this[vr].toArray().map(t=>t.key)}values(){return this[vr].toArray().map(t=>t.value)}reset(){this[El]&&this[vr]&&this[vr].length&&this[vr].forEach(t=>this[El](t.key,t.value)),this[oa]=new Map,this[vr]=new dqe,this[Tl]=0}dump(){return this[vr].map(t=>oE(this,t)?!1:{k:t.key,v:t.value,e:t.now+(t.maxAge||0)}).toArray().filter(t=>t)}dumpLru(){return this[vr]}set(t,n,r){if(r=r||this[Bd],r&&typeof r!="number")throw new TypeError("maxAge must be a number");const i=r?Date.now():0,s=this[Jg](n,t);if(this[oa].has(t)){if(s>this[kd])return Im(this,this[oa].get(t)),!1;const u=this[oa].get(t).value;return this[El]&&(this[JG]||this[El](t,u.value)),u.now=i,u.maxAge=r,u.value=n,this[Tl]+=s-u.length,u.length=s,this.get(t),Vy(this),!0}const o=new gqe(t,n,s,i,r);return o.length>this[kd]?(this[El]&&this[El](t,n),!1):(this[Tl]+=o.length,this[vr].unshift(o),this[oa].set(t,this[vr].head),Vy(this),!0)}has(t){if(!this[oa].has(t))return!1;const n=this[oa].get(t).value;return!oE(this,n)}get(t){return x3(this,t,!0)}peek(t){return x3(this,t,!1)}pop(){const t=this[vr].tail;return t?(Im(this,t),t.value):null}del(t){Im(this,this[oa].get(t))}load(t){this.reset();const n=Date.now();for(let r=t.length-1;r>=0;r--){const i=t[r],s=i.e||0;if(s===0)this.set(i.k,i.v);else{const o=s-n;o>0&&this.set(i.k,i.v,o)}}}prune(){this[oa].forEach((t,n)=>x3(this,n,!1))}}const x3=(e,t,n)=>{const r=e[oa].get(t);if(r){const i=r.value;if(oE(e,i)){if(Im(e,r),!e[ax])return}else n&&(e[Aae]&&(r.value.now=Date.now()),e[vr].unshiftNode(r));return i.value}},oE=(e,t)=>{if(!t||!t.maxAge&&!e[Bd])return!1;const n=Date.now()-t.now;return t.maxAge?n>t.maxAge:e[Bd]&&n>e[Bd]},Vy=e=>{if(e[Tl]>e[kd])for(let t=e[vr].tail;e[Tl]>e[kd]&&t!==null;){const n=t.prev;Im(e,t),t=n}},Im=(e,t)=>{if(t){const n=t.value;e[El]&&e[El](n.key,n.value),e[Tl]-=n.length,e[oa].delete(n.key),e[vr].removeNode(t)}};let gqe=class{constructor(t,n,r,i,s){this.key=t,this.value=n,this.length=r,this.now=i,this.maxAge=s||0}};const QG=(e,t,n,r)=>{let i=n.value;oE(e,i)&&(Im(e,n),e[ax]||(i=void 0)),i&&t.call(r,i.value,i.key,e)};var mqe=pqe,v3,eH;function Ua(){if(eH)return v3;eH=1;class e{constructor(T,I){if(I=r(I),T instanceof e)return T.loose===!!I.loose&&T.includePrerelease===!!I.includePrerelease?T:new e(T.raw,I);if(T instanceof i)return this.raw=T.value,this.set=[[T]],this.format(),this;if(this.options=I,this.loose=!!I.loose,this.includePrerelease=!!I.includePrerelease,this.raw=T.trim().split(/\s+/).join(" "),this.set=this.raw.split("||").map(F=>this.parseRange(F.trim())).filter(F=>F.length),!this.set.length)throw new TypeError(`Invalid SemVer Range: ${this.raw}`);if(this.set.length>1){const F=this.set[0];if(this.set=this.set.filter(R=>!p(R[0])),this.set.length===0)this.set=[F];else if(this.set.length>1){for(const R of this.set)if(R.length===1&&g(R[0])){this.set=[R];break}}}this.format()}format(){return this.range=this.set.map(T=>T.join(" ").trim()).join("||").trim(),this.range}toString(){return this.range}parseRange(T){const F=((this.options.includePrerelease&&h)|(this.options.loose&&d))+":"+T,R=n.get(F);if(R)return R;const L=this.options.loose,P=L?a[u.HYPHENRANGELOOSE]:a[u.HYPHENRANGE];T=T.replace(P,_(this.options.includePrerelease)),s("hyphen replace",T),T=T.replace(a[u.COMPARATORTRIM],l),s("comparator trim",T),T=T.replace(a[u.TILDETRIM],c),s("tilde trim",T),T=T.replace(a[u.CARETTRIM],f),s("caret trim",T);let q=T.split(" ").map(Q=>y(Q,this.options)).join(" ").split(/\s+/).map(Q=>E(Q,this.options));L&&(q=q.filter(Q=>(s("loose invalid filter",Q,this.options),!!Q.match(a[u.COMPARATORLOOSE])))),s("range list",q);const X=new Map,G=q.map(Q=>new i(Q,this.options));for(const Q of G){if(p(Q))return[Q];X.set(Q.value,Q)}X.size>1&&X.has("")&&X.delete("");const J=[...X.values()];return n.set(F,J),J}intersects(T,I){if(!(T instanceof e))throw new TypeError("a Range is required");return this.set.some(F=>m(F,I)&&T.set.some(R=>m(R,I)&&F.every(L=>R.every(P=>L.intersects(P,I)))))}test(T){if(!T)return!1;if(typeof T=="string")try{T=new o(T,this.options)}catch{return!1}for(let I=0;I<this.set.length;I++)if(D(this.set[I],T,this.options))return!0;return!1}}v3=e;const t=mqe,n=new t({max:1e3}),r=w6,i=BI(),s=LI,o=ns,{safeRe:a,t:u,comparatorTrimReplace:l,tildeTrimReplace:c,caretTrimReplace:f}=t$,{FLAG_INCLUDE_PRERELEASE:h,FLAG_LOOSE:d}=MI,p=A=>A.value==="<0.0.0-0",g=A=>A.value==="",m=(A,T)=>{let I=!0;const F=A.slice();let R=F.pop();for(;I&&F.length;)I=F.every(L=>R.intersects(L,T)),R=F.pop();return I},y=(A,T)=>(s("comp",A,T),A=w(A,T),s("caret",A),A=v(A,T),s("tildes",A),A=$(A,T),s("xrange",A),A=k(A,T),s("stars",A),A),b=A=>!A||A.toLowerCase()==="x"||A==="*",v=(A,T)=>A.trim().split(/\s+/).map(I=>x(I,T)).join(" "),x=(A,T)=>{const I=T.loose?a[u.TILDELOOSE]:a[u.TILDE];return A.replace(I,(F,R,L,P,q)=>{s("tilde",A,F,R,L,P,q);let X;return b(R)?X="":b(L)?X=`>=${R}.0.0 <${+R+1}.0.0-0`:b(P)?X=`>=${R}.${L}.0 <${R}.${+L+1}.0-0`:q?(s("replaceTilde pr",q),X=`>=${R}.${L}.${P}-${q} <${R}.${+L+1}.0-0`):X=`>=${R}.${L}.${P} <${R}.${+L+1}.0-0`,s("tilde return",X),X})},w=(A,T)=>A.trim().split(/\s+/).map(I=>C(I,T)).join(" "),C=(A,T)=>{s("caret",A,T);const I=T.loose?a[u.CARETLOOSE]:a[u.CARET],F=T.includePrerelease?"-0":"";return A.replace(I,(R,L,P,q,X)=>{s("caret",A,R,L,P,q,X);let G;return b(L)?G="":b(P)?G=`>=${L}.0.0${F} <${+L+1}.0.0-0`:b(q)?L==="0"?G=`>=${L}.${P}.0${F} <${L}.${+P+1}.0-0`:G=`>=${L}.${P}.0${F} <${+L+1}.0.0-0`:X?(s("replaceCaret pr",X),L==="0"?P==="0"?G=`>=${L}.${P}.${q}-${X} <${L}.${P}.${+q+1}-0`:G=`>=${L}.${P}.${q}-${X} <${L}.${+P+1}.0-0`:G=`>=${L}.${P}.${q}-${X} <${+L+1}.0.0-0`):(s("no pr"),L==="0"?P==="0"?G=`>=${L}.${P}.${q}${F} <${L}.${P}.${+q+1}-0`:G=`>=${L}.${P}.${q}${F} <${L}.${+P+1}.0-0`:G=`>=${L}.${P}.${q} <${+L+1}.0.0-0`),s("caret return",G),G})},$=(A,T)=>(s("replaceXRanges",A,T),A.split(/\s+/).map(I=>S(I,T)).join(" ")),S=(A,T)=>{A=A.trim();const I=T.loose?a[u.XRANGELOOSE]:a[u.XRANGE];return A.replace(I,(F,R,L,P,q,X)=>{s("xRange",A,F,R,L,P,q,X);const G=b(L),J=G||b(P),Q=J||b(q),ee=Q;return R==="="&&ee&&(R=""),X=T.includePrerelease?"-0":"",G?R===">"||R==="<"?F="<0.0.0-0":F="*":R&&ee?(J&&(P=0),q=0,R===">"?(R=">=",J?(L=+L+1,P=0,q=0):(P=+P+1,q=0)):R==="<="&&(R="<",J?L=+L+1:P=+P+1),R==="<"&&(X="-0"),F=`${R+L}.${P}.${q}${X}`):J?F=`>=${L}.0.0${X} <${+L+1}.0.0-0`:Q&&(F=`>=${L}.${P}.0${X} <${L}.${+P+1}.0-0`),s("xRange return",F),F})},k=(A,T)=>(s("replaceStars",A,T),A.trim().replace(a[u.STAR],"")),E=(A,T)=>(s("replaceGTE0",A,T),A.trim().replace(a[T.includePrerelease?u.GTE0PRE:u.GTE0],"")),_=A=>(T,I,F,R,L,P,q,X,G,J,Q,ee,ue)=>(b(F)?I="":b(R)?I=`>=${F}.0.0${A?"-0":""}`:b(L)?I=`>=${F}.${R}.0${A?"-0":""}`:P?I=`>=${I}`:I=`>=${I}${A?"-0":""}`,b(G)?X="":b(J)?X=`<${+G+1}.0.0-0`:b(Q)?X=`<${G}.${+J+1}.0-0`:ee?X=`<=${G}.${J}.${Q}-${ee}`:A?X=`<${G}.${J}.${+Q+1}-0`:X=`<=${X}`,`${I} ${X}`.trim()),D=(A,T,I)=>{for(let F=0;F<A.length;F++)if(!A[F].test(T))return!1;if(T.prerelease.length&&!I.includePrerelease){for(let F=0;F<A.length;F++)if(s(A[F].semver),A[F].semver!==i.ANY&&A[F].semver.prerelease.length>0){const R=A[F].semver;if(R.major===T.major&&R.minor===T.minor&&R.patch===T.patch)return!0}return!1}return!0};return v3}var w3,tH;function BI(){if(tH)return w3;tH=1;const e=Symbol("SemVer ANY");class t{static get ANY(){return e}constructor(c,f){if(f=n(f),c instanceof t){if(c.loose===!!f.loose)return c;c=c.value}c=c.trim().split(/\s+/).join(" "),o("comparator",c,f),this.options=f,this.loose=!!f.loose,this.parse(c),this.semver===e?this.value="":this.value=this.operator+this.semver.version,o("comp",this)}parse(c){const f=this.options.loose?r[i.COMPARATORLOOSE]:r[i.COMPARATOR],h=c.match(f);if(!h)throw new TypeError(`Invalid comparator: ${c}`);this.operator=h[1]!==void 0?h[1]:"",this.operator==="="&&(this.operator=""),h[2]?this.semver=new a(h[2],this.options.loose):this.semver=e}toString(){return this.value}test(c){if(o("Comparator.test",c,this.options.loose),this.semver===e||c===e)return!0;if(typeof c=="string")try{c=new a(c,this.options)}catch{return!1}return s(c,this.operator,this.semver,this.options)}intersects(c,f){if(!(c instanceof t))throw new TypeError("a Comparator is required");return this.operator===""?this.value===""?!0:new u(c.value,f).test(this.value):c.operator===""?c.value===""?!0:new u(this.value,f).test(c.semver):(f=n(f),f.includePrerelease&&(this.value==="<0.0.0-0"||c.value==="<0.0.0-0")||!f.includePrerelease&&(this.value.startsWith("<0.0.0")||c.value.startsWith("<0.0.0"))?!1:!!(this.operator.startsWith(">")&&c.operator.startsWith(">")||this.operator.startsWith("<")&&c.operator.startsWith("<")||this.semver.version===c.semver.version&&this.operator.includes("=")&&c.operator.includes("=")||s(this.semver,"<",c.semver,f)&&this.operator.startsWith(">")&&c.operator.startsWith("<")||s(this.semver,">",c.semver,f)&&this.operator.startsWith("<")&&c.operator.startsWith(">")))}}w3=t;const n=w6,{safeRe:r,t:i}=t$,s=_ae,o=LI,a=ns,u=Ua();return w3}const yqe=Ua(),bqe=(e,t,n)=>{try{t=new yqe(t,n)}catch{return!1}return t.test(e)};var zI=bqe;const xqe=Ua(),vqe=(e,t)=>new xqe(e,t).set.map(n=>n.map(r=>r.value).join(" ").trim().split(" "));var wqe=vqe;const $qe=ns,Cqe=Ua(),Sqe=(e,t,n)=>{let r=null,i=null,s=null;try{s=new Cqe(t,n)}catch{return null}return e.forEach(o=>{s.test(o)&&(!r||i.compare(o)===-1)&&(r=o,i=new $qe(r,n))}),r};var kqe=Sqe;const Eqe=ns,_qe=Ua(),Aqe=(e,t,n)=>{let r=null,i=null,s=null;try{s=new _qe(t,n)}catch{return null}return e.forEach(o=>{s.test(o)&&(!r||i.compare(o)===1)&&(r=o,i=new Eqe(r,n))}),r};var Tqe=Aqe;const $3=ns,Iqe=Ua(),nH=PI,Dqe=(e,t)=>{e=new Iqe(e,t);let n=new $3("0.0.0");if(e.test(n)||(n=new $3("0.0.0-0"),e.test(n)))return n;n=null;for(let r=0;r<e.set.length;++r){const i=e.set[r];let s=null;i.forEach(o=>{const a=new $3(o.semver.version);switch(o.operator){case">":a.prerelease.length===0?a.patch++:a.prerelease.push(0),a.raw=a.format();case"":case">=":(!s||nH(a,s))&&(s=a);break;case"<":case"<=":break;default:throw new Error(`Unexpected operation: ${o.operator}`)}}),s&&(!n||nH(n,s))&&(n=s)}return n&&e.test(n)?n:null};var Nqe=Dqe;const Fqe=Ua(),Oqe=(e,t)=>{try{return new Fqe(e,t).range||"*"}catch{return null}};var Rqe=Oqe;const Mqe=ns,Tae=BI(),{ANY:Lqe}=Tae,Pqe=Ua(),Bqe=zI,rH=PI,iH=C6,zqe=k6,Uqe=S6,jqe=(e,t,n,r)=>{e=new Mqe(e,r),t=new Pqe(t,r);let i,s,o,a,u;switch(n){case">":i=rH,s=zqe,o=iH,a=">",u=">=";break;case"<":i=iH,s=Uqe,o=rH,a="<",u="<=";break;default:throw new TypeError('Must provide a hilo val of "<" or ">"')}if(Bqe(e,t,r))return!1;for(let l=0;l<t.set.length;++l){const c=t.set[l];let f=null,h=null;if(c.forEach(d=>{d.semver===Lqe&&(d=new Tae(">=0.0.0")),f=f||d,h=h||d,i(d.semver,f.semver,r)?f=d:o(d.semver,h.semver,r)&&(h=d)}),f.operator===a||f.operator===u||(!h.operator||h.operator===a)&&s(e,h.semver))return!1;if(h.operator===u&&o(e,h.semver))return!1}return!0};var E6=jqe;const Wqe=E6,Vqe=(e,t,n)=>Wqe(e,t,">",n);var Gqe=Vqe;const Hqe=E6,qqe=(e,t,n)=>Hqe(e,t,"<",n);var Xqe=qqe;const sH=Ua(),Yqe=(e,t,n)=>(e=new sH(e,n),t=new sH(t,n),e.intersects(t,n));var Kqe=Yqe;const Zqe=zI,Jqe=za;var Qqe=(e,t,n)=>{const r=[];let i=null,s=null;const o=e.sort((c,f)=>Jqe(c,f,n));for(const c of o)Zqe(c,t,n)?(s=c,i||(i=c)):(s&&r.push([i,s]),s=null,i=null);i&&r.push([i,null]);const a=[];for(const[c,f]of r)c===f?a.push(c):!f&&c===o[0]?a.push("*"):f?c===o[0]?a.push(`<=${f}`):a.push(`${c} - ${f}`):a.push(`>=${c}`);const u=a.join(" || "),l=typeof t.raw=="string"?t.raw:String(t);return u.length<l.length?u:t};const oH=Ua(),_6=BI(),{ANY:C3}=_6,Gy=zI,A6=za,eXe=(e,t,n={})=>{if(e===t)return!0;e=new oH(e,n),t=new oH(t,n);let r=!1;e:for(const i of e.set){for(const s of t.set){const o=nXe(i,s,n);if(r=r||o!==null,o)continue e}if(r)return!1}return!0},tXe=[new _6(">=0.0.0-0")],aH=[new _6(">=0.0.0")],nXe=(e,t,n)=>{if(e===t)return!0;if(e.length===1&&e[0].semver===C3){if(t.length===1&&t[0].semver===C3)return!0;n.includePrerelease?e=tXe:e=aH}if(t.length===1&&t[0].semver===C3){if(n.includePrerelease)return!0;t=aH}const r=new Set;let i,s;for(const d of e)d.operator===">"||d.operator===">="?i=uH(i,d,n):d.operator==="<"||d.operator==="<="?s=lH(s,d,n):r.add(d.semver);if(r.size>1)return null;let o;if(i&&s){if(o=A6(i.semver,s.semver,n),o>0)return null;if(o===0&&(i.operator!==">="||s.operator!=="<="))return null}for(const d of r){if(i&&!Gy(d,String(i),n)||s&&!Gy(d,String(s),n))return null;for(const p of t)if(!Gy(d,String(p),n))return!1;return!0}let a,u,l,c,f=s&&!n.includePrerelease&&s.semver.prerelease.length?s.semver:!1,h=i&&!n.includePrerelease&&i.semver.prerelease.length?i.semver:!1;f&&f.prerelease.length===1&&s.operator==="<"&&f.prerelease[0]===0&&(f=!1);for(const d of t){if(c=c||d.operator===">"||d.operator===">=",l=l||d.operator==="<"||d.operator==="<=",i){if(h&&d.semver.prerelease&&d.semver.prerelease.length&&d.semver.major===h.major&&d.semver.minor===h.minor&&d.semver.patch===h.patch&&(h=!1),d.operator===">"||d.operator===">="){if(a=uH(i,d,n),a===d&&a!==i)return!1}else if(i.operator===">="&&!Gy(i.semver,String(d),n))return!1}if(s){if(f&&d.semver.prerelease&&d.semver.prerelease.length&&d.semver.major===f.major&&d.semver.minor===f.minor&&d.semver.patch===f.patch&&(f=!1),d.operator==="<"||d.operator==="<="){if(u=lH(s,d,n),u===d&&u!==s)return!1}else if(s.operator==="<="&&!Gy(s.semver,String(d),n))return!1}if(!d.operator&&(s||i)&&o!==0)return!1}return!(i&&l&&!s&&o!==0||s&&c&&!i&&o!==0||h||f)},uH=(e,t,n)=>{if(!e)return t;const r=A6(e.semver,t.semver,n);return r>0?e:r<0||t.operator===">"&&e.operator===">="?t:e},lH=(e,t,n)=>{if(!e)return t;const r=A6(e.semver,t.semver,n);return r<0?e:r>0||t.operator==="<"&&e.operator==="<="?t:e};var rXe=eXe;const S3=t$,cH=MI,iXe=ns,fH=Sae,sXe=ey,oXe=sHe,aXe=uHe,uXe=cHe,lXe=hHe,cXe=gHe,fXe=bHe,hXe=wHe,dXe=SHe,pXe=za,gXe=AHe,mXe=DHe,yXe=$6,bXe=RHe,xXe=PHe,vXe=PI,wXe=C6,$Xe=kae,CXe=Eae,SXe=S6,kXe=k6,EXe=_ae,_Xe=aqe,AXe=BI(),TXe=Ua(),IXe=zI,DXe=wqe,NXe=kqe,FXe=Tqe,OXe=Nqe,RXe=Rqe,MXe=E6,LXe=Gqe,PXe=Xqe,BXe=Kqe,zXe=Qqe,UXe=rXe;var Iae={parse:sXe,valid:oXe,clean:aXe,inc:uXe,diff:lXe,major:cXe,minor:fXe,patch:hXe,prerelease:dXe,compare:pXe,rcompare:gXe,compareLoose:mXe,compareBuild:yXe,sort:bXe,rsort:xXe,gt:vXe,lt:wXe,eq:$Xe,neq:CXe,gte:SXe,lte:kXe,cmp:EXe,coerce:_Xe,Comparator:AXe,Range:TXe,satisfies:IXe,toComparators:DXe,maxSatisfying:NXe,minSatisfying:FXe,minVersion:OXe,validRange:RXe,outside:MXe,gtr:LXe,ltr:PXe,intersects:BXe,simplifyRange:zXe,subset:UXe,SemVer:iXe,re:S3.re,src:S3.src,tokens:S3.t,SEMVER_SPEC_VERSION:cH.SEMVER_SPEC_VERSION,RELEASE_TYPES:cH.RELEASE_TYPES,compareIdentifiers:fH.compareIdentifiers,rcompareIdentifiers:fH.rcompareIdentifiers};function Yo(e,t,n){return e.fields=t||[],e.fname=n,e}function Nn(e){return e==null?null:e.fname}function wi(e){return e==null?null:e.fields}function Dae(e){return e.length===1?jXe(e[0]):WXe(e)}const jXe=e=>function(t){return t[e]},WXe=e=>{const t=e.length;return function(n){for(let r=0;r<t;++r)n=n[e[r]];return n}};function le(e){throw Error(e)}function UI(e){const t=[],n=e.length;let r=null,i=0,s="",o,a,u;e=e+"";function l(){t.push(s+e.substring(o,a)),s="",o=a+1}for(o=a=0;a<n;++a)if(u=e[a],u==="\\")s+=e.substring(o,a),s+=e.substring(++a,++a),o=a;else if(u===r)l(),r=null,i=-1;else{if(r)continue;o===i&&u==='"'||o===i&&u==="'"?(o=a+1,r=u):u==="."&&!i?a>o?l():o=a+1:u==="["?(a>o&&l(),i=o=a+1):u==="]"&&(i||le("Access path missing open bracket: "+e),i>0&&l(),i=0,o=a+1)}return i&&le("Access path missing closing bracket: "+e),r&&le("Access path missing closing quote: "+e),a>o&&(a++,l()),t}function Gf(e,t,n){const r=UI(e);return e=r.length===1?r[0]:e,Yo((n&&n.get||Dae)(r),[e],t||e)}const VXe=Gf("id"),Po=Yo(e=>e,[],"identity"),Qc=Yo(()=>0,[],"zero"),ty=Yo(()=>1,[],"one"),ny=Yo(()=>!0,[],"true"),Wc=Yo(()=>!1,[],"false");function WC(e,t,n){const r=[t].concat([].slice.call(n));console[e].apply(console,r)}const Nae=0,Fae=1,Oae=2,Rae=3,Mae=4;function GXe(e,t){let n=e||Nae;return{level(r){return arguments.length?(n=+r,this):n},error(){return n>=Fae&&WC(t||"error","ERROR",arguments),this},warn(){return n>=Oae&&WC(t||"warn","WARN",arguments),this},info(){return n>=Rae&&WC(t||"log","INFO",arguments),this},debug(){return n>=Mae&&WC(t||"log","DEBUG",arguments),this}}}var it=Array.isArray;function dt(e){return e===Object(e)}const hH=e=>e!=="__proto__";function jI(...e){return e.reduce((t,n)=>{for(const r in n)if(r==="signals")t.signals=HXe(t.signals,n.signals);else{const i=r==="legend"?{layout:1}:r==="style"?!0:null;WI(t,r,n[r],i)}return t},{})}function WI(e,t,n,r){if(!hH(t))return;let i,s;if(dt(n)&&!it(n)){s=dt(e[t])?e[t]:e[t]={};for(i in n)r&&(r===!0||r[i])?WI(s,i,n[i]):hH(i)&&(s[i]=n[i])}else e[t]=n}function HXe(e,t){if(e==null)return t;const n={},r=[];function i(s){n[s.name]||(n[s.name]=1,r.push(s))}return t.forEach(i),e.forEach(i),r}function Kt(e){return e[e.length-1]}function Hf(e){return e==null||e===""?null:+e}const Lae=e=>t=>e*Math.exp(t),Pae=e=>t=>Math.log(e*t),Bae=e=>t=>Math.sign(t)*Math.log1p(Math.abs(t/e)),zae=e=>t=>Math.sign(t)*Math.expm1(Math.abs(t))*e,aE=e=>t=>t<0?-Math.pow(-t,e):Math.pow(t,e);function VI(e,t,n,r){const i=n(e[0]),s=n(Kt(e)),o=(s-i)*t;return[r(i-o),r(s-o)]}function qXe(e,t){return VI(e,t,Hf,Po)}function XXe(e,t){var n=Math.sign(e[0]);return VI(e,t,Pae(n),Lae(n))}function YXe(e,t,n){return VI(e,t,aE(n),aE(1/n))}function KXe(e,t,n){return VI(e,t,Bae(n),zae(n))}function GI(e,t,n,r,i){const s=r(e[0]),o=r(Kt(e)),a=t!=null?r(t):(s+o)/2;return[i(a+(s-a)*n),i(a+(o-a)*n)]}function Uae(e,t,n){return GI(e,t,n,Hf,Po)}function jae(e,t,n){const r=Math.sign(e[0]);return GI(e,t,n,Pae(r),Lae(r))}function _M(e,t,n,r){return GI(e,t,n,aE(r),aE(1/r))}function Wae(e,t,n,r){return GI(e,t,n,Bae(r),zae(r))}function ZXe(e){return 1+~~(new Date(e).getMonth()/3)}function JXe(e){return 1+~~(new Date(e).getUTCMonth()/3)}function et(e){return e!=null?it(e)?e:[e]:[]}function QXe(e,t,n){let r=e[0],i=e[1],s;return i<r&&(s=i,i=r,r=s),s=i-r,s>=n-t?[t,n]:[r=Math.min(Math.max(r,t),n-s),r+s]}function zt(e){return typeof e=="function"}const eYe="descending";function Vae(e,t,n){n=n||{},t=et(t)||[];const r=[],i=[],s={},o=n.comparator||tYe;return et(e).forEach((a,u)=>{a!=null&&(r.push(t[u]===eYe?-1:1),i.push(a=zt(a)?a:Gf(a,null,n)),(wi(a)||[]).forEach(l=>s[l]=1))}),i.length===0?null:Yo(o(i,r),Object.keys(s))}const HI=(e,t)=>(e<t||e==null)&&t!=null?-1:(e>t||t==null)&&e!=null?1:(t=t instanceof Date?+t:t,(e=e instanceof Date?+e:e)!==e&&t===t?-1:t!==t&&e===e?1:0),tYe=(e,t)=>e.length===1?nYe(e[0],t[0]):rYe(e,t,e.length),nYe=(e,t)=>function(n,r){return HI(e(n),e(r))*t},rYe=(e,t,n)=>(t.push(0),function(r,i){let s,o=0,a=-1;for(;o===0&&++a<n;)s=e[a],o=HI(s(r),s(i));return o*t[a]});function Bo(e){return zt(e)?e:()=>e}function Gae(e,t){let n;return r=>{n&&clearTimeout(n),n=setTimeout(()=>(t(r),n=null),e)}}function yt(e){for(let t,n,r=1,i=arguments.length;r<i;++r){t=arguments[r];for(n in t)e[n]=t[n]}return e}function qf(e,t){let n=0,r,i,s,o;if(e&&(r=e.length))if(t==null){for(i=e[n];n<r&&(i==null||i!==i);i=e[++n]);for(s=o=i;n<r;++n)i=e[n],i!=null&&(i<s&&(s=i),i>o&&(o=i))}else{for(i=t(e[n]);n<r&&(i==null||i!==i);i=t(e[++n]));for(s=o=i;n<r;++n)i=t(e[n]),i!=null&&(i<s&&(s=i),i>o&&(o=i))}return[s,o]}function Hae(e,t){const n=e.length;let r=-1,i,s,o,a,u;if(t==null){for(;++r<n;)if(s=e[r],s!=null&&s>=s){i=o=s;break}if(r===n)return[-1,-1];for(a=u=r;++r<n;)s=e[r],s!=null&&(i>s&&(i=s,a=r),o<s&&(o=s,u=r))}else{for(;++r<n;)if(s=t(e[r],r,e),s!=null&&s>=s){i=o=s;break}if(r===n)return[-1,-1];for(a=u=r;++r<n;)s=t(e[r],r,e),s!=null&&(i>s&&(i=s,a=r),o<s&&(o=s,u=r))}return[a,u]}const iYe=Object.prototype.hasOwnProperty;function nt(e,t){return iYe.call(e,t)}const VC={};function ry(e){let t={},n;function r(s){return nt(t,s)&&t[s]!==VC}const i={size:0,empty:0,object:t,has:r,get(s){return r(s)?t[s]:void 0},set(s,o){return r(s)||(++i.size,t[s]===VC&&--i.empty),t[s]=o,this},delete(s){return r(s)&&(--i.size,++i.empty,t[s]=VC),this},clear(){i.size=i.empty=0,i.object=t={}},test(s){return arguments.length?(n=s,i):n},clean(){const s={};let o=0;for(const a in t){const u=t[a];u!==VC&&(!n||!n(u))&&(s[a]=u,++o)}i.size=o,i.empty=0,i.object=t=s}};return e&&Object.keys(e).forEach(s=>{i.set(s,e[s])}),i}function sYe(e,t,n,r,i,s){if(!n&&n!==0)return s;const o=+n;let a=e[0],u=Kt(e),l;u<a&&(l=a,a=u,u=l),l=Math.abs(t-a);const c=Math.abs(u-t);return l<c&&l<=o?r:c<=o?i:s}function $e(e,t,n){const r=e.prototype=Object.create(t.prototype);return Object.defineProperty(r,"constructor",{value:e,writable:!0,enumerable:!0,configurable:!0}),yt(r,n)}function oYe(e,t,n,r){let i=t[0],s=t[t.length-1],o;return i>s&&(o=i,i=s,s=o),n=n===void 0||n,r=r===void 0||r,(n?i<=e:i<e)&&(r?e<=s:e<s)}function qae(e){return typeof e=="boolean"}function qI(e){return Object.prototype.toString.call(e)==="[object Date]"}function Xae(e){return e&&zt(e[Symbol.iterator])}function kp(e){return typeof e=="number"}function aYe(e){return Object.prototype.toString.call(e)==="[object RegExp]"}function mn(e){return typeof e=="string"}function Yae(e,t,n){e&&(e=t?et(e).map(a=>a.replace(/\\(.)/g,"$1")):et(e));const r=e&&e.length,i=n&&n.get||Dae,s=a=>i(t?[a]:UI(a));let o;if(!r)o=function(){return""};else if(r===1){const a=s(e[0]);o=function(u){return""+a(u)}}else{const a=e.map(s);o=function(u){let l=""+a[0](u),c=0;for(;++c<r;)l+="|"+a[c](u);return l}}return Yo(o,e,"key")}function uYe(e,t){const n=e[0],r=Kt(e),i=+t;return i?i===1?r:n+i*(r-n):n}const lYe=1e4;function Kae(e){e=+e||lYe;let t,n,r;const i=()=>{t={},n={},r=0},s=(o,a)=>(++r>e&&(n=t,t={},r=1),t[o]=a);return i(),{clear:i,has:o=>nt(t,o)||nt(n,o),get:o=>nt(t,o)?t[o]:nt(n,o)?s(o,n[o]):void 0,set:(o,a)=>nt(t,o)?t[o]=a:s(o,a)}}function Zae(e,t,n,r){const i=t.length,s=n.length;if(!s)return t;if(!i)return n;const o=r||new t.constructor(i+s);let a=0,u=0,l=0;for(;a<i&&u<s;++l)o[l]=e(t[a],n[u])>0?n[u++]:t[a++];for(;a<i;++a,++l)o[l]=t[a];for(;u<s;++u,++l)o[l]=n[u];return o}function Fb(e,t){let n="";for(;--t>=0;)n+=e;return n}function cYe(e,t,n,r){const i=n||" ",s=e+"",o=t-s.length;return o<=0?s:r==="left"?Fb(i,o)+s:r==="center"?Fb(i,~~(o/2))+s+Fb(i,Math.ceil(o/2)):s+Fb(i,o)}function XI(e){return e&&Kt(e)-e[0]||0}function He(e){return it(e)?"["+e.map(He)+"]":dt(e)||mn(e)?JSON.stringify(e).replace("\u2028","\\u2028").replace("\u2029","\\u2029"):e}function Jae(e){return e==null||e===""?null:!e||e==="false"||e==="0"?!1:!!e}const fYe=e=>kp(e)||qI(e)?e:Date.parse(e);function Qae(e,t){return t=t||fYe,e==null||e===""?null:t(e)}function eue(e){return e==null||e===""?null:e+""}function cc(e){const t={},n=e.length;for(let r=0;r<n;++r)t[e[r]]=!0;return t}function hYe(e,t,n,r){const i=r??"",s=e+"",o=s.length,a=Math.max(0,t-i.length);return o<=t?s:n==="left"?i+s.slice(o-a):n==="center"?s.slice(0,Math.ceil(a/2))+i+s.slice(o-~~(a/2)):s.slice(0,a)+i}function dYe(e,t,n){if(e)if(t){const r=e.length;for(let i=0;i<r;++i){const s=t(e[i]);s&&n(s,i,e)}}else e.forEach(n)}function iy(e,t,n){return e.fields=t||[],e.fname=n,e}function pYe(e){return e.length===1?gYe(e[0]):mYe(e)}const gYe=e=>function(t){return t[e]},mYe=e=>{const t=e.length;return function(n){for(let r=0;r<t;++r)n=n[e[r]];return n}};function $i(e){throw Error(e)}function yYe(e){const t=[],n=e.length;let r=null,i=0,s="",o,a,u;e=e+"";function l(){t.push(s+e.substring(o,a)),s="",o=a+1}for(o=a=0;a<n;++a)if(u=e[a],u==="\\")s+=e.substring(o,a++),o=a;else if(u===r)l(),r=null,i=-1;else{if(r)continue;o===i&&u==='"'||o===i&&u==="'"?(o=a+1,r=u):u==="."&&!i?a>o?l():o=a+1:u==="["?(a>o&&l(),i=o=a+1):u==="]"&&(i||$i("Access path missing open bracket: "+e),i>0&&l(),i=0,o=a+1)}return i&&$i("Access path missing closing bracket: "+e),r&&$i("Access path missing closing quote: "+e),a>o&&(a++,l()),t}function tue(e,t,n){const r=yYe(e);return e=r.length===1?r[0]:e,iy((n&&n.get||pYe)(r),[e],t||e)}const YI=tue("id"),KI=iy(e=>e,[],"identity");iy(()=>0,[],"zero");iy(()=>1,[],"one");const AM=iy(()=>!0,[],"true");iy(()=>!1,[],"false");function bYe(e,t,n){const r=[t].concat([].slice.call(n));console[e].apply(console,r)}const xYe=0,nue=1,vYe=2,wYe=3,$Ye=4;function CYe(e,t){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:bYe,r=e||xYe;return{level(i){return arguments.length?(r=+i,this):r},error(){return r>=nue&&n(t||"error","ERROR",arguments),this},warn(){return r>=vYe&&n(t||"warn","WARN",arguments),this},info(){return r>=wYe&&n(t||"log","INFO",arguments),this},debug(){return r>=$Ye&&n(t||"log","DEBUG",arguments),this}}}var Bu=Array.isArray;function T6(e){return e===Object(e)}function dH(e){return e==null||e===""?null:+e}function uE(e){return e!=null?Bu(e)?e:[e]:[]}function ka(e){return typeof e=="function"}function I6(e){return ka(e)?e:()=>e}function SYe(e,t){let n;return r=>{n&&clearTimeout(n),n=setTimeout(()=>(t(r),n=null),e)}}function sy(e){for(let t,n,r=1,i=arguments.length;r<i;++r){t=arguments[r];for(n in t)e[n]=t[n]}return e}const kYe=Object.prototype.hasOwnProperty;function D6(e,t){return kYe.call(e,t)}function rue(e,t,n){const r=e.prototype=Object.create(t.prototype);return Object.defineProperty(r,"constructor",{value:e,writable:!0,enumerable:!0,configurable:!0}),sy(r,n)}function EYe(e){return Object.prototype.toString.call(e)==="[object Date]"}function _Ye(e){return e&&ka(e[Symbol.iterator])}function AYe(e){return typeof e=="number"}function TM(e){return typeof e=="string"}function N6(e){return Bu(e)?"["+e.map(N6)+"]":T6(e)||TM(e)?JSON.stringify(e).replace("\u2028","\\u2028").replace("\u2029","\\u2029"):e}function TYe(e){return e==null||e===""?null:!e||e==="false"||e==="0"?!1:!!e}const IYe=e=>AYe(e)||EYe(e)?e:Date.parse(e);function DYe(e,t){return t=t||IYe,e==null||e===""?null:t(e)}function NYe(e){return e==null||e===""?null:e+""}function bd(e,t,n){if(e)if(t){const r=e.length;for(let i=0;i<r;++i){const s=t(e[i]);s&&n(s,i,e)}}else e.forEach(n)}var pH={},k3={},E3=34,Hy=10,_3=13;function iue(e){return new Function("d","return {"+e.map(function(t,n){return JSON.stringify(t)+": d["+n+'] || ""'}).join(",")+"}")}function FYe(e,t){var n=iue(e);return function(r,i){return t(n(r),i,e)}}function gH(e){var t=Object.create(null),n=[];return e.forEach(function(r){for(var i in r)i in t||n.push(t[i]=i)}),n}function cs(e,t){var n=e+"",r=n.length;return r<t?new Array(t-r+1).join(0)+n:n}function OYe(e){return e<0?"-"+cs(-e,6):e>9999?"+"+cs(e,6):cs(e,4)}function RYe(e){var t=e.getUTCHours(),n=e.getUTCMinutes(),r=e.getUTCSeconds(),i=e.getUTCMilliseconds();return isNaN(e)?"Invalid Date":OYe(e.getUTCFullYear())+"-"+cs(e.getUTCMonth()+1,2)+"-"+cs(e.getUTCDate(),2)+(i?"T"+cs(t,2)+":"+cs(n,2)+":"+cs(r,2)+"."+cs(i,3)+"Z":r?"T"+cs(t,2)+":"+cs(n,2)+":"+cs(r,2)+"Z":n||t?"T"+cs(t,2)+":"+cs(n,2)+"Z":"")}function MYe(e){var t=new RegExp('["'+e+`
\r]`),n=e.charCodeAt(0);function r(f,h){var d,p,g=i(f,function(m,y){if(d)return d(m,y-1);p=m,d=h?FYe(m,h):iue(m)});return g.columns=p||[],g}function i(f,h){var d=[],p=f.length,g=0,m=0,y,b=p<=0,v=!1;f.charCodeAt(p-1)===Hy&&--p,f.charCodeAt(p-1)===_3&&--p;function x(){if(b)return k3;if(v)return v=!1,pH;var C,$=g,S;if(f.charCodeAt($)===E3){for(;g++<p&&f.charCodeAt(g)!==E3||f.charCodeAt(++g)===E3;);return(C=g)>=p?b=!0:(S=f.charCodeAt(g++))===Hy?v=!0:S===_3&&(v=!0,f.charCodeAt(g)===Hy&&++g),f.slice($+1,C-1).replace(/""/g,'"')}for(;g<p;){if((S=f.charCodeAt(C=g++))===Hy)v=!0;else if(S===_3)v=!0,f.charCodeAt(g)===Hy&&++g;else if(S!==n)continue;return f.slice($,C)}return b=!0,f.slice($,p)}for(;(y=x())!==k3;){for(var w=[];y!==pH&&y!==k3;)w.push(y),y=x();h&&(w=h(w,m++))==null||d.push(w)}return d}function s(f,h){return f.map(function(d){return h.map(function(p){return c(d[p])}).join(e)})}function o(f,h){return h==null&&(h=gH(f)),[h.map(c).join(e)].concat(s(f,h)).join(`
`)}function a(f,h){return h==null&&(h=gH(f)),s(f,h).join(`
`)}function u(f){return f.map(l).join(`
`)}function l(f){return f.map(c).join(e)}function c(f){return f==null?"":f instanceof Date?RYe(f):t.test(f+="")?'"'+f.replace(/"/g,'""')+'"':f}return{parse:r,parseRows:i,format:o,formatBody:a,formatRows:u,formatRow:l,formatValue:c}}function LYe(e){return e}function PYe(e){if(e==null)return LYe;var t,n,r=e.scale[0],i=e.scale[1],s=e.translate[0],o=e.translate[1];return function(a,u){u||(t=n=0);var l=2,c=a.length,f=new Array(c);for(f[0]=(t+=a[0])*r+s,f[1]=(n+=a[1])*i+o;l<c;)f[l]=a[l],++l;return f}}function BYe(e,t){for(var n,r=e.length,i=r-t;i<--r;)n=e[i],e[i++]=e[r],e[r]=n}function sue(e,t){return typeof t=="string"&&(t=e.objects[t]),t.type==="GeometryCollection"?{type:"FeatureCollection",features:t.geometries.map(function(n){return mH(e,n)})}:mH(e,t)}function mH(e,t){var n=t.id,r=t.bbox,i=t.properties==null?{}:t.properties,s=oue(e,t);return n==null&&r==null?{type:"Feature",properties:i,geometry:s}:r==null?{type:"Feature",id:n,properties:i,geometry:s}:{type:"Feature",id:n,bbox:r,properties:i,geometry:s}}function oue(e,t){var n=PYe(e.transform),r=e.arcs;function i(c,f){f.length&&f.pop();for(var h=r[c<0?~c:c],d=0,p=h.length;d<p;++d)f.push(n(h[d],d));c<0&&BYe(f,p)}function s(c){return n(c)}function o(c){for(var f=[],h=0,d=c.length;h<d;++h)i(c[h],f);return f.length<2&&f.push(f[0]),f}function a(c){for(var f=o(c);f.length<4;)f.push(f[0]);return f}function u(c){return c.map(a)}function l(c){var f=c.type,h;switch(f){case"GeometryCollection":return{type:f,geometries:c.geometries.map(l)};case"Point":h=s(c.coordinates);break;case"MultiPoint":h=c.coordinates.map(s);break;case"LineString":h=o(c.arcs);break;case"MultiLineString":h=c.arcs.map(o);break;case"Polygon":h=u(c.arcs);break;case"MultiPolygon":h=c.arcs.map(u);break;default:return null}return{type:f,coordinates:h}}return l(t)}function zYe(e,t){var n={},r={},i={},s=[],o=-1;t.forEach(function(l,c){var f=e.arcs[l<0?~l:l],h;f.length<3&&!f[1][0]&&!f[1][1]&&(h=t[++o],t[o]=l,t[c]=h)}),t.forEach(function(l){var c=a(l),f=c[0],h=c[1],d,p;if(d=i[f])if(delete i[d.end],d.push(l),d.end=h,p=r[h]){delete r[p.start];var g=p===d?d:d.concat(p);r[g.start=d.start]=i[g.end=p.end]=g}else r[d.start]=i[d.end]=d;else if(d=r[h])if(delete r[d.start],d.unshift(l),d.start=f,p=i[f]){delete i[p.end];var m=p===d?d:p.concat(d);r[m.start=p.start]=i[m.end=d.end]=m}else r[d.start]=i[d.end]=d;else d=[l],r[d.start=f]=i[d.end=h]=d});function a(l){var c=e.arcs[l<0?~l:l],f=c[0],h;return e.transform?(h=[0,0],c.forEach(function(d){h[0]+=d[0],h[1]+=d[1]})):h=c[c.length-1],l<0?[h,f]:[f,h]}function u(l,c){for(var f in l){var h=l[f];delete c[h.start],delete h.start,delete h.end,h.forEach(function(d){n[d<0?~d:d]=1}),s.push(h)}}return u(i,r),u(r,i),t.forEach(function(l){n[l<0?~l:l]||s.push([l])}),s}function aue(e){return oue(e,UYe.apply(this,arguments))}function UYe(e,t,n){var r,i,s;if(arguments.length>1)r=jYe(e,t,n);else for(i=0,r=new Array(s=e.arcs.length);i<s;++i)r[i]=i;return{type:"MultiLineString",arcs:zYe(e,r)}}function jYe(e,t,n){var r=[],i=[],s;function o(f){var h=f<0?~f:f;(i[h]||(i[h]=[])).push({i:f,g:s})}function a(f){f.forEach(o)}function u(f){f.forEach(a)}function l(f){f.forEach(u)}function c(f){switch(s=f,f.type){case"GeometryCollection":f.geometries.forEach(c);break;case"LineString":a(f.arcs);break;case"MultiLineString":case"Polygon":u(f.arcs);break;case"MultiPolygon":l(f.arcs);break}}return c(t),i.forEach(n==null?function(f){r.push(f[0].i)}:function(f){n(f[0].g,f[f.length-1].g)&&r.push(f[0].i)}),r}class lE extends Map{constructor(t,n=cue){if(super(),Object.defineProperties(this,{_intern:{value:new Map},_key:{value:n}}),t!=null)for(const[r,i]of t)this.set(r,i)}get(t){return super.get(IM(this,t))}has(t){return super.has(IM(this,t))}set(t,n){return super.set(uue(this,t),n)}delete(t){return super.delete(lue(this,t))}}class cE extends Set{constructor(t,n=cue){if(super(),Object.defineProperties(this,{_intern:{value:new Map},_key:{value:n}}),t!=null)for(const r of t)this.add(r)}has(t){return super.has(IM(this,t))}add(t){return super.add(uue(this,t))}delete(t){return super.delete(lue(this,t))}}function IM({_intern:e,_key:t},n){const r=t(n);return e.has(r)?e.get(r):n}function uue({_intern:e,_key:t},n){const r=t(n);return e.has(r)?e.get(r):(e.set(r,n),n)}function lue({_intern:e,_key:t},n){const r=t(n);return e.has(r)&&(n=e.get(n),e.delete(r)),n}function cue(e){return e!==null&&typeof e=="object"?e.valueOf():e}const WYe=Math.sqrt(50),VYe=Math.sqrt(10),GYe=Math.sqrt(2);function fue(e,t,n){const r=(t-e)/Math.max(0,n),i=Math.floor(Math.log10(r)),s=r/Math.pow(10,i),o=s>=WYe?10:s>=VYe?5:s>=GYe?2:1;let a,u,l;return i<0?(l=Math.pow(10,-i)/o,a=Math.round(e*l),u=Math.round(t*l),a/l<e&&++a,u/l>t&&--u,l=-l):(l=Math.pow(10,i)*o,a=Math.round(e/l),u=Math.round(t/l),a*l<e&&++a,u*l>t&&--u),u<a&&.5<=n&&n<2?fue(e,t,n*2):[a,u,l]}function yH(e,t,n){return t=+t,e=+e,n=+n,fue(e,t,n)[2]}function HYe(e,t,n){t=+t,e=+e,n=+n;const r=t<e,i=r?yH(t,e,n):yH(e,t,n);return(r?-1:1)*(i<0?1/-i:i)}function qYe(e){return Math.abs(e=Math.round(e))>=1e21?e.toLocaleString("en").replace(/,/g,""):e.toString(10)}function fE(e,t){if((n=(e=t?e.toExponential(t-1):e.toExponential()).indexOf("e"))<0)return null;var n,r=e.slice(0,n);return[r.length>1?r[0]+r.slice(2):r,+e.slice(n+1)]}function n0(e){return e=fE(Math.abs(e)),e?e[1]:NaN}function XYe(e,t){return function(n,r){for(var i=n.length,s=[],o=0,a=e[0],u=0;i>0&&a>0&&(u+a+1>r&&(a=Math.max(1,r-u)),s.push(n.substring(i-=a,i+a)),!((u+=a+1)>r));)a=e[o=(o+1)%e.length];return s.reverse().join(t)}}function YYe(e){return function(t){return t.replace(/[0-9]/g,function(n){return e[+n]})}}var KYe=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function sv(e){if(!(t=KYe.exec(e)))throw new Error("invalid format: "+e);var t;return new F6({fill:t[1],align:t[2],sign:t[3],symbol:t[4],zero:t[5],width:t[6],comma:t[7],precision:t[8]&&t[8].slice(1),trim:t[9],type:t[10]})}sv.prototype=F6.prototype;function F6(e){this.fill=e.fill===void 0?" ":e.fill+"",this.align=e.align===void 0?">":e.align+"",this.sign=e.sign===void 0?"-":e.sign+"",this.symbol=e.symbol===void 0?"":e.symbol+"",this.zero=!!e.zero,this.width=e.width===void 0?void 0:+e.width,this.comma=!!e.comma,this.precision=e.precision===void 0?void 0:+e.precision,this.trim=!!e.trim,this.type=e.type===void 0?"":e.type+""}F6.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function ZYe(e){e:for(var t=e.length,n=1,r=-1,i;n<t;++n)switch(e[n]){case".":r=i=n;break;case"0":r===0&&(r=n),i=n;break;default:if(!+e[n])break e;r>0&&(r=0);break}return r>0?e.slice(0,r)+e.slice(i+1):e}var hue;function JYe(e,t){var n=fE(e,t);if(!n)return e+"";var r=n[0],i=n[1],s=i-(hue=Math.max(-8,Math.min(8,Math.floor(i/3)))*3)+1,o=r.length;return s===o?r:s>o?r+new Array(s-o+1).join("0"):s>0?r.slice(0,s)+"."+r.slice(s):"0."+new Array(1-s).join("0")+fE(e,Math.max(0,t+s-1))[0]}function bH(e,t){var n=fE(e,t);if(!n)return e+"";var r=n[0],i=n[1];return i<0?"0."+new Array(-i).join("0")+r:r.length>i+1?r.slice(0,i+1)+"."+r.slice(i+1):r+new Array(i-r.length+2).join("0")}const xH={"%":(e,t)=>(e*100).toFixed(t),b:e=>Math.round(e).toString(2),c:e=>e+"",d:qYe,e:(e,t)=>e.toExponential(t),f:(e,t)=>e.toFixed(t),g:(e,t)=>e.toPrecision(t),o:e=>Math.round(e).toString(8),p:(e,t)=>bH(e*100,t),r:bH,s:JYe,X:e=>Math.round(e).toString(16).toUpperCase(),x:e=>Math.round(e).toString(16)};function vH(e){return e}var wH=Array.prototype.map,$H=["y","z","a","f","p","n","","m","","k","M","G","T","P","E","Z","Y"];function due(e){var t=e.grouping===void 0||e.thousands===void 0?vH:XYe(wH.call(e.grouping,Number),e.thousands+""),n=e.currency===void 0?"":e.currency[0]+"",r=e.currency===void 0?"":e.currency[1]+"",i=e.decimal===void 0?".":e.decimal+"",s=e.numerals===void 0?vH:YYe(wH.call(e.numerals,String)),o=e.percent===void 0?"%":e.percent+"",a=e.minus===void 0?"":e.minus+"",u=e.nan===void 0?"NaN":e.nan+"";function l(f){f=sv(f);var h=f.fill,d=f.align,p=f.sign,g=f.symbol,m=f.zero,y=f.width,b=f.comma,v=f.precision,x=f.trim,w=f.type;w==="n"?(b=!0,w="g"):xH[w]||(v===void 0&&(v=12),x=!0,w="g"),(m||h==="0"&&d==="=")&&(m=!0,h="0",d="=");var C=g==="$"?n:g==="#"&&/[boxX]/.test(w)?"0"+w.toLowerCase():"",$=g==="$"?r:/[%p]/.test(w)?o:"",S=xH[w],k=/[defgprs%]/.test(w);v=v===void 0?6:/[gprs]/.test(w)?Math.max(1,Math.min(21,v)):Math.max(0,Math.min(20,v));function E(_){var D=C,A=$,T,I,F;if(w==="c")A=S(_)+A,_="";else{_=+_;var R=_<0||1/_<0;if(_=isNaN(_)?u:S(Math.abs(_),v),x&&(_=ZYe(_)),R&&+_==0&&p!=="+"&&(R=!1),D=(R?p==="("?p:a:p==="-"||p==="("?"":p)+D,A=(w==="s"?$H[8+hue/3]:"")+A+(R&&p==="("?")":""),k){for(T=-1,I=_.length;++T<I;)if(F=_.charCodeAt(T),48>F||F>57){A=(F===46?i+_.slice(T+1):_.slice(T))+A,_=_.slice(0,T);break}}}b&&!m&&(_=t(_,1/0));var L=D.length+_.length+A.length,P=L<y?new Array(y-L+1).join(h):"";switch(b&&m&&(_=t(P+_,P.length?y-A.length:1/0),P=""),d){case"<":_=D+_+A+P;break;case"=":_=D+P+_+A;break;case"^":_=P.slice(0,L=P.length>>1)+D+_+A+P.slice(L);break;default:_=P+D+_+A;break}return s(_)}return E.toString=function(){return f+""},E}function c(f,h){var d=l((f=sv(f),f.type="f",f)),p=Math.max(-8,Math.min(8,Math.floor(n0(h)/3)))*3,g=Math.pow(10,-p),m=$H[8+p/3];return function(y){return d(g*y)+m}}return{format:l,formatPrefix:c}}var GC,pue,gue;QYe({thousands:",",grouping:[3],currency:["$",""]});function QYe(e){return GC=due(e),pue=GC.format,gue=GC.formatPrefix,GC}function eKe(e){return Math.max(0,-n0(Math.abs(e)))}function tKe(e,t){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(n0(t)/3)))*3-n0(Math.abs(e)))}function nKe(e,t){return e=Math.abs(e),t=Math.abs(t)-e,Math.max(0,n0(t)-n0(e))+1}const A3=new Date,T3=new Date;function gr(e,t,n,r){function i(s){return e(s=arguments.length===0?new Date:new Date(+s)),s}return i.floor=s=>(e(s=new Date(+s)),s),i.ceil=s=>(e(s=new Date(s-1)),t(s,1),e(s),s),i.round=s=>{const o=i(s),a=i.ceil(s);return s-o<a-s?o:a},i.offset=(s,o)=>(t(s=new Date(+s),o==null?1:Math.floor(o)),s),i.range=(s,o,a)=>{const u=[];if(s=i.ceil(s),a=a==null?1:Math.floor(a),!(s<o)||!(a>0))return u;let l;do u.push(l=new Date(+s)),t(s,a),e(s);while(l<s&&s<o);return u},i.filter=s=>gr(o=>{if(o>=o)for(;e(o),!s(o);)o.setTime(o-1)},(o,a)=>{if(o>=o)if(a<0)for(;++a<=0;)for(;t(o,-1),!s(o););else for(;--a>=0;)for(;t(o,1),!s(o););}),n&&(i.count=(s,o)=>(A3.setTime(+s),T3.setTime(+o),e(A3),e(T3),Math.floor(n(A3,T3))),i.every=s=>(s=Math.floor(s),!isFinite(s)||!(s>0)?null:s>1?i.filter(r?o=>r(o)%s===0:o=>i.count(0,o)%s===0):i)),i}const ov=gr(()=>{},(e,t)=>{e.setTime(+e+t)},(e,t)=>t-e);ov.every=e=>(e=Math.floor(e),!isFinite(e)||!(e>0)?null:e>1?gr(t=>{t.setTime(Math.floor(t/e)*e)},(t,n)=>{t.setTime(+t+n*e)},(t,n)=>(n-t)/e):ov);ov.range;const av=1e3,Xf=av*60,uv=Xf*60,lv=uv*24,mue=lv*7,O6=gr(e=>{e.setTime(e-e.getMilliseconds())},(e,t)=>{e.setTime(+e+t*av)},(e,t)=>(t-e)/av,e=>e.getUTCSeconds());O6.range;const yue=gr(e=>{e.setTime(e-e.getMilliseconds()-e.getSeconds()*av)},(e,t)=>{e.setTime(+e+t*Xf)},(e,t)=>(t-e)/Xf,e=>e.getMinutes());yue.range;const bue=gr(e=>{e.setUTCSeconds(0,0)},(e,t)=>{e.setTime(+e+t*Xf)},(e,t)=>(t-e)/Xf,e=>e.getUTCMinutes());bue.range;const xue=gr(e=>{e.setTime(e-e.getMilliseconds()-e.getSeconds()*av-e.getMinutes()*Xf)},(e,t)=>{e.setTime(+e+t*uv)},(e,t)=>(t-e)/uv,e=>e.getHours());xue.range;const vue=gr(e=>{e.setUTCMinutes(0,0,0)},(e,t)=>{e.setTime(+e+t*uv)},(e,t)=>(t-e)/uv,e=>e.getUTCHours());vue.range;const Dm=gr(e=>e.setHours(0,0,0,0),(e,t)=>e.setDate(e.getDate()+t),(e,t)=>(t-e-(t.getTimezoneOffset()-e.getTimezoneOffset())*Xf)/lv,e=>e.getDate()-1);Dm.range;const Nm=gr(e=>{e.setUTCHours(0,0,0,0)},(e,t)=>{e.setUTCDate(e.getUTCDate()+t)},(e,t)=>(t-e)/lv,e=>e.getUTCDate()-1);Nm.range;const rKe=gr(e=>{e.setUTCHours(0,0,0,0)},(e,t)=>{e.setUTCDate(e.getUTCDate()+t)},(e,t)=>(t-e)/lv,e=>Math.floor(e/lv));rKe.range;function mg(e){return gr(t=>{t.setDate(t.getDate()-(t.getDay()+7-e)%7),t.setHours(0,0,0,0)},(t,n)=>{t.setDate(t.getDate()+n*7)},(t,n)=>(n-t-(n.getTimezoneOffset()-t.getTimezoneOffset())*Xf)/mue)}const R6=mg(0),hE=mg(1),iKe=mg(2),sKe=mg(3),r0=mg(4),oKe=mg(5),aKe=mg(6);R6.range;hE.range;iKe.range;sKe.range;r0.range;oKe.range;aKe.range;function yg(e){return gr(t=>{t.setUTCDate(t.getUTCDate()-(t.getUTCDay()+7-e)%7),t.setUTCHours(0,0,0,0)},(t,n)=>{t.setUTCDate(t.getUTCDate()+n*7)},(t,n)=>(n-t)/mue)}const M6=yg(0),dE=yg(1),uKe=yg(2),lKe=yg(3),i0=yg(4),cKe=yg(5),fKe=yg(6);M6.range;dE.range;uKe.range;lKe.range;i0.range;cKe.range;fKe.range;const DM=gr(e=>{e.setDate(1),e.setHours(0,0,0,0)},(e,t)=>{e.setMonth(e.getMonth()+t)},(e,t)=>t.getMonth()-e.getMonth()+(t.getFullYear()-e.getFullYear())*12,e=>e.getMonth());DM.range;const NM=gr(e=>{e.setUTCDate(1),e.setUTCHours(0,0,0,0)},(e,t)=>{e.setUTCMonth(e.getUTCMonth()+t)},(e,t)=>t.getUTCMonth()-e.getUTCMonth()+(t.getUTCFullYear()-e.getUTCFullYear())*12,e=>e.getUTCMonth());NM.range;const Yf=gr(e=>{e.setMonth(0,1),e.setHours(0,0,0,0)},(e,t)=>{e.setFullYear(e.getFullYear()+t)},(e,t)=>t.getFullYear()-e.getFullYear(),e=>e.getFullYear());Yf.every=e=>!isFinite(e=Math.floor(e))||!(e>0)?null:gr(t=>{t.setFullYear(Math.floor(t.getFullYear()/e)*e),t.setMonth(0,1),t.setHours(0,0,0,0)},(t,n)=>{t.setFullYear(t.getFullYear()+n*e)});Yf.range;const Kf=gr(e=>{e.setUTCMonth(0,1),e.setUTCHours(0,0,0,0)},(e,t)=>{e.setUTCFullYear(e.getUTCFullYear()+t)},(e,t)=>t.getUTCFullYear()-e.getUTCFullYear(),e=>e.getUTCFullYear());Kf.every=e=>!isFinite(e=Math.floor(e))||!(e>0)?null:gr(t=>{t.setUTCFullYear(Math.floor(t.getUTCFullYear()/e)*e),t.setUTCMonth(0,1),t.setUTCHours(0,0,0,0)},(t,n)=>{t.setUTCFullYear(t.getUTCFullYear()+n*e)});Kf.range;const cv="year",fv="quarter",hv="month",dv="week",pv="date",ZI="day",L6="dayofyear",gv="hours",mv="minutes",yv="seconds",JI="milliseconds",hKe=[cv,fv,hv,dv,pv,ZI,L6,gv,mv,yv,JI];hKe.reduce((e,t,n)=>(e[t]=1+n,e),{});const dKe={[cv]:Yf,[fv]:DM.every(3),[hv]:DM,[dv]:R6,[pv]:Dm,[ZI]:Dm,[L6]:Dm,[gv]:xue,[mv]:yue,[yv]:O6,[JI]:ov},pKe={[cv]:Kf,[fv]:NM.every(3),[hv]:NM,[dv]:M6,[pv]:Nm,[ZI]:Nm,[L6]:Nm,[gv]:vue,[mv]:bue,[yv]:O6,[JI]:ov};function gKe(e){return dKe[e]}function mKe(e){return pKe[e]}function I3(e){if(0<=e.y&&e.y<100){var t=new Date(-1,e.m,e.d,e.H,e.M,e.S,e.L);return t.setFullYear(e.y),t}return new Date(e.y,e.m,e.d,e.H,e.M,e.S,e.L)}function D3(e){if(0<=e.y&&e.y<100){var t=new Date(Date.UTC(-1,e.m,e.d,e.H,e.M,e.S,e.L));return t.setUTCFullYear(e.y),t}return new Date(Date.UTC(e.y,e.m,e.d,e.H,e.M,e.S,e.L))}function qy(e,t,n){return{y:e,m:t,d:n,H:0,M:0,S:0,L:0}}function wue(e){var t=e.dateTime,n=e.date,r=e.time,i=e.periods,s=e.days,o=e.shortDays,a=e.months,u=e.shortMonths,l=Xy(i),c=Yy(i),f=Xy(s),h=Yy(s),d=Xy(o),p=Yy(o),g=Xy(a),m=Yy(a),y=Xy(u),b=Yy(u),v={a:R,A:L,b:P,B:q,c:null,d:AH,e:AH,f:BKe,g:YKe,G:ZKe,H:MKe,I:LKe,j:PKe,L:$ue,m:zKe,M:UKe,p:X,q:G,Q:DH,s:NH,S:jKe,u:WKe,U:VKe,V:GKe,w:HKe,W:qKe,x:null,X:null,y:XKe,Y:KKe,Z:JKe,"%":IH},x={a:J,A:Q,b:ee,B:ue,c:null,d:TH,e:TH,f:nZe,g:hZe,G:pZe,H:QKe,I:eZe,j:tZe,L:Sue,m:rZe,M:iZe,p:ge,q:xe,Q:DH,s:NH,S:sZe,u:oZe,U:aZe,V:uZe,w:lZe,W:cZe,x:null,X:null,y:fZe,Y:dZe,Z:gZe,"%":IH},w={a:E,A:_,b:D,B:A,c:T,d:EH,e:EH,f:NKe,g:kH,G:SH,H:_H,I:_H,j:AKe,L:DKe,m:_Ke,M:TKe,p:k,q:EKe,Q:OKe,s:RKe,S:IKe,u:wKe,U:$Ke,V:CKe,w:vKe,W:SKe,x:I,X:F,y:kH,Y:SH,Z:kKe,"%":FKe};v.x=C(n,v),v.X=C(r,v),v.c=C(t,v),x.x=C(n,x),x.X=C(r,x),x.c=C(t,x);function C(B,H){return function(Y){var M=[],he=-1,ae=0,me=B.length,de,Oe,Ye;for(Y instanceof Date||(Y=new Date(+Y));++he<me;)B.charCodeAt(he)===37&&(M.push(B.slice(ae,he)),(Oe=CH[de=B.charAt(++he)])!=null?de=B.charAt(++he):Oe=de==="e"?" ":"0",(Ye=H[de])&&(de=Ye(Y,Oe)),M.push(de),ae=he+1);return M.push(B.slice(ae,he)),M.join("")}}function $(B,H){return function(Y){var M=qy(1900,void 0,1),he=S(M,B,Y+="",0),ae,me;if(he!=Y.length)return null;if("Q"in M)return new Date(M.Q);if("s"in M)return new Date(M.s*1e3+("L"in M?M.L:0));if(H&&!("Z"in M)&&(M.Z=0),"p"in M&&(M.H=M.H%12+M.p*12),M.m===void 0&&(M.m="q"in M?M.q:0),"V"in M){if(M.V<1||M.V>53)return null;"w"in M||(M.w=1),"Z"in M?(ae=D3(qy(M.y,0,1)),me=ae.getUTCDay(),ae=me>4||me===0?dE.ceil(ae):dE(ae),ae=Nm.offset(ae,(M.V-1)*7),M.y=ae.getUTCFullYear(),M.m=ae.getUTCMonth(),M.d=ae.getUTCDate()+(M.w+6)%7):(ae=I3(qy(M.y,0,1)),me=ae.getDay(),ae=me>4||me===0?hE.ceil(ae):hE(ae),ae=Dm.offset(ae,(M.V-1)*7),M.y=ae.getFullYear(),M.m=ae.getMonth(),M.d=ae.getDate()+(M.w+6)%7)}else("W"in M||"U"in M)&&("w"in M||(M.w="u"in M?M.u%7:"W"in M?1:0),me="Z"in M?D3(qy(M.y,0,1)).getUTCDay():I3(qy(M.y,0,1)).getDay(),M.m=0,M.d="W"in M?(M.w+6)%7+M.W*7-(me+5)%7:M.w+M.U*7-(me+6)%7);return"Z"in M?(M.H+=M.Z/100|0,M.M+=M.Z%100,D3(M)):I3(M)}}function S(B,H,Y,M){for(var he=0,ae=H.length,me=Y.length,de,Oe;he<ae;){if(M>=me)return-1;if(de=H.charCodeAt(he++),de===37){if(de=H.charAt(he++),Oe=w[de in CH?H.charAt(he++):de],!Oe||(M=Oe(B,Y,M))<0)return-1}else if(de!=Y.charCodeAt(M++))return-1}return M}function k(B,H,Y){var M=l.exec(H.slice(Y));return M?(B.p=c.get(M[0].toLowerCase()),Y+M[0].length):-1}function E(B,H,Y){var M=d.exec(H.slice(Y));return M?(B.w=p.get(M[0].toLowerCase()),Y+M[0].length):-1}function _(B,H,Y){var M=f.exec(H.slice(Y));return M?(B.w=h.get(M[0].toLowerCase()),Y+M[0].length):-1}function D(B,H,Y){var M=y.exec(H.slice(Y));return M?(B.m=b.get(M[0].toLowerCase()),Y+M[0].length):-1}function A(B,H,Y){var M=g.exec(H.slice(Y));return M?(B.m=m.get(M[0].toLowerCase()),Y+M[0].length):-1}function T(B,H,Y){return S(B,t,H,Y)}function I(B,H,Y){return S(B,n,H,Y)}function F(B,H,Y){return S(B,r,H,Y)}function R(B){return o[B.getDay()]}function L(B){return s[B.getDay()]}function P(B){return u[B.getMonth()]}function q(B){return a[B.getMonth()]}function X(B){return i[+(B.getHours()>=12)]}function G(B){return 1+~~(B.getMonth()/3)}function J(B){return o[B.getUTCDay()]}function Q(B){return s[B.getUTCDay()]}function ee(B){return u[B.getUTCMonth()]}function ue(B){return a[B.getUTCMonth()]}function ge(B){return i[+(B.getUTCHours()>=12)]}function xe(B){return 1+~~(B.getUTCMonth()/3)}return{format:function(B){var H=C(B+="",v);return H.toString=function(){return B},H},parse:function(B){var H=$(B+="",!1);return H.toString=function(){return B},H},utcFormat:function(B){var H=C(B+="",x);return H.toString=function(){return B},H},utcParse:function(B){var H=$(B+="",!0);return H.toString=function(){return B},H}}}var CH={"-":"",_:" ",0:"0"},Lr=/^\s*\d+/,yKe=/^%/,bKe=/[\\^$*+?|[\]().{}]/g;function It(e,t,n){var r=e<0?"-":"",i=(r?-e:e)+"",s=i.length;return r+(s<n?new Array(n-s+1).join(t)+i:i)}function xKe(e){return e.replace(bKe,"\\$&")}function Xy(e){return new RegExp("^(?:"+e.map(xKe).join("|")+")","i")}function Yy(e){return new Map(e.map((t,n)=>[t.toLowerCase(),n]))}function vKe(e,t,n){var r=Lr.exec(t.slice(n,n+1));return r?(e.w=+r[0],n+r[0].length):-1}function wKe(e,t,n){var r=Lr.exec(t.slice(n,n+1));return r?(e.u=+r[0],n+r[0].length):-1}function $Ke(e,t,n){var r=Lr.exec(t.slice(n,n+2));return r?(e.U=+r[0],n+r[0].length):-1}function CKe(e,t,n){var r=Lr.exec(t.slice(n,n+2));return r?(e.V=+r[0],n+r[0].length):-1}function SKe(e,t,n){var r=Lr.exec(t.slice(n,n+2));return r?(e.W=+r[0],n+r[0].length):-1}function SH(e,t,n){var r=Lr.exec(t.slice(n,n+4));return r?(e.y=+r[0],n+r[0].length):-1}function kH(e,t,n){var r=Lr.exec(t.slice(n,n+2));return r?(e.y=+r[0]+(+r[0]>68?1900:2e3),n+r[0].length):-1}function kKe(e,t,n){var r=/^(Z)|([+-]\d\d)(?::?(\d\d))?/.exec(t.slice(n,n+6));return r?(e.Z=r[1]?0:-(r[2]+(r[3]||"00")),n+r[0].length):-1}function EKe(e,t,n){var r=Lr.exec(t.slice(n,n+1));return r?(e.q=r[0]*3-3,n+r[0].length):-1}function _Ke(e,t,n){var r=Lr.exec(t.slice(n,n+2));return r?(e.m=r[0]-1,n+r[0].length):-1}function EH(e,t,n){var r=Lr.exec(t.slice(n,n+2));return r?(e.d=+r[0],n+r[0].length):-1}function AKe(e,t,n){var r=Lr.exec(t.slice(n,n+3));return r?(e.m=0,e.d=+r[0],n+r[0].length):-1}function _H(e,t,n){var r=Lr.exec(t.slice(n,n+2));return r?(e.H=+r[0],n+r[0].length):-1}function TKe(e,t,n){var r=Lr.exec(t.slice(n,n+2));return r?(e.M=+r[0],n+r[0].length):-1}function IKe(e,t,n){var r=Lr.exec(t.slice(n,n+2));return r?(e.S=+r[0],n+r[0].length):-1}function DKe(e,t,n){var r=Lr.exec(t.slice(n,n+3));return r?(e.L=+r[0],n+r[0].length):-1}function NKe(e,t,n){var r=Lr.exec(t.slice(n,n+6));return r?(e.L=Math.floor(r[0]/1e3),n+r[0].length):-1}function FKe(e,t,n){var r=yKe.exec(t.slice(n,n+1));return r?n+r[0].length:-1}function OKe(e,t,n){var r=Lr.exec(t.slice(n));return r?(e.Q=+r[0],n+r[0].length):-1}function RKe(e,t,n){var r=Lr.exec(t.slice(n));return r?(e.s=+r[0],n+r[0].length):-1}function AH(e,t){return It(e.getDate(),t,2)}function MKe(e,t){return It(e.getHours(),t,2)}function LKe(e,t){return It(e.getHours()%12||12,t,2)}function PKe(e,t){return It(1+Dm.count(Yf(e),e),t,3)}function $ue(e,t){return It(e.getMilliseconds(),t,3)}function BKe(e,t){return $ue(e,t)+"000"}function zKe(e,t){return It(e.getMonth()+1,t,2)}function UKe(e,t){return It(e.getMinutes(),t,2)}function jKe(e,t){return It(e.getSeconds(),t,2)}function WKe(e){var t=e.getDay();return t===0?7:t}function VKe(e,t){return It(R6.count(Yf(e)-1,e),t,2)}function Cue(e){var t=e.getDay();return t>=4||t===0?r0(e):r0.ceil(e)}function GKe(e,t){return e=Cue(e),It(r0.count(Yf(e),e)+(Yf(e).getDay()===4),t,2)}function HKe(e){return e.getDay()}function qKe(e,t){return It(hE.count(Yf(e)-1,e),t,2)}function XKe(e,t){return It(e.getFullYear()%100,t,2)}function YKe(e,t){return e=Cue(e),It(e.getFullYear()%100,t,2)}function KKe(e,t){return It(e.getFullYear()%1e4,t,4)}function ZKe(e,t){var n=e.getDay();return e=n>=4||n===0?r0(e):r0.ceil(e),It(e.getFullYear()%1e4,t,4)}function JKe(e){var t=e.getTimezoneOffset();return(t>0?"-":(t*=-1,"+"))+It(t/60|0,"0",2)+It(t%60,"0",2)}function TH(e,t){return It(e.getUTCDate(),t,2)}function QKe(e,t){return It(e.getUTCHours(),t,2)}function eZe(e,t){return It(e.getUTCHours()%12||12,t,2)}function tZe(e,t){return It(1+Nm.count(Kf(e),e),t,3)}function Sue(e,t){return It(e.getUTCMilliseconds(),t,3)}function nZe(e,t){return Sue(e,t)+"000"}function rZe(e,t){return It(e.getUTCMonth()+1,t,2)}function iZe(e,t){return It(e.getUTCMinutes(),t,2)}function sZe(e,t){return It(e.getUTCSeconds(),t,2)}function oZe(e){var t=e.getUTCDay();return t===0?7:t}function aZe(e,t){return It(M6.count(Kf(e)-1,e),t,2)}function kue(e){var t=e.getUTCDay();return t>=4||t===0?i0(e):i0.ceil(e)}function uZe(e,t){return e=kue(e),It(i0.count(Kf(e),e)+(Kf(e).getUTCDay()===4),t,2)}function lZe(e){return e.getUTCDay()}function cZe(e,t){return It(dE.count(Kf(e)-1,e),t,2)}function fZe(e,t){return It(e.getUTCFullYear()%100,t,2)}function hZe(e,t){return e=kue(e),It(e.getUTCFullYear()%100,t,2)}function dZe(e,t){return It(e.getUTCFullYear()%1e4,t,4)}function pZe(e,t){var n=e.getUTCDay();return e=n>=4||n===0?i0(e):i0.ceil(e),It(e.getUTCFullYear()%1e4,t,4)}function gZe(){return"+0000"}function IH(){return"%"}function DH(e){return+e}function NH(e){return Math.floor(+e/1e3)}var Qg,Eue,_ue,Aue,Tue;mZe({dateTime:"%x, %X",date:"%-m/%-d/%Y",time:"%-I:%M:%S %p",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]});function mZe(e){return Qg=wue(e),Eue=Qg.format,_ue=Qg.parse,Aue=Qg.utcFormat,Tue=Qg.utcParse,Qg}function Ob(e){const t={};return n=>t[n]||(t[n]=e(n))}function yZe(e,t){return n=>{const r=e(n),i=r.indexOf(t);if(i<0)return r;let s=bZe(r,i);const o=s<r.length?r.slice(s):"";for(;--s>i;)if(r[s]!=="0"){++s;break}return r.slice(0,s)+o}}function bZe(e,t){let n=e.lastIndexOf("e"),r;if(n>0)return n;for(n=e.length;--n>t;)if(r=e.charCodeAt(n),r>=48&&r<=57)return n+1}function Iue(e){const t=Ob(e.format),n=e.formatPrefix;return{format:t,formatPrefix:n,formatFloat(r){const i=sv(r||",");if(i.precision==null){switch(i.precision=12,i.type){case"%":i.precision-=2;break;case"e":i.precision-=1;break}return yZe(t(i),t(".1f")(1)[1])}else return t(i)},formatSpan(r,i,s,o){o=sv(o??",f");const a=HYe(r,i,s),u=Math.max(Math.abs(r),Math.abs(i));let l;if(o.precision==null)switch(o.type){case"s":return isNaN(l=tKe(a,u))||(o.precision=l),n(o,u);case"":case"e":case"g":case"p":case"r":{isNaN(l=nKe(a,u))||(o.precision=l-(o.type==="e"));break}case"f":case"%":{isNaN(l=eKe(a))||(o.precision=l-(o.type==="%")*2);break}}return t(o)}}}let FM;xZe();function xZe(){return FM=Iue({format:pue,formatPrefix:gue})}function vZe(e){return Iue(due(e))}function FH(e){return arguments.length?FM=vZe(e):FM}function OH(e,t,n){n=n||{},T6(n)||$i(`Invalid time multi-format specifier: ${n}`);const r=t(yv),i=t(mv),s=t(gv),o=t(pv),a=t(dv),u=t(hv),l=t(fv),c=t(cv),f=e(n[JI]||".%L"),h=e(n[yv]||":%S"),d=e(n[mv]||"%I:%M"),p=e(n[gv]||"%I %p"),g=e(n[pv]||n[ZI]||"%a %d"),m=e(n[dv]||"%b %d"),y=e(n[hv]||"%B"),b=e(n[fv]||"%B"),v=e(n[cv]||"%Y");return x=>(r(x)<x?f:i(x)<x?h:s(x)<x?d:o(x)<x?p:u(x)<x?a(x)<x?g:m:c(x)<x?l(x)<x?y:b:v)(x)}function Due(e){const t=Ob(e.format),n=Ob(e.utcFormat);return{timeFormat:r=>TM(r)?t(r):OH(t,gKe,r),utcFormat:r=>TM(r)?n(r):OH(n,mKe,r),timeParse:Ob(e.parse),utcParse:Ob(e.utcParse)}}let OM;wZe();function wZe(){return OM=Due({format:Eue,parse:_ue,utcFormat:Aue,utcParse:Tue})}function $Ze(e){return Due(wue(e))}function RM(e){return arguments.length?OM=$Ze(e):OM}const RH=(e,t)=>sy({},e,t);function CZe(e,t){const n=arguments.length;return n&&n!==2&&$i("defaultLocale expects either zero or two arguments."),n?RH(FH(e),RM(t)):RH(FH(),RM())}const SZe=/^(data:|([A-Za-z]+:)?\/\/)/,kZe=/^(?:(?:(?:f|ht)tps?|mailto|tel|callto|cid|xmpp|file|data):|[^a-z]|[a-z+.\-]+(?:[^a-z+.\-:]|$))/i,EZe=/[\u0000-\u0020\u00A0\u1680\u180E\u2000-\u2029\u205f\u3000]/g,MH="file://";function _Ze(e,t){return n=>({options:n||{},sanitize:TZe,load:AZe,fileAccess:!!t,file:IZe(t),http:NZe(e)})}async function AZe(e,t){const n=await this.sanitize(e,t),r=n.href;return n.localFile?this.file(r):this.http(r,t)}async function TZe(e,t){t=sy({},this.options,t);const n=this.fileAccess,r={href:null};let i,s,o;const a=kZe.test(e.replace(EZe,""));(e==null||typeof e!="string"||!a)&&$i("Sanitize failure, invalid URI: "+N6(e));const u=SZe.test(e);return(o=t.baseURL)&&!u&&(!e.startsWith("/")&&!o.endsWith("/")&&(e="/"+e),e=o+e),s=(i=e.startsWith(MH))||t.mode==="file"||t.mode!=="http"&&!u&&n,i?e=e.slice(MH.length):e.startsWith("//")&&(t.defaultProtocol==="file"?(e=e.slice(2),s=!0):e=(t.defaultProtocol||"http")+":"+e),Object.defineProperty(r,"localFile",{value:!!s}),r.href=e,t.target&&(r.target=t.target+""),t.rel&&(r.rel=t.rel+""),t.context==="image"&&t.crossOrigin&&(r.crossOrigin=t.crossOrigin+""),r}function IZe(e){return e?t=>new Promise((n,r)=>{e.readFile(t,(i,s)=>{i?r(i):n(s)})}):DZe}async function DZe(){$i("No file system access.")}function NZe(e){return e?async function(t,n){const r=sy({},this.options.http,n),i=n&&n.response,s=await e(t,r);return s.ok?ka(s[i])?s[i]():s.text():$i(s.status+""+s.statusText)}:FZe}async function FZe(){$i("No HTTP fetch method available.")}const OZe=e=>e!=null&&e===e,RZe=e=>e==="true"||e==="false"||e===!0||e===!1,MZe=e=>!Number.isNaN(Date.parse(e)),Nue=e=>!Number.isNaN(+e)&&!(e instanceof Date),LZe=e=>Nue(e)&&Number.isInteger(+e),LH={boolean:TYe,integer:dH,number:dH,date:DYe,string:NYe,unknown:KI},HC=[RZe,LZe,Nue,MZe],PZe=["boolean","integer","number","date"];function BZe(e,t){if(!e||!e.length)return"unknown";const n=e.length,r=HC.length,i=HC.map((s,o)=>o+1);for(let s=0,o=0,a,u;s<n;++s)for(u=t?e[s][t]:e[s],a=0;a<r;++a)if(i[a]&&OZe(u)&&!HC[a](u)&&(i[a]=0,++o,o===HC.length))return"string";return PZe[i.reduce((s,o)=>s===0?o:s,0)-1]}function zZe(e,t){return t.reduce((n,r)=>(n[r]=BZe(e,r),n),{})}function PH(e){const t=function(n,r){const i={delimiter:e};return P6(n,r?sy(r,i):i)};return t.responseType="text",t}function P6(e,t){return t.header&&(e=t.header.map(N6).join(t.delimiter)+`
`+e),MYe(t.delimiter).parse(e+"")}P6.responseType="text";function UZe(e){return typeof Buffer=="function"&&ka(Buffer.isBuffer)?Buffer.isBuffer(e):!1}function B6(e,t){const n=t&&t.property?tue(t.property):KI;return T6(e)&&!UZe(e)?jZe(n(e),t):n(JSON.parse(e))}B6.responseType="json";function jZe(e,t){return!Bu(e)&&_Ye(e)&&(e=[...e]),t&&t.copy?JSON.parse(JSON.stringify(e)):e}const WZe={interior:(e,t)=>e!==t,exterior:(e,t)=>e===t};function Fue(e,t){let n,r,i,s;return e=B6(e,t),t&&t.feature?(n=sue,i=t.feature):t&&t.mesh?(n=aue,i=t.mesh,s=WZe[t.filter]):$i("Missing TopoJSON feature or mesh parameter."),r=(r=e.objects[i])?n(e,r,s):$i("Invalid TopoJSON object: "+i),r&&r.features||[r]}Fue.responseType="json";const N3={dsv:P6,csv:PH(","),tsv:PH("	"),json:B6,topojson:Fue};function Oue(e,t){return arguments.length>1?(N3[e]=t,this):D6(N3,e)?N3[e]:null}function VZe(e){const t=Oue(e);return t&&t.responseType||"text"}function GZe(e,t,n,r){t=t||{};const i=Oue(t.type||"json");return i||$i("Unknown data format type: "+t.type),e=i(e,t),t.parse&&HZe(e,t.parse,n,r),D6(e,"columns")&&delete e.columns,e}function HZe(e,t,n,r){if(!e.length)return;const i=RM();n=n||i.timeParse,r=r||i.utcParse;let s=e.columns||Object.keys(e[0]),o,a,u,l,c,f;t==="auto"&&(t=zZe(e,s)),s=Object.keys(t);const h=s.map(d=>{const p=t[d];let g,m;if(p&&(p.startsWith("date:")||p.startsWith("utc:")))return g=p.split(/:(.+)?/,2),m=g[1],(m[0]==="'"&&m[m.length-1]==="'"||m[0]==='"'&&m[m.length-1]==='"')&&(m=m.slice(1,-1)),(g[0]==="utc"?r:n)(m);if(!LH[p])throw Error("Illegal format pattern: "+d+":"+p);return LH[p]});for(u=0,c=e.length,f=s.length;u<c;++u)for(o=e[u],l=0;l<f;++l)a=s[l],o[a]=h[l](o[a])}const qZe=_Ze(typeof fetch<"u"&&fetch,null);function QI(e){const t=e||KI,n=[],r={};return n.add=i=>{const s=t(i);return r[s]||(r[s]=1,n.push(i)),n},n.remove=i=>{const s=t(i);if(r[s]){r[s]=0;const o=n.indexOf(i);o>=0&&n.splice(o,1)}return n},n}async function HS(e,t){try{await t(e)}catch(n){e.error(n)}}const Rue=Symbol("vega_id");let XZe=1;function eD(e){return!!(e&&Pe(e))}function Pe(e){return e[Rue]}function Mue(e,t){return e[Rue]=t,e}function Ot(e){const t=e===Object(e)?e:{data:e};return Pe(t)?t:Mue(t,XZe++)}function z6(e){return tD(e,Ot({}))}function tD(e,t){for(const n in e)t[n]=e[n];return t}function Lue(e,t){return Mue(t,Pe(e))}function bg(e,t){return e?t?(n,r)=>e(n,r)||Pe(t(n))-Pe(t(r)):(n,r)=>e(n,r)||Pe(n)-Pe(r):null}function Pue(e){return e&&e.constructor===xg}function xg(){const e=[],t=[],n=[],r=[],i=[];let s=null,o=!1;return{constructor:xg,insert(a){const u=uE(a),l=u.length;for(let c=0;c<l;++c)e.push(u[c]);return this},remove(a){const u=ka(a)?r:t,l=uE(a),c=l.length;for(let f=0;f<c;++f)u.push(l[f]);return this},modify(a,u,l){const c={field:u,value:I6(l)};return ka(a)?(c.filter=a,i.push(c)):(c.tuple=a,n.push(c)),this},encode(a,u){return ka(a)?i.push({filter:a,field:u}):n.push({tuple:a,field:u}),this},clean(a){return s=a,this},reflow(){return o=!0,this},pulse(a,u){const l={},c={};let f,h,d,p,g,m;for(f=0,h=u.length;f<h;++f)l[Pe(u[f])]=1;for(f=0,h=t.length;f<h;++f)g=t[f],l[Pe(g)]=-1;for(f=0,h=r.length;f<h;++f)p=r[f],u.forEach(b=>{p(b)&&(l[Pe(b)]=-1)});for(f=0,h=e.length;f<h;++f)g=e[f],m=Pe(g),l[m]?l[m]=1:a.add.push(Ot(e[f]));for(f=0,h=u.length;f<h;++f)g=u[f],l[Pe(g)]<0&&a.rem.push(g);function y(b,v,x){x?b[v]=x(b):a.encode=v,o||(c[Pe(b)]=b)}for(f=0,h=n.length;f<h;++f)d=n[f],g=d.tuple,p=d.field,m=l[Pe(g)],m>0&&(y(g,p,d.value),a.modifies(p));for(f=0,h=i.length;f<h;++f)d=i[f],p=d.filter,u.forEach(b=>{p(b)&&l[Pe(b)]>0&&y(b,d.field,d.value)}),a.modifies(d.field);if(o)a.mod=t.length||r.length?u.filter(b=>l[Pe(b)]>0):u.slice();else for(m in c)a.mod.push(c[m]);return(s||s==null&&(t.length||r.length))&&a.clean(!0),a}}}const qS="_:mod:_";function nD(){Object.defineProperty(this,qS,{writable:!0,value:{}})}nD.prototype={set(e,t,n,r){const i=this,s=i[e],o=i[qS];return t!=null&&t>=0?(s[t]!==n||r)&&(s[t]=n,o[t+":"+e]=-1,o[e]=-1):(s!==n||r)&&(i[e]=n,o[e]=Bu(n)?1+n.length:-1),i},modified(e,t){const n=this[qS];if(arguments.length){if(Bu(e)){for(let r=0;r<e.length;++r)if(n[e[r]])return!0;return!1}}else{for(const r in n)if(n[r])return!0;return!1}return t!=null&&t>=0?t+1<n[e]||!!n[t+":"+e]:!!n[e]},clear(){return this[qS]={},this}};let YZe=0;const KZe="pulse",ZZe=new nD,JZe=1,QZe=2;function en(e,t,n,r){this.id=++YZe,this.value=e,this.stamp=-1,this.rank=-1,this.qrank=-1,this.flags=0,t&&(this._update=t),n&&this.parameters(n,r)}function BH(e){return function(t){const n=this.flags;return arguments.length===0?!!(n&e):(this.flags=t?n|e:n&~e,this)}}en.prototype={targets(){return this._targets||(this._targets=QI(YI))},set(e){return this.value!==e?(this.value=e,1):0},skip:BH(JZe),modified:BH(QZe),parameters(e,t,n){t=t!==!1;const r=this._argval=this._argval||new nD,i=this._argops=this._argops||[],s=[];let o,a,u,l;const c=(f,h,d)=>{d instanceof en?(d!==this&&(t&&d.targets().add(this),s.push(d)),i.push({op:d,name:f,index:h})):r.set(f,h,d)};for(o in e)if(a=e[o],o===KZe)uE(a).forEach(f=>{f instanceof en?f!==this&&(f.targets().add(this),s.push(f)):$i("Pulse parameters must be operator instances.")}),this.source=a;else if(Bu(a))for(r.set(o,-1,Array(u=a.length)),l=0;l<u;++l)c(o,l,a[l]);else c(o,-1,a);return this.marshall().clear(),n&&(i.initonly=!0),s},marshall(e){const t=this._argval||ZZe,n=this._argops;let r,i,s,o;if(n){const a=n.length;for(i=0;i<a;++i)r=n[i],s=r.op,o=s.modified()&&s.stamp===e,t.set(r.name,r.index,s.value,o);if(n.initonly){for(i=0;i<a;++i)r=n[i],r.op.targets().remove(this);this._argops=null,this._update=null}}return t},detach(){const e=this._argops;let t,n,r,i;if(e)for(t=0,n=e.length;t<n;++t)r=e[t],i=r.op,i._targets&&i._targets.remove(this);this.pulse=null,this.source=null},evaluate(e){const t=this._update;if(t){const n=this.marshall(e.stamp),r=t.call(this,n,e);if(n.clear(),r!==this.value)this.value=r;else if(!this.modified())return e.StopPropagation}},run(e){if(e.stamp<this.stamp)return e.StopPropagation;let t;return this.skip()?(this.skip(!1),t=0):t=this.evaluate(e),this.pulse=t||e}};function eJe(e,t,n,r){let i=1,s;return e instanceof en?s=e:e&&e.prototype instanceof en?s=new e:ka(e)?s=new en(null,e):(i=0,s=new en(e,t)),this.rank(s),i&&(r=n,n=t),n&&this.connect(s,s.parameters(n,r)),this.touch(s),s}function tJe(e,t){const n=e.rank,r=t.length;for(let i=0;i<r;++i)if(n<t[i].rank){this.rerank(e);return}}let nJe=0;function rD(e,t,n){this.id=++nJe,this.value=null,n&&(this.receive=n),e&&(this._filter=e),t&&(this._apply=t)}function Vc(e,t,n){return new rD(e,t,n)}rD.prototype={_filter:AM,_apply:KI,targets(){return this._targets||(this._targets=QI(YI))},consume(e){return arguments.length?(this._consume=!!e,this):!!this._consume},receive(e){if(this._filter(e)){const t=this.value=this._apply(e),n=this._targets,r=n?n.length:0;for(let i=0;i<r;++i)n[i].receive(t);this._consume&&(e.preventDefault(),e.stopPropagation())}},filter(e){const t=Vc(e);return this.targets().add(t),t},apply(e){const t=Vc(null,e);return this.targets().add(t),t},merge(){const e=Vc();this.targets().add(e);for(let t=0,n=arguments.length;t<n;++t)arguments[t].targets().add(e);return e},throttle(e){let t=-1;return this.filter(()=>{const n=Date.now();return n-t>e?(t=n,1):0})},debounce(e){const t=Vc();return this.targets().add(Vc(null,null,SYe(e,n=>{const r=n.dataflow;t.receive(n),r&&r.run&&r.run()}))),t},between(e,t){let n=!1;return e.targets().add(Vc(null,null,()=>n=!0)),t.targets().add(Vc(null,null,()=>n=!1)),this.filter(()=>n)},detach(){this._filter=AM,this._targets=null}};function rJe(e,t,n,r){const i=this,s=Vc(n,r),o=function(l){l.dataflow=i;try{s.receive(l)}catch(c){i.error(c)}finally{i.run()}};let a;typeof e=="string"&&typeof document<"u"?a=document.querySelectorAll(e):a=uE(e);const u=a.length;for(let l=0;l<u;++l)a[l].addEventListener(t,o);return s}function iJe(e,t){const n=this.locale();return GZe(e,t,n.timeParse,n.utcParse)}function sJe(e,t,n){return t=this.parse(t,n),this.pulse(e,this.changeset().insert(t))}async function oJe(e,t){const n=this;let r=0,i;try{i=await n.loader().load(e,{context:"dataflow",response:VZe(t&&t.type)});try{i=n.parse(i,t)}catch(s){r=-2,n.warn("Data ingestion failed",e,s)}}catch(s){r=-1,n.warn("Loading failed",e,s)}return{data:i,status:r}}async function aJe(e,t,n){const r=this,i=r._pending||uJe(r);i.requests+=1;const s=await r.request(t,n);return r.pulse(e,r.changeset().remove(AM).insert(s.data||[])),i.done(),s}function uJe(e){let t;const n=new Promise(r=>t=r);return n.requests=0,n.done=()=>{--n.requests===0&&(e._pending=null,t(e))},e._pending=n}const lJe={skip:!0};function cJe(e,t,n,r,i){return(e instanceof en?hJe:fJe)(this,e,t,n,r,i),this}function fJe(e,t,n,r,i,s){const o=sy({},s,lJe);let a,u;ka(n)||(n=I6(n)),r===void 0?a=l=>e.touch(n(l)):ka(r)?(u=new en(null,r,i,!1),a=l=>{u.evaluate(l);const c=n(l),f=u.value;Pue(f)?e.pulse(c,f,s):e.update(c,f,o)}):a=l=>e.update(n(l),r,o),t.apply(a)}function hJe(e,t,n,r,i,s){if(r===void 0)t.targets().add(n);else{const o=s||{},a=new en(null,dJe(n,r),i,!1);a.modified(o.force),a.rank=t.rank,t.targets().add(a),n&&(a.skip(!0),a.value=n.value,a.targets().add(n),e.connect(n,[a]))}}function dJe(e,t){return t=ka(t)?t:I6(t),e?function(n,r){const i=t(n,r);return e.skip()||(e.skip(i!==this.value).value=i),i}:t}function pJe(e){e.rank=++this._rank}function gJe(e){const t=[e];let n,r,i;for(;t.length;)if(this.rank(n=t.pop()),r=n._targets)for(i=r.length;--i>=0;)t.push(n=r[i]),n===e&&$i("Cycle detected in dataflow graph.")}const pE={},su=1,Xc=2,_l=4,mJe=su|Xc,zH=su|_l,em=su|Xc|_l,UH=8,Ky=16,jH=32,WH=64;function kf(e,t,n){this.dataflow=e,this.stamp=t??-1,this.add=[],this.rem=[],this.mod=[],this.fields=null,this.encode=n||null}function F3(e,t){const n=[];return bd(e,t,r=>n.push(r)),n}function VH(e,t){const n={};return e.visit(t,r=>{n[Pe(r)]=1}),r=>n[Pe(r)]?null:r}function qC(e,t){return e?(n,r)=>e(n,r)&&t(n,r):t}kf.prototype={StopPropagation:pE,ADD:su,REM:Xc,MOD:_l,ADD_REM:mJe,ADD_MOD:zH,ALL:em,REFLOW:UH,SOURCE:Ky,NO_SOURCE:jH,NO_FIELDS:WH,fork(e){return new kf(this.dataflow).init(this,e)},clone(){const e=this.fork(em);return e.add=e.add.slice(),e.rem=e.rem.slice(),e.mod=e.mod.slice(),e.source&&(e.source=e.source.slice()),e.materialize(em|Ky)},addAll(){let e=this;return!e.source||e.add===e.rem||!e.rem.length&&e.source.length===e.add.length||(e=new kf(this.dataflow).init(this),e.add=e.source,e.rem=[]),e},init(e,t){const n=this;return n.stamp=e.stamp,n.encode=e.encode,e.fields&&!(t&WH)&&(n.fields=e.fields),t&su?(n.addF=e.addF,n.add=e.add):(n.addF=null,n.add=[]),t&Xc?(n.remF=e.remF,n.rem=e.rem):(n.remF=null,n.rem=[]),t&_l?(n.modF=e.modF,n.mod=e.mod):(n.modF=null,n.mod=[]),t&jH?(n.srcF=null,n.source=null):(n.srcF=e.srcF,n.source=e.source,e.cleans&&(n.cleans=e.cleans)),n},runAfter(e){this.dataflow.runAfter(e)},changed(e){const t=e||em;return t&su&&this.add.length||t&Xc&&this.rem.length||t&_l&&this.mod.length},reflow(e){if(e)return this.fork(em).reflow();const t=this.add.length,n=this.source&&this.source.length;return n&&n!==t&&(this.mod=this.source,t&&this.filter(_l,VH(this,su))),this},clean(e){return arguments.length?(this.cleans=!!e,this):this.cleans},modifies(e){const t=this.fields||(this.fields={});return Bu(e)?e.forEach(n=>t[n]=!0):t[e]=!0,this},modified(e,t){const n=this.fields;return(t||this.mod.length)&&n?arguments.length?Bu(e)?e.some(r=>n[r]):n[e]:!!n:!1},filter(e,t){const n=this;return e&su&&(n.addF=qC(n.addF,t)),e&Xc&&(n.remF=qC(n.remF,t)),e&_l&&(n.modF=qC(n.modF,t)),e&Ky&&(n.srcF=qC(n.srcF,t)),n},materialize(e){e=e||em;const t=this;return e&su&&t.addF&&(t.add=F3(t.add,t.addF),t.addF=null),e&Xc&&t.remF&&(t.rem=F3(t.rem,t.remF),t.remF=null),e&_l&&t.modF&&(t.mod=F3(t.mod,t.modF),t.modF=null),e&Ky&&t.srcF&&(t.source=t.source.filter(t.srcF),t.srcF=null),t},visit(e,t){const n=this,r=t;if(e&Ky)return bd(n.source,n.srcF,r),n;e&su&&bd(n.add,n.addF,r),e&Xc&&bd(n.rem,n.remF,r),e&_l&&bd(n.mod,n.modF,r);const i=n.source;if(e&UH&&i){const s=n.add.length+n.mod.length;s===i.length||(s?bd(i,VH(n,zH),r):bd(i,n.srcF,r))}return n}};function U6(e,t,n,r){const i=this;let s=0;this.dataflow=e,this.stamp=t,this.fields=null,this.encode=r||null,this.pulses=n;for(const o of n)if(o.stamp===t){if(o.fields){const a=i.fields||(i.fields={});for(const u in o.fields)a[u]=1}o.changed(i.ADD)&&(s|=i.ADD),o.changed(i.REM)&&(s|=i.REM),o.changed(i.MOD)&&(s|=i.MOD)}this.changes=s}rue(U6,kf,{fork(e){const t=new kf(this.dataflow).init(this,e&this.NO_FIELDS);return e!==void 0&&(e&t.ADD&&this.visit(t.ADD,n=>t.add.push(n)),e&t.REM&&this.visit(t.REM,n=>t.rem.push(n)),e&t.MOD&&this.visit(t.MOD,n=>t.mod.push(n))),t},changed(e){return this.changes&e},modified(e){const t=this,n=t.fields;return n&&t.changes&t.MOD?Bu(e)?e.some(r=>n[r]):n[e]:0},filter(){$i("MultiPulse does not support filtering.")},materialize(){$i("MultiPulse does not support materialization.")},visit(e,t){const n=this,r=n.pulses,i=r.length;let s=0;if(e&n.SOURCE)for(;s<i;++s)r[s].visit(e,t);else for(;s<i;++s)r[s].stamp===n.stamp&&r[s].visit(e,t);return n}});async function yJe(e,t,n){const r=this,i=[];if(r._pulse)return Bue(r);if(r._pending&&await r._pending,t&&await HS(r,t),!r._touched.length)return r.debug("Dataflow invoked, but nothing to do."),r;const s=++r._clock;r._pulse=new kf(r,s,e),r._touched.forEach(c=>r._enqueue(c,!0)),r._touched=QI(YI);let o=0,a,u,l;try{for(;r._heap.size()>0;){if(a=r._heap.pop(),a.rank!==a.qrank){r._enqueue(a,!0);continue}u=a.run(r._getPulse(a,e)),u.then?u=await u:u.async&&(i.push(u.async),u=pE),u!==pE&&a._targets&&a._targets.forEach(c=>r._enqueue(c)),++o}}catch(c){r._heap.clear(),l=c}if(r._input={},r._pulse=null,r.debug(`Pulse ${s}: ${o} operators`),l&&(r._postrun=[],r.error(l)),r._postrun.length){const c=r._postrun.sort((f,h)=>h.priority-f.priority);r._postrun=[];for(let f=0;f<c.length;++f)await HS(r,c[f].callback)}return n&&await HS(r,n),i.length&&Promise.all(i).then(c=>r.runAsync(null,()=>{c.forEach(f=>{try{f(r)}catch(h){r.error(h)}})})),r}async function bJe(e,t,n){for(;this._running;)await this._running;const r=()=>this._running=null;return(this._running=this.evaluate(e,t,n)).then(r,r),this._running}function xJe(e,t,n){return this._pulse?Bue(this):(this.evaluate(e,t,n),this)}function vJe(e,t,n){if(this._pulse||t)this._postrun.push({priority:n||0,callback:e});else try{e(this)}catch(r){this.error(r)}}function Bue(e){return e.error("Dataflow already running. Use runAsync() to chain invocations."),e}function wJe(e,t){const n=e.stamp<this._clock;n&&(e.stamp=this._clock),(n||t)&&(e.qrank=e.rank,this._heap.push(e))}function $Je(e,t){const n=e.source,r=this._clock;return n&&Bu(n)?new U6(this,r,n.map(i=>i.pulse),t):this._input[e.id]||CJe(this._pulse,n&&n.pulse)}function CJe(e,t){return t&&t.stamp===e.stamp?t:(e=e.fork(),t&&t!==pE&&(e.source=t.source),e)}const j6={skip:!1,force:!1};function SJe(e,t){const n=t||j6;return this._pulse?this._enqueue(e):this._touched.add(e),n.skip&&e.skip(!0),this}function kJe(e,t,n){const r=n||j6;return(e.set(t)||r.force)&&this.touch(e,r),this}function EJe(e,t,n){this.touch(e,n||j6);const r=new kf(this,this._clock+(this._pulse?0:1)),i=e.pulse&&e.pulse.source||[];return r.target=e,this._input[e.id]=t.pulse(r,i),this}function _Je(e){let t=[];return{clear:()=>t=[],size:()=>t.length,peek:()=>t[0],push:n=>(t.push(n),zue(t,0,t.length-1,e)),pop:()=>{const n=t.pop();let r;return t.length?(r=t[0],t[0]=n,AJe(t,0,e)):r=n,r}}}function zue(e,t,n,r){let i,s;const o=e[n];for(;n>t;){if(s=n-1>>1,i=e[s],r(o,i)<0){e[n]=i,n=s;continue}break}return e[n]=o}function AJe(e,t,n){const r=t,i=e.length,s=e[t];let o=(t<<1)+1,a;for(;o<i;)a=o+1,a<i&&n(e[o],e[a])>=0&&(o=a),e[t]=e[o],t=o,o=(t<<1)+1;return e[t]=s,zue(e,r,t,n)}function Fm(){this.logger(CYe()),this.logLevel(nue),this._clock=0,this._rank=0,this._locale=CZe();try{this._loader=qZe()}catch{}this._touched=QI(YI),this._input={},this._pulse=null,this._heap=_Je((e,t)=>e.qrank-t.qrank),this._postrun=[]}function Zy(e){return function(){return this._log[e].apply(this,arguments)}}Fm.prototype={stamp(){return this._clock},loader(e){return arguments.length?(this._loader=e,this):this._loader},locale(e){return arguments.length?(this._locale=e,this):this._locale},logger(e){return arguments.length?(this._log=e,this):this._log},error:Zy("error"),warn:Zy("warn"),info:Zy("info"),debug:Zy("debug"),logLevel:Zy("level"),cleanThreshold:1e4,add:eJe,connect:tJe,rank:pJe,rerank:gJe,pulse:EJe,touch:SJe,update:kJe,changeset:xg,ingest:sJe,parse:iJe,preload:aJe,request:oJe,events:rJe,on:cJe,evaluate:yJe,run:xJe,runAsync:bJe,runAfter:vJe,_enqueue:wJe,_getPulse:$Je};function re(e,t){en.call(this,e,null,t)}rue(re,en,{run(e){if(e.stamp<this.stamp)return e.StopPropagation;let t;return this.skip()?this.skip(!1):t=this.evaluate(e),t=t||e,t.then?t=t.then(n=>this.pulse=n):t!==e.StopPropagation&&(this.pulse=t),t},evaluate(e){const t=this.marshall(e.stamp),n=this.transform(t,e);return t.clear(),n},transform(){}});const s0={};function Uue(e){const t=jue(e);return t&&t.Definition||null}function jue(e){return e=e&&e.toLowerCase(),D6(s0,e)?s0[e]:null}function oy(e,t){return e<t?-1:e>t?1:e>=t?0:NaN}function n$(e){let t=e,n=e;e.length===1&&(t=(o,a)=>e(o)-a,n=TJe(e));function r(o,a,u,l){for(u==null&&(u=0),l==null&&(l=o.length);u<l;){const c=u+l>>>1;n(o[c],a)<0?u=c+1:l=c}return u}function i(o,a,u,l){for(u==null&&(u=0),l==null&&(l=o.length);u<l;){const c=u+l>>>1;n(o[c],a)>0?l=c:u=c+1}return u}function s(o,a,u,l){u==null&&(u=0),l==null&&(l=o.length);const c=r(o,a,u,l-1);return c>u&&t(o[c-1],a)>-t(o[c],a)?c-1:c}return{left:r,center:s,right:i}}function TJe(e){return(t,n)=>oy(e(t),n)}function Wue(e){return e===null?NaN:+e}function*IJe(e,t){if(t===void 0)for(let n of e)n!=null&&(n=+n)>=n&&(yield n);else{let n=-1;for(let r of e)(r=t(r,++n,e))!=null&&(r=+r)>=r&&(yield r)}}const Vue=n$(oy),gE=Vue.right,DJe=Vue.left;n$(Wue).center;const r$=gE;function NJe(e,t){let n=0,r,i=0,s=0;if(t===void 0)for(let o of e)o!=null&&(o=+o)>=o&&(r=o-i,i+=r/++n,s+=r*(o-i));else{let o=-1;for(let a of e)(a=t(a,++o,e))!=null&&(a=+a)>=a&&(r=a-i,i+=r/++n,s+=r*(a-i))}if(n>1)return s/(n-1)}function FJe(e,t){const n=NJe(e,t);return n&&Math.sqrt(n)}class Gi{constructor(){this._partials=new Float64Array(32),this._n=0}add(t){const n=this._partials;let r=0;for(let i=0;i<this._n&&i<32;i++){const s=n[i],o=t+s,a=Math.abs(t)<Math.abs(s)?t-(o-s):s-(o-t);a&&(n[r++]=a),t=o}return n[r]=t,this._n=r+1,this}valueOf(){const t=this._partials;let n=this._n,r,i,s,o=0;if(n>0){for(o=t[--n];n>0&&(r=o,i=t[--n],o=r+i,s=i-(o-r),!s););n>0&&(s<0&&t[n-1]<0||s>0&&t[n-1]>0)&&(i=s*2,r=o+i,i==r-o&&(o=r))}return o}}function OJe(e,t){return Array.from(t,n=>e[n])}var MM=Math.sqrt(50),LM=Math.sqrt(10),PM=Math.sqrt(2);function BM(e,t,n){var r,i=-1,s,o,a;if(t=+t,e=+e,n=+n,e===t&&n>0)return[e];if((r=t<e)&&(s=e,e=t,t=s),(a=Gue(e,t,n))===0||!isFinite(a))return[];if(a>0){let u=Math.round(e/a),l=Math.round(t/a);for(u*a<e&&++u,l*a>t&&--l,o=new Array(s=l-u+1);++i<s;)o[i]=(u+i)*a}else{a=-a;let u=Math.round(e*a),l=Math.round(t*a);for(u/a<e&&++u,l/a>t&&--l,o=new Array(s=l-u+1);++i<s;)o[i]=(u+i)/a}return r&&o.reverse(),o}function Gue(e,t,n){var r=(t-e)/Math.max(0,n),i=Math.floor(Math.log(r)/Math.LN10),s=r/Math.pow(10,i);return i>=0?(s>=MM?10:s>=LM?5:s>=PM?2:1)*Math.pow(10,i):-Math.pow(10,-i)/(s>=MM?10:s>=LM?5:s>=PM?2:1)}function Zf(e,t,n){var r=Math.abs(t-e)/Math.max(0,n),i=Math.pow(10,Math.floor(Math.log(r)/Math.LN10)),s=r/i;return s>=MM?i*=10:s>=LM?i*=5:s>=PM&&(i*=2),t<e?-i:i}function tp(e,t){let n;if(t===void 0)for(const r of e)r!=null&&(n<r||n===void 0&&r>=r)&&(n=r);else{let r=-1;for(let i of e)(i=t(i,++r,e))!=null&&(n<i||n===void 0&&i>=i)&&(n=i)}return n}function zM(e,t){let n;if(t===void 0)for(const r of e)r!=null&&(n>r||n===void 0&&r>=r)&&(n=r);else{let r=-1;for(let i of e)(i=t(i,++r,e))!=null&&(n>i||n===void 0&&i>=i)&&(n=i)}return n}function Hue(e,t,n=0,r=e.length-1,i=oy){for(;r>n;){if(r-n>600){const u=r-n+1,l=t-n+1,c=Math.log(u),f=.5*Math.exp(2*c/3),h=.5*Math.sqrt(c*f*(u-f)/u)*(l-u/2<0?-1:1),d=Math.max(n,Math.floor(t-l*f/u+h)),p=Math.min(r,Math.floor(t+(u-l)*f/u+h));Hue(e,t,d,p,i)}const s=e[t];let o=n,a=r;for(Jy(e,n,t),i(e[r],s)>0&&Jy(e,n,r);o<a;){for(Jy(e,o,a),++o,--a;i(e[o],s)<0;)++o;for(;i(e[a],s)>0;)--a}i(e[n],s)===0?Jy(e,n,a):(++a,Jy(e,a,r)),a<=t&&(n=a+1),t<=a&&(r=a-1)}return e}function Jy(e,t,n){const r=e[t];e[t]=e[n],e[n]=r}function UM(e,t,n){if(e=Float64Array.from(IJe(e,n)),!!(r=e.length)){if((t=+t)<=0||r<2)return zM(e);if(t>=1)return tp(e);var r,i=(r-1)*t,s=Math.floor(i),o=tp(Hue(e,s).subarray(0,s+1)),a=zM(e.subarray(s+1));return o+(a-o)*(i-s)}}function que(e,t,n=Wue){if(r=e.length){if((t=+t)<=0||r<2)return+n(e[0],0,e);if(t>=1)return+n(e[r-1],r-1,e);var r,i=(r-1)*t,s=Math.floor(i),o=+n(e[s],s,e),a=+n(e[s+1],s+1,e);return o+(a-o)*(i-s)}}function RJe(e,t){let n=0,r=0;if(t===void 0)for(let i of e)i!=null&&(i=+i)>=i&&(++n,r+=i);else{let i=-1;for(let s of e)(s=t(s,++i,e))!=null&&(s=+s)>=s&&(++n,r+=s)}if(n)return r/n}function Xue(e,t){return UM(e,.5,t)}function*MJe(e){for(const t of e)yield*t}function Yue(e){return Array.from(MJe(e))}function Js(e,t,n){e=+e,t=+t,n=(i=arguments.length)<2?(t=e,e=0,1):i<3?1:+n;for(var r=-1,i=Math.max(0,Math.ceil((t-e)/n))|0,s=new Array(i);++r<i;)s[r]=e+r*n;return s}function Kue(e,t){let n=0;if(t===void 0)for(let r of e)(r=+r)&&(n+=r);else{let r=-1;for(let i of e)(i=+t(i,++r,e))&&(n+=i)}return n}function*Zue(e,t){if(t==null)for(let n of e)n!=null&&n!==""&&(n=+n)>=n&&(yield n);else{let n=-1;for(let r of e)r=t(r,++n,e),r!=null&&r!==""&&(r=+r)>=r&&(yield r)}}function W6(e,t,n){const r=Float64Array.from(Zue(e,n));return r.sort(oy),t.map(i=>que(r,i))}function V6(e,t){return W6(e,[.25,.5,.75],t)}function G6(e,t){const n=e.length,r=FJe(e,t),i=V6(e,t),s=(i[2]-i[0])/1.34;return 1.06*(Math.min(r,s)||r||Math.abs(i[0])||1)*Math.pow(n,-.2)}function Jue(e){const t=e.maxbins||20,n=e.base||10,r=Math.log(n),i=e.divide||[5,2];let s=e.extent[0],o=e.extent[1],a,u,l,c,f,h;const d=e.span||o-s||Math.abs(s)||1;if(e.step)a=e.step;else if(e.steps){for(c=d/t,f=0,h=e.steps.length;f<h&&e.steps[f]<c;++f);a=e.steps[Math.max(0,f-1)]}else{for(u=Math.ceil(Math.log(t)/r),l=e.minstep||0,a=Math.max(l,Math.pow(n,Math.round(Math.log(d)/r)-u));Math.ceil(d/a)>t;)a*=n;for(f=0,h=i.length;f<h;++f)c=a/i[f],c>=l&&d/c<=t&&(a=c)}c=Math.log(a);const p=c>=0?0:~~(-c/r)+1,g=Math.pow(n,-p-1);return(e.nice||e.nice===void 0)&&(c=Math.floor(s/a+g)*a,s=s<c?c-a:c,o=Math.ceil(o/a)*a),{start:s,stop:o===s?s+a:o,step:a}}var Oa=Math.random;function LJe(e){Oa=e}function Que(e,t,n,r){if(!e.length)return[void 0,void 0];const i=Float64Array.from(Zue(e,r)),s=i.length,o=t;let a,u,l,c;for(l=0,c=Array(o);l<o;++l){for(a=0,u=0;u<s;++u)a+=i[~~(Oa()*s)];c[l]=a/s}return c.sort(oy),[UM(c,n/2),UM(c,1-n/2)]}function ele(e,t,n,r){r=r||(h=>h);const i=e.length,s=new Float64Array(i);let o=0,a=1,u=r(e[0]),l=u,c=u+t,f;for(;a<i;++a){if(f=r(e[a]),f>=c){for(l=(u+l)/2;o<a;++o)s[o]=l;c=f+t,u=f}l=f}for(l=(u+l)/2;o<a;++o)s[o]=l;return n?PJe(s,t+t/4):s}function PJe(e,t){const n=e.length;let r=0,i=1,s,o;for(;e[r]===e[i];)++i;for(;i<n;){for(s=i+1;e[i]===e[s];)++s;if(e[i]-e[i-1]<t){for(o=i+(r+s-i-i>>1);o<i;)e[o++]=e[i];for(;o>i;)e[o--]=e[r]}r=i,i=s}return e}function BJe(e){return function(){return e=(1103515245*e+12345)%2147483647,e/2147483647}}function zJe(e,t){t==null&&(t=e,e=0);let n,r,i;const s={min(o){return arguments.length?(n=o||0,i=r-n,s):n},max(o){return arguments.length?(r=o||0,i=r-n,s):r},sample(){return n+Math.floor(i*Oa())},pdf(o){return o===Math.floor(o)&&o>=n&&o<r?1/i:0},cdf(o){const a=Math.floor(o);return a<n?0:a>=r?1:(a-n+1)/i},icdf(o){return o>=0&&o<=1?n-1+Math.floor(o*i):NaN}};return s.min(e).max(t)}const tle=Math.sqrt(2*Math.PI),UJe=Math.SQRT2;let Qy=NaN;function iD(e,t){e=e||0,t=t??1;let n=0,r=0,i,s;if(Qy===Qy)n=Qy,Qy=NaN;else{do n=Oa()*2-1,r=Oa()*2-1,i=n*n+r*r;while(i===0||i>1);s=Math.sqrt(-2*Math.log(i)/i),n*=s,Qy=r*s}return e+n*t}function H6(e,t,n){n=n??1;const r=(e-(t||0))/n;return Math.exp(-.5*r*r)/(n*tle)}function sD(e,t,n){t=t||0,n=n??1;const r=(e-t)/n,i=Math.abs(r);let s;if(i>37)s=0;else{const o=Math.exp(-i*i/2);let a;i<7.07106781186547?(a=.0352624965998911*i+.700383064443688,a=a*i+6.37396220353165,a=a*i+33.912866078383,a=a*i+112.079291497871,a=a*i+221.213596169931,a=a*i+220.206867912376,s=o*a,a=.0883883476483184*i+1.75566716318264,a=a*i+16.064177579207,a=a*i+86.7807322029461,a=a*i+296.564248779674,a=a*i+637.333633378831,a=a*i+793.826512519948,a=a*i+440.413735824752,s=s/a):(a=i+.65,a=i+4/a,a=i+3/a,a=i+2/a,a=i+1/a,s=o/a/2.506628274631)}return r>0?1-s:s}function oD(e,t,n){return e<0||e>1?NaN:(t||0)+(n??1)*UJe*jJe(2*e-1)}function jJe(e){let t=-Math.log((1-e)*(1+e)),n;return t<6.25?(t-=3.125,n=-364441206401782e-35,n=-16850591381820166e-35+n*t,n=128584807152564e-32+n*t,n=11157877678025181e-33+n*t,n=-1333171662854621e-31+n*t,n=20972767875968562e-33+n*t,n=6637638134358324e-30+n*t,n=-4054566272975207e-29+n*t,n=-8151934197605472e-29+n*t,n=26335093153082323e-28+n*t,n=-12975133253453532e-27+n*t,n=-5415412054294628e-26+n*t,n=10512122733215323e-25+n*t,n=-4112633980346984e-24+n*t,n=-29070369957882005e-24+n*t,n=42347877827932404e-23+n*t,n=-13654692000834679e-22+n*t,n=-13882523362786469e-21+n*t,n=.00018673420803405714+n*t,n=-.000740702534166267+n*t,n=-.006033670871430149+n*t,n=.24015818242558962+n*t,n=1.6536545626831027+n*t):t<16?(t=Math.sqrt(t)-3.25,n=22137376921775787e-25,n=9075656193888539e-23+n*t,n=-27517406297064545e-23+n*t,n=18239629214389228e-24+n*t,n=15027403968909828e-22+n*t,n=-4013867526981546e-21+n*t,n=29234449089955446e-22+n*t,n=12475304481671779e-21+n*t,n=-47318229009055734e-21+n*t,n=6828485145957318e-20+n*t,n=24031110387097894e-21+n*t,n=-.0003550375203628475+n*t,n=.0009532893797373805+n*t,n=-.0016882755560235047+n*t,n=.002491442096107851+n*t,n=-.003751208507569241+n*t,n=.005370914553590064+n*t,n=1.0052589676941592+n*t,n=3.0838856104922208+n*t):Number.isFinite(t)?(t=Math.sqrt(t)-5,n=-27109920616438573e-27,n=-2555641816996525e-25+n*t,n=15076572693500548e-25+n*t,n=-3789465440126737e-24+n*t,n=761570120807834e-23+n*t,n=-1496002662714924e-23+n*t,n=2914795345090108e-23+n*t,n=-6771199775845234e-23+n*t,n=22900482228026655e-23+n*t,n=-99298272942317e-20+n*t,n=4526062597223154e-21+n*t,n=-1968177810553167e-20+n*t,n=7599527703001776e-20+n*t,n=-.00021503011930044477+n*t,n=-.00013871931833623122+n*t,n=1.0103004648645344+n*t,n=4.849906401408584+n*t):n=1/0,n*e}function q6(e,t){let n,r;const i={mean(s){return arguments.length?(n=s||0,i):n},stdev(s){return arguments.length?(r=s??1,i):r},sample:()=>iD(n,r),pdf:s=>H6(s,n,r),cdf:s=>sD(s,n,r),icdf:s=>oD(s,n,r)};return i.mean(e).stdev(t)}function X6(e,t){const n=q6();let r=0;const i={data(s){return arguments.length?(e=s,r=s?s.length:0,i.bandwidth(t)):e},bandwidth(s){return arguments.length?(t=s,!t&&e&&(t=G6(e)),i):t},sample(){return e[~~(Oa()*r)]+t*n.sample()},pdf(s){let o=0,a=0;for(;a<r;++a)o+=n.pdf((s-e[a])/t);return o/t/r},cdf(s){let o=0,a=0;for(;a<r;++a)o+=n.cdf((s-e[a])/t);return o/r},icdf(){throw Error("KDE icdf not supported.")}};return i.data(e)}function Y6(e,t){return e=e||0,t=t??1,Math.exp(e+iD()*t)}function K6(e,t,n){if(e<=0)return 0;t=t||0,n=n??1;const r=(Math.log(e)-t)/n;return Math.exp(-.5*r*r)/(n*tle*e)}function Z6(e,t,n){return sD(Math.log(e),t,n)}function J6(e,t,n){return Math.exp(oD(e,t,n))}function nle(e,t){let n,r;const i={mean(s){return arguments.length?(n=s||0,i):n},stdev(s){return arguments.length?(r=s??1,i):r},sample:()=>Y6(n,r),pdf:s=>K6(s,n,r),cdf:s=>Z6(s,n,r),icdf:s=>J6(s,n,r)};return i.mean(e).stdev(t)}function rle(e,t){let n=0,r;function i(o){const a=[];let u=0,l;for(l=0;l<n;++l)u+=a[l]=o[l]==null?1:+o[l];for(l=0;l<n;++l)a[l]/=u;return a}const s={weights(o){return arguments.length?(r=i(t=o||[]),s):t},distributions(o){return arguments.length?(o?(n=o.length,e=o):(n=0,e=[]),s.weights(t)):e},sample(){const o=Oa();let a=e[n-1],u=r[0],l=0;for(;l<n-1;u+=r[++l])if(o<u){a=e[l];break}return a.sample()},pdf(o){let a=0,u=0;for(;u<n;++u)a+=r[u]*e[u].pdf(o);return a},cdf(o){let a=0,u=0;for(;u<n;++u)a+=r[u]*e[u].cdf(o);return a},icdf(){throw Error("Mixture icdf not supported.")}};return s.distributions(e).weights(t)}function Q6(e,t){return t==null&&(t=e??1,e=0),e+(t-e)*Oa()}function ez(e,t,n){return n==null&&(n=t??1,t=0),e>=t&&e<=n?1/(n-t):0}function tz(e,t,n){return n==null&&(n=t??1,t=0),e<t?0:e>n?1:(e-t)/(n-t)}function nz(e,t,n){return n==null&&(n=t??1,t=0),e>=0&&e<=1?t+e*(n-t):NaN}function ile(e,t){let n,r;const i={min(s){return arguments.length?(n=s||0,i):n},max(s){return arguments.length?(r=s??1,i):r},sample:()=>Q6(n,r),pdf:s=>ez(s,n,r),cdf:s=>tz(s,n,r),icdf:s=>nz(s,n,r)};return t==null&&(t=e??1,e=0),i.min(e).max(t)}function i$(e,t,n,r){const i=r-e*e,s=Math.abs(i)<1e-24?0:(n-e*t)/i;return[t-s*e,s]}function aD(e,t,n,r){e=e.filter(d=>{let p=t(d),g=n(d);return p!=null&&(p=+p)>=p&&g!=null&&(g=+g)>=g}),r&&e.sort((d,p)=>t(d)-t(p));const i=e.length,s=new Float64Array(i),o=new Float64Array(i);let a=0,u=0,l=0,c,f,h;for(h of e)s[a]=c=+t(h),o[a]=f=+n(h),++a,u+=(c-u)/a,l+=(f-l)/a;for(a=0;a<i;++a)s[a]-=u,o[a]-=l;return[s,o,u,l]}function s$(e,t,n,r){let i=-1,s,o;for(const a of e)s=t(a),o=n(a),s!=null&&(s=+s)>=s&&o!=null&&(o=+o)>=o&&r(s,o,++i)}function ay(e,t,n,r,i){let s=0,o=0;return s$(e,t,n,(a,u)=>{const l=u-i(a),c=u-r;s+=l*l,o+=c*c}),1-s/o}function rz(e,t,n){let r=0,i=0,s=0,o=0,a=0;s$(e,t,n,(c,f)=>{++a,r+=(c-r)/a,i+=(f-i)/a,s+=(c*f-s)/a,o+=(c*c-o)/a});const u=i$(r,i,s,o),l=c=>u[0]+u[1]*c;return{coef:u,predict:l,rSquared:ay(e,t,n,i,l)}}function sle(e,t,n){let r=0,i=0,s=0,o=0,a=0;s$(e,t,n,(c,f)=>{++a,c=Math.log(c),r+=(c-r)/a,i+=(f-i)/a,s+=(c*f-s)/a,o+=(c*c-o)/a});const u=i$(r,i,s,o),l=c=>u[0]+u[1]*Math.log(c);return{coef:u,predict:l,rSquared:ay(e,t,n,i,l)}}function ole(e,t,n){const[r,i,s,o]=aD(e,t,n);let a=0,u=0,l=0,c=0,f=0,h,d,p;s$(e,t,n,(b,v)=>{h=r[f++],d=Math.log(v),p=h*v,a+=(v*d-a)/f,u+=(p-u)/f,l+=(p*d-l)/f,c+=(h*p-c)/f});const[g,m]=i$(u/o,a/o,l/o,c/o),y=b=>Math.exp(g+m*(b-s));return{coef:[Math.exp(g-m*s),m],predict:y,rSquared:ay(e,t,n,o,y)}}function ale(e,t,n){let r=0,i=0,s=0,o=0,a=0,u=0;s$(e,t,n,(f,h)=>{const d=Math.log(f),p=Math.log(h);++u,r+=(d-r)/u,i+=(p-i)/u,s+=(d*p-s)/u,o+=(d*d-o)/u,a+=(h-a)/u});const l=i$(r,i,s,o),c=f=>l[0]*Math.pow(f,l[1]);return l[0]=Math.exp(l[0]),{coef:l,predict:c,rSquared:ay(e,t,n,a,c)}}function iz(e,t,n){const[r,i,s,o]=aD(e,t,n),a=r.length;let u=0,l=0,c=0,f=0,h=0,d,p,g,m;for(d=0;d<a;)p=r[d],g=i[d++],m=p*p,u+=(m-u)/d,l+=(m*p-l)/d,c+=(m*m-c)/d,f+=(p*g-f)/d,h+=(m*g-h)/d;const y=c-u*u,b=u*y-l*l,v=(h*u-f*l)/b,x=(f*y-h*l)/b,w=-v*u,C=$=>($=$-s,v*$*$+x*$+w+o);return{coef:[w-x*s+v*s*s+o,x-2*v*s,v],predict:C,rSquared:ay(e,t,n,o,C)}}function ule(e,t,n,r){if(r===1)return rz(e,t,n);if(r===2)return iz(e,t,n);const[i,s,o,a]=aD(e,t,n),u=i.length,l=[],c=[],f=r+1;let h,d,p,g,m;for(h=0;h<f;++h){for(p=0,g=0;p<u;++p)g+=Math.pow(i[p],h)*s[p];for(l.push(g),m=new Float64Array(f),d=0;d<f;++d){for(p=0,g=0;p<u;++p)g+=Math.pow(i[p],h+d);m[d]=g}c.push(m)}c.push(l);const y=VJe(c),b=v=>{v-=o;let x=a+y[0]+y[1]*v+y[2]*v*v;for(h=3;h<f;++h)x+=y[h]*Math.pow(v,h);return x};return{coef:WJe(f,y,-o,a),predict:b,rSquared:ay(e,t,n,a,b)}}function WJe(e,t,n,r){const i=Array(e);let s,o,a,u;for(s=0;s<e;++s)i[s]=0;for(s=e-1;s>=0;--s)for(a=t[s],u=1,i[s]+=a,o=1;o<=s;++o)u*=(s+1-o)/o,i[s-o]+=a*Math.pow(n,o)*u;return i[0]+=r,i}function VJe(e){const t=e.length-1,n=[];let r,i,s,o,a;for(r=0;r<t;++r){for(o=r,i=r+1;i<t;++i)Math.abs(e[r][i])>Math.abs(e[r][o])&&(o=i);for(s=r;s<t+1;++s)a=e[s][r],e[s][r]=e[s][o],e[s][o]=a;for(i=r+1;i<t;++i)for(s=t;s>=r;s--)e[s][i]-=e[s][r]*e[r][i]/e[r][r]}for(i=t-1;i>=0;--i){for(a=0,s=i+1;s<t;++s)a+=e[s][i]*n[s];n[i]=(e[t][i]-a)/e[i][i]}return n}const GH=2,HH=1e-12;function lle(e,t,n,r){const[i,s,o,a]=aD(e,t,n,!0),u=i.length,l=Math.max(2,~~(r*u)),c=new Float64Array(u),f=new Float64Array(u),h=new Float64Array(u).fill(1);for(let d=-1;++d<=GH;){const p=[0,l-1];for(let m=0;m<u;++m){const y=i[m],b=p[0],v=p[1],x=y-i[b]>i[v]-y?b:v;let w=0,C=0,$=0,S=0,k=0;const E=1/Math.abs(i[x]-y||1);for(let A=b;A<=v;++A){const T=i[A],I=s[A],F=GJe(Math.abs(y-T)*E)*h[A],R=T*F;w+=F,C+=R,$+=I*F,S+=I*R,k+=T*R}const[_,D]=i$(C/w,$/w,S/w,k/w);c[m]=_+D*y,f[m]=Math.abs(s[m]-c[m]),HJe(i,m+1,p)}if(d===GH)break;const g=Xue(f);if(Math.abs(g)<HH)break;for(let m=0,y,b;m<u;++m)y=f[m]/(6*g),h[m]=y>=1?HH:(b=1-y*y)*b}return qJe(i,c,o,a)}function GJe(e){return(e=1-e*e*e)*e*e}function HJe(e,t,n){const r=e[t];let i=n[0],s=n[1]+1;if(!(s>=e.length))for(;t>i&&e[s]-r<=r-e[i];)n[0]=++i,n[1]=s,++s}function qJe(e,t,n,r){const i=e.length,s=[];let o=0,a=0,u=[],l;for(;o<i;++o)l=e[o]+n,u[0]===l?u[1]+=(t[o]-u[1])/++a:(a=0,u[1]+=r,u=[l,t[o]],s.push(u));return u[1]+=r,s}const XJe=.5*Math.PI/180;function uD(e,t,n,r){n=n||25,r=Math.max(n,r||200);const i=g=>[g,e(g)],s=t[0],o=t[1],a=o-s,u=a/r,l=[i(s)],c=[];if(n===r){for(let g=1;g<r;++g)l.push(i(s+g/n*a));return l.push(i(o)),l}else{c.push(i(o));for(let g=n;--g>0;)c.push(i(s+g/n*a))}let f=l[0],h=c[c.length-1];const d=1/a,p=YJe(f[1],c);for(;h;){const g=i((f[0]+h[0])/2);g[0]-f[0]>=u&&KJe(f,g,h,d,p)>XJe?c.push(g):(f=h,l.push(h),c.pop()),h=c[c.length-1]}return l}function YJe(e,t){let n=e,r=e;const i=t.length;for(let s=0;s<i;++s){const o=t[s][1];o<n&&(n=o),o>r&&(r=o)}return 1/(r-n)}function KJe(e,t,n,r,i){const s=Math.atan2(i*(n[1]-e[1]),r*(n[0]-e[0])),o=Math.atan2(i*(t[1]-e[1]),r*(t[0]-e[0]));return Math.abs(s-o)}var O3=new Date,R3=new Date;function Pr(e,t,n,r){function i(s){return e(s=arguments.length===0?new Date:new Date(+s)),s}return i.floor=function(s){return e(s=new Date(+s)),s},i.ceil=function(s){return e(s=new Date(s-1)),t(s,1),e(s),s},i.round=function(s){var o=i(s),a=i.ceil(s);return s-o<a-s?o:a},i.offset=function(s,o){return t(s=new Date(+s),o==null?1:Math.floor(o)),s},i.range=function(s,o,a){var u=[],l;if(s=i.ceil(s),a=a==null?1:Math.floor(a),!(s<o)||!(a>0))return u;do u.push(l=new Date(+s)),t(s,a),e(s);while(l<s&&s<o);return u},i.filter=function(s){return Pr(function(o){if(o>=o)for(;e(o),!s(o);)o.setTime(o-1)},function(o,a){if(o>=o)if(a<0)for(;++a<=0;)for(;t(o,-1),!s(o););else for(;--a>=0;)for(;t(o,1),!s(o););})},n&&(i.count=function(s,o){return O3.setTime(+s),R3.setTime(+o),e(O3),e(R3),Math.floor(n(O3,R3))},i.every=function(s){return s=Math.floor(s),!isFinite(s)||!(s>0)?null:s>1?i.filter(r?function(o){return r(o)%s===0}:function(o){return i.count(0,o)%s===0}):i}),i}var mE=Pr(function(){},function(e,t){e.setTime(+e+t)},function(e,t){return t-e});mE.every=function(e){return e=Math.floor(e),!isFinite(e)||!(e>0)?null:e>1?Pr(function(t){t.setTime(Math.floor(t/e)*e)},function(t,n){t.setTime(+t+n*e)},function(t,n){return(n-t)/e}):mE};const sz=mE;mE.range;const zl=1e3,_o=zl*60,Ul=_o*60,Ep=Ul*24,oz=Ep*7,qH=Ep*30,M3=Ep*365;var cle=Pr(function(e){e.setTime(e-e.getMilliseconds())},function(e,t){e.setTime(+e+t*zl)},function(e,t){return(t-e)/zl},function(e){return e.getUTCSeconds()});const of=cle;cle.range;var fle=Pr(function(e){e.setTime(e-e.getMilliseconds()-e.getSeconds()*zl)},function(e,t){e.setTime(+e+t*_o)},function(e,t){return(t-e)/_o},function(e){return e.getMinutes()});const az=fle;fle.range;var hle=Pr(function(e){e.setTime(e-e.getMilliseconds()-e.getSeconds()*zl-e.getMinutes()*_o)},function(e,t){e.setTime(+e+t*Ul)},function(e,t){return(t-e)/Ul},function(e){return e.getHours()});const uz=hle;hle.range;var dle=Pr(e=>e.setHours(0,0,0,0),(e,t)=>e.setDate(e.getDate()+t),(e,t)=>(t-e-(t.getTimezoneOffset()-e.getTimezoneOffset())*_o)/Ep,e=>e.getDate()-1);const Ef=dle;dle.range;function vg(e){return Pr(function(t){t.setDate(t.getDate()-(t.getDay()+7-e)%7),t.setHours(0,0,0,0)},function(t,n){t.setDate(t.getDate()+n*7)},function(t,n){return(n-t-(n.getTimezoneOffset()-t.getTimezoneOffset())*_o)/oz})}var uy=vg(0),yE=vg(1),ZJe=vg(2),JJe=vg(3),o0=vg(4),QJe=vg(5),eQe=vg(6);uy.range;yE.range;ZJe.range;JJe.range;o0.range;QJe.range;eQe.range;var ple=Pr(function(e){e.setDate(1),e.setHours(0,0,0,0)},function(e,t){e.setMonth(e.getMonth()+t)},function(e,t){return t.getMonth()-e.getMonth()+(t.getFullYear()-e.getFullYear())*12},function(e){return e.getMonth()});const bE=ple;ple.range;var lz=Pr(function(e){e.setMonth(0,1),e.setHours(0,0,0,0)},function(e,t){e.setFullYear(e.getFullYear()+t)},function(e,t){return t.getFullYear()-e.getFullYear()},function(e){return e.getFullYear()});lz.every=function(e){return!isFinite(e=Math.floor(e))||!(e>0)?null:Pr(function(t){t.setFullYear(Math.floor(t.getFullYear()/e)*e),t.setMonth(0,1),t.setHours(0,0,0,0)},function(t,n){t.setFullYear(t.getFullYear()+n*e)})};const Jf=lz;lz.range;var gle=Pr(function(e){e.setUTCSeconds(0,0)},function(e,t){e.setTime(+e+t*_o)},function(e,t){return(t-e)/_o},function(e){return e.getUTCMinutes()});const cz=gle;gle.range;var mle=Pr(function(e){e.setUTCMinutes(0,0,0)},function(e,t){e.setTime(+e+t*Ul)},function(e,t){return(t-e)/Ul},function(e){return e.getUTCHours()});const fz=mle;mle.range;var yle=Pr(function(e){e.setUTCHours(0,0,0,0)},function(e,t){e.setUTCDate(e.getUTCDate()+t)},function(e,t){return(t-e)/Ep},function(e){return e.getUTCDate()-1});const _f=yle;yle.range;function wg(e){return Pr(function(t){t.setUTCDate(t.getUTCDate()-(t.getUTCDay()+7-e)%7),t.setUTCHours(0,0,0,0)},function(t,n){t.setUTCDate(t.getUTCDate()+n*7)},function(t,n){return(n-t)/oz})}var ly=wg(0),xE=wg(1),tQe=wg(2),nQe=wg(3),a0=wg(4),rQe=wg(5),iQe=wg(6);ly.range;xE.range;tQe.range;nQe.range;a0.range;rQe.range;iQe.range;var ble=Pr(function(e){e.setUTCDate(1),e.setUTCHours(0,0,0,0)},function(e,t){e.setUTCMonth(e.getUTCMonth()+t)},function(e,t){return t.getUTCMonth()-e.getUTCMonth()+(t.getUTCFullYear()-e.getUTCFullYear())*12},function(e){return e.getUTCMonth()});const vE=ble;ble.range;var hz=Pr(function(e){e.setUTCMonth(0,1),e.setUTCHours(0,0,0,0)},function(e,t){e.setUTCFullYear(e.getUTCFullYear()+t)},function(e,t){return t.getUTCFullYear()-e.getUTCFullYear()},function(e){return e.getUTCFullYear()});hz.every=function(e){return!isFinite(e=Math.floor(e))||!(e>0)?null:Pr(function(t){t.setUTCFullYear(Math.floor(t.getUTCFullYear()/e)*e),t.setUTCMonth(0,1),t.setUTCHours(0,0,0,0)},function(t,n){t.setUTCFullYear(t.getUTCFullYear()+n*e)})};const Qf=hz;hz.range;function xle(e,t,n,r,i,s){const o=[[of,1,zl],[of,5,5*zl],[of,15,15*zl],[of,30,30*zl],[s,1,_o],[s,5,5*_o],[s,15,15*_o],[s,30,30*_o],[i,1,Ul],[i,3,3*Ul],[i,6,6*Ul],[i,12,12*Ul],[r,1,Ep],[r,2,2*Ep],[n,1,oz],[t,1,qH],[t,3,3*qH],[e,1,M3]];function a(l,c,f){const h=c<l;h&&([l,c]=[c,l]);const d=f&&typeof f.range=="function"?f:u(l,c,f),p=d?d.range(l,+c+1):[];return h?p.reverse():p}function u(l,c,f){const h=Math.abs(c-l)/f,d=n$(([,,m])=>m).right(o,h);if(d===o.length)return e.every(Zf(l/M3,c/M3,f));if(d===0)return sz.every(Math.max(Zf(l,c,f),1));const[p,g]=o[h/o[d-1][2]<o[d][2]/h?d-1:d];return p.every(g)}return[a,u]}const[sQe,oQe]=xle(Qf,vE,ly,_f,fz,cz),[aQe,uQe]=xle(Jf,bE,uy,Ef,uz,az),Yr="year",Is="quarter",Ci="month",ar="week",Ds="date",gi="day",zu="dayofyear",so="hours",oo="minutes",zo="seconds",Ra="milliseconds",dz=[Yr,Is,Ci,ar,Ds,gi,zu,so,oo,zo,Ra],L3=dz.reduce((e,t,n)=>(e[t]=1+n,e),{});function pz(e){const t=et(e).slice(),n={};return t.length||le("Missing time unit."),t.forEach(i=>{nt(L3,i)?n[i]=1:le("Invalid time unit: ".concat(i,"."))}),(n[ar]||n[gi]?1:0)+(n[Is]||n[Ci]||n[Ds]?1:0)+(n[zu]?1:0)>1&&le("Incompatible time units: ".concat(e)),t.sort((i,s)=>L3[i]-L3[s]),t}const lQe={[Yr]:"%Y ",[Is]:"Q%q ",[Ci]:"%b ",[Ds]:"%d ",[ar]:"W%U ",[gi]:"%a ",[zu]:"%j ",[so]:"%H:00",[oo]:"00:%M",[zo]:":%S",[Ra]:".%L",["".concat(Yr,"-").concat(Ci)]:"%Y-%m ",["".concat(Yr,"-").concat(Ci,"-").concat(Ds)]:"%Y-%m-%d ",["".concat(so,"-").concat(oo)]:"%H:%M"};function vle(e,t){const n=yt({},lQe,t),r=pz(e),i=r.length;let s="",o=0,a,u;for(o=0;o<i;)for(a=r.length;a>o;--a)if(u=r.slice(o,a).join("-"),n[u]!=null){s+=n[u],o=a;break}return s.trim()}const Ed=new Date;function gz(e){return Ed.setFullYear(e),Ed.setMonth(0),Ed.setDate(1),Ed.setHours(0,0,0,0),Ed}function wle(e){return Cle(new Date(e))}function $le(e){return jM(new Date(e))}function Cle(e){return Ef.count(gz(e.getFullYear())-1,e)}function jM(e){return uy.count(gz(e.getFullYear())-1,e)}function WM(e){return gz(e).getDay()}function cQe(e,t,n,r,i,s,o){if(0<=e&&e<100){const a=new Date(-1,t,n,r,i,s,o);return a.setFullYear(e),a}return new Date(e,t,n,r,i,s,o)}function Sle(e){return Ele(new Date(e))}function kle(e){return VM(new Date(e))}function Ele(e){const t=Date.UTC(e.getUTCFullYear(),0,1);return _f.count(t-1,e)}function VM(e){const t=Date.UTC(e.getUTCFullYear(),0,1);return ly.count(t-1,e)}function GM(e){return Ed.setTime(Date.UTC(e,0,1)),Ed.getUTCDay()}function fQe(e,t,n,r,i,s,o){if(0<=e&&e<100){const a=new Date(Date.UTC(-1,t,n,r,i,s,o));return a.setUTCFullYear(n.y),a}return new Date(Date.UTC(e,t,n,r,i,s,o))}function _le(e,t,n,r,i){const s=t||1,o=Kt(e),a=(y,b,v)=>(v=v||y,hQe(n[v],r[v],y===o&&s,b)),u=new Date,l=cc(e),c=l[Yr]?a(Yr):Bo(2012),f=l[Ci]?a(Ci):l[Is]?a(Is):Qc,h=l[ar]&&l[gi]?a(gi,1,ar+gi):l[ar]?a(ar,1):l[gi]?a(gi,1):l[Ds]?a(Ds,1):l[zu]?a(zu,1):ty,d=l[so]?a(so):Qc,p=l[oo]?a(oo):Qc,g=l[zo]?a(zo):Qc,m=l[Ra]?a(Ra):Qc;return function(y){u.setTime(+y);const b=c(u);return i(b,f(u),h(u,b),d(u),p(u),g(u),m(u))}}function hQe(e,t,n,r){const i=n<=1?e:r?(s,o)=>r+n*Math.floor((e(s,o)-r)/n):(s,o)=>n*Math.floor(e(s,o)/n);return t?(s,o)=>t(i(s,o),o):i}function u0(e,t,n){return t+e*7-(n+6)%7}const dQe={[Yr]:e=>e.getFullYear(),[Is]:e=>Math.floor(e.getMonth()/3),[Ci]:e=>e.getMonth(),[Ds]:e=>e.getDate(),[so]:e=>e.getHours(),[oo]:e=>e.getMinutes(),[zo]:e=>e.getSeconds(),[Ra]:e=>e.getMilliseconds(),[zu]:e=>Cle(e),[ar]:e=>jM(e),[ar+gi]:(e,t)=>u0(jM(e),e.getDay(),WM(t)),[gi]:(e,t)=>u0(1,e.getDay(),WM(t))},pQe={[Is]:e=>3*e,[ar]:(e,t)=>u0(e,0,WM(t))};function Ale(e,t){return _le(e,t||1,dQe,pQe,cQe)}const gQe={[Yr]:e=>e.getUTCFullYear(),[Is]:e=>Math.floor(e.getUTCMonth()/3),[Ci]:e=>e.getUTCMonth(),[Ds]:e=>e.getUTCDate(),[so]:e=>e.getUTCHours(),[oo]:e=>e.getUTCMinutes(),[zo]:e=>e.getUTCSeconds(),[Ra]:e=>e.getUTCMilliseconds(),[zu]:e=>Ele(e),[ar]:e=>VM(e),[gi]:(e,t)=>u0(1,e.getUTCDay(),GM(t)),[ar+gi]:(e,t)=>u0(VM(e),e.getUTCDay(),GM(t))},mQe={[Is]:e=>3*e,[ar]:(e,t)=>u0(e,0,GM(t))};function Tle(e,t){return _le(e,t||1,gQe,mQe,fQe)}const yQe={[Yr]:Jf,[Is]:bE.every(3),[Ci]:bE,[ar]:uy,[Ds]:Ef,[gi]:Ef,[zu]:Ef,[so]:uz,[oo]:az,[zo]:of,[Ra]:sz},bQe={[Yr]:Qf,[Is]:vE.every(3),[Ci]:vE,[ar]:ly,[Ds]:_f,[gi]:_f,[zu]:_f,[so]:fz,[oo]:cz,[zo]:of,[Ra]:sz};function cy(e){return yQe[e]}function fy(e){return bQe[e]}function Ile(e,t,n){return e?e.offset(t,n):void 0}function Dle(e,t,n){return Ile(cy(e),t,n)}function Nle(e,t,n){return Ile(fy(e),t,n)}function Fle(e,t,n,r){return e?e.range(t,n,r):void 0}function Ole(e,t,n,r){return Fle(cy(e),t,n,r)}function Rle(e,t,n,r){return Fle(fy(e),t,n,r)}const Rb=1e3,Mb=Rb*60,Lb=Mb*60,lD=Lb*24,xQe=lD*7,XH=lD*30,HM=lD*365,Mle=[Yr,Ci,Ds,so,oo,zo,Ra],Pb=Mle.slice(0,-1),Bb=Pb.slice(0,-1),zb=Bb.slice(0,-1),vQe=zb.slice(0,-1),wQe=[Yr,ar],YH=[Yr,Ci],Lle=[Yr],eb=[[Pb,1,Rb],[Pb,5,5*Rb],[Pb,15,15*Rb],[Pb,30,30*Rb],[Bb,1,Mb],[Bb,5,5*Mb],[Bb,15,15*Mb],[Bb,30,30*Mb],[zb,1,Lb],[zb,3,3*Lb],[zb,6,6*Lb],[zb,12,12*Lb],[vQe,1,lD],[wQe,1,xQe],[YH,1,XH],[YH,3,3*XH],[Lle,1,HM]];function Ple(e){const t=e.extent,n=e.maxbins||40,r=Math.abs(XI(t))/n;let i=n$(a=>a[2]).right(eb,r),s,o;return i===eb.length?(s=Lle,o=Zf(t[0]/HM,t[1]/HM,n)):i?(i=eb[r/eb[i-1][2]<eb[i][2]/r?i-1:i],s=i[0],o=i[1]):(s=Mle,o=Math.max(Zf(t[0],t[1],n),1)),{units:s,step:o}}function $Qe(e){return t=>{const n=e.length;let r=1,i=String(e[0](t));for(;r<n;++r)i+="|"+e[r](t);return i}}function qM(e){return!e||!e.length?function(){return""}:e.length===1?e[0]:$Qe(e)}function Ble(e,t,n){return n||e+(t?"_"+t:"")}const P3=()=>{},CQe={init:P3,add:P3,rem:P3,idx:0},bv={values:{init:e=>e.cell.store=!0,value:e=>e.cell.data.values(),idx:-1},count:{value:e=>e.cell.num},__count__:{value:e=>e.missing+e.valid},missing:{value:e=>e.missing},valid:{value:e=>e.valid},sum:{init:e=>e.sum=0,value:e=>e.sum,add:(e,t)=>e.sum+=+t,rem:(e,t)=>e.sum-=t},product:{init:e=>e.product=1,value:e=>e.valid?e.product:void 0,add:(e,t)=>e.product*=t,rem:(e,t)=>e.product/=t},mean:{init:e=>e.mean=0,value:e=>e.valid?e.mean:void 0,add:(e,t)=>(e.mean_d=t-e.mean,e.mean+=e.mean_d/e.valid),rem:(e,t)=>(e.mean_d=t-e.mean,e.mean-=e.valid?e.mean_d/e.valid:e.mean)},average:{value:e=>e.valid?e.mean:void 0,req:["mean"],idx:1},variance:{init:e=>e.dev=0,value:e=>e.valid>1?e.dev/(e.valid-1):void 0,add:(e,t)=>e.dev+=e.mean_d*(t-e.mean),rem:(e,t)=>e.dev-=e.mean_d*(t-e.mean),req:["mean"],idx:1},variancep:{value:e=>e.valid>1?e.dev/e.valid:void 0,req:["variance"],idx:2},stdev:{value:e=>e.valid>1?Math.sqrt(e.dev/(e.valid-1)):void 0,req:["variance"],idx:2},stdevp:{value:e=>e.valid>1?Math.sqrt(e.dev/e.valid):void 0,req:["variance"],idx:2},stderr:{value:e=>e.valid>1?Math.sqrt(e.dev/(e.valid*(e.valid-1))):void 0,req:["variance"],idx:2},distinct:{value:e=>e.cell.data.distinct(e.get),req:["values"],idx:3},ci0:{value:e=>e.cell.data.ci0(e.get),req:["values"],idx:3},ci1:{value:e=>e.cell.data.ci1(e.get),req:["values"],idx:3},median:{value:e=>e.cell.data.q2(e.get),req:["values"],idx:3},q1:{value:e=>e.cell.data.q1(e.get),req:["values"],idx:3},q3:{value:e=>e.cell.data.q3(e.get),req:["values"],idx:3},min:{init:e=>e.min=void 0,value:e=>e.min=Number.isNaN(e.min)?e.cell.data.min(e.get):e.min,add:(e,t)=>{(t<e.min||e.min===void 0)&&(e.min=t)},rem:(e,t)=>{t<=e.min&&(e.min=NaN)},req:["values"],idx:4},max:{init:e=>e.max=void 0,value:e=>e.max=Number.isNaN(e.max)?e.cell.data.max(e.get):e.max,add:(e,t)=>{(t>e.max||e.max===void 0)&&(e.max=t)},rem:(e,t)=>{t>=e.max&&(e.max=NaN)},req:["values"],idx:4},argmin:{init:e=>e.argmin=void 0,value:e=>e.argmin||e.cell.data.argmin(e.get),add:(e,t,n)=>{t<e.min&&(e.argmin=n)},rem:(e,t)=>{t<=e.min&&(e.argmin=void 0)},req:["min","values"],idx:3},argmax:{init:e=>e.argmax=void 0,value:e=>e.argmax||e.cell.data.argmax(e.get),add:(e,t,n)=>{t>e.max&&(e.argmax=n)},rem:(e,t)=>{t>=e.max&&(e.argmax=void 0)},req:["max","values"],idx:3}},o$=Object.keys(bv);function SQe(e,t){return n=>yt({name:e,out:n||e},CQe,t)}o$.forEach(e=>{bv[e]=SQe(e,bv[e])});function zle(e,t){return bv[e](t)}function Ule(e,t){return e.idx-t.idx}function kQe(e){const t={};e.forEach(r=>t[r.name]=r);const n=r=>{r.req&&r.req.forEach(i=>{t[i]||n(t[i]=bv[i]())})};return e.forEach(n),Object.values(t).sort(Ule)}function EQe(){this.valid=0,this.missing=0,this._ops.forEach(e=>e.init(this))}function _Qe(e,t){if(e==null||e===""){++this.missing;return}e===e&&(++this.valid,this._ops.forEach(n=>n.add(this,e,t)))}function AQe(e,t){if(e==null||e===""){--this.missing;return}e===e&&(--this.valid,this._ops.forEach(n=>n.rem(this,e,t)))}function TQe(e){return this._out.forEach(t=>e[t.out]=t.value(this)),e}function jle(e,t){const n=t||Po,r=kQe(e),i=e.slice().sort(Ule);function s(o){this._ops=r,this._out=i,this.cell=o,this.init()}return s.prototype.init=EQe,s.prototype.add=_Qe,s.prototype.rem=AQe,s.prototype.set=TQe,s.prototype.get=n,s.fields=e.map(o=>o.out),s}function mz(e){this._key=e?Gf(e):Pe,this.reset()}const Qr=mz.prototype;Qr.reset=function(){this._add=[],this._rem=[],this._ext=null,this._get=null,this._q=null};Qr.add=function(e){this._add.push(e)};Qr.rem=function(e){this._rem.push(e)};Qr.values=function(){if(this._get=null,this._rem.length===0)return this._add;const e=this._add,t=this._rem,n=this._key,r=e.length,i=t.length,s=Array(r-i),o={};let a,u,l;for(a=0;a<i;++a)o[n(t[a])]=1;for(a=0,u=0;a<r;++a)o[n(l=e[a])]?o[n(l)]=0:s[u++]=l;return this._rem=[],this._add=s};Qr.distinct=function(e){const t=this.values(),n={};let r=t.length,i=0,s;for(;--r>=0;)s=e(t[r])+"",nt(n,s)||(n[s]=1,++i);return i};Qr.extent=function(e){if(this._get!==e||!this._ext){const t=this.values(),n=Hae(t,e);this._ext=[t[n[0]],t[n[1]]],this._get=e}return this._ext};Qr.argmin=function(e){return this.extent(e)[0]||{}};Qr.argmax=function(e){return this.extent(e)[1]||{}};Qr.min=function(e){const t=this.extent(e)[0];return t!=null?e(t):void 0};Qr.max=function(e){const t=this.extent(e)[1];return t!=null?e(t):void 0};Qr.quartile=function(e){return(this._get!==e||!this._q)&&(this._q=V6(this.values(),e),this._get=e),this._q};Qr.q1=function(e){return this.quartile(e)[0]};Qr.q2=function(e){return this.quartile(e)[1]};Qr.q3=function(e){return this.quartile(e)[2]};Qr.ci=function(e){return(this._get!==e||!this._ci)&&(this._ci=Que(this.values(),1e3,.05,e),this._get=e),this._ci};Qr.ci0=function(e){return this.ci(e)[0]};Qr.ci1=function(e){return this.ci(e)[1]};function eh(e){re.call(this,null,e),this._adds=[],this._mods=[],this._alen=0,this._mlen=0,this._drop=!0,this._cross=!1,this._dims=[],this._dnames=[],this._measures=[],this._countOnly=!1,this._counts=null,this._prev=null,this._inputs=null,this._outputs=null}eh.Definition={type:"Aggregate",metadata:{generates:!0,changes:!0},params:[{name:"groupby",type:"field",array:!0},{name:"ops",type:"enum",array:!0,values:o$},{name:"fields",type:"field",null:!0,array:!0},{name:"as",type:"string",null:!0,array:!0},{name:"drop",type:"boolean",default:!0},{name:"cross",type:"boolean",default:!1},{name:"key",type:"field"}]};$e(eh,re,{transform(e,t){const n=this,r=t.fork(t.NO_SOURCE|t.NO_FIELDS),i=e.modified();return n.stamp=r.stamp,n.value&&(i||t.modified(n._inputs,!0))?(n._prev=n.value,n.value=i?n.init(e):{},t.visit(t.SOURCE,s=>n.add(s))):(n.value=n.value||n.init(e),t.visit(t.REM,s=>n.rem(s)),t.visit(t.ADD,s=>n.add(s))),r.modifies(n._outputs),n._drop=e.drop!==!1,e.cross&&n._dims.length>1&&(n._drop=!1,n.cross()),t.clean()&&n._drop&&r.clean(!0).runAfter(()=>this.clean()),n.changes(r)},cross(){const e=this,t=e.value,n=e._dnames,r=n.map(()=>({})),i=n.length;function s(a){let u,l,c,f;for(u in a)for(c=a[u].tuple,l=0;l<i;++l)r[l][f=c[n[l]]]=f}s(e._prev),s(t);function o(a,u,l){const c=n[l],f=r[l++];for(const h in f){const d=a?a+"|"+h:h;u[c]=f[h],l<i?o(d,u,l):t[d]||e.cell(d,u)}}o("",{},0)},init(e){const t=this._inputs=[],n=this._outputs=[],r={};function i(m){const y=et(wi(m)),b=y.length;let v=0,x;for(;v<b;++v)r[x=y[v]]||(r[x]=1,t.push(x))}this._dims=et(e.groupby),this._dnames=this._dims.map(m=>{const y=Nn(m);return i(m),n.push(y),y}),this.cellkey=e.key?e.key:qM(this._dims),this._countOnly=!0,this._counts=[],this._measures=[];const s=e.fields||[null],o=e.ops||["count"],a=e.as||[],u=s.length,l={};let c,f,h,d,p,g;for(u!==o.length&&le("Unmatched number of fields and aggregate ops."),g=0;g<u;++g){if(c=s[g],f=o[g],c==null&&f!=="count"&&le("Null aggregate field specified."),d=Nn(c),p=Ble(f,d,a[g]),n.push(p),f==="count"){this._counts.push(p);continue}h=l[d],h||(i(c),h=l[d]=[],h.field=c,this._measures.push(h)),f!=="count"&&(this._countOnly=!1),h.push(zle(f,p))}return this._measures=this._measures.map(m=>jle(m,m.field)),{}},cellkey:qM(),cell(e,t){let n=this.value[e];return n?n.num===0&&this._drop&&n.stamp<this.stamp?(n.stamp=this.stamp,this._adds[this._alen++]=n):n.stamp<this.stamp&&(n.stamp=this.stamp,this._mods[this._mlen++]=n):(n=this.value[e]=this.newcell(e,t),this._adds[this._alen++]=n),n},newcell(e,t){const n={key:e,num:0,agg:null,tuple:this.newtuple(t,this._prev&&this._prev[e]),stamp:this.stamp,store:!1};if(!this._countOnly){const r=this._measures,i=r.length;n.agg=Array(i);for(let s=0;s<i;++s)n.agg[s]=new r[s](n)}return n.store&&(n.data=new mz),n},newtuple(e,t){const n=this._dnames,r=this._dims,i=r.length,s={};for(let o=0;o<i;++o)s[n[o]]=r[o](e);return t?Lue(t.tuple,s):Ot(s)},clean(){const e=this.value;for(const t in e)e[t].num===0&&delete e[t]},add(e){const t=this.cellkey(e),n=this.cell(t,e);if(n.num+=1,this._countOnly)return;n.store&&n.data.add(e);const r=n.agg;for(let i=0,s=r.length;i<s;++i)r[i].add(r[i].get(e),e)},rem(e){const t=this.cellkey(e),n=this.cell(t,e);if(n.num-=1,this._countOnly)return;n.store&&n.data.rem(e);const r=n.agg;for(let i=0,s=r.length;i<s;++i)r[i].rem(r[i].get(e),e)},celltuple(e){const t=e.tuple,n=this._counts;e.store&&e.data.values();for(let r=0,i=n.length;r<i;++r)t[n[r]]=e.num;if(!this._countOnly){const r=e.agg;for(let i=0,s=r.length;i<s;++i)r[i].set(t)}return t},changes(e){const t=this._adds,n=this._mods,r=this._prev,i=this._drop,s=e.add,o=e.rem,a=e.mod;let u,l,c,f;if(r)for(l in r)u=r[l],(!i||u.num)&&o.push(u.tuple);for(c=0,f=this._alen;c<f;++c)s.push(this.celltuple(t[c])),t[c]=null;for(c=0,f=this._mlen;c<f;++c)u=n[c],(u.num===0&&i?o:a).push(this.celltuple(u)),n[c]=null;return this._alen=this._mlen=0,this._prev=null,e}});const IQe=1e-14;function yz(e){re.call(this,null,e)}yz.Definition={type:"Bin",metadata:{modifies:!0},params:[{name:"field",type:"field",required:!0},{name:"interval",type:"boolean",default:!0},{name:"anchor",type:"number"},{name:"maxbins",type:"number",default:20},{name:"base",type:"number",default:10},{name:"divide",type:"number",array:!0,default:[5,2]},{name:"extent",type:"number",array:!0,length:2,required:!0},{name:"span",type:"number"},{name:"step",type:"number"},{name:"steps",type:"number",array:!0},{name:"minstep",type:"number",default:0},{name:"nice",type:"boolean",default:!0},{name:"name",type:"string"},{name:"as",type:"string",array:!0,length:2,default:["bin0","bin1"]}]};$e(yz,re,{transform(e,t){const n=e.interval!==!1,r=this._bins(e),i=r.start,s=r.step,o=e.as||["bin0","bin1"],a=o[0],u=o[1];let l;return e.modified()?(t=t.reflow(!0),l=t.SOURCE):l=t.modified(wi(e.field))?t.ADD_MOD:t.ADD,t.visit(l,n?c=>{const f=r(c);c[a]=f,c[u]=f==null?null:i+s*(1+(f-i)/s)}:c=>c[a]=r(c)),t.modifies(n?o:a)},_bins(e){if(this.value&&!e.modified())return this.value;const t=e.field,n=Jue(e),r=n.step;let i=n.start,s=i+Math.ceil((n.stop-i)/r)*r,o,a;(o=e.anchor)!=null&&(a=o-(i+r*Math.floor((o-i)/r)),i+=a,s+=a);const u=function(l){let c=Hf(t(l));return c==null?null:c<i?-1/0:c>s?1/0:(c=Math.max(i,Math.min(c,s-r)),i+r*Math.floor(IQe+(c-i)/r))};return u.start=i,u.stop=n.stop,u.step=r,this.value=Yo(u,wi(t),e.name||"bin_"+Nn(t))}});function Wle(e,t,n){const r=e;let i=t||[],s=n||[],o={},a=0;return{add:u=>s.push(u),remove:u=>o[r(u)]=++a,size:()=>i.length,data:(u,l)=>(a&&(i=i.filter(c=>!o[r(c)]),o={},a=0),l&&u&&i.sort(u),s.length&&(i=u?Zae(u,i,s.sort(u)):i.concat(s),s=[]),i)}}function bz(e){re.call(this,[],e)}bz.Definition={type:"Collect",metadata:{source:!0},params:[{name:"sort",type:"compare"}]};$e(bz,re,{transform(e,t){const n=t.fork(t.ALL),r=Wle(Pe,this.value,n.materialize(n.ADD).add),i=e.sort,s=t.changed()||i&&(e.modified("sort")||t.modified(i.fields));return n.visit(n.REM,r.remove),this.modified(s),this.value=n.source=r.data(bg(i),s),t.source&&t.source.root&&(this.value.root=t.source.root),n}});function Vle(e){en.call(this,null,DQe,e)}$e(Vle,en);function DQe(e){return this.value&&!e.modified()?this.value:Vae(e.fields,e.orders)}function xz(e){re.call(this,null,e)}xz.Definition={type:"CountPattern",metadata:{generates:!0,changes:!0},params:[{name:"field",type:"field",required:!0},{name:"case",type:"enum",values:["upper","lower","mixed"],default:"mixed"},{name:"pattern",type:"string",default:'[\\w"]+'},{name:"stopwords",type:"string",default:""},{name:"as",type:"string",array:!0,length:2,default:["text","count"]}]};function NQe(e,t,n){switch(t){case"upper":e=e.toUpperCase();break;case"lower":e=e.toLowerCase();break}return e.match(n)}$e(xz,re,{transform(e,t){const n=f=>h=>{for(var d=NQe(a(h),e.case,s)||[],p,g=0,m=d.length;g<m;++g)o.test(p=d[g])||f(p)},r=this._parameterCheck(e,t),i=this._counts,s=this._match,o=this._stop,a=e.field,u=e.as||["text","count"],l=n(f=>i[f]=1+(i[f]||0)),c=n(f=>i[f]-=1);return r?t.visit(t.SOURCE,l):(t.visit(t.ADD,l),t.visit(t.REM,c)),this._finish(t,u)},_parameterCheck(e,t){let n=!1;return(e.modified("stopwords")||!this._stop)&&(this._stop=new RegExp("^"+(e.stopwords||"")+"$","i"),n=!0),(e.modified("pattern")||!this._match)&&(this._match=new RegExp(e.pattern||"[\\w']+","g"),n=!0),(e.modified("field")||t.modified(e.field.fields))&&(n=!0),n&&(this._counts={}),n},_finish(e,t){const n=this._counts,r=this._tuples||(this._tuples={}),i=t[0],s=t[1],o=e.fork(e.NO_SOURCE|e.NO_FIELDS);let a,u,l;for(a in n)u=r[a],l=n[a]||0,!u&&l?(r[a]=u=Ot({}),u[i]=a,u[s]=l,o.add.push(u)):l===0?(u&&o.rem.push(u),n[a]=null,r[a]=null):u[s]!==l&&(u[s]=l,o.mod.push(u));return o.modifies(t)}});function vz(e){re.call(this,null,e)}vz.Definition={type:"Cross",metadata:{generates:!0},params:[{name:"filter",type:"expr"},{name:"as",type:"string",array:!0,length:2,default:["a","b"]}]};$e(vz,re,{transform(e,t){const n=t.fork(t.NO_SOURCE),r=e.as||["a","b"],i=r[0],s=r[1],o=!this.value||t.changed(t.ADD_REM)||e.modified("as")||e.modified("filter");let a=this.value;return o?(a&&(n.rem=a),a=t.materialize(t.SOURCE).source,n.add=this.value=FQe(a,i,s,e.filter||ny)):n.mod=a,n.source=this.value,n.modifies(r)}});function FQe(e,t,n,r){for(var i=[],s={},o=e.length,a=0,u,l;a<o;++a)for(s[t]=l=e[a],u=0;u<o;++u)s[n]=e[u],r(s)&&(i.push(Ot(s)),s={},s[t]=l);return i}const KH={kde:X6,mixture:rle,normal:q6,lognormal:nle,uniform:ile},OQe="distributions",ZH="function",RQe="field";function Gle(e,t){const n=e[ZH];nt(KH,n)||le("Unknown distribution function: "+n);const r=KH[n]();for(const i in e)i===RQe?r.data((e.from||t()).map(e[i])):i===OQe?r[i](e[i].map(s=>Gle(s,t))):typeof r[i]===ZH&&r[i](e[i]);return r}function wz(e){re.call(this,null,e)}const Hle=[{key:{function:"normal"},params:[{name:"mean",type:"number",default:0},{name:"stdev",type:"number",default:1}]},{key:{function:"lognormal"},params:[{name:"mean",type:"number",default:0},{name:"stdev",type:"number",default:1}]},{key:{function:"uniform"},params:[{name:"min",type:"number",default:0},{name:"max",type:"number",default:1}]},{key:{function:"kde"},params:[{name:"field",type:"field",required:!0},{name:"from",type:"data"},{name:"bandwidth",type:"number",default:0}]}],MQe={key:{function:"mixture"},params:[{name:"distributions",type:"param",array:!0,params:Hle},{name:"weights",type:"number",array:!0}]};wz.Definition={type:"Density",metadata:{generates:!0},params:[{name:"extent",type:"number",array:!0,length:2},{name:"steps",type:"number"},{name:"minsteps",type:"number",default:25},{name:"maxsteps",type:"number",default:200},{name:"method",type:"string",default:"pdf",values:["pdf","cdf"]},{name:"distribution",type:"param",params:Hle.concat(MQe)},{name:"as",type:"string",array:!0,default:["value","density"]}]};$e(wz,re,{transform(e,t){const n=t.fork(t.NO_SOURCE|t.NO_FIELDS);if(!this.value||t.changed()||e.modified()){const r=Gle(e.distribution,LQe(t)),i=e.steps||e.minsteps||25,s=e.steps||e.maxsteps||200;let o=e.method||"pdf";o!=="pdf"&&o!=="cdf"&&le("Invalid density method: "+o),!e.extent&&!r.data&&le("Missing density extent parameter."),o=r[o];const a=e.as||["value","density"],u=e.extent||qf(r.data()),l=uD(o,u,i,s).map(c=>{const f={};return f[a[0]]=c[0],f[a[1]]=c[1],Ot(f)});this.value&&(n.rem=this.value),this.value=n.add=n.source=l}return n}});function LQe(e){return()=>e.materialize(e.SOURCE).source}function qle(e,t){return e?e.map((n,r)=>t[r]||Nn(n)):null}function $z(e,t,n){const r=[],i=f=>f(u);let s,o,a,u,l,c;if(t==null)r.push(e.map(n));else for(s={},o=0,a=e.length;o<a;++o)u=e[o],l=t.map(i),c=s[l],c||(s[l]=c=[],c.dims=l,r.push(c)),c.push(n(u));return r}const Xle="bin";function Cz(e){re.call(this,null,e)}Cz.Definition={type:"DotBin",metadata:{modifies:!0},params:[{name:"field",type:"field",required:!0},{name:"groupby",type:"field",array:!0},{name:"step",type:"number"},{name:"smooth",type:"boolean",default:!1},{name:"as",type:"string",default:Xle}]};const PQe=(e,t)=>XI(qf(e,t))/30;$e(Cz,re,{transform(e,t){if(this.value&&!(e.modified()||t.changed()))return t;const n=t.materialize(t.SOURCE).source,r=$z(t.source,e.groupby,Po),i=e.smooth||!1,s=e.field,o=e.step||PQe(n,s),a=bg((p,g)=>s(p)-s(g)),u=e.as||Xle,l=r.length;let c=1/0,f=-1/0,h=0,d;for(;h<l;++h){const p=r[h].sort(a);d=-1;for(const g of ele(p,o,i,s))g<c&&(c=g),g>f&&(f=g),p[++d][u]=g}return this.value={start:c,stop:f,step:o},t.reflow(!0).modifies(u)}});function Yle(e){en.call(this,null,BQe,e),this.modified(!0)}$e(Yle,en);function BQe(e){const t=e.expr;return this.value&&!e.modified("expr")?this.value:Yo(n=>t(n,e),wi(t),Nn(t))}function Sz(e){re.call(this,[void 0,void 0],e)}Sz.Definition={type:"Extent",metadata:{},params:[{name:"field",type:"field",required:!0}]};$e(Sz,re,{transform(e,t){const n=this.value,r=e.field,i=t.changed()||t.modified(r.fields)||e.modified("field");let s=n[0],o=n[1];if((i||s==null)&&(s=1/0,o=-1/0),t.visit(i?t.SOURCE:t.ADD,a=>{const u=Hf(r(a));u!=null&&(u<s&&(s=u),u>o&&(o=u))}),!Number.isFinite(s)||!Number.isFinite(o)){let a=Nn(r);a&&(a=` for field "${a}"`),t.dataflow.warn(`Infinite extent${a}: [${s}, ${o}]`),s=o=void 0}this.value=[s,o]}});function kz(e,t){en.call(this,e),this.parent=t,this.count=0}$e(kz,en,{connect(e){return this.detachSubflow=e.detachSubflow,this.targets().add(e),e.source=this},add(e){this.count+=1,this.value.add.push(e)},rem(e){this.count-=1,this.value.rem.push(e)},mod(e){this.value.mod.push(e)},init(e){this.value.init(e,e.NO_SOURCE)},evaluate(){return this.value}});function cD(e){re.call(this,{},e),this._keys=ry();const t=this._targets=[];t.active=0,t.forEach=n=>{for(let r=0,i=t.active;r<i;++r)n(t[r],r,t)}}$e(cD,re,{activate(e){this._targets[this._targets.active++]=e},subflow(e,t,n,r){const i=this.value;let s=nt(i,e)&&i[e],o,a;return s?s.value.stamp<n.stamp&&(s.init(n),this.activate(s)):(a=r||(a=this._group[e])&&a.tuple,o=n.dataflow,s=new kz(n.fork(n.NO_SOURCE),this),o.add(s).connect(t(o,e,a)),i[e]=s,this.activate(s)),s},clean(){const e=this.value;let t=0;for(const n in e)if(e[n].count===0){const r=e[n].detachSubflow;r&&r(),delete e[n],++t}if(t){const n=this._targets.filter(r=>r&&r.count>0);this.initTargets(n)}},initTargets(e){const t=this._targets,n=t.length,r=e?e.length:0;let i=0;for(;i<r;++i)t[i]=e[i];for(;i<n&&t[i]!=null;++i)t[i]=null;t.active=r},transform(e,t){const n=t.dataflow,r=e.key,i=e.subflow,s=this._keys,o=e.modified("key"),a=u=>this.subflow(u,i,t);return this._group=e.group||{},this.initTargets(),t.visit(t.REM,u=>{const l=Pe(u),c=s.get(l);c!==void 0&&(s.delete(l),a(c).rem(u))}),t.visit(t.ADD,u=>{const l=r(u);s.set(Pe(u),l),a(l).add(u)}),o||t.modified(r.fields)?t.visit(t.MOD,u=>{const l=Pe(u),c=s.get(l),f=r(u);c===f?a(f).mod(u):(s.set(l,f),a(c).rem(u),a(f).add(u))}):t.changed(t.MOD)&&t.visit(t.MOD,u=>{a(s.get(Pe(u))).mod(u)}),o&&t.visit(t.REFLOW,u=>{const l=Pe(u),c=s.get(l),f=r(u);c!==f&&(s.set(l,f),a(c).rem(u),a(f).add(u))}),t.clean()?n.runAfter(()=>{this.clean(),s.clean()}):s.empty>n.cleanThreshold&&n.runAfter(s.clean),t}});function Kle(e){en.call(this,null,zQe,e)}$e(Kle,en);function zQe(e){return this.value&&!e.modified()?this.value:it(e.name)?et(e.name).map(t=>Gf(t)):Gf(e.name,e.as)}function Ez(e){re.call(this,ry(),e)}Ez.Definition={type:"Filter",metadata:{changes:!0},params:[{name:"expr",type:"expr",required:!0}]};$e(Ez,re,{transform(e,t){const n=t.dataflow,r=this.value,i=t.fork(),s=i.add,o=i.rem,a=i.mod,u=e.expr;let l=!0;t.visit(t.REM,f=>{const h=Pe(f);r.has(h)?r.delete(h):o.push(f)}),t.visit(t.ADD,f=>{u(f,e)?s.push(f):r.set(Pe(f),1)});function c(f){const h=Pe(f),d=u(f,e),p=r.get(h);d&&p?(r.delete(h),s.push(f)):!d&&!p?(r.set(h,1),o.push(f)):l&&d&&!p&&a.push(f)}return t.visit(t.MOD,c),e.modified()&&(l=!1,t.visit(t.REFLOW,c)),r.empty>n.cleanThreshold&&n.runAfter(r.clean),i}});function _z(e){re.call(this,[],e)}_z.Definition={type:"Flatten",metadata:{generates:!0},params:[{name:"fields",type:"field",array:!0,required:!0},{name:"index",type:"string"},{name:"as",type:"string",array:!0}]};$e(_z,re,{transform(e,t){const n=t.fork(t.NO_SOURCE),r=e.fields,i=qle(r,e.as||[]),s=e.index||null,o=i.length;return n.rem=this.value,t.visit(t.SOURCE,a=>{const u=r.map(p=>p(a)),l=u.reduce((p,g)=>Math.max(p,g.length),0);let c=0,f,h,d;for(;c<l;++c){for(h=z6(a),f=0;f<o;++f)h[i[f]]=(d=u[f][c])==null?null:d;s&&(h[s]=c),n.add.push(h)}}),this.value=n.source=n.add,s&&n.modifies(s),n.modifies(i)}});function Az(e){re.call(this,[],e)}Az.Definition={type:"Fold",metadata:{generates:!0},params:[{name:"fields",type:"field",array:!0,required:!0},{name:"as",type:"string",array:!0,length:2,default:["key","value"]}]};$e(Az,re,{transform(e,t){const n=t.fork(t.NO_SOURCE),r=e.fields,i=r.map(Nn),s=e.as||["key","value"],o=s[0],a=s[1],u=r.length;return n.rem=this.value,t.visit(t.SOURCE,l=>{for(let c=0,f;c<u;++c)f=z6(l),f[o]=i[c],f[a]=r[c](l),n.add.push(f)}),this.value=n.source=n.add,n.modifies(s)}});function Tz(e){re.call(this,null,e)}Tz.Definition={type:"Formula",metadata:{modifies:!0},params:[{name:"expr",type:"expr",required:!0},{name:"as",type:"string",required:!0},{name:"initonly",type:"boolean"}]};$e(Tz,re,{transform(e,t){const n=e.expr,r=e.as,i=e.modified(),s=e.initonly?t.ADD:i?t.SOURCE:t.modified(n.fields)||t.modified(r)?t.ADD_MOD:t.ADD;return i&&(t=t.materialize().reflow(!0)),e.initonly||t.modifies(r),t.visit(s,o=>o[r]=n(o,e))}});function Zle(e){re.call(this,[],e)}$e(Zle,re,{transform(e,t){const n=t.fork(t.ALL),r=e.generator;let i=this.value,s=e.size-i.length,o,a,u;if(s>0){for(o=[];--s>=0;)o.push(u=Ot(r(e))),i.push(u);n.add=n.add.length?n.materialize(n.ADD).add.concat(o):o}else a=i.slice(0,-s),n.rem=n.rem.length?n.materialize(n.REM).rem.concat(a):a,i=i.slice(-s);return n.source=this.value=i,n}});const XC={value:"value",median:Xue,mean:RJe,min:zM,max:tp},UQe=[];function Iz(e){re.call(this,[],e)}Iz.Definition={type:"Impute",metadata:{changes:!0},params:[{name:"field",type:"field",required:!0},{name:"key",type:"field",required:!0},{name:"keyvals",array:!0},{name:"groupby",type:"field",array:!0},{name:"method",type:"enum",default:"value",values:["value","mean","median","max","min"]},{name:"value",default:0}]};function jQe(e){var t=e.method||XC.value,n;if(XC[t]==null)le("Unrecognized imputation method: "+t);else return t===XC.value?(n=e.value!==void 0?e.value:0,()=>n):XC[t]}function WQe(e){const t=e.field;return n=>n?t(n):NaN}$e(Iz,re,{transform(e,t){var n=t.fork(t.ALL),r=jQe(e),i=WQe(e),s=Nn(e.field),o=Nn(e.key),a=(e.groupby||[]).map(Nn),u=VQe(t.source,e.groupby,e.key,e.keyvals),l=[],c=this.value,f=u.domain.length,h,d,p,g,m,y,b,v,x,w;for(m=0,v=u.length;m<v;++m)for(h=u[m],p=h.values,d=NaN,b=0;b<f;++b)if(h[b]==null){for(g=u.domain[b],w={_impute:!0},y=0,x=p.length;y<x;++y)w[a[y]]=p[y];w[o]=g,w[s]=Number.isNaN(d)?d=r(h,i):d,l.push(Ot(w))}return l.length&&(n.add=n.materialize(n.ADD).add.concat(l)),c.length&&(n.rem=n.materialize(n.REM).rem.concat(c)),this.value=l,n}});function VQe(e,t,n,r){var i=y=>y(m),s=[],o=r?r.slice():[],a={},u={},l,c,f,h,d,p,g,m;for(o.forEach((y,b)=>a[y]=b+1),h=0,g=e.length;h<g;++h)m=e[h],p=n(m),d=a[p]||(a[p]=o.push(p)),c=(l=t?t.map(i):UQe)+"",(f=u[c])||(f=u[c]=[],s.push(f),f.values=l),f[d-1]=m;return s.domain=o,s}function Dz(e){eh.call(this,e)}Dz.Definition={type:"JoinAggregate",metadata:{modifies:!0},params:[{name:"groupby",type:"field",array:!0},{name:"fields",type:"field",null:!0,array:!0},{name:"ops",type:"enum",array:!0,values:o$},{name:"as",type:"string",null:!0,array:!0},{name:"key",type:"field"}]};$e(Dz,eh,{transform(e,t){const n=this,r=e.modified();let i;return n.value&&(r||t.modified(n._inputs,!0))?(i=n.value=r?n.init(e):{},t.visit(t.SOURCE,s=>n.add(s))):(i=n.value=n.value||this.init(e),t.visit(t.REM,s=>n.rem(s)),t.visit(t.ADD,s=>n.add(s))),n.changes(),t.visit(t.SOURCE,s=>{yt(s,i[n.cellkey(s)].tuple)}),t.reflow(r).modifies(this._outputs)},changes(){const e=this._adds,t=this._mods;let n,r;for(n=0,r=this._alen;n<r;++n)this.celltuple(e[n]),e[n]=null;for(n=0,r=this._mlen;n<r;++n)this.celltuple(t[n]),t[n]=null;this._alen=this._mlen=0}});function Nz(e){re.call(this,null,e)}Nz.Definition={type:"KDE",metadata:{generates:!0},params:[{name:"groupby",type:"field",array:!0},{name:"field",type:"field",required:!0},{name:"cumulative",type:"boolean",default:!1},{name:"counts",type:"boolean",default:!1},{name:"bandwidth",type:"number",default:0},{name:"extent",type:"number",array:!0,length:2},{name:"resolve",type:"enum",values:["shared","independent"],default:"independent"},{name:"steps",type:"number"},{name:"minsteps",type:"number",default:25},{name:"maxsteps",type:"number",default:200},{name:"as",type:"string",array:!0,default:["value","density"]}]};$e(Nz,re,{transform(e,t){const n=t.fork(t.NO_SOURCE|t.NO_FIELDS);if(!this.value||t.changed()||e.modified()){const r=t.materialize(t.SOURCE).source,i=$z(r,e.groupby,e.field),s=(e.groupby||[]).map(Nn),o=e.bandwidth,a=e.cumulative?"cdf":"pdf",u=e.as||["value","density"],l=[];let c=e.extent,f=e.steps||e.minsteps||25,h=e.steps||e.maxsteps||200;a!=="pdf"&&a!=="cdf"&&le("Invalid density method: "+a),e.resolve==="shared"&&(c||(c=qf(r,e.field)),f=h=e.steps||h),i.forEach(d=>{const p=X6(d,o)[a],g=e.counts?d.length:1,m=c||qf(d);uD(p,m,f,h).forEach(y=>{const b={};for(let v=0;v<s.length;++v)b[s[v]]=d.dims[v];b[u[0]]=y[0],b[u[1]]=y[1]*g,l.push(Ot(b))})}),this.value&&(n.rem=this.value),this.value=n.add=n.source=l}return n}});function Jle(e){en.call(this,null,GQe,e)}$e(Jle,en);function GQe(e){return this.value&&!e.modified()?this.value:Yae(e.fields,e.flat)}function Qle(e){re.call(this,[],e),this._pending=null}$e(Qle,re,{transform(e,t){const n=t.dataflow;return this._pending?B3(this,t,this._pending):HQe(e)?t.StopPropagation:e.values?B3(this,t,n.parse(e.values,e.format)):e.async?{async:n.request(e.url,e.format).then(i=>(this._pending=et(i.data),s=>s.touch(this)))}:n.request(e.url,e.format).then(r=>B3(this,t,et(r.data)))}});function HQe(e){return e.modified("async")&&!(e.modified("values")||e.modified("url")||e.modified("format"))}function B3(e,t,n){n.forEach(Ot);const r=t.fork(t.NO_FIELDS&t.NO_SOURCE);return r.rem=e.value,e.value=r.source=r.add=n,e._pending=null,r.rem.length&&r.clean(!0),r}function Fz(e){re.call(this,{},e)}Fz.Definition={type:"Lookup",metadata:{modifies:!0},params:[{name:"index",type:"index",params:[{name:"from",type:"data",required:!0},{name:"key",type:"field",required:!0}]},{name:"values",type:"field",array:!0},{name:"fields",type:"field",array:!0,required:!0},{name:"as",type:"string",array:!0},{name:"default",default:null}]};$e(Fz,re,{transform(e,t){const n=e.fields,r=e.index,i=e.values,s=e.default==null?null:e.default,o=e.modified(),a=n.length;let u=o?t.SOURCE:t.ADD,l=t,c=e.as,f,h,d;return i?(h=i.length,a>1&&!c&&le('Multi-field lookup requires explicit "as" parameter.'),c&&c.length!==a*h&&le('The "as" parameter has too few output field names.'),c=c||i.map(Nn),f=function(p){for(var g=0,m=0,y,b;g<a;++g)if(b=r.get(n[g](p)),b==null)for(y=0;y<h;++y,++m)p[c[m]]=s;else for(y=0;y<h;++y,++m)p[c[m]]=i[y](b)}):(c||le("Missing output field names."),f=function(p){for(var g=0,m;g<a;++g)m=r.get(n[g](p)),p[c[g]]=m??s}),o?l=t.reflow(!0):(d=n.some(p=>t.modified(p.fields)),u|=d?t.MOD:0),t.visit(u,f),l.modifies(c)}});function ece(e){en.call(this,null,qQe,e)}$e(ece,en);function qQe(e){if(this.value&&!e.modified())return this.value;const t=e.extents,n=t.length;let r=1/0,i=-1/0,s,o;for(s=0;s<n;++s)o=t[s],o[0]<r&&(r=o[0]),o[1]>i&&(i=o[1]);return[r,i]}function tce(e){en.call(this,null,XQe,e)}$e(tce,en);function XQe(e){return this.value&&!e.modified()?this.value:e.values.reduce((t,n)=>t.concat(n),[])}function nce(e){re.call(this,null,e)}$e(nce,re,{transform(e,t){return this.modified(e.modified()),this.value=e,t.fork(t.NO_SOURCE|t.NO_FIELDS)}});function Oz(e){eh.call(this,e)}Oz.Definition={type:"Pivot",metadata:{generates:!0,changes:!0},params:[{name:"groupby",type:"field",array:!0},{name:"field",type:"field",required:!0},{name:"value",type:"field",required:!0},{name:"op",type:"enum",values:o$,default:"sum"},{name:"limit",type:"number",default:0},{name:"key",type:"field"}]};$e(Oz,eh,{_transform:eh.prototype.transform,transform(e,t){return this._transform(YQe(e,t),t)}});function YQe(e,t){const n=e.field,r=e.value,i=(e.op==="count"?"__count__":e.op)||"sum",s=wi(n).concat(wi(r)),o=ZQe(n,e.limit||0,t);return t.changed()&&e.set("__pivot__",null,null,!0),{key:e.key,groupby:e.groupby,ops:o.map(()=>i),fields:o.map(a=>KQe(a,n,r,s)),as:o.map(a=>a+""),modified:e.modified.bind(e)}}function KQe(e,t,n,r){return Yo(i=>t(i)===e?n(i):NaN,r,e+"")}function ZQe(e,t,n){const r={},i=[];return n.visit(n.SOURCE,s=>{const o=e(s);r[o]||(r[o]=1,i.push(o))}),i.sort(HI),t?i.slice(0,t):i}function rce(e){cD.call(this,e)}$e(rce,cD,{transform(e,t){const n=e.subflow,r=e.field,i=s=>this.subflow(Pe(s),n,t,s);return(e.modified("field")||r&&t.modified(wi(r)))&&le("PreFacet does not support field modification."),this.initTargets(),r?(t.visit(t.MOD,s=>{const o=i(s);r(s).forEach(a=>o.mod(a))}),t.visit(t.ADD,s=>{const o=i(s);r(s).forEach(a=>o.add(Ot(a)))}),t.visit(t.REM,s=>{const o=i(s);r(s).forEach(a=>o.rem(a))})):(t.visit(t.MOD,s=>i(s).mod(s)),t.visit(t.ADD,s=>i(s).add(s)),t.visit(t.REM,s=>i(s).rem(s))),t.clean()&&t.runAfter(()=>this.clean()),t}});function Rz(e){re.call(this,null,e)}Rz.Definition={type:"Project",metadata:{generates:!0,changes:!0},params:[{name:"fields",type:"field",array:!0},{name:"as",type:"string",null:!0,array:!0}]};$e(Rz,re,{transform(e,t){const n=t.fork(t.NO_SOURCE),r=e.fields,i=qle(e.fields,e.as||[]),s=r?(a,u)=>JQe(a,u,r,i):tD;let o;return this.value?o=this.value:(t=t.addAll(),o=this.value={}),t.visit(t.REM,a=>{const u=Pe(a);n.rem.push(o[u]),o[u]=null}),t.visit(t.ADD,a=>{const u=s(a,Ot({}));o[Pe(a)]=u,n.add.push(u)}),t.visit(t.MOD,a=>{n.mod.push(s(a,o[Pe(a)]))}),n}});function JQe(e,t,n,r){for(let i=0,s=n.length;i<s;++i)t[r[i]]=n[i](e);return t}function ice(e){re.call(this,null,e)}$e(ice,re,{transform(e,t){return this.value=e.value,e.modified("value")?t.fork(t.NO_SOURCE|t.NO_FIELDS):t.StopPropagation}});function Mz(e){re.call(this,null,e)}Mz.Definition={type:"Quantile",metadata:{generates:!0,changes:!0},params:[{name:"groupby",type:"field",array:!0},{name:"field",type:"field",required:!0},{name:"probs",type:"number",array:!0},{name:"step",type:"number",default:.01},{name:"as",type:"string",array:!0,default:["prob","value"]}]};const QQe=1e-14;$e(Mz,re,{transform(e,t){const n=t.fork(t.NO_SOURCE|t.NO_FIELDS),r=e.as||["prob","value"];if(this.value&&!e.modified()&&!t.changed())return n.source=this.value,n;const i=t.materialize(t.SOURCE).source,s=$z(i,e.groupby,e.field),o=(e.groupby||[]).map(Nn),a=[],u=e.step||.01,l=e.probs||Js(u/2,1-QQe,u),c=l.length;return s.forEach(f=>{const h=W6(f,l);for(let d=0;d<c;++d){const p={};for(let g=0;g<o.length;++g)p[o[g]]=f.dims[g];p[r[0]]=l[d],p[r[1]]=h[d],a.push(Ot(p))}}),this.value&&(n.rem=this.value),this.value=n.add=n.source=a,n}});function sce(e){re.call(this,null,e)}$e(sce,re,{transform(e,t){let n,r;return this.value?r=this.value:(n=t=t.addAll(),r=this.value={}),e.derive&&(n=t.fork(t.NO_SOURCE),t.visit(t.REM,i=>{const s=Pe(i);n.rem.push(r[s]),r[s]=null}),t.visit(t.ADD,i=>{const s=z6(i);r[Pe(i)]=s,n.add.push(s)}),t.visit(t.MOD,i=>{const s=r[Pe(i)];for(const o in i)s[o]=i[o],n.modifies(o);n.mod.push(s)})),n}});function Lz(e){re.call(this,[],e),this.count=0}Lz.Definition={type:"Sample",metadata:{},params:[{name:"size",type:"number",default:1e3}]};$e(Lz,re,{transform(e,t){const n=t.fork(t.NO_SOURCE),r=e.modified("size"),i=e.size,s=this.value.reduce((c,f)=>(c[Pe(f)]=1,c),{});let o=this.value,a=this.count,u=0;function l(c){let f,h;o.length<i?o.push(c):(h=~~((a+1)*Oa()),h<o.length&&h>=u&&(f=o[h],s[Pe(f)]&&n.rem.push(f),o[h]=c)),++a}if(t.rem.length&&(t.visit(t.REM,c=>{const f=Pe(c);s[f]&&(s[f]=-1,n.rem.push(c)),--a}),o=o.filter(c=>s[Pe(c)]!==-1)),(t.rem.length||r)&&o.length<i&&t.source&&(u=a=o.length,t.visit(t.SOURCE,c=>{s[Pe(c)]||l(c)}),u=-1),r&&o.length>i){const c=o.length-i;for(let f=0;f<c;++f)s[Pe(o[f])]=-1,n.rem.push(o[f]);o=o.slice(c)}return t.mod.length&&t.visit(t.MOD,c=>{s[Pe(c)]&&n.mod.push(c)}),t.add.length&&t.visit(t.ADD,l),(t.add.length||u<0)&&(n.add=o.filter(c=>!s[Pe(c)])),this.count=a,this.value=n.source=o,n}});function Pz(e){re.call(this,null,e)}Pz.Definition={type:"Sequence",metadata:{generates:!0,changes:!0},params:[{name:"start",type:"number",required:!0},{name:"stop",type:"number",required:!0},{name:"step",type:"number",default:1},{name:"as",type:"string",default:"data"}]};$e(Pz,re,{transform(e,t){if(this.value&&!e.modified())return;const n=t.materialize().fork(t.MOD),r=e.as||"data";return n.rem=this.value?t.rem.concat(this.value):t.rem,this.value=Js(e.start,e.stop,e.step||1).map(i=>{const s={};return s[r]=i,Ot(s)}),n.add=t.add.concat(this.value),n}});function oce(e){re.call(this,null,e),this.modified(!0)}$e(oce,re,{transform(e,t){return this.value=t.source,t.changed()?t.fork(t.NO_SOURCE|t.NO_FIELDS):t.StopPropagation}});function Bz(e){re.call(this,null,e)}const ace=["unit0","unit1"];Bz.Definition={type:"TimeUnit",metadata:{modifies:!0},params:[{name:"field",type:"field",required:!0},{name:"interval",type:"boolean",default:!0},{name:"units",type:"enum",values:dz,array:!0},{name:"step",type:"number",default:1},{name:"maxbins",type:"number",default:40},{name:"extent",type:"date",array:!0},{name:"timezone",type:"enum",default:"local",values:["local","utc"]},{name:"as",type:"string",array:!0,length:2,default:ace}]};$e(Bz,re,{transform(e,t){const n=e.field,r=e.interval!==!1,i=e.timezone==="utc",s=this._floor(e,t),o=(i?fy:cy)(s.unit).offset,a=e.as||ace,u=a[0],l=a[1],c=s.step;let f=s.start||1/0,h=s.stop||-1/0,d=t.ADD;return(e.modified()||t.modified(wi(n)))&&(t=t.reflow(!0),d=t.SOURCE,f=1/0,h=-1/0),t.visit(d,p=>{const g=n(p);let m,y;g==null?(p[u]=null,r&&(p[l]=null)):(p[u]=m=y=s(g),r&&(p[l]=y=o(m,c)),m<f&&(f=m),y>h&&(h=y))}),s.start=f,s.stop=h,t.modifies(r?a:u)},_floor(e,t){const n=e.timezone==="utc",{units:r,step:i}=e.units?{units:e.units,step:e.step||1}:Ple({extent:e.extent||qf(t.materialize(t.SOURCE).source,e.field),maxbins:e.maxbins}),s=pz(r),o=this.value||{},a=(n?Tle:Ale)(s,i);return a.unit=Kt(s),a.units=s,a.step=i,a.start=o.start,a.stop=o.stop,this.value=a}});function uce(e){re.call(this,ry(),e)}$e(uce,re,{transform(e,t){const n=t.dataflow,r=e.field,i=this.value,s=a=>i.set(r(a),a);let o=!0;return e.modified("field")||t.modified(r.fields)?(i.clear(),t.visit(t.SOURCE,s)):t.changed()?(t.visit(t.REM,a=>i.delete(r(a))),t.visit(t.ADD,s)):o=!1,this.modified(o),i.empty>n.cleanThreshold&&n.runAfter(i.clean),t.fork()}});function lce(e){re.call(this,null,e)}$e(lce,re,{transform(e,t){(!this.value||e.modified("field")||e.modified("sort")||t.changed()||e.sort&&t.modified(e.sort.fields))&&(this.value=(e.sort?t.source.slice().sort(bg(e.sort)):t.source).map(e.field))}});function eet(e,t,n,r){const i=xv[e](t,n);return{init:i.init||Qc,update:function(s,o){o[r]=i.next(s)}}}const xv={row_number:function(){return{next:e=>e.index+1}},rank:function(){let e;return{init:()=>e=1,next:t=>{const n=t.index,r=t.data;return n&&t.compare(r[n-1],r[n])?e=n+1:e}}},dense_rank:function(){let e;return{init:()=>e=1,next:t=>{const n=t.index,r=t.data;return n&&t.compare(r[n-1],r[n])?++e:e}}},percent_rank:function(){const e=xv.rank(),t=e.next;return{init:e.init,next:n=>(t(n)-1)/(n.data.length-1)}},cume_dist:function(){let e;return{init:()=>e=0,next:t=>{const n=t.data,r=t.compare;let i=t.index;if(e<i){for(;i+1<n.length&&!r(n[i],n[i+1]);)++i;e=i}return(1+e)/n.length}}},ntile:function(e,t){t=+t,t>0||le("ntile num must be greater than zero.");const n=xv.cume_dist(),r=n.next;return{init:n.init,next:i=>Math.ceil(t*r(i))}},lag:function(e,t){return t=+t||1,{next:n=>{const r=n.index-t;return r>=0?e(n.data[r]):null}}},lead:function(e,t){return t=+t||1,{next:n=>{const r=n.index+t,i=n.data;return r<i.length?e(i[r]):null}}},first_value:function(e){return{next:t=>e(t.data[t.i0])}},last_value:function(e){return{next:t=>e(t.data[t.i1-1])}},nth_value:function(e,t){return t=+t,t>0||le("nth_value nth must be greater than zero."),{next:n=>{const r=n.i0+(t-1);return r<n.i1?e(n.data[r]):null}}},prev_value:function(e){let t;return{init:()=>t=null,next:n=>{const r=e(n.data[n.index]);return r!=null?t=r:t}}},next_value:function(e){let t,n;return{init:()=>(t=null,n=-1),next:r=>{const i=r.data;return r.index<=n?t:(n=tet(e,i,r.index))<0?(n=i.length,t=null):t=e(i[n])}}}};function tet(e,t,n){for(let r=t.length;n<r;++n)if(e(t[n])!=null)return n;return-1}const net=Object.keys(xv);function cce(e){const t=et(e.ops),n=et(e.fields),r=et(e.params),i=et(e.as),s=this.outputs=[],o=this.windows=[],a={},u={},l=[],c=[];let f=!0;function h(d){et(wi(d)).forEach(p=>a[p]=1)}h(e.sort),t.forEach((d,p)=>{const g=n[p],m=Nn(g),y=Ble(d,m,i[p]);if(h(g),s.push(y),nt(xv,d))o.push(eet(d,n[p],r[p],y));else{if(g==null&&d!=="count"&&le("Null aggregate field specified."),d==="count"){l.push(y);return}f=!1;let b=u[m];b||(b=u[m]=[],b.field=g,c.push(b)),b.push(zle(d,y))}}),(l.length||c.length)&&(this.cell=ret(c,l,f)),this.inputs=Object.keys(a)}const fce=cce.prototype;fce.init=function(){this.windows.forEach(e=>e.init()),this.cell&&this.cell.init()};fce.update=function(e,t){const n=this.cell,r=this.windows,i=e.data,s=r&&r.length;let o;if(n){for(o=e.p0;o<e.i0;++o)n.rem(i[o]);for(o=e.p1;o<e.i1;++o)n.add(i[o]);n.set(t)}for(o=0;o<s;++o)r[o].update(e,t)};function ret(e,t,n){e=e.map(u=>jle(u,u.field));const r={num:0,agg:null,store:!1,count:t};if(!n)for(var i=e.length,s=r.agg=Array(i),o=0;o<i;++o)s[o]=new e[o](r);if(r.store)var a=r.data=new mz;return r.add=function(u){if(r.num+=1,!n){a&&a.add(u);for(let l=0;l<i;++l)s[l].add(s[l].get(u),u)}},r.rem=function(u){if(r.num-=1,!n){a&&a.rem(u);for(let l=0;l<i;++l)s[l].rem(s[l].get(u),u)}},r.set=function(u){let l,c;for(a&&a.values(),l=0,c=t.length;l<c;++l)u[t[l]]=r.num;if(!n)for(l=0,c=s.length;l<c;++l)s[l].set(u)},r.init=function(){r.num=0,a&&a.reset();for(let u=0;u<i;++u)s[u].init()},r}function zz(e){re.call(this,{},e),this._mlen=0,this._mods=[]}zz.Definition={type:"Window",metadata:{modifies:!0},params:[{name:"sort",type:"compare"},{name:"groupby",type:"field",array:!0},{name:"ops",type:"enum",array:!0,values:net.concat(o$)},{name:"params",type:"number",null:!0,array:!0},{name:"fields",type:"field",null:!0,array:!0},{name:"as",type:"string",null:!0,array:!0},{name:"frame",type:"number",null:!0,array:!0,length:2,default:[null,0]},{name:"ignorePeers",type:"boolean",default:!1}]};$e(zz,re,{transform(e,t){this.stamp=t.stamp;const n=e.modified(),r=bg(e.sort),i=qM(e.groupby),s=a=>this.group(i(a));let o=this.state;(!o||n)&&(o=this.state=new cce(e)),n||t.modified(o.inputs)?(this.value={},t.visit(t.SOURCE,a=>s(a).add(a))):(t.visit(t.REM,a=>s(a).remove(a)),t.visit(t.ADD,a=>s(a).add(a)));for(let a=0,u=this._mlen;a<u;++a)iet(this._mods[a],o,r,e);return this._mlen=0,this._mods=[],t.reflow(n).modifies(o.outputs)},group(e){let t=this.value[e];return t||(t=this.value[e]=Wle(Pe),t.stamp=-1),t.stamp<this.stamp&&(t.stamp=this.stamp,this._mods[this._mlen++]=t),t}});function iet(e,t,n,r){const i=r.sort,s=i&&!r.ignorePeers,o=r.frame||[null,0],a=e.data(n),u=a.length,l=s?n$(i):null,c={i0:0,i1:0,p0:0,p1:0,index:0,data:a,compare:i||Bo(-1)};t.init();for(let f=0;f<u;++f)set(c,o,f,u),s&&oet(c,l),t.update(c,a[f])}function set(e,t,n,r){e.p0=e.i0,e.p1=e.i1,e.i0=t[0]==null?0:Math.max(0,n-Math.abs(t[0])),e.i1=t[1]==null?r:Math.min(r,n+Math.abs(t[1])+1),e.index=n}function oet(e,t){const n=e.i0,r=e.i1-1,i=e.compare,s=e.data,o=s.length-1;n>0&&!i(s[n],s[n-1])&&(e.i0=t.left(s,s[n])),r<o&&!i(s[r],s[r+1])&&(e.i1=t.right(s,s[r]))}const aet=Object.freeze(Object.defineProperty({__proto__:null,aggregate:eh,bin:yz,collect:bz,compare:Vle,countpattern:xz,cross:vz,density:wz,dotbin:Cz,expression:Yle,extent:Sz,facet:cD,field:Kle,filter:Ez,flatten:_z,fold:Az,formula:Tz,generate:Zle,impute:Iz,joinaggregate:Dz,kde:Nz,key:Jle,load:Qle,lookup:Fz,multiextent:ece,multivalues:tce,params:nce,pivot:Oz,prefacet:rce,project:Rz,proxy:ice,quantile:Mz,relay:sce,sample:Lz,sequence:Pz,sieve:oce,subflow:kz,timeunit:Bz,tupleindex:uce,values:lce,window:zz},Symbol.toStringTag,{value:"Module"}));function hy(e,t,n){return e.fields=t||[],e.fname=n,e}function uet(e){return e.length===1?cet(e[0]):fet(e)}const cet=e=>function(t){return t[e]},fet=e=>{const t=e.length;return function(n){for(let r=0;r<t;++r)n=n[e[r]];return n}};function ec(e){throw Error(e)}function het(e){const t=[],n=e.length;let r=null,i=0,s="",o,a,u;e=e+"";function l(){t.push(s+e.substring(o,a)),s="",o=a+1}for(o=a=0;a<n;++a)if(u=e[a],u==="\\")s+=e.substring(o,a++),o=a;else if(u===r)l(),r=null,i=-1;else{if(r)continue;o===i&&u==='"'||o===i&&u==="'"?(o=a+1,r=u):u==="."&&!i?a>o?l():o=a+1:u==="["?(a>o&&l(),i=o=a+1):u==="]"&&(i||ec("Access path missing open bracket: "+e),i>0&&l(),i=0,o=a+1)}return i&&ec("Access path missing closing bracket: "+e),r&&ec("Access path missing closing quote: "+e),a>o&&(a++,l()),t}function det(e,t,n){const r=het(e);return e=r.length===1?r[0]:e,hy((n&&n.get||uet)(r),[e],t||e)}det("id");hy(e=>e,[],"identity");hy(()=>0,[],"zero");hy(()=>1,[],"one");const hce=hy(()=>!0,[],"true");hy(()=>!1,[],"false");var Qu=Array.isArray;function Uz(e){return e===Object(e)}function Eu(e){return e[e.length-1]}function pet(e){return e==null||e===""?null:+e}function jz(e){return e!=null?Qu(e)?e:[e]:[]}function fD(e){return typeof e=="function"}function hD(e){for(let t,n,r=1,i=arguments.length;r<i;++r){t=arguments[r];for(n in t)e[n]=t[n]}return e}const get=Object.prototype.hasOwnProperty;function Ll(e,t){return get.call(e,t)}function Ko(e,t,n){const r=e.prototype=Object.create(t.prototype);return Object.defineProperty(r,"constructor",{value:e,writable:!0,enumerable:!0,configurable:!0}),hD(r,n)}function wE(e){return typeof e=="string"}const met=1e4;function yet(e){e=+e||met;let t,n,r;const i=()=>{t={},n={},r=0},s=(o,a)=>(++r>e&&(n=t,t={},r=1),t[o]=a);return i(),{clear:i,has:o=>Ll(t,o)||Ll(n,o),get:o=>Ll(t,o)?t[o]:Ll(n,o)?s(o,n[o]):void 0,set:(o,a)=>Ll(t,o)?t[o]=a:s(o,a)}}function dce(e){return Qu(e)?"["+e.map(dce)+"]":Uz(e)||wE(e)?JSON.stringify(e).replace("\u2028","\\u2028").replace("\u2029","\\u2029"):e}function pce(e){const t={},n=e.length;for(let r=0;r<n;++r)t[e[r]]=!0;return t}function Mt(e){return function(){return e}}const JH=Math.abs,ti=Math.atan2,rd=Math.cos,bet=Math.max,z3=Math.min,Ja=Math.sin,zd=Math.sqrt,ri=1e-12,l0=Math.PI,$E=l0/2,gce=2*l0;function xet(e){return e>1?0:e<-1?l0:Math.acos(e)}function QH(e){return e>=1?$E:e<=-1?-$E:Math.asin(e)}const XM=Math.PI,YM=2*XM,xd=1e-6,vet=YM-xd;function mce(e){this._+=e[0];for(let t=1,n=e.length;t<n;++t)this._+=arguments[t]+e[t]}function wet(e){let t=Math.floor(e);if(!(t>=0))throw new Error(`invalid digits: ${e}`);if(t>15)return mce;const n=10**t;return function(r){this._+=r[0];for(let i=1,s=r.length;i<s;++i)this._+=Math.round(arguments[i]*n)/n+r[i]}}let Wz=class{constructor(t){this._x0=this._y0=this._x1=this._y1=null,this._="",this._append=t==null?mce:wet(t)}moveTo(t,n){this._append`M${this._x0=this._x1=+t},${this._y0=this._y1=+n}`}closePath(){this._x1!==null&&(this._x1=this._x0,this._y1=this._y0,this._append`Z`)}lineTo(t,n){this._append`L${this._x1=+t},${this._y1=+n}`}quadraticCurveTo(t,n,r,i){this._append`Q${+t},${+n},${this._x1=+r},${this._y1=+i}`}bezierCurveTo(t,n,r,i,s,o){this._append`C${+t},${+n},${+r},${+i},${this._x1=+s},${this._y1=+o}`}arcTo(t,n,r,i,s){if(t=+t,n=+n,r=+r,i=+i,s=+s,s<0)throw new Error(`negative radius: ${s}`);let o=this._x1,a=this._y1,u=r-t,l=i-n,c=o-t,f=a-n,h=c*c+f*f;if(this._x1===null)this._append`M${this._x1=t},${this._y1=n}`;else if(h>xd)if(!(Math.abs(f*u-l*c)>xd)||!s)this._append`L${this._x1=t},${this._y1=n}`;else{let d=r-o,p=i-a,g=u*u+l*l,m=d*d+p*p,y=Math.sqrt(g),b=Math.sqrt(h),v=s*Math.tan((XM-Math.acos((g+h-m)/(2*y*b)))/2),x=v/b,w=v/y;Math.abs(x-1)>xd&&this._append`L${t+x*c},${n+x*f}`,this._append`A${s},${s},0,0,${+(f*d>c*p)},${this._x1=t+w*u},${this._y1=n+w*l}`}}arc(t,n,r,i,s,o){if(t=+t,n=+n,r=+r,o=!!o,r<0)throw new Error(`negative radius: ${r}`);let a=r*Math.cos(i),u=r*Math.sin(i),l=t+a,c=n+u,f=1^o,h=o?i-s:s-i;this._x1===null?this._append`M${l},${c}`:(Math.abs(this._x1-l)>xd||Math.abs(this._y1-c)>xd)&&this._append`L${l},${c}`,r&&(h<0&&(h=h%YM+YM),h>vet?this._append`A${r},${r},0,1,${f},${t-a},${n-u}A${r},${r},0,1,${f},${this._x1=l},${this._y1=c}`:h>xd&&this._append`A${r},${r},0,${+(h>=XM)},${f},${this._x1=t+r*Math.cos(s)},${this._y1=n+r*Math.sin(s)}`)}rect(t,n,r,i){this._append`M${this._x0=this._x1=+t},${this._y0=this._y1=+n}h${r=+r}v${+i}h${-r}Z`}toString(){return this._}};function Vz(){return new Wz}Vz.prototype=Wz.prototype;function dD(e){let t=3;return e.digits=function(n){if(!arguments.length)return t;if(n==null)t=null;else{const r=Math.floor(n);if(!(r>=0))throw new RangeError(`invalid digits: ${n}`);t=r}return e},()=>new Wz(t)}function $et(e){return e.innerRadius}function Cet(e){return e.outerRadius}function ket(e){return e.startAngle}function Eet(e){return e.endAngle}function _et(e){return e&&e.padAngle}function Aet(e,t,n,r,i,s,o,a){var u=n-e,l=r-t,c=o-i,f=a-s,h=f*u-c*l;if(!(h*h<ri))return h=(c*(t-s)-f*(e-i))/h,[e+h*u,t+h*l]}function YC(e,t,n,r,i,s,o){var a=e-n,u=t-r,l=(o?s:-s)/zd(a*a+u*u),c=l*u,f=-l*a,h=e+c,d=t+f,p=n+c,g=r+f,m=(h+p)/2,y=(d+g)/2,b=p-h,v=g-d,x=b*b+v*v,w=i-s,C=h*g-p*d,$=(v<0?-1:1)*zd(bet(0,w*w*x-C*C)),S=(C*v-b*$)/x,k=(-C*b-v*$)/x,E=(C*v+b*$)/x,_=(-C*b+v*$)/x,D=S-m,A=k-y,T=E-m,I=_-y;return D*D+A*A>T*T+I*I&&(S=E,k=_),{cx:S,cy:k,x01:-c,y01:-f,x11:S*(i/w-1),y11:k*(i/w-1)}}function Tet(){var e=$et,t=Cet,n=Mt(0),r=null,i=ket,s=Eet,o=_et,a=null,u=dD(l);function l(){var c,f,h=+e.apply(this,arguments),d=+t.apply(this,arguments),p=i.apply(this,arguments)-$E,g=s.apply(this,arguments)-$E,m=JH(g-p),y=g>p;if(a||(a=c=u()),d<h&&(f=d,d=h,h=f),!(d>ri))a.moveTo(0,0);else if(m>gce-ri)a.moveTo(d*rd(p),d*Ja(p)),a.arc(0,0,d,p,g,!y),h>ri&&(a.moveTo(h*rd(g),h*Ja(g)),a.arc(0,0,h,g,p,y));else{var b=p,v=g,x=p,w=g,C=m,$=m,S=o.apply(this,arguments)/2,k=S>ri&&(r?+r.apply(this,arguments):zd(h*h+d*d)),E=z3(JH(d-h)/2,+n.apply(this,arguments)),_=E,D=E,A,T;if(k>ri){var I=QH(k/h*Ja(S)),F=QH(k/d*Ja(S));(C-=I*2)>ri?(I*=y?1:-1,x+=I,w-=I):(C=0,x=w=(p+g)/2),($-=F*2)>ri?(F*=y?1:-1,b+=F,v-=F):($=0,b=v=(p+g)/2)}var R=d*rd(b),L=d*Ja(b),P=h*rd(w),q=h*Ja(w);if(E>ri){var X=d*rd(v),G=d*Ja(v),J=h*rd(x),Q=h*Ja(x),ee;if(m<l0)if(ee=Aet(R,L,J,Q,X,G,P,q)){var ue=R-ee[0],ge=L-ee[1],xe=X-ee[0],B=G-ee[1],H=1/Ja(xet((ue*xe+ge*B)/(zd(ue*ue+ge*ge)*zd(xe*xe+B*B)))/2),Y=zd(ee[0]*ee[0]+ee[1]*ee[1]);_=z3(E,(h-Y)/(H-1)),D=z3(E,(d-Y)/(H+1))}else _=D=0}$>ri?D>ri?(A=YC(J,Q,R,L,d,D,y),T=YC(X,G,P,q,d,D,y),a.moveTo(A.cx+A.x01,A.cy+A.y01),D<E?a.arc(A.cx,A.cy,D,ti(A.y01,A.x01),ti(T.y01,T.x01),!y):(a.arc(A.cx,A.cy,D,ti(A.y01,A.x01),ti(A.y11,A.x11),!y),a.arc(0,0,d,ti(A.cy+A.y11,A.cx+A.x11),ti(T.cy+T.y11,T.cx+T.x11),!y),a.arc(T.cx,T.cy,D,ti(T.y11,T.x11),ti(T.y01,T.x01),!y))):(a.moveTo(R,L),a.arc(0,0,d,b,v,!y)):a.moveTo(R,L),!(h>ri)||!(C>ri)?a.lineTo(P,q):_>ri?(A=YC(P,q,X,G,h,-_,y),T=YC(R,L,J,Q,h,-_,y),a.lineTo(A.cx+A.x01,A.cy+A.y01),_<E?a.arc(A.cx,A.cy,_,ti(A.y01,A.x01),ti(T.y01,T.x01),!y):(a.arc(A.cx,A.cy,_,ti(A.y01,A.x01),ti(A.y11,A.x11),!y),a.arc(0,0,h,ti(A.cy+A.y11,A.cx+A.x11),ti(T.cy+T.y11,T.cx+T.x11),y),a.arc(T.cx,T.cy,_,ti(T.y11,T.x11),ti(T.y01,T.x01),!y))):a.arc(0,0,h,w,x,y)}if(a.closePath(),c)return a=null,c+""||null}return l.centroid=function(){var c=(+e.apply(this,arguments)+ +t.apply(this,arguments))/2,f=(+i.apply(this,arguments)+ +s.apply(this,arguments))/2-l0/2;return[rd(f)*c,Ja(f)*c]},l.innerRadius=function(c){return arguments.length?(e=typeof c=="function"?c:Mt(+c),l):e},l.outerRadius=function(c){return arguments.length?(t=typeof c=="function"?c:Mt(+c),l):t},l.cornerRadius=function(c){return arguments.length?(n=typeof c=="function"?c:Mt(+c),l):n},l.padRadius=function(c){return arguments.length?(r=c==null?null:typeof c=="function"?c:Mt(+c),l):r},l.startAngle=function(c){return arguments.length?(i=typeof c=="function"?c:Mt(+c),l):i},l.endAngle=function(c){return arguments.length?(s=typeof c=="function"?c:Mt(+c),l):s},l.padAngle=function(c){return arguments.length?(o=typeof c=="function"?c:Mt(+c),l):o},l.context=function(c){return arguments.length?(a=c??null,l):a},l}function yce(e){return typeof e=="object"&&"length"in e?e:Array.from(e)}function bce(e){this._context=e}bce.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;default:this._context.lineTo(e,t);break}}};function Gz(e){return new bce(e)}function xce(e){return e[0]}function vce(e){return e[1]}function wce(e,t){var n=Mt(!0),r=null,i=Gz,s=null,o=dD(a);e=typeof e=="function"?e:e===void 0?xce:Mt(e),t=typeof t=="function"?t:t===void 0?vce:Mt(t);function a(u){var l,c=(u=yce(u)).length,f,h=!1,d;for(r==null&&(s=i(d=o())),l=0;l<=c;++l)!(l<c&&n(f=u[l],l,u))===h&&((h=!h)?s.lineStart():s.lineEnd()),h&&s.point(+e(f,l,u),+t(f,l,u));if(d)return s=null,d+""||null}return a.x=function(u){return arguments.length?(e=typeof u=="function"?u:Mt(+u),a):e},a.y=function(u){return arguments.length?(t=typeof u=="function"?u:Mt(+u),a):t},a.defined=function(u){return arguments.length?(n=typeof u=="function"?u:Mt(!!u),a):n},a.curve=function(u){return arguments.length?(i=u,r!=null&&(s=i(r)),a):i},a.context=function(u){return arguments.length?(u==null?r=s=null:s=i(r=u),a):r},a}function $ce(e,t,n){var r=null,i=Mt(!0),s=null,o=Gz,a=null,u=dD(l);e=typeof e=="function"?e:e===void 0?xce:Mt(+e),t=typeof t=="function"?t:Mt(t===void 0?0:+t),n=typeof n=="function"?n:n===void 0?vce:Mt(+n);function l(f){var h,d,p,g=(f=yce(f)).length,m,y=!1,b,v=new Array(g),x=new Array(g);for(s==null&&(a=o(b=u())),h=0;h<=g;++h){if(!(h<g&&i(m=f[h],h,f))===y)if(y=!y)d=h,a.areaStart(),a.lineStart();else{for(a.lineEnd(),a.lineStart(),p=h-1;p>=d;--p)a.point(v[p],x[p]);a.lineEnd(),a.areaEnd()}y&&(v[h]=+e(m,h,f),x[h]=+t(m,h,f),a.point(r?+r(m,h,f):v[h],n?+n(m,h,f):x[h]))}if(b)return a=null,b+""||null}function c(){return wce().defined(i).curve(o).context(s)}return l.x=function(f){return arguments.length?(e=typeof f=="function"?f:Mt(+f),r=null,l):e},l.x0=function(f){return arguments.length?(e=typeof f=="function"?f:Mt(+f),l):e},l.x1=function(f){return arguments.length?(r=f==null?null:typeof f=="function"?f:Mt(+f),l):r},l.y=function(f){return arguments.length?(t=typeof f=="function"?f:Mt(+f),n=null,l):t},l.y0=function(f){return arguments.length?(t=typeof f=="function"?f:Mt(+f),l):t},l.y1=function(f){return arguments.length?(n=f==null?null:typeof f=="function"?f:Mt(+f),l):n},l.lineX0=l.lineY0=function(){return c().x(e).y(t)},l.lineY1=function(){return c().x(e).y(n)},l.lineX1=function(){return c().x(r).y(t)},l.defined=function(f){return arguments.length?(i=typeof f=="function"?f:Mt(!!f),l):i},l.curve=function(f){return arguments.length?(o=f,s!=null&&(a=o(s)),l):o},l.context=function(f){return arguments.length?(f==null?s=a=null:a=o(s=f),l):s},l}const Iet={draw(e,t){const n=zd(t/l0);e.moveTo(n,0),e.arc(0,0,n,0,gce)}};function Det(e,t){let n=null,r=dD(i);e=typeof e=="function"?e:Mt(e||Iet),t=typeof t=="function"?t:Mt(t===void 0?64:+t);function i(){let s;if(n||(n=s=r()),e.apply(this,arguments).draw(n,+t.apply(this,arguments)),s)return n=null,s+""||null}return i.type=function(s){return arguments.length?(e=typeof s=="function"?s:Mt(s),i):e},i.size=function(s){return arguments.length?(t=typeof s=="function"?s:Mt(+s),i):t},i.context=function(s){return arguments.length?(n=s??null,i):n},i}function th(){}function CE(e,t,n){e._context.bezierCurveTo((2*e._x0+e._x1)/3,(2*e._y0+e._y1)/3,(e._x0+2*e._x1)/3,(e._y0+2*e._y1)/3,(e._x0+4*e._x1+t)/6,(e._y0+4*e._y1+n)/6)}function pD(e){this._context=e}pD.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=NaN,this._point=0},lineEnd:function(){switch(this._point){case 3:CE(this,this._x1,this._y1);case 2:this._context.lineTo(this._x1,this._y1);break}(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;break;case 2:this._point=3,this._context.lineTo((5*this._x0+this._x1)/6,(5*this._y0+this._y1)/6);default:CE(this,e,t);break}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=t}};function Net(e){return new pD(e)}function Cce(e){this._context=e}Cce.prototype={areaStart:th,areaEnd:th,lineStart:function(){this._x0=this._x1=this._x2=this._x3=this._x4=this._y0=this._y1=this._y2=this._y3=this._y4=NaN,this._point=0},lineEnd:function(){switch(this._point){case 1:{this._context.moveTo(this._x2,this._y2),this._context.closePath();break}case 2:{this._context.moveTo((this._x2+2*this._x3)/3,(this._y2+2*this._y3)/3),this._context.lineTo((this._x3+2*this._x2)/3,(this._y3+2*this._y2)/3),this._context.closePath();break}case 3:{this.point(this._x2,this._y2),this.point(this._x3,this._y3),this.point(this._x4,this._y4);break}}},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._x2=e,this._y2=t;break;case 1:this._point=2,this._x3=e,this._y3=t;break;case 2:this._point=3,this._x4=e,this._y4=t,this._context.moveTo((this._x0+4*this._x1+e)/6,(this._y0+4*this._y1+t)/6);break;default:CE(this,e,t);break}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=t}};function Fet(e){return new Cce(e)}function Sce(e){this._context=e}Sce.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=NaN,this._point=0},lineEnd:function(){(this._line||this._line!==0&&this._point===3)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3;var n=(this._x0+4*this._x1+e)/6,r=(this._y0+4*this._y1+t)/6;this._line?this._context.lineTo(n,r):this._context.moveTo(n,r);break;case 3:this._point=4;default:CE(this,e,t);break}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=t}};function Oet(e){return new Sce(e)}function kce(e,t){this._basis=new pD(e),this._beta=t}kce.prototype={lineStart:function(){this._x=[],this._y=[],this._basis.lineStart()},lineEnd:function(){var e=this._x,t=this._y,n=e.length-1;if(n>0)for(var r=e[0],i=t[0],s=e[n]-r,o=t[n]-i,a=-1,u;++a<=n;)u=a/n,this._basis.point(this._beta*e[a]+(1-this._beta)*(r+u*s),this._beta*t[a]+(1-this._beta)*(i+u*o));this._x=this._y=null,this._basis.lineEnd()},point:function(e,t){this._x.push(+e),this._y.push(+t)}};const Ret=function e(t){function n(r){return t===1?new pD(r):new kce(r,t)}return n.beta=function(r){return e(+r)},n}(.85);function SE(e,t,n){e._context.bezierCurveTo(e._x1+e._k*(e._x2-e._x0),e._y1+e._k*(e._y2-e._y0),e._x2+e._k*(e._x1-t),e._y2+e._k*(e._y1-n),e._x2,e._y2)}function Hz(e,t){this._context=e,this._k=(1-t)/6}Hz.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x2,this._y2);break;case 3:SE(this,this._x1,this._y1);break}(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2,this._x1=e,this._y1=t;break;case 2:this._point=3;default:SE(this,e,t);break}this._x0=this._x1,this._x1=this._x2,this._x2=e,this._y0=this._y1,this._y1=this._y2,this._y2=t}};const Met=function e(t){function n(r){return new Hz(r,t)}return n.tension=function(r){return e(+r)},n}(0);function qz(e,t){this._context=e,this._k=(1-t)/6}qz.prototype={areaStart:th,areaEnd:th,lineStart:function(){this._x0=this._x1=this._x2=this._x3=this._x4=this._x5=this._y0=this._y1=this._y2=this._y3=this._y4=this._y5=NaN,this._point=0},lineEnd:function(){switch(this._point){case 1:{this._context.moveTo(this._x3,this._y3),this._context.closePath();break}case 2:{this._context.lineTo(this._x3,this._y3),this._context.closePath();break}case 3:{this.point(this._x3,this._y3),this.point(this._x4,this._y4),this.point(this._x5,this._y5);break}}},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._x3=e,this._y3=t;break;case 1:this._point=2,this._context.moveTo(this._x4=e,this._y4=t);break;case 2:this._point=3,this._x5=e,this._y5=t;break;default:SE(this,e,t);break}this._x0=this._x1,this._x1=this._x2,this._x2=e,this._y0=this._y1,this._y1=this._y2,this._y2=t}};const Let=function e(t){function n(r){return new qz(r,t)}return n.tension=function(r){return e(+r)},n}(0);function Xz(e,t){this._context=e,this._k=(1-t)/6}Xz.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._point=0},lineEnd:function(){(this._line||this._line!==0&&this._point===3)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3,this._line?this._context.lineTo(this._x2,this._y2):this._context.moveTo(this._x2,this._y2);break;case 3:this._point=4;default:SE(this,e,t);break}this._x0=this._x1,this._x1=this._x2,this._x2=e,this._y0=this._y1,this._y1=this._y2,this._y2=t}};const Pet=function e(t){function n(r){return new Xz(r,t)}return n.tension=function(r){return e(+r)},n}(0);function Yz(e,t,n){var r=e._x1,i=e._y1,s=e._x2,o=e._y2;if(e._l01_a>ri){var a=2*e._l01_2a+3*e._l01_a*e._l12_a+e._l12_2a,u=3*e._l01_a*(e._l01_a+e._l12_a);r=(r*a-e._x0*e._l12_2a+e._x2*e._l01_2a)/u,i=(i*a-e._y0*e._l12_2a+e._y2*e._l01_2a)/u}if(e._l23_a>ri){var l=2*e._l23_2a+3*e._l23_a*e._l12_a+e._l12_2a,c=3*e._l23_a*(e._l23_a+e._l12_a);s=(s*l+e._x1*e._l23_2a-t*e._l12_2a)/c,o=(o*l+e._y1*e._l23_2a-n*e._l12_2a)/c}e._context.bezierCurveTo(r,i,s,o,e._x2,e._y2)}function Ece(e,t){this._context=e,this._alpha=t}Ece.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._l01_a=this._l12_a=this._l23_a=this._l01_2a=this._l12_2a=this._l23_2a=this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x2,this._y2);break;case 3:this.point(this._x2,this._y2);break}(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){if(e=+e,t=+t,this._point){var n=this._x2-e,r=this._y2-t;this._l23_a=Math.sqrt(this._l23_2a=Math.pow(n*n+r*r,this._alpha))}switch(this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;break;case 2:this._point=3;default:Yz(this,e,t);break}this._l01_a=this._l12_a,this._l12_a=this._l23_a,this._l01_2a=this._l12_2a,this._l12_2a=this._l23_2a,this._x0=this._x1,this._x1=this._x2,this._x2=e,this._y0=this._y1,this._y1=this._y2,this._y2=t}};const Bet=function e(t){function n(r){return t?new Ece(r,t):new Hz(r,0)}return n.alpha=function(r){return e(+r)},n}(.5);function _ce(e,t){this._context=e,this._alpha=t}_ce.prototype={areaStart:th,areaEnd:th,lineStart:function(){this._x0=this._x1=this._x2=this._x3=this._x4=this._x5=this._y0=this._y1=this._y2=this._y3=this._y4=this._y5=NaN,this._l01_a=this._l12_a=this._l23_a=this._l01_2a=this._l12_2a=this._l23_2a=this._point=0},lineEnd:function(){switch(this._point){case 1:{this._context.moveTo(this._x3,this._y3),this._context.closePath();break}case 2:{this._context.lineTo(this._x3,this._y3),this._context.closePath();break}case 3:{this.point(this._x3,this._y3),this.point(this._x4,this._y4),this.point(this._x5,this._y5);break}}},point:function(e,t){if(e=+e,t=+t,this._point){var n=this._x2-e,r=this._y2-t;this._l23_a=Math.sqrt(this._l23_2a=Math.pow(n*n+r*r,this._alpha))}switch(this._point){case 0:this._point=1,this._x3=e,this._y3=t;break;case 1:this._point=2,this._context.moveTo(this._x4=e,this._y4=t);break;case 2:this._point=3,this._x5=e,this._y5=t;break;default:Yz(this,e,t);break}this._l01_a=this._l12_a,this._l12_a=this._l23_a,this._l01_2a=this._l12_2a,this._l12_2a=this._l23_2a,this._x0=this._x1,this._x1=this._x2,this._x2=e,this._y0=this._y1,this._y1=this._y2,this._y2=t}};const zet=function e(t){function n(r){return t?new _ce(r,t):new qz(r,0)}return n.alpha=function(r){return e(+r)},n}(.5);function Ace(e,t){this._context=e,this._alpha=t}Ace.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._l01_a=this._l12_a=this._l23_a=this._l01_2a=this._l12_2a=this._l23_2a=this._point=0},lineEnd:function(){(this._line||this._line!==0&&this._point===3)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){if(e=+e,t=+t,this._point){var n=this._x2-e,r=this._y2-t;this._l23_a=Math.sqrt(this._l23_2a=Math.pow(n*n+r*r,this._alpha))}switch(this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3,this._line?this._context.lineTo(this._x2,this._y2):this._context.moveTo(this._x2,this._y2);break;case 3:this._point=4;default:Yz(this,e,t);break}this._l01_a=this._l12_a,this._l12_a=this._l23_a,this._l01_2a=this._l12_2a,this._l12_2a=this._l23_2a,this._x0=this._x1,this._x1=this._x2,this._x2=e,this._y0=this._y1,this._y1=this._y2,this._y2=t}};const Uet=function e(t){function n(r){return t?new Ace(r,t):new Xz(r,0)}return n.alpha=function(r){return e(+r)},n}(.5);function Tce(e){this._context=e}Tce.prototype={areaStart:th,areaEnd:th,lineStart:function(){this._point=0},lineEnd:function(){this._point&&this._context.closePath()},point:function(e,t){e=+e,t=+t,this._point?this._context.lineTo(e,t):(this._point=1,this._context.moveTo(e,t))}};function jet(e){return new Tce(e)}function eq(e){return e<0?-1:1}function tq(e,t,n){var r=e._x1-e._x0,i=t-e._x1,s=(e._y1-e._y0)/(r||i<0&&-0),o=(n-e._y1)/(i||r<0&&-0),a=(s*i+o*r)/(r+i);return(eq(s)+eq(o))*Math.min(Math.abs(s),Math.abs(o),.5*Math.abs(a))||0}function nq(e,t){var n=e._x1-e._x0;return n?(3*(e._y1-e._y0)/n-t)/2:t}function U3(e,t,n){var r=e._x0,i=e._y0,s=e._x1,o=e._y1,a=(s-r)/3;e._context.bezierCurveTo(r+a,i+a*t,s-a,o-a*n,s,o)}function kE(e){this._context=e}kE.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=this._t0=NaN,this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x1,this._y1);break;case 3:U3(this,this._t0,nq(this,this._t0));break}(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){var n=NaN;if(e=+e,t=+t,!(e===this._x1&&t===this._y1)){switch(this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;break;case 2:this._point=3,U3(this,nq(this,n=tq(this,e,t)),n);break;default:U3(this,this._t0,n=tq(this,e,t));break}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=t,this._t0=n}}};function Ice(e){this._context=new Dce(e)}(Ice.prototype=Object.create(kE.prototype)).point=function(e,t){kE.prototype.point.call(this,t,e)};function Dce(e){this._context=e}Dce.prototype={moveTo:function(e,t){this._context.moveTo(t,e)},closePath:function(){this._context.closePath()},lineTo:function(e,t){this._context.lineTo(t,e)},bezierCurveTo:function(e,t,n,r,i,s){this._context.bezierCurveTo(t,e,r,n,s,i)}};function Wet(e){return new kE(e)}function Vet(e){return new Ice(e)}function Nce(e){this._context=e}Nce.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x=[],this._y=[]},lineEnd:function(){var e=this._x,t=this._y,n=e.length;if(n)if(this._line?this._context.lineTo(e[0],t[0]):this._context.moveTo(e[0],t[0]),n===2)this._context.lineTo(e[1],t[1]);else for(var r=rq(e),i=rq(t),s=0,o=1;o<n;++s,++o)this._context.bezierCurveTo(r[0][s],i[0][s],r[1][s],i[1][s],e[o],t[o]);(this._line||this._line!==0&&n===1)&&this._context.closePath(),this._line=1-this._line,this._x=this._y=null},point:function(e,t){this._x.push(+e),this._y.push(+t)}};function rq(e){var t,n=e.length-1,r,i=new Array(n),s=new Array(n),o=new Array(n);for(i[0]=0,s[0]=2,o[0]=e[0]+2*e[1],t=1;t<n-1;++t)i[t]=1,s[t]=4,o[t]=4*e[t]+2*e[t+1];for(i[n-1]=2,s[n-1]=7,o[n-1]=8*e[n-1]+e[n],t=1;t<n;++t)r=i[t]/s[t-1],s[t]-=r,o[t]-=r*o[t-1];for(i[n-1]=o[n-1]/s[n-1],t=n-2;t>=0;--t)i[t]=(o[t]-i[t+1])/s[t];for(s[n-1]=(e[n]+i[n-1])/2,t=0;t<n-1;++t)s[t]=2*e[t+1]-i[t+1];return[i,s]}function Get(e){return new Nce(e)}function gD(e,t){this._context=e,this._t=t}gD.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x=this._y=NaN,this._point=0},lineEnd:function(){0<this._t&&this._t<1&&this._point===2&&this._context.lineTo(this._x,this._y),(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line>=0&&(this._t=1-this._t,this._line=1-this._line)},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;default:{if(this._t<=0)this._context.lineTo(this._x,t),this._context.lineTo(e,t);else{var n=this._x*(1-this._t)+e*this._t;this._context.lineTo(n,this._y),this._context.lineTo(n,t)}break}}this._x=e,this._y=t}};function Het(e){return new gD(e,.5)}function qet(e){return new gD(e,0)}function Xet(e){return new gD(e,1)}function Ec(e,t){if(typeof document<"u"&&document.createElement){const n=document.createElement("canvas");if(n&&n.getContext)return n.width=e,n.height=t,n}return null}const Fce=()=>typeof Image<"u"?Image:null;function ux(e,t){return e==null||t==null?NaN:e<t?-1:e>t?1:e>=t?0:NaN}function Yet(e,t){return e==null||t==null?NaN:t<e?-1:t>e?1:t>=e?0:NaN}function Kz(e){let t,n,r;e.length!==2?(t=ux,n=(a,u)=>ux(e(a),u),r=(a,u)=>e(a)-u):(t=e===ux||e===Yet?e:Ket,n=e,r=e);function i(a,u,l=0,c=a.length){if(l<c){if(t(u,u)!==0)return c;do{const f=l+c>>>1;n(a[f],u)<0?l=f+1:c=f}while(l<c)}return l}function s(a,u,l=0,c=a.length){if(l<c){if(t(u,u)!==0)return c;do{const f=l+c>>>1;n(a[f],u)<=0?l=f+1:c=f}while(l<c)}return l}function o(a,u,l=0,c=a.length){const f=i(a,u,l,c-1);return f>l&&r(a[f-1],u)>-r(a[f],u)?f-1:f}return{left:i,center:o,right:s}}function Ket(){return 0}function Oce(e){return e===null?NaN:+e}const Zet=Kz(ux),KM=Zet.right;Kz(Oce).center;const a$=KM,Jet=Math.sqrt(50),Qet=Math.sqrt(10),ett=Math.sqrt(2);function EE(e,t,n){const r=(t-e)/Math.max(0,n),i=Math.floor(Math.log10(r)),s=r/Math.pow(10,i),o=s>=Jet?10:s>=Qet?5:s>=ett?2:1;let a,u,l;return i<0?(l=Math.pow(10,-i)/o,a=Math.round(e*l),u=Math.round(t*l),a/l<e&&++a,u/l>t&&--u,l=-l):(l=Math.pow(10,i)*o,a=Math.round(e/l),u=Math.round(t/l),a*l<e&&++a,u*l>t&&--u),u<a&&.5<=n&&n<2?EE(e,t,n*2):[a,u,l]}function ZM(e,t,n){if(t=+t,e=+e,n=+n,!(n>0))return[];if(e===t)return[e];const r=t<e,[i,s,o]=r?EE(t,e,n):EE(e,t,n);if(!(s>=i))return[];const a=s-i+1,u=new Array(a);if(r)if(o<0)for(let l=0;l<a;++l)u[l]=(s-l)/-o;else for(let l=0;l<a;++l)u[l]=(s-l)*o;else if(o<0)for(let l=0;l<a;++l)u[l]=(i+l)/-o;else for(let l=0;l<a;++l)u[l]=(i+l)*o;return u}function JM(e,t,n){return t=+t,e=+e,n=+n,EE(e,t,n)[2]}function _E(e,t,n){t=+t,e=+e,n=+n;const r=t<e,i=r?JM(t,e,n):JM(e,t,n);return(r?-1:1)*(i<0?1/-i:i)}function ttt(e,t,n=Oce){if(!(!(r=e.length)||isNaN(t=+t))){if(t<=0||r<2)return+n(e[0],0,e);if(t>=1)return+n(e[r-1],r-1,e);var r,i=(r-1)*t,s=Math.floor(i),o=+n(e[s],s,e),a=+n(e[s+1],s+1,e);return o+(a-o)*(i-s)}}function ntt(e,t,n){e=+e,t=+t,n=(i=arguments.length)<2?(t=e,e=0,1):i<3?1:+n;for(var r=-1,i=Math.max(0,Math.ceil((t-e)/n))|0,s=new Array(i);++r<i;)s[r]=e+r*n;return s}function rtt(e){return Math.abs(e=Math.round(e))>=1e21?e.toLocaleString("en").replace(/,/g,""):e.toString(10)}function AE(e,t){if((n=(e=t?e.toExponential(t-1):e.toExponential()).indexOf("e"))<0)return null;var n,r=e.slice(0,n);return[r.length>1?r[0]+r.slice(2):r,+e.slice(n+1)]}function c0(e){return e=AE(Math.abs(e)),e?e[1]:NaN}function itt(e,t){return function(n,r){for(var i=n.length,s=[],o=0,a=e[0],u=0;i>0&&a>0&&(u+a+1>r&&(a=Math.max(1,r-u)),s.push(n.substring(i-=a,i+a)),!((u+=a+1)>r));)a=e[o=(o+1)%e.length];return s.reverse().join(t)}}function stt(e){return function(t){return t.replace(/[0-9]/g,function(n){return e[+n]})}}var ott=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function _p(e){if(!(t=ott.exec(e)))throw new Error("invalid format: "+e);var t;return new Zz({fill:t[1],align:t[2],sign:t[3],symbol:t[4],zero:t[5],width:t[6],comma:t[7],precision:t[8]&&t[8].slice(1),trim:t[9],type:t[10]})}_p.prototype=Zz.prototype;function Zz(e){this.fill=e.fill===void 0?" ":e.fill+"",this.align=e.align===void 0?">":e.align+"",this.sign=e.sign===void 0?"-":e.sign+"",this.symbol=e.symbol===void 0?"":e.symbol+"",this.zero=!!e.zero,this.width=e.width===void 0?void 0:+e.width,this.comma=!!e.comma,this.precision=e.precision===void 0?void 0:+e.precision,this.trim=!!e.trim,this.type=e.type===void 0?"":e.type+""}Zz.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function att(e){e:for(var t=e.length,n=1,r=-1,i;n<t;++n)switch(e[n]){case".":r=i=n;break;case"0":r===0&&(r=n),i=n;break;default:if(!+e[n])break e;r>0&&(r=0);break}return r>0?e.slice(0,r)+e.slice(i+1):e}var Rce;function utt(e,t){var n=AE(e,t);if(!n)return e+"";var r=n[0],i=n[1],s=i-(Rce=Math.max(-8,Math.min(8,Math.floor(i/3)))*3)+1,o=r.length;return s===o?r:s>o?r+new Array(s-o+1).join("0"):s>0?r.slice(0,s)+"."+r.slice(s):"0."+new Array(1-s).join("0")+AE(e,Math.max(0,t+s-1))[0]}function iq(e,t){var n=AE(e,t);if(!n)return e+"";var r=n[0],i=n[1];return i<0?"0."+new Array(-i).join("0")+r:r.length>i+1?r.slice(0,i+1)+"."+r.slice(i+1):r+new Array(i-r.length+2).join("0")}const sq={"%":(e,t)=>(e*100).toFixed(t),b:e=>Math.round(e).toString(2),c:e=>e+"",d:rtt,e:(e,t)=>e.toExponential(t),f:(e,t)=>e.toFixed(t),g:(e,t)=>e.toPrecision(t),o:e=>Math.round(e).toString(8),p:(e,t)=>iq(e*100,t),r:iq,s:utt,X:e=>Math.round(e).toString(16).toUpperCase(),x:e=>Math.round(e).toString(16)};function oq(e){return e}var aq=Array.prototype.map,uq=["y","z","a","f","p","n","","m","","k","M","G","T","P","E","Z","Y"];function ltt(e){var t=e.grouping===void 0||e.thousands===void 0?oq:itt(aq.call(e.grouping,Number),e.thousands+""),n=e.currency===void 0?"":e.currency[0]+"",r=e.currency===void 0?"":e.currency[1]+"",i=e.decimal===void 0?".":e.decimal+"",s=e.numerals===void 0?oq:stt(aq.call(e.numerals,String)),o=e.percent===void 0?"%":e.percent+"",a=e.minus===void 0?"":e.minus+"",u=e.nan===void 0?"NaN":e.nan+"";function l(f){f=_p(f);var h=f.fill,d=f.align,p=f.sign,g=f.symbol,m=f.zero,y=f.width,b=f.comma,v=f.precision,x=f.trim,w=f.type;w==="n"?(b=!0,w="g"):sq[w]||(v===void 0&&(v=12),x=!0,w="g"),(m||h==="0"&&d==="=")&&(m=!0,h="0",d="=");var C=g==="$"?n:g==="#"&&/[boxX]/.test(w)?"0"+w.toLowerCase():"",$=g==="$"?r:/[%p]/.test(w)?o:"",S=sq[w],k=/[defgprs%]/.test(w);v=v===void 0?6:/[gprs]/.test(w)?Math.max(1,Math.min(21,v)):Math.max(0,Math.min(20,v));function E(_){var D=C,A=$,T,I,F;if(w==="c")A=S(_)+A,_="";else{_=+_;var R=_<0||1/_<0;if(_=isNaN(_)?u:S(Math.abs(_),v),x&&(_=att(_)),R&&+_==0&&p!=="+"&&(R=!1),D=(R?p==="("?p:a:p==="-"||p==="("?"":p)+D,A=(w==="s"?uq[8+Rce/3]:"")+A+(R&&p==="("?")":""),k){for(T=-1,I=_.length;++T<I;)if(F=_.charCodeAt(T),48>F||F>57){A=(F===46?i+_.slice(T+1):_.slice(T))+A,_=_.slice(0,T);break}}}b&&!m&&(_=t(_,1/0));var L=D.length+_.length+A.length,P=L<y?new Array(y-L+1).join(h):"";switch(b&&m&&(_=t(P+_,P.length?y-A.length:1/0),P=""),d){case"<":_=D+_+A+P;break;case"=":_=D+P+_+A;break;case"^":_=P.slice(0,L=P.length>>1)+D+_+A+P.slice(L);break;default:_=P+D+_+A;break}return s(_)}return E.toString=function(){return f+""},E}function c(f,h){var d=l((f=_p(f),f.type="f",f)),p=Math.max(-8,Math.min(8,Math.floor(c0(h)/3)))*3,g=Math.pow(10,-p),m=uq[8+p/3];return function(y){return d(g*y)+m}}return{format:l,formatPrefix:c}}var KC,mD,Jz;ctt({thousands:",",grouping:[3],currency:["$",""]});function ctt(e){return KC=ltt(e),mD=KC.format,Jz=KC.formatPrefix,KC}function Mce(e){return Math.max(0,-c0(Math.abs(e)))}function Lce(e,t){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(c0(t)/3)))*3-c0(Math.abs(e)))}function Pce(e,t){return e=Math.abs(e),t=Math.abs(t)-e,Math.max(0,c0(t)-c0(e))+1}const j3=new Date,W3=new Date;function mr(e,t,n,r){function i(s){return e(s=arguments.length===0?new Date:new Date(+s)),s}return i.floor=s=>(e(s=new Date(+s)),s),i.ceil=s=>(e(s=new Date(s-1)),t(s,1),e(s),s),i.round=s=>{const o=i(s),a=i.ceil(s);return s-o<a-s?o:a},i.offset=(s,o)=>(t(s=new Date(+s),o==null?1:Math.floor(o)),s),i.range=(s,o,a)=>{const u=[];if(s=i.ceil(s),a=a==null?1:Math.floor(a),!(s<o)||!(a>0))return u;let l;do u.push(l=new Date(+s)),t(s,a),e(s);while(l<s&&s<o);return u},i.filter=s=>mr(o=>{if(o>=o)for(;e(o),!s(o);)o.setTime(o-1)},(o,a)=>{if(o>=o)if(a<0)for(;++a<=0;)for(;t(o,-1),!s(o););else for(;--a>=0;)for(;t(o,1),!s(o););}),n&&(i.count=(s,o)=>(j3.setTime(+s),W3.setTime(+o),e(j3),e(W3),Math.floor(n(j3,W3))),i.every=s=>(s=Math.floor(s),!isFinite(s)||!(s>0)?null:s>1?i.filter(r?o=>r(o)%s===0:o=>i.count(0,o)%s===0):i)),i}const f0=mr(()=>{},(e,t)=>{e.setTime(+e+t)},(e,t)=>t-e);f0.every=e=>(e=Math.floor(e),!isFinite(e)||!(e>0)?null:e>1?mr(t=>{t.setTime(Math.floor(t/e)*e)},(t,n)=>{t.setTime(+t+n*e)},(t,n)=>(n-t)/e):f0);f0.range;const jl=1e3,Ao=jl*60,Wl=Ao*60,fc=Wl*24,Qz=fc*7,lq=fc*30,V3=fc*365,Vl=mr(e=>{e.setTime(e-e.getMilliseconds())},(e,t)=>{e.setTime(+e+t*jl)},(e,t)=>(t-e)/jl,e=>e.getUTCSeconds());Vl.range;const yD=mr(e=>{e.setTime(e-e.getMilliseconds()-e.getSeconds()*jl)},(e,t)=>{e.setTime(+e+t*Ao)},(e,t)=>(t-e)/Ao,e=>e.getMinutes());yD.range;const bD=mr(e=>{e.setUTCSeconds(0,0)},(e,t)=>{e.setTime(+e+t*Ao)},(e,t)=>(t-e)/Ao,e=>e.getUTCMinutes());bD.range;const xD=mr(e=>{e.setTime(e-e.getMilliseconds()-e.getSeconds()*jl-e.getMinutes()*Ao)},(e,t)=>{e.setTime(+e+t*Wl)},(e,t)=>(t-e)/Wl,e=>e.getHours());xD.range;const vD=mr(e=>{e.setUTCMinutes(0,0,0)},(e,t)=>{e.setTime(+e+t*Wl)},(e,t)=>(t-e)/Wl,e=>e.getUTCHours());vD.range;const Af=mr(e=>e.setHours(0,0,0,0),(e,t)=>e.setDate(e.getDate()+t),(e,t)=>(t-e-(t.getTimezoneOffset()-e.getTimezoneOffset())*Ao)/fc,e=>e.getDate()-1);Af.range;const np=mr(e=>{e.setUTCHours(0,0,0,0)},(e,t)=>{e.setUTCDate(e.getUTCDate()+t)},(e,t)=>(t-e)/fc,e=>e.getUTCDate()-1);np.range;const Bce=mr(e=>{e.setUTCHours(0,0,0,0)},(e,t)=>{e.setUTCDate(e.getUTCDate()+t)},(e,t)=>(t-e)/fc,e=>Math.floor(e/fc));Bce.range;function $g(e){return mr(t=>{t.setDate(t.getDate()-(t.getDay()+7-e)%7),t.setHours(0,0,0,0)},(t,n)=>{t.setDate(t.getDate()+n*7)},(t,n)=>(n-t-(n.getTimezoneOffset()-t.getTimezoneOffset())*Ao)/Qz)}const u$=$g(0),TE=$g(1),ftt=$g(2),htt=$g(3),h0=$g(4),dtt=$g(5),ptt=$g(6);u$.range;TE.range;ftt.range;htt.range;h0.range;dtt.range;ptt.range;function Cg(e){return mr(t=>{t.setUTCDate(t.getUTCDate()-(t.getUTCDay()+7-e)%7),t.setUTCHours(0,0,0,0)},(t,n)=>{t.setUTCDate(t.getUTCDate()+n*7)},(t,n)=>(n-t)/Qz)}const l$=Cg(0),IE=Cg(1),gtt=Cg(2),mtt=Cg(3),d0=Cg(4),ytt=Cg(5),btt=Cg(6);l$.range;IE.range;gtt.range;mtt.range;d0.range;ytt.range;btt.range;const vv=mr(e=>{e.setDate(1),e.setHours(0,0,0,0)},(e,t)=>{e.setMonth(e.getMonth()+t)},(e,t)=>t.getMonth()-e.getMonth()+(t.getFullYear()-e.getFullYear())*12,e=>e.getMonth());vv.range;const wv=mr(e=>{e.setUTCDate(1),e.setUTCHours(0,0,0,0)},(e,t)=>{e.setUTCMonth(e.getUTCMonth()+t)},(e,t)=>t.getUTCMonth()-e.getUTCMonth()+(t.getUTCFullYear()-e.getUTCFullYear())*12,e=>e.getUTCMonth());wv.range;const Uu=mr(e=>{e.setMonth(0,1),e.setHours(0,0,0,0)},(e,t)=>{e.setFullYear(e.getFullYear()+t)},(e,t)=>t.getFullYear()-e.getFullYear(),e=>e.getFullYear());Uu.every=e=>!isFinite(e=Math.floor(e))||!(e>0)?null:mr(t=>{t.setFullYear(Math.floor(t.getFullYear()/e)*e),t.setMonth(0,1),t.setHours(0,0,0,0)},(t,n)=>{t.setFullYear(t.getFullYear()+n*e)});Uu.range;const ju=mr(e=>{e.setUTCMonth(0,1),e.setUTCHours(0,0,0,0)},(e,t)=>{e.setUTCFullYear(e.getUTCFullYear()+t)},(e,t)=>t.getUTCFullYear()-e.getUTCFullYear(),e=>e.getUTCFullYear());ju.every=e=>!isFinite(e=Math.floor(e))||!(e>0)?null:mr(t=>{t.setUTCFullYear(Math.floor(t.getUTCFullYear()/e)*e),t.setUTCMonth(0,1),t.setUTCHours(0,0,0,0)},(t,n)=>{t.setUTCFullYear(t.getUTCFullYear()+n*e)});ju.range;function zce(e,t,n,r,i,s){const o=[[Vl,1,jl],[Vl,5,5*jl],[Vl,15,15*jl],[Vl,30,30*jl],[s,1,Ao],[s,5,5*Ao],[s,15,15*Ao],[s,30,30*Ao],[i,1,Wl],[i,3,3*Wl],[i,6,6*Wl],[i,12,12*Wl],[r,1,fc],[r,2,2*fc],[n,1,Qz],[t,1,lq],[t,3,3*lq],[e,1,V3]];function a(l,c,f){const h=c<l;h&&([l,c]=[c,l]);const d=f&&typeof f.range=="function"?f:u(l,c,f),p=d?d.range(l,+c+1):[];return h?p.reverse():p}function u(l,c,f){const h=Math.abs(c-l)/f,d=Kz(([,,m])=>m).right(o,h);if(d===o.length)return e.every(_E(l/V3,c/V3,f));if(d===0)return f0.every(Math.max(_E(l,c,f),1));const[p,g]=o[h/o[d-1][2]<o[d][2]/h?d-1:d];return p.every(g)}return[a,u]}const[xtt,vtt]=zce(ju,wv,l$,Bce,vD,bD),[wtt,$tt]=zce(Uu,vv,u$,Af,xD,yD),$v="year",Cv="quarter",Sv="month",kv="week",Ev="date",wD="day",e8="dayofyear",_v="hours",Av="minutes",Tv="seconds",$D="milliseconds",Ctt=[$v,Cv,Sv,kv,Ev,wD,e8,_v,Av,Tv,$D];Ctt.reduce((e,t,n)=>(e[t]=1+n,e),{});const Stt={[$v]:Uu,[Cv]:vv.every(3),[Sv]:vv,[kv]:u$,[Ev]:Af,[wD]:Af,[e8]:Af,[_v]:xD,[Av]:yD,[Tv]:Vl,[$D]:f0},ktt={[$v]:ju,[Cv]:wv.every(3),[Sv]:wv,[kv]:l$,[Ev]:np,[wD]:np,[e8]:np,[_v]:vD,[Av]:bD,[Tv]:Vl,[$D]:f0};function Ett(e){return Stt[e]}function _tt(e){return ktt[e]}function G3(e){if(0<=e.y&&e.y<100){var t=new Date(-1,e.m,e.d,e.H,e.M,e.S,e.L);return t.setFullYear(e.y),t}return new Date(e.y,e.m,e.d,e.H,e.M,e.S,e.L)}function H3(e){if(0<=e.y&&e.y<100){var t=new Date(Date.UTC(-1,e.m,e.d,e.H,e.M,e.S,e.L));return t.setUTCFullYear(e.y),t}return new Date(Date.UTC(e.y,e.m,e.d,e.H,e.M,e.S,e.L))}function tb(e,t,n){return{y:e,m:t,d:n,H:0,M:0,S:0,L:0}}function Att(e){var t=e.dateTime,n=e.date,r=e.time,i=e.periods,s=e.days,o=e.shortDays,a=e.months,u=e.shortMonths,l=nb(i),c=rb(i),f=nb(s),h=rb(s),d=nb(o),p=rb(o),g=nb(a),m=rb(a),y=nb(u),b=rb(u),v={a:R,A:L,b:P,B:q,c:null,d:gq,e:gq,f:Ztt,g:ant,G:lnt,H:Xtt,I:Ytt,j:Ktt,L:Uce,m:Jtt,M:Qtt,p:X,q:G,Q:bq,s:xq,S:ent,u:tnt,U:nnt,V:rnt,w:int,W:snt,x:null,X:null,y:ont,Y:unt,Z:cnt,"%":yq},x={a:J,A:Q,b:ee,B:ue,c:null,d:mq,e:mq,f:pnt,g:Snt,G:Ent,H:fnt,I:hnt,j:dnt,L:Wce,m:gnt,M:mnt,p:ge,q:xe,Q:bq,s:xq,S:ynt,u:bnt,U:xnt,V:vnt,w:wnt,W:$nt,x:null,X:null,y:Cnt,Y:knt,Z:_nt,"%":yq},w={a:E,A:_,b:D,B:A,c:T,d:dq,e:dq,f:Vtt,g:hq,G:fq,H:pq,I:pq,j:ztt,L:Wtt,m:Btt,M:Utt,p:k,q:Ptt,Q:Htt,s:qtt,S:jtt,u:Ftt,U:Ott,V:Rtt,w:Ntt,W:Mtt,x:I,X:F,y:hq,Y:fq,Z:Ltt,"%":Gtt};v.x=C(n,v),v.X=C(r,v),v.c=C(t,v),x.x=C(n,x),x.X=C(r,x),x.c=C(t,x);function C(B,H){return function(Y){var M=[],he=-1,ae=0,me=B.length,de,Oe,Ye;for(Y instanceof Date||(Y=new Date(+Y));++he<me;)B.charCodeAt(he)===37&&(M.push(B.slice(ae,he)),(Oe=cq[de=B.charAt(++he)])!=null?de=B.charAt(++he):Oe=de==="e"?" ":"0",(Ye=H[de])&&(de=Ye(Y,Oe)),M.push(de),ae=he+1);return M.push(B.slice(ae,he)),M.join("")}}function $(B,H){return function(Y){var M=tb(1900,void 0,1),he=S(M,B,Y+="",0),ae,me;if(he!=Y.length)return null;if("Q"in M)return new Date(M.Q);if("s"in M)return new Date(M.s*1e3+("L"in M?M.L:0));if(H&&!("Z"in M)&&(M.Z=0),"p"in M&&(M.H=M.H%12+M.p*12),M.m===void 0&&(M.m="q"in M?M.q:0),"V"in M){if(M.V<1||M.V>53)return null;"w"in M||(M.w=1),"Z"in M?(ae=H3(tb(M.y,0,1)),me=ae.getUTCDay(),ae=me>4||me===0?IE.ceil(ae):IE(ae),ae=np.offset(ae,(M.V-1)*7),M.y=ae.getUTCFullYear(),M.m=ae.getUTCMonth(),M.d=ae.getUTCDate()+(M.w+6)%7):(ae=G3(tb(M.y,0,1)),me=ae.getDay(),ae=me>4||me===0?TE.ceil(ae):TE(ae),ae=Af.offset(ae,(M.V-1)*7),M.y=ae.getFullYear(),M.m=ae.getMonth(),M.d=ae.getDate()+(M.w+6)%7)}else("W"in M||"U"in M)&&("w"in M||(M.w="u"in M?M.u%7:"W"in M?1:0),me="Z"in M?H3(tb(M.y,0,1)).getUTCDay():G3(tb(M.y,0,1)).getDay(),M.m=0,M.d="W"in M?(M.w+6)%7+M.W*7-(me+5)%7:M.w+M.U*7-(me+6)%7);return"Z"in M?(M.H+=M.Z/100|0,M.M+=M.Z%100,H3(M)):G3(M)}}function S(B,H,Y,M){for(var he=0,ae=H.length,me=Y.length,de,Oe;he<ae;){if(M>=me)return-1;if(de=H.charCodeAt(he++),de===37){if(de=H.charAt(he++),Oe=w[de in cq?H.charAt(he++):de],!Oe||(M=Oe(B,Y,M))<0)return-1}else if(de!=Y.charCodeAt(M++))return-1}return M}function k(B,H,Y){var M=l.exec(H.slice(Y));return M?(B.p=c.get(M[0].toLowerCase()),Y+M[0].length):-1}function E(B,H,Y){var M=d.exec(H.slice(Y));return M?(B.w=p.get(M[0].toLowerCase()),Y+M[0].length):-1}function _(B,H,Y){var M=f.exec(H.slice(Y));return M?(B.w=h.get(M[0].toLowerCase()),Y+M[0].length):-1}function D(B,H,Y){var M=y.exec(H.slice(Y));return M?(B.m=b.get(M[0].toLowerCase()),Y+M[0].length):-1}function A(B,H,Y){var M=g.exec(H.slice(Y));return M?(B.m=m.get(M[0].toLowerCase()),Y+M[0].length):-1}function T(B,H,Y){return S(B,t,H,Y)}function I(B,H,Y){return S(B,n,H,Y)}function F(B,H,Y){return S(B,r,H,Y)}function R(B){return o[B.getDay()]}function L(B){return s[B.getDay()]}function P(B){return u[B.getMonth()]}function q(B){return a[B.getMonth()]}function X(B){return i[+(B.getHours()>=12)]}function G(B){return 1+~~(B.getMonth()/3)}function J(B){return o[B.getUTCDay()]}function Q(B){return s[B.getUTCDay()]}function ee(B){return u[B.getUTCMonth()]}function ue(B){return a[B.getUTCMonth()]}function ge(B){return i[+(B.getUTCHours()>=12)]}function xe(B){return 1+~~(B.getUTCMonth()/3)}return{format:function(B){var H=C(B+="",v);return H.toString=function(){return B},H},parse:function(B){var H=$(B+="",!1);return H.toString=function(){return B},H},utcFormat:function(B){var H=C(B+="",x);return H.toString=function(){return B},H},utcParse:function(B){var H=$(B+="",!0);return H.toString=function(){return B},H}}}var cq={"-":"",_:" ",0:"0"},Br=/^\s*\d+/,Ttt=/^%/,Itt=/[\\^$*+?|[\]().{}]/g;function Dt(e,t,n){var r=e<0?"-":"",i=(r?-e:e)+"",s=i.length;return r+(s<n?new Array(n-s+1).join(t)+i:i)}function Dtt(e){return e.replace(Itt,"\\$&")}function nb(e){return new RegExp("^(?:"+e.map(Dtt).join("|")+")","i")}function rb(e){return new Map(e.map((t,n)=>[t.toLowerCase(),n]))}function Ntt(e,t,n){var r=Br.exec(t.slice(n,n+1));return r?(e.w=+r[0],n+r[0].length):-1}function Ftt(e,t,n){var r=Br.exec(t.slice(n,n+1));return r?(e.u=+r[0],n+r[0].length):-1}function Ott(e,t,n){var r=Br.exec(t.slice(n,n+2));return r?(e.U=+r[0],n+r[0].length):-1}function Rtt(e,t,n){var r=Br.exec(t.slice(n,n+2));return r?(e.V=+r[0],n+r[0].length):-1}function Mtt(e,t,n){var r=Br.exec(t.slice(n,n+2));return r?(e.W=+r[0],n+r[0].length):-1}function fq(e,t,n){var r=Br.exec(t.slice(n,n+4));return r?(e.y=+r[0],n+r[0].length):-1}function hq(e,t,n){var r=Br.exec(t.slice(n,n+2));return r?(e.y=+r[0]+(+r[0]>68?1900:2e3),n+r[0].length):-1}function Ltt(e,t,n){var r=/^(Z)|([+-]\d\d)(?::?(\d\d))?/.exec(t.slice(n,n+6));return r?(e.Z=r[1]?0:-(r[2]+(r[3]||"00")),n+r[0].length):-1}function Ptt(e,t,n){var r=Br.exec(t.slice(n,n+1));return r?(e.q=r[0]*3-3,n+r[0].length):-1}function Btt(e,t,n){var r=Br.exec(t.slice(n,n+2));return r?(e.m=r[0]-1,n+r[0].length):-1}function dq(e,t,n){var r=Br.exec(t.slice(n,n+2));return r?(e.d=+r[0],n+r[0].length):-1}function ztt(e,t,n){var r=Br.exec(t.slice(n,n+3));return r?(e.m=0,e.d=+r[0],n+r[0].length):-1}function pq(e,t,n){var r=Br.exec(t.slice(n,n+2));return r?(e.H=+r[0],n+r[0].length):-1}function Utt(e,t,n){var r=Br.exec(t.slice(n,n+2));return r?(e.M=+r[0],n+r[0].length):-1}function jtt(e,t,n){var r=Br.exec(t.slice(n,n+2));return r?(e.S=+r[0],n+r[0].length):-1}function Wtt(e,t,n){var r=Br.exec(t.slice(n,n+3));return r?(e.L=+r[0],n+r[0].length):-1}function Vtt(e,t,n){var r=Br.exec(t.slice(n,n+6));return r?(e.L=Math.floor(r[0]/1e3),n+r[0].length):-1}function Gtt(e,t,n){var r=Ttt.exec(t.slice(n,n+1));return r?n+r[0].length:-1}function Htt(e,t,n){var r=Br.exec(t.slice(n));return r?(e.Q=+r[0],n+r[0].length):-1}function qtt(e,t,n){var r=Br.exec(t.slice(n));return r?(e.s=+r[0],n+r[0].length):-1}function gq(e,t){return Dt(e.getDate(),t,2)}function Xtt(e,t){return Dt(e.getHours(),t,2)}function Ytt(e,t){return Dt(e.getHours()%12||12,t,2)}function Ktt(e,t){return Dt(1+Af.count(Uu(e),e),t,3)}function Uce(e,t){return Dt(e.getMilliseconds(),t,3)}function Ztt(e,t){return Uce(e,t)+"000"}function Jtt(e,t){return Dt(e.getMonth()+1,t,2)}function Qtt(e,t){return Dt(e.getMinutes(),t,2)}function ent(e,t){return Dt(e.getSeconds(),t,2)}function tnt(e){var t=e.getDay();return t===0?7:t}function nnt(e,t){return Dt(u$.count(Uu(e)-1,e),t,2)}function jce(e){var t=e.getDay();return t>=4||t===0?h0(e):h0.ceil(e)}function rnt(e,t){return e=jce(e),Dt(h0.count(Uu(e),e)+(Uu(e).getDay()===4),t,2)}function int(e){return e.getDay()}function snt(e,t){return Dt(TE.count(Uu(e)-1,e),t,2)}function ont(e,t){return Dt(e.getFullYear()%100,t,2)}function ant(e,t){return e=jce(e),Dt(e.getFullYear()%100,t,2)}function unt(e,t){return Dt(e.getFullYear()%1e4,t,4)}function lnt(e,t){var n=e.getDay();return e=n>=4||n===0?h0(e):h0.ceil(e),Dt(e.getFullYear()%1e4,t,4)}function cnt(e){var t=e.getTimezoneOffset();return(t>0?"-":(t*=-1,"+"))+Dt(t/60|0,"0",2)+Dt(t%60,"0",2)}function mq(e,t){return Dt(e.getUTCDate(),t,2)}function fnt(e,t){return Dt(e.getUTCHours(),t,2)}function hnt(e,t){return Dt(e.getUTCHours()%12||12,t,2)}function dnt(e,t){return Dt(1+np.count(ju(e),e),t,3)}function Wce(e,t){return Dt(e.getUTCMilliseconds(),t,3)}function pnt(e,t){return Wce(e,t)+"000"}function gnt(e,t){return Dt(e.getUTCMonth()+1,t,2)}function mnt(e,t){return Dt(e.getUTCMinutes(),t,2)}function ynt(e,t){return Dt(e.getUTCSeconds(),t,2)}function bnt(e){var t=e.getUTCDay();return t===0?7:t}function xnt(e,t){return Dt(l$.count(ju(e)-1,e),t,2)}function Vce(e){var t=e.getUTCDay();return t>=4||t===0?d0(e):d0.ceil(e)}function vnt(e,t){return e=Vce(e),Dt(d0.count(ju(e),e)+(ju(e).getUTCDay()===4),t,2)}function wnt(e){return e.getUTCDay()}function $nt(e,t){return Dt(IE.count(ju(e)-1,e),t,2)}function Cnt(e,t){return Dt(e.getUTCFullYear()%100,t,2)}function Snt(e,t){return e=Vce(e),Dt(e.getUTCFullYear()%100,t,2)}function knt(e,t){return Dt(e.getUTCFullYear()%1e4,t,4)}function Ent(e,t){var n=e.getUTCDay();return e=n>=4||n===0?d0(e):d0.ceil(e),Dt(e.getUTCFullYear()%1e4,t,4)}function _nt(){return"+0000"}function yq(){return"%"}function bq(e){return+e}function xq(e){return Math.floor(+e/1e3)}var tm,t8,Gce,n8,Hce;Ant({dateTime:"%x, %X",date:"%-m/%-d/%Y",time:"%-I:%M:%S %p",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]});function Ant(e){return tm=Att(e),t8=tm.format,Gce=tm.parse,n8=tm.utcFormat,Hce=tm.utcParse,tm}function Ub(e){const t={};return n=>t[n]||(t[n]=e(n))}function Tnt(e,t){return n=>{const r=e(n),i=r.indexOf(t);if(i<0)return r;let s=Int(r,i);const o=s<r.length?r.slice(s):"";for(;--s>i;)if(r[s]!=="0"){++s;break}return r.slice(0,s)+o}}function Int(e,t){let n=e.lastIndexOf("e"),r;if(n>0)return n;for(n=e.length;--n>t;)if(r=e.charCodeAt(n),r>=48&&r<=57)return n+1}function Dnt(e){const t=Ub(e.format),n=e.formatPrefix;return{format:t,formatPrefix:n,formatFloat(r){const i=_p(r||",");if(i.precision==null){switch(i.precision=12,i.type){case"%":i.precision-=2;break;case"e":i.precision-=1;break}return Tnt(t(i),t(".1f")(1)[1])}else return t(i)},formatSpan(r,i,s,o){o=_p(o??",f");const a=_E(r,i,s),u=Math.max(Math.abs(r),Math.abs(i));let l;if(o.precision==null)switch(o.type){case"s":return isNaN(l=Lce(a,u))||(o.precision=l),n(o,u);case"":case"e":case"g":case"p":case"r":{isNaN(l=Pce(a,u))||(o.precision=l-(o.type==="e"));break}case"f":case"%":{isNaN(l=Mce(a))||(o.precision=l-(o.type==="%")*2);break}}return t(o)}}}Nnt();function Nnt(){return Dnt({format:mD,formatPrefix:Jz})}function vq(e,t,n){n=n||{},Uz(n)||ec(`Invalid time multi-format specifier: ${n}`);const r=t(Tv),i=t(Av),s=t(_v),o=t(Ev),a=t(kv),u=t(Sv),l=t(Cv),c=t($v),f=e(n[$D]||".%L"),h=e(n[Tv]||":%S"),d=e(n[Av]||"%I:%M"),p=e(n[_v]||"%I %p"),g=e(n[Ev]||n[wD]||"%a %d"),m=e(n[kv]||"%b %d"),y=e(n[Sv]||"%B"),b=e(n[Cv]||"%B"),v=e(n[$v]||"%Y");return x=>(r(x)<x?f:i(x)<x?h:s(x)<x?d:o(x)<x?p:u(x)<x?a(x)<x?g:m:c(x)<x?l(x)<x?y:b:v)(x)}function Fnt(e){const t=Ub(e.format),n=Ub(e.utcFormat);return{timeFormat:r=>wE(r)?t(r):vq(t,Ett,r),utcFormat:r=>wE(r)?n(r):vq(n,_tt,r),timeParse:Ub(e.parse),utcParse:Ub(e.utcParse)}}Ont();function Ont(){return Fnt({format:t8,parse:Gce,utcFormat:n8,utcParse:Hce})}const Rnt=/^(data:|([A-Za-z]+:)?\/\/)/,Mnt=/^(?:(?:(?:f|ht)tps?|mailto|tel|callto|cid|xmpp|file|data):|[^a-z]|[a-z+.\-]+(?:[^a-z+.\-:]|$))/i,Lnt=/[\u0000-\u0020\u00A0\u1680\u180E\u2000-\u2029\u205f\u3000]/g,wq="file://";function Pnt(e,t){return n=>({options:n||{},sanitize:znt,load:Bnt,fileAccess:!!t,file:Unt(t),http:Wnt(e)})}async function Bnt(e,t){const n=await this.sanitize(e,t),r=n.href;return n.localFile?this.file(r):this.http(r,t)}async function znt(e,t){t=hD({},this.options,t);const n=this.fileAccess,r={href:null};let i,s,o;const a=Mnt.test(e.replace(Lnt,""));(e==null||typeof e!="string"||!a)&&ec("Sanitize failure, invalid URI: "+dce(e));const u=Rnt.test(e);return(o=t.baseURL)&&!u&&(!e.startsWith("/")&&!o.endsWith("/")&&(e="/"+e),e=o+e),s=(i=e.startsWith(wq))||t.mode==="file"||t.mode!=="http"&&!u&&n,i?e=e.slice(wq.length):e.startsWith("//")&&(t.defaultProtocol==="file"?(e=e.slice(2),s=!0):e=(t.defaultProtocol||"http")+":"+e),Object.defineProperty(r,"localFile",{value:!!s}),r.href=e,t.target&&(r.target=t.target+""),t.rel&&(r.rel=t.rel+""),t.context==="image"&&t.crossOrigin&&(r.crossOrigin=t.crossOrigin+""),r}function Unt(e){return e?t=>new Promise((n,r)=>{e.readFile(t,(i,s)=>{i?r(i):n(s)})}):jnt}async function jnt(){ec("No file system access.")}function Wnt(e){return e?async function(t,n){const r=hD({},this.options.http,n),i=n&&n.response,s=await e(t,r);return s.ok?fD(s[i])?s[i]():s.text():ec(s.status+""+s.statusText)}:Vnt}async function Vnt(){ec("No HTTP fetch method available.")}const qce=Pnt(typeof fetch<"u"&&fetch,null);function el(e,t){switch(arguments.length){case 0:break;case 1:this.range(e);break;default:this.range(t).domain(e);break}return this}function Fh(e,t){switch(arguments.length){case 0:break;case 1:{typeof e=="function"?this.interpolator(e):this.range(e);break}default:{this.domain(e),typeof t=="function"?this.interpolator(t):this.range(t);break}}return this}const $q=Symbol("implicit");function r8(){var e=new lE,t=[],n=[],r=$q;function i(s){let o=e.get(s);if(o===void 0){if(r!==$q)return r;e.set(s,o=t.push(s)-1)}return n[o%n.length]}return i.domain=function(s){if(!arguments.length)return t.slice();t=[],e=new lE;for(const o of s)e.has(o)||e.set(o,t.push(o)-1);return i},i.range=function(s){return arguments.length?(n=Array.from(s),i):n.slice()},i.unknown=function(s){return arguments.length?(r=s,i):r},i.copy=function(){return r8(t,n).unknown(r)},el.apply(i,arguments),i}function dy(e,t,n){e.prototype=t.prototype=n,n.constructor=e}function c$(e,t){var n=Object.create(e.prototype);for(var r in t)n[r]=t[r];return n}function Oh(){}var Ap=.7,p0=1/Ap,Om="\\s*([+-]?\\d+)\\s*",Iv="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)\\s*",_u="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)%\\s*",Gnt=/^#([0-9a-f]{3,8})$/,Hnt=new RegExp("^rgb\\("+[Om,Om,Om]+"\\)$"),qnt=new RegExp("^rgb\\("+[_u,_u,_u]+"\\)$"),Xnt=new RegExp("^rgba\\("+[Om,Om,Om,Iv]+"\\)$"),Ynt=new RegExp("^rgba\\("+[_u,_u,_u,Iv]+"\\)$"),Knt=new RegExp("^hsl\\("+[Iv,_u,_u]+"\\)$"),Znt=new RegExp("^hsla\\("+[Iv,_u,_u,Iv]+"\\)$"),Cq={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};dy(Oh,hc,{copy:function(e){return Object.assign(new this.constructor,this,e)},displayable:function(){return this.rgb().displayable()},hex:Sq,formatHex:Sq,formatHsl:Jnt,formatRgb:kq,toString:kq});function Sq(){return this.rgb().formatHex()}function Jnt(){return Xce(this).formatHsl()}function kq(){return this.rgb().formatRgb()}function hc(e){var t,n;return e=(e+"").trim().toLowerCase(),(t=Gnt.exec(e))?(n=t[1].length,t=parseInt(t[1],16),n===6?Eq(t):n===3?new Wr(t>>8&15|t>>4&240,t>>4&15|t&240,(t&15)<<4|t&15,1):n===8?ZC(t>>24&255,t>>16&255,t>>8&255,(t&255)/255):n===4?ZC(t>>12&15|t>>8&240,t>>8&15|t>>4&240,t>>4&15|t&240,((t&15)<<4|t&15)/255):null):(t=Hnt.exec(e))?new Wr(t[1],t[2],t[3],1):(t=qnt.exec(e))?new Wr(t[1]*255/100,t[2]*255/100,t[3]*255/100,1):(t=Xnt.exec(e))?ZC(t[1],t[2],t[3],t[4]):(t=Ynt.exec(e))?ZC(t[1]*255/100,t[2]*255/100,t[3]*255/100,t[4]):(t=Knt.exec(e))?Tq(t[1],t[2]/100,t[3]/100,1):(t=Znt.exec(e))?Tq(t[1],t[2]/100,t[3]/100,t[4]):Cq.hasOwnProperty(e)?Eq(Cq[e]):e==="transparent"?new Wr(NaN,NaN,NaN,0):null}function Eq(e){return new Wr(e>>16&255,e>>8&255,e&255,1)}function ZC(e,t,n,r){return r<=0&&(e=t=n=NaN),new Wr(e,t,n,r)}function i8(e){return e instanceof Oh||(e=hc(e)),e?(e=e.rgb(),new Wr(e.r,e.g,e.b,e.opacity)):new Wr}function Ns(e,t,n,r){return arguments.length===1?i8(e):new Wr(e,t,n,r??1)}function Wr(e,t,n,r){this.r=+e,this.g=+t,this.b=+n,this.opacity=+r}dy(Wr,Ns,c$(Oh,{brighter:function(e){return e=e==null?p0:Math.pow(p0,e),new Wr(this.r*e,this.g*e,this.b*e,this.opacity)},darker:function(e){return e=e==null?Ap:Math.pow(Ap,e),new Wr(this.r*e,this.g*e,this.b*e,this.opacity)},rgb:function(){return this},displayable:function(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:_q,formatHex:_q,formatRgb:Aq,toString:Aq}));function _q(){return"#"+q3(this.r)+q3(this.g)+q3(this.b)}function Aq(){var e=this.opacity;return e=isNaN(e)?1:Math.max(0,Math.min(1,e)),(e===1?"rgb(":"rgba(")+Math.max(0,Math.min(255,Math.round(this.r)||0))+", "+Math.max(0,Math.min(255,Math.round(this.g)||0))+", "+Math.max(0,Math.min(255,Math.round(this.b)||0))+(e===1?")":", "+e+")")}function q3(e){return e=Math.max(0,Math.min(255,Math.round(e)||0)),(e<16?"0":"")+e.toString(16)}function Tq(e,t,n,r){return r<=0?e=t=n=NaN:n<=0||n>=1?e=t=NaN:t<=0&&(e=NaN),new cu(e,t,n,r)}function Xce(e){if(e instanceof cu)return new cu(e.h,e.s,e.l,e.opacity);if(e instanceof Oh||(e=hc(e)),!e)return new cu;if(e instanceof cu)return e;e=e.rgb();var t=e.r/255,n=e.g/255,r=e.b/255,i=Math.min(t,n,r),s=Math.max(t,n,r),o=NaN,a=s-i,u=(s+i)/2;return a?(t===s?o=(n-r)/a+(n<r)*6:n===s?o=(r-t)/a+2:o=(t-n)/a+4,a/=u<.5?s+i:2-s-i,o*=60):a=u>0&&u<1?0:o,new cu(o,a,u,e.opacity)}function nh(e,t,n,r){return arguments.length===1?Xce(e):new cu(e,t,n,r??1)}function cu(e,t,n,r){this.h=+e,this.s=+t,this.l=+n,this.opacity=+r}dy(cu,nh,c$(Oh,{brighter:function(e){return e=e==null?p0:Math.pow(p0,e),new cu(this.h,this.s,this.l*e,this.opacity)},darker:function(e){return e=e==null?Ap:Math.pow(Ap,e),new cu(this.h,this.s,this.l*e,this.opacity)},rgb:function(){var e=this.h%360+(this.h<0)*360,t=isNaN(e)||isNaN(this.s)?0:this.s,n=this.l,r=n+(n<.5?n:1-n)*t,i=2*n-r;return new Wr(X3(e>=240?e-240:e+120,i,r),X3(e,i,r),X3(e<120?e+240:e-120,i,r),this.opacity)},displayable:function(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl:function(){var e=this.opacity;return e=isNaN(e)?1:Math.max(0,Math.min(1,e)),(e===1?"hsl(":"hsla(")+(this.h||0)+", "+(this.s||0)*100+"%, "+(this.l||0)*100+"%"+(e===1?")":", "+e+")")}}));function X3(e,t,n){return(e<60?t+(n-t)*e/60:e<180?n:e<240?t+(n-t)*(240-e)/60:t)*255}const Yce=Math.PI/180,Kce=180/Math.PI,DE=18,Zce=.96422,Jce=1,Qce=.82521,efe=4/29,Rm=6/29,tfe=3*Rm*Rm,Qnt=Rm*Rm*Rm;function nfe(e){if(e instanceof Au)return new Au(e.l,e.a,e.b,e.opacity);if(e instanceof Gl)return rfe(e);e instanceof Wr||(e=i8(e));var t=J3(e.r),n=J3(e.g),r=J3(e.b),i=Y3((.2225045*t+.7168786*n+.0606169*r)/Jce),s,o;return t===n&&n===r?s=o=i:(s=Y3((.4360747*t+.3850649*n+.1430804*r)/Zce),o=Y3((.0139322*t+.0971045*n+.7141733*r)/Qce)),new Au(116*i-16,500*(s-i),200*(i-o),e.opacity)}function rh(e,t,n,r){return arguments.length===1?nfe(e):new Au(e,t,n,r??1)}function Au(e,t,n,r){this.l=+e,this.a=+t,this.b=+n,this.opacity=+r}dy(Au,rh,c$(Oh,{brighter:function(e){return new Au(this.l+DE*(e??1),this.a,this.b,this.opacity)},darker:function(e){return new Au(this.l-DE*(e??1),this.a,this.b,this.opacity)},rgb:function(){var e=(this.l+16)/116,t=isNaN(this.a)?e:e+this.a/500,n=isNaN(this.b)?e:e-this.b/200;return t=Zce*K3(t),e=Jce*K3(e),n=Qce*K3(n),new Wr(Z3(3.1338561*t-1.6168667*e-.4906146*n),Z3(-.9787684*t+1.9161415*e+.033454*n),Z3(.0719453*t-.2289914*e+1.4052427*n),this.opacity)}}));function Y3(e){return e>Qnt?Math.pow(e,1/3):e/tfe+efe}function K3(e){return e>Rm?e*e*e:tfe*(e-efe)}function Z3(e){return 255*(e<=.0031308?12.92*e:1.055*Math.pow(e,1/2.4)-.055)}function J3(e){return(e/=255)<=.04045?e/12.92:Math.pow((e+.055)/1.055,2.4)}function ert(e){if(e instanceof Gl)return new Gl(e.h,e.c,e.l,e.opacity);if(e instanceof Au||(e=nfe(e)),e.a===0&&e.b===0)return new Gl(NaN,0<e.l&&e.l<100?0:NaN,e.l,e.opacity);var t=Math.atan2(e.b,e.a)*Kce;return new Gl(t<0?t+360:t,Math.sqrt(e.a*e.a+e.b*e.b),e.l,e.opacity)}function ih(e,t,n,r){return arguments.length===1?ert(e):new Gl(e,t,n,r??1)}function Gl(e,t,n,r){this.h=+e,this.c=+t,this.l=+n,this.opacity=+r}function rfe(e){if(isNaN(e.h))return new Au(e.l,0,0,e.opacity);var t=e.h*Yce;return new Au(e.l,Math.cos(t)*e.c,Math.sin(t)*e.c,e.opacity)}dy(Gl,ih,c$(Oh,{brighter:function(e){return new Gl(this.h,this.c,this.l+DE*(e??1),this.opacity)},darker:function(e){return new Gl(this.h,this.c,this.l-DE*(e??1),this.opacity)},rgb:function(){return rfe(this).rgb()}}));var ife=-.14861,s8=1.78277,o8=-.29227,CD=-.90649,Dv=1.97294,Iq=Dv*CD,Dq=Dv*s8,Nq=s8*o8-CD*ife;function trt(e){if(e instanceof rp)return new rp(e.h,e.s,e.l,e.opacity);e instanceof Wr||(e=i8(e));var t=e.r/255,n=e.g/255,r=e.b/255,i=(Nq*r+Iq*t-Dq*n)/(Nq+Iq-Dq),s=r-i,o=(Dv*(n-i)-o8*s)/CD,a=Math.sqrt(o*o+s*s)/(Dv*i*(1-i)),u=a?Math.atan2(o,s)*Kce-120:NaN;return new rp(u<0?u+360:u,a,i,e.opacity)}function Tp(e,t,n,r){return arguments.length===1?trt(e):new rp(e,t,n,r??1)}function rp(e,t,n,r){this.h=+e,this.s=+t,this.l=+n,this.opacity=+r}dy(rp,Tp,c$(Oh,{brighter:function(e){return e=e==null?p0:Math.pow(p0,e),new rp(this.h,this.s,this.l*e,this.opacity)},darker:function(e){return e=e==null?Ap:Math.pow(Ap,e),new rp(this.h,this.s,this.l*e,this.opacity)},rgb:function(){var e=isNaN(this.h)?0:(this.h+120)*Yce,t=+this.l,n=isNaN(this.s)?0:this.s*t*(1-t),r=Math.cos(e),i=Math.sin(e);return new Wr(255*(t+n*(ife*r+s8*i)),255*(t+n*(o8*r+CD*i)),255*(t+n*(Dv*r)),this.opacity)}}));function sfe(e,t,n,r,i){var s=e*e,o=s*e;return((1-3*e+3*s-o)*t+(4-6*s+3*o)*n+(1+3*e+3*s-3*o)*r+o*i)/6}function ofe(e){var t=e.length-1;return function(n){var r=n<=0?n=0:n>=1?(n=1,t-1):Math.floor(n*t),i=e[r],s=e[r+1],o=r>0?e[r-1]:2*i-s,a=r<t-1?e[r+2]:2*s-i;return sfe((n-r/t)*t,o,i,s,a)}}function afe(e){var t=e.length;return function(n){var r=Math.floor(((n%=1)<0?++n:n)*t),i=e[(r+t-1)%t],s=e[r%t],o=e[(r+1)%t],a=e[(r+2)%t];return sfe((n-r/t)*t,i,s,o,a)}}const SD=e=>()=>e;function ufe(e,t){return function(n){return e+n*t}}function nrt(e,t,n){return e=Math.pow(e,n),t=Math.pow(t,n)-e,n=1/n,function(r){return Math.pow(e+r*t,n)}}function kD(e,t){var n=t-e;return n?ufe(e,n>180||n<-180?n-360*Math.round(n/360):n):SD(isNaN(e)?t:e)}function rrt(e){return(e=+e)==1?Cr:function(t,n){return n-t?nrt(t,n,e):SD(isNaN(t)?n:t)}}function Cr(e,t){var n=t-e;return n?ufe(e,n):SD(isNaN(e)?t:e)}const QM=function e(t){var n=rrt(t);function r(i,s){var o=n((i=Ns(i)).r,(s=Ns(s)).r),a=n(i.g,s.g),u=n(i.b,s.b),l=Cr(i.opacity,s.opacity);return function(c){return i.r=o(c),i.g=a(c),i.b=u(c),i.opacity=l(c),i+""}}return r.gamma=e,r}(1);function lfe(e){return function(t){var n=t.length,r=new Array(n),i=new Array(n),s=new Array(n),o,a;for(o=0;o<n;++o)a=Ns(t[o]),r[o]=a.r||0,i[o]=a.g||0,s[o]=a.b||0;return r=e(r),i=e(i),s=e(s),a.opacity=1,function(u){return a.r=r(u),a.g=i(u),a.b=s(u),a+""}}}var irt=lfe(ofe),srt=lfe(afe);function a8(e,t){t||(t=[]);var n=e?Math.min(t.length,e.length):0,r=t.slice(),i;return function(s){for(i=0;i<n;++i)r[i]=e[i]*(1-s)+t[i]*s;return r}}function cfe(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}function ort(e,t){return(cfe(t)?a8:ffe)(e,t)}function ffe(e,t){var n=t?t.length:0,r=e?Math.min(n,e.length):0,i=new Array(r),s=new Array(n),o;for(o=0;o<r;++o)i[o]=Sg(e[o],t[o]);for(;o<n;++o)s[o]=t[o];return function(a){for(o=0;o<r;++o)s[o]=i[o](a);return s}}function hfe(e,t){var n=new Date;return e=+e,t=+t,function(r){return n.setTime(e*(1-r)+t*r),n}}function ha(e,t){return e=+e,t=+t,function(n){return e*(1-n)+t*n}}function dfe(e,t){var n={},r={},i;(e===null||typeof e!="object")&&(e={}),(t===null||typeof t!="object")&&(t={});for(i in t)i in e?n[i]=Sg(e[i],t[i]):r[i]=t[i];return function(s){for(i in n)r[i]=n[i](s);return r}}var e4=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,Q3=new RegExp(e4.source,"g");function art(e){return function(){return e}}function urt(e){return function(t){return e(t)+""}}function pfe(e,t){var n=e4.lastIndex=Q3.lastIndex=0,r,i,s,o=-1,a=[],u=[];for(e=e+"",t=t+"";(r=e4.exec(e))&&(i=Q3.exec(t));)(s=i.index)>n&&(s=t.slice(n,s),a[o]?a[o]+=s:a[++o]=s),(r=r[0])===(i=i[0])?a[o]?a[o]+=i:a[++o]=i:(a[++o]=null,u.push({i:o,x:ha(r,i)})),n=Q3.lastIndex;return n<t.length&&(s=t.slice(n),a[o]?a[o]+=s:a[++o]=s),a.length<2?u[0]?urt(u[0].x):art(t):(t=u.length,function(l){for(var c=0,f;c<t;++c)a[(f=u[c]).i]=f.x(l);return a.join("")})}function Sg(e,t){var n=typeof t,r;return t==null||n==="boolean"?SD(t):(n==="number"?ha:n==="string"?(r=hc(t))?(t=r,QM):pfe:t instanceof hc?QM:t instanceof Date?hfe:cfe(t)?a8:Array.isArray(t)?ffe:typeof t.valueOf!="function"&&typeof t.toString!="function"||isNaN(t)?dfe:ha)(e,t)}function lrt(e){var t=e.length;return function(n){return e[Math.max(0,Math.min(t-1,Math.floor(n*t)))]}}function crt(e,t){var n=kD(+e,+t);return function(r){var i=n(r);return i-360*Math.floor(i/360)}}function ED(e,t){return e=+e,t=+t,function(n){return Math.round(e*(1-n)+t*n)}}var Fq=180/Math.PI,t4={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function gfe(e,t,n,r,i,s){var o,a,u;return(o=Math.sqrt(e*e+t*t))&&(e/=o,t/=o),(u=e*n+t*r)&&(n-=e*u,r-=t*u),(a=Math.sqrt(n*n+r*r))&&(n/=a,r/=a,u/=a),e*r<t*n&&(e=-e,t=-t,u=-u,o=-o),{translateX:i,translateY:s,rotate:Math.atan2(t,e)*Fq,skewX:Math.atan(u)*Fq,scaleX:o,scaleY:a}}var JC;function frt(e){const t=new(typeof DOMMatrix=="function"?DOMMatrix:WebKitCSSMatrix)(e+"");return t.isIdentity?t4:gfe(t.a,t.b,t.c,t.d,t.e,t.f)}function hrt(e){return e==null||(JC||(JC=document.createElementNS("http://www.w3.org/2000/svg","g")),JC.setAttribute("transform",e),!(e=JC.transform.baseVal.consolidate()))?t4:(e=e.matrix,gfe(e.a,e.b,e.c,e.d,e.e,e.f))}function mfe(e,t,n,r){function i(l){return l.length?l.pop()+" ":""}function s(l,c,f,h,d,p){if(l!==f||c!==h){var g=d.push("translate(",null,t,null,n);p.push({i:g-4,x:ha(l,f)},{i:g-2,x:ha(c,h)})}else(f||h)&&d.push("translate("+f+t+h+n)}function o(l,c,f,h){l!==c?(l-c>180?c+=360:c-l>180&&(l+=360),h.push({i:f.push(i(f)+"rotate(",null,r)-2,x:ha(l,c)})):c&&f.push(i(f)+"rotate("+c+r)}function a(l,c,f,h){l!==c?h.push({i:f.push(i(f)+"skewX(",null,r)-2,x:ha(l,c)}):c&&f.push(i(f)+"skewX("+c+r)}function u(l,c,f,h,d,p){if(l!==f||c!==h){var g=d.push(i(d)+"scale(",null,",",null,")");p.push({i:g-4,x:ha(l,f)},{i:g-2,x:ha(c,h)})}else(f!==1||h!==1)&&d.push(i(d)+"scale("+f+","+h+")")}return function(l,c){var f=[],h=[];return l=e(l),c=e(c),s(l.translateX,l.translateY,c.translateX,c.translateY,f,h),o(l.rotate,c.rotate,f,h),a(l.skewX,c.skewX,f,h),u(l.scaleX,l.scaleY,c.scaleX,c.scaleY,f,h),l=c=null,function(d){for(var p=-1,g=h.length,m;++p<g;)f[(m=h[p]).i]=m.x(d);return f.join("")}}}var drt=mfe(frt,"px, ","px)","deg)"),prt=mfe(hrt,", ",")",")"),grt=1e-12;function Oq(e){return((e=Math.exp(e))+1/e)/2}function mrt(e){return((e=Math.exp(e))-1/e)/2}function yrt(e){return((e=Math.exp(2*e))-1)/(e+1)}const brt=function e(t,n,r){function i(s,o){var a=s[0],u=s[1],l=s[2],c=o[0],f=o[1],h=o[2],d=c-a,p=f-u,g=d*d+p*p,m,y;if(g<grt)y=Math.log(h/l)/t,m=function($){return[a+$*d,u+$*p,l*Math.exp(t*$*y)]};else{var b=Math.sqrt(g),v=(h*h-l*l+r*g)/(2*l*n*b),x=(h*h-l*l-r*g)/(2*h*n*b),w=Math.log(Math.sqrt(v*v+1)-v),C=Math.log(Math.sqrt(x*x+1)-x);y=(C-w)/t,m=function($){var S=$*y,k=Oq(w),E=l/(n*b)*(k*yrt(t*S+w)-mrt(w));return[a+E*d,u+E*p,l*k/Oq(t*S+w)]}}return m.duration=y*1e3*t/Math.SQRT2,m}return i.rho=function(s){var o=Math.max(.001,+s),a=o*o,u=a*a;return e(o,a,u)},i}(Math.SQRT2,2,4);function yfe(e){return function(t,n){var r=e((t=nh(t)).h,(n=nh(n)).h),i=Cr(t.s,n.s),s=Cr(t.l,n.l),o=Cr(t.opacity,n.opacity);return function(a){return t.h=r(a),t.s=i(a),t.l=s(a),t.opacity=o(a),t+""}}}const xrt=yfe(kD);var vrt=yfe(Cr);function wrt(e,t){var n=Cr((e=rh(e)).l,(t=rh(t)).l),r=Cr(e.a,t.a),i=Cr(e.b,t.b),s=Cr(e.opacity,t.opacity);return function(o){return e.l=n(o),e.a=r(o),e.b=i(o),e.opacity=s(o),e+""}}function bfe(e){return function(t,n){var r=e((t=ih(t)).h,(n=ih(n)).h),i=Cr(t.c,n.c),s=Cr(t.l,n.l),o=Cr(t.opacity,n.opacity);return function(a){return t.h=r(a),t.c=i(a),t.l=s(a),t.opacity=o(a),t+""}}}const $rt=bfe(kD);var Crt=bfe(Cr);function xfe(e){return function t(n){n=+n;function r(i,s){var o=e((i=Tp(i)).h,(s=Tp(s)).h),a=Cr(i.s,s.s),u=Cr(i.l,s.l),l=Cr(i.opacity,s.opacity);return function(c){return i.h=o(c),i.s=a(c),i.l=u(Math.pow(c,n)),i.opacity=l(c),i+""}}return r.gamma=t,r}(1)}const Srt=xfe(kD);var krt=xfe(Cr);function u8(e,t){t===void 0&&(t=e,e=Sg);for(var n=0,r=t.length-1,i=t[0],s=new Array(r<0?0:r);n<r;)s[n]=e(i,i=t[++n]);return function(o){var a=Math.max(0,Math.min(r-1,Math.floor(o*=r)));return s[a](o-a)}}function Ert(e,t){for(var n=new Array(t),r=0;r<t;++r)n[r]=e(r/(t-1));return n}const _rt=Object.freeze(Object.defineProperty({__proto__:null,interpolate:Sg,interpolateArray:ort,interpolateBasis:ofe,interpolateBasisClosed:afe,interpolateCubehelix:Srt,interpolateCubehelixLong:krt,interpolateDate:hfe,interpolateDiscrete:lrt,interpolateHcl:$rt,interpolateHclLong:Crt,interpolateHsl:xrt,interpolateHslLong:vrt,interpolateHue:crt,interpolateLab:wrt,interpolateNumber:ha,interpolateNumberArray:a8,interpolateObject:dfe,interpolateRgb:QM,interpolateRgbBasis:irt,interpolateRgbBasisClosed:srt,interpolateRound:ED,interpolateString:pfe,interpolateTransformCss:drt,interpolateTransformSvg:prt,interpolateZoom:brt,piecewise:u8,quantize:Ert},Symbol.toStringTag,{value:"Module"}));function Art(e){return function(){return e}}function n4(e){return+e}var Rq=[0,1];function $s(e){return e}function r4(e,t){return(t-=e=+e)?function(n){return(n-e)/t}:Art(isNaN(t)?NaN:.5)}function Trt(e,t){var n;return e>t&&(n=e,e=t,t=n),function(r){return Math.max(e,Math.min(t,r))}}function Irt(e,t,n){var r=e[0],i=e[1],s=t[0],o=t[1];return i<r?(r=r4(i,r),s=n(o,s)):(r=r4(r,i),s=n(s,o)),function(a){return s(r(a))}}function Drt(e,t,n){var r=Math.min(e.length,t.length)-1,i=new Array(r),s=new Array(r),o=-1;for(e[r]<e[0]&&(e=e.slice().reverse(),t=t.slice().reverse());++o<r;)i[o]=r4(e[o],e[o+1]),s[o]=n(t[o],t[o+1]);return function(a){var u=a$(e,a,1,r)-1;return s[u](i[u](a))}}function f$(e,t){return t.domain(e.domain()).range(e.range()).interpolate(e.interpolate()).clamp(e.clamp()).unknown(e.unknown())}function _D(){var e=Rq,t=Rq,n=Sg,r,i,s,o=$s,a,u,l;function c(){var h=Math.min(e.length,t.length);return o!==$s&&(o=Trt(e[0],e[h-1])),a=h>2?Drt:Irt,u=l=null,f}function f(h){return h==null||isNaN(h=+h)?s:(u||(u=a(e.map(r),t,n)))(r(o(h)))}return f.invert=function(h){return o(i((l||(l=a(t,e.map(r),ha)))(h)))},f.domain=function(h){return arguments.length?(e=Array.from(h,n4),c()):e.slice()},f.range=function(h){return arguments.length?(t=Array.from(h),c()):t.slice()},f.rangeRound=function(h){return t=Array.from(h),n=ED,c()},f.clamp=function(h){return arguments.length?(o=h?!0:$s,c()):o!==$s},f.interpolate=function(h){return arguments.length?(n=h,c()):n},f.unknown=function(h){return arguments.length?(s=h,f):s},function(h,d){return r=h,i=d,c()}}function vfe(){return _D()($s,$s)}function wfe(e,t,n,r){var i=_E(e,t,n),s;switch(r=_p(r??",f"),r.type){case"s":{var o=Math.max(Math.abs(e),Math.abs(t));return r.precision==null&&!isNaN(s=Lce(i,o))&&(r.precision=s),Jz(r,o)}case"":case"e":case"g":case"p":case"r":{r.precision==null&&!isNaN(s=Pce(i,Math.max(Math.abs(e),Math.abs(t))))&&(r.precision=s-(r.type==="e"));break}case"f":case"%":{r.precision==null&&!isNaN(s=Mce(i))&&(r.precision=s-(r.type==="%")*2);break}}return mD(r)}function kg(e){var t=e.domain;return e.ticks=function(n){var r=t();return ZM(r[0],r[r.length-1],n??10)},e.tickFormat=function(n,r){var i=t();return wfe(i[0],i[i.length-1],n??10,r)},e.nice=function(n){n==null&&(n=10);var r=t(),i=0,s=r.length-1,o=r[i],a=r[s],u,l,c=10;for(a<o&&(l=o,o=a,a=l,l=i,i=s,s=l);c-- >0;){if(l=JM(o,a,n),l===u)return r[i]=o,r[s]=a,t(r);if(l>0)o=Math.floor(o/l)*l,a=Math.ceil(a/l)*l;else if(l<0)o=Math.ceil(o*l)/l,a=Math.floor(a*l)/l;else break;u=l}return e},e}function $fe(){var e=vfe();return e.copy=function(){return f$(e,$fe())},el.apply(e,arguments),kg(e)}function Cfe(e){var t;function n(r){return r==null||isNaN(r=+r)?t:r}return n.invert=n,n.domain=n.range=function(r){return arguments.length?(e=Array.from(r,n4),n):e.slice()},n.unknown=function(r){return arguments.length?(t=r,n):t},n.copy=function(){return Cfe(e).unknown(t)},e=arguments.length?Array.from(e,n4):[0,1],kg(n)}function Sfe(e,t){e=e.slice();var n=0,r=e.length-1,i=e[n],s=e[r],o;return s<i&&(o=n,n=r,r=o,o=i,i=s,s=o),e[n]=t.floor(i),e[r]=t.ceil(s),e}function Mq(e){return Math.log(e)}function Lq(e){return Math.exp(e)}function Nrt(e){return-Math.log(-e)}function Frt(e){return-Math.exp(-e)}function Ort(e){return isFinite(e)?+("1e"+e):e<0?0:e}function Rrt(e){return e===10?Ort:e===Math.E?Math.exp:t=>Math.pow(e,t)}function Mrt(e){return e===Math.E?Math.log:e===10&&Math.log10||e===2&&Math.log2||(e=Math.log(e),t=>Math.log(t)/e)}function Pq(e){return(t,n)=>-e(-t,n)}function l8(e){const t=e(Mq,Lq),n=t.domain;let r=10,i,s;function o(){return i=Mrt(r),s=Rrt(r),n()[0]<0?(i=Pq(i),s=Pq(s),e(Nrt,Frt)):e(Mq,Lq),t}return t.base=function(a){return arguments.length?(r=+a,o()):r},t.domain=function(a){return arguments.length?(n(a),o()):n()},t.ticks=a=>{const u=n();let l=u[0],c=u[u.length-1];const f=c<l;f&&([l,c]=[c,l]);let h=i(l),d=i(c),p,g;const m=a==null?10:+a;let y=[];if(!(r%1)&&d-h<m){if(h=Math.floor(h),d=Math.ceil(d),l>0){for(;h<=d;++h)for(p=1;p<r;++p)if(g=h<0?p/s(-h):p*s(h),!(g<l)){if(g>c)break;y.push(g)}}else for(;h<=d;++h)for(p=r-1;p>=1;--p)if(g=h>0?p/s(-h):p*s(h),!(g<l)){if(g>c)break;y.push(g)}y.length*2<m&&(y=ZM(l,c,m))}else y=ZM(h,d,Math.min(d-h,m)).map(s);return f?y.reverse():y},t.tickFormat=(a,u)=>{if(a==null&&(a=10),u==null&&(u=r===10?"s":","),typeof u!="function"&&(!(r%1)&&(u=_p(u)).precision==null&&(u.trim=!0),u=mD(u)),a===1/0)return u;const l=Math.max(1,r*a/t.ticks().length);return c=>{let f=c/s(Math.round(i(c)));return f*r<r-.5&&(f*=r),f<=l?u(c):""}},t.nice=()=>n(Sfe(n(),{floor:a=>s(Math.floor(i(a))),ceil:a=>s(Math.ceil(i(a)))})),t}function kfe(){const e=l8(_D()).domain([1,10]);return e.copy=()=>f$(e,kfe()).base(e.base()),el.apply(e,arguments),e}function Bq(e){return function(t){return Math.sign(t)*Math.log1p(Math.abs(t/e))}}function zq(e){return function(t){return Math.sign(t)*Math.expm1(Math.abs(t))*e}}function c8(e){var t=1,n=e(Bq(t),zq(t));return n.constant=function(r){return arguments.length?e(Bq(t=+r),zq(t)):t},kg(n)}function Efe(){var e=c8(_D());return e.copy=function(){return f$(e,Efe()).constant(e.constant())},el.apply(e,arguments)}function Uq(e){return function(t){return t<0?-Math.pow(-t,e):Math.pow(t,e)}}function Lrt(e){return e<0?-Math.sqrt(-e):Math.sqrt(e)}function Prt(e){return e<0?-e*e:e*e}function f8(e){var t=e($s,$s),n=1;function r(){return n===1?e($s,$s):n===.5?e(Lrt,Prt):e(Uq(n),Uq(1/n))}return t.exponent=function(i){return arguments.length?(n=+i,r()):n},kg(t)}function h8(){var e=f8(_D());return e.copy=function(){return f$(e,h8()).exponent(e.exponent())},el.apply(e,arguments),e}function Brt(){return h8.apply(null,arguments).exponent(.5)}function _fe(){var e=[],t=[],n=[],r;function i(){var o=0,a=Math.max(1,t.length);for(n=new Array(a-1);++o<a;)n[o-1]=ttt(e,o/a);return s}function s(o){return o==null||isNaN(o=+o)?r:t[a$(n,o)]}return s.invertExtent=function(o){var a=t.indexOf(o);return a<0?[NaN,NaN]:[a>0?n[a-1]:e[0],a<n.length?n[a]:e[e.length-1]]},s.domain=function(o){if(!arguments.length)return e.slice();e=[];for(let a of o)a!=null&&!isNaN(a=+a)&&e.push(a);return e.sort(ux),i()},s.range=function(o){return arguments.length?(t=Array.from(o),i()):t.slice()},s.unknown=function(o){return arguments.length?(r=o,s):r},s.quantiles=function(){return n.slice()},s.copy=function(){return _fe().domain(e).range(t).unknown(r)},el.apply(s,arguments)}function Afe(){var e=0,t=1,n=1,r=[.5],i=[0,1],s;function o(u){return u!=null&&u<=u?i[a$(r,u,0,n)]:s}function a(){var u=-1;for(r=new Array(n);++u<n;)r[u]=((u+1)*t-(u-n)*e)/(n+1);return o}return o.domain=function(u){return arguments.length?([e,t]=u,e=+e,t=+t,a()):[e,t]},o.range=function(u){return arguments.length?(n=(i=Array.from(u)).length-1,a()):i.slice()},o.invertExtent=function(u){var l=i.indexOf(u);return l<0?[NaN,NaN]:l<1?[e,r[0]]:l>=n?[r[n-1],t]:[r[l-1],r[l]]},o.unknown=function(u){return arguments.length&&(s=u),o},o.thresholds=function(){return r.slice()},o.copy=function(){return Afe().domain([e,t]).range(i).unknown(s)},el.apply(kg(o),arguments)}function Tfe(){var e=[.5],t=[0,1],n,r=1;function i(s){return s!=null&&s<=s?t[a$(e,s,0,r)]:n}return i.domain=function(s){return arguments.length?(e=Array.from(s),r=Math.min(e.length,t.length-1),i):e.slice()},i.range=function(s){return arguments.length?(t=Array.from(s),r=Math.min(e.length,t.length-1),i):t.slice()},i.invertExtent=function(s){var o=t.indexOf(s);return[e[o-1],e[o]]},i.unknown=function(s){return arguments.length?(n=s,i):n},i.copy=function(){return Tfe().domain(e).range(t).unknown(n)},el.apply(i,arguments)}function zrt(e){return new Date(e)}function Urt(e){return e instanceof Date?+e:+new Date(+e)}function d8(e,t,n,r,i,s,o,a,u,l){var c=vfe(),f=c.invert,h=c.domain,d=l(".%L"),p=l(":%S"),g=l("%I:%M"),m=l("%I %p"),y=l("%a %d"),b=l("%b %d"),v=l("%B"),x=l("%Y");function w(C){return(u(C)<C?d:a(C)<C?p:o(C)<C?g:s(C)<C?m:r(C)<C?i(C)<C?y:b:n(C)<C?v:x)(C)}return c.invert=function(C){return new Date(f(C))},c.domain=function(C){return arguments.length?h(Array.from(C,Urt)):h().map(zrt)},c.ticks=function(C){var $=h();return e($[0],$[$.length-1],C??10)},c.tickFormat=function(C,$){return $==null?w:l($)},c.nice=function(C){var $=h();return(!C||typeof C.range!="function")&&(C=t($[0],$[$.length-1],C??10)),C?h(Sfe($,C)):c},c.copy=function(){return f$(c,d8(e,t,n,r,i,s,o,a,u,l))},c}function jrt(){return el.apply(d8(wtt,$tt,Uu,vv,u$,Af,xD,yD,Vl,t8).domain([new Date(2e3,0,1),new Date(2e3,0,2)]),arguments)}function Wrt(){return el.apply(d8(xtt,vtt,ju,wv,l$,np,vD,bD,Vl,n8).domain([Date.UTC(2e3,0,1),Date.UTC(2e3,0,2)]),arguments)}function AD(){var e=0,t=1,n,r,i,s,o=$s,a=!1,u;function l(f){return f==null||isNaN(f=+f)?u:o(i===0?.5:(f=(s(f)-n)*i,a?Math.max(0,Math.min(1,f)):f))}l.domain=function(f){return arguments.length?([e,t]=f,n=s(e=+e),r=s(t=+t),i=n===r?0:1/(r-n),l):[e,t]},l.clamp=function(f){return arguments.length?(a=!!f,l):a},l.interpolator=function(f){return arguments.length?(o=f,l):o};function c(f){return function(h){var d,p;return arguments.length?([d,p]=h,o=f(d,p),l):[o(0),o(1)]}}return l.range=c(Sg),l.rangeRound=c(ED),l.unknown=function(f){return arguments.length?(u=f,l):u},function(f){return s=f,n=f(e),r=f(t),i=n===r?0:1/(r-n),l}}function Rh(e,t){return t.domain(e.domain()).interpolator(e.interpolator()).clamp(e.clamp()).unknown(e.unknown())}function p8(){var e=kg(AD()($s));return e.copy=function(){return Rh(e,p8())},Fh.apply(e,arguments)}function Ife(){var e=l8(AD()).domain([1,10]);return e.copy=function(){return Rh(e,Ife()).base(e.base())},Fh.apply(e,arguments)}function Dfe(){var e=c8(AD());return e.copy=function(){return Rh(e,Dfe()).constant(e.constant())},Fh.apply(e,arguments)}function g8(){var e=f8(AD());return e.copy=function(){return Rh(e,g8()).exponent(e.exponent())},Fh.apply(e,arguments)}function Vrt(){return g8.apply(null,arguments).exponent(.5)}function TD(){var e=0,t=.5,n=1,r=1,i,s,o,a,u,l=$s,c,f=!1,h;function d(g){return isNaN(g=+g)?h:(g=.5+((g=+c(g))-s)*(r*g<r*s?a:u),l(f?Math.max(0,Math.min(1,g)):g))}d.domain=function(g){return arguments.length?([e,t,n]=g,i=c(e=+e),s=c(t=+t),o=c(n=+n),a=i===s?0:.5/(s-i),u=s===o?0:.5/(o-s),r=s<i?-1:1,d):[e,t,n]},d.clamp=function(g){return arguments.length?(f=!!g,d):f},d.interpolator=function(g){return arguments.length?(l=g,d):l};function p(g){return function(m){var y,b,v;return arguments.length?([y,b,v]=m,l=u8(g,[y,b,v]),d):[l(0),l(.5),l(1)]}}return d.range=p(Sg),d.rangeRound=p(ED),d.unknown=function(g){return arguments.length?(h=g,d):h},function(g){return c=g,i=g(e),s=g(t),o=g(n),a=i===s?0:.5/(s-i),u=s===o?0:.5/(o-s),r=s<i?-1:1,d}}function Nfe(){var e=kg(TD()($s));return e.copy=function(){return Rh(e,Nfe())},Fh.apply(e,arguments)}function Ffe(){var e=l8(TD()).domain([.1,1,10]);return e.copy=function(){return Rh(e,Ffe()).base(e.base())},Fh.apply(e,arguments)}function Ofe(){var e=c8(TD());return e.copy=function(){return Rh(e,Ofe()).constant(e.constant())},Fh.apply(e,arguments)}function m8(){var e=f8(TD());return e.copy=function(){return Rh(e,m8()).exponent(e.exponent())},Fh.apply(e,arguments)}function Grt(){return m8.apply(null,arguments).exponent(.5)}function Hrt(e,t,n){const r=e-t+n*2;return e?r>0?r:1:0}const qrt="identity",y8="linear",sh="log",b8="pow",x8="sqrt",v8="symlog",Nv="time",Fv="utc",py="sequential",h$="diverging",NE="quantile",w8="quantize",Rfe="threshold",Xrt="ordinal",Yrt="point",Krt="band",Zrt="bin-ordinal",zr="continuous",d$="discrete",p$="discretizing",ja="interpolating",$8="temporal";function Jrt(e){return function(t){let n=t[0],r=t[1],i;return r<n&&(i=n,n=r,r=i),[e.invert(n),e.invert(r)]}}function Qrt(e){return function(t){const n=e.range();let r=t[0],i=t[1],s=-1,o,a,u,l;for(i<r&&(a=r,r=i,i=a),u=0,l=n.length;u<l;++u)n[u]>=r&&n[u]<=i&&(s<0&&(s=u),o=u);if(!(s<0))return r=e.invertExtent(n[s]),i=e.invertExtent(n[o]),[r[0]===void 0?r[1]:r[0],i[1]===void 0?i[0]:i[1]]}}function C8(){const e=r8().unknown(void 0),t=e.domain,n=e.range;let r=[0,1],i,s,o=!1,a=0,u=0,l=.5;delete e.unknown;function c(){const f=t().length,h=r[1]<r[0],d=r[1-h],p=Hrt(f,a,u);let g=r[h-0];i=(d-g)/(p||1),o&&(i=Math.floor(i)),g+=(d-g-i*(f-a))*l,s=i*(1-a),o&&(g=Math.round(g),s=Math.round(s));const m=ntt(f).map(y=>g+i*y);return n(h?m.reverse():m)}return e.domain=function(f){return arguments.length?(t(f),c()):t()},e.range=function(f){return arguments.length?(r=[+f[0],+f[1]],c()):r.slice()},e.rangeRound=function(f){return r=[+f[0],+f[1]],o=!0,c()},e.bandwidth=function(){return s},e.step=function(){return i},e.round=function(f){return arguments.length?(o=!!f,c()):o},e.padding=function(f){return arguments.length?(u=Math.max(0,Math.min(1,f)),a=u,c()):a},e.paddingInner=function(f){return arguments.length?(a=Math.max(0,Math.min(1,f)),c()):a},e.paddingOuter=function(f){return arguments.length?(u=Math.max(0,Math.min(1,f)),c()):u},e.align=function(f){return arguments.length?(l=Math.max(0,Math.min(1,f)),c()):l},e.invertRange=function(f){if(f[0]==null||f[1]==null)return;const h=r[1]<r[0],d=h?n().reverse():n(),p=d.length-1;let g=+f[0],m=+f[1],y,b,v;if(!(g!==g||m!==m)&&(m<g&&(v=g,g=m,m=v),!(m<d[0]||g>r[1-h])))return y=Math.max(0,KM(d,g)-1),b=g===m?y:KM(d,m)-1,g-d[y]>s+1e-10&&++y,h&&(v=y,y=p-b,b=p-v),y>b?void 0:t().slice(y,b+1)},e.invert=function(f){const h=e.invertRange([f,f]);return h&&h[0]},e.copy=function(){return C8().domain(t()).range(r).round(o).paddingInner(a).paddingOuter(u).align(l)},c()}function Mfe(e){const t=e.copy;return e.padding=e.paddingOuter,delete e.paddingInner,e.copy=function(){return Mfe(t())},e}function eit(){return Mfe(C8().paddingInner(1))}var tit=Array.prototype.map;function nit(e){return tit.call(e,pet)}const rit=Array.prototype.slice;function Lfe(){let e=[],t=[];function n(r){return r==null||r!==r?void 0:t[(a$(e,r)-1)%t.length]}return n.domain=function(r){return arguments.length?(e=nit(r),n):e.slice()},n.range=function(r){return arguments.length?(t=rit.call(r),n):t.slice()},n.tickFormat=function(r,i){return wfe(e[0],Eu(e),r??10,i)},n.copy=function(){return Lfe().domain(n.domain()).range(n.range())},n}const FE=new Map,iit=Symbol("vega_scale");function sit(e){return e[iit]=!0,e}function oit(e,t,n){const r=function(){const s=t();return s.invertRange||(s.invertRange=s.invert?Jrt(s):s.invertExtent?Qrt(s):void 0),s.type=e,sit(s)};return r.metadata=pce(jz(n)),r}function cn(e,t,n){return arguments.length>1?(FE.set(e,oit(e,t,n)),this):ait(e)?FE.get(e):void 0}cn(qrt,Cfe);cn(y8,$fe,zr);cn(sh,kfe,[zr,sh]);cn(b8,h8,zr);cn(x8,Brt,zr);cn(v8,Efe,zr);cn(Nv,jrt,[zr,$8]);cn(Fv,Wrt,[zr,$8]);cn(py,p8,[zr,ja]);cn(`${py}-${y8}`,p8,[zr,ja]);cn(`${py}-${sh}`,Ife,[zr,ja,sh]);cn(`${py}-${b8}`,g8,[zr,ja]);cn(`${py}-${x8}`,Vrt,[zr,ja]);cn(`${py}-${v8}`,Dfe,[zr,ja]);cn(`${h$}-${y8}`,Nfe,[zr,ja]);cn(`${h$}-${sh}`,Ffe,[zr,ja,sh]);cn(`${h$}-${b8}`,m8,[zr,ja]);cn(`${h$}-${x8}`,Grt,[zr,ja]);cn(`${h$}-${v8}`,Ofe,[zr,ja]);cn(NE,_fe,[p$,NE]);cn(w8,Afe,p$);cn(Rfe,Tfe,p$);cn(Zrt,Lfe,[d$,p$]);cn(Xrt,r8,d$);cn(Krt,C8,d$);cn(Yrt,eit,d$);function ait(e){return FE.has(e)}function ID(e,t){const n=FE.get(e);return n&&n.metadata[t]}function Pfe(e){return ID(e,d$)}function uit(e){return ID(e,p$)}function lit(e){return ID(e,sh)}function cit(e){return ID(e,$8)}function fit(e,t,n){return u8(hit(t||"rgb",n),e)}function hit(e,t){const n=_rt[dit(e)];return t!=null&&n&&n.gamma?n.gamma(t):n}function dit(e){return"interpolate"+e.toLowerCase().split("-").map(t=>t[0].toUpperCase()+t.slice(1)).join("")}const pit={blues:"cfe1f2bed8eca8cee58fc1de74b2d75ba3cf4592c63181bd206fb2125ca40a4a90",greens:"d3eecdc0e6baabdda594d3917bc77d60ba6c46ab5e329a512089430e7735036429",greys:"e2e2e2d4d4d4c4c4c4b1b1b19d9d9d8888887575756262624d4d4d3535351e1e1e",oranges:"fdd8b3fdc998fdb87bfda55efc9244f87f2cf06b18e4580bd14904b93d029f3303",purples:"e2e1efd4d4e8c4c5e0b4b3d6a3a0cc928ec3827cb97566ae684ea25c3696501f8c",reds:"fdc9b4fcb49afc9e80fc8767fa7051f6573fec3f2fdc2a25c81b1db21218970b13",blueGreen:"d5efedc1e8e0a7ddd18bd2be70c6a958ba9144ad77319c5d2089460e7736036429",bluePurple:"ccddecbad0e4a8c2dd9ab0d4919cc98d85be8b6db28a55a6873c99822287730f71",greenBlue:"d3eecec5e8c3b1e1bb9bd8bb82cec269c2ca51b2cd3c9fc7288abd1675b10b60a1",orangeRed:"fddcaffdcf9bfdc18afdad77fb9562f67d53ee6545e24932d32d1ebf130da70403",purpleBlue:"dbdaebc8cee4b1c3de97b7d87bacd15b9fc93a90c01e7fb70b70ab056199045281",purpleBlueGreen:"dbd8eac8cee4b0c3de93b7d872acd1549fc83892bb1c88a3097f8702736b016353",purpleRed:"dcc9e2d3b3d7ce9eccd186c0da6bb2e14da0e23189d91e6fc61159ab07498f023a",redPurple:"fccfccfcbec0faa9b8f98faff571a5ec539ddb3695c41b8aa908808d0179700174",yellowGreen:"e4f4acd1eca0b9e2949ed68880c97c62bb6e47aa5e3297502083440e723b036034",yellowOrangeBrown:"feeaa1fedd84fecc63feb746fca031f68921eb7215db5e0bc54c05ab3d038f3204",yellowOrangeRed:"fee087fed16ffebd59fea849fd903efc7335f9522bee3423de1b20ca0b22af0225",blueOrange:"134b852f78b35da2cb9dcae1d2e5eff2f0ebfce0bafbbf74e8932fc5690d994a07",brownBlueGreen:"704108a0651ac79548e3c78af3e6c6eef1eac9e9e48ed1c74da79e187a72025147",purpleGreen:"5b1667834792a67fb6c9aed3e6d6e8eff0efd9efd5aedda971bb75368e490e5e29",purpleOrange:"4114696647968f83b7b9b4d6dadbebf3eeeafce0bafbbf74e8932fc5690d994a07",redBlue:"8c0d25bf363adf745ef4ae91fbdbc9f2efeed2e5ef9dcae15da2cb2f78b3134b85",redGrey:"8c0d25bf363adf745ef4ae91fcdccbfaf4f1e2e2e2c0c0c0969696646464343434",yellowGreenBlue:"eff9bddbf1b4bde5b594d5b969c5be45b4c22c9ec02182b82163aa23479c1c3185",redYellowBlue:"a50026d4322cf16e43fcac64fedd90faf8c1dcf1ecabd6e875abd04a74b4313695",redYellowGreen:"a50026d4322cf16e43fcac63fedd8df9f7aed7ee8ea4d86e64bc6122964f006837",pinkYellowGreen:"8e0152c0267edd72adf0b3d6faddedf5f3efe1f2cab6de8780bb474f9125276419",spectral:"9e0142d13c4bf0704afcac63fedd8dfbf8b0e0f3a1a9dda269bda94288b55e4fa2",viridis:"440154470e61481a6c482575472f7d443a834144873d4e8a39568c35608d31688e2d708e2a788e27818e23888e21918d1f988b1fa08822a8842ab07f35b77943bf7154c56866cc5d7ad1518fd744a5db36bcdf27d2e21be9e51afde725",magma:"0000040404130b0924150e3720114b2c11603b0f704a107957157e651a80721f817f24828c29819a2e80a8327db6377ac43c75d1426fde4968e95462f1605df76f5cfa7f5efc8f65fe9f6dfeaf78febf84fece91fddea0fcedaffcfdbf",inferno:"0000040403130c0826170c3b240c4f330a5f420a68500d6c5d126e6b176e781c6d86216b932667a12b62ae305cbb3755c73e4cd24644dd513ae65c30ed6925f3771af8850ffb9506fca50afcb519fac62df6d645f2e661f3f484fcffa4",plasma:"0d088723069033059742039d5002a25d01a66a00a87801a88405a7900da49c179ea72198b12a90ba3488c33d80cb4779d35171da5a69e16462e76e5bed7953f2834cf68f44fa9a3dfca636fdb32ffec029fcce25f9dc24f5ea27f0f921",cividis:"00205100235800265d002961012b65042e670831690d346b11366c16396d1c3c6e213f6e26426e2c456e31476e374a6e3c4d6e42506e47536d4c566d51586e555b6e5a5e6e5e616e62646f66676f6a6a706e6d717270717573727976737c79747f7c75827f758682768985778c8877908b78938e789691789a94789e9778a19b78a59e77a9a177aea575b2a874b6ab73bbaf71c0b26fc5b66dc9b96acebd68d3c065d8c462ddc85fe2cb5ce7cf58ebd355f0d652f3da4ff7de4cfae249fce647",rainbow:"6e40aa883eb1a43db3bf3cafd83fa4ee4395fe4b83ff576eff6659ff7847ff8c38f3a130e2b72fcfcc36bee044aff05b8ff4576ff65b52f6673af27828ea8d1ddfa319d0b81cbecb23abd82f96e03d82e14c6edb5a5dd0664dbf6e40aa",sinebow:"ff4040fc582af47218e78d0bd5a703bfbf00a7d5038de70b72f41858fc2a40ff402afc5818f4720be78d03d5a700bfbf03a7d50b8de71872f42a58fc4040ff582afc7218f48d0be7a703d5bf00bfd503a7e70b8df41872fc2a58ff4040",turbo:"23171b32204a3e2a71453493493eae4b49c54a53d7485ee44569ee4074f53c7ff8378af93295f72e9ff42ba9ef28b3e926bce125c5d925cdcf27d5c629dcbc2de3b232e9a738ee9d3ff39347f68950f9805afc7765fd6e70fe667cfd5e88fc5795fb51a1f84badf545b9f140c5ec3cd0e637dae034e4d931ecd12ef4c92bfac029ffb626ffad24ffa223ff9821ff8d1fff821dff771cfd6c1af76118f05616e84b14df4111d5380fcb2f0dc0260ab61f07ac1805a313029b0f00950c00910b00",browns:"eedbbdecca96e9b97ae4a865dc9856d18954c7784cc0673fb85536ad44339f3632",tealBlues:"bce4d89dd3d181c3cb65b3c245a2b9368fae347da0306a932c5985",teals:"bbdfdfa2d4d58ac9c975bcbb61b0af4da5a43799982b8b8c1e7f7f127273006667",warmGreys:"dcd4d0cec5c1c0b8b4b3aaa7a59c9998908c8b827f7e7673726866665c5a59504e",goldGreen:"f4d166d5ca60b6c35c98bb597cb25760a6564b9c533f8f4f33834a257740146c36",goldOrange:"f4d166f8be5cf8aa4cf5983bf3852aef701be2621fd65322c54923b142239e3a26",goldRed:"f4d166f6be59f9aa51fc964ef6834bee734ae56249db5247cf4244c43141b71d3e",lightGreyRed:"efe9e6e1dad7d5cbc8c8bdb9bbaea9cd967ddc7b43e15f19df4011dc000b",lightGreyTeal:"e4eaead6dcddc8ced2b7c2c7a6b4bc64b0bf22a6c32295c11f85be1876bc",lightMulti:"e0f1f2c4e9d0b0de9fd0e181f6e072f6c053f3993ef77440ef4a3c",lightOrange:"f2e7daf7d5baf9c499fab184fa9c73f68967ef7860e8645bde515bd43d5b",lightTealBlue:"e3e9e0c0dccf9aceca7abfc859afc0389fb9328dad2f7ca0276b95255988",darkBlue:"3232322d46681a5c930074af008cbf05a7ce25c0dd38daed50f3faffffff",darkGold:"3c3c3c584b37725e348c7631ae8b2bcfa424ecc31ef9de30fff184ffffff",darkGreen:"3a3a3a215748006f4d048942489e4276b340a6c63dd2d836ffeb2cffffaa",darkMulti:"3737371f5287197d8c29a86995ce3fffe800ffffff",darkRed:"3434347036339e3c38cc4037e75d1eec8620eeab29f0ce32ffeb2c"},git={category10:"1f77b4ff7f0e2ca02cd627289467bd8c564be377c27f7f7fbcbd2217becf",category20:"1f77b4aec7e8ff7f0effbb782ca02c98df8ad62728ff98969467bdc5b0d58c564bc49c94e377c2f7b6d27f7f7fc7c7c7bcbd22dbdb8d17becf9edae5",category20b:"393b795254a36b6ecf9c9ede6379398ca252b5cf6bcedb9c8c6d31bd9e39e7ba52e7cb94843c39ad494ad6616be7969c7b4173a55194ce6dbdde9ed6",category20c:"3182bd6baed69ecae1c6dbefe6550dfd8d3cfdae6bfdd0a231a35474c476a1d99bc7e9c0756bb19e9ac8bcbddcdadaeb636363969696bdbdbdd9d9d9",tableau10:"4c78a8f58518e4575672b7b254a24beeca3bb279a2ff9da69d755dbab0ac",tableau20:"4c78a89ecae9f58518ffbf7954a24b88d27ab79a20f2cf5b43989483bcb6e45756ff9d9879706ebab0acd67195fcbfd2b279a2d6a5c99e765fd8b5a5",accent:"7fc97fbeaed4fdc086ffff99386cb0f0027fbf5b17666666",dark2:"1b9e77d95f027570b3e7298a66a61ee6ab02a6761d666666",paired:"a6cee31f78b4b2df8a33a02cfb9a99e31a1cfdbf6fff7f00cab2d66a3d9affff99b15928",pastel1:"fbb4aeb3cde3ccebc5decbe4fed9a6ffffcce5d8bdfddaecf2f2f2",pastel2:"b3e2cdfdcdaccbd5e8f4cae4e6f5c9fff2aef1e2cccccccc",set1:"e41a1c377eb84daf4a984ea3ff7f00ffff33a65628f781bf999999",set2:"66c2a5fc8d628da0cbe78ac3a6d854ffd92fe5c494b3b3b3",set3:"8dd3c7ffffb3bebadafb807280b1d3fdb462b3de69fccde5d9d9d9bc80bdccebc5ffed6f"};function Bfe(e){const t=e.length/6|0,n=new Array(t);for(let r=0;r<t;)n[r]="#"+e.slice(r*6,++r*6);return n}function zfe(e,t){for(const n in e)mit(n,t(e[n]))}const jq={};zfe(git,Bfe);zfe(pit,e=>fit(Bfe(e)));function mit(e,t){return e=e&&e.toLowerCase(),arguments.length>1?(jq[e]=t,this):jq[e]}const yit="symbol",bit="discrete",xit=e=>Qu(e)?e.map(t=>String(t)):String(e),vit=(e,t)=>e[1]-t[1],wit=(e,t)=>t[1]-e[1];function $it(e,t,n){let r=e.range(),i=r[0],s=Eu(r),o=vit;if(i>s&&(r=s,s=i,i=r,o=wit),i=Math.floor(i),s=Math.ceil(s),t=t.map(a=>[a,e(a)]).filter(a=>i<=a[1]&&a[1]<=s).sort(o).map(a=>a[0]),n>0&&t.length>1){const a=[t[0],Eu(t)];for(;t.length>n&&t.length>=3;)t=t.filter((u,l)=>!(l%2));t.length<3&&(t=a)}return t}function Ufe(e,t){return e.bins?$it(e,e.bins):e.ticks?e.ticks(t):e.domain()}function Cit(e,t,n,r,i,s){const o=t.type;let a=xit;if(o===Nv||i===Nv)a=e.timeFormat(r);else if(o===Fv||i===Fv)a=e.utcFormat(r);else if(lit(o)){const u=e.formatFloat(r);if(s||t.bins)a=u;else{const l=jfe(t,n,!1);a=c=>l(c)?u(c):""}}else if(t.tickFormat){const u=t.domain();a=e.formatSpan(u[0],u[u.length-1],n,r)}else r&&(a=e.format(r));return a}function jfe(e,t,n){const r=Ufe(e,t),i=e.base(),s=Math.log(i),o=Math.max(1,i*t/r.length),a=u=>{let l=u/Math.pow(i,Math.round(Math.log(u)/s));return l*i<i-.5&&(l*=i),l<=o};return n?r.filter(a):a}const i4={[NE]:"quantiles",[w8]:"thresholds",[Rfe]:"domain"},Wfe={[NE]:"quantiles",[w8]:"domain"};function Sit(e,t){return e.bins?_it(e.bins):e.type===sh?jfe(e,t,!0):i4[e.type]?Eit(e[i4[e.type]]()):Ufe(e,t)}function kit(e,t,n){const r=t[Wfe[t.type]](),i=r.length;let s=i>1?r[1]-r[0]:r[0],o;for(o=1;o<i;++o)s=Math.min(s,r[o]-r[o-1]);return e.formatSpan(0,s,3*10,n)}function Eit(e){const t=[-1/0].concat(e);return t.max=1/0,t}function _it(e){const t=e.slice(0,-1);return t.max=Eu(e),t}const Ait=e=>i4[e.type]||e.bins;function Tit(e,t,n,r,i,s,o){const a=Wfe[t.type]&&s!==Nv&&s!==Fv?kit(e,t,i):Cit(e,t,n,i,s,o);return r===yit&&Ait(t)?Iit(a):r===bit?Dit(a):Nit(a)}const Iit=e=>(t,n,r)=>{const i=Wq(r[n+1],Wq(r.max,1/0)),s=Vq(t,e),o=Vq(i,e);return s&&o?s+"  "+o:o?"< "+o:" "+s},Wq=(e,t)=>e??t,Dit=e=>(t,n)=>n?e(t):null,Nit=e=>t=>e(t),Vq=(e,t)=>Number.isFinite(e)?t(e):null;function Fit(e,t,n,r){const i=r||t.type;return wE(n)&&cit(i)&&(n=n.replace(/%a/g,"%A").replace(/%b/g,"%B")),!n&&i===Nv?e.timeFormat("%A, %d %B %Y, %X"):!n&&i===Fv?e.utcFormat("%A, %d %B %Y, %X UTC"):Tit(e,t,5,null,n,r,!0)}function Vfe(e,t,n){n=n||{};const r=Math.max(3,n.maxlen||7),i=Fit(e,t,n.format,n.formatType);if(uit(t.type)){const s=Sit(t).slice(1).map(i),o=s.length;return`${o} boundar${o===1?"y":"ies"}: ${s.join(", ")}`}else if(Pfe(t.type)){const s=t.domain(),o=s.length,a=o>r?s.slice(0,r-2).map(i).join(", ")+", ending with "+s.slice(-1).map(i):s.map(i).join(", ");return`${o} value${o===1?"":"s"}: ${a}`}else{const s=t.domain();return`values from ${i(s[0])} to ${i(Eu(s))}`}}let Oit=0;const OE="p_";function S8(e){return e&&e.gradient}function Gfe(e,t,n){const r=e.gradient;let i=e.id,s=r==="radial"?OE:"";return i||(i=e.id="gradient_"+Oit++,r==="radial"?(e.x1=Qa(e.x1,.5),e.y1=Qa(e.y1,.5),e.r1=Qa(e.r1,0),e.x2=Qa(e.x2,.5),e.y2=Qa(e.y2,.5),e.r2=Qa(e.r2,.5),s=OE):(e.x1=Qa(e.x1,0),e.y1=Qa(e.y1,0),e.x2=Qa(e.x2,1),e.y2=Qa(e.y2,0))),t[i]=e,"url("+(n||"")+"#"+s+i+")"}function Qa(e,t){return e??t}const Gq={basis:{curve:Net},"basis-closed":{curve:Fet},"basis-open":{curve:Oet},bundle:{curve:Ret,tension:"beta",value:.85},cardinal:{curve:Met,tension:"tension",value:0},"cardinal-open":{curve:Pet,tension:"tension",value:0},"cardinal-closed":{curve:Let,tension:"tension",value:0},"catmull-rom":{curve:Bet,tension:"alpha",value:.5},"catmull-rom-closed":{curve:zet,tension:"alpha",value:.5},"catmull-rom-open":{curve:Uet,tension:"alpha",value:.5},linear:{curve:Gz},"linear-closed":{curve:jet},monotone:{horizontal:Vet,vertical:Wet},natural:{curve:Get},step:{curve:Het},"step-after":{curve:Xet},"step-before":{curve:qet}};function Hfe(e,t,n){var r=Ll(Gq,e)&&Gq[e],i=null;return r&&(i=r.curve||r[t||"vertical"],r.tension&&n!=null&&(i=i[r.tension](n))),i}const Rit={m:2,l:2,h:1,v:1,z:0,c:6,s:4,q:4,t:2,a:7},Mit=/[mlhvzcsqta]([^mlhvzcsqta]+|$)/gi,Lit=/^[+-]?(([0-9]*\.[0-9]+)|([0-9]+\.)|([0-9]+))([eE][+-]?[0-9]+)?/,Pit=/^((\s+,?\s*)|(,\s*))/,Bit=/^[01]/;function qfe(e){const t=[];return(e.match(Mit)||[]).forEach(r=>{let i=r[0];const s=i.toLowerCase(),o=Rit[s],a=zit(s,o,r.slice(1).trim()),u=a.length;if(u<o||u&&u%o!==0)throw Error("Invalid SVG path, incorrect parameter count");if(t.push([i,...a.slice(0,o)]),u!==o){s==="m"&&(i=i==="M"?"L":"l");for(let l=o;l<u;l+=o)t.push([i,...a.slice(l,l+o)])}}),t}function zit(e,t,n){const r=[];for(let i=0;t&&i<n.length;)for(let s=0;s<t;++s){const o=e==="a"&&(s===3||s===4)?Bit:Lit,a=n.slice(i).match(o);if(a===null)throw Error("Invalid SVG path, incorrect parameter type");i+=a[0].length,r.push(+a[0]);const u=n.slice(i).match(Pit);u!==null&&(i+=u[0].length)}return r}const oh=Math.PI/180,Uit=1e-14,_d=Math.PI/2,fu=Math.PI*2,nm=Math.sqrt(3)/2;var eO={},tO={},Xfe=[].join;function jit(e,t,n,r,i,s,o,a,u){const l=Xfe.call(arguments);if(eO[l])return eO[l];const c=o*oh,f=Math.sin(c),h=Math.cos(c);n=Math.abs(n),r=Math.abs(r);const d=h*(a-e)*.5+f*(u-t)*.5,p=h*(u-t)*.5-f*(a-e)*.5;let g=d*d/(n*n)+p*p/(r*r);g>1&&(g=Math.sqrt(g),n*=g,r*=g);const m=h/n,y=f/n,b=-f/r,v=h/r,x=m*a+y*u,w=b*a+v*u,C=m*e+y*t,$=b*e+v*t;let k=1/((C-x)*(C-x)+($-w)*($-w))-.25;k<0&&(k=0);let E=Math.sqrt(k);s==i&&(E=-E);const _=.5*(x+C)-E*($-w),D=.5*(w+$)+E*(C-x),A=Math.atan2(w-D,x-_);let I=Math.atan2($-D,C-_)-A;I<0&&s===1?I+=fu:I>0&&s===0&&(I-=fu);const F=Math.ceil(Math.abs(I/(_d+.001))),R=[];for(let L=0;L<F;++L){const P=A+L*I/F,q=A+(L+1)*I/F;R[L]=[_,D,P,q,n,r,f,h]}return eO[l]=R}function Wit(e){const t=Xfe.call(e);if(tO[t])return tO[t];var n=e[0],r=e[1],i=e[2],s=e[3],o=e[4],a=e[5],u=e[6],l=e[7];const c=l*o,f=-u*a,h=u*o,d=l*a,p=Math.cos(i),g=Math.sin(i),m=Math.cos(s),y=Math.sin(s),b=.5*(s-i),v=Math.sin(b*.5),x=8/3*v*v/Math.sin(b),w=n+p-x*g,C=r+g+x*p,$=n+m,S=r+y,k=$+x*y,E=S-x*m;return tO[t]=[c*w+f*C,h*w+d*C,c*k+f*E,h*k+d*E,c*$+f*S,h*$+d*S]}const yo=["l",0,0,0,0,0,0,0];function Vit(e,t,n){const r=yo[0]=e[0];if(r==="a"||r==="A")yo[1]=t*e[1],yo[2]=n*e[2],yo[3]=e[3],yo[4]=e[4],yo[5]=e[5],yo[6]=t*e[6],yo[7]=n*e[7];else if(r==="h"||r==="H")yo[1]=t*e[1];else if(r==="v"||r==="V")yo[1]=n*e[1];else for(var i=1,s=e.length;i<s;++i)yo[i]=(i%2==1?t:n)*e[i];return yo}function s4(e,t,n,r,i,s){var o,a=null,u=0,l=0,c=0,f=0,h,d,p,g,m=0,y=0;n==null&&(n=0),r==null&&(r=0),i==null&&(i=1),s==null&&(s=i),e.beginPath&&e.beginPath();for(var b=0,v=t.length;b<v;++b){switch(o=t[b],(i!==1||s!==1)&&(o=Vit(o,i,s)),o[0]){case"l":u+=o[1],l+=o[2],e.lineTo(u+n,l+r);break;case"L":u=o[1],l=o[2],e.lineTo(u+n,l+r);break;case"h":u+=o[1],e.lineTo(u+n,l+r);break;case"H":u=o[1],e.lineTo(u+n,l+r);break;case"v":l+=o[1],e.lineTo(u+n,l+r);break;case"V":l=o[1],e.lineTo(u+n,l+r);break;case"m":u+=o[1],l+=o[2],m=u,y=l,e.moveTo(u+n,l+r);break;case"M":u=o[1],l=o[2],m=u,y=l,e.moveTo(u+n,l+r);break;case"c":h=u+o[5],d=l+o[6],c=u+o[3],f=l+o[4],e.bezierCurveTo(u+o[1]+n,l+o[2]+r,c+n,f+r,h+n,d+r),u=h,l=d;break;case"C":u=o[5],l=o[6],c=o[3],f=o[4],e.bezierCurveTo(o[1]+n,o[2]+r,c+n,f+r,u+n,l+r);break;case"s":h=u+o[3],d=l+o[4],c=2*u-c,f=2*l-f,e.bezierCurveTo(c+n,f+r,u+o[1]+n,l+o[2]+r,h+n,d+r),c=u+o[1],f=l+o[2],u=h,l=d;break;case"S":h=o[3],d=o[4],c=2*u-c,f=2*l-f,e.bezierCurveTo(c+n,f+r,o[1]+n,o[2]+r,h+n,d+r),u=h,l=d,c=o[1],f=o[2];break;case"q":h=u+o[3],d=l+o[4],c=u+o[1],f=l+o[2],e.quadraticCurveTo(c+n,f+r,h+n,d+r),u=h,l=d;break;case"Q":h=o[3],d=o[4],e.quadraticCurveTo(o[1]+n,o[2]+r,h+n,d+r),u=h,l=d,c=o[1],f=o[2];break;case"t":h=u+o[1],d=l+o[2],a[0].match(/[QqTt]/)===null?(c=u,f=l):a[0]==="t"?(c=2*u-p,f=2*l-g):a[0]==="q"&&(c=2*u-c,f=2*l-f),p=c,g=f,e.quadraticCurveTo(c+n,f+r,h+n,d+r),u=h,l=d,c=u+o[1],f=l+o[2];break;case"T":h=o[1],d=o[2],c=2*u-c,f=2*l-f,e.quadraticCurveTo(c+n,f+r,h+n,d+r),u=h,l=d;break;case"a":Hq(e,u+n,l+r,[o[1],o[2],o[3],o[4],o[5],o[6]+u+n,o[7]+l+r]),u+=o[6],l+=o[7];break;case"A":Hq(e,u+n,l+r,[o[1],o[2],o[3],o[4],o[5],o[6]+n,o[7]+r]),u=o[6],l=o[7];break;case"z":case"Z":u=m,l=y,e.closePath();break}a=o}}function Hq(e,t,n,r){const i=jit(r[5],r[6],r[0],r[1],r[3],r[4],r[2],t,n);for(let s=0;s<i.length;++s){const o=Wit(i[s]);e.bezierCurveTo(o[0],o[1],o[2],o[3],o[4],o[5])}}const qq=.5773502691896257,Xq={circle:{draw:function(e,t){const n=Math.sqrt(t)/2;e.moveTo(n,0),e.arc(0,0,n,0,fu)}},cross:{draw:function(e,t){var n=Math.sqrt(t)/2,r=n/2.5;e.moveTo(-n,-r),e.lineTo(-n,r),e.lineTo(-r,r),e.lineTo(-r,n),e.lineTo(r,n),e.lineTo(r,r),e.lineTo(n,r),e.lineTo(n,-r),e.lineTo(r,-r),e.lineTo(r,-n),e.lineTo(-r,-n),e.lineTo(-r,-r),e.closePath()}},diamond:{draw:function(e,t){const n=Math.sqrt(t)/2;e.moveTo(-n,0),e.lineTo(0,-n),e.lineTo(n,0),e.lineTo(0,n),e.closePath()}},square:{draw:function(e,t){var n=Math.sqrt(t),r=-n/2;e.rect(r,r,n,n)}},arrow:{draw:function(e,t){var n=Math.sqrt(t)/2,r=n/7,i=n/2.5,s=n/8;e.moveTo(-r,n),e.lineTo(r,n),e.lineTo(r,-s),e.lineTo(i,-s),e.lineTo(0,-n),e.lineTo(-i,-s),e.lineTo(-r,-s),e.closePath()}},wedge:{draw:function(e,t){var n=Math.sqrt(t)/2,r=nm*n,i=r-n*qq,s=n/4;e.moveTo(0,-r-i),e.lineTo(-s,r-i),e.lineTo(s,r-i),e.closePath()}},triangle:{draw:function(e,t){var n=Math.sqrt(t)/2,r=nm*n,i=r-n*qq;e.moveTo(0,-r-i),e.lineTo(-n,r-i),e.lineTo(n,r-i),e.closePath()}},"triangle-up":{draw:function(e,t){var n=Math.sqrt(t)/2,r=nm*n;e.moveTo(0,-r),e.lineTo(-n,r),e.lineTo(n,r),e.closePath()}},"triangle-down":{draw:function(e,t){var n=Math.sqrt(t)/2,r=nm*n;e.moveTo(0,r),e.lineTo(-n,-r),e.lineTo(n,-r),e.closePath()}},"triangle-right":{draw:function(e,t){var n=Math.sqrt(t)/2,r=nm*n;e.moveTo(r,0),e.lineTo(-r,-n),e.lineTo(-r,n),e.closePath()}},"triangle-left":{draw:function(e,t){var n=Math.sqrt(t)/2,r=nm*n;e.moveTo(-r,0),e.lineTo(r,-n),e.lineTo(r,n),e.closePath()}},stroke:{draw:function(e,t){const n=Math.sqrt(t)/2;e.moveTo(-n,0),e.lineTo(n,0)}}};function Git(e){return Ll(Xq,e)?Xq[e]:Hit(e)}var nO={};function Hit(e){if(!Ll(nO,e)){const t=qfe(e);nO[e]={draw:function(n,r){s4(n,t,0,0,Math.sqrt(r)/2)}}}return nO[e]}const zc=.448084975506;function qit(e){return e.x}function Xit(e){return e.y}function Yit(e){return e.width}function Kit(e){return e.height}function wl(e){return typeof e=="function"?e:()=>+e}function QC(e,t,n){return Math.max(t,Math.min(e,n))}function Zit(){var e=qit,t=Xit,n=Yit,r=Kit,i=wl(0),s=i,o=i,a=i,u=null;function l(c,f,h){var d,p=f??+e.call(this,c),g=h??+t.call(this,c),m=+n.call(this,c),y=+r.call(this,c),b=Math.min(m,y)/2,v=QC(+i.call(this,c),0,b),x=QC(+s.call(this,c),0,b),w=QC(+o.call(this,c),0,b),C=QC(+a.call(this,c),0,b);if(u||(u=d=Vz()),v<=0&&x<=0&&w<=0&&C<=0)u.rect(p,g,m,y);else{var $=p+m,S=g+y;u.moveTo(p+v,g),u.lineTo($-x,g),u.bezierCurveTo($-zc*x,g,$,g+zc*x,$,g+x),u.lineTo($,S-C),u.bezierCurveTo($,S-zc*C,$-zc*C,S,$-C,S),u.lineTo(p+w,S),u.bezierCurveTo(p+zc*w,S,p,S-zc*w,p,S-w),u.lineTo(p,g+v),u.bezierCurveTo(p,g+zc*v,p+zc*v,g,p+v,g),u.closePath()}if(d)return u=null,d+""||null}return l.x=function(c){return arguments.length?(e=wl(c),l):e},l.y=function(c){return arguments.length?(t=wl(c),l):t},l.width=function(c){return arguments.length?(n=wl(c),l):n},l.height=function(c){return arguments.length?(r=wl(c),l):r},l.cornerRadius=function(c,f,h,d){return arguments.length?(i=wl(c),s=f!=null?wl(f):i,a=h!=null?wl(h):i,o=d!=null?wl(d):s,l):i},l.context=function(c){return arguments.length?(u=c??null,l):u},l}function Jit(){var e,t,n,r,i=null,s,o,a,u;function l(f,h,d){const p=d/2;if(s){var g=a-h,m=f-o;if(g||m){var y=Math.sqrt(g*g+m*m),b=(g/=y)*u,v=(m/=y)*u,x=Math.atan2(m,g);i.moveTo(o-b,a-v),i.lineTo(f-g*p,h-m*p),i.arc(f,h,p,x-Math.PI,x),i.lineTo(o+b,a+v),i.arc(o,a,u,x,x+Math.PI)}else i.arc(f,h,p,0,fu);i.closePath()}else s=1;o=f,a=h,u=p}function c(f){var h,d=f.length,p,g=!1,m;for(i==null&&(i=m=Vz()),h=0;h<=d;++h)!(h<d&&r(p=f[h],h,f))===g&&(g=!g)&&(s=0),g&&l(+e(p,h,f),+t(p,h,f),+n(p,h,f));if(m)return i=null,m+""||null}return c.x=function(f){return arguments.length?(e=f,c):e},c.y=function(f){return arguments.length?(t=f,c):t},c.size=function(f){return arguments.length?(n=f,c):n},c.defined=function(f){return arguments.length?(r=f,c):r},c.context=function(f){return arguments.length?(f==null?i=null:i=f,c):i},c}function g$(e,t){return e??t}const m$=e=>e.x||0,y$=e=>e.y||0,Qit=e=>e.width||0,est=e=>e.height||0,tst=e=>(e.x||0)+(e.width||0),nst=e=>(e.y||0)+(e.height||0),rst=e=>e.startAngle||0,ist=e=>e.endAngle||0,sst=e=>e.padAngle||0,ost=e=>e.innerRadius||0,ast=e=>e.outerRadius||0,ust=e=>e.cornerRadius||0,lst=e=>g$(e.cornerRadiusTopLeft,e.cornerRadius)||0,cst=e=>g$(e.cornerRadiusTopRight,e.cornerRadius)||0,fst=e=>g$(e.cornerRadiusBottomRight,e.cornerRadius)||0,hst=e=>g$(e.cornerRadiusBottomLeft,e.cornerRadius)||0,dst=e=>g$(e.size,64),pst=e=>e.size||1,DD=e=>e.defined!==!1,gst=e=>Git(e.shape||"circle"),mst=Tet().startAngle(rst).endAngle(ist).padAngle(sst).innerRadius(ost).outerRadius(ast).cornerRadius(ust),yst=$ce().x(m$).y1(y$).y0(nst).defined(DD),bst=$ce().y(y$).x1(m$).x0(tst).defined(DD),xst=wce().x(m$).y(y$).defined(DD),vst=Zit().x(m$).y(y$).width(Qit).height(est).cornerRadius(lst,cst,fst,hst),wst=Det().type(gst).size(dst),$st=Jit().x(m$).y(y$).defined(DD).size(pst);function k8(e){return e.cornerRadius||e.cornerRadiusTopLeft||e.cornerRadiusTopRight||e.cornerRadiusBottomRight||e.cornerRadiusBottomLeft}function Cst(e,t){return mst.context(e)(t)}function Sst(e,t){const n=t[0],r=n.interpolate||"linear";return(n.orient==="horizontal"?bst:yst).curve(Hfe(r,n.orient,n.tension)).context(e)(t)}function kst(e,t){const n=t[0],r=n.interpolate||"linear";return xst.curve(Hfe(r,n.orient,n.tension)).context(e)(t)}function gy(e,t,n,r){return vst.context(e)(t,n,r)}function Est(e,t){return(t.mark.shape||t.shape).context(e)(t)}function _st(e,t){return wst.context(e)(t)}function Ast(e,t){return $st.context(e)(t)}var Tst=1;function E8(e,t,n){var r=t.clip,i=e._defs,s=t.clip_id||(t.clip_id="clip"+Tst++),o=i.clipping[s]||(i.clipping[s]={id:s});return fD(r)?o.path=r(null):k8(n)?o.path=gy(null,n,0,0):(o.width=n.width||0,o.height=n.height||0),"url(#"+s+")"}function ao(e){this.clear(),e&&this.union(e)}ao.prototype={clone(){return new ao(this)},clear(){return this.x1=+Number.MAX_VALUE,this.y1=+Number.MAX_VALUE,this.x2=-Number.MAX_VALUE,this.y2=-Number.MAX_VALUE,this},empty(){return this.x1===+Number.MAX_VALUE&&this.y1===+Number.MAX_VALUE&&this.x2===-Number.MAX_VALUE&&this.y2===-Number.MAX_VALUE},equals(e){return this.x1===e.x1&&this.y1===e.y1&&this.x2===e.x2&&this.y2===e.y2},set(e,t,n,r){return n<e?(this.x2=e,this.x1=n):(this.x1=e,this.x2=n),r<t?(this.y2=t,this.y1=r):(this.y1=t,this.y2=r),this},add(e,t){return e<this.x1&&(this.x1=e),t<this.y1&&(this.y1=t),e>this.x2&&(this.x2=e),t>this.y2&&(this.y2=t),this},expand(e){return this.x1-=e,this.y1-=e,this.x2+=e,this.y2+=e,this},round(){return this.x1=Math.floor(this.x1),this.y1=Math.floor(this.y1),this.x2=Math.ceil(this.x2),this.y2=Math.ceil(this.y2),this},scale(e){return this.x1*=e,this.y1*=e,this.x2*=e,this.y2*=e,this},translate(e,t){return this.x1+=e,this.x2+=e,this.y1+=t,this.y2+=t,this},rotate(e,t,n){const r=this.rotatedPoints(e,t,n);return this.clear().add(r[0],r[1]).add(r[2],r[3]).add(r[4],r[5]).add(r[6],r[7])},rotatedPoints(e,t,n){var{x1:r,y1:i,x2:s,y2:o}=this,a=Math.cos(e),u=Math.sin(e),l=t-t*a+n*u,c=n-t*u-n*a;return[a*r-u*i+l,u*r+a*i+c,a*r-u*o+l,u*r+a*o+c,a*s-u*i+l,u*s+a*i+c,a*s-u*o+l,u*s+a*o+c]},union(e){return e.x1<this.x1&&(this.x1=e.x1),e.y1<this.y1&&(this.y1=e.y1),e.x2>this.x2&&(this.x2=e.x2),e.y2>this.y2&&(this.y2=e.y2),this},intersect(e){return e.x1>this.x1&&(this.x1=e.x1),e.y1>this.y1&&(this.y1=e.y1),e.x2<this.x2&&(this.x2=e.x2),e.y2<this.y2&&(this.y2=e.y2),this},encloses(e){return e&&this.x1<=e.x1&&this.x2>=e.x2&&this.y1<=e.y1&&this.y2>=e.y2},alignsWith(e){return e&&(this.x1==e.x1||this.x2==e.x2||this.y1==e.y1||this.y2==e.y2)},intersects(e){return e&&!(this.x2<e.x1||this.x1>e.x2||this.y2<e.y1||this.y1>e.y2)},contains(e,t){return!(e<this.x1||e>this.x2||t<this.y1||t>this.y2)},width(){return this.x2-this.x1},height(){return this.y2-this.y1}};function _8(e){this.mark=e,this.bounds=this.bounds||new ao}function Yfe(e){_8.call(this,e),this.items=this.items||[]}Ko(Yfe,_8);function Kfe(e){this._pending=0,this._loader=e||qce()}function Yq(e){e._pending+=1}function ib(e){e._pending-=1}Kfe.prototype={pending(){return this._pending},sanitizeURL(e){const t=this;return Yq(t),t._loader.sanitize(e,{context:"href"}).then(n=>(ib(t),n)).catch(()=>(ib(t),null))},loadImage(e){const t=this,n=Fce();return Yq(t),t._loader.sanitize(e,{context:"image"}).then(r=>{const i=r.href;if(!i||!n)throw{url:i};const s=new n,o=Ll(r,"crossOrigin")?r.crossOrigin:"anonymous";return o!=null&&(s.crossOrigin=o),s.onload=()=>ib(t),s.onerror=()=>ib(t),s.src=i,s}).catch(r=>(ib(t),{complete:!1,width:0,height:0,src:r&&r.url||""}))},ready(){const e=this;return new Promise(t=>{function n(r){e.pending()?setTimeout(()=>{n(!0)},10):t(r)}n(!1)})}};function Mh(e,t,n){if(t.stroke&&t.opacity!==0&&t.strokeOpacity!==0){const r=t.strokeWidth!=null?+t.strokeWidth:1;e.expand(r+(n?Ist(t,r):0))}return e}function Ist(e,t){return e.strokeJoin&&e.strokeJoin!=="miter"?0:t}const Dst=fu-1e-8;let ND,XS,YS,Ud,o4,KS,a4,u4;const af=(e,t)=>ND.add(e,t),ZS=(e,t)=>af(XS=e,YS=t),Kq=e=>af(e,ND.y1),Zq=e=>af(ND.x1,e),Ad=(e,t)=>o4*e+a4*t,Td=(e,t)=>KS*e+u4*t,rO=(e,t)=>af(Ad(e,t),Td(e,t)),iO=(e,t)=>ZS(Ad(e,t),Td(e,t));function FD(e,t){return ND=e,t?(Ud=t*oh,o4=u4=Math.cos(Ud),KS=Math.sin(Ud),a4=-KS):(o4=u4=1,Ud=KS=a4=0),Nst}const Nst={beginPath(){},closePath(){},moveTo:iO,lineTo:iO,rect(e,t,n,r){Ud?(rO(e+n,t),rO(e+n,t+r),rO(e,t+r),iO(e,t)):(af(e+n,t+r),ZS(e,t))},quadraticCurveTo(e,t,n,r){const i=Ad(e,t),s=Td(e,t),o=Ad(n,r),a=Td(n,r);Jq(XS,i,o,Kq),Jq(YS,s,a,Zq),ZS(o,a)},bezierCurveTo(e,t,n,r,i,s){const o=Ad(e,t),a=Td(e,t),u=Ad(n,r),l=Td(n,r),c=Ad(i,s),f=Td(i,s);Qq(XS,o,u,c,Kq),Qq(YS,a,l,f,Zq),ZS(c,f)},arc(e,t,n,r,i,s){if(r+=Ud,i+=Ud,XS=n*Math.cos(i)+e,YS=n*Math.sin(i)+t,Math.abs(i-r)>Dst)af(e-n,t-n),af(e+n,t+n);else{const o=l=>af(n*Math.cos(l)+e,n*Math.sin(l)+t);let a,u;if(o(r),o(i),i!==r)if(r=r%fu,r<0&&(r+=fu),i=i%fu,i<0&&(i+=fu),i<r&&(s=!s,a=r,r=i,i=a),s)for(i-=fu,a=r-r%_d,u=0;u<4&&a>i;++u,a-=_d)o(a);else for(a=r-r%_d+_d,u=0;u<4&&a<i;++u,a=a+_d)o(a)}}};function Jq(e,t,n,r){const i=(e-t)/(e+n-2*t);0<i&&i<1&&r(e+(t-e)*i)}function Qq(e,t,n,r,i){const s=r-e+3*t-3*n,o=e+n-2*t,a=e-t;let u=0,l=0,c;Math.abs(s)>Uit?(c=o*o+a*s,c>=0&&(c=Math.sqrt(c),u=(-o+c)/s,l=(-o-c)/s)):u=.5*a/o,0<u&&u<1&&i(eX(u,e,t,n,r)),0<l&&l<1&&i(eX(l,e,t,n,r))}function eX(e,t,n,r,i){const s=1-e,o=s*s,a=e*e;return o*s*t+3*o*e*n+3*s*a*r+a*e*i}var Tf=(Tf=Ec(1,1))?Tf.getContext("2d"):null;const l4=new ao;function Zfe(e){return function(t,n){if(!Tf)return!0;e(Tf,t),l4.clear().union(t.bounds).intersect(n).round();const{x1:r,y1:i,x2:s,y2:o}=l4;for(let a=i;a<=o;++a)for(let u=r;u<=s;++u)if(Tf.isPointInPath(u,a))return!0;return!1}}function Jfe(e,t){return t.contains(e.x||0,e.y||0)}function Qfe(e,t){const n=e.x||0,r=e.y||0,i=e.width||0,s=e.height||0;return t.intersects(l4.set(n,r,n+i,r+s))}function Fst(e,t){const n=e.x||0,r=e.y||0,i=e.x2!=null?e.x2:n,s=e.y2!=null?e.y2:r;return jb(t,n,r,i,s)}function jb(e,t,n,r,i){const{x1:s,y1:o,x2:a,y2:u}=e,l=r-t,c=i-n;let f=0,h=1,d,p,g,m;for(m=0;m<4;++m){if(m===0&&(d=-l,p=-(s-t)),m===1&&(d=l,p=a-t),m===2&&(d=-c,p=-(o-n)),m===3&&(d=c,p=u-n),Math.abs(d)<1e-10&&p<0)return!1;if(g=p/d,d<0){if(g>h)return!1;g>f&&(f=g)}else if(d>0){if(g<f)return!1;g<h&&(h=g)}}return!0}function g0(e,t){e.globalCompositeOperation=t.blend||"source-over"}function na(e,t){return e??t}function tX(e,t){const n=t.length;for(let r=0;r<n;++r)e.addColorStop(t[r].offset,t[r].color);return e}function Ost(e,t,n){const r=n.width(),i=n.height();let s;if(t.gradient==="radial")s=e.createRadialGradient(n.x1+na(t.x1,.5)*r,n.y1+na(t.y1,.5)*i,Math.max(r,i)*na(t.r1,0),n.x1+na(t.x2,.5)*r,n.y1+na(t.y2,.5)*i,Math.max(r,i)*na(t.r2,.5));else{const o=na(t.x1,0),a=na(t.y1,0),u=na(t.x2,1),l=na(t.y2,0);if(o===u||a===l||r===i)s=e.createLinearGradient(n.x1+o*r,n.y1+a*i,n.x1+u*r,n.y1+l*i);else{const c=Ec(Math.ceil(r),Math.ceil(i)),f=c.getContext("2d");return f.scale(r,i),f.fillStyle=tX(f.createLinearGradient(o,a,u,l),t.stops),f.fillRect(0,0,r,i),e.createPattern(c,"no-repeat")}}return tX(s,t.stops)}function ehe(e,t,n){return S8(n)?Ost(e,n,t.bounds):n}function RE(e,t,n){return n*=t.fillOpacity==null?1:t.fillOpacity,n>0?(e.globalAlpha=n,e.fillStyle=ehe(e,t,t.fill),!0):!1}var Rst=[];function m0(e,t,n){var r=(r=t.strokeWidth)!=null?r:1;return r<=0?!1:(n*=t.strokeOpacity==null?1:t.strokeOpacity,n>0?(e.globalAlpha=n,e.strokeStyle=ehe(e,t,t.stroke),e.lineWidth=r,e.lineCap=t.strokeCap||"butt",e.lineJoin=t.strokeJoin||"miter",e.miterLimit=t.strokeMiterLimit||10,e.setLineDash&&(e.setLineDash(t.strokeDash||Rst),e.lineDashOffset=t.strokeDashOffset||0),!0):!1)}function Mst(e,t){return e.zindex-t.zindex||e.index-t.index}function the(e){if(!e.zdirty)return e.zitems;var t=e.items,n=[],r,i,s;for(i=0,s=t.length;i<s;++i)r=t[i],r.index=i,r.zindex&&n.push(r);return e.zdirty=!1,e.zitems=n.sort(Mst)}function Wu(e,t){var n=e.items,r,i;if(!n||!n.length)return;const s=the(e);if(s&&s.length){for(r=0,i=n.length;r<i;++r)n[r].zindex||t(n[r]);n=s}for(r=0,i=n.length;r<i;++r)t(n[r])}function c4(e,t){var n=e.items,r,i;if(!n||!n.length)return null;const s=the(e);for(s&&s.length&&(n=s),i=n.length;--i>=0;)if(r=t(n[i]))return r;if(n===s){for(n=e.items,i=n.length;--i>=0;)if(!n[i].zindex&&(r=t(n[i])))return r}return null}function A8(e){return function(t,n,r){Wu(n,i=>{(!r||r.intersects(i.bounds))&&nhe(e,t,i,i)})}}function Lst(e){return function(t,n,r){n.items.length&&(!r||r.intersects(n.bounds))&&nhe(e,t,n.items[0],n.items)}}function nhe(e,t,n,r){var i=n.opacity==null?1:n.opacity;i!==0&&(e(t,r)||(g0(t,n),n.fill&&RE(t,n,i)&&t.fill(),n.stroke&&m0(t,n,i)&&t.stroke()))}function OD(e){return e=e||hce,function(t,n,r,i,s,o){return r*=t.pixelRatio,i*=t.pixelRatio,c4(n,a=>{const u=a.bounds;if(!(u&&!u.contains(s,o)||!u)&&e(t,a,r,i,s,o))return a})}}function b$(e,t){return function(n,r,i,s){var o=Array.isArray(r)?r[0]:r,a=t??o.fill,u=o.stroke&&n.isPointInStroke,l,c;return u&&(l=o.strokeWidth,c=o.strokeCap,n.lineWidth=l??1,n.lineCap=c??"butt"),e(n,r)?!1:a&&n.isPointInPath(i,s)||u&&n.isPointInStroke(i,s)}}function T8(e){return OD(b$(e))}function ip(e,t){return"translate("+e+","+t+")"}function I8(e){return"rotate("+e+")"}function Pst(e,t){return"scale("+e+","+t+")"}function rhe(e){return ip(e.x||0,e.y||0)}function Bst(e){return ip(e.x||0,e.y||0)+(e.angle?" "+I8(e.angle):"")}function zst(e){return ip(e.x||0,e.y||0)+(e.angle?" "+I8(e.angle):"")+(e.scaleX||e.scaleY?" "+Pst(e.scaleX||1,e.scaleY||1):"")}function D8(e,t,n){function r(o,a){o("transform",Bst(a)),o("d",t(null,a))}function i(o,a){return t(FD(o,a.angle),a),Mh(o,a).translate(a.x||0,a.y||0)}function s(o,a){var u=a.x||0,l=a.y||0,c=a.angle||0;o.translate(u,l),c&&o.rotate(c*=oh),o.beginPath(),t(o,a),c&&o.rotate(-c),o.translate(-u,-l)}return{type:e,tag:"path",nested:!1,attr:r,bound:i,draw:A8(s),pick:T8(s),isect:n||Zfe(s)}}var Ust=D8("arc",Cst);function jst(e,t){for(var n=e[0].orient==="horizontal"?t[1]:t[0],r=e[0].orient==="horizontal"?"y":"x",i=e.length,s=1/0,o,a;--i>=0;)e[i].defined!==!1&&(a=Math.abs(e[i][r]-n),a<s&&(s=a,o=e[i]));return o}function Wst(e,t){for(var n=Math.pow(e[0].strokeWidth||1,2),r=e.length,i,s,o;--r>=0;)if(e[r].defined!==!1&&(i=e[r].x-t[0],s=e[r].y-t[1],o=i*i+s*s,o<n))return e[r];return null}function Vst(e,t){for(var n=e.length,r,i,s;--n>=0;)if(e[n].defined!==!1&&(r=e[n].x-t[0],i=e[n].y-t[1],s=r*r+i*i,r=e[n].size||1,s<r*r))return e[n];return null}function N8(e,t,n){function r(u,l){var c=l.mark.items;c.length&&u("d",t(null,c))}function i(u,l){var c=l.items;return c.length===0?u:(t(FD(u),c),Mh(u,c[0]))}function s(u,l){u.beginPath(),t(u,l)}const o=b$(s);function a(u,l,c,f,h,d){var p=l.items,g=l.bounds;return!p||!p.length||g&&!g.contains(h,d)?null:(c*=u.pixelRatio,f*=u.pixelRatio,o(u,p,c,f)?p[0]:null)}return{type:e,tag:"path",nested:!0,attr:r,bound:i,draw:Lst(s),pick:a,isect:Jfe,tip:n}}var Gst=N8("area",Sst,jst);function Hst(e,t){var n=t.clip;e.save(),fD(n)?(e.beginPath(),n(e),e.clip()):ihe(e,t.group)}function ihe(e,t){e.beginPath(),k8(t)?gy(e,t,0,0):e.rect(0,0,t.width||0,t.height||0),e.clip()}function she(e){const t=na(e.strokeWidth,1);return e.strokeOffset!=null?e.strokeOffset:e.stroke&&t>.5&&t<1.5?.5-Math.abs(t-1):0}function qst(e,t){e("transform",rhe(t))}function ohe(e,t){const n=she(t);e("d",gy(null,t,n,n))}function Xst(e,t){e("class","background"),e("aria-hidden",!0),ohe(e,t)}function Yst(e,t){e("class","foreground"),e("aria-hidden",!0),t.strokeForeground?ohe(e,t):e("d","")}function Kst(e,t,n){const r=t.clip?E8(n,t,t):null;e("clip-path",r)}function Zst(e,t){if(!t.clip&&t.items){const n=t.items,r=n.length;for(let i=0;i<r;++i)e.union(n[i].bounds)}return(t.clip||t.width||t.height)&&!t.noBound&&e.add(0,0).add(t.width||0,t.height||0),Mh(e,t),e.translate(t.x||0,t.y||0)}function Ov(e,t,n,r){const i=she(t);e.beginPath(),gy(e,t,(n||0)+i,(r||0)+i)}const Jst=b$(Ov),Qst=b$(Ov,!1),eot=b$(Ov,!0);function tot(e,t,n){Wu(t,r=>{const i=r.x||0,s=r.y||0,o=r.strokeForeground,a=r.opacity==null?1:r.opacity;(r.stroke||r.fill)&&a&&(Ov(e,r,i,s),g0(e,r),r.fill&&RE(e,r,a)&&e.fill(),r.stroke&&!o&&m0(e,r,a)&&e.stroke()),e.save(),e.translate(i,s),r.clip&&ihe(e,r),n&&n.translate(-i,-s),Wu(r,u=>{this.draw(e,u,n)}),n&&n.translate(i,s),e.restore(),o&&r.stroke&&a&&(Ov(e,r,i,s),g0(e,r),m0(e,r,a)&&e.stroke())})}function not(e,t,n,r,i,s){if(t.bounds&&!t.bounds.contains(i,s)||!t.items)return null;const o=n*e.pixelRatio,a=r*e.pixelRatio;return c4(t,u=>{let l,c,f;const h=u.bounds;if(h&&!h.contains(i,s))return;c=u.x||0,f=u.y||0;const d=c+(u.width||0),p=f+(u.height||0),g=u.clip;if(g&&(i<c||i>d||s<f||s>p))return;if(e.save(),e.translate(c,f),c=i-c,f=s-f,g&&k8(u)&&!eot(e,u,o,a))return e.restore(),null;const m=u.strokeForeground,y=t.interactive!==!1;return y&&m&&u.stroke&&Qst(e,u,o,a)?(e.restore(),u):(l=c4(u,b=>rot(b,c,f)?this.pick(b,n,r,c,f):null),!l&&y&&(u.fill||!m&&u.stroke)&&Jst(e,u,o,a)&&(l=u),e.restore(),l||null)})}function rot(e,t,n){return(e.interactive!==!1||e.marktype==="group")&&e.bounds&&e.bounds.contains(t,n)}var iot={type:"group",tag:"g",nested:!1,attr:qst,bound:Zst,draw:tot,pick:not,isect:Qfe,content:Kst,background:Xst,foreground:Yst},Rv={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",version:"1.1"};function F8(e,t){var n=e.image;return(!n||e.url&&e.url!==n.url)&&(n={complete:!1,width:0,height:0},t.loadImage(e.url).then(r=>{e.image=r,e.image.url=e.url})),n}function O8(e,t){return e.width!=null?e.width:!t||!t.width?0:e.aspect!==!1&&e.height?e.height*t.width/t.height:t.width}function R8(e,t){return e.height!=null?e.height:!t||!t.height?0:e.aspect!==!1&&e.width?e.width*t.height/t.width:t.height}function RD(e,t){return e==="center"?t/2:e==="right"?t:0}function MD(e,t){return e==="middle"?t/2:e==="bottom"?t:0}function sot(e,t,n){const r=F8(t,n),i=O8(t,r),s=R8(t,r),o=(t.x||0)-RD(t.align,i),a=(t.y||0)-MD(t.baseline,s),u=!r.src&&r.toDataURL?r.toDataURL():r.src||"";e("href",u,Rv["xmlns:xlink"],"xlink:href"),e("transform",ip(o,a)),e("width",i),e("height",s),e("preserveAspectRatio",t.aspect===!1?"none":"xMidYMid")}function oot(e,t){const n=t.image,r=O8(t,n),i=R8(t,n),s=(t.x||0)-RD(t.align,r),o=(t.y||0)-MD(t.baseline,i);return e.set(s,o,s+r,o+i)}function aot(e,t,n){Wu(t,r=>{if(n&&!n.intersects(r.bounds))return;const i=F8(r,this);let s=O8(r,i),o=R8(r,i);if(s===0||o===0)return;let a=(r.x||0)-RD(r.align,s),u=(r.y||0)-MD(r.baseline,o),l,c,f,h;r.aspect!==!1&&(c=i.width/i.height,f=r.width/r.height,c===c&&f===f&&c!==f&&(f<c?(h=s/c,u+=(o-h)/2,o=h):(h=o*c,a+=(s-h)/2,s=h))),(i.complete||i.toDataURL)&&(g0(e,r),e.globalAlpha=(l=r.opacity)!=null?l:1,e.imageSmoothingEnabled=r.smooth!==!1,e.drawImage(i,a,u,s,o))})}var uot={type:"image",tag:"image",nested:!1,attr:sot,bound:oot,draw:aot,pick:OD(),isect:hce,get:F8,xOffset:RD,yOffset:MD},lot=N8("line",kst,Wst);function cot(e,t){var n=t.scaleX||1,r=t.scaleY||1;(n!==1||r!==1)&&e("vector-effect","non-scaling-stroke"),e("transform",zst(t)),e("d",t.path)}function JS(e,t){var n=t.path;if(n==null)return!0;var r=t.x||0,i=t.y||0,s=t.scaleX||1,o=t.scaleY||1,a=(t.angle||0)*oh,u=t.pathCache;(!u||u.path!==n)&&((t.pathCache=u=qfe(n)).path=n),a&&e.rotate&&e.translate?(e.translate(r,i),e.rotate(a),s4(e,u,0,0,s,o),e.rotate(-a),e.translate(-r,-i)):s4(e,u,r,i,s,o)}function fot(e,t){return JS(FD(e,t.angle),t)?e.set(0,0,0,0):Mh(e,t,!0)}var hot={type:"path",tag:"path",nested:!1,attr:cot,bound:fot,draw:A8(JS),pick:T8(JS),isect:Zfe(JS)};function dot(e,t){e("d",gy(null,t))}function pot(e,t){var n,r;return Mh(e.set(n=t.x||0,r=t.y||0,n+t.width||0,r+t.height||0),t)}function nX(e,t){e.beginPath(),gy(e,t)}var got={type:"rect",tag:"path",nested:!1,attr:dot,bound:pot,draw:A8(nX),pick:T8(nX),isect:Qfe};function mot(e,t){e("transform",rhe(t)),e("x2",t.x2!=null?t.x2-(t.x||0):0),e("y2",t.y2!=null?t.y2-(t.y||0):0)}function yot(e,t){var n,r;return Mh(e.set(n=t.x||0,r=t.y||0,t.x2!=null?t.x2:n,t.y2!=null?t.y2:r),t)}function ahe(e,t,n){var r,i,s,o;return t.stroke&&m0(e,t,n)?(r=t.x||0,i=t.y||0,s=t.x2!=null?t.x2:r,o=t.y2!=null?t.y2:i,e.beginPath(),e.moveTo(r,i),e.lineTo(s,o),!0):!1}function bot(e,t,n){Wu(t,r=>{if(!(n&&!n.intersects(r.bounds))){var i=r.opacity==null?1:r.opacity;i&&ahe(e,r,i)&&(g0(e,r),e.stroke())}})}function xot(e,t,n,r){return e.isPointInStroke?ahe(e,t,1)&&e.isPointInStroke(n,r):!1}var vot={type:"rule",tag:"line",nested:!1,attr:mot,bound:yot,draw:bot,pick:OD(xot),isect:Fst},wot=D8("shape",Est),$ot=D8("symbol",_st,Jfe);const rX=yet();var lx={height:_c,measureWidth:M8,estimateWidth:f4,width:f4,canvas:uhe};uhe(!0);function uhe(e){lx.width=e&&Tf?M8:f4}function f4(e,t){return lhe(ah(e,t),_c(e))}function lhe(e,t){return~~(.8*e.length*t)}function M8(e,t){return _c(e)<=0||!(t=ah(e,t))?0:che(t,L8(e))}function che(e,t){const n=`(${t}) ${e}`;let r=rX.get(n);return r===void 0&&(Tf.font=t,r=Tf.measureText(e).width,rX.set(n,r)),r}function _c(e){return e.fontSize!=null?+e.fontSize||0:11}function Ip(e){return e.lineHeight!=null?e.lineHeight:_c(e)+2}function Cot(e){return Qu(e)?e.length>1?e:e[0]:e}function x$(e){return Cot(e.lineBreak&&e.text&&!Qu(e.text)?e.text.split(e.lineBreak):e.text)}function fhe(e){const t=x$(e);return(Qu(t)?t.length-1:0)*Ip(e)}function ah(e,t){const n=t==null?"":(t+"").trim();return e.limit>0&&n.length?kot(e,n):n}function Sot(e){if(lx.width===M8){const t=L8(e);return n=>che(n,t)}else{const t=_c(e);return n=>lhe(n,t)}}function kot(e,t){var n=+e.limit,r=Sot(e);if(r(t)<n)return t;var i=e.ellipsis||"",s=e.dir==="rtl",o=0,a=t.length,u;if(n-=r(i),s){for(;o<a;)u=o+a>>>1,r(t.slice(u))>n?o=u+1:a=u;return i+t.slice(o)}else{for(;o<a;)u=1+(o+a>>>1),r(t.slice(0,u))<n?o=u:a=u-1;return t.slice(0,o)+i}}function LD(e,t){var n=e.font;return(t&&n?String(n).replace(/"/g,"'"):n)||"sans-serif"}function L8(e,t){return(e.fontStyle?e.fontStyle+" ":"")+(e.fontVariant?e.fontVariant+" ":"")+(e.fontWeight?e.fontWeight+" ":"")+_c(e)+"px "+LD(e,t)}function P8(e){var t=e.baseline,n=_c(e);return Math.round(t==="top"?.79*n:t==="middle"?.3*n:t==="bottom"?-.21*n:t==="line-top"?.29*n+.5*Ip(e):t==="line-bottom"?.29*n-.5*Ip(e):0)}const Eot={left:"start",center:"middle",right:"end"},cx=new ao;function PD(e){var t=e.x||0,n=e.y||0,r=e.radius||0,i;return r&&(i=(e.theta||0)-_d,t+=r*Math.cos(i),n+=r*Math.sin(i)),cx.x1=t,cx.y1=n,cx}function _ot(e,t){var n=t.dx||0,r=(t.dy||0)+P8(t),i=PD(t),s=i.x1,o=i.y1,a=t.angle||0,u;e("text-anchor",Eot[t.align]||"start"),a?(u=ip(s,o)+" "+I8(a),(n||r)&&(u+=" "+ip(n,r))):u=ip(s+n,o+r),e("transform",u)}function B8(e,t,n){var r=lx.height(t),i=t.align,s=PD(t),o=s.x1,a=s.y1,u=t.dx||0,l=(t.dy||0)+P8(t)-Math.round(.8*r),c=x$(t),f;if(Qu(c)?(r+=Ip(t)*(c.length-1),f=c.reduce((h,d)=>Math.max(h,lx.width(t,d)),0)):f=lx.width(t,c),i==="center"?u-=f/2:i==="right"&&(u-=f),e.set(u+=o,l+=a,u+f,l+r),t.angle&&!n)e.rotate(t.angle*oh,o,a);else if(n===2)return e.rotatedPoints(t.angle*oh,o,a);return e}function Aot(e,t,n){Wu(t,r=>{var i=r.opacity==null?1:r.opacity,s,o,a,u,l,c,f;if(!(n&&!n.intersects(r.bounds)||i===0||r.fontSize<=0||r.text==null||r.text.length===0)){if(e.font=L8(r),e.textAlign=r.align||"left",s=PD(r),o=s.x1,a=s.y1,r.angle&&(e.save(),e.translate(o,a),e.rotate(r.angle*oh),o=a=0),o+=r.dx||0,a+=(r.dy||0)+P8(r),c=x$(r),g0(e,r),Qu(c))for(l=Ip(r),u=0;u<c.length;++u)f=ah(r,c[u]),r.fill&&RE(e,r,i)&&e.fillText(f,o,a),r.stroke&&m0(e,r,i)&&e.strokeText(f,o,a),a+=l;else f=ah(r,c),r.fill&&RE(e,r,i)&&e.fillText(f,o,a),r.stroke&&m0(e,r,i)&&e.strokeText(f,o,a);r.angle&&e.restore()}})}function Tot(e,t,n,r,i,s){if(t.fontSize<=0)return!1;if(!t.angle)return!0;var o=PD(t),a=o.x1,u=o.y1,l=B8(cx,t,1),c=-t.angle*oh,f=Math.cos(c),h=Math.sin(c),d=f*i-h*s+(a-f*a+h*u),p=h*i+f*s+(u-h*a-f*u);return l.contains(d,p)}function Iot(e,t){const n=B8(cx,e,2);return jb(t,n[0],n[1],n[2],n[3])||jb(t,n[0],n[1],n[4],n[5])||jb(t,n[4],n[5],n[6],n[7])||jb(t,n[2],n[3],n[6],n[7])}var Dot={type:"text",tag:"text",nested:!1,attr:_ot,bound:B8,draw:Aot,pick:OD(Tot),isect:Iot},Not=N8("trail",Ast,Vst),Dp={arc:Ust,area:Gst,group:iot,image:uot,line:lot,path:hot,rect:got,rule:vot,shape:wot,symbol:$ot,text:Dot,trail:Not};function jd(e,t,n){return!e&&typeof document<"u"&&document.createElement&&(e=document),e?n?e.createElementNS(n,t):e.createElement(t):null}function hhe(e,t){t=t.toLowerCase();for(var n=e.childNodes,r=0,i=n.length;r<i;++r)if(n[r].tagName.toLowerCase()===t)return n[r]}function Xs(e,t,n,r){var i=e.childNodes[t],s;return(!i||i.tagName.toLowerCase()!==n.toLowerCase())&&(s=i||null,i=jd(e.ownerDocument,n,r),e.insertBefore(i,s)),i}function hu(e,t){for(var n=e.childNodes,r=n.length;r>t;)e.removeChild(n[--r]);return e}function dhe(e){return"mark-"+e.marktype+(e.role?" role-"+e.role:"")+(e.name?" "+e.name:"")}function phe(e,t){const n=t.getBoundingClientRect();return[e.clientX-n.left-(t.clientLeft||0),e.clientY-n.top-(t.clientTop||0)]}function Fot(e,t,n,r){var i=e&&e.mark,s,o;if(i&&(s=Dp[i.marktype]).tip){for(o=phe(t,n),o[0]-=r[0],o[1]-=r[1];e=e.mark.group;)o[0]-=e.x||0,o[1]-=e.y||0;e=s.tip(i.items,o)}return e}function Np(e,t){this._active=null,this._handlers={},this._loader=e||qce(),this._tooltip=t||Oot}function Oot(e,t,n,r){e.element().setAttribute("title",r||"")}Np.prototype={initialize(e,t,n){return this._el=e,this._obj=n||null,this.origin(t)},element(){return this._el},canvas(){return this._el&&this._el.firstChild},origin(e){return arguments.length?(this._origin=e||[0,0],this):this._origin.slice()},scene(e){return arguments.length?(this._scene=e,this):this._scene},on(){},off(){},_handlerIndex(e,t,n){for(let r=e?e.length:0;--r>=0;)if(e[r].type===t&&(!n||e[r].handler===n))return r;return-1},handlers(e){const t=this._handlers,n=[];if(e)n.push(...t[this.eventName(e)]);else for(const r in t)n.push(...t[r]);return n},eventName(e){const t=e.indexOf(".");return t<0?e:e.slice(0,t)},handleHref(e,t,n){this._loader.sanitize(n,{context:"href"}).then(r=>{const i=new MouseEvent(e.type,e),s=jd(null,"a");for(const o in r)s.setAttribute(o,r[o]);s.dispatchEvent(i)}).catch(()=>{})},handleTooltip(e,t,n){if(t&&t.tooltip!=null){t=Fot(t,e,this.canvas(),this._origin);const r=n&&t&&t.tooltip||null;this._tooltip.call(this._obj,this,e,t,r)}},getItemBoundingClientRect(e){const t=this.canvas();if(!t)return;const n=t.getBoundingClientRect(),r=this._origin,i=e.bounds,s=i.width(),o=i.height();let a=i.x1+r[0]+n.left,u=i.y1+r[1]+n.top;for(;e.mark&&(e=e.mark.group);)a+=e.x||0,u+=e.y||0;return{x:a,y:u,width:s,height:o,left:a,top:u,right:a+s,bottom:u+o}}};function Ac(e){this._el=null,this._bgcolor=null,this._loader=new Kfe(e)}Ac.prototype={initialize(e,t,n,r,i){return this._el=e,this.resize(t,n,r,i)},element(){return this._el},canvas(){return this._el&&this._el.firstChild},background(e){return arguments.length===0?this._bgcolor:(this._bgcolor=e,this)},resize(e,t,n,r){return this._width=e,this._height=t,this._origin=n||[0,0],this._scale=r||1,this},dirty(){},render(e){const t=this;return t._call=function(){t._render(e)},t._call(),t._call=null,t},_render(){},renderAsync(e){const t=this.render(e);return this._ready?this._ready.then(()=>t):Promise.resolve(t)},_load(e,t){var n=this,r=n._loader[e](t);if(!n._ready){const i=n._call;n._ready=n._loader.ready().then(s=>{s&&i(),n._ready=null})}return r},sanitizeURL(e){return this._load("sanitizeURL",e)},loadImage(e){return this._load("loadImage",e)}};const Rot="keydown",Mot="keypress",Lot="keyup",ghe="dragenter",QS="dragleave",mhe="dragover",h4="mousedown",Pot="mouseup",ME="mousemove",fx="mouseout",yhe="mouseover",LE="click",Bot="dblclick",zot="wheel",bhe="mousewheel",PE="touchstart",BE="touchmove",zE="touchend",Uot=[Rot,Mot,Lot,ghe,QS,mhe,h4,Pot,ME,fx,yhe,LE,Bot,zot,bhe,PE,BE,zE],d4=ME,Mv=fx,p4=LE;function jot(e,t){Np.call(this,e,t),this._down=null,this._touch=null,this._first=!0,this._events={}}const Wot=e=>e===PE||e===BE||e===zE?[PE,BE,zE]:[e];function iX(e,t){Wot(t).forEach(n=>Vot(e,n))}function Vot(e,t){const n=e.canvas();n&&!e._events[t]&&(e._events[t]=1,n.addEventListener(t,e[t]?r=>e[t](r):r=>e.fire(t,r)))}function sX(e,t,n){return function(r){const i=this._active,s=this.pickEvent(r);s===i?this.fire(e,r):((!i||!i.exit)&&this.fire(n,r),this._active=s,this.fire(t,r),this.fire(e,r))}}function oX(e){return function(t){this.fire(e,t),this._active=null}}Ko(jot,Np,{initialize(e,t,n){return this._canvas=e&&hhe(e,"canvas"),[LE,h4,ME,fx,QS].forEach(r=>iX(this,r)),Np.prototype.initialize.call(this,e,t,n)},canvas(){return this._canvas},context(){return this._canvas.getContext("2d")},events:Uot,DOMMouseScroll(e){this.fire(bhe,e)},mousemove:sX(ME,yhe,fx),dragover:sX(mhe,ghe,QS),mouseout:oX(fx),dragleave:oX(QS),mousedown(e){this._down=this._active,this.fire(h4,e)},click(e){this._down===this._active&&(this.fire(LE,e),this._down=null)},touchstart(e){this._touch=this.pickEvent(e.changedTouches[0]),this._first&&(this._active=this._touch,this._first=!1),this.fire(PE,e,!0)},touchmove(e){this.fire(BE,e,!0)},touchend(e){this.fire(zE,e,!0),this._touch=null},fire(e,t,n){const r=n?this._touch:this._active,i=this._handlers[e];if(t.vegaType=e,e===p4&&r&&r.href?this.handleHref(t,r,r.href):(e===d4||e===Mv)&&this.handleTooltip(t,r,e!==Mv),i)for(let s=0,o=i.length;s<o;++s)i[s].handler.call(this._obj,t,r)},on(e,t){const n=this.eventName(e),r=this._handlers;return this._handlerIndex(r[n],e,t)<0&&(iX(this,e),(r[n]||(r[n]=[])).push({type:e,handler:t})),this},off(e,t){const n=this.eventName(e),r=this._handlers[n],i=this._handlerIndex(r,e,t);return i>=0&&r.splice(i,1),this},pickEvent(e){const t=phe(e,this._canvas),n=this._origin;return this.pick(this._scene,t[0],t[1],t[0]-n[0],t[1]-n[1])},pick(e,t,n,r,i){const s=this.context();return Dp[e.marktype].pick.call(this,s,e,t,n,r,i)}});function Got(){return typeof window<"u"&&window.devicePixelRatio||1}var Hot=Got();function qot(e,t,n,r,i,s){const o=typeof HTMLElement<"u"&&e instanceof HTMLElement&&e.parentNode!=null,a=e.getContext("2d"),u=o?Hot:i;e.width=t*u,e.height=n*u;for(const l in s)a[l]=s[l];return o&&u!==1&&(e.style.width=t+"px",e.style.height=n+"px"),a.pixelRatio=u,a.setTransform(u,0,0,u,u*r[0],u*r[1]),e}function Xot(e){Ac.call(this,e),this._options={},this._redraw=!1,this._dirty=new ao,this._tempb=new ao}const aX=Ac.prototype,Yot=(e,t,n)=>new ao().set(0,0,t,n).translate(-e[0],-e[1]);function Kot(e,t,n){return t.expand(1).round(),e.pixelRatio%1&&t.scale(e.pixelRatio).round().scale(1/e.pixelRatio),t.translate(-(n[0]%1),-(n[1]%1)),e.beginPath(),e.rect(t.x1,t.y1,t.width(),t.height()),e.clip(),t}Ko(Xot,Ac,{initialize(e,t,n,r,i,s){return this._options=s||{},this._canvas=this._options.externalContext?null:Ec(1,1,this._options.type),e&&this._canvas&&(hu(e,0).appendChild(this._canvas),this._canvas.setAttribute("class","marks")),aX.initialize.call(this,e,t,n,r,i)},resize(e,t,n,r){if(aX.resize.call(this,e,t,n,r),this._canvas)qot(this._canvas,this._width,this._height,this._origin,this._scale,this._options.context);else{const i=this._options.externalContext;i||ec("CanvasRenderer is missing a valid canvas or context"),i.scale(this._scale,this._scale),i.translate(this._origin[0],this._origin[1])}return this._redraw=!0,this},canvas(){return this._canvas},context(){return this._options.externalContext||(this._canvas?this._canvas.getContext("2d"):null)},dirty(e){const t=this._tempb.clear().union(e.bounds);let n=e.mark.group;for(;n;)t.translate(n.x||0,n.y||0),n=n.mark.group;this._dirty.union(t)},_render(e){const t=this.context(),n=this._origin,r=this._width,i=this._height,s=this._dirty,o=Yot(n,r,i);t.save();const a=this._redraw||s.empty()?(this._redraw=!1,o.expand(1)):Kot(t,o.intersect(s),n);return this.clear(-n[0],-n[1],r,i),this.draw(t,e,a),t.restore(),s.clear(),this},draw(e,t,n){const r=Dp[t.marktype];t.clip&&Hst(e,t),r.draw.call(this,e,t,n),t.clip&&e.restore()},clear(e,t,n,r){const i=this._options,s=this.context();i.type!=="pdf"&&!i.externalContext&&s.clearRect(e,t,n,r),this._bgcolor!=null&&(s.fillStyle=this._bgcolor,s.fillRect(e,t,n,r))}});function Zot(e,t){Np.call(this,e,t);const n=this;n._hrefHandler=g4(n,(r,i)=>{i&&i.href&&n.handleHref(r,i,i.href)}),n._tooltipHandler=g4(n,(r,i)=>{n.handleTooltip(r,i,r.type!==Mv)})}const g4=(e,t)=>n=>{let r=n.target.__data__;r=Array.isArray(r)?r[0]:r,n.vegaType=n.type,t.call(e._obj,n,r)};Ko(Zot,Np,{initialize(e,t,n){let r=this._svg;return r&&(r.removeEventListener(p4,this._hrefHandler),r.removeEventListener(d4,this._tooltipHandler),r.removeEventListener(Mv,this._tooltipHandler)),this._svg=r=e&&hhe(e,"svg"),r&&(r.addEventListener(p4,this._hrefHandler),r.addEventListener(d4,this._tooltipHandler),r.addEventListener(Mv,this._tooltipHandler)),Np.prototype.initialize.call(this,e,t,n)},canvas(){return this._svg},on(e,t){const n=this.eventName(e),r=this._handlers;if(this._handlerIndex(r[n],e,t)<0){const s={type:e,handler:t,listener:g4(this,t)};(r[n]||(r[n]=[])).push(s),this._svg&&this._svg.addEventListener(n,s.listener)}return this},off(e,t){const n=this.eventName(e),r=this._handlers[n],i=this._handlerIndex(r,e,t);return i>=0&&(this._svg&&this._svg.removeEventListener(n,r[i].listener),r.splice(i,1)),this}});const xhe="aria-hidden",z8="aria-label",U8="role",j8="aria-roledescription",vhe="graphics-object",W8="graphics-symbol",whe=(e,t,n)=>({[U8]:e,[j8]:t,[z8]:n||void 0}),Jot=pce(["axis-domain","axis-grid","axis-label","axis-tick","axis-title","legend-band","legend-entry","legend-gradient","legend-label","legend-title","legend-symbol","title"]),uX={axis:{desc:"axis",caption:tat},legend:{desc:"legend",caption:nat},"title-text":{desc:"title",caption:e=>`Title text '${cX(e)}'`},"title-subtitle":{desc:"subtitle",caption:e=>`Subtitle text '${cX(e)}'`}},lX={ariaRole:U8,ariaRoleDescription:j8,description:z8};function $he(e,t){const n=t.aria===!1;if(e(xhe,n||void 0),n||t.description==null)for(const r in lX)e(lX[r],void 0);else{const r=t.mark.marktype;e(z8,t.description),e(U8,t.ariaRole||(r==="group"?vhe:W8)),e(j8,t.ariaRoleDescription||`${r} mark`)}}function Che(e){return e.aria===!1?{[xhe]:!0}:Jot[e.role]?null:uX[e.role]?eat(e,uX[e.role]):Qot(e)}function Qot(e){const t=e.marktype,n=t==="group"||t==="text"||e.items.some(r=>r.description!=null&&r.aria!==!1);return whe(n?vhe:W8,`${t} mark container`,e.description)}function eat(e,t){try{const n=e.items[0],r=t.caption||(()=>"");return whe(t.role||W8,t.desc,n.description||r(n))}catch{return null}}function cX(e){return jz(e.text).join(" ")}function tat(e){const t=e.datum,n=e.orient,r=t.title?She(e):null,i=e.context,s=i.scales[t.scale].value,o=i.dataflow.locale(),a=s.type;return`${n==="left"||n==="right"?"Y":"X"}-axis`+(r?` titled '${r}'`:"")+` for a ${Pfe(a)?"discrete":a} scale with ${Vfe(o,s,e)}`}function nat(e){const t=e.datum,n=t.title?She(e):null,r=`${t.type||""} legend`.trim(),i=t.scales,s=Object.keys(i),o=e.context,a=o.scales[i[s[0]]].value,u=o.dataflow.locale();return iat(r)+(n?` titled '${n}'`:"")+` for ${rat(s)} with ${Vfe(u,a,e)}`}function She(e){try{return jz(Eu(e.items).items[0].text).join(" ")}catch{return null}}function rat(e){return e=e.map(t=>t+(t==="fill"||t==="stroke"?" color":"")),e.length<2?e[0]:e.slice(0,-1).join(", ")+" and "+Eu(e)}function iat(e){return e.length?e[0].toUpperCase()+e.slice(1):e}const khe=e=>(e+"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"),sat=e=>khe(e).replace(/"/g,"&quot;").replace(/\t/g,"&#x9;").replace(/\n/g,"&#xA;").replace(/\r/g,"&#xD;");function Ehe(){let e="",t="",n="";const r=[],i=()=>t=n="",s=u=>{t&&(e+=`${t}>${n}`,i()),r.push(u)},o=(u,l)=>(l!=null&&(t+=` ${u}="${sat(l)}"`),a),a={open(u){s(u),t="<"+u;for(var l=arguments.length,c=new Array(l>1?l-1:0),f=1;f<l;f++)c[f-1]=arguments[f];for(const h of c)for(const d in h)o(d,h[d]);return a},close(){const u=r.pop();return t?e+=t+(n?`>${n}</${u}>`:"/>"):e+=`</${u}>`,i(),a},attr:o,text:u=>(n+=khe(u),a),toString:()=>e};return a}const oat=e=>_he(Ehe(),e)+"";function _he(e,t){if(e.open(t.tagName),t.hasAttributes()){const n=t.attributes,r=n.length;for(let i=0;i<r;++i)e.attr(n[i].name,n[i].value)}if(t.hasChildNodes()){const n=t.childNodes;for(const r of n)r.nodeType===3?e.text(r.nodeValue):_he(e,r)}return e.close()}const UE={fill:"fill",fillOpacity:"fill-opacity",stroke:"stroke",strokeOpacity:"stroke-opacity",strokeWidth:"stroke-width",strokeCap:"stroke-linecap",strokeJoin:"stroke-linejoin",strokeDash:"stroke-dasharray",strokeDashOffset:"stroke-dashoffset",strokeMiterLimit:"stroke-miterlimit",opacity:"opacity"},jE={blend:"mix-blend-mode"},Ahe={fill:"none","stroke-miterlimit":10},sb=0,fX="http://www.w3.org/2000/xmlns/",ir=Rv.xmlns;function aat(e){Ac.call(this,e),this._dirtyID=0,this._dirty=[],this._svg=null,this._root=null,this._defs=null}const sO=Ac.prototype;Ko(aat,Ac,{initialize(e,t,n,r,i){return this._defs={},this._clearDefs(),e&&(this._svg=Xs(e,0,"svg",ir),this._svg.setAttributeNS(fX,"xmlns",ir),this._svg.setAttributeNS(fX,"xmlns:xlink",Rv["xmlns:xlink"]),this._svg.setAttribute("version",Rv.version),this._svg.setAttribute("class","marks"),hu(e,1),this._root=Xs(this._svg,sb,"g",ir),uf(this._root,Ahe),hu(this._svg,sb+1)),this.background(this._bgcolor),sO.initialize.call(this,e,t,n,r,i)},background(e){return arguments.length&&this._svg&&this._svg.style.setProperty("background-color",e),sO.background.apply(this,arguments)},resize(e,t,n,r){return sO.resize.call(this,e,t,n,r),this._svg&&(uf(this._svg,{width:this._width*this._scale,height:this._height*this._scale,viewBox:`0 0 ${this._width} ${this._height}`}),this._root.setAttribute("transform",`translate(${this._origin})`)),this._dirty=[],this},canvas(){return this._svg},svg(){const e=this._svg,t=this._bgcolor;if(!e)return null;let n;t&&(e.removeAttribute("style"),n=Xs(e,sb,"rect",ir),uf(n,{width:this._width,height:this._height,fill:t}));const r=oat(e);return t&&(e.removeChild(n),this._svg.style.setProperty("background-color",t)),r},_render(e){return this._dirtyCheck()&&(this._dirtyAll&&this._clearDefs(),this.mark(this._root,e),hu(this._root,1)),this.defs(),this._dirty=[],++this._dirtyID,this},dirty(e){e.dirty!==this._dirtyID&&(e.dirty=this._dirtyID,this._dirty.push(e))},isDirty(e){return this._dirtyAll||!e._svg||!e._svg.ownerSVGElement||e.dirty===this._dirtyID},_dirtyCheck(){this._dirtyAll=!0;const e=this._dirty;if(!e.length||!this._dirtyID)return!0;const t=++this._dirtyID;let n,r,i,s,o,a,u;for(o=0,a=e.length;o<a;++o)if(n=e[o],r=n.mark,r.marktype!==i&&(i=r.marktype,s=Dp[i]),r.zdirty&&r.dirty!==t&&(this._dirtyAll=!1,hX(n,t),r.items.forEach(l=>{l.dirty=t})),!r.zdirty){if(n.exit){s.nested&&r.items.length?(u=r.items[0],u._svg&&this._update(s,u._svg,u)):n._svg&&(u=n._svg.parentNode,u&&u.removeChild(n._svg)),n._svg=null;continue}n=s.nested?r.items[0]:n,n._update!==t&&(!n._svg||!n._svg.ownerSVGElement?(this._dirtyAll=!1,hX(n,t)):this._update(s,n._svg,n),n._update=t)}return!this._dirtyAll},mark(e,t,n){if(!this.isDirty(t))return t._svg;const r=this._svg,i=Dp[t.marktype],s=t.interactive===!1?"none":null,o=i.tag==="g",a=dX(t,e,n,"g",r);a.setAttribute("class",dhe(t));const u=Che(t);for(const h in u)Ri(a,h,u[h]);o||Ri(a,"pointer-events",s),Ri(a,"clip-path",t.clip?E8(this,t,t.group):null);let l=null,c=0;const f=h=>{const d=this.isDirty(h),p=dX(h,a,l,i.tag,r);d&&(this._update(i,p,h),o&&cat(this,p,h)),l=p,++c};return i.nested?t.items.length&&f(t.items[0]):Wu(t,f),hu(a,c),a},_update(e,t,n){Hl=t,oi=t.__values__,$he(hx,n),e.attr(hx,n,this);const r=hat[e.type];r&&r.call(this,e,t,n),Hl&&this.style(Hl,n)},style(e,t){if(t!=null){for(const n in UE){let r=n==="font"?LD(t):t[n];if(r===oi[n])continue;const i=UE[n];r==null?e.removeAttribute(i):(S8(r)&&(r=Gfe(r,this._defs.gradient,The())),e.setAttribute(i,r+"")),oi[n]=r}for(const n in jE)ek(e,jE[n],t[n])}},defs(){const e=this._svg,t=this._defs;let n=t.el,r=0;for(const i in t.gradient)n||(t.el=n=Xs(e,sb+1,"defs",ir)),r=uat(n,t.gradient[i],r);for(const i in t.clipping)n||(t.el=n=Xs(e,sb+1,"defs",ir)),r=lat(n,t.clipping[i],r);n&&(r===0?(e.removeChild(n),t.el=null):hu(n,r))},_clearDefs(){const e=this._defs;e.gradient={},e.clipping={}}});function hX(e,t){for(;e&&e.dirty!==t;e=e.mark.group)if(e.dirty=t,e.mark&&e.mark.dirty!==t)e.mark.dirty=t;else return}function uat(e,t,n){let r,i,s;if(t.gradient==="radial"){let o=Xs(e,n++,"pattern",ir);uf(o,{id:OE+t.id,viewBox:"0,0,1,1",width:"100%",height:"100%",preserveAspectRatio:"xMidYMid slice"}),o=Xs(o,0,"rect",ir),uf(o,{width:1,height:1,fill:`url(${The()}#${t.id})`}),e=Xs(e,n++,"radialGradient",ir),uf(e,{id:t.id,fx:t.x1,fy:t.y1,fr:t.r1,cx:t.x2,cy:t.y2,r:t.r2})}else e=Xs(e,n++,"linearGradient",ir),uf(e,{id:t.id,x1:t.x1,x2:t.x2,y1:t.y1,y2:t.y2});for(r=0,i=t.stops.length;r<i;++r)s=Xs(e,r,"stop",ir),s.setAttribute("offset",t.stops[r].offset),s.setAttribute("stop-color",t.stops[r].color);return hu(e,r),n}function lat(e,t,n){let r;return e=Xs(e,n,"clipPath",ir),e.setAttribute("id",t.id),t.path?(r=Xs(e,0,"path",ir),r.setAttribute("d",t.path)):(r=Xs(e,0,"rect",ir),uf(r,{x:0,y:0,width:t.width,height:t.height})),hu(e,1),n+1}function cat(e,t,n){t=t.lastChild.previousSibling;let r,i=0;Wu(n,s=>{r=e.mark(t,s,r),++i}),hu(t,1+i)}function dX(e,t,n,r,i){let s=e._svg,o;if(!s&&(o=t.ownerDocument,s=jd(o,r,ir),e._svg=s,e.mark&&(s.__data__=e,s.__values__={fill:"default"},r==="g"))){const a=jd(o,"path",ir);s.appendChild(a),a.__data__=e;const u=jd(o,"g",ir);s.appendChild(u),u.__data__=e;const l=jd(o,"path",ir);s.appendChild(l),l.__data__=e,l.__values__={fill:"default"}}return(s.ownerSVGElement!==i||fat(s,n))&&t.insertBefore(s,n?n.nextSibling:t.firstChild),s}function fat(e,t){return e.parentNode&&e.parentNode.childNodes.length>1&&e.previousSibling!=t}let Hl=null,oi=null;const hat={group(e,t,n){const r=Hl=t.childNodes[2];oi=r.__values__,e.foreground(hx,n,this),oi=t.__values__,Hl=t.childNodes[1],e.content(hx,n,this);const i=Hl=t.childNodes[0];e.background(hx,n,this);const s=n.mark.interactive===!1?"none":null;if(s!==oi.events&&(Ri(r,"pointer-events",s),Ri(i,"pointer-events",s),oi.events=s),n.strokeForeground&&n.stroke){const o=n.fill;Ri(r,"display",null),this.style(i,n),Ri(i,"stroke",null),o&&(n.fill=null),oi=r.__values__,this.style(r,n),o&&(n.fill=o),Hl=null}else Ri(r,"display","none")},image(e,t,n){n.smooth===!1?(ek(t,"image-rendering","optimizeSpeed"),ek(t,"image-rendering","pixelated")):ek(t,"image-rendering",null)},text(e,t,n){const r=x$(n);let i,s,o,a;Qu(r)?(s=r.map(u=>ah(n,u)),i=s.join(`
`),i!==oi.text&&(hu(t,0),o=t.ownerDocument,a=Ip(n),s.forEach((u,l)=>{const c=jd(o,"tspan",ir);c.__data__=n,c.textContent=u,l&&(c.setAttribute("x",0),c.setAttribute("dy",a)),t.appendChild(c)}),oi.text=i)):(s=ah(n,r),s!==oi.text&&(t.textContent=s,oi.text=s)),Ri(t,"font-family",LD(n)),Ri(t,"font-size",_c(n)+"px"),Ri(t,"font-style",n.fontStyle),Ri(t,"font-variant",n.fontVariant),Ri(t,"font-weight",n.fontWeight)}};function hx(e,t,n){t!==oi[e]&&(n?dat(Hl,e,t,n):Ri(Hl,e,t),oi[e]=t)}function ek(e,t,n){n!==oi[t]&&(n==null?e.style.removeProperty(t):e.style.setProperty(t,n+""),oi[t]=n)}function uf(e,t){for(const n in t)Ri(e,n,t[n])}function Ri(e,t,n){n!=null?e.setAttribute(t,n):e.removeAttribute(t)}function dat(e,t,n,r){n!=null?e.setAttributeNS(r,t,n):e.removeAttributeNS(r,t)}function The(){let e;return typeof window>"u"?"":(e=window.location).hash?e.href.slice(0,-e.hash.length):e.href}function pat(e){Ac.call(this,e),this._text=null,this._defs={gradient:{},clipping:{}}}Ko(pat,Ac,{svg(){return this._text},_render(e){const t=Ehe();t.open("svg",hD({},Rv,{class:"marks",width:this._width*this._scale,height:this._height*this._scale,viewBox:`0 0 ${this._width} ${this._height}`}));const n=this._bgcolor;return n&&n!=="transparent"&&n!=="none"&&t.open("rect",{width:this._width,height:this._height,fill:n}).close(),t.open("g",Ahe,{transform:"translate("+this._origin+")"}),this.mark(t,e),t.close(),this.defs(t),this._text=t.close()+"",this},mark(e,t){const n=Dp[t.marktype],r=n.tag,i=[$he,n.attr];e.open("g",{class:dhe(t),"clip-path":t.clip?E8(this,t,t.group):null},Che(t),{"pointer-events":r!=="g"&&t.interactive===!1?"none":null});const s=o=>{const a=this.href(o);if(a&&e.open("a",a),e.open(r,this.attr(t,o,i,r!=="g"?r:null)),r==="text"){const u=x$(o);if(Qu(u)){const l={x:0,dy:Ip(o)};for(let c=0;c<u.length;++c)e.open("tspan",c?l:null).text(ah(o,u[c])).close()}else e.text(ah(o,u))}else if(r==="g"){const u=o.strokeForeground,l=o.fill,c=o.stroke;u&&c&&(o.stroke=null),e.open("path",this.attr(t,o,n.background,"bgrect")).close(),e.open("g",this.attr(t,o,n.content)),Wu(o,f=>this.mark(e,f)),e.close(),u&&c?(l&&(o.fill=null),o.stroke=c,e.open("path",this.attr(t,o,n.foreground,"bgrect")).close(),l&&(o.fill=l)):e.open("path",this.attr(t,o,n.foreground,"bgfore")).close()}e.close(),a&&e.close()};return n.nested?t.items&&t.items.length&&s(t.items[0]):Wu(t,s),e.close()},href(e){const t=e.href;let n;if(t){if(n=this._hrefs&&this._hrefs[t])return n;this.sanitizeURL(t).then(r=>{r["xlink:href"]=r.href,r.href=null,(this._hrefs||(this._hrefs={}))[t]=r})}return null},attr(e,t,n,r){const i={},s=(o,a,u,l)=>{i[l||o]=a};return Array.isArray(n)?n.forEach(o=>o(s,t,this)):n(s,t,this),r&&gat(i,t,e,r,this._defs),i},defs(e){const t=this._defs.gradient,n=this._defs.clipping;if(Object.keys(t).length+Object.keys(n).length!==0){e.open("defs");for(const i in t){const s=t[i],o=s.stops;s.gradient==="radial"?(e.open("pattern",{id:OE+i,viewBox:"0,0,1,1",width:"100%",height:"100%",preserveAspectRatio:"xMidYMid slice"}),e.open("rect",{width:"1",height:"1",fill:"url(#"+i+")"}).close(),e.close(),e.open("radialGradient",{id:i,fx:s.x1,fy:s.y1,fr:s.r1,cx:s.x2,cy:s.y2,r:s.r2})):e.open("linearGradient",{id:i,x1:s.x1,x2:s.x2,y1:s.y1,y2:s.y2});for(let a=0;a<o.length;++a)e.open("stop",{offset:o[a].offset,"stop-color":o[a].color}).close();e.close()}for(const i in n){const s=n[i];e.open("clipPath",{id:i}),s.path?e.open("path",{d:s.path}).close():e.open("rect",{x:0,y:0,width:s.width,height:s.height}).close(),e.close()}e.close()}}});function gat(e,t,n,r,i){let s;if(t==null||(r==="bgrect"&&n.interactive===!1&&(e["pointer-events"]="none"),r==="bgfore"&&(n.interactive===!1&&(e["pointer-events"]="none"),e.display="none",t.fill!==null)))return e;r==="image"&&t.smooth===!1&&(s=["image-rendering: optimizeSpeed;","image-rendering: pixelated;"]),r==="text"&&(e["font-family"]=LD(t),e["font-size"]=_c(t)+"px",e["font-style"]=t.fontStyle,e["font-variant"]=t.fontVariant,e["font-weight"]=t.fontWeight);for(const o in UE){let a=t[o];const u=UE[o];a==="transparent"&&(u==="fill"||u==="stroke")||a!=null&&(S8(a)&&(a=Gfe(a,i.gradient,"")),e[u]=a)}for(const o in jE){const a=t[o];a!=null&&(s=s||[],s.push(`${jE[o]}: ${a};`))}return s&&(e.style=s.join(" ")),e}const oO=new ao;function mat(e){const t=e.clip;if(fD(t))t(FD(oO.clear()));else if(t)oO.set(0,0,e.group.width,e.group.height);else return;e.bounds.intersect(oO)}const y0="top",ma="left",xa="right",uh="bottom",yat="top-left",bat="top-right",xat="bottom-left",vat="bottom-right",V8="start",m4="middle",Li="end",wat="x",$at="y",BD="group",G8="axis",H8="title",Cat="frame",Sat="scope",q8="legend",Ihe="row-header",Dhe="row-footer",Nhe="row-title",Fhe="column-header",Ohe="column-footer",Rhe="column-title",kat="padding",Eat="symbol",Mhe="fit",Lhe="fit-x",Phe="fit-y",_at="pad",X8="none",eS="all",y4="each",Y8="flush",lf="column",cf="row";function Bhe(e){re.call(this,null,e)}Ko(Bhe,re,{transform(e,t){const n=t.dataflow,r=e.mark,i=r.marktype,s=Dp[i],o=s.bound;let a=r.bounds,u;if(s.nested)r.items.length&&n.dirty(r.items[0]),a=tS(r,o),r.items.forEach(l=>{l.bounds.clear().union(a)});else if(i===BD||e.modified())switch(t.visit(t.MOD,l=>n.dirty(l)),a.clear(),r.items.forEach(l=>a.union(tS(l,o))),r.role){case G8:case q8:case H8:t.reflow()}else u=t.changed(t.REM),t.visit(t.ADD,l=>{a.union(tS(l,o))}),t.visit(t.MOD,l=>{u=u||a.alignsWith(l.bounds),n.dirty(l),a.union(tS(l,o))}),u&&(a.clear(),r.items.forEach(l=>a.union(l.bounds)));return mat(r),t.modifies("bounds")}});function tS(e,t,n){return t(e.bounds.clear(),e,n)}const pX=":vega_identifier:";function K8(e){re.call(this,0,e)}K8.Definition={type:"Identifier",metadata:{modifies:!0},params:[{name:"as",type:"string",required:!0}]};Ko(K8,re,{transform(e,t){const n=Aat(t.dataflow),r=e.as;let i=n.value;return t.visit(t.ADD,s=>s[r]=s[r]||++i),n.set(this.value=i),t}});function Aat(e){return e._signals[pX]||(e._signals[pX]=e.add(0))}function zhe(e){re.call(this,null,e)}Ko(zhe,re,{transform(e,t){let n=this.value;n||(n=t.dataflow.scenegraph().mark(e.markdef,Tat(e),e.index),n.group.context=e.context,e.context.group||(e.context.group=n.group),n.source=this.source,n.clip=e.clip,n.interactive=e.interactive,this.value=n);const r=n.marktype===BD?Yfe:_8;return t.visit(t.ADD,i=>r.call(i,n)),(e.modified("clip")||e.modified("interactive"))&&(n.clip=e.clip,n.interactive=!!e.interactive,n.zdirty=!0,t.reflow()),n.items=t.source,t}});function Tat(e){const t=e.groups,n=e.parent;return t&&t.size===1?t.get(Object.keys(t.object)[0]):t&&n?t.lookup(n):null}function Uhe(e){re.call(this,null,e)}const gX={parity:e=>e.filter((t,n)=>n%2?t.opacity=0:1),greedy:(e,t)=>{let n;return e.filter((r,i)=>!i||!jhe(n.bounds,r.bounds,t)?(n=r,1):r.opacity=0)}},jhe=(e,t,n)=>n>Math.max(t.x1-e.x2,e.x1-t.x2,t.y1-e.y2,e.y1-t.y2),mX=(e,t)=>{for(var n=1,r=e.length,i=e[0].bounds,s;n<r;i=s,++n)if(jhe(i,s=e[n].bounds,t))return!0},Iat=e=>{const t=e.bounds;return t.width()>1&&t.height()>1},Dat=(e,t,n)=>{var r=e.range(),i=new ao;return t===y0||t===uh?i.set(r[0],-1/0,r[1],1/0):i.set(-1/0,r[0],1/0,r[1]),i.expand(n||1),s=>i.encloses(s.bounds)},yX=e=>(e.forEach(t=>t.opacity=1),e),bX=(e,t)=>e.reflow(t.modified()).modifies("opacity");Ko(Uhe,re,{transform(e,t){const n=gX[e.method]||gX.parity,r=e.separation||0;let i=t.materialize(t.SOURCE).source,s,o;if(!i||!i.length)return;if(!e.method)return e.modified("method")&&(yX(i),t=bX(t,e)),t;if(i=i.filter(Iat),!i.length)return;if(e.sort&&(i=i.slice().sort(e.sort)),s=yX(i),t=bX(t,e),s.length>=3&&mX(s,r)){do s=n(s,r);while(s.length>=3&&mX(s,r));s.length<3&&!Eu(i).opacity&&(s.length>1&&(Eu(s).opacity=0),Eu(i).opacity=1)}e.boundScale&&e.boundTolerance>=0&&(o=Dat(e.boundScale,e.boundOrient,+e.boundTolerance),i.forEach(u=>{o(u)||(u.opacity=0)}));const a=s[0].mark.bounds.clear();return i.forEach(u=>{u.opacity&&a.union(u.bounds)}),t}});function Whe(e){re.call(this,null,e)}Ko(Whe,re,{transform(e,t){const n=t.dataflow;if(t.visit(t.ALL,r=>n.dirty(r)),t.fields&&t.fields.zindex){const r=t.source&&t.source[0];r&&(r.mark.zdirty=!0)}}});const ii=new ao;function xm(e,t,n){return e[t]===n?0:(e[t]=n,1)}function Nat(e){var t=e.items[0].orient;return t===ma||t===xa}function Fat(e){let t=+e.grid;return[e.ticks?t++:-1,e.labels?t++:-1,t+ +e.domain]}function Oat(e,t,n,r){var i=t.items[0],s=i.datum,o=i.translate!=null?i.translate:.5,a=i.orient,u=Fat(s),l=i.range,c=i.offset,f=i.position,h=i.minExtent,d=i.maxExtent,p=s.title&&i.items[u[2]].items[0],g=i.titlePadding,m=i.bounds,y=p&&fhe(p),b=0,v=0,x,w;switch(ii.clear().union(m),m.clear(),(x=u[0])>-1&&m.union(i.items[x].bounds),(x=u[1])>-1&&m.union(i.items[x].bounds),a){case y0:b=f||0,v=-c,w=Math.max(h,Math.min(d,-m.y1)),m.add(0,-w).add(l,0),p&&nS(e,p,w,g,y,0,-1,m);break;case ma:b=-c,v=f||0,w=Math.max(h,Math.min(d,-m.x1)),m.add(-w,0).add(0,l),p&&nS(e,p,w,g,y,1,-1,m);break;case xa:b=n+c,v=f||0,w=Math.max(h,Math.min(d,m.x2)),m.add(0,0).add(w,l),p&&nS(e,p,w,g,y,1,1,m);break;case uh:b=f||0,v=r+c,w=Math.max(h,Math.min(d,m.y2)),m.add(0,0).add(l,w),p&&nS(e,p,w,g,0,0,1,m);break;default:b=i.x,v=i.y}return Mh(m.translate(b,v),i),xm(i,"x",b+o)|xm(i,"y",v+o)&&(i.bounds=ii,e.dirty(i),i.bounds=m,e.dirty(i)),i.mark.bounds.clear().union(m)}function nS(e,t,n,r,i,s,o,a){const u=t.bounds;if(t.auto){const l=o*(n+i+r);let c=0,f=0;e.dirty(t),s?c=(t.x||0)-(t.x=l):f=(t.y||0)-(t.y=l),t.mark.bounds.clear().union(u.translate(-c,-f)),e.dirty(t)}a.union(u)}const xX=(e,t)=>Math.floor(Math.min(e,t)),vX=(e,t)=>Math.ceil(Math.max(e,t));function Rat(e){var t=e.items,n=t.length,r=0,i,s;const o={marks:[],rowheaders:[],rowfooters:[],colheaders:[],colfooters:[],rowtitle:null,coltitle:null};for(;r<n;++r)if(i=t[r],s=i.items,i.marktype===BD)switch(i.role){case G8:case q8:case H8:break;case Ihe:o.rowheaders.push(...s);break;case Dhe:o.rowfooters.push(...s);break;case Fhe:o.colheaders.push(...s);break;case Ohe:o.colfooters.push(...s);break;case Nhe:o.rowtitle=s[0];break;case Rhe:o.coltitle=s[0];break;default:o.marks.push(...s)}return o}function Mat(e){return new ao().set(0,0,e.width||0,e.height||0)}function Lat(e){const t=e.bounds.clone();return t.empty()?t.set(0,0,0,0):t.translate(-(e.x||0),-(e.y||0))}function yn(e,t,n){const r=Uz(e)?e[t]:e;return r??(n!==void 0?n:0)}function wX(e){return e<0?Math.ceil(-e):0}function Vhe(e,t,n){var r=!n.nodirty,i=n.bounds===Y8?Mat:Lat,s=ii.set(0,0,0,0),o=yn(n.align,lf),a=yn(n.align,cf),u=yn(n.padding,lf),l=yn(n.padding,cf),c=n.columns||t.length,f=c<=0?1:Math.ceil(t.length/c),h=t.length,d=Array(h),p=Array(c),g=0,m=Array(h),y=Array(f),b=0,v=Array(h),x=Array(h),w=Array(h),C,$,S,k,E,_,D,A,T,I,F;for($=0;$<c;++$)p[$]=0;for($=0;$<f;++$)y[$]=0;for($=0;$<h;++$)_=t[$],E=w[$]=i(_),_.x=_.x||0,v[$]=0,_.y=_.y||0,x[$]=0,S=$%c,k=~~($/c),g=Math.max(g,D=Math.ceil(E.x2)),b=Math.max(b,A=Math.ceil(E.y2)),p[S]=Math.max(p[S],D),y[k]=Math.max(y[k],A),d[$]=u+wX(E.x1),m[$]=l+wX(E.y1),r&&e.dirty(t[$]);for($=0;$<h;++$)$%c===0&&(d[$]=0),$<c&&(m[$]=0);if(o===y4)for(S=1;S<c;++S){for(F=0,$=S;$<h;$+=c)F<d[$]&&(F=d[$]);for($=S;$<h;$+=c)d[$]=F+p[S-1]}else if(o===eS){for(F=0,$=0;$<h;++$)$%c&&F<d[$]&&(F=d[$]);for($=0;$<h;++$)$%c&&(d[$]=F+g)}else for(o=!1,S=1;S<c;++S)for($=S;$<h;$+=c)d[$]+=p[S-1];if(a===y4)for(k=1;k<f;++k){for(F=0,$=k*c,C=$+c;$<C;++$)F<m[$]&&(F=m[$]);for($=k*c;$<C;++$)m[$]=F+y[k-1]}else if(a===eS){for(F=0,$=c;$<h;++$)F<m[$]&&(F=m[$]);for($=c;$<h;++$)m[$]=F+b}else for(a=!1,k=1;k<f;++k)for($=k*c,C=$+c;$<C;++$)m[$]+=y[k-1];for(T=0,$=0;$<h;++$)T=d[$]+($%c?T:0),v[$]+=T-t[$].x;for(S=0;S<c;++S)for(I=0,$=S;$<h;$+=c)I+=m[$],x[$]+=I-t[$].y;if(o&&yn(n.center,lf)&&f>1)for($=0;$<h;++$)E=o===eS?g:p[$%c],T=E-w[$].x2-t[$].x-v[$],T>0&&(v[$]+=T/2);if(a&&yn(n.center,cf)&&c!==1)for($=0;$<h;++$)E=a===eS?b:y[~~($/c)],I=E-w[$].y2-t[$].y-x[$],I>0&&(x[$]+=I/2);for($=0;$<h;++$)s.union(w[$].translate(v[$],x[$]));switch(T=yn(n.anchor,wat),I=yn(n.anchor,$at),yn(n.anchor,lf)){case Li:T-=s.width();break;case m4:T-=s.width()/2}switch(yn(n.anchor,cf)){case Li:I-=s.height();break;case m4:I-=s.height()/2}for(T=Math.round(T),I=Math.round(I),s.clear(),$=0;$<h;++$)t[$].mark.bounds.clear();for($=0;$<h;++$)_=t[$],_.x+=v[$]+=T,_.y+=x[$]+=I,s.union(_.mark.bounds.union(_.bounds.translate(v[$],x[$]))),r&&e.dirty(_);return s}function Pat(e,t,n){var r=Rat(t),i=r.marks,s=n.bounds===Y8?Bat:zat,o=n.offset,a=n.columns||i.length,u=a<=0?1:Math.ceil(i.length/a),l=u*a,c,f,h,d,p,g,m;const y=Vhe(e,i,n);y.empty()&&y.set(0,0,0,0),r.rowheaders&&(g=yn(n.headerBand,cf,null),c=rS(e,r.rowheaders,i,a,u,-yn(o,"rowHeader"),xX,0,s,"x1",0,a,1,g)),r.colheaders&&(g=yn(n.headerBand,lf,null),f=rS(e,r.colheaders,i,a,a,-yn(o,"columnHeader"),xX,1,s,"y1",0,1,a,g)),r.rowfooters&&(g=yn(n.footerBand,cf,null),h=rS(e,r.rowfooters,i,a,u,yn(o,"rowFooter"),vX,0,s,"x2",a-1,a,1,g)),r.colfooters&&(g=yn(n.footerBand,lf,null),d=rS(e,r.colfooters,i,a,a,yn(o,"columnFooter"),vX,1,s,"y2",l-a,1,a,g)),r.rowtitle&&(p=yn(n.titleAnchor,cf),m=yn(o,"rowTitle"),m=p===Li?h+m:c-m,g=yn(n.titleBand,cf,.5),$X(e,r.rowtitle,m,0,y,g)),r.coltitle&&(p=yn(n.titleAnchor,lf),m=yn(o,"columnTitle"),m=p===Li?d+m:f-m,g=yn(n.titleBand,lf,.5),$X(e,r.coltitle,m,1,y,g))}function Bat(e,t){return t==="x1"?e.x||0:t==="y1"?e.y||0:t==="x2"?(e.x||0)+(e.width||0):t==="y2"?(e.y||0)+(e.height||0):void 0}function zat(e,t){return e.bounds[t]}function rS(e,t,n,r,i,s,o,a,u,l,c,f,h,d){var p=n.length,g=0,m=0,y,b,v,x,w,C,$,S,k;if(!p)return g;for(y=c;y<p;y+=f)n[y]&&(g=o(g,u(n[y],l)));if(!t.length)return g;for(t.length>i&&(e.warn("Grid headers exceed limit: "+i),t=t.slice(0,i)),g+=s,b=0,x=t.length;b<x;++b)e.dirty(t[b]),t[b].mark.bounds.clear();for(y=c,b=0,x=t.length;b<x;++b,y+=f){for(C=t[b],w=C.mark.bounds,v=y;v>=0&&($=n[v])==null;v-=h);a?(S=d==null?$.x:Math.round($.bounds.x1+d*$.bounds.width()),k=g):(S=g,k=d==null?$.y:Math.round($.bounds.y1+d*$.bounds.height())),w.union(C.bounds.translate(S-(C.x||0),k-(C.y||0))),C.x=S,C.y=k,e.dirty(C),m=o(m,w[l])}return m}function $X(e,t,n,r,i,s){if(t){e.dirty(t);var o=n,a=n;r?o=Math.round(i.x1+s*i.width()):a=Math.round(i.y1+s*i.height()),t.bounds.translate(o-(t.x||0),a-(t.y||0)),t.mark.bounds.clear().union(t.bounds),t.x=o,t.y=a,e.dirty(t)}}function Uat(e,t){const n=e[t]||{};return(r,i)=>n[r]!=null?n[r]:e[r]!=null?e[r]:i}function jat(e,t){let n=-1/0;return e.forEach(r=>{r.offset!=null&&(n=Math.max(n,r.offset))}),n>-1/0?n:t}function Wat(e,t,n,r,i,s,o){const a=Uat(n,t),u=jat(e,a("offset",0)),l=a("anchor",V8),c=l===Li?1:l===m4?.5:0,f={align:y4,bounds:a("bounds",Y8),columns:a("direction")==="vertical"?1:e.length,padding:a("margin",8),center:a("center"),nodirty:!0};switch(t){case ma:f.anchor={x:Math.floor(r.x1)-u,column:Li,y:c*(o||r.height()+2*r.y1),row:l};break;case xa:f.anchor={x:Math.ceil(r.x2)+u,y:c*(o||r.height()+2*r.y1),row:l};break;case y0:f.anchor={y:Math.floor(i.y1)-u,row:Li,x:c*(s||i.width()+2*i.x1),column:l};break;case uh:f.anchor={y:Math.ceil(i.y2)+u,x:c*(s||i.width()+2*i.x1),column:l};break;case yat:f.anchor={x:u,y:u};break;case bat:f.anchor={x:s-u,y:u,column:Li};break;case xat:f.anchor={x:u,y:o-u,row:Li};break;case vat:f.anchor={x:s-u,y:o-u,column:Li,row:Li};break}return f}function Vat(e,t){var n=t.items[0],r=n.datum,i=n.orient,s=n.bounds,o=n.x,a=n.y,u,l;return n._bounds?n._bounds.clear().union(s):n._bounds=s.clone(),s.clear(),Hat(e,n,n.items[0].items[0]),s=Gat(n,s),u=2*n.padding,l=2*n.padding,s.empty()||(u=Math.ceil(s.width()+u),l=Math.ceil(s.height()+l)),r.type===Eat&&qat(n.items[0].items[0].items[0].items),i!==X8&&(n.x=o=0,n.y=a=0),n.width=u,n.height=l,Mh(s.set(o,a,o+u,a+l),n),n.mark.bounds.clear().union(s),n}function Gat(e,t){return e.items.forEach(n=>t.union(n.bounds)),t.x1=e.padding,t.y1=e.padding,t}function Hat(e,t,n){var r=t.padding,i=r-n.x,s=r-n.y;if(!t.datum.title)(i||s)&&ob(e,n,i,s);else{var o=t.items[1].items[0],a=o.anchor,u=t.titlePadding||0,l=r-o.x,c=r-o.y;switch(o.orient){case ma:i+=Math.ceil(o.bounds.width())+u;break;case xa:case uh:break;default:s+=o.bounds.height()+u}switch((i||s)&&ob(e,n,i,s),o.orient){case ma:c+=rm(t,n,o,a,1,1);break;case xa:l+=rm(t,n,o,Li,0,0)+u,c+=rm(t,n,o,a,1,1);break;case uh:l+=rm(t,n,o,a,0,0),c+=rm(t,n,o,Li,-1,0,1)+u;break;default:l+=rm(t,n,o,a,0,0)}(l||c)&&ob(e,o,l,c),(l=Math.round(o.bounds.x1-r))<0&&(ob(e,n,-l,0),ob(e,o,-l,0))}}function rm(e,t,n,r,i,s,o){const a=e.datum.type!=="symbol",u=n.datum.vgrad,l=a&&(s||!u)&&!o?t.items[0]:t,c=l.bounds[i?"y2":"x2"]-e.padding,f=u&&s?c:0,h=u&&s?0:c,d=i<=0?0:fhe(n);return Math.round(r===V8?f:r===Li?h-d:.5*(c-d))}function ob(e,t,n,r){t.x+=n,t.y+=r,t.bounds.translate(n,r),t.mark.bounds.translate(n,r),e.dirty(t)}function qat(e){const t=e.reduce((n,r)=>(n[r.column]=Math.max(r.bounds.x2-r.x,n[r.column]||0),n),{});e.forEach(n=>{n.width=t[n.column],n.height=n.bounds.y2-n.y})}function Xat(e,t,n,r,i){var s=t.items[0],o=s.frame,a=s.orient,u=s.anchor,l=s.offset,c=s.padding,f=s.items[0].items[0],h=s.items[1]&&s.items[1].items[0],d=a===ma||a===xa?r:n,p=0,g=0,m=0,y=0,b=0,v;if(o!==BD?a===ma?(p=i.y2,d=i.y1):a===xa?(p=i.y1,d=i.y2):(p=i.x1,d=i.x2):a===ma&&(p=r,d=0),v=u===V8?p:u===Li?d:(p+d)/2,h&&h.text){switch(a){case y0:case uh:b=f.bounds.height()+c;break;case ma:y=f.bounds.width()+c;break;case xa:y=-f.bounds.width()-c;break}ii.clear().union(h.bounds),ii.translate(y-(h.x||0),b-(h.y||0)),xm(h,"x",y)|xm(h,"y",b)&&(e.dirty(h),h.bounds.clear().union(ii),h.mark.bounds.clear().union(ii),e.dirty(h)),ii.clear().union(h.bounds)}else ii.clear();switch(ii.union(f.bounds),a){case y0:g=v,m=i.y1-ii.height()-l;break;case ma:g=i.x1-ii.width()-l,m=v;break;case xa:g=i.x2+ii.width()+l,m=v;break;case uh:g=v,m=i.y2+l;break;default:g=s.x,m=s.y}return xm(s,"x",g)|xm(s,"y",m)&&(ii.translate(g,m),e.dirty(s),s.bounds.clear().union(ii),t.bounds.clear().union(ii),e.dirty(s)),s.bounds}function Ghe(e){re.call(this,null,e)}Ko(Ghe,re,{transform(e,t){const n=t.dataflow;return e.mark.items.forEach(r=>{e.layout&&Pat(n,r,e.layout),Kat(n,r,e)}),Yat(e.mark.group)?t.reflow():t}});function Yat(e){return e&&e.mark.role!=="legend-entry"}function Kat(e,t,n){var r=t.items,i=Math.max(0,t.width||0),s=Math.max(0,t.height||0),o=new ao().set(0,0,i,s),a=o.clone(),u=o.clone(),l=[],c,f,h,d,p,g;for(p=0,g=r.length;p<g;++p)switch(f=r[p],f.role){case G8:d=Nat(f)?a:u,d.union(Oat(e,f,i,s));break;case H8:c=f;break;case q8:l.push(Vat(e,f));break;case Cat:case Sat:case Ihe:case Dhe:case Nhe:case Fhe:case Ohe:case Rhe:a.union(f.bounds),u.union(f.bounds);break;default:o.union(f.bounds)}if(l.length){const m={};l.forEach(y=>{h=y.orient||xa,h!==X8&&(m[h]||(m[h]=[])).push(y)});for(const y in m){const b=m[y];Vhe(e,b,Wat(b,y,n.legends,a,u,i,s))}l.forEach(y=>{const b=y.bounds;if(b.equals(y._bounds)||(y.bounds=y._bounds,e.dirty(y),y.bounds=b,e.dirty(y)),n.autosize&&(n.autosize.type===Mhe||n.autosize.type===Lhe||n.autosize.type===Phe))switch(y.orient){case ma:case xa:o.add(b.x1,0).add(b.x2,0);break;case y0:case uh:o.add(0,b.y1).add(0,b.y2)}else o.union(b)})}o.union(a).union(u),c&&o.union(Xat(e,c,i,s,o)),t.clip&&o.set(0,0,t.width||0,t.height||0),Zat(e,t,o,n)}function Zat(e,t,n,r){const i=r.autosize||{},s=i.type;if(e._autosize<1||!s)return;let o=e._width,a=e._height,u=Math.max(0,t.width||0),l=Math.max(0,Math.ceil(-n.x1)),c=Math.max(0,t.height||0),f=Math.max(0,Math.ceil(-n.y1));const h=Math.max(0,Math.ceil(n.x2-u)),d=Math.max(0,Math.ceil(n.y2-c));if(i.contains===kat){const p=e.padding();o-=p.left+p.right,a-=p.top+p.bottom}s===X8?(l=0,f=0,u=o,c=a):s===Mhe?(u=Math.max(0,o-l-h),c=Math.max(0,a-f-d)):s===Lhe?(u=Math.max(0,o-l-h),a=c+f+d):s===Phe?(o=u+l+h,c=Math.max(0,a-f-d)):s===_at&&(o=u+l+h,a=c+f+d),e._resizeView(o,a,u,c,[l,f],i.resize)}const Jat=Object.freeze(Object.defineProperty({__proto__:null,bound:Bhe,identifier:K8,mark:zhe,overlap:Uhe,render:Whe,viewlayout:Ghe},Symbol.toStringTag,{value:"Module"}));function tl(e,t){switch(arguments.length){case 0:break;case 1:this.range(e);break;default:this.range(t).domain(e);break}return this}function Lh(e,t){switch(arguments.length){case 0:break;case 1:{typeof e=="function"?this.interpolator(e):this.range(e);break}default:{this.domain(e),typeof t=="function"?this.interpolator(t):this.range(t);break}}return this}const b4=Symbol("implicit");function Z8(){var e=new Map,t=[],n=[],r=b4;function i(s){var o=s+"",a=e.get(o);if(!a){if(r!==b4)return r;e.set(o,a=t.push(s))}return n[(a-1)%n.length]}return i.domain=function(s){if(!arguments.length)return t.slice();t=[],e=new Map;for(const o of s){const a=o+"";e.has(a)||e.set(a,t.push(o))}return i},i.range=function(s){return arguments.length?(n=Array.from(s),i):n.slice()},i.unknown=function(s){return arguments.length?(r=s,i):r},i.copy=function(){return Z8(t,n).unknown(r)},tl.apply(i,arguments),i}function Hhe(e,t,n,r,i){var s=e*e,o=s*e;return((1-3*e+3*s-o)*t+(4-6*s+3*o)*n+(1+3*e+3*s-3*o)*r+o*i)/6}function qhe(e){var t=e.length-1;return function(n){var r=n<=0?n=0:n>=1?(n=1,t-1):Math.floor(n*t),i=e[r],s=e[r+1],o=r>0?e[r-1]:2*i-s,a=r<t-1?e[r+2]:2*s-i;return Hhe((n-r/t)*t,o,i,s,a)}}function Xhe(e){var t=e.length;return function(n){var r=Math.floor(((n%=1)<0?++n:n)*t),i=e[(r+t-1)%t],s=e[r%t],o=e[(r+1)%t],a=e[(r+2)%t];return Hhe((n-r/t)*t,i,s,o,a)}}const zD=e=>()=>e;function Yhe(e,t){return function(n){return e+n*t}}function Qat(e,t,n){return e=Math.pow(e,n),t=Math.pow(t,n)-e,n=1/n,function(r){return Math.pow(e+r*t,n)}}function UD(e,t){var n=t-e;return n?Yhe(e,n>180||n<-180?n-360*Math.round(n/360):n):zD(isNaN(e)?t:e)}function eut(e){return(e=+e)==1?Sr:function(t,n){return n-t?Qat(t,n,e):zD(isNaN(t)?n:t)}}function Sr(e,t){var n=t-e;return n?Yhe(e,n):zD(isNaN(e)?t:e)}const x4=function e(t){var n=eut(t);function r(i,s){var o=n((i=Ns(i)).r,(s=Ns(s)).r),a=n(i.g,s.g),u=n(i.b,s.b),l=Sr(i.opacity,s.opacity);return function(c){return i.r=o(c),i.g=a(c),i.b=u(c),i.opacity=l(c),i+""}}return r.gamma=e,r}(1);function Khe(e){return function(t){var n=t.length,r=new Array(n),i=new Array(n),s=new Array(n),o,a;for(o=0;o<n;++o)a=Ns(t[o]),r[o]=a.r||0,i[o]=a.g||0,s[o]=a.b||0;return r=e(r),i=e(i),s=e(s),a.opacity=1,function(u){return a.r=r(u),a.g=i(u),a.b=s(u),a+""}}}var tut=Khe(qhe),nut=Khe(Xhe);function J8(e,t){t||(t=[]);var n=e?Math.min(t.length,e.length):0,r=t.slice(),i;return function(s){for(i=0;i<n;++i)r[i]=e[i]*(1-s)+t[i]*s;return r}}function Zhe(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}function rut(e,t){return(Zhe(t)?J8:Jhe)(e,t)}function Jhe(e,t){var n=t?t.length:0,r=e?Math.min(n,e.length):0,i=new Array(r),s=new Array(n),o;for(o=0;o<r;++o)i[o]=Ph(e[o],t[o]);for(;o<n;++o)s[o]=t[o];return function(a){for(o=0;o<r;++o)s[o]=i[o](a);return s}}function Qhe(e,t){var n=new Date;return e=+e,t=+t,function(r){return n.setTime(e*(1-r)+t*r),n}}function da(e,t){return e=+e,t=+t,function(n){return e*(1-n)+t*n}}function ede(e,t){var n={},r={},i;(e===null||typeof e!="object")&&(e={}),(t===null||typeof t!="object")&&(t={});for(i in t)i in e?n[i]=Ph(e[i],t[i]):r[i]=t[i];return function(s){for(i in n)r[i]=n[i](s);return r}}var v4=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,aO=new RegExp(v4.source,"g");function iut(e){return function(){return e}}function sut(e){return function(t){return e(t)+""}}function tde(e,t){var n=v4.lastIndex=aO.lastIndex=0,r,i,s,o=-1,a=[],u=[];for(e=e+"",t=t+"";(r=v4.exec(e))&&(i=aO.exec(t));)(s=i.index)>n&&(s=t.slice(n,s),a[o]?a[o]+=s:a[++o]=s),(r=r[0])===(i=i[0])?a[o]?a[o]+=i:a[++o]=i:(a[++o]=null,u.push({i:o,x:da(r,i)})),n=aO.lastIndex;return n<t.length&&(s=t.slice(n),a[o]?a[o]+=s:a[++o]=s),a.length<2?u[0]?sut(u[0].x):iut(t):(t=u.length,function(l){for(var c=0,f;c<t;++c)a[(f=u[c]).i]=f.x(l);return a.join("")})}function Ph(e,t){var n=typeof t,r;return t==null||n==="boolean"?zD(t):(n==="number"?da:n==="string"?(r=hc(t))?(t=r,x4):tde:t instanceof hc?x4:t instanceof Date?Qhe:Zhe(t)?J8:Array.isArray(t)?Jhe:typeof t.valueOf!="function"&&typeof t.toString!="function"||isNaN(t)?ede:da)(e,t)}function out(e){var t=e.length;return function(n){return e[Math.max(0,Math.min(t-1,Math.floor(n*t)))]}}function aut(e,t){var n=UD(+e,+t);return function(r){var i=n(r);return i-360*Math.floor(i/360)}}function v$(e,t){return e=+e,t=+t,function(n){return Math.round(e*(1-n)+t*n)}}var CX=180/Math.PI,w4={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function nde(e,t,n,r,i,s){var o,a,u;return(o=Math.sqrt(e*e+t*t))&&(e/=o,t/=o),(u=e*n+t*r)&&(n-=e*u,r-=t*u),(a=Math.sqrt(n*n+r*r))&&(n/=a,r/=a,u/=a),e*r<t*n&&(e=-e,t=-t,u=-u,o=-o),{translateX:i,translateY:s,rotate:Math.atan2(t,e)*CX,skewX:Math.atan(u)*CX,scaleX:o,scaleY:a}}var iS;function uut(e){const t=new(typeof DOMMatrix=="function"?DOMMatrix:WebKitCSSMatrix)(e+"");return t.isIdentity?w4:nde(t.a,t.b,t.c,t.d,t.e,t.f)}function lut(e){return e==null||(iS||(iS=document.createElementNS("http://www.w3.org/2000/svg","g")),iS.setAttribute("transform",e),!(e=iS.transform.baseVal.consolidate()))?w4:(e=e.matrix,nde(e.a,e.b,e.c,e.d,e.e,e.f))}function rde(e,t,n,r){function i(l){return l.length?l.pop()+" ":""}function s(l,c,f,h,d,p){if(l!==f||c!==h){var g=d.push("translate(",null,t,null,n);p.push({i:g-4,x:da(l,f)},{i:g-2,x:da(c,h)})}else(f||h)&&d.push("translate("+f+t+h+n)}function o(l,c,f,h){l!==c?(l-c>180?c+=360:c-l>180&&(l+=360),h.push({i:f.push(i(f)+"rotate(",null,r)-2,x:da(l,c)})):c&&f.push(i(f)+"rotate("+c+r)}function a(l,c,f,h){l!==c?h.push({i:f.push(i(f)+"skewX(",null,r)-2,x:da(l,c)}):c&&f.push(i(f)+"skewX("+c+r)}function u(l,c,f,h,d,p){if(l!==f||c!==h){var g=d.push(i(d)+"scale(",null,",",null,")");p.push({i:g-4,x:da(l,f)},{i:g-2,x:da(c,h)})}else(f!==1||h!==1)&&d.push(i(d)+"scale("+f+","+h+")")}return function(l,c){var f=[],h=[];return l=e(l),c=e(c),s(l.translateX,l.translateY,c.translateX,c.translateY,f,h),o(l.rotate,c.rotate,f,h),a(l.skewX,c.skewX,f,h),u(l.scaleX,l.scaleY,c.scaleX,c.scaleY,f,h),l=c=null,function(d){for(var p=-1,g=h.length,m;++p<g;)f[(m=h[p]).i]=m.x(d);return f.join("")}}}var cut=rde(uut,"px, ","px)","deg)"),fut=rde(lut,", ",")",")"),hut=1e-12;function SX(e){return((e=Math.exp(e))+1/e)/2}function dut(e){return((e=Math.exp(e))-1/e)/2}function put(e){return((e=Math.exp(2*e))-1)/(e+1)}const gut=function e(t,n,r){function i(s,o){var a=s[0],u=s[1],l=s[2],c=o[0],f=o[1],h=o[2],d=c-a,p=f-u,g=d*d+p*p,m,y;if(g<hut)y=Math.log(h/l)/t,m=function($){return[a+$*d,u+$*p,l*Math.exp(t*$*y)]};else{var b=Math.sqrt(g),v=(h*h-l*l+r*g)/(2*l*n*b),x=(h*h-l*l-r*g)/(2*h*n*b),w=Math.log(Math.sqrt(v*v+1)-v),C=Math.log(Math.sqrt(x*x+1)-x);y=(C-w)/t,m=function($){var S=$*y,k=SX(w),E=l/(n*b)*(k*put(t*S+w)-dut(w));return[a+E*d,u+E*p,l*k/SX(t*S+w)]}}return m.duration=y*1e3*t/Math.SQRT2,m}return i.rho=function(s){var o=Math.max(.001,+s),a=o*o,u=a*a;return e(o,a,u)},i}(Math.SQRT2,2,4);function ide(e){return function(t,n){var r=e((t=nh(t)).h,(n=nh(n)).h),i=Sr(t.s,n.s),s=Sr(t.l,n.l),o=Sr(t.opacity,n.opacity);return function(a){return t.h=r(a),t.s=i(a),t.l=s(a),t.opacity=o(a),t+""}}}const mut=ide(UD);var yut=ide(Sr);function but(e,t){var n=Sr((e=rh(e)).l,(t=rh(t)).l),r=Sr(e.a,t.a),i=Sr(e.b,t.b),s=Sr(e.opacity,t.opacity);return function(o){return e.l=n(o),e.a=r(o),e.b=i(o),e.opacity=s(o),e+""}}function sde(e){return function(t,n){var r=e((t=ih(t)).h,(n=ih(n)).h),i=Sr(t.c,n.c),s=Sr(t.l,n.l),o=Sr(t.opacity,n.opacity);return function(a){return t.h=r(a),t.c=i(a),t.l=s(a),t.opacity=o(a),t+""}}}const xut=sde(UD);var vut=sde(Sr);function ode(e){return function t(n){n=+n;function r(i,s){var o=e((i=Tp(i)).h,(s=Tp(s)).h),a=Sr(i.s,s.s),u=Sr(i.l,s.l),l=Sr(i.opacity,s.opacity);return function(c){return i.h=o(c),i.s=a(c),i.l=u(Math.pow(c,n)),i.opacity=l(c),i+""}}return r.gamma=t,r}(1)}const wut=ode(UD);var $ut=ode(Sr);function Q8(e,t){t===void 0&&(t=e,e=Ph);for(var n=0,r=t.length-1,i=t[0],s=new Array(r<0?0:r);n<r;)s[n]=e(i,i=t[++n]);return function(o){var a=Math.max(0,Math.min(r-1,Math.floor(o*=r)));return s[a](o-a)}}function Cut(e,t){for(var n=new Array(t),r=0;r<t;++r)n[r]=e(r/(t-1));return n}const Sut=Object.freeze(Object.defineProperty({__proto__:null,interpolate:Ph,interpolateArray:rut,interpolateBasis:qhe,interpolateBasisClosed:Xhe,interpolateCubehelix:wut,interpolateCubehelixLong:$ut,interpolateDate:Qhe,interpolateDiscrete:out,interpolateHcl:xut,interpolateHclLong:vut,interpolateHsl:mut,interpolateHslLong:yut,interpolateHue:aut,interpolateLab:but,interpolateNumber:da,interpolateNumberArray:J8,interpolateObject:ede,interpolateRgb:x4,interpolateRgbBasis:tut,interpolateRgbBasisClosed:nut,interpolateRound:v$,interpolateString:tde,interpolateTransformCss:cut,interpolateTransformSvg:fut,interpolateZoom:gut,piecewise:Q8,quantize:Cut},Symbol.toStringTag,{value:"Module"}));function kut(e){return function(){return e}}function $4(e){return+e}var kX=[0,1];function Cs(e){return e}function C4(e,t){return(t-=e=+e)?function(n){return(n-e)/t}:kut(isNaN(t)?NaN:.5)}function Eut(e,t){var n;return e>t&&(n=e,e=t,t=n),function(r){return Math.max(e,Math.min(t,r))}}function _ut(e,t,n){var r=e[0],i=e[1],s=t[0],o=t[1];return i<r?(r=C4(i,r),s=n(o,s)):(r=C4(r,i),s=n(s,o)),function(a){return s(r(a))}}function Aut(e,t,n){var r=Math.min(e.length,t.length)-1,i=new Array(r),s=new Array(r),o=-1;for(e[r]<e[0]&&(e=e.slice().reverse(),t=t.slice().reverse());++o<r;)i[o]=C4(e[o],e[o+1]),s[o]=n(t[o],t[o+1]);return function(a){var u=r$(e,a,1,r)-1;return s[u](i[u](a))}}function w$(e,t){return t.domain(e.domain()).range(e.range()).interpolate(e.interpolate()).clamp(e.clamp()).unknown(e.unknown())}function jD(){var e=kX,t=kX,n=Ph,r,i,s,o=Cs,a,u,l;function c(){var h=Math.min(e.length,t.length);return o!==Cs&&(o=Eut(e[0],e[h-1])),a=h>2?Aut:_ut,u=l=null,f}function f(h){return h==null||isNaN(h=+h)?s:(u||(u=a(e.map(r),t,n)))(r(o(h)))}return f.invert=function(h){return o(i((l||(l=a(t,e.map(r),da)))(h)))},f.domain=function(h){return arguments.length?(e=Array.from(h,$4),c()):e.slice()},f.range=function(h){return arguments.length?(t=Array.from(h),c()):t.slice()},f.rangeRound=function(h){return t=Array.from(h),n=v$,c()},f.clamp=function(h){return arguments.length?(o=h?!0:Cs,c()):o!==Cs},f.interpolate=function(h){return arguments.length?(n=h,c()):n},f.unknown=function(h){return arguments.length?(s=h,f):s},function(h,d){return r=h,i=d,c()}}function ade(){return jD()(Cs,Cs)}function WE(e,t){if((n=(e=t?e.toExponential(t-1):e.toExponential()).indexOf("e"))<0)return null;var n,r=e.slice(0,n);return[r.length>1?r[0]+r.slice(2):r,+e.slice(n+1)]}function b0(e){return e=WE(Math.abs(e)),e?e[1]:NaN}function Tut(e,t){return function(n,r){for(var i=n.length,s=[],o=0,a=e[0],u=0;i>0&&a>0&&(u+a+1>r&&(a=Math.max(1,r-u)),s.push(n.substring(i-=a,i+a)),!((u+=a+1)>r));)a=e[o=(o+1)%e.length];return s.reverse().join(t)}}function Iut(e){return function(t){return t.replace(/[0-9]/g,function(n){return e[+n]})}}var Dut=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function Fp(e){return new e7(e)}Fp.prototype=e7.prototype;function e7(e){if(!(t=Dut.exec(e)))throw new Error("invalid format: "+e);var t;this.fill=t[1]||" ",this.align=t[2]||">",this.sign=t[3]||"-",this.symbol=t[4]||"",this.zero=!!t[5],this.width=t[6]&&+t[6],this.comma=!!t[7],this.precision=t[8]&&+t[8].slice(1),this.trim=!!t[9],this.type=t[10]||""}e7.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width==null?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision==null?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function Nut(e){e:for(var t=e.length,n=1,r=-1,i;n<t;++n)switch(e[n]){case".":r=i=n;break;case"0":r===0&&(r=n),i=n;break;default:if(r>0){if(!+e[n])break e;r=0}break}return r>0?e.slice(0,r)+e.slice(i+1):e}var ude;function Fut(e,t){var n=WE(e,t);if(!n)return e+"";var r=n[0],i=n[1],s=i-(ude=Math.max(-8,Math.min(8,Math.floor(i/3)))*3)+1,o=r.length;return s===o?r:s>o?r+new Array(s-o+1).join("0"):s>0?r.slice(0,s)+"."+r.slice(s):"0."+new Array(1-s).join("0")+WE(e,Math.max(0,t+s-1))[0]}function EX(e,t){var n=WE(e,t);if(!n)return e+"";var r=n[0],i=n[1];return i<0?"0."+new Array(-i).join("0")+r:r.length>i+1?r.slice(0,i+1)+"."+r.slice(i+1):r+new Array(i-r.length+2).join("0")}const _X={"%":function(e,t){return(e*100).toFixed(t)},b:function(e){return Math.round(e).toString(2)},c:function(e){return e+""},d:function(e){return Math.round(e).toString(10)},e:function(e,t){return e.toExponential(t)},f:function(e,t){return e.toFixed(t)},g:function(e,t){return e.toPrecision(t)},o:function(e){return Math.round(e).toString(8)},p:function(e,t){return EX(e*100,t)},r:EX,s:Fut,X:function(e){return Math.round(e).toString(16).toUpperCase()},x:function(e){return Math.round(e).toString(16)}};function AX(e){return e}var TX=["y","z","a","f","p","n","","m","","k","M","G","T","P","E","Z","Y"];function lde(e){var t=e.grouping&&e.thousands?Tut(e.grouping,e.thousands):AX,n=e.currency,r=e.decimal,i=e.numerals?Iut(e.numerals):AX,s=e.percent||"%";function o(u){u=Fp(u);var l=u.fill,c=u.align,f=u.sign,h=u.symbol,d=u.zero,p=u.width,g=u.comma,m=u.precision,y=u.trim,b=u.type;b==="n"?(g=!0,b="g"):_X[b]||(m==null&&(m=12),y=!0,b="g"),(d||l==="0"&&c==="=")&&(d=!0,l="0",c="=");var v=h==="$"?n[0]:h==="#"&&/[boxX]/.test(b)?"0"+b.toLowerCase():"",x=h==="$"?n[1]:/[%p]/.test(b)?s:"",w=_X[b],C=/[defgprs%]/.test(b);m=m==null?6:/[gprs]/.test(b)?Math.max(1,Math.min(21,m)):Math.max(0,Math.min(20,m));function $(S){var k=v,E=x,_,D,A;if(b==="c")E=w(S)+E,S="";else{S=+S;var T=S<0;if(S=w(Math.abs(S),m),y&&(S=Nut(S)),T&&+S==0&&(T=!1),k=(T?f==="("?f:"-":f==="-"||f==="("?"":f)+k,E=(b==="s"?TX[8+ude/3]:"")+E+(T&&f==="("?")":""),C){for(_=-1,D=S.length;++_<D;)if(A=S.charCodeAt(_),48>A||A>57){E=(A===46?r+S.slice(_+1):S.slice(_))+E,S=S.slice(0,_);break}}}g&&!d&&(S=t(S,1/0));var I=k.length+S.length+E.length,F=I<p?new Array(p-I+1).join(l):"";switch(g&&d&&(S=t(F+S,F.length?p-E.length:1/0),F=""),c){case"<":S=k+S+E+F;break;case"=":S=k+F+S+E;break;case"^":S=F.slice(0,I=F.length>>1)+k+S+E+F.slice(I);break;default:S=F+k+S+E;break}return i(S)}return $.toString=function(){return u+""},$}function a(u,l){var c=o((u=Fp(u),u.type="f",u)),f=Math.max(-8,Math.min(8,Math.floor(b0(l)/3)))*3,h=Math.pow(10,-f),d=TX[8+f/3];return function(p){return c(h*p)+d}}return{format:o,formatPrefix:a}}var sS,my,WD;cde({decimal:".",thousands:",",grouping:[3],currency:["$",""]});function cde(e){return sS=lde(e),my=sS.format,WD=sS.formatPrefix,sS}function t7(e){return Math.max(0,-b0(Math.abs(e)))}function n7(e,t){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(b0(t)/3)))*3-b0(Math.abs(e)))}function r7(e,t){return e=Math.abs(e),t=Math.abs(t)-e,Math.max(0,b0(t)-b0(e))+1}const Out=Object.freeze(Object.defineProperty({__proto__:null,get format(){return my},formatDefaultLocale:cde,formatLocale:lde,get formatPrefix(){return WD},formatSpecifier:Fp,precisionFixed:t7,precisionPrefix:n7,precisionRound:r7},Symbol.toStringTag,{value:"Module"}));function fde(e,t,n,r){var i=Zf(e,t,n),s;switch(r=Fp(r??",f"),r.type){case"s":{var o=Math.max(Math.abs(e),Math.abs(t));return r.precision==null&&!isNaN(s=n7(i,o))&&(r.precision=s),WD(r,o)}case"":case"e":case"g":case"p":case"r":{r.precision==null&&!isNaN(s=r7(i,Math.max(Math.abs(e),Math.abs(t))))&&(r.precision=s-(r.type==="e"));break}case"f":case"%":{r.precision==null&&!isNaN(s=t7(i))&&(r.precision=s-(r.type==="%")*2);break}}return my(r)}function Eg(e){var t=e.domain;return e.ticks=function(n){var r=t();return BM(r[0],r[r.length-1],n??10)},e.tickFormat=function(n,r){var i=t();return fde(i[0],i[i.length-1],n??10,r)},e.nice=function(n){n==null&&(n=10);var r=t(),i=0,s=r.length-1,o=r[i],a=r[s],u,l,c=10;for(a<o&&(l=o,o=a,a=l,l=i,i=s,s=l);c-- >0;){if(l=Gue(o,a,n),l===u)return r[i]=o,r[s]=a,t(r);if(l>0)o=Math.floor(o/l)*l,a=Math.ceil(a/l)*l;else if(l<0)o=Math.ceil(o*l)/l,a=Math.floor(a*l)/l;else break;u=l}return e},e}function hde(){var e=ade();return e.copy=function(){return w$(e,hde())},tl.apply(e,arguments),Eg(e)}function dde(e){var t;function n(r){return r==null||isNaN(r=+r)?t:r}return n.invert=n,n.domain=n.range=function(r){return arguments.length?(e=Array.from(r,$4),n):e.slice()},n.unknown=function(r){return arguments.length?(t=r,n):t},n.copy=function(){return dde(e).unknown(t)},e=arguments.length?Array.from(e,$4):[0,1],Eg(n)}function pde(e,t){e=e.slice();var n=0,r=e.length-1,i=e[n],s=e[r],o;return s<i&&(o=n,n=r,r=o,o=i,i=s,s=o),e[n]=t.floor(i),e[r]=t.ceil(s),e}function IX(e){return Math.log(e)}function DX(e){return Math.exp(e)}function Rut(e){return-Math.log(-e)}function Mut(e){return-Math.exp(-e)}function Lut(e){return isFinite(e)?+("1e"+e):e<0?0:e}function Put(e){return e===10?Lut:e===Math.E?Math.exp:function(t){return Math.pow(e,t)}}function But(e){return e===Math.E?Math.log:e===10&&Math.log10||e===2&&Math.log2||(e=Math.log(e),function(t){return Math.log(t)/e})}function NX(e){return function(t){return-e(-t)}}function i7(e){var t=e(IX,DX),n=t.domain,r=10,i,s;function o(){return i=But(r),s=Put(r),n()[0]<0?(i=NX(i),s=NX(s),e(Rut,Mut)):e(IX,DX),t}return t.base=function(a){return arguments.length?(r=+a,o()):r},t.domain=function(a){return arguments.length?(n(a),o()):n()},t.ticks=function(a){var u=n(),l=u[0],c=u[u.length-1],f;(f=c<l)&&(h=l,l=c,c=h);var h=i(l),d=i(c),p,g,m,y=a==null?10:+a,b=[];if(!(r%1)&&d-h<y){if(h=Math.floor(h),d=Math.ceil(d),l>0){for(;h<=d;++h)for(g=1,p=s(h);g<r;++g)if(m=p*g,!(m<l)){if(m>c)break;b.push(m)}}else for(;h<=d;++h)for(g=r-1,p=s(h);g>=1;--g)if(m=p*g,!(m<l)){if(m>c)break;b.push(m)}b.length*2<y&&(b=BM(l,c,y))}else b=BM(h,d,Math.min(d-h,y)).map(s);return f?b.reverse():b},t.tickFormat=function(a,u){if(u==null&&(u=r===10?".0e":","),typeof u!="function"&&(u=my(u)),a===1/0)return u;a==null&&(a=10);var l=Math.max(1,r*a/t.ticks().length);return function(c){var f=c/s(Math.round(i(c)));return f*r<r-.5&&(f*=r),f<=l?u(c):""}},t.nice=function(){return n(pde(n(),{floor:function(a){return s(Math.floor(i(a)))},ceil:function(a){return s(Math.ceil(i(a)))}}))},t}function gde(){var e=i7(jD()).domain([1,10]);return e.copy=function(){return w$(e,gde()).base(e.base())},tl.apply(e,arguments),e}function FX(e){return function(t){return Math.sign(t)*Math.log1p(Math.abs(t/e))}}function OX(e){return function(t){return Math.sign(t)*Math.expm1(Math.abs(t))*e}}function s7(e){var t=1,n=e(FX(t),OX(t));return n.constant=function(r){return arguments.length?e(FX(t=+r),OX(t)):t},Eg(n)}function mde(){var e=s7(jD());return e.copy=function(){return w$(e,mde()).constant(e.constant())},tl.apply(e,arguments)}function RX(e){return function(t){return t<0?-Math.pow(-t,e):Math.pow(t,e)}}function zut(e){return e<0?-Math.sqrt(-e):Math.sqrt(e)}function Uut(e){return e<0?-e*e:e*e}function o7(e){var t=e(Cs,Cs),n=1;function r(){return n===1?e(Cs,Cs):n===.5?e(zut,Uut):e(RX(n),RX(1/n))}return t.exponent=function(i){return arguments.length?(n=+i,r()):n},Eg(t)}function a7(){var e=o7(jD());return e.copy=function(){return w$(e,a7()).exponent(e.exponent())},tl.apply(e,arguments),e}function jut(){return a7.apply(null,arguments).exponent(.5)}function yde(){var e=[],t=[],n=[],r;function i(){var o=0,a=Math.max(1,t.length);for(n=new Array(a-1);++o<a;)n[o-1]=que(e,o/a);return s}function s(o){return o==null||isNaN(o=+o)?r:t[r$(n,o)]}return s.invertExtent=function(o){var a=t.indexOf(o);return a<0?[NaN,NaN]:[a>0?n[a-1]:e[0],a<n.length?n[a]:e[e.length-1]]},s.domain=function(o){if(!arguments.length)return e.slice();e=[];for(let a of o)a!=null&&!isNaN(a=+a)&&e.push(a);return e.sort(oy),i()},s.range=function(o){return arguments.length?(t=Array.from(o),i()):t.slice()},s.unknown=function(o){return arguments.length?(r=o,s):r},s.quantiles=function(){return n.slice()},s.copy=function(){return yde().domain(e).range(t).unknown(r)},tl.apply(s,arguments)}function bde(){var e=0,t=1,n=1,r=[.5],i=[0,1],s;function o(u){return u!=null&&u<=u?i[r$(r,u,0,n)]:s}function a(){var u=-1;for(r=new Array(n);++u<n;)r[u]=((u+1)*t-(u-n)*e)/(n+1);return o}return o.domain=function(u){return arguments.length?([e,t]=u,e=+e,t=+t,a()):[e,t]},o.range=function(u){return arguments.length?(n=(i=Array.from(u)).length-1,a()):i.slice()},o.invertExtent=function(u){var l=i.indexOf(u);return l<0?[NaN,NaN]:l<1?[e,r[0]]:l>=n?[r[n-1],t]:[r[l-1],r[l]]},o.unknown=function(u){return arguments.length&&(s=u),o},o.thresholds=function(){return r.slice()},o.copy=function(){return bde().domain([e,t]).range(i).unknown(s)},tl.apply(Eg(o),arguments)}function xde(){var e=[.5],t=[0,1],n,r=1;function i(s){return s!=null&&s<=s?t[r$(e,s,0,r)]:n}return i.domain=function(s){return arguments.length?(e=Array.from(s),r=Math.min(e.length,t.length-1),i):e.slice()},i.range=function(s){return arguments.length?(t=Array.from(s),r=Math.min(e.length,t.length-1),i):t.slice()},i.invertExtent=function(s){var o=t.indexOf(s);return[e[o-1],e[o]]},i.unknown=function(s){return arguments.length?(n=s,i):n},i.copy=function(){return xde().domain(e).range(t).unknown(n)},tl.apply(i,arguments)}function uO(e){if(0<=e.y&&e.y<100){var t=new Date(-1,e.m,e.d,e.H,e.M,e.S,e.L);return t.setFullYear(e.y),t}return new Date(e.y,e.m,e.d,e.H,e.M,e.S,e.L)}function lO(e){if(0<=e.y&&e.y<100){var t=new Date(Date.UTC(-1,e.m,e.d,e.H,e.M,e.S,e.L));return t.setUTCFullYear(e.y),t}return new Date(Date.UTC(e.y,e.m,e.d,e.H,e.M,e.S,e.L))}function ab(e,t,n){return{y:e,m:t,d:n,H:0,M:0,S:0,L:0}}function vde(e){var t=e.dateTime,n=e.date,r=e.time,i=e.periods,s=e.days,o=e.shortDays,a=e.months,u=e.shortMonths,l=ub(i),c=lb(i),f=ub(s),h=lb(s),d=ub(o),p=lb(o),g=ub(a),m=lb(a),y=ub(u),b=lb(u),v={a:R,A:L,b:P,B:q,c:null,d:UX,e:UX,f:flt,g:wlt,G:Clt,H:ult,I:llt,j:clt,L:wde,m:hlt,M:dlt,p:X,q:G,Q:VX,s:GX,S:plt,u:glt,U:mlt,V:ylt,w:blt,W:xlt,x:null,X:null,y:vlt,Y:$lt,Z:Slt,"%":WX},x={a:J,A:Q,b:ee,B:ue,c:null,d:jX,e:jX,f:Alt,g:Plt,G:zlt,H:klt,I:Elt,j:_lt,L:Cde,m:Tlt,M:Ilt,p:ge,q:xe,Q:VX,s:GX,S:Dlt,u:Nlt,U:Flt,V:Olt,w:Rlt,W:Mlt,x:null,X:null,y:Llt,Y:Blt,Z:Ult,"%":WX},w={a:E,A:_,b:D,B:A,c:T,d:BX,e:BX,f:ilt,g:PX,G:LX,H:zX,I:zX,j:elt,L:rlt,m:Qut,M:tlt,p:k,q:Jut,Q:olt,s:alt,S:nlt,u:qut,U:Xut,V:Yut,w:Hut,W:Kut,x:I,X:F,y:PX,Y:LX,Z:Zut,"%":slt};v.x=C(n,v),v.X=C(r,v),v.c=C(t,v),x.x=C(n,x),x.X=C(r,x),x.c=C(t,x);function C(B,H){return function(Y){var M=[],he=-1,ae=0,me=B.length,de,Oe,Ye;for(Y instanceof Date||(Y=new Date(+Y));++he<me;)B.charCodeAt(he)===37&&(M.push(B.slice(ae,he)),(Oe=MX[de=B.charAt(++he)])!=null?de=B.charAt(++he):Oe=de==="e"?" ":"0",(Ye=H[de])&&(de=Ye(Y,Oe)),M.push(de),ae=he+1);return M.push(B.slice(ae,he)),M.join("")}}function $(B,H){return function(Y){var M=ab(1900,void 0,1),he=S(M,B,Y+="",0),ae,me;if(he!=Y.length)return null;if("Q"in M)return new Date(M.Q);if("s"in M)return new Date(M.s*1e3+("L"in M?M.L:0));if(H&&!("Z"in M)&&(M.Z=0),"p"in M&&(M.H=M.H%12+M.p*12),M.m===void 0&&(M.m="q"in M?M.q:0),"V"in M){if(M.V<1||M.V>53)return null;"w"in M||(M.w=1),"Z"in M?(ae=lO(ab(M.y,0,1)),me=ae.getUTCDay(),ae=me>4||me===0?xE.ceil(ae):xE(ae),ae=_f.offset(ae,(M.V-1)*7),M.y=ae.getUTCFullYear(),M.m=ae.getUTCMonth(),M.d=ae.getUTCDate()+(M.w+6)%7):(ae=uO(ab(M.y,0,1)),me=ae.getDay(),ae=me>4||me===0?yE.ceil(ae):yE(ae),ae=Ef.offset(ae,(M.V-1)*7),M.y=ae.getFullYear(),M.m=ae.getMonth(),M.d=ae.getDate()+(M.w+6)%7)}else("W"in M||"U"in M)&&("w"in M||(M.w="u"in M?M.u%7:"W"in M?1:0),me="Z"in M?lO(ab(M.y,0,1)).getUTCDay():uO(ab(M.y,0,1)).getDay(),M.m=0,M.d="W"in M?(M.w+6)%7+M.W*7-(me+5)%7:M.w+M.U*7-(me+6)%7);return"Z"in M?(M.H+=M.Z/100|0,M.M+=M.Z%100,lO(M)):uO(M)}}function S(B,H,Y,M){for(var he=0,ae=H.length,me=Y.length,de,Oe;he<ae;){if(M>=me)return-1;if(de=H.charCodeAt(he++),de===37){if(de=H.charAt(he++),Oe=w[de in MX?H.charAt(he++):de],!Oe||(M=Oe(B,Y,M))<0)return-1}else if(de!=Y.charCodeAt(M++))return-1}return M}function k(B,H,Y){var M=l.exec(H.slice(Y));return M?(B.p=c.get(M[0].toLowerCase()),Y+M[0].length):-1}function E(B,H,Y){var M=d.exec(H.slice(Y));return M?(B.w=p.get(M[0].toLowerCase()),Y+M[0].length):-1}function _(B,H,Y){var M=f.exec(H.slice(Y));return M?(B.w=h.get(M[0].toLowerCase()),Y+M[0].length):-1}function D(B,H,Y){var M=y.exec(H.slice(Y));return M?(B.m=b.get(M[0].toLowerCase()),Y+M[0].length):-1}function A(B,H,Y){var M=g.exec(H.slice(Y));return M?(B.m=m.get(M[0].toLowerCase()),Y+M[0].length):-1}function T(B,H,Y){return S(B,t,H,Y)}function I(B,H,Y){return S(B,n,H,Y)}function F(B,H,Y){return S(B,r,H,Y)}function R(B){return o[B.getDay()]}function L(B){return s[B.getDay()]}function P(B){return u[B.getMonth()]}function q(B){return a[B.getMonth()]}function X(B){return i[+(B.getHours()>=12)]}function G(B){return 1+~~(B.getMonth()/3)}function J(B){return o[B.getUTCDay()]}function Q(B){return s[B.getUTCDay()]}function ee(B){return u[B.getUTCMonth()]}function ue(B){return a[B.getUTCMonth()]}function ge(B){return i[+(B.getUTCHours()>=12)]}function xe(B){return 1+~~(B.getUTCMonth()/3)}return{format:function(B){var H=C(B+="",v);return H.toString=function(){return B},H},parse:function(B){var H=$(B+="",!1);return H.toString=function(){return B},H},utcFormat:function(B){var H=C(B+="",x);return H.toString=function(){return B},H},utcParse:function(B){var H=$(B+="",!0);return H.toString=function(){return B},H}}}var MX={"-":"",_:" ",0:"0"},Ur=/^\s*\d+/,Wut=/^%/,Vut=/[\\^$*+?|[\]().{}]/g;function Nt(e,t,n){var r=e<0?"-":"",i=(r?-e:e)+"",s=i.length;return r+(s<n?new Array(n-s+1).join(t)+i:i)}function Gut(e){return e.replace(Vut,"\\$&")}function ub(e){return new RegExp("^(?:"+e.map(Gut).join("|")+")","i")}function lb(e){return new Map(e.map((t,n)=>[t.toLowerCase(),n]))}function Hut(e,t,n){var r=Ur.exec(t.slice(n,n+1));return r?(e.w=+r[0],n+r[0].length):-1}function qut(e,t,n){var r=Ur.exec(t.slice(n,n+1));return r?(e.u=+r[0],n+r[0].length):-1}function Xut(e,t,n){var r=Ur.exec(t.slice(n,n+2));return r?(e.U=+r[0],n+r[0].length):-1}function Yut(e,t,n){var r=Ur.exec(t.slice(n,n+2));return r?(e.V=+r[0],n+r[0].length):-1}function Kut(e,t,n){var r=Ur.exec(t.slice(n,n+2));return r?(e.W=+r[0],n+r[0].length):-1}function LX(e,t,n){var r=Ur.exec(t.slice(n,n+4));return r?(e.y=+r[0],n+r[0].length):-1}function PX(e,t,n){var r=Ur.exec(t.slice(n,n+2));return r?(e.y=+r[0]+(+r[0]>68?1900:2e3),n+r[0].length):-1}function Zut(e,t,n){var r=/^(Z)|([+-]\d\d)(?::?(\d\d))?/.exec(t.slice(n,n+6));return r?(e.Z=r[1]?0:-(r[2]+(r[3]||"00")),n+r[0].length):-1}function Jut(e,t,n){var r=Ur.exec(t.slice(n,n+1));return r?(e.q=r[0]*3-3,n+r[0].length):-1}function Qut(e,t,n){var r=Ur.exec(t.slice(n,n+2));return r?(e.m=r[0]-1,n+r[0].length):-1}function BX(e,t,n){var r=Ur.exec(t.slice(n,n+2));return r?(e.d=+r[0],n+r[0].length):-1}function elt(e,t,n){var r=Ur.exec(t.slice(n,n+3));return r?(e.m=0,e.d=+r[0],n+r[0].length):-1}function zX(e,t,n){var r=Ur.exec(t.slice(n,n+2));return r?(e.H=+r[0],n+r[0].length):-1}function tlt(e,t,n){var r=Ur.exec(t.slice(n,n+2));return r?(e.M=+r[0],n+r[0].length):-1}function nlt(e,t,n){var r=Ur.exec(t.slice(n,n+2));return r?(e.S=+r[0],n+r[0].length):-1}function rlt(e,t,n){var r=Ur.exec(t.slice(n,n+3));return r?(e.L=+r[0],n+r[0].length):-1}function ilt(e,t,n){var r=Ur.exec(t.slice(n,n+6));return r?(e.L=Math.floor(r[0]/1e3),n+r[0].length):-1}function slt(e,t,n){var r=Wut.exec(t.slice(n,n+1));return r?n+r[0].length:-1}function olt(e,t,n){var r=Ur.exec(t.slice(n));return r?(e.Q=+r[0],n+r[0].length):-1}function alt(e,t,n){var r=Ur.exec(t.slice(n));return r?(e.s=+r[0],n+r[0].length):-1}function UX(e,t){return Nt(e.getDate(),t,2)}function ult(e,t){return Nt(e.getHours(),t,2)}function llt(e,t){return Nt(e.getHours()%12||12,t,2)}function clt(e,t){return Nt(1+Ef.count(Jf(e),e),t,3)}function wde(e,t){return Nt(e.getMilliseconds(),t,3)}function flt(e,t){return wde(e,t)+"000"}function hlt(e,t){return Nt(e.getMonth()+1,t,2)}function dlt(e,t){return Nt(e.getMinutes(),t,2)}function plt(e,t){return Nt(e.getSeconds(),t,2)}function glt(e){var t=e.getDay();return t===0?7:t}function mlt(e,t){return Nt(uy.count(Jf(e)-1,e),t,2)}function $de(e){var t=e.getDay();return t>=4||t===0?o0(e):o0.ceil(e)}function ylt(e,t){return e=$de(e),Nt(o0.count(Jf(e),e)+(Jf(e).getDay()===4),t,2)}function blt(e){return e.getDay()}function xlt(e,t){return Nt(yE.count(Jf(e)-1,e),t,2)}function vlt(e,t){return Nt(e.getFullYear()%100,t,2)}function wlt(e,t){return e=$de(e),Nt(e.getFullYear()%100,t,2)}function $lt(e,t){return Nt(e.getFullYear()%1e4,t,4)}function Clt(e,t){var n=e.getDay();return e=n>=4||n===0?o0(e):o0.ceil(e),Nt(e.getFullYear()%1e4,t,4)}function Slt(e){var t=e.getTimezoneOffset();return(t>0?"-":(t*=-1,"+"))+Nt(t/60|0,"0",2)+Nt(t%60,"0",2)}function jX(e,t){return Nt(e.getUTCDate(),t,2)}function klt(e,t){return Nt(e.getUTCHours(),t,2)}function Elt(e,t){return Nt(e.getUTCHours()%12||12,t,2)}function _lt(e,t){return Nt(1+_f.count(Qf(e),e),t,3)}function Cde(e,t){return Nt(e.getUTCMilliseconds(),t,3)}function Alt(e,t){return Cde(e,t)+"000"}function Tlt(e,t){return Nt(e.getUTCMonth()+1,t,2)}function Ilt(e,t){return Nt(e.getUTCMinutes(),t,2)}function Dlt(e,t){return Nt(e.getUTCSeconds(),t,2)}function Nlt(e){var t=e.getUTCDay();return t===0?7:t}function Flt(e,t){return Nt(ly.count(Qf(e)-1,e),t,2)}function Sde(e){var t=e.getUTCDay();return t>=4||t===0?a0(e):a0.ceil(e)}function Olt(e,t){return e=Sde(e),Nt(a0.count(Qf(e),e)+(Qf(e).getUTCDay()===4),t,2)}function Rlt(e){return e.getUTCDay()}function Mlt(e,t){return Nt(xE.count(Qf(e)-1,e),t,2)}function Llt(e,t){return Nt(e.getUTCFullYear()%100,t,2)}function Plt(e,t){return e=Sde(e),Nt(e.getUTCFullYear()%100,t,2)}function Blt(e,t){return Nt(e.getUTCFullYear()%1e4,t,4)}function zlt(e,t){var n=e.getUTCDay();return e=n>=4||n===0?a0(e):a0.ceil(e),Nt(e.getUTCFullYear()%1e4,t,4)}function Ult(){return"+0000"}function WX(){return"%"}function VX(e){return+e}function GX(e){return Math.floor(+e/1e3)}var im,VD,kde,GD,Ede;jlt({dateTime:"%x, %X",date:"%-m/%-d/%Y",time:"%-I:%M:%S %p",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]});function jlt(e){return im=vde(e),VD=im.format,kde=im.parse,GD=im.utcFormat,Ede=im.utcParse,im}function Wlt(e){return new Date(e)}function Vlt(e){return e instanceof Date?+e:+new Date(+e)}function u7(e,t,n,r,i,s,o,a,u,l){var c=ade(),f=c.invert,h=c.domain,d=l(".%L"),p=l(":%S"),g=l("%I:%M"),m=l("%I %p"),y=l("%a %d"),b=l("%b %d"),v=l("%B"),x=l("%Y");function w(C){return(u(C)<C?d:a(C)<C?p:o(C)<C?g:s(C)<C?m:r(C)<C?i(C)<C?y:b:n(C)<C?v:x)(C)}return c.invert=function(C){return new Date(f(C))},c.domain=function(C){return arguments.length?h(Array.from(C,Vlt)):h().map(Wlt)},c.ticks=function(C){var $=h();return e($[0],$[$.length-1],C??10)},c.tickFormat=function(C,$){return $==null?w:l($)},c.nice=function(C){var $=h();return(!C||typeof C.range!="function")&&(C=t($[0],$[$.length-1],C??10)),C?h(pde($,C)):c},c.copy=function(){return w$(c,u7(e,t,n,r,i,s,o,a,u,l))},c}function Glt(){return tl.apply(u7(aQe,uQe,Jf,bE,uy,Ef,uz,az,of,VD).domain([new Date(2e3,0,1),new Date(2e3,0,2)]),arguments)}function Hlt(){return tl.apply(u7(sQe,oQe,Qf,vE,ly,_f,fz,cz,of,GD).domain([Date.UTC(2e3,0,1),Date.UTC(2e3,0,2)]),arguments)}function HD(){var e=0,t=1,n,r,i,s,o=Cs,a=!1,u;function l(f){return f==null||isNaN(f=+f)?u:o(i===0?.5:(f=(s(f)-n)*i,a?Math.max(0,Math.min(1,f)):f))}l.domain=function(f){return arguments.length?([e,t]=f,n=s(e=+e),r=s(t=+t),i=n===r?0:1/(r-n),l):[e,t]},l.clamp=function(f){return arguments.length?(a=!!f,l):a},l.interpolator=function(f){return arguments.length?(o=f,l):o};function c(f){return function(h){var d,p;return arguments.length?([d,p]=h,o=f(d,p),l):[o(0),o(1)]}}return l.range=c(Ph),l.rangeRound=c(v$),l.unknown=function(f){return arguments.length?(u=f,l):u},function(f){return s=f,n=f(e),r=f(t),i=n===r?0:1/(r-n),l}}function Bh(e,t){return t.domain(e.domain()).interpolator(e.interpolator()).clamp(e.clamp()).unknown(e.unknown())}function l7(){var e=Eg(HD()(Cs));return e.copy=function(){return Bh(e,l7())},Lh.apply(e,arguments)}function _de(){var e=i7(HD()).domain([1,10]);return e.copy=function(){return Bh(e,_de()).base(e.base())},Lh.apply(e,arguments)}function Ade(){var e=s7(HD());return e.copy=function(){return Bh(e,Ade()).constant(e.constant())},Lh.apply(e,arguments)}function c7(){var e=o7(HD());return e.copy=function(){return Bh(e,c7()).exponent(e.exponent())},Lh.apply(e,arguments)}function qlt(){return c7.apply(null,arguments).exponent(.5)}function qD(){var e=0,t=.5,n=1,r=1,i,s,o,a,u,l=Cs,c,f=!1,h;function d(g){return isNaN(g=+g)?h:(g=.5+((g=+c(g))-s)*(r*g<r*s?a:u),l(f?Math.max(0,Math.min(1,g)):g))}d.domain=function(g){return arguments.length?([e,t,n]=g,i=c(e=+e),s=c(t=+t),o=c(n=+n),a=i===s?0:.5/(s-i),u=s===o?0:.5/(o-s),r=s<i?-1:1,d):[e,t,n]},d.clamp=function(g){return arguments.length?(f=!!g,d):f},d.interpolator=function(g){return arguments.length?(l=g,d):l};function p(g){return function(m){var y,b,v;return arguments.length?([y,b,v]=m,l=Q8(g,[y,b,v]),d):[l(0),l(.5),l(1)]}}return d.range=p(Ph),d.rangeRound=p(v$),d.unknown=function(g){return arguments.length?(h=g,d):h},function(g){return c=g,i=g(e),s=g(t),o=g(n),a=i===s?0:.5/(s-i),u=s===o?0:.5/(o-s),r=s<i?-1:1,d}}function Tde(){var e=Eg(qD()(Cs));return e.copy=function(){return Bh(e,Tde())},Lh.apply(e,arguments)}function Ide(){var e=i7(qD()).domain([.1,1,10]);return e.copy=function(){return Bh(e,Ide()).base(e.base())},Lh.apply(e,arguments)}function Dde(){var e=s7(qD());return e.copy=function(){return Bh(e,Dde()).constant(e.constant())},Lh.apply(e,arguments)}function f7(){var e=o7(qD());return e.copy=function(){return Bh(e,f7()).exponent(e.exponent())},Lh.apply(e,arguments)}function Xlt(){return f7.apply(null,arguments).exponent(.5)}function h7(e,t,n){const r=e-t+n*2;return e?r>0?r:1:0}const Ylt="identity",x0="linear",dc="log",$$="pow",C$="sqrt",XD="symlog",Op="time",Rp="utc",Tu="sequential",yy="diverging",v0="quantile",YD="quantize",KD="threshold",d7="ordinal",S4="point",Nde="band",p7="bin-ordinal",yr="continuous",S$="discrete",k$="discretizing",Zo="interpolating",g7="temporal";function Klt(e){return function(t){let n=t[0],r=t[1],i;return r<n&&(i=n,n=r,r=i),[e.invert(n),e.invert(r)]}}function Zlt(e){return function(t){const n=e.range();let r=t[0],i=t[1],s=-1,o,a,u,l;for(i<r&&(a=r,r=i,i=a),u=0,l=n.length;u<l;++u)n[u]>=r&&n[u]<=i&&(s<0&&(s=u),o=u);if(!(s<0))return r=e.invertExtent(n[s]),i=e.invertExtent(n[o]),[r[0]===void 0?r[1]:r[0],i[1]===void 0?i[0]:i[1]]}}function m7(){const e=Z8().unknown(void 0),t=e.domain,n=e.range;let r=[0,1],i,s,o=!1,a=0,u=0,l=.5;delete e.unknown;function c(){const f=t().length,h=r[1]<r[0],d=r[1-h],p=h7(f,a,u);let g=r[h-0];i=(d-g)/(p||1),o&&(i=Math.floor(i)),g+=(d-g-i*(f-a))*l,s=i*(1-a),o&&(g=Math.round(g),s=Math.round(s));const m=Js(f).map(y=>g+i*y);return n(h?m.reverse():m)}return e.domain=function(f){return arguments.length?(t(f),c()):t()},e.range=function(f){return arguments.length?(r=[+f[0],+f[1]],c()):r.slice()},e.rangeRound=function(f){return r=[+f[0],+f[1]],o=!0,c()},e.bandwidth=function(){return s},e.step=function(){return i},e.round=function(f){return arguments.length?(o=!!f,c()):o},e.padding=function(f){return arguments.length?(u=Math.max(0,Math.min(1,f)),a=u,c()):a},e.paddingInner=function(f){return arguments.length?(a=Math.max(0,Math.min(1,f)),c()):a},e.paddingOuter=function(f){return arguments.length?(u=Math.max(0,Math.min(1,f)),c()):u},e.align=function(f){return arguments.length?(l=Math.max(0,Math.min(1,f)),c()):l},e.invertRange=function(f){if(f[0]==null||f[1]==null)return;const h=r[1]<r[0],d=h?n().reverse():n(),p=d.length-1;let g=+f[0],m=+f[1],y,b,v;if(!(g!==g||m!==m)&&(m<g&&(v=g,g=m,m=v),!(m<d[0]||g>r[1-h])))return y=Math.max(0,gE(d,g)-1),b=g===m?y:gE(d,m)-1,g-d[y]>s+1e-10&&++y,h&&(v=y,y=p-b,b=p-v),y>b?void 0:t().slice(y,b+1)},e.invert=function(f){const h=e.invertRange([f,f]);return h&&h[0]},e.copy=function(){return m7().domain(t()).range(r).round(o).paddingInner(a).paddingOuter(u).align(l)},c()}function Fde(e){const t=e.copy;return e.padding=e.paddingOuter,delete e.paddingInner,e.copy=function(){return Fde(t())},e}function Jlt(){return Fde(m7().paddingInner(1))}var Qlt=Array.prototype.map;function ect(e){return Qlt.call(e,Hf)}const tct=Array.prototype.slice;function Ode(){let e=[],t=[];function n(r){return r==null||r!==r?void 0:t[(r$(e,r)-1)%t.length]}return n.domain=function(r){return arguments.length?(e=ect(r),n):e.slice()},n.range=function(r){return arguments.length?(t=tct.call(r),n):t.slice()},n.tickFormat=function(r,i){return fde(e[0],Kt(e),r??10,i)},n.copy=function(){return Ode().domain(n.domain()).range(n.range())},n}const VE={};function nct(e,t,n){const r=function(){const s=t();return s.invertRange||(s.invertRange=s.invert?Klt(s):s.invertExtent?Zlt(s):void 0),s.type=e,s};return r.metadata=cc(et(n)),r}function Rt(e,t,n){return arguments.length>1?(VE[e]=nct(e,t,n),this):Rde(e)?VE[e]:void 0}Rt(Ylt,dde);Rt(x0,hde,yr);Rt(dc,gde,[yr,dc]);Rt($$,a7,yr);Rt(C$,jut,yr);Rt(XD,mde,yr);Rt(Op,Glt,[yr,g7]);Rt(Rp,Hlt,[yr,g7]);Rt(Tu,l7,[yr,Zo]);Rt("".concat(Tu,"-").concat(x0),l7,[yr,Zo]);Rt("".concat(Tu,"-").concat(dc),_de,[yr,Zo,dc]);Rt("".concat(Tu,"-").concat($$),c7,[yr,Zo]);Rt("".concat(Tu,"-").concat(C$),qlt,[yr,Zo]);Rt("".concat(Tu,"-").concat(XD),Ade,[yr,Zo]);Rt("".concat(yy,"-").concat(x0),Tde,[yr,Zo]);Rt("".concat(yy,"-").concat(dc),Ide,[yr,Zo,dc]);Rt("".concat(yy,"-").concat($$),f7,[yr,Zo]);Rt("".concat(yy,"-").concat(C$),Xlt,[yr,Zo]);Rt("".concat(yy,"-").concat(XD),Dde,[yr,Zo]);Rt(v0,yde,[k$,v0]);Rt(YD,bde,k$);Rt(KD,xde,k$);Rt(p7,Ode,[S$,k$]);Rt(d7,Z8,S$);Rt(Nde,m7,S$);Rt(S4,Jlt,S$);function Rde(e){return nt(VE,e)}function _g(e,t){const n=VE[e];return n&&n.metadata[t]}function y7(e){return _g(e,yr)}function w0(e){return _g(e,S$)}function k4(e){return _g(e,k$)}function Mde(e){return _g(e,dc)}function rct(e){return _g(e,g7)}function Lde(e){return _g(e,Zo)}function Pde(e){return _g(e,v0)}const ict=["clamp","base","constant","exponent"];function Bde(e,t){const n=t[0],r=Kt(t)-n;return function(i){return e(n+i*r)}}function ZD(e,t,n){return Q8(b7(t||"rgb",n),e)}function zde(e,t){const n=new Array(t),r=t+1;for(let i=0;i<t;)n[i]=e(++i/r);return n}function Ude(e,t,n){const r=n-t;let i,s,o;return!r||!Number.isFinite(r)?Bo(.5):(i=(s=e.type).indexOf("-"),s=i<0?s:s.slice(i+1),o=Rt(s)().domain([t,n]).range([0,1]),ict.forEach(a=>e[a]?o[a](e[a]()):0),o)}function b7(e,t){const n=Sut[sct(e)];return t!=null&&n&&n.gamma?n.gamma(t):n}function sct(e){return"interpolate"+e.toLowerCase().split("-").map(t=>t[0].toUpperCase()+t.slice(1)).join("")}const oct={blues:"cfe1f2bed8eca8cee58fc1de74b2d75ba3cf4592c63181bd206fb2125ca40a4a90",greens:"d3eecdc0e6baabdda594d3917bc77d60ba6c46ab5e329a512089430e7735036429",greys:"e2e2e2d4d4d4c4c4c4b1b1b19d9d9d8888887575756262624d4d4d3535351e1e1e",oranges:"fdd8b3fdc998fdb87bfda55efc9244f87f2cf06b18e4580bd14904b93d029f3303",purples:"e2e1efd4d4e8c4c5e0b4b3d6a3a0cc928ec3827cb97566ae684ea25c3696501f8c",reds:"fdc9b4fcb49afc9e80fc8767fa7051f6573fec3f2fdc2a25c81b1db21218970b13",blueGreen:"d5efedc1e8e0a7ddd18bd2be70c6a958ba9144ad77319c5d2089460e7736036429",bluePurple:"ccddecbad0e4a8c2dd9ab0d4919cc98d85be8b6db28a55a6873c99822287730f71",greenBlue:"d3eecec5e8c3b1e1bb9bd8bb82cec269c2ca51b2cd3c9fc7288abd1675b10b60a1",orangeRed:"fddcaffdcf9bfdc18afdad77fb9562f67d53ee6545e24932d32d1ebf130da70403",purpleBlue:"dbdaebc8cee4b1c3de97b7d87bacd15b9fc93a90c01e7fb70b70ab056199045281",purpleBlueGreen:"dbd8eac8cee4b0c3de93b7d872acd1549fc83892bb1c88a3097f8702736b016353",purpleRed:"dcc9e2d3b3d7ce9eccd186c0da6bb2e14da0e23189d91e6fc61159ab07498f023a",redPurple:"fccfccfcbec0faa9b8f98faff571a5ec539ddb3695c41b8aa908808d0179700174",yellowGreen:"e4f4acd1eca0b9e2949ed68880c97c62bb6e47aa5e3297502083440e723b036034",yellowOrangeBrown:"feeaa1fedd84fecc63feb746fca031f68921eb7215db5e0bc54c05ab3d038f3204",yellowOrangeRed:"fee087fed16ffebd59fea849fd903efc7335f9522bee3423de1b20ca0b22af0225",blueOrange:"134b852f78b35da2cb9dcae1d2e5eff2f0ebfce0bafbbf74e8932fc5690d994a07",brownBlueGreen:"704108a0651ac79548e3c78af3e6c6eef1eac9e9e48ed1c74da79e187a72025147",purpleGreen:"5b1667834792a67fb6c9aed3e6d6e8eff0efd9efd5aedda971bb75368e490e5e29",purpleOrange:"4114696647968f83b7b9b4d6dadbebf3eeeafce0bafbbf74e8932fc5690d994a07",redBlue:"8c0d25bf363adf745ef4ae91fbdbc9f2efeed2e5ef9dcae15da2cb2f78b3134b85",redGrey:"8c0d25bf363adf745ef4ae91fcdccbfaf4f1e2e2e2c0c0c0969696646464343434",yellowGreenBlue:"eff9bddbf1b4bde5b594d5b969c5be45b4c22c9ec02182b82163aa23479c1c3185",redYellowBlue:"a50026d4322cf16e43fcac64fedd90faf8c1dcf1ecabd6e875abd04a74b4313695",redYellowGreen:"a50026d4322cf16e43fcac63fedd8df9f7aed7ee8ea4d86e64bc6122964f006837",pinkYellowGreen:"8e0152c0267edd72adf0b3d6faddedf5f3efe1f2cab6de8780bb474f9125276419",spectral:"9e0142d13c4bf0704afcac63fedd8dfbf8b0e0f3a1a9dda269bda94288b55e4fa2",viridis:"440154470e61481a6c482575472f7d443a834144873d4e8a39568c35608d31688e2d708e2a788e27818e23888e21918d1f988b1fa08822a8842ab07f35b77943bf7154c56866cc5d7ad1518fd744a5db36bcdf27d2e21be9e51afde725",magma:"0000040404130b0924150e3720114b2c11603b0f704a107957157e651a80721f817f24828c29819a2e80a8327db6377ac43c75d1426fde4968e95462f1605df76f5cfa7f5efc8f65fe9f6dfeaf78febf84fece91fddea0fcedaffcfdbf",inferno:"0000040403130c0826170c3b240c4f330a5f420a68500d6c5d126e6b176e781c6d86216b932667a12b62ae305cbb3755c73e4cd24644dd513ae65c30ed6925f3771af8850ffb9506fca50afcb519fac62df6d645f2e661f3f484fcffa4",plasma:"0d088723069033059742039d5002a25d01a66a00a87801a88405a7900da49c179ea72198b12a90ba3488c33d80cb4779d35171da5a69e16462e76e5bed7953f2834cf68f44fa9a3dfca636fdb32ffec029fcce25f9dc24f5ea27f0f921",cividis:"00205100235800265d002961012b65042e670831690d346b11366c16396d1c3c6e213f6e26426e2c456e31476e374a6e3c4d6e42506e47536d4c566d51586e555b6e5a5e6e5e616e62646f66676f6a6a706e6d717270717573727976737c79747f7c75827f758682768985778c8877908b78938e789691789a94789e9778a19b78a59e77a9a177aea575b2a874b6ab73bbaf71c0b26fc5b66dc9b96acebd68d3c065d8c462ddc85fe2cb5ce7cf58ebd355f0d652f3da4ff7de4cfae249fce647",rainbow:"6e40aa883eb1a43db3bf3cafd83fa4ee4395fe4b83ff576eff6659ff7847ff8c38f3a130e2b72fcfcc36bee044aff05b8ff4576ff65b52f6673af27828ea8d1ddfa319d0b81cbecb23abd82f96e03d82e14c6edb5a5dd0664dbf6e40aa",sinebow:"ff4040fc582af47218e78d0bd5a703bfbf00a7d5038de70b72f41858fc2a40ff402afc5818f4720be78d03d5a700bfbf03a7d50b8de71872f42a58fc4040ff582afc7218f48d0be7a703d5bf00bfd503a7e70b8df41872fc2a58ff4040",turbo:"23171b32204a3e2a71453493493eae4b49c54a53d7485ee44569ee4074f53c7ff8378af93295f72e9ff42ba9ef28b3e926bce125c5d925cdcf27d5c629dcbc2de3b232e9a738ee9d3ff39347f68950f9805afc7765fd6e70fe667cfd5e88fc5795fb51a1f84badf545b9f140c5ec3cd0e637dae034e4d931ecd12ef4c92bfac029ffb626ffad24ffa223ff9821ff8d1fff821dff771cfd6c1af76118f05616e84b14df4111d5380fcb2f0dc0260ab61f07ac1805a313029b0f00950c00910b00",browns:"eedbbdecca96e9b97ae4a865dc9856d18954c7784cc0673fb85536ad44339f3632",tealBlues:"bce4d89dd3d181c3cb65b3c245a2b9368fae347da0306a932c5985",teals:"bbdfdfa2d4d58ac9c975bcbb61b0af4da5a43799982b8b8c1e7f7f127273006667",warmGreys:"dcd4d0cec5c1c0b8b4b3aaa7a59c9998908c8b827f7e7673726866665c5a59504e",goldGreen:"f4d166d5ca60b6c35c98bb597cb25760a6564b9c533f8f4f33834a257740146c36",goldOrange:"f4d166f8be5cf8aa4cf5983bf3852aef701be2621fd65322c54923b142239e3a26",goldRed:"f4d166f6be59f9aa51fc964ef6834bee734ae56249db5247cf4244c43141b71d3e",lightGreyRed:"efe9e6e1dad7d5cbc8c8bdb9bbaea9cd967ddc7b43e15f19df4011dc000b",lightGreyTeal:"e4eaead6dcddc8ced2b7c2c7a6b4bc64b0bf22a6c32295c11f85be1876bc",lightMulti:"e0f1f2c4e9d0b0de9fd0e181f6e072f6c053f3993ef77440ef4a3c",lightOrange:"f2e7daf7d5baf9c499fab184fa9c73f68967ef7860e8645bde515bd43d5b",lightTealBlue:"e3e9e0c0dccf9aceca7abfc859afc0389fb9328dad2f7ca0276b95255988",darkBlue:"3232322d46681a5c930074af008cbf05a7ce25c0dd38daed50f3faffffff",darkGold:"3c3c3c584b37725e348c7631ae8b2bcfa424ecc31ef9de30fff184ffffff",darkGreen:"3a3a3a215748006f4d048942489e4276b340a6c63dd2d836ffeb2cffffaa",darkMulti:"3737371f5287197d8c29a86995ce3fffe800ffffff",darkRed:"3434347036339e3c38cc4037e75d1eec8620eeab29f0ce32ffeb2c"},act={category10:"1f77b4ff7f0e2ca02cd627289467bd8c564be377c27f7f7fbcbd2217becf",category20:"1f77b4aec7e8ff7f0effbb782ca02c98df8ad62728ff98969467bdc5b0d58c564bc49c94e377c2f7b6d27f7f7fc7c7c7bcbd22dbdb8d17becf9edae5",category20b:"393b795254a36b6ecf9c9ede6379398ca252b5cf6bcedb9c8c6d31bd9e39e7ba52e7cb94843c39ad494ad6616be7969c7b4173a55194ce6dbdde9ed6",category20c:"3182bd6baed69ecae1c6dbefe6550dfd8d3cfdae6bfdd0a231a35474c476a1d99bc7e9c0756bb19e9ac8bcbddcdadaeb636363969696bdbdbdd9d9d9",tableau10:"4c78a8f58518e4575672b7b254a24beeca3bb279a2ff9da69d755dbab0ac",tableau20:"4c78a89ecae9f58518ffbf7954a24b88d27ab79a20f2cf5b43989483bcb6e45756ff9d9879706ebab0acd67195fcbfd2b279a2d6a5c99e765fd8b5a5",accent:"7fc97fbeaed4fdc086ffff99386cb0f0027fbf5b17666666",dark2:"1b9e77d95f027570b3e7298a66a61ee6ab02a6761d666666",paired:"a6cee31f78b4b2df8a33a02cfb9a99e31a1cfdbf6fff7f00cab2d66a3d9affff99b15928",pastel1:"fbb4aeb3cde3ccebc5decbe4fed9a6ffffcce5d8bdfddaecf2f2f2",pastel2:"b3e2cdfdcdaccbd5e8f4cae4e6f5c9fff2aef1e2cccccccc",set1:"e41a1c377eb84daf4a984ea3ff7f00ffff33a65628f781bf999999",set2:"66c2a5fc8d628da0cbe78ac3a6d854ffd92fe5c494b3b3b3",set3:"8dd3c7ffffb3bebadafb807280b1d3fdb462b3de69fccde5d9d9d9bc80bdccebc5ffed6f"};function jde(e){const t=e.length/6|0,n=new Array(t);for(let r=0;r<t;)n[r]="#"+e.slice(r*6,++r*6);return n}function Wde(e,t){for(const n in e)x7(n,t(e[n]))}const HX={};Wde(act,jde);Wde(oct,e=>ZD(jde(e)));function x7(e,t){return e=e&&e.toLowerCase(),arguments.length>1?(HX[e]=t,this):HX[e]}const tk="symbol",uct="discrete",lct="gradient",cct=e=>it(e)?e.map(t=>String(t)):String(e),fct=(e,t)=>e[1]-t[1],hct=(e,t)=>t[1]-e[1];function v7(e,t,n){let r;return kp(t)&&(e.bins&&(t=Math.max(t,e.bins.length)),n!=null&&(t=Math.min(t,Math.floor(XI(e.domain())/n||1)))),dt(t)&&(r=t.step,t=t.interval),mn(t)&&(t=e.type===Op?cy(t):e.type==Rp?fy(t):le("Only time and utc scales accept interval strings."),r&&(t=t.every(r))),t}function Vde(e,t,n){let r=e.range(),i=r[0],s=Kt(r),o=fct;if(i>s&&(r=s,s=i,i=r,o=hct),i=Math.floor(i),s=Math.ceil(s),t=t.map(a=>[a,e(a)]).filter(a=>i<=a[1]&&a[1]<=s).sort(o).map(a=>a[0]),n>0&&t.length>1){const a=[t[0],Kt(t)];for(;t.length>n&&t.length>=3;)t=t.filter((u,l)=>!(l%2));t.length<3&&(t=a)}return t}function w7(e,t){return e.bins?Vde(e,e.bins):e.ticks?e.ticks(t):e.domain()}function Gde(e,t,n,r,i,s){const o=t.type;let a=cct;if(o===Op||i===Op)a=e.timeFormat(r);else if(o===Rp||i===Rp)a=e.utcFormat(r);else if(Mde(o)){const u=e.formatFloat(r);if(s||t.bins)a=u;else{const l=Hde(t,n,!1);a=c=>l(c)?u(c):""}}else if(t.tickFormat){const u=t.domain();a=e.formatSpan(u[0],u[u.length-1],n,r)}else r&&(a=e.format(r));return a}function Hde(e,t,n){const r=w7(e,t),i=e.base(),s=Math.log(i),o=Math.max(1,i*t/r.length),a=u=>{let l=u/Math.pow(i,Math.round(Math.log(u)/s));return l*i<i-.5&&(l*=i),l<=o};return n?r.filter(a):a}const E4={[v0]:"quantiles",[YD]:"thresholds",[KD]:"domain"},qde={[v0]:"quantiles",[YD]:"domain"};function Xde(e,t){return e.bins?gct(e.bins):e.type===dc?Hde(e,t,!0):E4[e.type]?pct(e[E4[e.type]]()):w7(e,t)}function dct(e,t,n){const r=t[qde[t.type]](),i=r.length;let s=i>1?r[1]-r[0]:r[0],o;for(o=1;o<i;++o)s=Math.min(s,r[o]-r[o-1]);return e.formatSpan(0,s,3*10,n)}function pct(e){const t=[-1/0].concat(e);return t.max=1/0,t}function gct(e){const t=e.slice(0,-1);return t.max=Kt(e),t}const mct=e=>E4[e.type]||e.bins;function Yde(e,t,n,r,i,s,o){const a=qde[t.type]&&s!==Op&&s!==Rp?dct(e,t,i):Gde(e,t,n,i,s,o);return r===tk&&mct(t)?yct(a):r===uct?bct(a):xct(a)}const yct=e=>(t,n,r)=>{const i=qX(r[n+1],qX(r.max,1/0)),s=XX(t,e),o=XX(i,e);return s&&o?s+"  "+o:o?"< "+o:" "+s},qX=(e,t)=>e??t,bct=e=>(t,n)=>n?e(t):null,xct=e=>t=>e(t),XX=(e,t)=>Number.isFinite(e)?t(e):null;function vct(e){const t=e.domain(),n=t.length-1;let r=+t[0],i=+Kt(t),s=i-r;if(e.type===KD){const o=n?s/n:.1;r-=o,i+=o,s=i-r}return o=>(o-r)/s}function wct(e,t,n,r){const i=r||t.type;return mn(n)&&rct(i)&&(n=n.replace(/%a/g,"%A").replace(/%b/g,"%B")),!n&&i===Op?e.timeFormat("%A, %d %B %Y, %X"):!n&&i===Rp?e.utcFormat("%A, %d %B %Y, %X UTC"):Yde(e,t,5,null,n,r,!0)}function Kde(e,t,n){n=n||{};const r=Math.max(3,n.maxlen||7),i=wct(e,t,n.format,n.formatType);if(k4(t.type)){const s=Xde(t).slice(1).map(i),o=s.length;return"".concat(o," boundar").concat(o===1?"y":"ies",": ").concat(s.join(", "))}else if(w0(t.type)){const s=t.domain(),o=s.length,a=o>r?s.slice(0,r-2).map(i).join(", ")+", ending with "+s.slice(-1).map(i):s.map(i).join(", ");return"".concat(o," value").concat(o===1?"":"s",": ").concat(a)}else{const s=t.domain();return"values from ".concat(i(s[0])," to ").concat(i(Kt(s)))}}function Zde(e){re.call(this,null,e)}$e(Zde,re,{transform(e,t){if(this.value&&!e.modified())return t.StopPropagation;var n=t.dataflow.locale(),r=t.fork(t.NO_SOURCE|t.NO_FIELDS),i=this.value,s=e.scale,o=e.count==null?e.values?e.values.length:10:e.count,a=v7(s,o,e.minstep),u=e.format||Gde(n,s,a,e.formatSpecifier,e.formatType,!!e.values),l=e.values?Vde(s,e.values,a):w7(s,a);return i&&(r.rem=i),i=l.map((c,f)=>Ot({index:f/(l.length-1||1),value:c,label:u(c)})),e.extra&&i.length&&i.push(Ot({index:-1,extra:{value:i[0].value},label:""})),r.source=i,r.add=i,this.value=i,r}});function Jde(e){re.call(this,null,e)}function $ct(){return Ot({})}function Cct(e){const t=ry().test(n=>n.exit);return t.lookup=n=>t.get(e(n)),t}$e(Jde,re,{transform(e,t){var n=t.dataflow,r=t.fork(t.NO_SOURCE|t.NO_FIELDS),i=e.item||$ct,s=e.key||Pe,o=this.value;return it(r.encode)&&(r.encode=null),o&&(e.modified("key")||t.modified(s))&&le("DataJoin does not support modified key function or fields."),o||(t=t.addAll(),this.value=o=Cct(s)),t.visit(t.ADD,a=>{const u=s(a);let l=o.get(u);l?l.exit?(o.empty--,r.add.push(l)):r.mod.push(l):(l=i(a),o.set(u,l),r.add.push(l)),l.datum=a,l.exit=!1}),t.visit(t.MOD,a=>{const u=s(a),l=o.get(u);l&&(l.datum=a,r.mod.push(l))}),t.visit(t.REM,a=>{const u=s(a),l=o.get(u);a===l.datum&&!l.exit&&(r.rem.push(l),l.exit=!0,++o.empty)}),t.changed(t.ADD_MOD)&&r.modifies("datum"),(t.clean()||e.clean&&o.empty>n.cleanThreshold)&&n.runAfter(o.clean),r}});function Qde(e){re.call(this,null,e)}$e(Qde,re,{transform(e,t){var n=t.fork(t.ADD_REM),r=e.mod||!1,i=e.encoders,s=t.encode;if(it(s))if(n.changed()||s.every(f=>i[f]))s=s[0],n.encode=null;else return t.StopPropagation;var o=s==="enter",a=i.update||Wc,u=i.enter||Wc,l=i.exit||Wc,c=(s&&!o?i[s]:a)||Wc;if(t.changed(t.ADD)&&(t.visit(t.ADD,f=>{u(f,e),a(f,e)}),n.modifies(u.output),n.modifies(a.output),c!==Wc&&c!==a&&(t.visit(t.ADD,f=>{c(f,e)}),n.modifies(c.output))),t.changed(t.REM)&&l!==Wc&&(t.visit(t.REM,f=>{l(f,e)}),n.modifies(l.output)),o||c!==Wc){const f=t.MOD|(e.modified()?t.REFLOW:0);o?(t.visit(f,h=>{const d=u(h,e)||r;(c(h,e)||d)&&n.mod.push(h)}),n.mod.length&&n.modifies(u.output)):t.visit(f,h=>{(c(h,e)||r)&&n.mod.push(h)}),n.mod.length&&n.modifies(c.output)}return n.changed()?n:t.StopPropagation}});function epe(e){re.call(this,[],e)}$e(epe,re,{transform(e,t){if(this.value!=null&&!e.modified())return t.StopPropagation;var n=t.dataflow.locale(),r=t.fork(t.NO_SOURCE|t.NO_FIELDS),i=this.value,s=e.type||tk,o=e.scale,a=+e.limit,u=v7(o,e.count==null?5:e.count,e.minstep),l=!!e.values||s===tk,c=e.format||Yde(n,o,u,s,e.formatSpecifier,e.formatType,l),f=e.values||Xde(o,u),h,d,p,g,m;return i&&(r.rem=i),s===tk?(a&&f.length>a?(t.dataflow.warn("Symbol legend count exceeds limit, filtering items."),i=f.slice(0,a-1),m=!0):i=f,zt(p=e.size)?(!e.values&&o(i[0])===0&&(i=i.slice(1)),g=i.reduce((y,b)=>Math.max(y,p(b,e)),0)):p=Bo(g=p||8),i=i.map((y,b)=>Ot({index:b,label:c(y,b,i),value:y,offset:g,size:p(y,e)})),m&&(m=f[i.length],i.push(Ot({index:i.length,label:"".concat(f.length-i.length," entries"),value:m,offset:g,size:p(m,e)})))):s===lct?(h=o.domain(),d=Ude(o,h[0],Kt(h)),f.length<3&&!e.values&&h[0]!==Kt(h)&&(f=[h[0],Kt(h)]),i=f.map((y,b)=>Ot({index:b,label:c(y,b,f),value:y,perc:d(y)}))):(p=f.length-1,d=vct(o),i=f.map((y,b)=>Ot({index:b,label:c(y,b,f),value:y,perc:b?d(y):0,perc2:b===p?1:d(f[b+1])}))),r.source=i,r.add=i,this.value=i,r}});const Sct=e=>e.source.x,kct=e=>e.source.y,Ect=e=>e.target.x,_ct=e=>e.target.y;function $7(e){re.call(this,{},e)}$7.Definition={type:"LinkPath",metadata:{modifies:!0},params:[{name:"sourceX",type:"field",default:"source.x"},{name:"sourceY",type:"field",default:"source.y"},{name:"targetX",type:"field",default:"target.x"},{name:"targetY",type:"field",default:"target.y"},{name:"orient",type:"enum",default:"vertical",values:["horizontal","vertical","radial"]},{name:"shape",type:"enum",default:"line",values:["line","arc","curve","diagonal","orthogonal"]},{name:"require",type:"signal"},{name:"as",type:"string",default:"path"}]};$e($7,re,{transform(e,t){var n=e.sourceX||Sct,r=e.sourceY||kct,i=e.targetX||Ect,s=e.targetY||_ct,o=e.as||"path",a=e.orient||"vertical",u=e.shape||"line",l=YX.get(u+"-"+a)||YX.get(u);return l||le("LinkPath unsupported type: "+e.shape+(e.orient?"-"+e.orient:"")),t.visit(t.SOURCE,c=>{c[o]=l(n(c),r(c),i(c),s(c))}),t.reflow(e.modified()).modifies(o)}});const tpe=(e,t,n,r)=>"M"+e+","+t+"L"+n+","+r,Act=(e,t,n,r)=>tpe(t*Math.cos(e),t*Math.sin(e),r*Math.cos(n),r*Math.sin(n)),npe=(e,t,n,r)=>{var i=n-e,s=r-t,o=Math.sqrt(i*i+s*s)/2,a=180*Math.atan2(s,i)/Math.PI;return"M"+e+","+t+"A"+o+","+o+" "+a+" 0 1 "+n+","+r},Tct=(e,t,n,r)=>npe(t*Math.cos(e),t*Math.sin(e),r*Math.cos(n),r*Math.sin(n)),rpe=(e,t,n,r)=>{const i=n-e,s=r-t,o=.2*(i+s),a=.2*(s-i);return"M"+e+","+t+"C"+(e+o)+","+(t+a)+" "+(n+a)+","+(r-o)+" "+n+","+r},Ict=(e,t,n,r)=>rpe(t*Math.cos(e),t*Math.sin(e),r*Math.cos(n),r*Math.sin(n)),Dct=(e,t,n,r)=>"M"+e+","+t+"V"+r+"H"+n,Nct=(e,t,n,r)=>"M"+e+","+t+"H"+n+"V"+r,Fct=(e,t,n,r)=>{const i=Math.cos(e),s=Math.sin(e),o=Math.cos(n),a=Math.sin(n),u=Math.abs(n-e)>Math.PI?n<=e:n>e;return"M"+t*i+","+t*s+"A"+t+","+t+" 0 0,"+(u?1:0)+" "+t*o+","+t*a+"L"+r*o+","+r*a},Oct=(e,t,n,r)=>{const i=(e+n)/2;return"M"+e+","+t+"C"+i+","+t+" "+i+","+r+" "+n+","+r},Rct=(e,t,n,r)=>{const i=(t+r)/2;return"M"+e+","+t+"C"+e+","+i+" "+n+","+i+" "+n+","+r},Mct=(e,t,n,r)=>{const i=Math.cos(e),s=Math.sin(e),o=Math.cos(n),a=Math.sin(n),u=(t+r)/2;return"M"+t*i+","+t*s+"C"+u*i+","+u*s+" "+u*o+","+u*a+" "+r*o+","+r*a},YX=ry({line:tpe,"line-radial":Act,arc:npe,"arc-radial":Tct,curve:rpe,"curve-radial":Ict,"orthogonal-horizontal":Dct,"orthogonal-vertical":Nct,"orthogonal-radial":Fct,"diagonal-horizontal":Oct,"diagonal-vertical":Rct,"diagonal-radial":Mct});function C7(e){re.call(this,null,e)}C7.Definition={type:"Pie",metadata:{modifies:!0},params:[{name:"field",type:"field"},{name:"startAngle",type:"number",default:0},{name:"endAngle",type:"number",default:6.283185307179586},{name:"sort",type:"boolean",default:!1},{name:"as",type:"string",array:!0,length:2,default:["startAngle","endAngle"]}]};$e(C7,re,{transform(e,t){var n=e.as||["startAngle","endAngle"],r=n[0],i=n[1],s=e.field||ty,o=e.startAngle||0,a=e.endAngle!=null?e.endAngle:2*Math.PI,u=t.source,l=u.map(s),c=l.length,f=o,h=(a-o)/Kue(l),d=Js(c),p,g,m;for(e.sort&&d.sort((y,b)=>l[y]-l[b]),p=0;p<c;++p)m=l[d[p]],g=u[d[p]],g[r]=f,g[i]=f+=m*h;return this.value=l,t.reflow(e.modified()).modifies(n)}});const Lct=5;function Pct(e){const t=e.type;return!e.bins&&(t===x0||t===$$||t===C$)}function ipe(e){return y7(e)&&e!==Tu}const Bct=cc(["set","modified","clear","type","scheme","schemeExtent","schemeCount","domain","domainMin","domainMid","domainMax","domainRaw","domainImplicit","nice","zero","bins","range","rangeStep","round","reverse","interpolate","interpolateGamma"]);function spe(e){re.call(this,null,e),this.modified(!0)}$e(spe,re,{transform(e,t){var n=t.dataflow,r=this.value,i=zct(e);(!r||i!==r.type)&&(this.value=r=Rt(i)());for(i in e)if(!Bct[i]){if(i==="padding"&&ipe(r.type))continue;zt(r[i])?r[i](e[i]):n.warn("Unsupported scale property: "+i)}return Hct(r,e,Gct(r,e,jct(r,e,n))),t.fork(t.NO_SOURCE|t.NO_FIELDS)}});function zct(e){var t=e.type,n="",r;return t===Tu?Tu+"-"+x0:(Uct(e)&&(r=e.rawDomain?e.rawDomain.length:e.domain?e.domain.length+ +(e.domainMid!=null):0,n=r===2?Tu+"-":r===3?yy+"-":""),(n+t||x0).toLowerCase())}function Uct(e){const t=e.type;return y7(t)&&t!==Op&&t!==Rp&&(e.scheme||e.range&&e.range.length&&e.range.every(mn))}function jct(e,t,n){const r=Wct(e,t.domainRaw,n);if(r>-1)return r;var i=t.domain,s=e.type,o=t.zero||t.zero===void 0&&Pct(e),a,u;if(!i)return 0;if(ipe(s)&&t.padding&&i[0]!==Kt(i)&&(i=Vct(s,i,t.range,t.padding,t.exponent,t.constant)),(o||t.domainMin!=null||t.domainMax!=null||t.domainMid!=null)&&(a=(i=i.slice()).length-1||1,o&&(i[0]>0&&(i[0]=0),i[a]<0&&(i[a]=0)),t.domainMin!=null&&(i[0]=t.domainMin),t.domainMax!=null&&(i[a]=t.domainMax),t.domainMid!=null)){u=t.domainMid;const l=u>i[a]?a+1:u<i[0]?0:a;l!==a&&n.warn("Scale domainMid exceeds domain min or max.",u),i.splice(l,0,u)}return e.domain(ope(s,i,n)),s===d7&&e.unknown(t.domainImplicit?b4:void 0),t.nice&&e.nice&&e.nice(t.nice!==!0&&v7(e,t.nice)||null),i.length}function Wct(e,t,n){return t?(e.domain(ope(e.type,t,n)),t.length):-1}function Vct(e,t,n,r,i,s){var o=Math.abs(Kt(n)-n[0]),a=o/(o-2*r),u=e===dc?jae(t,null,a):e===C$?_M(t,null,a,.5):e===$$?_M(t,null,a,i||1):e===XD?Wae(t,null,a,s||1):Uae(t,null,a);return t=t.slice(),t[0]=u[0],t[t.length-1]=u[1],t}function ope(e,t,n){if(Mde(e)){var r=Math.abs(t.reduce((i,s)=>i+(s<0?-1:s>0?1:0),0));r!==t.length&&n.warn("Log scale domain includes zero: "+He(t))}return t}function Gct(e,t,n){let r=t.bins;if(r&&!it(r)){const i=e.domain(),s=i[0],o=Kt(i),a=r.step;let u=r.start==null?s:r.start,l=r.stop==null?o:r.stop;a||le("Scale bins parameter missing step property."),u<s&&(u=a*Math.ceil(s/a)),l>o&&(l=a*Math.floor(o/a)),r=Js(u,l+a/2,a)}return r?e.bins=r:e.bins&&delete e.bins,e.type===p7&&(r?!t.domain&&!t.domainRaw&&(e.domain(r),n=r.length):e.bins=e.domain()),n}function Hct(e,t,n){var r=e.type,i=t.round||!1,s=t.range;if(t.rangeStep!=null)s=qct(r,t,n);else if(t.scheme&&(s=Xct(r,t,n),zt(s))){if(e.interpolator)return e.interpolator(s);le("Scale type ".concat(r," does not support interpolating color schemes."))}if(s&&Lde(r))return e.interpolator(ZD(_4(s,t.reverse),t.interpolate,t.interpolateGamma));s&&t.interpolate&&e.interpolate?e.interpolate(b7(t.interpolate,t.interpolateGamma)):zt(e.round)?e.round(i):zt(e.rangeRound)&&e.interpolate(i?v$:Ph),s&&e.range(_4(s,t.reverse))}function qct(e,t,n){e!==Nde&&e!==S4&&le("Only band and point scales support rangeStep.");var r=(t.paddingOuter!=null?t.paddingOuter:t.padding)||0,i=e===S4?1:(t.paddingInner!=null?t.paddingInner:t.padding)||0;return[0,t.rangeStep*h7(n,i,r)]}function Xct(e,t,n){var r=t.schemeExtent,i,s;return it(t.scheme)?s=ZD(t.scheme,t.interpolate,t.interpolateGamma):(i=t.scheme.toLowerCase(),s=x7(i),s||le("Unrecognized scheme name: ".concat(t.scheme))),n=e===KD?n+1:e===p7?n-1:e===v0||e===YD?+t.schemeCount||Lct:n,Lde(e)?KX(s,r,t.reverse):zt(s)?zde(KX(s,r),n):e===d7?s:s.slice(0,n)}function KX(e,t,n){return zt(e)&&(t||n)?Bde(e,_4(t||[0,1],n)):e}function _4(e,t){return t?e.slice().reverse():e}function ape(e){re.call(this,null,e)}$e(ape,re,{transform(e,t){const n=e.modified("sort")||t.changed(t.ADD)||t.modified(e.sort.fields)||t.modified("datum");return n&&t.source.sort(bg(e.sort)),this.modified(n),t}});const ZX="zero",upe="center",lpe="normalize",cpe=["y0","y1"];function S7(e){re.call(this,null,e)}S7.Definition={type:"Stack",metadata:{modifies:!0},params:[{name:"field",type:"field"},{name:"groupby",type:"field",array:!0},{name:"sort",type:"compare"},{name:"offset",type:"enum",default:ZX,values:[ZX,upe,lpe]},{name:"as",type:"string",array:!0,length:2,default:cpe}]};$e(S7,re,{transform(e,t){var n=e.as||cpe,r=n[0],i=n[1],s=bg(e.sort),o=e.field||ty,a=e.offset===upe?Yct:e.offset===lpe?Kct:Zct,u,l,c,f;for(u=Jct(t.source,e.groupby,s,o),l=0,c=u.length,f=u.max;l<c;++l)a(u[l],f,o,r,i);return t.reflow(e.modified()).modifies(n)}});function Yct(e,t,n,r,i){for(var s=(t-e.sum)/2,o=e.length,a=0,u;a<o;++a)u=e[a],u[r]=s,u[i]=s+=Math.abs(n(u))}function Kct(e,t,n,r,i){for(var s=1/e.sum,o=0,a=e.length,u=0,l=0,c;u<a;++u)c=e[u],c[r]=o,c[i]=o=s*(l+=Math.abs(n(c)))}function Zct(e,t,n,r,i){for(var s=0,o=0,a=e.length,u=0,l,c;u<a;++u)c=e[u],l=+n(c),l<0?(c[r]=o,c[i]=o+=l):(c[r]=s,c[i]=s+=l)}function Jct(e,t,n,r){var i=[],s=g=>g(c),o,a,u,l,c,f,h,d,p;if(t==null)i.push(e.slice());else for(o={},a=0,u=e.length;a<u;++a)c=e[a],f=t.map(s),h=o[f],h||(o[f]=h=[],i.push(h)),h.push(c);for(f=0,p=0,l=i.length;f<l;++f){for(h=i[f],a=0,d=0,u=h.length;a<u;++a)d+=Math.abs(r(h[a]));h.sum=d,d>p&&(p=d),n&&h.sort(n)}return i.max=p,i}const Qct=Object.freeze(Object.defineProperty({__proto__:null,axisticks:Zde,datajoin:Jde,encode:Qde,legendentries:epe,linkpath:$7,pie:C7,scale:spe,sortitems:ape,stack:S7},Symbol.toStringTag,{value:"Module"}));var Ue=1e-6,GE=1e-12,lt=Math.PI,Dn=lt/2,HE=lt/4,Ki=lt*2,Pn=180/lt,ct=lt/180,St=Math.abs,by=Math.atan,Uo=Math.atan2,We=Math.cos,oS=Math.ceil,fpe=Math.exp,A4=Math.hypot,qE=Math.log,cO=Math.pow,ze=Math.sin,To=Math.sign||function(e){return e>0?1:e<0?-1:0},Zi=Math.sqrt,k7=Math.tan;function hpe(e){return e>1?0:e<-1?lt:Math.acos(e)}function Fs(e){return e>1?Dn:e<-1?-Dn:Math.asin(e)}function Vr(){}function XE(e,t){e&&QX.hasOwnProperty(e.type)&&QX[e.type](e,t)}var JX={Feature:function(e,t){XE(e.geometry,t)},FeatureCollection:function(e,t){for(var n=e.features,r=-1,i=n.length;++r<i;)XE(n[r].geometry,t)}},QX={Sphere:function(e,t){t.sphere()},Point:function(e,t){e=e.coordinates,t.point(e[0],e[1],e[2])},MultiPoint:function(e,t){for(var n=e.coordinates,r=-1,i=n.length;++r<i;)e=n[r],t.point(e[0],e[1],e[2])},LineString:function(e,t){T4(e.coordinates,t,0)},MultiLineString:function(e,t){for(var n=e.coordinates,r=-1,i=n.length;++r<i;)T4(n[r],t,0)},Polygon:function(e,t){eY(e.coordinates,t)},MultiPolygon:function(e,t){for(var n=e.coordinates,r=-1,i=n.length;++r<i;)eY(n[r],t)},GeometryCollection:function(e,t){for(var n=e.geometries,r=-1,i=n.length;++r<i;)XE(n[r],t)}};function T4(e,t,n){var r=-1,i=e.length-n,s;for(t.lineStart();++r<i;)s=e[r],t.point(s[0],s[1],s[2]);t.lineEnd()}function eY(e,t){var n=-1,r=e.length;for(t.polygonStart();++n<r;)T4(e[n],t,1);t.polygonEnd()}function Pl(e,t){e&&JX.hasOwnProperty(e.type)?JX[e.type](e,t):XE(e,t)}var YE=new Gi,KE=new Gi,dpe,ppe,I4,D4,N4,Vu={point:Vr,lineStart:Vr,lineEnd:Vr,polygonStart:function(){YE=new Gi,Vu.lineStart=eft,Vu.lineEnd=tft},polygonEnd:function(){var e=+YE;KE.add(e<0?Ki+e:e),this.lineStart=this.lineEnd=this.point=Vr},sphere:function(){KE.add(Ki)}};function eft(){Vu.point=nft}function tft(){gpe(dpe,ppe)}function nft(e,t){Vu.point=gpe,dpe=e,ppe=t,e*=ct,t*=ct,I4=e,D4=We(t=t/2+HE),N4=ze(t)}function gpe(e,t){e*=ct,t*=ct,t=t/2+HE;var n=e-I4,r=n>=0?1:-1,i=r*n,s=We(t),o=ze(t),a=N4*o,u=D4*s+a*We(i),l=a*r*ze(i);YE.add(Uo(l,u)),I4=e,D4=s,N4=o}function rft(e){return KE=new Gi,Pl(e,Vu),KE*2}function ZE(e){return[Uo(e[1],e[0]),Fs(e[2])]}function Mp(e){var t=e[0],n=e[1],r=We(n);return[r*We(t),r*ze(t),ze(n)]}function aS(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function $0(e,t){return[e[1]*t[2]-e[2]*t[1],e[2]*t[0]-e[0]*t[2],e[0]*t[1]-e[1]*t[0]]}function fO(e,t){e[0]+=t[0],e[1]+=t[1],e[2]+=t[2]}function uS(e,t){return[e[0]*t,e[1]*t,e[2]*t]}function JE(e){var t=Zi(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);e[0]/=t,e[1]/=t,e[2]/=t}var Sn,gs,An,Gs,vd,mpe,ype,Mm,dx,Yc,pc,Il={point:F4,lineStart:tY,lineEnd:nY,polygonStart:function(){Il.point=xpe,Il.lineStart=ift,Il.lineEnd=sft,dx=new Gi,Vu.polygonStart()},polygonEnd:function(){Vu.polygonEnd(),Il.point=F4,Il.lineStart=tY,Il.lineEnd=nY,YE<0?(Sn=-(An=180),gs=-(Gs=90)):dx>Ue?Gs=90:dx<-Ue&&(gs=-90),pc[0]=Sn,pc[1]=An},sphere:function(){Sn=-(An=180),gs=-(Gs=90)}};function F4(e,t){Yc.push(pc=[Sn=e,An=e]),t<gs&&(gs=t),t>Gs&&(Gs=t)}function bpe(e,t){var n=Mp([e*ct,t*ct]);if(Mm){var r=$0(Mm,n),i=[r[1],-r[0],0],s=$0(i,r);JE(s),s=ZE(s);var o=e-vd,a=o>0?1:-1,u=s[0]*Pn*a,l,c=St(o)>180;c^(a*vd<u&&u<a*e)?(l=s[1]*Pn,l>Gs&&(Gs=l)):(u=(u+360)%360-180,c^(a*vd<u&&u<a*e)?(l=-s[1]*Pn,l<gs&&(gs=l)):(t<gs&&(gs=t),t>Gs&&(Gs=t))),c?e<vd?Vs(Sn,e)>Vs(Sn,An)&&(An=e):Vs(e,An)>Vs(Sn,An)&&(Sn=e):An>=Sn?(e<Sn&&(Sn=e),e>An&&(An=e)):e>vd?Vs(Sn,e)>Vs(Sn,An)&&(An=e):Vs(e,An)>Vs(Sn,An)&&(Sn=e)}else Yc.push(pc=[Sn=e,An=e]);t<gs&&(gs=t),t>Gs&&(Gs=t),Mm=n,vd=e}function tY(){Il.point=bpe}function nY(){pc[0]=Sn,pc[1]=An,Il.point=F4,Mm=null}function xpe(e,t){if(Mm){var n=e-vd;dx.add(St(n)>180?n+(n>0?360:-360):n)}else mpe=e,ype=t;Vu.point(e,t),bpe(e,t)}function ift(){Vu.lineStart()}function sft(){xpe(mpe,ype),Vu.lineEnd(),St(dx)>Ue&&(Sn=-(An=180)),pc[0]=Sn,pc[1]=An,Mm=null}function Vs(e,t){return(t-=e)<0?t+360:t}function oft(e,t){return e[0]-t[0]}function rY(e,t){return e[0]<=e[1]?e[0]<=t&&t<=e[1]:t<e[0]||e[1]<t}function aft(e){var t,n,r,i,s,o,a;if(Gs=An=-(Sn=gs=1/0),Yc=[],Pl(e,Il),n=Yc.length){for(Yc.sort(oft),t=1,r=Yc[0],s=[r];t<n;++t)i=Yc[t],rY(r,i[0])||rY(r,i[1])?(Vs(r[0],i[1])>Vs(r[0],r[1])&&(r[1]=i[1]),Vs(i[0],r[1])>Vs(r[0],r[1])&&(r[0]=i[0])):s.push(r=i);for(o=-1/0,n=s.length-1,t=0,r=s[n];t<=n;r=i,++t)i=s[t],(a=Vs(r[1],i[0]))>o&&(o=a,Sn=i[0],An=r[1])}return Yc=pc=null,Sn===1/0||gs===1/0?[[NaN,NaN],[NaN,NaN]]:[[Sn,gs],[An,Gs]]}var Wb,QE,e_,t_,n_,r_,i_,s_,O4,R4,M4,vpe,wpe,Bi,zi,Ui,va={sphere:Vr,point:E7,lineStart:iY,lineEnd:sY,polygonStart:function(){va.lineStart=cft,va.lineEnd=fft},polygonEnd:function(){va.lineStart=iY,va.lineEnd=sY}};function E7(e,t){e*=ct,t*=ct;var n=We(t);E$(n*We(e),n*ze(e),ze(t))}function E$(e,t,n){++Wb,e_+=(e-e_)/Wb,t_+=(t-t_)/Wb,n_+=(n-n_)/Wb}function iY(){va.point=uft}function uft(e,t){e*=ct,t*=ct;var n=We(t);Bi=n*We(e),zi=n*ze(e),Ui=ze(t),va.point=lft,E$(Bi,zi,Ui)}function lft(e,t){e*=ct,t*=ct;var n=We(t),r=n*We(e),i=n*ze(e),s=ze(t),o=Uo(Zi((o=zi*s-Ui*i)*o+(o=Ui*r-Bi*s)*o+(o=Bi*i-zi*r)*o),Bi*r+zi*i+Ui*s);QE+=o,r_+=o*(Bi+(Bi=r)),i_+=o*(zi+(zi=i)),s_+=o*(Ui+(Ui=s)),E$(Bi,zi,Ui)}function sY(){va.point=E7}function cft(){va.point=hft}function fft(){$pe(vpe,wpe),va.point=E7}function hft(e,t){vpe=e,wpe=t,e*=ct,t*=ct,va.point=$pe;var n=We(t);Bi=n*We(e),zi=n*ze(e),Ui=ze(t),E$(Bi,zi,Ui)}function $pe(e,t){e*=ct,t*=ct;var n=We(t),r=n*We(e),i=n*ze(e),s=ze(t),o=zi*s-Ui*i,a=Ui*r-Bi*s,u=Bi*i-zi*r,l=A4(o,a,u),c=Fs(l),f=l&&-c/l;O4.add(f*o),R4.add(f*a),M4.add(f*u),QE+=c,r_+=c*(Bi+(Bi=r)),i_+=c*(zi+(zi=i)),s_+=c*(Ui+(Ui=s)),E$(Bi,zi,Ui)}function dft(e){Wb=QE=e_=t_=n_=r_=i_=s_=0,O4=new Gi,R4=new Gi,M4=new Gi,Pl(e,va);var t=+O4,n=+R4,r=+M4,i=A4(t,n,r);return i<GE&&(t=r_,n=i_,r=s_,QE<Ue&&(t=e_,n=t_,r=n_),i=A4(t,n,r),i<GE)?[NaN,NaN]:[Uo(n,t)*Pn,Fs(r/i)*Pn]}function L4(e,t){function n(r,i){return r=e(r,i),t(r[0],r[1])}return e.invert&&t.invert&&(n.invert=function(r,i){return r=t.invert(r,i),r&&e.invert(r[0],r[1])}),n}function P4(e,t){return[St(e)>lt?e+Math.round(-e/Ki)*Ki:e,t]}P4.invert=P4;function Cpe(e,t,n){return(e%=Ki)?t||n?L4(aY(e),uY(t,n)):aY(e):t||n?uY(t,n):P4}function oY(e){return function(t,n){return t+=e,[t>lt?t-Ki:t<-lt?t+Ki:t,n]}}function aY(e){var t=oY(e);return t.invert=oY(-e),t}function uY(e,t){var n=We(e),r=ze(e),i=We(t),s=ze(t);function o(a,u){var l=We(u),c=We(a)*l,f=ze(a)*l,h=ze(u),d=h*n+c*r;return[Uo(f*i-d*s,c*n-h*r),Fs(d*i+f*s)]}return o.invert=function(a,u){var l=We(u),c=We(a)*l,f=ze(a)*l,h=ze(u),d=h*i-f*s;return[Uo(f*i+h*s,c*n+d*r),Fs(d*n-c*r)]},o}function pft(e){e=Cpe(e[0]*ct,e[1]*ct,e.length>2?e[2]*ct:0);function t(n){return n=e(n[0]*ct,n[1]*ct),n[0]*=Pn,n[1]*=Pn,n}return t.invert=function(n){return n=e.invert(n[0]*ct,n[1]*ct),n[0]*=Pn,n[1]*=Pn,n},t}function gft(e,t,n,r,i,s){if(n){var o=We(t),a=ze(t),u=r*n;i==null?(i=t+r*Ki,s=t-u/2):(i=lY(o,i),s=lY(o,s),(r>0?i<s:i>s)&&(i+=r*Ki));for(var l,c=i;r>0?c>s:c<s;c-=u)l=ZE([o,-a*We(c),-a*ze(c)]),e.point(l[0],l[1])}}function lY(e,t){t=Mp(t),t[0]-=e,JE(t);var n=hpe(-t[1]);return((-t[2]<0?-n:n)+Ki-Ue)%Ki}function Spe(){var e=[],t;return{point:function(n,r,i){t.push([n,r,i])},lineStart:function(){e.push(t=[])},lineEnd:Vr,rejoin:function(){e.length>1&&e.push(e.pop().concat(e.shift()))},result:function(){var n=e;return e=[],t=null,n}}}function nk(e,t){return St(e[0]-t[0])<Ue&&St(e[1]-t[1])<Ue}function lS(e,t,n,r){this.x=e,this.z=t,this.o=n,this.e=r,this.v=!1,this.n=this.p=null}function kpe(e,t,n,r,i){var s=[],o=[],a,u;if(e.forEach(function(p){if(!((g=p.length-1)<=0)){var g,m=p[0],y=p[g],b;if(nk(m,y)){if(!m[2]&&!y[2]){for(i.lineStart(),a=0;a<g;++a)i.point((m=p[a])[0],m[1]);i.lineEnd();return}y[0]+=2*Ue}s.push(b=new lS(m,p,null,!0)),o.push(b.o=new lS(m,null,b,!1)),s.push(b=new lS(y,p,null,!1)),o.push(b.o=new lS(y,null,b,!0))}}),!!s.length){for(o.sort(t),cY(s),cY(o),a=0,u=o.length;a<u;++a)o[a].e=n=!n;for(var l=s[0],c,f;;){for(var h=l,d=!0;h.v;)if((h=h.n)===l)return;c=h.z,i.lineStart();do{if(h.v=h.o.v=!0,h.e){if(d)for(a=0,u=c.length;a<u;++a)i.point((f=c[a])[0],f[1]);else r(h.x,h.n.x,1,i);h=h.n}else{if(d)for(c=h.p.z,a=c.length-1;a>=0;--a)i.point((f=c[a])[0],f[1]);else r(h.x,h.p.x,-1,i);h=h.p}h=h.o,c=h.z,d=!d}while(!h.v);i.lineEnd()}}}function cY(e){if(t=e.length){for(var t,n=0,r=e[0],i;++n<t;)r.n=i=e[n],i.p=r,r=i;r.n=i=e[0],i.p=r}}function hO(e){return St(e[0])<=lt?e[0]:To(e[0])*((St(e[0])+lt)%Ki-lt)}function mft(e,t){var n=hO(t),r=t[1],i=ze(r),s=[ze(n),-We(n),0],o=0,a=0,u=new Gi;i===1?r=Dn+Ue:i===-1&&(r=-Dn-Ue);for(var l=0,c=e.length;l<c;++l)if(h=(f=e[l]).length)for(var f,h,d=f[h-1],p=hO(d),g=d[1]/2+HE,m=ze(g),y=We(g),b=0;b<h;++b,p=x,m=C,y=$,d=v){var v=f[b],x=hO(v),w=v[1]/2+HE,C=ze(w),$=We(w),S=x-p,k=S>=0?1:-1,E=k*S,_=E>lt,D=m*C;if(u.add(Uo(D*k*ze(E),y*$+D*We(E))),o+=_?S+k*Ki:S,_^p>=n^x>=n){var A=$0(Mp(d),Mp(v));JE(A);var T=$0(s,A);JE(T);var I=(_^S>=0?-1:1)*Fs(T[2]);(r>I||r===I&&(A[0]||A[1]))&&(a+=_^S>=0?1:-1)}}return(o<-Ue||o<Ue&&u<-GE)^a&1}function Epe(e,t,n,r){return function(i){var s=t(i),o=Spe(),a=t(o),u=!1,l,c,f,h={point:d,lineStart:g,lineEnd:m,polygonStart:function(){h.point=y,h.lineStart=b,h.lineEnd=v,c=[],l=[]},polygonEnd:function(){h.point=d,h.lineStart=g,h.lineEnd=m,c=Yue(c);var x=mft(l,r);c.length?(u||(i.polygonStart(),u=!0),kpe(c,bft,x,n,i)):x&&(u||(i.polygonStart(),u=!0),i.lineStart(),n(null,null,1,i),i.lineEnd()),u&&(i.polygonEnd(),u=!1),c=l=null},sphere:function(){i.polygonStart(),i.lineStart(),n(null,null,1,i),i.lineEnd(),i.polygonEnd()}};function d(x,w){e(x,w)&&i.point(x,w)}function p(x,w){s.point(x,w)}function g(){h.point=p,s.lineStart()}function m(){h.point=d,s.lineEnd()}function y(x,w){f.push([x,w]),a.point(x,w)}function b(){a.lineStart(),f=[]}function v(){y(f[0][0],f[0][1]),a.lineEnd();var x=a.clean(),w=o.result(),C,$=w.length,S,k,E;if(f.pop(),l.push(f),f=null,!!$){if(x&1){if(k=w[0],(S=k.length-1)>0){for(u||(i.polygonStart(),u=!0),i.lineStart(),C=0;C<S;++C)i.point((E=k[C])[0],E[1]);i.lineEnd()}return}$>1&&x&2&&w.push(w.pop().concat(w.shift())),c.push(w.filter(yft))}}return h}}function yft(e){return e.length>1}function bft(e,t){return((e=e.x)[0]<0?e[1]-Dn-Ue:Dn-e[1])-((t=t.x)[0]<0?t[1]-Dn-Ue:Dn-t[1])}const fY=Epe(function(){return!0},xft,wft,[-lt,-Dn]);function xft(e){var t=NaN,n=NaN,r=NaN,i;return{lineStart:function(){e.lineStart(),i=1},point:function(s,o){var a=s>0?lt:-lt,u=St(s-t);St(u-lt)<Ue?(e.point(t,n=(n+o)/2>0?Dn:-Dn),e.point(r,n),e.lineEnd(),e.lineStart(),e.point(a,n),e.point(s,n),i=0):r!==a&&u>=lt&&(St(t-r)<Ue&&(t-=r*Ue),St(s-a)<Ue&&(s-=a*Ue),n=vft(t,n,s,o),e.point(r,n),e.lineEnd(),e.lineStart(),e.point(a,n),i=0),e.point(t=s,n=o),r=a},lineEnd:function(){e.lineEnd(),t=n=NaN},clean:function(){return 2-i}}}function vft(e,t,n,r){var i,s,o=ze(e-n);return St(o)>Ue?by((ze(t)*(s=We(r))*ze(n)-ze(r)*(i=We(t))*ze(e))/(i*s*o)):(t+r)/2}function wft(e,t,n,r){var i;if(e==null)i=n*Dn,r.point(-lt,i),r.point(0,i),r.point(lt,i),r.point(lt,0),r.point(lt,-i),r.point(0,-i),r.point(-lt,-i),r.point(-lt,0),r.point(-lt,i);else if(St(e[0]-t[0])>Ue){var s=e[0]<t[0]?lt:-lt;i=n*s/2,r.point(-s,i),r.point(0,i),r.point(s,i)}else r.point(t[0],t[1])}function $ft(e){var t=We(e),n=6*ct,r=t>0,i=St(t)>Ue;function s(c,f,h,d){gft(d,e,n,h,c,f)}function o(c,f){return We(c)*We(f)>t}function a(c){var f,h,d,p,g;return{lineStart:function(){p=d=!1,g=1},point:function(m,y){var b=[m,y],v,x=o(m,y),w=r?x?0:l(m,y):x?l(m+(m<0?lt:-lt),y):0;if(!f&&(p=d=x)&&c.lineStart(),x!==d&&(v=u(f,b),(!v||nk(f,v)||nk(b,v))&&(b[2]=1)),x!==d)g=0,x?(c.lineStart(),v=u(b,f),c.point(v[0],v[1])):(v=u(f,b),c.point(v[0],v[1],2),c.lineEnd()),f=v;else if(i&&f&&r^x){var C;!(w&h)&&(C=u(b,f,!0))&&(g=0,r?(c.lineStart(),c.point(C[0][0],C[0][1]),c.point(C[1][0],C[1][1]),c.lineEnd()):(c.point(C[1][0],C[1][1]),c.lineEnd(),c.lineStart(),c.point(C[0][0],C[0][1],3)))}x&&(!f||!nk(f,b))&&c.point(b[0],b[1]),f=b,d=x,h=w},lineEnd:function(){d&&c.lineEnd(),f=null},clean:function(){return g|(p&&d)<<1}}}function u(c,f,h){var d=Mp(c),p=Mp(f),g=[1,0,0],m=$0(d,p),y=aS(m,m),b=m[0],v=y-b*b;if(!v)return!h&&c;var x=t*y/v,w=-t*b/v,C=$0(g,m),$=uS(g,x),S=uS(m,w);fO($,S);var k=C,E=aS($,k),_=aS(k,k),D=E*E-_*(aS($,$)-1);if(!(D<0)){var A=Zi(D),T=uS(k,(-E-A)/_);if(fO(T,$),T=ZE(T),!h)return T;var I=c[0],F=f[0],R=c[1],L=f[1],P;F<I&&(P=I,I=F,F=P);var q=F-I,X=St(q-lt)<Ue,G=X||q<Ue;if(!X&&L<R&&(P=R,R=L,L=P),G?X?R+L>0^T[1]<(St(T[0]-I)<Ue?R:L):R<=T[1]&&T[1]<=L:q>lt^(I<=T[0]&&T[0]<=F)){var J=uS(k,(-E+A)/_);return fO(J,$),[T,ZE(J)]}}}function l(c,f){var h=r?e:lt-e,d=0;return c<-h?d|=1:c>h&&(d|=2),f<-h?d|=4:f>h&&(d|=8),d}return Epe(o,a,s,r?[0,-e]:[-lt,e-lt])}function Cft(e,t,n,r,i,s){var o=e[0],a=e[1],u=t[0],l=t[1],c=0,f=1,h=u-o,d=l-a,p;if(p=n-o,!(!h&&p>0)){if(p/=h,h<0){if(p<c)return;p<f&&(f=p)}else if(h>0){if(p>f)return;p>c&&(c=p)}if(p=i-o,!(!h&&p<0)){if(p/=h,h<0){if(p>f)return;p>c&&(c=p)}else if(h>0){if(p<c)return;p<f&&(f=p)}if(p=r-a,!(!d&&p>0)){if(p/=d,d<0){if(p<c)return;p<f&&(f=p)}else if(d>0){if(p>f)return;p>c&&(c=p)}if(p=s-a,!(!d&&p<0)){if(p/=d,d<0){if(p>f)return;p>c&&(c=p)}else if(d>0){if(p<c)return;p<f&&(f=p)}return c>0&&(e[0]=o+c*h,e[1]=a+c*d),f<1&&(t[0]=o+f*h,t[1]=a+f*d),!0}}}}}var Vb=1e9,cS=-Vb;function _pe(e,t,n,r){function i(l,c){return e<=l&&l<=n&&t<=c&&c<=r}function s(l,c,f,h){var d=0,p=0;if(l==null||(d=o(l,f))!==(p=o(c,f))||u(l,c)<0^f>0)do h.point(d===0||d===3?e:n,d>1?r:t);while((d=(d+f+4)%4)!==p);else h.point(c[0],c[1])}function o(l,c){return St(l[0]-e)<Ue?c>0?0:3:St(l[0]-n)<Ue?c>0?2:1:St(l[1]-t)<Ue?c>0?1:0:c>0?3:2}function a(l,c){return u(l.x,c.x)}function u(l,c){var f=o(l,1),h=o(c,1);return f!==h?f-h:f===0?c[1]-l[1]:f===1?l[0]-c[0]:f===2?l[1]-c[1]:c[0]-l[0]}return function(l){var c=l,f=Spe(),h,d,p,g,m,y,b,v,x,w,C,$={point:S,lineStart:D,lineEnd:A,polygonStart:E,polygonEnd:_};function S(I,F){i(I,F)&&c.point(I,F)}function k(){for(var I=0,F=0,R=d.length;F<R;++F)for(var L=d[F],P=1,q=L.length,X=L[0],G,J,Q=X[0],ee=X[1];P<q;++P)G=Q,J=ee,X=L[P],Q=X[0],ee=X[1],J<=r?ee>r&&(Q-G)*(r-J)>(ee-J)*(e-G)&&++I:ee<=r&&(Q-G)*(r-J)<(ee-J)*(e-G)&&--I;return I}function E(){c=f,h=[],d=[],C=!0}function _(){var I=k(),F=C&&I,R=(h=Yue(h)).length;(F||R)&&(l.polygonStart(),F&&(l.lineStart(),s(null,null,1,l),l.lineEnd()),R&&kpe(h,a,I,s,l),l.polygonEnd()),c=l,h=d=p=null}function D(){$.point=T,d&&d.push(p=[]),w=!0,x=!1,b=v=NaN}function A(){h&&(T(g,m),y&&x&&f.rejoin(),h.push(f.result())),$.point=S,x&&c.lineEnd()}function T(I,F){var R=i(I,F);if(d&&p.push([I,F]),w)g=I,m=F,y=R,w=!1,R&&(c.lineStart(),c.point(I,F));else if(R&&x)c.point(I,F);else{var L=[b=Math.max(cS,Math.min(Vb,b)),v=Math.max(cS,Math.min(Vb,v))],P=[I=Math.max(cS,Math.min(Vb,I)),F=Math.max(cS,Math.min(Vb,F))];Cft(L,P,e,t,n,r)?(x||(c.lineStart(),c.point(L[0],L[1])),c.point(P[0],P[1]),R||c.lineEnd(),C=!1):R&&(c.lineStart(),c.point(I,F),C=!1)}b=I,v=F,x=R}return $}}function hY(e,t,n){var r=Js(e,t-Ue,n).concat(t);return function(i){return r.map(function(s){return[i,s]})}}function dY(e,t,n){var r=Js(e,t-Ue,n).concat(t);return function(i){return r.map(function(s){return[s,i]})}}function Sft(){var e,t,n,r,i,s,o,a,u=10,l=u,c=90,f=360,h,d,p,g,m=2.5;function y(){return{type:"MultiLineString",coordinates:b()}}function b(){return Js(oS(r/c)*c,n,c).map(p).concat(Js(oS(a/f)*f,o,f).map(g)).concat(Js(oS(t/u)*u,e,u).filter(function(v){return St(v%c)>Ue}).map(h)).concat(Js(oS(s/l)*l,i,l).filter(function(v){return St(v%f)>Ue}).map(d))}return y.lines=function(){return b().map(function(v){return{type:"LineString",coordinates:v}})},y.outline=function(){return{type:"Polygon",coordinates:[p(r).concat(g(o).slice(1),p(n).reverse().slice(1),g(a).reverse().slice(1))]}},y.extent=function(v){return arguments.length?y.extentMajor(v).extentMinor(v):y.extentMinor()},y.extentMajor=function(v){return arguments.length?(r=+v[0][0],n=+v[1][0],a=+v[0][1],o=+v[1][1],r>n&&(v=r,r=n,n=v),a>o&&(v=a,a=o,o=v),y.precision(m)):[[r,a],[n,o]]},y.extentMinor=function(v){return arguments.length?(t=+v[0][0],e=+v[1][0],s=+v[0][1],i=+v[1][1],t>e&&(v=t,t=e,e=v),s>i&&(v=s,s=i,i=v),y.precision(m)):[[t,s],[e,i]]},y.step=function(v){return arguments.length?y.stepMajor(v).stepMinor(v):y.stepMinor()},y.stepMajor=function(v){return arguments.length?(c=+v[0],f=+v[1],y):[c,f]},y.stepMinor=function(v){return arguments.length?(u=+v[0],l=+v[1],y):[u,l]},y.precision=function(v){return arguments.length?(m=+v,h=hY(s,i,90),d=dY(t,e,m),p=hY(a,o,90),g=dY(r,n,m),y):m},y.extentMajor([[-180,-90+Ue],[180,90-Ue]]).extentMinor([[-180,-80-Ue],[180,80+Ue]])}const Lv=e=>e;var dO=new Gi,B4=new Gi,Ape,Tpe,z4,U4,ef={point:Vr,lineStart:Vr,lineEnd:Vr,polygonStart:function(){ef.lineStart=kft,ef.lineEnd=_ft},polygonEnd:function(){ef.lineStart=ef.lineEnd=ef.point=Vr,dO.add(St(B4)),B4=new Gi},result:function(){var e=dO/2;return dO=new Gi,e}};function kft(){ef.point=Eft}function Eft(e,t){ef.point=Ipe,Ape=z4=e,Tpe=U4=t}function Ipe(e,t){B4.add(U4*e-z4*t),z4=e,U4=t}function _ft(){Ipe(Ape,Tpe)}const pY=ef;var C0=1/0,o_=C0,Pv=-C0,a_=Pv,Aft={point:Tft,lineStart:Vr,lineEnd:Vr,polygonStart:Vr,polygonEnd:Vr,result:function(){var e=[[C0,o_],[Pv,a_]];return Pv=a_=-(o_=C0=1/0),e}};function Tft(e,t){e<C0&&(C0=e),e>Pv&&(Pv=e),t<o_&&(o_=t),t>a_&&(a_=t)}const u_=Aft;var j4=0,W4=0,Gb=0,l_=0,c_=0,vm=0,V4=0,G4=0,Hb=0,Dpe,Npe,du,pu,ya={point:Lp,lineStart:gY,lineEnd:mY,polygonStart:function(){ya.lineStart=Nft,ya.lineEnd=Fft},polygonEnd:function(){ya.point=Lp,ya.lineStart=gY,ya.lineEnd=mY},result:function(){var e=Hb?[V4/Hb,G4/Hb]:vm?[l_/vm,c_/vm]:Gb?[j4/Gb,W4/Gb]:[NaN,NaN];return j4=W4=Gb=l_=c_=vm=V4=G4=Hb=0,e}};function Lp(e,t){j4+=e,W4+=t,++Gb}function gY(){ya.point=Ift}function Ift(e,t){ya.point=Dft,Lp(du=e,pu=t)}function Dft(e,t){var n=e-du,r=t-pu,i=Zi(n*n+r*r);l_+=i*(du+e)/2,c_+=i*(pu+t)/2,vm+=i,Lp(du=e,pu=t)}function mY(){ya.point=Lp}function Nft(){ya.point=Oft}function Fft(){Fpe(Dpe,Npe)}function Oft(e,t){ya.point=Fpe,Lp(Dpe=du=e,Npe=pu=t)}function Fpe(e,t){var n=e-du,r=t-pu,i=Zi(n*n+r*r);l_+=i*(du+e)/2,c_+=i*(pu+t)/2,vm+=i,i=pu*e-du*t,V4+=i*(du+e),G4+=i*(pu+t),Hb+=i*3,Lp(du=e,pu=t)}const yY=ya;function Ope(e){this._context=e}Ope.prototype={_radius:4.5,pointRadius:function(e){return this._radius=e,this},polygonStart:function(){this._line=0},polygonEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){this._line===0&&this._context.closePath(),this._point=NaN},point:function(e,t){switch(this._point){case 0:{this._context.moveTo(e,t),this._point=1;break}case 1:{this._context.lineTo(e,t);break}default:{this._context.moveTo(e+this._radius,t),this._context.arc(e,t,this._radius,0,Ki);break}}},result:Vr};var H4=new Gi,pO,Rpe,Mpe,qb,Xb,f_={point:Vr,lineStart:function(){f_.point=Rft},lineEnd:function(){pO&&Lpe(Rpe,Mpe),f_.point=Vr},polygonStart:function(){pO=!0},polygonEnd:function(){pO=null},result:function(){var e=+H4;return H4=new Gi,e}};function Rft(e,t){f_.point=Lpe,Rpe=qb=e,Mpe=Xb=t}function Lpe(e,t){qb-=e,Xb-=t,H4.add(Zi(qb*qb+Xb*Xb)),qb=e,Xb=t}const bY=f_;function Ppe(){this._string=[]}Ppe.prototype={_radius:4.5,_circle:xY(4.5),pointRadius:function(e){return(e=+e)!==this._radius&&(this._radius=e,this._circle=null),this},polygonStart:function(){this._line=0},polygonEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){this._line===0&&this._string.push("Z"),this._point=NaN},point:function(e,t){switch(this._point){case 0:{this._string.push("M",e,",",t),this._point=1;break}case 1:{this._string.push("L",e,",",t);break}default:{this._circle==null&&(this._circle=xY(this._radius)),this._string.push("M",e,",",t,this._circle);break}}},result:function(){if(this._string.length){var e=this._string.join("");return this._string=[],e}else return null}};function xY(e){return"m0,"+e+"a"+e+","+e+" 0 1,1 0,"+-2*e+"a"+e+","+e+" 0 1,1 0,"+2*e+"z"}function Bpe(e,t){var n=4.5,r,i;function s(o){return o&&(typeof n=="function"&&i.pointRadius(+n.apply(this,arguments)),Pl(o,r(i))),i.result()}return s.area=function(o){return Pl(o,r(pY)),pY.result()},s.measure=function(o){return Pl(o,r(bY)),bY.result()},s.bounds=function(o){return Pl(o,r(u_)),u_.result()},s.centroid=function(o){return Pl(o,r(yY)),yY.result()},s.projection=function(o){return arguments.length?(r=o==null?(e=null,Lv):(e=o).stream,s):e},s.context=function(o){return arguments.length?(i=o==null?(t=null,new Ppe):new Ope(t=o),typeof n!="function"&&i.pointRadius(n),s):t},s.pointRadius=function(o){return arguments.length?(n=typeof o=="function"?o:(i.pointRadius(+o),+o),s):n},s.projection(e).context(t)}function JD(e){return function(t){var n=new q4;for(var r in e)n[r]=e[r];return n.stream=t,n}}function q4(){}q4.prototype={constructor:q4,point:function(e,t){this.stream.point(e,t)},sphere:function(){this.stream.sphere()},lineStart:function(){this.stream.lineStart()},lineEnd:function(){this.stream.lineEnd()},polygonStart:function(){this.stream.polygonStart()},polygonEnd:function(){this.stream.polygonEnd()}};function _7(e,t,n){var r=e.clipExtent&&e.clipExtent();return e.scale(150).translate([0,0]),r!=null&&e.clipExtent(null),Pl(n,e.stream(u_)),t(u_.result()),r!=null&&e.clipExtent(r),e}function QD(e,t,n){return _7(e,function(r){var i=t[1][0]-t[0][0],s=t[1][1]-t[0][1],o=Math.min(i/(r[1][0]-r[0][0]),s/(r[1][1]-r[0][1])),a=+t[0][0]+(i-o*(r[1][0]+r[0][0]))/2,u=+t[0][1]+(s-o*(r[1][1]+r[0][1]))/2;e.scale(150*o).translate([a,u])},n)}function A7(e,t,n){return QD(e,[[0,0],t],n)}function T7(e,t,n){return _7(e,function(r){var i=+t,s=i/(r[1][0]-r[0][0]),o=(i-s*(r[1][0]+r[0][0]))/2,a=-s*r[0][1];e.scale(150*s).translate([o,a])},n)}function I7(e,t,n){return _7(e,function(r){var i=+t,s=i/(r[1][1]-r[0][1]),o=-s*r[0][0],a=(i-s*(r[1][1]+r[0][1]))/2;e.scale(150*s).translate([o,a])},n)}var vY=16,Mft=We(30*ct);function wY(e,t){return+t?Pft(e,t):Lft(e)}function Lft(e){return JD({point:function(t,n){t=e(t,n),this.stream.point(t[0],t[1])}})}function Pft(e,t){function n(r,i,s,o,a,u,l,c,f,h,d,p,g,m){var y=l-r,b=c-i,v=y*y+b*b;if(v>4*t&&g--){var x=o+h,w=a+d,C=u+p,$=Zi(x*x+w*w+C*C),S=Fs(C/=$),k=St(St(C)-1)<Ue||St(s-f)<Ue?(s+f)/2:Uo(w,x),E=e(k,S),_=E[0],D=E[1],A=_-r,T=D-i,I=b*A-y*T;(I*I/v>t||St((y*A+b*T)/v-.5)>.3||o*h+a*d+u*p<Mft)&&(n(r,i,s,o,a,u,_,D,k,x/=$,w/=$,C,g,m),m.point(_,D),n(_,D,k,x,w,C,l,c,f,h,d,p,g,m))}}return function(r){var i,s,o,a,u,l,c,f,h,d,p,g,m={point:y,lineStart:b,lineEnd:x,polygonStart:function(){r.polygonStart(),m.lineStart=w},polygonEnd:function(){r.polygonEnd(),m.lineStart=b}};function y(S,k){S=e(S,k),r.point(S[0],S[1])}function b(){f=NaN,m.point=v,r.lineStart()}function v(S,k){var E=Mp([S,k]),_=e(S,k);n(f,h,c,d,p,g,f=_[0],h=_[1],c=S,d=E[0],p=E[1],g=E[2],vY,r),r.point(f,h)}function x(){m.point=y,r.lineEnd()}function w(){b(),m.point=C,m.lineEnd=$}function C(S,k){v(i=S,k),s=f,o=h,a=d,u=p,l=g,m.point=v}function $(){n(f,h,c,d,p,g,s,o,i,a,u,l,vY,r),m.lineEnd=x,x()}return m}}var Bft=JD({point:function(e,t){this.stream.point(e*ct,t*ct)}});function zft(e){return JD({point:function(t,n){var r=e(t,n);return this.stream.point(r[0],r[1])}})}function Uft(e,t,n,r,i){function s(o,a){return o*=r,a*=i,[t+e*o,n-e*a]}return s.invert=function(o,a){return[(o-t)/e*r,(n-a)/e*i]},s}function $Y(e,t,n,r,i,s){if(!s)return Uft(e,t,n,r,i);var o=We(s),a=ze(s),u=o*e,l=a*e,c=o/e,f=a/e,h=(a*n-o*t)/e,d=(a*t+o*n)/e;function p(g,m){return g*=r,m*=i,[u*g-l*m+t,n-l*g-u*m]}return p.invert=function(g,m){return[r*(c*g-f*m+h),i*(d-f*g-c*m)]},p}function nl(e){return zpe(function(){return e})()}function zpe(e){var t,n=150,r=480,i=250,s=0,o=0,a=0,u=0,l=0,c,f=0,h=1,d=1,p=null,g=fY,m=null,y,b,v,x=Lv,w=.5,C,$,S,k,E;function _(I){return S(I[0]*ct,I[1]*ct)}function D(I){return I=S.invert(I[0],I[1]),I&&[I[0]*Pn,I[1]*Pn]}_.stream=function(I){return k&&E===I?k:k=Bft(zft(c)(g(C(x(E=I)))))},_.preclip=function(I){return arguments.length?(g=I,p=void 0,T()):g},_.postclip=function(I){return arguments.length?(x=I,m=y=b=v=null,T()):x},_.clipAngle=function(I){return arguments.length?(g=+I?$ft(p=I*ct):(p=null,fY),T()):p*Pn},_.clipExtent=function(I){return arguments.length?(x=I==null?(m=y=b=v=null,Lv):_pe(m=+I[0][0],y=+I[0][1],b=+I[1][0],v=+I[1][1]),T()):m==null?null:[[m,y],[b,v]]},_.scale=function(I){return arguments.length?(n=+I,A()):n},_.translate=function(I){return arguments.length?(r=+I[0],i=+I[1],A()):[r,i]},_.center=function(I){return arguments.length?(s=I[0]%360*ct,o=I[1]%360*ct,A()):[s*Pn,o*Pn]},_.rotate=function(I){return arguments.length?(a=I[0]%360*ct,u=I[1]%360*ct,l=I.length>2?I[2]%360*ct:0,A()):[a*Pn,u*Pn,l*Pn]},_.angle=function(I){return arguments.length?(f=I%360*ct,A()):f*Pn},_.reflectX=function(I){return arguments.length?(h=I?-1:1,A()):h<0},_.reflectY=function(I){return arguments.length?(d=I?-1:1,A()):d<0},_.precision=function(I){return arguments.length?(C=wY($,w=I*I),T()):Zi(w)},_.fitExtent=function(I,F){return QD(_,I,F)},_.fitSize=function(I,F){return A7(_,I,F)},_.fitWidth=function(I,F){return T7(_,I,F)},_.fitHeight=function(I,F){return I7(_,I,F)};function A(){var I=$Y(n,0,0,h,d,f).apply(null,t(s,o)),F=$Y(n,r-I[0],i-I[1],h,d,f);return c=Cpe(a,u,l),$=L4(t,F),S=L4(c,$),C=wY($,w),T()}function T(){return k=E=null,_}return function(){return t=e.apply(this,arguments),_.invert=t.invert&&D,A()}}function D7(e){var t=0,n=lt/3,r=zpe(e),i=r(t,n);return i.parallels=function(s){return arguments.length?r(t=s[0]*ct,n=s[1]*ct):[t*Pn,n*Pn]},i}function jft(e){var t=We(e);function n(r,i){return[r*t,ze(i)/t]}return n.invert=function(r,i){return[r/t,Fs(i*t)]},n}function Wft(e,t){var n=ze(e),r=(n+ze(t))/2;if(St(r)<Ue)return jft(e);var i=1+n*(2*r-n),s=Zi(i)/r;function o(a,u){var l=Zi(i-2*r*ze(u))/r;return[l*ze(a*=r),s-l*We(a)]}return o.invert=function(a,u){var l=s-u,c=Uo(a,St(l))*To(l);return l*r<0&&(c-=lt*To(a)*To(l)),[c/r,Fs((i-(a*a+l*l)*r*r)/(2*r))]},o}function h_(){return D7(Wft).scale(155.424).center([0,33.6442])}function Upe(){return h_().parallels([29.5,45.5]).scale(1070).translate([480,250]).rotate([96,0]).center([-.6,38.7])}function Vft(e){var t=e.length;return{point:function(n,r){for(var i=-1;++i<t;)e[i].point(n,r)},sphere:function(){for(var n=-1;++n<t;)e[n].sphere()},lineStart:function(){for(var n=-1;++n<t;)e[n].lineStart()},lineEnd:function(){for(var n=-1;++n<t;)e[n].lineEnd()},polygonStart:function(){for(var n=-1;++n<t;)e[n].polygonStart()},polygonEnd:function(){for(var n=-1;++n<t;)e[n].polygonEnd()}}}function Gft(){var e,t,n=Upe(),r,i=h_().rotate([154,0]).center([-2,58.5]).parallels([55,65]),s,o=h_().rotate([157,0]).center([-3,19.9]).parallels([8,18]),a,u,l={point:function(h,d){u=[h,d]}};function c(h){var d=h[0],p=h[1];return u=null,r.point(d,p),u||(s.point(d,p),u)||(a.point(d,p),u)}c.invert=function(h){var d=n.scale(),p=n.translate(),g=(h[0]-p[0])/d,m=(h[1]-p[1])/d;return(m>=.12&&m<.234&&g>=-.425&&g<-.214?i:m>=.166&&m<.234&&g>=-.214&&g<-.115?o:n).invert(h)},c.stream=function(h){return e&&t===h?e:e=Vft([n.stream(t=h),i.stream(h),o.stream(h)])},c.precision=function(h){return arguments.length?(n.precision(h),i.precision(h),o.precision(h),f()):n.precision()},c.scale=function(h){return arguments.length?(n.scale(h),i.scale(h*.35),o.scale(h),c.translate(n.translate())):n.scale()},c.translate=function(h){if(!arguments.length)return n.translate();var d=n.scale(),p=+h[0],g=+h[1];return r=n.translate(h).clipExtent([[p-.455*d,g-.238*d],[p+.455*d,g+.238*d]]).stream(l),s=i.translate([p-.307*d,g+.201*d]).clipExtent([[p-.425*d+Ue,g+.12*d+Ue],[p-.214*d-Ue,g+.234*d-Ue]]).stream(l),a=o.translate([p-.205*d,g+.212*d]).clipExtent([[p-.214*d+Ue,g+.166*d+Ue],[p-.115*d-Ue,g+.234*d-Ue]]).stream(l),f()},c.fitExtent=function(h,d){return QD(c,h,d)},c.fitSize=function(h,d){return A7(c,h,d)},c.fitWidth=function(h,d){return T7(c,h,d)},c.fitHeight=function(h,d){return I7(c,h,d)};function f(){return e=t=null,c}return c.scale(1070)}function jpe(e){return function(t,n){var r=We(t),i=We(n),s=e(r*i);return s===1/0?[2,0]:[s*i*ze(t),s*ze(n)]}}function _$(e){return function(t,n){var r=Zi(t*t+n*n),i=e(r),s=ze(i),o=We(i);return[Uo(t*s,r*o),Fs(r&&n*s/r)]}}var Wpe=jpe(function(e){return Zi(2/(1+e))});Wpe.invert=_$(function(e){return 2*Fs(e/2)});function Hft(){return nl(Wpe).scale(124.75).clipAngle(180-.001)}var Vpe=jpe(function(e){return(e=hpe(e))&&e/ze(e)});Vpe.invert=_$(function(e){return e});function qft(){return nl(Vpe).scale(79.4188).clipAngle(180-.001)}function eN(e,t){return[e,qE(k7((Dn+t)/2))]}eN.invert=function(e,t){return[e,2*by(fpe(t))-Dn]};function Xft(){return Gpe(eN).scale(961/Ki)}function Gpe(e){var t=nl(e),n=t.center,r=t.scale,i=t.translate,s=t.clipExtent,o=null,a,u,l;t.scale=function(f){return arguments.length?(r(f),c()):r()},t.translate=function(f){return arguments.length?(i(f),c()):i()},t.center=function(f){return arguments.length?(n(f),c()):n()},t.clipExtent=function(f){return arguments.length?(f==null?o=a=u=l=null:(o=+f[0][0],a=+f[0][1],u=+f[1][0],l=+f[1][1]),c()):o==null?null:[[o,a],[u,l]]};function c(){var f=lt*r(),h=t(pft(t.rotate()).invert([0,0]));return s(o==null?[[h[0]-f,h[1]-f],[h[0]+f,h[1]+f]]:e===eN?[[Math.max(h[0]-f,o),a],[Math.min(h[0]+f,u),l]]:[[o,Math.max(h[1]-f,a)],[u,Math.min(h[1]+f,l)]])}return c()}function fS(e){return k7((Dn+e)/2)}function Yft(e,t){var n=We(e),r=e===t?ze(e):qE(n/We(t))/qE(fS(t)/fS(e)),i=n*cO(fS(e),r)/r;if(!r)return eN;function s(o,a){i>0?a<-Dn+Ue&&(a=-Dn+Ue):a>Dn-Ue&&(a=Dn-Ue);var u=i/cO(fS(a),r);return[u*ze(r*o),i-u*We(r*o)]}return s.invert=function(o,a){var u=i-a,l=To(r)*Zi(o*o+u*u),c=Uo(o,St(u))*To(u);return u*r<0&&(c-=lt*To(o)*To(u)),[c/r,2*by(cO(i/l,1/r))-Dn]},s}function Kft(){return D7(Yft).scale(109.5).parallels([30,30])}function d_(e,t){return[e,t]}d_.invert=d_;function Zft(){return nl(d_).scale(152.63)}function Jft(e,t){var n=We(e),r=e===t?ze(e):(n-We(t))/(t-e),i=n/r+e;if(St(r)<Ue)return d_;function s(o,a){var u=i-a,l=r*o;return[u*ze(l),i-u*We(l)]}return s.invert=function(o,a){var u=i-a,l=Uo(o,St(u))*To(u);return u*r<0&&(l-=lt*To(o)*To(u)),[l/r,i-To(r)*Zi(o*o+u*u)]},s}function Qft(){return D7(Jft).scale(131.154).center([0,13.9389])}var px=1.340264,gx=-.081106,mx=893e-6,yx=.003796,p_=Zi(3)/2,eht=12;function Hpe(e,t){var n=Fs(p_*ze(t)),r=n*n,i=r*r*r;return[e*We(n)/(p_*(px+3*gx*r+i*(7*mx+9*yx*r))),n*(px+gx*r+i*(mx+yx*r))]}Hpe.invert=function(e,t){for(var n=t,r=n*n,i=r*r*r,s=0,o,a,u;s<eht&&(a=n*(px+gx*r+i*(mx+yx*r))-t,u=px+3*gx*r+i*(7*mx+9*yx*r),n-=o=a/u,r=n*n,i=r*r*r,!(St(o)<GE));++s);return[p_*e*(px+3*gx*r+i*(7*mx+9*yx*r))/We(n),Fs(ze(n)/p_)]};function tht(){return nl(Hpe).scale(177.158)}function qpe(e,t){var n=We(t),r=We(e)*n;return[n*ze(e)/r,ze(t)/r]}qpe.invert=_$(by);function nht(){return nl(qpe).scale(144.049).clipAngle(60)}function rht(){var e=1,t=0,n=0,r=1,i=1,s=0,o,a,u=null,l,c,f,h=1,d=1,p=JD({point:function(x,w){var C=v([x,w]);this.stream.point(C[0],C[1])}}),g=Lv,m,y;function b(){return h=e*r,d=e*i,m=y=null,v}function v(x){var w=x[0]*h,C=x[1]*d;if(s){var $=C*o-w*a;w=w*o+C*a,C=$}return[w+t,C+n]}return v.invert=function(x){var w=x[0]-t,C=x[1]-n;if(s){var $=C*o+w*a;w=w*o-C*a,C=$}return[w/h,C/d]},v.stream=function(x){return m&&y===x?m:m=p(g(y=x))},v.postclip=function(x){return arguments.length?(g=x,u=l=c=f=null,b()):g},v.clipExtent=function(x){return arguments.length?(g=x==null?(u=l=c=f=null,Lv):_pe(u=+x[0][0],l=+x[0][1],c=+x[1][0],f=+x[1][1]),b()):u==null?null:[[u,l],[c,f]]},v.scale=function(x){return arguments.length?(e=+x,b()):e},v.translate=function(x){return arguments.length?(t=+x[0],n=+x[1],b()):[t,n]},v.angle=function(x){return arguments.length?(s=x%360*ct,a=ze(s),o=We(s),b()):s*Pn},v.reflectX=function(x){return arguments.length?(r=x?-1:1,b()):r<0},v.reflectY=function(x){return arguments.length?(i=x?-1:1,b()):i<0},v.fitExtent=function(x,w){return QD(v,x,w)},v.fitSize=function(x,w){return A7(v,x,w)},v.fitWidth=function(x,w){return T7(v,x,w)},v.fitHeight=function(x,w){return I7(v,x,w)},v}function Xpe(e,t){var n=t*t,r=n*n;return[e*(.8707-.131979*n+r*(-.013791+r*(.003971*n-.001529*r))),t*(1.007226+n*(.015085+r*(-.044475+.028874*n-.005916*r)))]}Xpe.invert=function(e,t){var n=t,r=25,i;do{var s=n*n,o=s*s;n-=i=(n*(1.007226+s*(.015085+o*(-.044475+.028874*s-.005916*o)))-t)/(1.007226+s*(.015085*3+o*(-.044475*7+.028874*9*s-.005916*11*o)))}while(St(i)>Ue&&--r>0);return[e/(.8707+(s=n*n)*(-.131979+s*(-.013791+s*s*s*(.003971-.001529*s)))),n]};function iht(){return nl(Xpe).scale(175.295)}function Ype(e,t){return[We(t)*ze(e),ze(t)]}Ype.invert=_$(Fs);function sht(){return nl(Ype).scale(249.5).clipAngle(90+Ue)}function Kpe(e,t){var n=We(t),r=1+We(e)*n;return[n*ze(e)/r,ze(t)/r]}Kpe.invert=_$(function(e){return 2*by(e)});function oht(){return nl(Kpe).scale(250).clipAngle(142)}function Zpe(e,t){return[qE(k7((Dn+t)/2)),-e]}Zpe.invert=function(e,t){return[-t,2*by(fpe(e))-Dn]};function aht(){var e=Gpe(Zpe),t=e.center,n=e.rotate;return e.center=function(r){return arguments.length?t([-r[1],r[0]]):(r=t(),[r[1],-r[0]])},e.rotate=function(r){return arguments.length?n([r[0],r[1],r.length>2?r[2]+90:90]):(r=n(),[r[0],r[1],r[2]-90])},n([0,0,90]).scale(159.155)}var uht=Math.abs,X4=Math.cos,g_=Math.sin,lht=1e-6,Jpe=Math.PI,Y4=Jpe/2,CY=cht(2);function SY(e){return e>1?Y4:e<-1?-Y4:Math.asin(e)}function cht(e){return e>0?Math.sqrt(e):0}function fht(e,t){var n=e*g_(t),r=30,i;do t-=i=(t+g_(t)-n)/(1+X4(t));while(uht(i)>lht&&--r>0);return t/2}function hht(e,t,n){function r(i,s){return[e*i*X4(s=fht(n,s)),t*g_(s)]}return r.invert=function(i,s){return s=SY(s/t),[i/(e*X4(s)),SY((2*s+g_(2*s))/n)]},r}var dht=hht(CY/Y4,CY,Jpe);function pht(){return nl(dht).scale(169.529)}const ght=Bpe(),K4=["clipAngle","clipExtent","scale","translate","center","rotate","parallels","precision","reflectX","reflectY","coefficient","distance","fraction","lobes","parallel","radius","ratio","spacing","tilt"];function mht(e,t){return function n(){const r=t();return r.type=e,r.path=Bpe().projection(r),r.copy=r.copy||function(){const i=n();return K4.forEach(s=>{r[s]&&i[s](r[s]())}),i.path.pointRadius(r.path.pointRadius()),i},r}}function N7(e,t){if(!e||typeof e!="string")throw new Error("Projection type must be a name string.");return e=e.toLowerCase(),arguments.length>1?(m_[e]=mht(e,t),this):m_[e]||null}function Qpe(e){return e&&e.path||ght}const m_={albers:Upe,albersusa:Gft,azimuthalequalarea:Hft,azimuthalequidistant:qft,conicconformal:Kft,conicequalarea:h_,conicequidistant:Qft,equalEarth:tht,equirectangular:Zft,gnomonic:nht,identity:rht,mercator:Xft,mollweide:pht,naturalEarth1:iht,orthographic:sht,stereographic:oht,transversemercator:aht};for(const e in m_)N7(e,m_[e]);function yht(){}const $l=[[],[[[1,1.5],[.5,1]]],[[[1.5,1],[1,1.5]]],[[[1.5,1],[.5,1]]],[[[1,.5],[1.5,1]]],[[[1,1.5],[.5,1]],[[1,.5],[1.5,1]]],[[[1,.5],[1,1.5]]],[[[1,.5],[.5,1]]],[[[.5,1],[1,.5]]],[[[1,1.5],[1,.5]]],[[[.5,1],[1,.5]],[[1.5,1],[1,1.5]]],[[[1.5,1],[1,.5]]],[[[.5,1],[1.5,1]]],[[[1,1.5],[1.5,1]]],[[[.5,1],[1,1.5]]],[]];function ege(){var e=1,t=1,n=a;function r(u,l){return l.map(c=>i(u,c))}function i(u,l){var c=[],f=[];return s(u,l,h=>{n(h,u,l),bht(h)>0?c.push([h]):f.push(h)}),f.forEach(h=>{for(var d=0,p=c.length,g;d<p;++d)if(xht((g=c[d])[0],h)!==-1){g.push(h);return}}),{type:"MultiPolygon",value:l,coordinates:c}}function s(u,l,c){var f=new Array,h=new Array,d,p,g,m,y,b;for(d=p=-1,m=u[0]>=l,$l[m<<1].forEach(v);++d<e-1;)g=m,m=u[d+1]>=l,$l[g|m<<1].forEach(v);for($l[m<<0].forEach(v);++p<t-1;){for(d=-1,m=u[p*e+e]>=l,y=u[p*e]>=l,$l[m<<1|y<<2].forEach(v);++d<e-1;)g=m,m=u[p*e+e+d+1]>=l,b=y,y=u[p*e+d+1]>=l,$l[g|m<<1|y<<2|b<<3].forEach(v);$l[m|y<<3].forEach(v)}for(d=-1,y=u[p*e]>=l,$l[y<<2].forEach(v);++d<e-1;)b=y,y=u[p*e+d+1]>=l,$l[y<<2|b<<3].forEach(v);$l[y<<3].forEach(v);function v(x){var w=[x[0][0]+d,x[0][1]+p],C=[x[1][0]+d,x[1][1]+p],$=o(w),S=o(C),k,E;(k=h[$])?(E=f[S])?(delete h[k.end],delete f[E.start],k===E?(k.ring.push(C),c(k.ring)):f[k.start]=h[E.end]={start:k.start,end:E.end,ring:k.ring.concat(E.ring)}):(delete h[k.end],k.ring.push(C),h[k.end=S]=k):(k=f[S])?(E=h[$])?(delete f[k.start],delete h[E.end],k===E?(k.ring.push(C),c(k.ring)):f[E.start]=h[k.end]={start:E.start,end:k.end,ring:E.ring.concat(k.ring)}):(delete f[k.start],k.ring.unshift(w),f[k.start=$]=k):f[$]=h[S]={start:$,end:S,ring:[w,C]}}}function o(u){return u[0]*2+u[1]*(e+1)*4}function a(u,l,c){u.forEach(f=>{var h=f[0],d=f[1],p=h|0,g=d|0,m,y=l[g*e+p];h>0&&h<e&&p===h&&(m=l[g*e+p-1],f[0]=h+(c-m)/(y-m)-.5),d>0&&d<t&&g===d&&(m=l[(g-1)*e+p],f[1]=d+(c-m)/(y-m)-.5)})}return r.contour=i,r.size=function(u){if(!arguments.length)return[e,t];var l=Math.floor(u[0]),c=Math.floor(u[1]);return l>=0&&c>=0||le("invalid size"),e=l,t=c,r},r.smooth=function(u){return arguments.length?(n=u?a:yht,r):n===a},r}function bht(e){for(var t=0,n=e.length,r=e[n-1][1]*e[0][0]-e[n-1][0]*e[0][1];++t<n;)r+=e[t-1][1]*e[t][0]-e[t-1][0]*e[t][1];return r}function xht(e,t){for(var n=-1,r=t.length,i;++n<r;)if(i=vht(e,t[n]))return i;return 0}function vht(e,t){for(var n=t[0],r=t[1],i=-1,s=0,o=e.length,a=o-1;s<o;a=s++){var u=e[s],l=u[0],c=u[1],f=e[a],h=f[0],d=f[1];if(wht(u,f,t))return 0;c>r!=d>r&&n<(h-l)*(r-c)/(d-c)+l&&(i=-i)}return i}function wht(e,t,n){var r;return $ht(e,t,n)&&Cht(e[r=+(e[0]===t[0])],n[r],t[r])}function $ht(e,t,n){return(t[0]-e[0])*(n[1]-e[1])===(n[0]-e[0])*(t[1]-e[1])}function Cht(e,t,n){return e<=t&&t<=n||n<=t&&t<=e}function tge(e,t,n){return function(r){var i=qf(r),s=n?Math.min(i[0],0):i[0],o=i[1],a=o-s,u=t?Zf(s,o,e):a/(e+1);return Js(s+u,o,u)}}function F7(e){re.call(this,null,e)}F7.Definition={type:"Isocontour",metadata:{generates:!0},params:[{name:"field",type:"field"},{name:"thresholds",type:"number",array:!0},{name:"levels",type:"number"},{name:"nice",type:"boolean",default:!1},{name:"resolve",type:"enum",values:["shared","independent"],default:"independent"},{name:"zero",type:"boolean",default:!0},{name:"smooth",type:"boolean",default:!0},{name:"scale",type:"number",expr:!0},{name:"translate",type:"number",array:!0,expr:!0},{name:"as",type:"string",null:!0,default:"contour"}]};$e(F7,re,{transform(e,t){if(this.value&&!t.changed()&&!e.modified())return t.StopPropagation;var n=t.fork(t.NO_SOURCE|t.NO_FIELDS),r=t.materialize(t.SOURCE).source,i=e.field||Po,s=ege().smooth(e.smooth!==!1),o=e.thresholds||Sht(r,i,e),a=e.as===null?null:e.as||"contour",u=[];return r.forEach(l=>{const c=i(l),f=s.size([c.width,c.height])(c.values,it(o)?o:o(c.values));kht(f,c,l,e),f.forEach(h=>{u.push(tD(l,Ot(a!=null?{[a]:h}:h)))})}),this.value&&(n.rem=this.value),this.value=n.source=n.add=u,n}});function Sht(e,t,n){const r=tge(n.levels||10,n.nice,n.zero!==!1);return n.resolve!=="shared"?r:r(e.map(i=>tp(t(i).values)))}function kht(e,t,n,r){let i=r.scale||t.scale,s=r.translate||t.translate;if(zt(i)&&(i=i(n,r)),zt(s)&&(s=s(n,r)),(i===1||i==null)&&!s)return;const o=(kp(i)?i:i[0])||1,a=(kp(i)?i:i[1])||1,u=s&&s[0]||0,l=s&&s[1]||0;e.forEach(nge(t,o,a,u,l))}function nge(e,t,n,r,i){const s=e.x1||0,o=e.y1||0,a=t*n<0;function u(f){f.forEach(l)}function l(f){a&&f.reverse(),f.forEach(c)}function c(f){f[0]=(f[0]-s)*t+r,f[1]=(f[1]-o)*n+i}return function(f){return f.coordinates.forEach(u),f}}function kY(e,t,n){const r=e>=0?e:G6(t,n);return Math.round((Math.sqrt(4*r*r+1)-1)/2)}function gO(e){return zt(e)?e:Bo(+e)}function rge(){var e=u=>u[0],t=u=>u[1],n=ty,r=[-1,-1],i=960,s=500,o=2;function a(u,l){const c=kY(r[0],u,e)>>o,f=kY(r[1],u,t)>>o,h=c?c+2:0,d=f?f+2:0,p=2*h+(i>>o),g=2*d+(s>>o),m=new Float32Array(p*g),y=new Float32Array(p*g);let b=m;u.forEach(x=>{const w=h+(+e(x)>>o),C=d+(+t(x)>>o);w>=0&&w<p&&C>=0&&C<g&&(m[w+C*p]+=+n(x))}),c>0&&f>0?(sm(p,g,m,y,c),om(p,g,y,m,f),sm(p,g,m,y,c),om(p,g,y,m,f),sm(p,g,m,y,c),om(p,g,y,m,f)):c>0?(sm(p,g,m,y,c),sm(p,g,y,m,c),sm(p,g,m,y,c),b=y):f>0&&(om(p,g,m,y,f),om(p,g,y,m,f),om(p,g,m,y,f),b=y);const v=l?Math.pow(2,-2*o):1/Kue(b);for(let x=0,w=p*g;x<w;++x)b[x]*=v;return{values:b,scale:1<<o,width:p,height:g,x1:h,y1:d,x2:h+(i>>o),y2:d+(s>>o)}}return a.x=function(u){return arguments.length?(e=gO(u),a):e},a.y=function(u){return arguments.length?(t=gO(u),a):t},a.weight=function(u){return arguments.length?(n=gO(u),a):n},a.size=function(u){if(!arguments.length)return[i,s];var l=+u[0],c=+u[1];return l>=0&&c>=0||le("invalid size"),i=l,s=c,a},a.cellSize=function(u){return arguments.length?((u=+u)>=1||le("invalid cell size"),o=Math.floor(Math.log(u)/Math.LN2),a):1<<o},a.bandwidth=function(u){return arguments.length?(u=et(u),u.length===1&&(u=[+u[0],+u[0]]),u.length!==2&&le("invalid bandwidth"),r=u,a):r},a}function sm(e,t,n,r,i){const s=(i<<1)+1;for(let o=0;o<t;++o)for(let a=0,u=0;a<e+i;++a)a<e&&(u+=n[a+o*e]),a>=i&&(a>=s&&(u-=n[a-s+o*e]),r[a-i+o*e]=u/Math.min(a+1,e-1+s-a,s))}function om(e,t,n,r,i){const s=(i<<1)+1;for(let o=0;o<e;++o)for(let a=0,u=0;a<t+i;++a)a<t&&(u+=n[o+a*e]),a>=i&&(a>=s&&(u-=n[o+(a-s)*e]),r[o+(a-i)*e]=u/Math.min(a+1,t-1+s-a,s))}function O7(e){re.call(this,null,e)}O7.Definition={type:"KDE2D",metadata:{generates:!0},params:[{name:"size",type:"number",array:!0,length:2,required:!0},{name:"x",type:"field",required:!0},{name:"y",type:"field",required:!0},{name:"weight",type:"field"},{name:"groupby",type:"field",array:!0},{name:"cellSize",type:"number"},{name:"bandwidth",type:"number",array:!0,length:2},{name:"counts",type:"boolean",default:!1},{name:"as",type:"string",default:"grid"}]};const Eht=["x","y","weight","size","cellSize","bandwidth"];function ige(e,t){return Eht.forEach(n=>t[n]!=null?e[n](t[n]):0),e}$e(O7,re,{transform(e,t){if(this.value&&!t.changed()&&!e.modified())return t.StopPropagation;var n=t.fork(t.NO_SOURCE|t.NO_FIELDS),r=t.materialize(t.SOURCE).source,i=_ht(r,e.groupby),s=(e.groupby||[]).map(Nn),o=ige(rge(),e),a=e.as||"grid",u=[];function l(c,f){for(let h=0;h<s.length;++h)c[s[h]]=f[h];return c}return u=i.map(c=>Ot(l({[a]:o(c,e.counts)},c.dims))),this.value&&(n.rem=this.value),this.value=n.source=n.add=u,n}});function _ht(e,t){var n=[],r=c=>c(a),i,s,o,a,u,l;if(t==null)n.push(e);else for(i={},s=0,o=e.length;s<o;++s)a=e[s],u=t.map(r),l=i[u],l||(i[u]=l=[],l.dims=u,n.push(l)),l.push(a);return n}function R7(e){re.call(this,null,e)}R7.Definition={type:"Contour",metadata:{generates:!0},params:[{name:"size",type:"number",array:!0,length:2,required:!0},{name:"values",type:"number",array:!0},{name:"x",type:"field"},{name:"y",type:"field"},{name:"weight",type:"field"},{name:"cellSize",type:"number"},{name:"bandwidth",type:"number"},{name:"count",type:"number"},{name:"nice",type:"boolean",default:!1},{name:"thresholds",type:"number",array:!0},{name:"smooth",type:"boolean",default:!0}]};$e(R7,re,{transform(e,t){if(this.value&&!t.changed()&&!e.modified())return t.StopPropagation;var n=t.fork(t.NO_SOURCE|t.NO_FIELDS),r=ege().smooth(e.smooth!==!1),i=e.values,s=e.thresholds||tge(e.count||10,e.nice,!!i),o=e.size,a,u;return i||(i=t.materialize(t.SOURCE).source,a=ige(rge(),e)(i,!0),u=nge(a,a.scale||1,a.scale||1,0,0),o=[a.width,a.height],i=a.values),s=it(s)?s:s(i),i=r.size(o)(i,s),u&&i.forEach(u),this.value&&(n.rem=this.value),this.value=n.source=n.add=(i||[]).map(Ot),n}});const Z4="Feature",M7="FeatureCollection",Aht="MultiPoint";function L7(e){re.call(this,null,e)}L7.Definition={type:"GeoJSON",metadata:{},params:[{name:"fields",type:"field",array:!0,length:2},{name:"geojson",type:"field"}]};$e(L7,re,{transform(e,t){var n=this._features,r=this._points,i=e.fields,s=i&&i[0],o=i&&i[1],a=e.geojson||!i&&Po,u=t.ADD,l;l=e.modified()||t.changed(t.REM)||t.modified(wi(a))||s&&t.modified(wi(s))||o&&t.modified(wi(o)),(!this.value||l)&&(u=t.SOURCE,this._features=n=[],this._points=r=[]),a&&t.visit(u,c=>n.push(a(c))),s&&o&&(t.visit(u,c=>{var f=s(c),h=o(c);f!=null&&h!=null&&(f=+f)===f&&(h=+h)===h&&r.push([f,h])}),n=n.concat({type:Z4,geometry:{type:Aht,coordinates:r}})),this.value={type:M7,features:n}}});function P7(e){re.call(this,null,e)}P7.Definition={type:"GeoPath",metadata:{modifies:!0},params:[{name:"projection",type:"projection"},{name:"field",type:"field"},{name:"pointRadius",type:"number",expr:!0},{name:"as",type:"string",default:"path"}]};$e(P7,re,{transform(e,t){var n=t.fork(t.ALL),r=this.value,i=e.field||Po,s=e.as||"path",o=n.SOURCE;!r||e.modified()?(this.value=r=Qpe(e.projection),n.materialize().reflow()):o=i===Po||t.modified(i.fields)?n.ADD_MOD:n.ADD;const a=Tht(r,e.pointRadius);return n.visit(o,u=>u[s]=r(i(u))),r.pointRadius(a),n.modifies(s)}});function Tht(e,t){const n=e.pointRadius();return e.context(null),t!=null&&e.pointRadius(t),n}function B7(e){re.call(this,null,e)}B7.Definition={type:"GeoPoint",metadata:{modifies:!0},params:[{name:"projection",type:"projection",required:!0},{name:"fields",type:"field",array:!0,required:!0,length:2},{name:"as",type:"string",array:!0,length:2,default:["x","y"]}]};$e(B7,re,{transform(e,t){var n=e.projection,r=e.fields[0],i=e.fields[1],s=e.as||["x","y"],o=s[0],a=s[1],u;function l(c){const f=n([r(c),i(c)]);f?(c[o]=f[0],c[a]=f[1]):(c[o]=void 0,c[a]=void 0)}return e.modified()?t=t.materialize().reflow(!0).visit(t.SOURCE,l):(u=t.modified(r.fields)||t.modified(i.fields),t.visit(u?t.ADD_MOD:t.ADD,l)),t.modifies(s)}});function z7(e){re.call(this,null,e)}z7.Definition={type:"GeoShape",metadata:{modifies:!0,nomod:!0},params:[{name:"projection",type:"projection"},{name:"field",type:"field",default:"datum"},{name:"pointRadius",type:"number",expr:!0},{name:"as",type:"string",default:"shape"}]};$e(z7,re,{transform(e,t){var n=t.fork(t.ALL),r=this.value,i=e.as||"shape",s=n.ADD;return(!r||e.modified())&&(this.value=r=Iht(Qpe(e.projection),e.field||Gf("datum"),e.pointRadius),n.materialize().reflow(),s=n.SOURCE),n.visit(s,o=>o[i]=r),n.modifies(i)}});function Iht(e,t,n){const r=n==null?i=>e(t(i)):i=>{var s=e.pointRadius(),o=e.pointRadius(n)(t(i));return e.pointRadius(s),o};return r.context=i=>(e.context(i),r),r}function U7(e){re.call(this,[],e),this.generator=Sft()}U7.Definition={type:"Graticule",metadata:{changes:!0,generates:!0},params:[{name:"extent",type:"array",array:!0,length:2,content:{type:"number",array:!0,length:2}},{name:"extentMajor",type:"array",array:!0,length:2,content:{type:"number",array:!0,length:2}},{name:"extentMinor",type:"array",array:!0,length:2,content:{type:"number",array:!0,length:2}},{name:"step",type:"number",array:!0,length:2},{name:"stepMajor",type:"number",array:!0,length:2,default:[90,360]},{name:"stepMinor",type:"number",array:!0,length:2,default:[10,10]},{name:"precision",type:"number",default:2.5}]};$e(U7,re,{transform(e,t){var n=this.value,r=this.generator,i;if(!n.length||e.modified())for(const s in e)zt(r[s])&&r[s](e[s]);return i=r(),n.length?t.mod.push(Lue(n[0],i)):t.add.push(Ot(i)),n[0]=i,t}});function j7(e){re.call(this,null,e)}j7.Definition={type:"heatmap",metadata:{modifies:!0},params:[{name:"field",type:"field"},{name:"color",type:"string",expr:!0},{name:"opacity",type:"number",expr:!0},{name:"resolve",type:"enum",values:["shared","independent"],default:"independent"},{name:"as",type:"string",default:"image"}]};$e(j7,re,{transform(e,t){if(!t.changed()&&!e.modified())return t.StopPropagation;var n=t.materialize(t.SOURCE).source,r=e.resolve==="shared",i=e.field||Po,s=Nht(e.opacity,e),o=Dht(e.color,e),a=e.as||"image",u={$x:0,$y:0,$value:0,$max:r?tp(n.map(l=>tp(i(l).values))):0};return n.forEach(l=>{const c=i(l),f=yt({},l,u);r||(f.$max=tp(c.values||[])),l[a]=Fht(c,f,o.dep?o:Bo(o(f)),s.dep?s:Bo(s(f)))}),t.reflow(!0).modifies(a)}});function Dht(e,t){let n;return zt(e)?(n=r=>Ns(e(r,t)),n.dep=sge(e)):n=Bo(Ns(e||"#888")),n}function Nht(e,t){let n;return zt(e)?(n=r=>e(r,t),n.dep=sge(e)):e?n=Bo(e):(n=r=>r.$value/r.$max||0,n.dep=!0),n}function sge(e){if(!zt(e))return!1;const t=cc(wi(e));return t.$x||t.$y||t.$value||t.$max}function Fht(e,t,n,r){const i=e.width,s=e.height,o=e.x1||0,a=e.y1||0,u=e.x2||i,l=e.y2||s,c=e.values,f=c?m=>c[m]:Qc,h=Ec(u-o,l-a),d=h.getContext("2d"),p=d.getImageData(0,0,u-o,l-a),g=p.data;for(let m=a,y=0;m<l;++m){t.$y=m-a;for(let b=o,v=m*i;b<u;++b,y+=4){t.$x=b-o,t.$value=f(b+v);const x=n(t);g[y+0]=x.r,g[y+1]=x.g,g[y+2]=x.b,g[y+3]=~~(255*r(t))}}return d.putImageData(p,0,0),h}function oge(e){re.call(this,null,e),this.modified(!0)}$e(oge,re,{transform(e,t){let n=this.value;return!n||e.modified("type")?(this.value=n=Rht(e.type),K4.forEach(r=>{e[r]!=null&&EY(n,r,e[r])})):K4.forEach(r=>{e.modified(r)&&EY(n,r,e[r])}),e.pointRadius!=null&&n.path.pointRadius(e.pointRadius),e.fit&&Oht(n,e),t.fork(t.NO_SOURCE|t.NO_FIELDS)}});function Oht(e,t){const n=Mht(t.fit);t.extent?e.fitExtent(t.extent,n):t.size&&e.fitSize(t.size,n)}function Rht(e){const t=N7((e||"mercator").toLowerCase());return t||le("Unrecognized projection type: "+e),t()}function EY(e,t,n){zt(e[t])&&e[t](n)}function Mht(e){return e=et(e),e.length===1?e[0]:{type:M7,features:e.reduce((t,n)=>t.concat(Lht(n)),[])}}function Lht(e){return e.type===M7?e.features:et(e).filter(t=>t!=null).map(t=>t.type===Z4?t:{type:Z4,geometry:t})}const Pht=Object.freeze(Object.defineProperty({__proto__:null,contour:R7,geojson:L7,geopath:P7,geopoint:B7,geoshape:z7,graticule:U7,heatmap:j7,isocontour:F7,kde2d:O7,projection:oge},Symbol.toStringTag,{value:"Module"}));function Bht(e,t){var n,r=1;e==null&&(e=0),t==null&&(t=0);function i(){var s,o=n.length,a,u=0,l=0;for(s=0;s<o;++s)a=n[s],u+=a.x,l+=a.y;for(u=(u/o-e)*r,l=(l/o-t)*r,s=0;s<o;++s)a=n[s],a.x-=u,a.y-=l}return i.initialize=function(s){n=s},i.x=function(s){return arguments.length?(e=+s,i):e},i.y=function(s){return arguments.length?(t=+s,i):t},i.strength=function(s){return arguments.length?(r=+s,i):r},i}function zht(e){const t=+this._x.call(null,e),n=+this._y.call(null,e);return age(this.cover(t,n),t,n,e)}function age(e,t,n,r){if(isNaN(t)||isNaN(n))return e;var i,s=e._root,o={data:r},a=e._x0,u=e._y0,l=e._x1,c=e._y1,f,h,d,p,g,m,y,b;if(!s)return e._root=o,e;for(;s.length;)if((g=t>=(f=(a+l)/2))?a=f:l=f,(m=n>=(h=(u+c)/2))?u=h:c=h,i=s,!(s=s[y=m<<1|g]))return i[y]=o,e;if(d=+e._x.call(null,s.data),p=+e._y.call(null,s.data),t===d&&n===p)return o.next=s,i?i[y]=o:e._root=o,e;do i=i?i[y]=new Array(4):e._root=new Array(4),(g=t>=(f=(a+l)/2))?a=f:l=f,(m=n>=(h=(u+c)/2))?u=h:c=h;while((y=m<<1|g)===(b=(p>=h)<<1|d>=f));return i[b]=s,i[y]=o,e}function Uht(e){var t,n,r=e.length,i,s,o=new Array(r),a=new Array(r),u=1/0,l=1/0,c=-1/0,f=-1/0;for(n=0;n<r;++n)isNaN(i=+this._x.call(null,t=e[n]))||isNaN(s=+this._y.call(null,t))||(o[n]=i,a[n]=s,i<u&&(u=i),i>c&&(c=i),s<l&&(l=s),s>f&&(f=s));if(u>c||l>f)return this;for(this.cover(u,l).cover(c,f),n=0;n<r;++n)age(this,o[n],a[n],e[n]);return this}function jht(e,t){if(isNaN(e=+e)||isNaN(t=+t))return this;var n=this._x0,r=this._y0,i=this._x1,s=this._y1;if(isNaN(n))i=(n=Math.floor(e))+1,s=(r=Math.floor(t))+1;else{for(var o=i-n||1,a=this._root,u,l;n>e||e>=i||r>t||t>=s;)switch(l=(t<r)<<1|e<n,u=new Array(4),u[l]=a,a=u,o*=2,l){case 0:i=n+o,s=r+o;break;case 1:n=i-o,s=r+o;break;case 2:i=n+o,r=s-o;break;case 3:n=i-o,r=s-o;break}this._root&&this._root.length&&(this._root=a)}return this._x0=n,this._y0=r,this._x1=i,this._y1=s,this}function Wht(){var e=[];return this.visit(function(t){if(!t.length)do e.push(t.data);while(t=t.next)}),e}function Vht(e){return arguments.length?this.cover(+e[0][0],+e[0][1]).cover(+e[1][0],+e[1][1]):isNaN(this._x0)?void 0:[[this._x0,this._y0],[this._x1,this._y1]]}function Wi(e,t,n,r,i){this.node=e,this.x0=t,this.y0=n,this.x1=r,this.y1=i}function Ght(e,t,n){var r,i=this._x0,s=this._y0,o,a,u,l,c=this._x1,f=this._y1,h=[],d=this._root,p,g;for(d&&h.push(new Wi(d,i,s,c,f)),n==null?n=1/0:(i=e-n,s=t-n,c=e+n,f=t+n,n*=n);p=h.pop();)if(!(!(d=p.node)||(o=p.x0)>c||(a=p.y0)>f||(u=p.x1)<i||(l=p.y1)<s))if(d.length){var m=(o+u)/2,y=(a+l)/2;h.push(new Wi(d[3],m,y,u,l),new Wi(d[2],o,y,m,l),new Wi(d[1],m,a,u,y),new Wi(d[0],o,a,m,y)),(g=(t>=y)<<1|e>=m)&&(p=h[h.length-1],h[h.length-1]=h[h.length-1-g],h[h.length-1-g]=p)}else{var b=e-+this._x.call(null,d.data),v=t-+this._y.call(null,d.data),x=b*b+v*v;if(x<n){var w=Math.sqrt(n=x);i=e-w,s=t-w,c=e+w,f=t+w,r=d.data}}return r}function Hht(e){if(isNaN(c=+this._x.call(null,e))||isNaN(f=+this._y.call(null,e)))return this;var t,n=this._root,r,i,s,o=this._x0,a=this._y0,u=this._x1,l=this._y1,c,f,h,d,p,g,m,y;if(!n)return this;if(n.length)for(;;){if((p=c>=(h=(o+u)/2))?o=h:u=h,(g=f>=(d=(a+l)/2))?a=d:l=d,t=n,!(n=n[m=g<<1|p]))return this;if(!n.length)break;(t[m+1&3]||t[m+2&3]||t[m+3&3])&&(r=t,y=m)}for(;n.data!==e;)if(i=n,!(n=n.next))return this;return(s=n.next)&&delete n.next,i?(s?i.next=s:delete i.next,this):t?(s?t[m]=s:delete t[m],(n=t[0]||t[1]||t[2]||t[3])&&n===(t[3]||t[2]||t[1]||t[0])&&!n.length&&(r?r[y]=n:this._root=n),this):(this._root=s,this)}function qht(e){for(var t=0,n=e.length;t<n;++t)this.remove(e[t]);return this}function Xht(){return this._root}function Yht(){var e=0;return this.visit(function(t){if(!t.length)do++e;while(t=t.next)}),e}function Kht(e){var t=[],n,r=this._root,i,s,o,a,u;for(r&&t.push(new Wi(r,this._x0,this._y0,this._x1,this._y1));n=t.pop();)if(!e(r=n.node,s=n.x0,o=n.y0,a=n.x1,u=n.y1)&&r.length){var l=(s+a)/2,c=(o+u)/2;(i=r[3])&&t.push(new Wi(i,l,c,a,u)),(i=r[2])&&t.push(new Wi(i,s,c,l,u)),(i=r[1])&&t.push(new Wi(i,l,o,a,c)),(i=r[0])&&t.push(new Wi(i,s,o,l,c))}return this}function Zht(e){var t=[],n=[],r;for(this._root&&t.push(new Wi(this._root,this._x0,this._y0,this._x1,this._y1));r=t.pop();){var i=r.node;if(i.length){var s,o=r.x0,a=r.y0,u=r.x1,l=r.y1,c=(o+u)/2,f=(a+l)/2;(s=i[0])&&t.push(new Wi(s,o,a,c,f)),(s=i[1])&&t.push(new Wi(s,c,a,u,f)),(s=i[2])&&t.push(new Wi(s,o,f,c,l)),(s=i[3])&&t.push(new Wi(s,c,f,u,l))}n.push(r)}for(;r=n.pop();)e(r.node,r.x0,r.y0,r.x1,r.y1);return this}function Jht(e){return e[0]}function Qht(e){return arguments.length?(this._x=e,this):this._x}function edt(e){return e[1]}function tdt(e){return arguments.length?(this._y=e,this):this._y}function W7(e,t,n){var r=new V7(t??Jht,n??edt,NaN,NaN,NaN,NaN);return e==null?r:r.addAll(e)}function V7(e,t,n,r,i,s){this._x=e,this._y=t,this._x0=n,this._y0=r,this._x1=i,this._y1=s,this._root=void 0}function _Y(e){for(var t={data:e.data},n=t;e=e.next;)n=n.next={data:e.data};return t}var rs=W7.prototype=V7.prototype;rs.copy=function(){var e=new V7(this._x,this._y,this._x0,this._y0,this._x1,this._y1),t=this._root,n,r;if(!t)return e;if(!t.length)return e._root=_Y(t),e;for(n=[{source:t,target:e._root=new Array(4)}];t=n.pop();)for(var i=0;i<4;++i)(r=t.source[i])&&(r.length?n.push({source:r,target:t.target[i]=new Array(4)}):t.target[i]=_Y(r));return e};rs.add=zht;rs.addAll=Uht;rs.cover=jht;rs.data=Wht;rs.extent=Vht;rs.find=Ght;rs.remove=Hht;rs.removeAll=qht;rs.root=Xht;rs.size=Yht;rs.visit=Kht;rs.visitAfter=Zht;rs.x=Qht;rs.y=tdt;function Vi(e){return function(){return e}}function ff(e){return(e()-.5)*1e-6}function ndt(e){return e.x+e.vx}function rdt(e){return e.y+e.vy}function idt(e){var t,n,r,i=1,s=1;typeof e!="function"&&(e=Vi(e==null?1:+e));function o(){for(var l,c=t.length,f,h,d,p,g,m,y=0;y<s;++y)for(f=W7(t,ndt,rdt).visitAfter(a),l=0;l<c;++l)h=t[l],g=n[h.index],m=g*g,d=h.x+h.vx,p=h.y+h.vy,f.visit(b);function b(v,x,w,C,$){var S=v.data,k=v.r,E=g+k;if(S){if(S.index>h.index){var _=d-S.x-S.vx,D=p-S.y-S.vy,A=_*_+D*D;A<E*E&&(_===0&&(_=ff(r),A+=_*_),D===0&&(D=ff(r),A+=D*D),A=(E-(A=Math.sqrt(A)))/A*i,h.vx+=(_*=A)*(E=(k*=k)/(m+k)),h.vy+=(D*=A)*E,S.vx-=_*(E=1-E),S.vy-=D*E)}return}return x>d+E||C<d-E||w>p+E||$<p-E}}function a(l){if(l.data)return l.r=n[l.data.index];for(var c=l.r=0;c<4;++c)l[c]&&l[c].r>l.r&&(l.r=l[c].r)}function u(){if(t){var l,c=t.length,f;for(n=new Array(c),l=0;l<c;++l)f=t[l],n[f.index]=+e(f,l,t)}}return o.initialize=function(l,c){t=l,r=c,u()},o.iterations=function(l){return arguments.length?(s=+l,o):s},o.strength=function(l){return arguments.length?(i=+l,o):i},o.radius=function(l){return arguments.length?(e=typeof l=="function"?l:Vi(+l),u(),o):e},o}function sdt(e){return e.index}function AY(e,t){var n=e.get(t);if(!n)throw new Error("node not found: "+t);return n}function odt(e){var t=sdt,n=f,r,i=Vi(30),s,o,a,u,l,c=1;e==null&&(e=[]);function f(m){return 1/Math.min(a[m.source.index],a[m.target.index])}function h(m){for(var y=0,b=e.length;y<c;++y)for(var v=0,x,w,C,$,S,k,E;v<b;++v)x=e[v],w=x.source,C=x.target,$=C.x+C.vx-w.x-w.vx||ff(l),S=C.y+C.vy-w.y-w.vy||ff(l),k=Math.sqrt($*$+S*S),k=(k-s[v])/k*m*r[v],$*=k,S*=k,C.vx-=$*(E=u[v]),C.vy-=S*E,w.vx+=$*(E=1-E),w.vy+=S*E}function d(){if(o){var m,y=o.length,b=e.length,v=new Map(o.map((w,C)=>[t(w,C,o),w])),x;for(m=0,a=new Array(y);m<b;++m)x=e[m],x.index=m,typeof x.source!="object"&&(x.source=AY(v,x.source)),typeof x.target!="object"&&(x.target=AY(v,x.target)),a[x.source.index]=(a[x.source.index]||0)+1,a[x.target.index]=(a[x.target.index]||0)+1;for(m=0,u=new Array(b);m<b;++m)x=e[m],u[m]=a[x.source.index]/(a[x.source.index]+a[x.target.index]);r=new Array(b),p(),s=new Array(b),g()}}function p(){if(o)for(var m=0,y=e.length;m<y;++m)r[m]=+n(e[m],m,e)}function g(){if(o)for(var m=0,y=e.length;m<y;++m)s[m]=+i(e[m],m,e)}return h.initialize=function(m,y){o=m,l=y,d()},h.links=function(m){return arguments.length?(e=m,d(),h):e},h.id=function(m){return arguments.length?(t=m,h):t},h.iterations=function(m){return arguments.length?(c=+m,h):c},h.strength=function(m){return arguments.length?(n=typeof m=="function"?m:Vi(+m),p(),h):n},h.distance=function(m){return arguments.length?(i=typeof m=="function"?m:Vi(+m),g(),h):i},h}var adt={value:()=>{}};function uge(){for(var e=0,t=arguments.length,n={},r;e<t;++e){if(!(r=arguments[e]+"")||r in n||/[\s.]/.test(r))throw new Error("illegal type: "+r);n[r]=[]}return new rk(n)}function rk(e){this._=e}function udt(e,t){return e.trim().split(/^|\s+/).map(function(n){var r="",i=n.indexOf(".");if(i>=0&&(r=n.slice(i+1),n=n.slice(0,i)),n&&!t.hasOwnProperty(n))throw new Error("unknown type: "+n);return{type:n,name:r}})}rk.prototype=uge.prototype={constructor:rk,on:function(e,t){var n=this._,r=udt(e+"",n),i,s=-1,o=r.length;if(arguments.length<2){for(;++s<o;)if((i=(e=r[s]).type)&&(i=ldt(n[i],e.name)))return i;return}if(t!=null&&typeof t!="function")throw new Error("invalid callback: "+t);for(;++s<o;)if(i=(e=r[s]).type)n[i]=TY(n[i],e.name,t);else if(t==null)for(i in n)n[i]=TY(n[i],e.name,null);return this},copy:function(){var e={},t=this._;for(var n in t)e[n]=t[n].slice();return new rk(e)},call:function(e,t){if((i=arguments.length-2)>0)for(var n=new Array(i),r=0,i,s;r<i;++r)n[r]=arguments[r+2];if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(s=this._[e],r=0,i=s.length;r<i;++r)s[r].value.apply(t,n)},apply:function(e,t,n){if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(var r=this._[e],i=0,s=r.length;i<s;++i)r[i].value.apply(t,n)}};function ldt(e,t){for(var n=0,r=e.length,i;n<r;++n)if((i=e[n]).name===t)return i.value}function TY(e,t,n){for(var r=0,i=e.length;r<i;++r)if(e[r].name===t){e[r]=adt,e=e.slice(0,r).concat(e.slice(r+1));break}return n!=null&&e.push({name:t,value:n}),e}var S0=0,Yb=0,cb=0,lge=1e3,y_,Kb,b_=0,Pp=0,tN=0,Bv=typeof performance=="object"&&performance.now?performance:Date,cge=typeof window=="object"&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(e){setTimeout(e,17)};function G7(){return Pp||(cge(cdt),Pp=Bv.now()+tN)}function cdt(){Pp=0}function x_(){this._call=this._time=this._next=null}x_.prototype=fge.prototype={constructor:x_,restart:function(e,t,n){if(typeof e!="function")throw new TypeError("callback is not a function");n=(n==null?G7():+n)+(t==null?0:+t),!this._next&&Kb!==this&&(Kb?Kb._next=this:y_=this,Kb=this),this._call=e,this._time=n,J4()},stop:function(){this._call&&(this._call=null,this._time=1/0,J4())}};function fge(e,t,n){var r=new x_;return r.restart(e,t,n),r}function fdt(){G7(),++S0;for(var e=y_,t;e;)(t=Pp-e._time)>=0&&e._call.call(null,t),e=e._next;--S0}function IY(){Pp=(b_=Bv.now())+tN,S0=Yb=0;try{fdt()}finally{S0=0,ddt(),Pp=0}}function hdt(){var e=Bv.now(),t=e-b_;t>lge&&(tN-=t,b_=e)}function ddt(){for(var e,t=y_,n,r=1/0;t;)t._call?(r>t._time&&(r=t._time),e=t,t=t._next):(n=t._next,t._next=null,t=e?e._next=n:y_=n);Kb=e,J4(r)}function J4(e){if(!S0){Yb&&(Yb=clearTimeout(Yb));var t=e-Pp;t>24?(e<1/0&&(Yb=setTimeout(IY,e-Bv.now()-tN)),cb&&(cb=clearInterval(cb))):(cb||(b_=Bv.now(),cb=setInterval(hdt,lge)),S0=1,cge(IY))}}function pdt(e,t,n){var r=new x_,i=t;return t==null?(r.restart(e,t,n),r):(r._restart=r.restart,r.restart=function(s,o,a){o=+o,a=a==null?G7():+a,r._restart(function u(l){l+=i,r._restart(u,i+=o,a),s(l)},o,a)},r.restart(e,t,n),r)}const gdt=1664525,mdt=1013904223,DY=4294967296;function ydt(){let e=1;return()=>(e=(gdt*e+mdt)%DY)/DY}function bdt(e){return e.x}function xdt(e){return e.y}var vdt=10,wdt=Math.PI*(3-Math.sqrt(5));function $dt(e){var t,n=1,r=.001,i=1-Math.pow(r,1/300),s=0,o=.6,a=new Map,u=fge(f),l=uge("tick","end"),c=ydt();e==null&&(e=[]);function f(){h(),l.call("tick",t),n<r&&(u.stop(),l.call("end",t))}function h(g){var m,y=e.length,b;g===void 0&&(g=1);for(var v=0;v<g;++v)for(n+=(s-n)*i,a.forEach(function(x){x(n)}),m=0;m<y;++m)b=e[m],b.fx==null?b.x+=b.vx*=o:(b.x=b.fx,b.vx=0),b.fy==null?b.y+=b.vy*=o:(b.y=b.fy,b.vy=0);return t}function d(){for(var g=0,m=e.length,y;g<m;++g){if(y=e[g],y.index=g,y.fx!=null&&(y.x=y.fx),y.fy!=null&&(y.y=y.fy),isNaN(y.x)||isNaN(y.y)){var b=vdt*Math.sqrt(.5+g),v=g*wdt;y.x=b*Math.cos(v),y.y=b*Math.sin(v)}(isNaN(y.vx)||isNaN(y.vy))&&(y.vx=y.vy=0)}}function p(g){return g.initialize&&g.initialize(e,c),g}return d(),t={tick:h,restart:function(){return u.restart(f),t},stop:function(){return u.stop(),t},nodes:function(g){return arguments.length?(e=g,d(),a.forEach(p),t):e},alpha:function(g){return arguments.length?(n=+g,t):n},alphaMin:function(g){return arguments.length?(r=+g,t):r},alphaDecay:function(g){return arguments.length?(i=+g,t):+i},alphaTarget:function(g){return arguments.length?(s=+g,t):s},velocityDecay:function(g){return arguments.length?(o=1-g,t):1-o},randomSource:function(g){return arguments.length?(c=g,a.forEach(p),t):c},force:function(g,m){return arguments.length>1?(m==null?a.delete(g):a.set(g,p(m)),t):a.get(g)},find:function(g,m,y){var b=0,v=e.length,x,w,C,$,S;for(y==null?y=1/0:y*=y,b=0;b<v;++b)$=e[b],x=g-$.x,w=m-$.y,C=x*x+w*w,C<y&&(S=$,y=C);return S},on:function(g,m){return arguments.length>1?(l.on(g,m),t):l.on(g)}}}function Cdt(){var e,t,n,r,i=Vi(-30),s,o=1,a=1/0,u=.81;function l(d){var p,g=e.length,m=W7(e,bdt,xdt).visitAfter(f);for(r=d,p=0;p<g;++p)t=e[p],m.visit(h)}function c(){if(e){var d,p=e.length,g;for(s=new Array(p),d=0;d<p;++d)g=e[d],s[g.index]=+i(g,d,e)}}function f(d){var p=0,g,m,y=0,b,v,x;if(d.length){for(b=v=x=0;x<4;++x)(g=d[x])&&(m=Math.abs(g.value))&&(p+=g.value,y+=m,b+=m*g.x,v+=m*g.y);d.x=b/y,d.y=v/y}else{g=d,g.x=g.data.x,g.y=g.data.y;do p+=s[g.data.index];while(g=g.next)}d.value=p}function h(d,p,g,m){if(!d.value)return!0;var y=d.x-t.x,b=d.y-t.y,v=m-p,x=y*y+b*b;if(v*v/u<x)return x<a&&(y===0&&(y=ff(n),x+=y*y),b===0&&(b=ff(n),x+=b*b),x<o&&(x=Math.sqrt(o*x)),t.vx+=y*d.value*r/x,t.vy+=b*d.value*r/x),!0;if(d.length||x>=a)return;(d.data!==t||d.next)&&(y===0&&(y=ff(n),x+=y*y),b===0&&(b=ff(n),x+=b*b),x<o&&(x=Math.sqrt(o*x)));do d.data!==t&&(v=s[d.data.index]*r/x,t.vx+=y*v,t.vy+=b*v);while(d=d.next)}return l.initialize=function(d,p){e=d,n=p,c()},l.strength=function(d){return arguments.length?(i=typeof d=="function"?d:Vi(+d),c(),l):i},l.distanceMin=function(d){return arguments.length?(o=d*d,l):Math.sqrt(o)},l.distanceMax=function(d){return arguments.length?(a=d*d,l):Math.sqrt(a)},l.theta=function(d){return arguments.length?(u=d*d,l):Math.sqrt(u)},l}function Sdt(e){var t=Vi(.1),n,r,i;typeof e!="function"&&(e=Vi(e==null?0:+e));function s(a){for(var u=0,l=n.length,c;u<l;++u)c=n[u],c.vx+=(i[u]-c.x)*r[u]*a}function o(){if(n){var a,u=n.length;for(r=new Array(u),i=new Array(u),a=0;a<u;++a)r[a]=isNaN(i[a]=+e(n[a],a,n))?0:+t(n[a],a,n)}}return s.initialize=function(a){n=a,o()},s.strength=function(a){return arguments.length?(t=typeof a=="function"?a:Vi(+a),o(),s):t},s.x=function(a){return arguments.length?(e=typeof a=="function"?a:Vi(+a),o(),s):e},s}function kdt(e){var t=Vi(.1),n,r,i;typeof e!="function"&&(e=Vi(e==null?0:+e));function s(a){for(var u=0,l=n.length,c;u<l;++u)c=n[u],c.vy+=(i[u]-c.y)*r[u]*a}function o(){if(n){var a,u=n.length;for(r=new Array(u),i=new Array(u),a=0;a<u;++a)r[a]=isNaN(i[a]=+e(n[a],a,n))?0:+t(n[a],a,n)}}return s.initialize=function(a){n=a,o()},s.strength=function(a){return arguments.length?(t=typeof a=="function"?a:Vi(+a),o(),s):t},s.y=function(a){return arguments.length?(e=typeof a=="function"?a:Vi(+a),o(),s):e},s}const NY={center:Bht,collide:idt,nbody:Cdt,link:odt,x:Sdt,y:kdt},Zb="forces",Q4=["alpha","alphaMin","alphaTarget","velocityDecay","forces"],Edt=["static","iterations"],hge=["x","y","vx","vy"];function H7(e){re.call(this,null,e)}H7.Definition={type:"Force",metadata:{modifies:!0},params:[{name:"static",type:"boolean",default:!1},{name:"restart",type:"boolean",default:!1},{name:"iterations",type:"number",default:300},{name:"alpha",type:"number",default:1},{name:"alphaMin",type:"number",default:.001},{name:"alphaTarget",type:"number",default:0},{name:"velocityDecay",type:"number",default:.4},{name:"forces",type:"param",array:!0,params:[{key:{force:"center"},params:[{name:"x",type:"number",default:0},{name:"y",type:"number",default:0}]},{key:{force:"collide"},params:[{name:"radius",type:"number",expr:!0},{name:"strength",type:"number",default:.7},{name:"iterations",type:"number",default:1}]},{key:{force:"nbody"},params:[{name:"strength",type:"number",default:-30},{name:"theta",type:"number",default:.9},{name:"distanceMin",type:"number",default:1},{name:"distanceMax",type:"number"}]},{key:{force:"link"},params:[{name:"links",type:"data"},{name:"id",type:"field"},{name:"distance",type:"number",default:30,expr:!0},{name:"strength",type:"number",expr:!0},{name:"iterations",type:"number",default:1}]},{key:{force:"x"},params:[{name:"strength",type:"number",default:.1},{name:"x",type:"field"}]},{key:{force:"y"},params:[{name:"strength",type:"number",default:.1},{name:"y",type:"field"}]}]},{name:"as",type:"string",array:!0,modify:!1,default:hge}]};$e(H7,re,{transform(e,t){var n=this.value,r=t.changed(t.ADD_REM),i=e.modified(Q4),s=e.iterations||300;if(n?(r&&(t.modifies("index"),n.nodes(t.source)),(i||t.changed(t.MOD))&&dge(n,e,0,t)):(this.value=n=Adt(t.source,e),n.on("tick",_dt(t.dataflow,this)),e.static||(r=!0,n.tick()),t.modifies("index")),i||r||e.modified(Edt)||t.changed()&&e.restart){if(n.alpha(Math.max(n.alpha(),e.alpha||1)).alphaDecay(1-Math.pow(n.alphaMin(),1/s)),e.static)for(n.stop();--s>=0;)n.tick();else if(n.stopped()&&n.restart(),!r)return t.StopPropagation}return this.finish(e,t)},finish(e,t){const n=t.dataflow;for(let a=this._argops,u=0,l=a.length,c;u<l;++u)if(c=a[u],!(c.name!==Zb||c.op._argval.force!=="link")){for(var r=c.op._argops,i=0,s=r.length,o;i<s;++i)if(r[i].name==="links"&&(o=r[i].op.source)){n.pulse(o,n.changeset().reflow());break}}return t.reflow(e.modified()).modifies(hge)}});function _dt(e,t){return()=>e.touch(t).run()}function Adt(e,t){const n=$dt(e),r=n.stop,i=n.restart;let s=!1;return n.stopped=()=>s,n.restart=()=>(s=!1,i()),n.stop=()=>(s=!0,r()),dge(n,t,!0).on("end",()=>s=!0)}function dge(e,t,n,r){var i=et(t.forces),s,o,a,u;for(s=0,o=Q4.length;s<o;++s)a=Q4[s],a!==Zb&&t.modified(a)&&e[a](t[a]);for(s=0,o=i.length;s<o;++s)u=Zb+s,a=n||t.modified(Zb,s)?Idt(i[s]):r&&Tdt(i[s],r)?e.force(u):null,a&&e.force(u,a);for(o=e.numForces||0;s<o;++s)e.force(Zb+s,null);return e.numForces=i.length,e}function Tdt(e,t){var n,r;for(n in e)if(zt(r=e[n])&&t.modified(wi(r)))return 1;return 0}function Idt(e){var t,n;nt(NY,e.force)||le("Unrecognized force: "+e.force),t=NY[e.force]();for(n in e)zt(t[n])&&Ddt(t[n],e[n],e);return t}function Ddt(e,t,n){e(zt(t)?r=>t(r,n):t)}const Ndt=Object.freeze(Object.defineProperty({__proto__:null,force:H7},Symbol.toStringTag,{value:"Module"}));function Fdt(e,t){return e.parent===t.parent?1:2}function Odt(e){return e.reduce(Rdt,0)/e.length}function Rdt(e,t){return e+t.x}function Mdt(e){return 1+e.reduce(Ldt,0)}function Ldt(e,t){return Math.max(e,t.y)}function Pdt(e){for(var t;t=e.children;)e=t[0];return e}function Bdt(e){for(var t;t=e.children;)e=t[t.length-1];return e}function zdt(){var e=Fdt,t=1,n=1,r=!1;function i(s){var o,a=0;s.eachAfter(function(h){var d=h.children;d?(h.x=Odt(d),h.y=Mdt(d)):(h.x=o?a+=e(h,o):0,h.y=0,o=h)});var u=Pdt(s),l=Bdt(s),c=u.x-e(u,l)/2,f=l.x+e(l,u)/2;return s.eachAfter(r?function(h){h.x=(h.x-s.x)*t,h.y=(s.y-h.y)*n}:function(h){h.x=(h.x-c)/(f-c)*t,h.y=(1-(s.y?h.y/s.y:1))*n})}return i.separation=function(s){return arguments.length?(e=s,i):e},i.size=function(s){return arguments.length?(r=!1,t=+s[0],n=+s[1],i):r?null:[t,n]},i.nodeSize=function(s){return arguments.length?(r=!0,t=+s[0],n=+s[1],i):r?[t,n]:null},i}function Udt(e){var t=0,n=e.children,r=n&&n.length;if(!r)t=1;else for(;--r>=0;)t+=n[r].value;e.value=t}function jdt(){return this.eachAfter(Udt)}function Wdt(e,t){let n=-1;for(const r of this)e.call(t,r,++n,this);return this}function Vdt(e,t){for(var n=this,r=[n],i,s,o=-1;n=r.pop();)if(e.call(t,n,++o,this),i=n.children)for(s=i.length-1;s>=0;--s)r.push(i[s]);return this}function Gdt(e,t){for(var n=this,r=[n],i=[],s,o,a,u=-1;n=r.pop();)if(i.push(n),s=n.children)for(o=0,a=s.length;o<a;++o)r.push(s[o]);for(;n=i.pop();)e.call(t,n,++u,this);return this}function Hdt(e,t){let n=-1;for(const r of this)if(e.call(t,r,++n,this))return r}function qdt(e){return this.eachAfter(function(t){for(var n=+e(t.data)||0,r=t.children,i=r&&r.length;--i>=0;)n+=r[i].value;t.value=n})}function Xdt(e){return this.eachBefore(function(t){t.children&&t.children.sort(e)})}function Ydt(e){for(var t=this,n=Kdt(t,e),r=[t];t!==n;)t=t.parent,r.push(t);for(var i=r.length;e!==n;)r.splice(i,0,e),e=e.parent;return r}function Kdt(e,t){if(e===t)return e;var n=e.ancestors(),r=t.ancestors(),i=null;for(e=n.pop(),t=r.pop();e===t;)i=e,e=n.pop(),t=r.pop();return i}function Zdt(){for(var e=this,t=[e];e=e.parent;)t.push(e);return t}function Jdt(){return Array.from(this)}function Qdt(){var e=[];return this.eachBefore(function(t){t.children||e.push(t)}),e}function ept(){var e=this,t=[];return e.each(function(n){n!==e&&t.push({source:n.parent,target:n})}),t}function*tpt(){var e=this,t,n=[e],r,i,s;do for(t=n.reverse(),n=[];e=t.pop();)if(yield e,r=e.children)for(i=0,s=r.length;i<s;++i)n.push(r[i]);while(n.length)}function q7(e,t){e instanceof Map?(e=[void 0,e],t===void 0&&(t=ipt)):t===void 0&&(t=rpt);for(var n=new k0(e),r,i=[n],s,o,a,u;r=i.pop();)if((o=t(r.data))&&(u=(o=Array.from(o)).length))for(r.children=o,a=u-1;a>=0;--a)i.push(s=o[a]=new k0(o[a])),s.parent=r,s.depth=r.depth+1;return n.eachBefore(pge)}function npt(){return q7(this).eachBefore(spt)}function rpt(e){return e.children}function ipt(e){return Array.isArray(e)?e[1]:null}function spt(e){e.data.value!==void 0&&(e.value=e.data.value),e.data=e.data.data}function pge(e){var t=0;do e.height=t;while((e=e.parent)&&e.height<++t)}function k0(e){this.data=e,this.depth=this.height=0,this.parent=null}k0.prototype=q7.prototype={constructor:k0,count:jdt,each:Wdt,eachAfter:Gdt,eachBefore:Vdt,find:Hdt,sum:qdt,sort:Xdt,path:Ydt,ancestors:Zdt,descendants:Jdt,leaves:Qdt,links:ept,copy:npt,[Symbol.iterator]:tpt};function opt(e){return typeof e=="object"&&"length"in e?e:Array.from(e)}function apt(e){for(var t=e.length,n,r;t;)r=Math.random()*t--|0,n=e[t],e[t]=e[r],e[r]=n;return e}function upt(e){for(var t=0,n=(e=apt(Array.from(e))).length,r=[],i,s;t<n;)i=e[t],s&&gge(s,i)?++t:(s=cpt(r=lpt(r,i)),t=0);return s}function lpt(e,t){var n,r;if(mO(t,e))return[t];for(n=0;n<e.length;++n)if(hS(t,e[n])&&mO(Jb(e[n],t),e))return[e[n],t];for(n=0;n<e.length-1;++n)for(r=n+1;r<e.length;++r)if(hS(Jb(e[n],e[r]),t)&&hS(Jb(e[n],t),e[r])&&hS(Jb(e[r],t),e[n])&&mO(mge(e[n],e[r],t),e))return[e[n],e[r],t];throw new Error}function hS(e,t){var n=e.r-t.r,r=t.x-e.x,i=t.y-e.y;return n<0||n*n<r*r+i*i}function gge(e,t){var n=e.r-t.r+Math.max(e.r,t.r,1)*1e-9,r=t.x-e.x,i=t.y-e.y;return n>0&&n*n>r*r+i*i}function mO(e,t){for(var n=0;n<t.length;++n)if(!gge(e,t[n]))return!1;return!0}function cpt(e){switch(e.length){case 1:return fpt(e[0]);case 2:return Jb(e[0],e[1]);case 3:return mge(e[0],e[1],e[2])}}function fpt(e){return{x:e.x,y:e.y,r:e.r}}function Jb(e,t){var n=e.x,r=e.y,i=e.r,s=t.x,o=t.y,a=t.r,u=s-n,l=o-r,c=a-i,f=Math.sqrt(u*u+l*l);return{x:(n+s+u/f*c)/2,y:(r+o+l/f*c)/2,r:(f+i+a)/2}}function mge(e,t,n){var r=e.x,i=e.y,s=e.r,o=t.x,a=t.y,u=t.r,l=n.x,c=n.y,f=n.r,h=r-o,d=r-l,p=i-a,g=i-c,m=u-s,y=f-s,b=r*r+i*i-s*s,v=b-o*o-a*a+u*u,x=b-l*l-c*c+f*f,w=d*p-h*g,C=(p*x-g*v)/(w*2)-r,$=(g*m-p*y)/w,S=(d*v-h*x)/(w*2)-i,k=(h*y-d*m)/w,E=$*$+k*k-1,_=2*(s+C*$+S*k),D=C*C+S*S-s*s,A=-(E?(_+Math.sqrt(_*_-4*E*D))/(2*E):D/_);return{x:r+C+$*A,y:i+S+k*A,r:A}}function FY(e,t,n){var r=e.x-t.x,i,s,o=e.y-t.y,a,u,l=r*r+o*o;l?(s=t.r+n.r,s*=s,u=e.r+n.r,u*=u,s>u?(i=(l+u-s)/(2*l),a=Math.sqrt(Math.max(0,u/l-i*i)),n.x=e.x-i*r-a*o,n.y=e.y-i*o+a*r):(i=(l+s-u)/(2*l),a=Math.sqrt(Math.max(0,s/l-i*i)),n.x=t.x+i*r-a*o,n.y=t.y+i*o+a*r)):(n.x=t.x+n.r,n.y=t.y)}function OY(e,t){var n=e.r+t.r-1e-6,r=t.x-e.x,i=t.y-e.y;return n>0&&n*n>r*r+i*i}function RY(e){var t=e._,n=e.next._,r=t.r+n.r,i=(t.x*n.r+n.x*t.r)/r,s=(t.y*n.r+n.y*t.r)/r;return i*i+s*s}function dS(e){this._=e,this.next=null,this.previous=null}function hpt(e){if(!(i=(e=opt(e)).length))return 0;var t,n,r,i,s,o,a,u,l,c,f;if(t=e[0],t.x=0,t.y=0,!(i>1))return t.r;if(n=e[1],t.x=-n.r,n.x=t.r,n.y=0,!(i>2))return t.r+n.r;FY(n,t,r=e[2]),t=new dS(t),n=new dS(n),r=new dS(r),t.next=r.previous=n,n.next=t.previous=r,r.next=n.previous=t;e:for(a=3;a<i;++a){FY(t._,n._,r=e[a]),r=new dS(r),u=n.next,l=t.previous,c=n._.r,f=t._.r;do if(c<=f){if(OY(u._,r._)){n=u,t.next=n,n.previous=t,--a;continue e}c+=u._.r,u=u.next}else{if(OY(l._,r._)){t=l,t.next=n,n.previous=t,--a;continue e}f+=l._.r,l=l.previous}while(u!==l.next);for(r.previous=t,r.next=n,t.next=n.previous=n=r,s=RY(t);(r=r.next)!==n;)(o=RY(r))<s&&(t=r,s=o);n=t.next}for(t=[n._],r=n;(r=r.next)!==n;)t.push(r._);for(r=upt(t),a=0;a<i;++a)t=e[a],t.x-=r.x,t.y-=r.y;return r.r}function dpt(e){return e==null?null:v_(e)}function v_(e){if(typeof e!="function")throw new Error;return e}function Id(){return 0}function gm(e){return function(){return e}}function ppt(e){return Math.sqrt(e.value)}function gpt(){var e=null,t=1,n=1,r=Id;function i(s){return s.x=t/2,s.y=n/2,e?s.eachBefore(MY(e)).eachAfter(yO(r,.5)).eachBefore(LY(1)):s.eachBefore(MY(ppt)).eachAfter(yO(Id,1)).eachAfter(yO(r,s.r/Math.min(t,n))).eachBefore(LY(Math.min(t,n)/(2*s.r))),s}return i.radius=function(s){return arguments.length?(e=dpt(s),i):e},i.size=function(s){return arguments.length?(t=+s[0],n=+s[1],i):[t,n]},i.padding=function(s){return arguments.length?(r=typeof s=="function"?s:gm(+s),i):r},i}function MY(e){return function(t){t.children||(t.r=Math.max(0,+e(t)||0))}}function yO(e,t){return function(n){if(r=n.children){var r,i,s=r.length,o=e(n)*t||0,a;if(o)for(i=0;i<s;++i)r[i].r+=o;if(a=hpt(r),o)for(i=0;i<s;++i)r[i].r-=o;n.r=a+o}}}function LY(e){return function(t){var n=t.parent;t.r*=e,n&&(t.x=n.x+e*t.x,t.y=n.y+e*t.y)}}function yge(e){e.x0=Math.round(e.x0),e.y0=Math.round(e.y0),e.x1=Math.round(e.x1),e.y1=Math.round(e.y1)}function A$(e,t,n,r,i){for(var s=e.children,o,a=-1,u=s.length,l=e.value&&(r-t)/e.value;++a<u;)o=s[a],o.y0=n,o.y1=i,o.x0=t,o.x1=t+=o.value*l}function mpt(){var e=1,t=1,n=0,r=!1;function i(o){var a=o.height+1;return o.x0=o.y0=n,o.x1=e,o.y1=t/a,o.eachBefore(s(t,a)),r&&o.eachBefore(yge),o}function s(o,a){return function(u){u.children&&A$(u,u.x0,o*(u.depth+1)/a,u.x1,o*(u.depth+2)/a);var l=u.x0,c=u.y0,f=u.x1-n,h=u.y1-n;f<l&&(l=f=(l+f)/2),h<c&&(c=h=(c+h)/2),u.x0=l,u.y0=c,u.x1=f,u.y1=h}}return i.round=function(o){return arguments.length?(r=!!o,i):r},i.size=function(o){return arguments.length?(e=+o[0],t=+o[1],i):[e,t]},i.padding=function(o){return arguments.length?(n=+o,i):n},i}var ypt={depth:-1},PY={};function bpt(e){return e.id}function xpt(e){return e.parentId}function BY(){var e=bpt,t=xpt;function n(r){var i=Array.from(r),s=i.length,o,a,u,l,c,f,h,d=new Map;for(a=0;a<s;++a)o=i[a],c=i[a]=new k0(o),(f=e(o,a,r))!=null&&(f+="")&&(h=c.id=f,d.set(h,d.has(h)?PY:c)),(f=t(o,a,r))!=null&&(f+="")&&(c.parent=f);for(a=0;a<s;++a)if(c=i[a],f=c.parent){if(l=d.get(f),!l)throw new Error("missing: "+f);if(l===PY)throw new Error("ambiguous: "+f);l.children?l.children.push(c):l.children=[c],c.parent=l}else{if(u)throw new Error("multiple roots");u=c}if(!u)throw new Error("no root");if(u.parent=ypt,u.eachBefore(function(p){p.depth=p.parent.depth+1,--s}).eachBefore(pge),u.parent=null,s>0)throw new Error("cycle");return u}return n.id=function(r){return arguments.length?(e=v_(r),n):e},n.parentId=function(r){return arguments.length?(t=v_(r),n):t},n}function vpt(e,t){return e.parent===t.parent?1:2}function bO(e){var t=e.children;return t?t[0]:e.t}function xO(e){var t=e.children;return t?t[t.length-1]:e.t}function wpt(e,t,n){var r=n/(t.i-e.i);t.c-=r,t.s+=n,e.c+=r,t.z+=n,t.m+=n}function $pt(e){for(var t=0,n=0,r=e.children,i=r.length,s;--i>=0;)s=r[i],s.z+=t,s.m+=t,t+=s.s+(n+=s.c)}function Cpt(e,t,n){return e.a.parent===t.parent?e.a:n}function ik(e,t){this._=e,this.parent=null,this.children=null,this.A=null,this.a=this,this.z=0,this.m=0,this.c=0,this.s=0,this.t=null,this.i=t}ik.prototype=Object.create(k0.prototype);function Spt(e){for(var t=new ik(e,0),n,r=[t],i,s,o,a;n=r.pop();)if(s=n._.children)for(n.children=new Array(a=s.length),o=a-1;o>=0;--o)r.push(i=n.children[o]=new ik(s[o],o)),i.parent=n;return(t.parent=new ik(null,0)).children=[t],t}function kpt(){var e=vpt,t=1,n=1,r=null;function i(l){var c=Spt(l);if(c.eachAfter(s),c.parent.m=-c.z,c.eachBefore(o),r)l.eachBefore(u);else{var f=l,h=l,d=l;l.eachBefore(function(b){b.x<f.x&&(f=b),b.x>h.x&&(h=b),b.depth>d.depth&&(d=b)});var p=f===h?1:e(f,h)/2,g=p-f.x,m=t/(h.x+p+g),y=n/(d.depth||1);l.eachBefore(function(b){b.x=(b.x+g)*m,b.y=b.depth*y})}return l}function s(l){var c=l.children,f=l.parent.children,h=l.i?f[l.i-1]:null;if(c){$pt(l);var d=(c[0].z+c[c.length-1].z)/2;h?(l.z=h.z+e(l._,h._),l.m=l.z-d):l.z=d}else h&&(l.z=h.z+e(l._,h._));l.parent.A=a(l,h,l.parent.A||f[0])}function o(l){l._.x=l.z+l.parent.m,l.m+=l.parent.m}function a(l,c,f){if(c){for(var h=l,d=l,p=c,g=h.parent.children[0],m=h.m,y=d.m,b=p.m,v=g.m,x;p=xO(p),h=bO(h),p&&h;)g=bO(g),d=xO(d),d.a=l,x=p.z+b-h.z-m+e(p._,h._),x>0&&(wpt(Cpt(p,l,f),l,x),m+=x,y+=x),b+=p.m,m+=h.m,v+=g.m,y+=d.m;p&&!xO(d)&&(d.t=p,d.m+=b-y),h&&!bO(g)&&(g.t=h,g.m+=m-v,f=l)}return f}function u(l){l.x*=t,l.y=l.depth*n}return i.separation=function(l){return arguments.length?(e=l,i):e},i.size=function(l){return arguments.length?(r=!1,t=+l[0],n=+l[1],i):r?null:[t,n]},i.nodeSize=function(l){return arguments.length?(r=!0,t=+l[0],n=+l[1],i):r?[t,n]:null},i}function nN(e,t,n,r,i){for(var s=e.children,o,a=-1,u=s.length,l=e.value&&(i-n)/e.value;++a<u;)o=s[a],o.x0=t,o.x1=r,o.y0=n,o.y1=n+=o.value*l}var bge=(1+Math.sqrt(5))/2;function xge(e,t,n,r,i,s){for(var o=[],a=t.children,u,l,c=0,f=0,h=a.length,d,p,g=t.value,m,y,b,v,x,w,C;c<h;){d=i-n,p=s-r;do m=a[f++].value;while(!m&&f<h);for(y=b=m,w=Math.max(p/d,d/p)/(g*e),C=m*m*w,x=Math.max(b/C,C/y);f<h;++f){if(m+=l=a[f].value,l<y&&(y=l),l>b&&(b=l),C=m*m*w,v=Math.max(b/C,C/y),v>x){m-=l;break}x=v}o.push(u={value:m,dice:d<p,children:a.slice(c,f)}),u.dice?A$(u,n,r,i,g?r+=p*m/g:s):nN(u,n,r,g?n+=d*m/g:i,s),g-=m,c=f}return o}const vge=function e(t){function n(r,i,s,o,a){xge(t,r,i,s,o,a)}return n.ratio=function(r){return e((r=+r)>1?r:1)},n}(bge);function Ept(){var e=vge,t=!1,n=1,r=1,i=[0],s=Id,o=Id,a=Id,u=Id,l=Id;function c(h){return h.x0=h.y0=0,h.x1=n,h.y1=r,h.eachBefore(f),i=[0],t&&h.eachBefore(yge),h}function f(h){var d=i[h.depth],p=h.x0+d,g=h.y0+d,m=h.x1-d,y=h.y1-d;m<p&&(p=m=(p+m)/2),y<g&&(g=y=(g+y)/2),h.x0=p,h.y0=g,h.x1=m,h.y1=y,h.children&&(d=i[h.depth+1]=s(h)/2,p+=l(h)-d,g+=o(h)-d,m-=a(h)-d,y-=u(h)-d,m<p&&(p=m=(p+m)/2),y<g&&(g=y=(g+y)/2),e(h,p,g,m,y))}return c.round=function(h){return arguments.length?(t=!!h,c):t},c.size=function(h){return arguments.length?(n=+h[0],r=+h[1],c):[n,r]},c.tile=function(h){return arguments.length?(e=v_(h),c):e},c.padding=function(h){return arguments.length?c.paddingInner(h).paddingOuter(h):c.paddingInner()},c.paddingInner=function(h){return arguments.length?(s=typeof h=="function"?h:gm(+h),c):s},c.paddingOuter=function(h){return arguments.length?c.paddingTop(h).paddingRight(h).paddingBottom(h).paddingLeft(h):c.paddingTop()},c.paddingTop=function(h){return arguments.length?(o=typeof h=="function"?h:gm(+h),c):o},c.paddingRight=function(h){return arguments.length?(a=typeof h=="function"?h:gm(+h),c):a},c.paddingBottom=function(h){return arguments.length?(u=typeof h=="function"?h:gm(+h),c):u},c.paddingLeft=function(h){return arguments.length?(l=typeof h=="function"?h:gm(+h),c):l},c}function _pt(e,t,n,r,i){var s=e.children,o,a=s.length,u,l=new Array(a+1);for(l[0]=u=o=0;o<a;++o)l[o+1]=u+=s[o].value;c(0,a,e.value,t,n,r,i);function c(f,h,d,p,g,m,y){if(f>=h-1){var b=s[f];b.x0=p,b.y0=g,b.x1=m,b.y1=y;return}for(var v=l[f],x=d/2+v,w=f+1,C=h-1;w<C;){var $=w+C>>>1;l[$]<x?w=$+1:C=$}x-l[w-1]<l[w]-x&&f+1<w&&--w;var S=l[w]-v,k=d-S;if(m-p>y-g){var E=d?(p*k+m*S)/d:m;c(f,w,S,p,g,E,y),c(w,h,k,E,g,m,y)}else{var _=d?(g*k+y*S)/d:y;c(f,w,S,p,g,m,_),c(w,h,k,p,_,m,y)}}}function Apt(e,t,n,r,i){(e.depth&1?nN:A$)(e,t,n,r,i)}const Tpt=function e(t){function n(r,i,s,o,a){if((u=r._squarify)&&u.ratio===t)for(var u,l,c,f,h=-1,d,p=u.length,g=r.value;++h<p;){for(l=u[h],c=l.children,f=l.value=0,d=c.length;f<d;++f)l.value+=c[f].value;l.dice?A$(l,i,s,o,g?s+=(a-s)*l.value/g:a):nN(l,i,s,g?i+=(o-i)*l.value/g:o,a),g-=l.value}else r._squarify=u=xge(t,r,i,s,o,a),u.ratio=t}return n.ratio=function(r){return e((r=+r)>1?r:1)},n}(bge);function eL(e,t,n){const r={};return e.each(i=>{const s=i.data;n(s)&&(r[t(s)]=i)}),e.lookup=r,e}function X7(e){re.call(this,null,e)}X7.Definition={type:"Nest",metadata:{treesource:!0,changes:!0},params:[{name:"keys",type:"field",array:!0},{name:"generate",type:"boolean"}]};const Ipt=e=>e.values;$e(X7,re,{transform(e,t){t.source||le("Nest transform requires an upstream data source.");var n=e.generate,r=e.modified(),i=t.clone(),s=this.value;return(!s||r||t.changed())&&(s&&s.each(o=>{o.children&&eD(o.data)&&i.rem.push(o.data)}),this.value=s=q7({values:et(e.keys).reduce((o,a)=>(o.key(a),o),Dpt()).entries(i.source)},Ipt),n&&s.each(o=>{o.children&&(o=Ot(o.data),i.add.push(o),i.source.push(o))}),eL(s,Pe,Pe)),i.source.root=s,i}});function Dpt(){const e=[],t={entries:i=>r(n(i,0),0),key:i=>(e.push(i),t)};function n(i,s){if(s>=e.length)return i;const o=i.length,a=e[s++],u={},l={};let c=-1,f,h,d;for(;++c<o;)f=a(h=i[c])+"",(d=u[f])?d.push(h):u[f]=[h];for(f in u)l[f]=n(u[f],s);return l}function r(i,s){if(++s>e.length)return i;const o=[];for(const a in i)o.push({key:a,values:r(i[a],s)});return o}return t}function Tc(e){re.call(this,null,e)}const Npt=(e,t)=>e.parent===t.parent?1:2;$e(Tc,re,{transform(e,t){(!t.source||!t.source.root)&&le(this.constructor.name+" transform requires a backing tree data source.");const n=this.layout(e.method),r=this.fields,i=t.source.root,s=e.as||r;e.field?i.sum(e.field):i.count(),e.sort&&i.sort(bg(e.sort,o=>o.data)),Fpt(n,this.params,e),n.separation&&n.separation(e.separation!==!1?Npt:ty);try{this.value=n(i)}catch(o){le(o)}return i.each(o=>Opt(o,r,s)),t.reflow(e.modified()).modifies(s).modifies("leaf")}});function Fpt(e,t,n){for(let r,i=0,s=t.length;i<s;++i)r=t[i],r in n&&e[r](n[r])}function Opt(e,t,n){const r=e.data,i=t.length-1;for(let s=0;s<i;++s)r[n[s]]=e[t[s]];r[n[i]]=e.children?e.children.length:0}const tL=["x","y","r","depth","children"];function Y7(e){Tc.call(this,e)}Y7.Definition={type:"Pack",metadata:{tree:!0,modifies:!0},params:[{name:"field",type:"field"},{name:"sort",type:"compare"},{name:"padding",type:"number",default:0},{name:"radius",type:"field",default:null},{name:"size",type:"number",array:!0,length:2},{name:"as",type:"string",array:!0,length:tL.length,default:tL}]};$e(Y7,Tc,{layout:gpt,params:["radius","size","padding"],fields:tL});const nL=["x0","y0","x1","y1","depth","children"];function K7(e){Tc.call(this,e)}K7.Definition={type:"Partition",metadata:{tree:!0,modifies:!0},params:[{name:"field",type:"field"},{name:"sort",type:"compare"},{name:"padding",type:"number",default:0},{name:"round",type:"boolean",default:!1},{name:"size",type:"number",array:!0,length:2},{name:"as",type:"string",array:!0,length:nL.length,default:nL}]};$e(K7,Tc,{layout:mpt,params:["size","round","padding"],fields:nL});function Z7(e){re.call(this,null,e)}Z7.Definition={type:"Stratify",metadata:{treesource:!0},params:[{name:"key",type:"field",required:!0},{name:"parentKey",type:"field",required:!0}]};$e(Z7,re,{transform(e,t){t.source||le("Stratify transform requires an upstream data source.");let n=this.value;const r=e.modified(),i=t.fork(t.ALL).materialize(t.SOURCE),s=!n||r||t.changed(t.ADD_REM)||t.modified(e.key.fields)||t.modified(e.parentKey.fields);return i.source=i.source.slice(),s&&(n=i.source.length?eL(BY().id(e.key).parentId(e.parentKey)(i.source),e.key,ny):eL(BY()([{}]),e.key,e.key)),i.source.root=this.value=n,i}});const zY={tidy:kpt,cluster:zdt},rL=["x","y","depth","children"];function J7(e){Tc.call(this,e)}J7.Definition={type:"Tree",metadata:{tree:!0,modifies:!0},params:[{name:"field",type:"field"},{name:"sort",type:"compare"},{name:"method",type:"enum",default:"tidy",values:["tidy","cluster"]},{name:"size",type:"number",array:!0,length:2},{name:"nodeSize",type:"number",array:!0,length:2},{name:"separation",type:"boolean",default:!0},{name:"as",type:"string",array:!0,length:rL.length,default:rL}]};$e(J7,Tc,{layout(e){const t=e||"tidy";if(nt(zY,t))return zY[t]();le("Unrecognized Tree layout method: "+t)},params:["size","nodeSize"],fields:rL});function Q7(e){re.call(this,[],e)}Q7.Definition={type:"TreeLinks",metadata:{tree:!0,generates:!0,changes:!0},params:[]};$e(Q7,re,{transform(e,t){const n=this.value,r=t.source&&t.source.root,i=t.fork(t.NO_SOURCE),s={};return r||le("TreeLinks transform requires a tree data source."),t.changed(t.ADD_REM)?(i.rem=n,t.visit(t.SOURCE,o=>s[Pe(o)]=1),r.each(o=>{const a=o.data,u=o.parent&&o.parent.data;u&&s[Pe(a)]&&s[Pe(u)]&&i.add.push(Ot({source:u,target:a}))}),this.value=i.add):t.changed(t.MOD)&&(t.visit(t.MOD,o=>s[Pe(o)]=1),n.forEach(o=>{(s[Pe(o.source)]||s[Pe(o.target)])&&i.mod.push(o)})),i}});const UY={binary:_pt,dice:A$,slice:nN,slicedice:Apt,squarify:vge,resquarify:Tpt},iL=["x0","y0","x1","y1","depth","children"];function e9(e){Tc.call(this,e)}e9.Definition={type:"Treemap",metadata:{tree:!0,modifies:!0},params:[{name:"field",type:"field"},{name:"sort",type:"compare"},{name:"method",type:"enum",default:"squarify",values:["squarify","resquarify","binary","dice","slice","slicedice"]},{name:"padding",type:"number",default:0},{name:"paddingInner",type:"number",default:0},{name:"paddingOuter",type:"number",default:0},{name:"paddingTop",type:"number",default:0},{name:"paddingRight",type:"number",default:0},{name:"paddingBottom",type:"number",default:0},{name:"paddingLeft",type:"number",default:0},{name:"ratio",type:"number",default:1.618033988749895},{name:"round",type:"boolean",default:!1},{name:"size",type:"number",array:!0,length:2},{name:"as",type:"string",array:!0,length:iL.length,default:iL}]};$e(e9,Tc,{layout(){const e=Ept();return e.ratio=t=>{const n=e.tile();n.ratio&&e.tile(n.ratio(t))},e.method=t=>{nt(UY,t)?e.tile(UY[t]):le("Unrecognized Treemap layout method: "+t)},e},params:["method","ratio","size","round","padding","paddingInner","paddingOuter","paddingTop","paddingRight","paddingBottom","paddingLeft"],fields:iL});const Rpt=Object.freeze(Object.defineProperty({__proto__:null,nest:X7,pack:Y7,partition:K7,stratify:Z7,tree:J7,treelinks:Q7,treemap:e9},Symbol.toStringTag,{value:"Module"})),sL=Math.PI,oL=2*sL,wd=1e-6,Mpt=oL-wd;function aL(){this._x0=this._y0=this._x1=this._y1=null,this._=""}function Ag(){return new aL}aL.prototype=Ag.prototype={constructor:aL,moveTo:function(e,t){this._+="M"+(this._x0=this._x1=+e)+","+(this._y0=this._y1=+t)},closePath:function(){this._x1!==null&&(this._x1=this._x0,this._y1=this._y0,this._+="Z")},lineTo:function(e,t){this._+="L"+(this._x1=+e)+","+(this._y1=+t)},quadraticCurveTo:function(e,t,n,r){this._+="Q"+ +e+","+ +t+","+(this._x1=+n)+","+(this._y1=+r)},bezierCurveTo:function(e,t,n,r,i,s){this._+="C"+ +e+","+ +t+","+ +n+","+ +r+","+(this._x1=+i)+","+(this._y1=+s)},arcTo:function(e,t,n,r,i){e=+e,t=+t,n=+n,r=+r,i=+i;var s=this._x1,o=this._y1,a=n-e,u=r-t,l=s-e,c=o-t,f=l*l+c*c;if(i<0)throw new Error("negative radius: "+i);if(this._x1===null)this._+="M"+(this._x1=e)+","+(this._y1=t);else if(f>wd)if(!(Math.abs(c*a-u*l)>wd)||!i)this._+="L"+(this._x1=e)+","+(this._y1=t);else{var h=n-s,d=r-o,p=a*a+u*u,g=h*h+d*d,m=Math.sqrt(p),y=Math.sqrt(f),b=i*Math.tan((sL-Math.acos((p+f-g)/(2*m*y)))/2),v=b/y,x=b/m;Math.abs(v-1)>wd&&(this._+="L"+(e+v*l)+","+(t+v*c)),this._+="A"+i+","+i+",0,0,"+ +(c*h>l*d)+","+(this._x1=e+x*a)+","+(this._y1=t+x*u)}},arc:function(e,t,n,r,i,s){e=+e,t=+t,n=+n,s=!!s;var o=n*Math.cos(r),a=n*Math.sin(r),u=e+o,l=t+a,c=1^s,f=s?r-i:i-r;if(n<0)throw new Error("negative radius: "+n);this._x1===null?this._+="M"+u+","+l:(Math.abs(this._x1-u)>wd||Math.abs(this._y1-l)>wd)&&(this._+="L"+u+","+l),n&&(f<0&&(f=f%oL+oL),f>Mpt?this._+="A"+n+","+n+",0,1,"+c+","+(e-o)+","+(t-a)+"A"+n+","+n+",0,1,"+c+","+(this._x1=u)+","+(this._y1=l):f>wd&&(this._+="A"+n+","+n+",0,"+ +(f>=sL)+","+c+","+(this._x1=e+n*Math.cos(i))+","+(this._y1=t+n*Math.sin(i))))},rect:function(e,t,n,r){this._+="M"+(this._x0=this._x1=+e)+","+(this._y0=this._y1=+t)+"h"+ +n+"v"+ +r+"h"+-n+"Z"},toString:function(){return this._}};function Lt(e){return function(){return e}}var jY=Math.abs,ni=Math.atan2,id=Math.cos,Lpt=Math.max,vO=Math.min,eu=Math.sin,wm=Math.sqrt,si=1e-12,E0=Math.PI,w_=E0/2,wge=2*E0;function Ppt(e){return e>1?0:e<-1?E0:Math.acos(e)}function WY(e){return e>=1?w_:e<=-1?-w_:Math.asin(e)}function Bpt(e){return e.innerRadius}function zpt(e){return e.outerRadius}function Upt(e){return e.startAngle}function jpt(e){return e.endAngle}function Wpt(e){return e&&e.padAngle}function Vpt(e,t,n,r,i,s,o,a){var u=n-e,l=r-t,c=o-i,f=a-s,h=f*u-c*l;if(!(h*h<si))return h=(c*(t-s)-f*(e-i))/h,[e+h*u,t+h*l]}function pS(e,t,n,r,i,s,o){var a=e-n,u=t-r,l=(o?s:-s)/wm(a*a+u*u),c=l*u,f=-l*a,h=e+c,d=t+f,p=n+c,g=r+f,m=(h+p)/2,y=(d+g)/2,b=p-h,v=g-d,x=b*b+v*v,w=i-s,C=h*g-p*d,$=(v<0?-1:1)*wm(Lpt(0,w*w*x-C*C)),S=(C*v-b*$)/x,k=(-C*b-v*$)/x,E=(C*v+b*$)/x,_=(-C*b+v*$)/x,D=S-m,A=k-y,T=E-m,I=_-y;return D*D+A*A>T*T+I*I&&(S=E,k=_),{cx:S,cy:k,x01:-c,y01:-f,x11:S*(i/w-1),y11:k*(i/w-1)}}function Gpt(){var e=Bpt,t=zpt,n=Lt(0),r=null,i=Upt,s=jpt,o=Wpt,a=null;function u(){var l,c,f=+e.apply(this,arguments),h=+t.apply(this,arguments),d=i.apply(this,arguments)-w_,p=s.apply(this,arguments)-w_,g=jY(p-d),m=p>d;if(a||(a=l=Ag()),h<f&&(c=h,h=f,f=c),!(h>si))a.moveTo(0,0);else if(g>wge-si)a.moveTo(h*id(d),h*eu(d)),a.arc(0,0,h,d,p,!m),f>si&&(a.moveTo(f*id(p),f*eu(p)),a.arc(0,0,f,p,d,m));else{var y=d,b=p,v=d,x=p,w=g,C=g,$=o.apply(this,arguments)/2,S=$>si&&(r?+r.apply(this,arguments):wm(f*f+h*h)),k=vO(jY(h-f)/2,+n.apply(this,arguments)),E=k,_=k,D,A;if(S>si){var T=WY(S/f*eu($)),I=WY(S/h*eu($));(w-=T*2)>si?(T*=m?1:-1,v+=T,x-=T):(w=0,v=x=(d+p)/2),(C-=I*2)>si?(I*=m?1:-1,y+=I,b-=I):(C=0,y=b=(d+p)/2)}var F=h*id(y),R=h*eu(y),L=f*id(x),P=f*eu(x);if(k>si){var q=h*id(b),X=h*eu(b),G=f*id(v),J=f*eu(v),Q;if(g<E0&&(Q=Vpt(F,R,G,J,q,X,L,P))){var ee=F-Q[0],ue=R-Q[1],ge=q-Q[0],xe=X-Q[1],B=1/eu(Ppt((ee*ge+ue*xe)/(wm(ee*ee+ue*ue)*wm(ge*ge+xe*xe)))/2),H=wm(Q[0]*Q[0]+Q[1]*Q[1]);E=vO(k,(f-H)/(B-1)),_=vO(k,(h-H)/(B+1))}}C>si?_>si?(D=pS(G,J,F,R,h,_,m),A=pS(q,X,L,P,h,_,m),a.moveTo(D.cx+D.x01,D.cy+D.y01),_<k?a.arc(D.cx,D.cy,_,ni(D.y01,D.x01),ni(A.y01,A.x01),!m):(a.arc(D.cx,D.cy,_,ni(D.y01,D.x01),ni(D.y11,D.x11),!m),a.arc(0,0,h,ni(D.cy+D.y11,D.cx+D.x11),ni(A.cy+A.y11,A.cx+A.x11),!m),a.arc(A.cx,A.cy,_,ni(A.y11,A.x11),ni(A.y01,A.x01),!m))):(a.moveTo(F,R),a.arc(0,0,h,y,b,!m)):a.moveTo(F,R),!(f>si)||!(w>si)?a.lineTo(L,P):E>si?(D=pS(L,P,q,X,f,-E,m),A=pS(F,R,G,J,f,-E,m),a.lineTo(D.cx+D.x01,D.cy+D.y01),E<k?a.arc(D.cx,D.cy,E,ni(D.y01,D.x01),ni(A.y01,A.x01),!m):(a.arc(D.cx,D.cy,E,ni(D.y01,D.x01),ni(D.y11,D.x11),!m),a.arc(0,0,f,ni(D.cy+D.y11,D.cx+D.x11),ni(A.cy+A.y11,A.cx+A.x11),m),a.arc(A.cx,A.cy,E,ni(A.y11,A.x11),ni(A.y01,A.x01),!m))):a.arc(0,0,f,x,v,m)}if(a.closePath(),l)return a=null,l+""||null}return u.centroid=function(){var l=(+e.apply(this,arguments)+ +t.apply(this,arguments))/2,c=(+i.apply(this,arguments)+ +s.apply(this,arguments))/2-E0/2;return[id(c)*l,eu(c)*l]},u.innerRadius=function(l){return arguments.length?(e=typeof l=="function"?l:Lt(+l),u):e},u.outerRadius=function(l){return arguments.length?(t=typeof l=="function"?l:Lt(+l),u):t},u.cornerRadius=function(l){return arguments.length?(n=typeof l=="function"?l:Lt(+l),u):n},u.padRadius=function(l){return arguments.length?(r=l==null?null:typeof l=="function"?l:Lt(+l),u):r},u.startAngle=function(l){return arguments.length?(i=typeof l=="function"?l:Lt(+l),u):i},u.endAngle=function(l){return arguments.length?(s=typeof l=="function"?l:Lt(+l),u):s},u.padAngle=function(l){return arguments.length?(o=typeof l=="function"?l:Lt(+l),u):o},u.context=function(l){return arguments.length?(a=l??null,u):a},u}function $ge(e){return typeof e=="object"&&"length"in e?e:Array.from(e)}function Cge(e){this._context=e}Cge.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;default:this._context.lineTo(e,t);break}}};function t9(e){return new Cge(e)}function Sge(e){return e[0]}function kge(e){return e[1]}function Ege(e,t){var n=Lt(!0),r=null,i=t9,s=null;e=typeof e=="function"?e:e===void 0?Sge:Lt(e),t=typeof t=="function"?t:t===void 0?kge:Lt(t);function o(a){var u,l=(a=$ge(a)).length,c,f=!1,h;for(r==null&&(s=i(h=Ag())),u=0;u<=l;++u)!(u<l&&n(c=a[u],u,a))===f&&((f=!f)?s.lineStart():s.lineEnd()),f&&s.point(+e(c,u,a),+t(c,u,a));if(h)return s=null,h+""||null}return o.x=function(a){return arguments.length?(e=typeof a=="function"?a:Lt(+a),o):e},o.y=function(a){return arguments.length?(t=typeof a=="function"?a:Lt(+a),o):t},o.defined=function(a){return arguments.length?(n=typeof a=="function"?a:Lt(!!a),o):n},o.curve=function(a){return arguments.length?(i=a,r!=null&&(s=i(r)),o):i},o.context=function(a){return arguments.length?(a==null?r=s=null:s=i(r=a),o):r},o}function _ge(e,t,n){var r=null,i=Lt(!0),s=null,o=t9,a=null;e=typeof e=="function"?e:e===void 0?Sge:Lt(+e),t=typeof t=="function"?t:Lt(t===void 0?0:+t),n=typeof n=="function"?n:n===void 0?kge:Lt(+n);function u(c){var f,h,d,p=(c=$ge(c)).length,g,m=!1,y,b=new Array(p),v=new Array(p);for(s==null&&(a=o(y=Ag())),f=0;f<=p;++f){if(!(f<p&&i(g=c[f],f,c))===m)if(m=!m)h=f,a.areaStart(),a.lineStart();else{for(a.lineEnd(),a.lineStart(),d=f-1;d>=h;--d)a.point(b[d],v[d]);a.lineEnd(),a.areaEnd()}m&&(b[f]=+e(g,f,c),v[f]=+t(g,f,c),a.point(r?+r(g,f,c):b[f],n?+n(g,f,c):v[f]))}if(y)return a=null,y+""||null}function l(){return Ege().defined(i).curve(o).context(s)}return u.x=function(c){return arguments.length?(e=typeof c=="function"?c:Lt(+c),r=null,u):e},u.x0=function(c){return arguments.length?(e=typeof c=="function"?c:Lt(+c),u):e},u.x1=function(c){return arguments.length?(r=c==null?null:typeof c=="function"?c:Lt(+c),u):r},u.y=function(c){return arguments.length?(t=typeof c=="function"?c:Lt(+c),n=null,u):t},u.y0=function(c){return arguments.length?(t=typeof c=="function"?c:Lt(+c),u):t},u.y1=function(c){return arguments.length?(n=c==null?null:typeof c=="function"?c:Lt(+c),u):n},u.lineX0=u.lineY0=function(){return l().x(e).y(t)},u.lineY1=function(){return l().x(e).y(n)},u.lineX1=function(){return l().x(r).y(t)},u.defined=function(c){return arguments.length?(i=typeof c=="function"?c:Lt(!!c),u):i},u.curve=function(c){return arguments.length?(o=c,s!=null&&(a=o(s)),u):o},u.context=function(c){return arguments.length?(c==null?s=a=null:a=o(s=c),u):s},u}const Hpt={draw:function(e,t){var n=Math.sqrt(t/E0);e.moveTo(n,0),e.arc(0,0,n,0,wge)}};function qpt(e,t){var n=null;e=typeof e=="function"?e:Lt(e||Hpt),t=typeof t=="function"?t:Lt(t===void 0?64:+t);function r(){var i;if(n||(n=i=Ag()),e.apply(this,arguments).draw(n,+t.apply(this,arguments)),i)return n=null,i+""||null}return r.type=function(i){return arguments.length?(e=typeof i=="function"?i:Lt(i),r):e},r.size=function(i){return arguments.length?(t=typeof i=="function"?i:Lt(+i),r):t},r.context=function(i){return arguments.length?(n=i??null,r):n},r}function lh(){}function $_(e,t,n){e._context.bezierCurveTo((2*e._x0+e._x1)/3,(2*e._y0+e._y1)/3,(e._x0+2*e._x1)/3,(e._y0+2*e._y1)/3,(e._x0+4*e._x1+t)/6,(e._y0+4*e._y1+n)/6)}function rN(e){this._context=e}rN.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=NaN,this._point=0},lineEnd:function(){switch(this._point){case 3:$_(this,this._x1,this._y1);case 2:this._context.lineTo(this._x1,this._y1);break}(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;break;case 2:this._point=3,this._context.lineTo((5*this._x0+this._x1)/6,(5*this._y0+this._y1)/6);default:$_(this,e,t);break}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=t}};function Xpt(e){return new rN(e)}function Age(e){this._context=e}Age.prototype={areaStart:lh,areaEnd:lh,lineStart:function(){this._x0=this._x1=this._x2=this._x3=this._x4=this._y0=this._y1=this._y2=this._y3=this._y4=NaN,this._point=0},lineEnd:function(){switch(this._point){case 1:{this._context.moveTo(this._x2,this._y2),this._context.closePath();break}case 2:{this._context.moveTo((this._x2+2*this._x3)/3,(this._y2+2*this._y3)/3),this._context.lineTo((this._x3+2*this._x2)/3,(this._y3+2*this._y2)/3),this._context.closePath();break}case 3:{this.point(this._x2,this._y2),this.point(this._x3,this._y3),this.point(this._x4,this._y4);break}}},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._x2=e,this._y2=t;break;case 1:this._point=2,this._x3=e,this._y3=t;break;case 2:this._point=3,this._x4=e,this._y4=t,this._context.moveTo((this._x0+4*this._x1+e)/6,(this._y0+4*this._y1+t)/6);break;default:$_(this,e,t);break}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=t}};function Ypt(e){return new Age(e)}function Tge(e){this._context=e}Tge.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=NaN,this._point=0},lineEnd:function(){(this._line||this._line!==0&&this._point===3)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3;var n=(this._x0+4*this._x1+e)/6,r=(this._y0+4*this._y1+t)/6;this._line?this._context.lineTo(n,r):this._context.moveTo(n,r);break;case 3:this._point=4;default:$_(this,e,t);break}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=t}};function Kpt(e){return new Tge(e)}function Ige(e,t){this._basis=new rN(e),this._beta=t}Ige.prototype={lineStart:function(){this._x=[],this._y=[],this._basis.lineStart()},lineEnd:function(){var e=this._x,t=this._y,n=e.length-1;if(n>0)for(var r=e[0],i=t[0],s=e[n]-r,o=t[n]-i,a=-1,u;++a<=n;)u=a/n,this._basis.point(this._beta*e[a]+(1-this._beta)*(r+u*s),this._beta*t[a]+(1-this._beta)*(i+u*o));this._x=this._y=null,this._basis.lineEnd()},point:function(e,t){this._x.push(+e),this._y.push(+t)}};const Zpt=function e(t){function n(r){return t===1?new rN(r):new Ige(r,t)}return n.beta=function(r){return e(+r)},n}(.85);function C_(e,t,n){e._context.bezierCurveTo(e._x1+e._k*(e._x2-e._x0),e._y1+e._k*(e._y2-e._y0),e._x2+e._k*(e._x1-t),e._y2+e._k*(e._y1-n),e._x2,e._y2)}function n9(e,t){this._context=e,this._k=(1-t)/6}n9.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x2,this._y2);break;case 3:C_(this,this._x1,this._y1);break}(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2,this._x1=e,this._y1=t;break;case 2:this._point=3;default:C_(this,e,t);break}this._x0=this._x1,this._x1=this._x2,this._x2=e,this._y0=this._y1,this._y1=this._y2,this._y2=t}};const Jpt=function e(t){function n(r){return new n9(r,t)}return n.tension=function(r){return e(+r)},n}(0);function r9(e,t){this._context=e,this._k=(1-t)/6}r9.prototype={areaStart:lh,areaEnd:lh,lineStart:function(){this._x0=this._x1=this._x2=this._x3=this._x4=this._x5=this._y0=this._y1=this._y2=this._y3=this._y4=this._y5=NaN,this._point=0},lineEnd:function(){switch(this._point){case 1:{this._context.moveTo(this._x3,this._y3),this._context.closePath();break}case 2:{this._context.lineTo(this._x3,this._y3),this._context.closePath();break}case 3:{this.point(this._x3,this._y3),this.point(this._x4,this._y4),this.point(this._x5,this._y5);break}}},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._x3=e,this._y3=t;break;case 1:this._point=2,this._context.moveTo(this._x4=e,this._y4=t);break;case 2:this._point=3,this._x5=e,this._y5=t;break;default:C_(this,e,t);break}this._x0=this._x1,this._x1=this._x2,this._x2=e,this._y0=this._y1,this._y1=this._y2,this._y2=t}};const Qpt=function e(t){function n(r){return new r9(r,t)}return n.tension=function(r){return e(+r)},n}(0);function i9(e,t){this._context=e,this._k=(1-t)/6}i9.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._point=0},lineEnd:function(){(this._line||this._line!==0&&this._point===3)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3,this._line?this._context.lineTo(this._x2,this._y2):this._context.moveTo(this._x2,this._y2);break;case 3:this._point=4;default:C_(this,e,t);break}this._x0=this._x1,this._x1=this._x2,this._x2=e,this._y0=this._y1,this._y1=this._y2,this._y2=t}};const egt=function e(t){function n(r){return new i9(r,t)}return n.tension=function(r){return e(+r)},n}(0);function s9(e,t,n){var r=e._x1,i=e._y1,s=e._x2,o=e._y2;if(e._l01_a>si){var a=2*e._l01_2a+3*e._l01_a*e._l12_a+e._l12_2a,u=3*e._l01_a*(e._l01_a+e._l12_a);r=(r*a-e._x0*e._l12_2a+e._x2*e._l01_2a)/u,i=(i*a-e._y0*e._l12_2a+e._y2*e._l01_2a)/u}if(e._l23_a>si){var l=2*e._l23_2a+3*e._l23_a*e._l12_a+e._l12_2a,c=3*e._l23_a*(e._l23_a+e._l12_a);s=(s*l+e._x1*e._l23_2a-t*e._l12_2a)/c,o=(o*l+e._y1*e._l23_2a-n*e._l12_2a)/c}e._context.bezierCurveTo(r,i,s,o,e._x2,e._y2)}function Dge(e,t){this._context=e,this._alpha=t}Dge.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._l01_a=this._l12_a=this._l23_a=this._l01_2a=this._l12_2a=this._l23_2a=this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x2,this._y2);break;case 3:this.point(this._x2,this._y2);break}(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){if(e=+e,t=+t,this._point){var n=this._x2-e,r=this._y2-t;this._l23_a=Math.sqrt(this._l23_2a=Math.pow(n*n+r*r,this._alpha))}switch(this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;break;case 2:this._point=3;default:s9(this,e,t);break}this._l01_a=this._l12_a,this._l12_a=this._l23_a,this._l01_2a=this._l12_2a,this._l12_2a=this._l23_2a,this._x0=this._x1,this._x1=this._x2,this._x2=e,this._y0=this._y1,this._y1=this._y2,this._y2=t}};const tgt=function e(t){function n(r){return t?new Dge(r,t):new n9(r,0)}return n.alpha=function(r){return e(+r)},n}(.5);function Nge(e,t){this._context=e,this._alpha=t}Nge.prototype={areaStart:lh,areaEnd:lh,lineStart:function(){this._x0=this._x1=this._x2=this._x3=this._x4=this._x5=this._y0=this._y1=this._y2=this._y3=this._y4=this._y5=NaN,this._l01_a=this._l12_a=this._l23_a=this._l01_2a=this._l12_2a=this._l23_2a=this._point=0},lineEnd:function(){switch(this._point){case 1:{this._context.moveTo(this._x3,this._y3),this._context.closePath();break}case 2:{this._context.lineTo(this._x3,this._y3),this._context.closePath();break}case 3:{this.point(this._x3,this._y3),this.point(this._x4,this._y4),this.point(this._x5,this._y5);break}}},point:function(e,t){if(e=+e,t=+t,this._point){var n=this._x2-e,r=this._y2-t;this._l23_a=Math.sqrt(this._l23_2a=Math.pow(n*n+r*r,this._alpha))}switch(this._point){case 0:this._point=1,this._x3=e,this._y3=t;break;case 1:this._point=2,this._context.moveTo(this._x4=e,this._y4=t);break;case 2:this._point=3,this._x5=e,this._y5=t;break;default:s9(this,e,t);break}this._l01_a=this._l12_a,this._l12_a=this._l23_a,this._l01_2a=this._l12_2a,this._l12_2a=this._l23_2a,this._x0=this._x1,this._x1=this._x2,this._x2=e,this._y0=this._y1,this._y1=this._y2,this._y2=t}};const ngt=function e(t){function n(r){return t?new Nge(r,t):new r9(r,0)}return n.alpha=function(r){return e(+r)},n}(.5);function Fge(e,t){this._context=e,this._alpha=t}Fge.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._l01_a=this._l12_a=this._l23_a=this._l01_2a=this._l12_2a=this._l23_2a=this._point=0},lineEnd:function(){(this._line||this._line!==0&&this._point===3)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){if(e=+e,t=+t,this._point){var n=this._x2-e,r=this._y2-t;this._l23_a=Math.sqrt(this._l23_2a=Math.pow(n*n+r*r,this._alpha))}switch(this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3,this._line?this._context.lineTo(this._x2,this._y2):this._context.moveTo(this._x2,this._y2);break;case 3:this._point=4;default:s9(this,e,t);break}this._l01_a=this._l12_a,this._l12_a=this._l23_a,this._l01_2a=this._l12_2a,this._l12_2a=this._l23_2a,this._x0=this._x1,this._x1=this._x2,this._x2=e,this._y0=this._y1,this._y1=this._y2,this._y2=t}};const rgt=function e(t){function n(r){return t?new Fge(r,t):new i9(r,0)}return n.alpha=function(r){return e(+r)},n}(.5);function Oge(e){this._context=e}Oge.prototype={areaStart:lh,areaEnd:lh,lineStart:function(){this._point=0},lineEnd:function(){this._point&&this._context.closePath()},point:function(e,t){e=+e,t=+t,this._point?this._context.lineTo(e,t):(this._point=1,this._context.moveTo(e,t))}};function igt(e){return new Oge(e)}function VY(e){return e<0?-1:1}function GY(e,t,n){var r=e._x1-e._x0,i=t-e._x1,s=(e._y1-e._y0)/(r||i<0&&-0),o=(n-e._y1)/(i||r<0&&-0),a=(s*i+o*r)/(r+i);return(VY(s)+VY(o))*Math.min(Math.abs(s),Math.abs(o),.5*Math.abs(a))||0}function HY(e,t){var n=e._x1-e._x0;return n?(3*(e._y1-e._y0)/n-t)/2:t}function wO(e,t,n){var r=e._x0,i=e._y0,s=e._x1,o=e._y1,a=(s-r)/3;e._context.bezierCurveTo(r+a,i+a*t,s-a,o-a*n,s,o)}function S_(e){this._context=e}S_.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=this._t0=NaN,this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x1,this._y1);break;case 3:wO(this,this._t0,HY(this,this._t0));break}(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){var n=NaN;if(e=+e,t=+t,!(e===this._x1&&t===this._y1)){switch(this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;break;case 2:this._point=3,wO(this,HY(this,n=GY(this,e,t)),n);break;default:wO(this,this._t0,n=GY(this,e,t));break}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=t,this._t0=n}}};function Rge(e){this._context=new Mge(e)}(Rge.prototype=Object.create(S_.prototype)).point=function(e,t){S_.prototype.point.call(this,t,e)};function Mge(e){this._context=e}Mge.prototype={moveTo:function(e,t){this._context.moveTo(t,e)},closePath:function(){this._context.closePath()},lineTo:function(e,t){this._context.lineTo(t,e)},bezierCurveTo:function(e,t,n,r,i,s){this._context.bezierCurveTo(t,e,r,n,s,i)}};function sgt(e){return new S_(e)}function ogt(e){return new Rge(e)}function Lge(e){this._context=e}Lge.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x=[],this._y=[]},lineEnd:function(){var e=this._x,t=this._y,n=e.length;if(n)if(this._line?this._context.lineTo(e[0],t[0]):this._context.moveTo(e[0],t[0]),n===2)this._context.lineTo(e[1],t[1]);else for(var r=qY(e),i=qY(t),s=0,o=1;o<n;++s,++o)this._context.bezierCurveTo(r[0][s],i[0][s],r[1][s],i[1][s],e[o],t[o]);(this._line||this._line!==0&&n===1)&&this._context.closePath(),this._line=1-this._line,this._x=this._y=null},point:function(e,t){this._x.push(+e),this._y.push(+t)}};function qY(e){var t,n=e.length-1,r,i=new Array(n),s=new Array(n),o=new Array(n);for(i[0]=0,s[0]=2,o[0]=e[0]+2*e[1],t=1;t<n-1;++t)i[t]=1,s[t]=4,o[t]=4*e[t]+2*e[t+1];for(i[n-1]=2,s[n-1]=7,o[n-1]=8*e[n-1]+e[n],t=1;t<n;++t)r=i[t]/s[t-1],s[t]-=r,o[t]-=r*o[t-1];for(i[n-1]=o[n-1]/s[n-1],t=n-2;t>=0;--t)i[t]=(o[t]-i[t+1])/s[t];for(s[n-1]=(e[n]+i[n-1])/2,t=0;t<n-1;++t)s[t]=2*e[t+1]-i[t+1];return[i,s]}function agt(e){return new Lge(e)}function iN(e,t){this._context=e,this._t=t}iN.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x=this._y=NaN,this._point=0},lineEnd:function(){0<this._t&&this._t<1&&this._point===2&&this._context.lineTo(this._x,this._y),(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line>=0&&(this._t=1-this._t,this._line=1-this._line)},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;default:{if(this._t<=0)this._context.lineTo(this._x,t),this._context.lineTo(e,t);else{var n=this._x*(1-this._t)+e*this._t;this._context.lineTo(n,this._y),this._context.lineTo(n,t)}break}}this._x=e,this._y=t}};function ugt(e){return new iN(e,.5)}function lgt(e){return new iN(e,0)}function cgt(e){return new iN(e,1)}var XY={},$O={},CO=34,fb=10,SO=13;function Pge(e){return new Function("d","return {"+e.map(function(t,n){return JSON.stringify(t)+": d["+n+'] || ""'}).join(",")+"}")}function fgt(e,t){var n=Pge(e);return function(r,i){return t(n(r),i,e)}}function YY(e){var t=Object.create(null),n=[];return e.forEach(function(r){for(var i in r)i in t||n.push(t[i]=i)}),n}function fs(e,t){var n=e+"",r=n.length;return r<t?new Array(t-r+1).join(0)+n:n}function hgt(e){return e<0?"-"+fs(-e,6):e>9999?"+"+fs(e,6):fs(e,4)}function dgt(e){var t=e.getUTCHours(),n=e.getUTCMinutes(),r=e.getUTCSeconds(),i=e.getUTCMilliseconds();return isNaN(e)?"Invalid Date":hgt(e.getUTCFullYear())+"-"+fs(e.getUTCMonth()+1,2)+"-"+fs(e.getUTCDate(),2)+(i?"T"+fs(t,2)+":"+fs(n,2)+":"+fs(r,2)+"."+fs(i,3)+"Z":r?"T"+fs(t,2)+":"+fs(n,2)+":"+fs(r,2)+"Z":n||t?"T"+fs(t,2)+":"+fs(n,2)+"Z":"")}function pgt(e){var t=new RegExp('["'+e+`
\r]`),n=e.charCodeAt(0);function r(f,h){var d,p,g=i(f,function(m,y){if(d)return d(m,y-1);p=m,d=h?fgt(m,h):Pge(m)});return g.columns=p||[],g}function i(f,h){var d=[],p=f.length,g=0,m=0,y,b=p<=0,v=!1;f.charCodeAt(p-1)===fb&&--p,f.charCodeAt(p-1)===SO&&--p;function x(){if(b)return $O;if(v)return v=!1,XY;var C,$=g,S;if(f.charCodeAt($)===CO){for(;g++<p&&f.charCodeAt(g)!==CO||f.charCodeAt(++g)===CO;);return(C=g)>=p?b=!0:(S=f.charCodeAt(g++))===fb?v=!0:S===SO&&(v=!0,f.charCodeAt(g)===fb&&++g),f.slice($+1,C-1).replace(/""/g,'"')}for(;g<p;){if((S=f.charCodeAt(C=g++))===fb)v=!0;else if(S===SO)v=!0,f.charCodeAt(g)===fb&&++g;else if(S!==n)continue;return f.slice($,C)}return b=!0,f.slice($,p)}for(;(y=x())!==$O;){for(var w=[];y!==XY&&y!==$O;)w.push(y),y=x();h&&(w=h(w,m++))==null||d.push(w)}return d}function s(f,h){return f.map(function(d){return h.map(function(p){return c(d[p])}).join(e)})}function o(f,h){return h==null&&(h=YY(f)),[h.map(c).join(e)].concat(s(f,h)).join(`
`)}function a(f,h){return h==null&&(h=YY(f)),s(f,h).join(`
`)}function u(f){return f.map(l).join(`
`)}function l(f){return f.map(c).join(e)}function c(f){return f==null?"":f instanceof Date?dgt(f):t.test(f+="")?'"'+f.replace(/"/g,'""')+'"':f}return{parse:r,parseRows:i,format:o,formatBody:a,formatRows:u,formatRow:l,formatValue:c}}function ggt(e){return Math.abs(e=Math.round(e))>=1e21?e.toLocaleString("en").replace(/,/g,""):e.toString(10)}function k_(e,t){if((n=(e=t?e.toExponential(t-1):e.toExponential()).indexOf("e"))<0)return null;var n,r=e.slice(0,n);return[r.length>1?r[0]+r.slice(2):r,+e.slice(n+1)]}function _0(e){return e=k_(Math.abs(e)),e?e[1]:NaN}function mgt(e,t){return function(n,r){for(var i=n.length,s=[],o=0,a=e[0],u=0;i>0&&a>0&&(u+a+1>r&&(a=Math.max(1,r-u)),s.push(n.substring(i-=a,i+a)),!((u+=a+1)>r));)a=e[o=(o+1)%e.length];return s.reverse().join(t)}}function ygt(e){return function(t){return t.replace(/[0-9]/g,function(n){return e[+n]})}}var bgt=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function zv(e){if(!(t=bgt.exec(e)))throw new Error("invalid format: "+e);var t;return new o9({fill:t[1],align:t[2],sign:t[3],symbol:t[4],zero:t[5],width:t[6],comma:t[7],precision:t[8]&&t[8].slice(1),trim:t[9],type:t[10]})}zv.prototype=o9.prototype;function o9(e){this.fill=e.fill===void 0?" ":e.fill+"",this.align=e.align===void 0?">":e.align+"",this.sign=e.sign===void 0?"-":e.sign+"",this.symbol=e.symbol===void 0?"":e.symbol+"",this.zero=!!e.zero,this.width=e.width===void 0?void 0:+e.width,this.comma=!!e.comma,this.precision=e.precision===void 0?void 0:+e.precision,this.trim=!!e.trim,this.type=e.type===void 0?"":e.type+""}o9.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function xgt(e){e:for(var t=e.length,n=1,r=-1,i;n<t;++n)switch(e[n]){case".":r=i=n;break;case"0":r===0&&(r=n),i=n;break;default:if(!+e[n])break e;r>0&&(r=0);break}return r>0?e.slice(0,r)+e.slice(i+1):e}var Bge;function vgt(e,t){var n=k_(e,t);if(!n)return e+"";var r=n[0],i=n[1],s=i-(Bge=Math.max(-8,Math.min(8,Math.floor(i/3)))*3)+1,o=r.length;return s===o?r:s>o?r+new Array(s-o+1).join("0"):s>0?r.slice(0,s)+"."+r.slice(s):"0."+new Array(1-s).join("0")+k_(e,Math.max(0,t+s-1))[0]}function KY(e,t){var n=k_(e,t);if(!n)return e+"";var r=n[0],i=n[1];return i<0?"0."+new Array(-i).join("0")+r:r.length>i+1?r.slice(0,i+1)+"."+r.slice(i+1):r+new Array(i-r.length+2).join("0")}const ZY={"%":(e,t)=>(e*100).toFixed(t),b:e=>Math.round(e).toString(2),c:e=>e+"",d:ggt,e:(e,t)=>e.toExponential(t),f:(e,t)=>e.toFixed(t),g:(e,t)=>e.toPrecision(t),o:e=>Math.round(e).toString(8),p:(e,t)=>KY(e*100,t),r:KY,s:vgt,X:e=>Math.round(e).toString(16).toUpperCase(),x:e=>Math.round(e).toString(16)};function JY(e){return e}var QY=Array.prototype.map,eK=["y","z","a","f","p","n","","m","","k","M","G","T","P","E","Z","Y"];function zge(e){var t=e.grouping===void 0||e.thousands===void 0?JY:mgt(QY.call(e.grouping,Number),e.thousands+""),n=e.currency===void 0?"":e.currency[0]+"",r=e.currency===void 0?"":e.currency[1]+"",i=e.decimal===void 0?".":e.decimal+"",s=e.numerals===void 0?JY:ygt(QY.call(e.numerals,String)),o=e.percent===void 0?"%":e.percent+"",a=e.minus===void 0?"":e.minus+"",u=e.nan===void 0?"NaN":e.nan+"";function l(f){f=zv(f);var h=f.fill,d=f.align,p=f.sign,g=f.symbol,m=f.zero,y=f.width,b=f.comma,v=f.precision,x=f.trim,w=f.type;w==="n"?(b=!0,w="g"):ZY[w]||(v===void 0&&(v=12),x=!0,w="g"),(m||h==="0"&&d==="=")&&(m=!0,h="0",d="=");var C=g==="$"?n:g==="#"&&/[boxX]/.test(w)?"0"+w.toLowerCase():"",$=g==="$"?r:/[%p]/.test(w)?o:"",S=ZY[w],k=/[defgprs%]/.test(w);v=v===void 0?6:/[gprs]/.test(w)?Math.max(1,Math.min(21,v)):Math.max(0,Math.min(20,v));function E(_){var D=C,A=$,T,I,F;if(w==="c")A=S(_)+A,_="";else{_=+_;var R=_<0||1/_<0;if(_=isNaN(_)?u:S(Math.abs(_),v),x&&(_=xgt(_)),R&&+_==0&&p!=="+"&&(R=!1),D=(R?p==="("?p:a:p==="-"||p==="("?"":p)+D,A=(w==="s"?eK[8+Bge/3]:"")+A+(R&&p==="("?")":""),k){for(T=-1,I=_.length;++T<I;)if(F=_.charCodeAt(T),48>F||F>57){A=(F===46?i+_.slice(T+1):_.slice(T))+A,_=_.slice(0,T);break}}}b&&!m&&(_=t(_,1/0));var L=D.length+_.length+A.length,P=L<y?new Array(y-L+1).join(h):"";switch(b&&m&&(_=t(P+_,P.length?y-A.length:1/0),P=""),d){case"<":_=D+_+A+P;break;case"=":_=D+P+_+A;break;case"^":_=P.slice(0,L=P.length>>1)+D+_+A+P.slice(L);break;default:_=P+D+_+A;break}return s(_)}return E.toString=function(){return f+""},E}function c(f,h){var d=l((f=zv(f),f.type="f",f)),p=Math.max(-8,Math.min(8,Math.floor(_0(h)/3)))*3,g=Math.pow(10,-p),m=eK[8+p/3];return function(y){return d(g*y)+m}}return{format:l,formatPrefix:c}}var gS,Uge,jge;wgt({thousands:",",grouping:[3],currency:["$",""]});function wgt(e){return gS=zge(e),Uge=gS.format,jge=gS.formatPrefix,gS}function $gt(e){return Math.max(0,-_0(Math.abs(e)))}function Cgt(e,t){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(_0(t)/3)))*3-_0(Math.abs(e)))}function Sgt(e,t){return e=Math.abs(e),t=Math.abs(t)-e,Math.max(0,_0(t)-_0(e))+1}function Qb(e){const t={};return n=>t[n]||(t[n]=e(n))}function kgt(e,t){return n=>{const r=e(n),i=r.indexOf(t);if(i<0)return r;let s=Egt(r,i);const o=s<r.length?r.slice(s):"";for(;--s>i;)if(r[s]!=="0"){++s;break}return r.slice(0,s)+o}}function Egt(e,t){let n=e.lastIndexOf("e"),r;if(n>0)return n;for(n=e.length;--n>t;)if(r=e.charCodeAt(n),r>=48&&r<=57)return n+1}function Wge(e){const t=Qb(e.format),n=e.formatPrefix;return{format:t,formatPrefix:n,formatFloat(r){const i=zv(r||",");if(i.precision==null){switch(i.precision=12,i.type){case"%":i.precision-=2;break;case"e":i.precision-=1;break}return kgt(t(i),t(".1f")(1)[1])}else return t(i)},formatSpan(r,i,s,o){o=zv(o??",f");const a=Zf(r,i,s),u=Math.max(Math.abs(r),Math.abs(i));let l;if(o.precision==null)switch(o.type){case"s":return isNaN(l=Cgt(a,u))||(o.precision=l),n(o,u);case"":case"e":case"g":case"p":case"r":{isNaN(l=Sgt(a,u))||(o.precision=l-(o.type==="e"));break}case"f":case"%":{isNaN(l=$gt(a))||(o.precision=l-(o.type==="%")*2);break}}return t(o)}}}let uL;Vge();function Vge(){return uL=Wge({format:Uge,formatPrefix:jge})}function Gge(e){return Wge(zge(e))}function E_(e){return arguments.length?uL=Gge(e):uL}function tK(e,t,n){n=n||{},dt(n)||le("Invalid time multi-format specifier: ".concat(n));const r=t(zo),i=t(oo),s=t(so),o=t(Ds),a=t(ar),u=t(Ci),l=t(Is),c=t(Yr),f=e(n[Ra]||".%L"),h=e(n[zo]||":%S"),d=e(n[oo]||"%I:%M"),p=e(n[so]||"%I %p"),g=e(n[Ds]||n[gi]||"%a %d"),m=e(n[ar]||"%b %d"),y=e(n[Ci]||"%B"),b=e(n[Is]||"%B"),v=e(n[Yr]||"%Y");return x=>(r(x)<x?f:i(x)<x?h:s(x)<x?d:o(x)<x?p:u(x)<x?a(x)<x?g:m:c(x)<x?l(x)<x?y:b:v)(x)}function Hge(e){const t=Qb(e.format),n=Qb(e.utcFormat);return{timeFormat:r=>mn(r)?t(r):tK(t,cy,r),utcFormat:r=>mn(r)?n(r):tK(n,fy,r),timeParse:Qb(e.parse),utcParse:Qb(e.utcParse)}}let lL;qge();function qge(){return lL=Hge({format:VD,parse:kde,utcFormat:GD,utcParse:Ede})}function Xge(e){return Hge(vde(e))}function Uv(e){return arguments.length?lL=Xge(e):lL}const cL=(e,t)=>yt({},e,t);function Yge(e,t){const n=e?Gge(e):E_(),r=t?Xge(t):Uv();return cL(n,r)}function Kge(e,t){const n=arguments.length;return n&&n!==2&&le("defaultLocale expects either zero or two arguments."),n?cL(E_(e),Uv(t)):cL(E_(),Uv())}function _gt(){return Vge(),qge(),Kge()}const Agt=/^(data:|([A-Za-z]+:)?\/\/)/,Tgt=/^(?:(?:(?:f|ht)tps?|mailto|tel|callto|cid|xmpp|file|data):|[^a-z]|[a-z+.\-]+(?:[^a-z+.\-:]|$))/i,Igt=/[\u0000-\u0020\u00A0\u1680\u180E\u2000-\u2029\u205f\u3000]/g,nK="file://";function Dgt(e,t){return n=>({options:n||{},sanitize:Fgt,load:Ngt,fileAccess:!!t,file:Ogt(t),http:Mgt(e)})}async function Ngt(e,t){const n=await this.sanitize(e,t),r=n.href;return n.localFile?this.file(r):this.http(r,t)}async function Fgt(e,t){t=yt({},this.options,t);const n=this.fileAccess,r={href:null};let i,s,o;const a=Tgt.test(e.replace(Igt,""));(e==null||typeof e!="string"||!a)&&le("Sanitize failure, invalid URI: "+He(e));const u=Agt.test(e);return(o=t.baseURL)&&!u&&(!e.startsWith("/")&&!o.endsWith("/")&&(e="/"+e),e=o+e),s=(i=e.startsWith(nK))||t.mode==="file"||t.mode!=="http"&&!u&&n,i?e=e.slice(nK.length):e.startsWith("//")&&(t.defaultProtocol==="file"?(e=e.slice(2),s=!0):e=(t.defaultProtocol||"http")+":"+e),Object.defineProperty(r,"localFile",{value:!!s}),r.href=e,t.target&&(r.target=t.target+""),t.rel&&(r.rel=t.rel+""),t.context==="image"&&t.crossOrigin&&(r.crossOrigin=t.crossOrigin+""),r}function Ogt(e){return e?t=>new Promise((n,r)=>{e.readFile(t,(i,s)=>{i?r(i):n(s)})}):Rgt}async function Rgt(){le("No file system access.")}function Mgt(e){return e?async function(t,n){const r=yt({},this.options.http,n),i=n&&n.response,s=await e(t,r);return s.ok?zt(s[i])?s[i]():s.text():le(s.status+""+s.statusText)}:Lgt}async function Lgt(){le("No HTTP fetch method available.")}const Pgt=e=>e!=null&&e===e,Bgt=e=>e==="true"||e==="false"||e===!0||e===!1,zgt=e=>!Number.isNaN(Date.parse(e)),Zge=e=>!Number.isNaN(+e)&&!(e instanceof Date),Ugt=e=>Zge(e)&&Number.isInteger(+e),fL={boolean:Jae,integer:Hf,number:Hf,date:Qae,string:eue,unknown:Po},mS=[Bgt,Ugt,Zge,zgt],jgt=["boolean","integer","number","date"];function Jge(e,t){if(!e||!e.length)return"unknown";const n=e.length,r=mS.length,i=mS.map((s,o)=>o+1);for(let s=0,o=0,a,u;s<n;++s)for(u=t?e[s][t]:e[s],a=0;a<r;++a)if(i[a]&&Pgt(u)&&!mS[a](u)&&(i[a]=0,++o,o===mS.length))return"string";return jgt[i.reduce((s,o)=>s===0?o:s,0)-1]}function Qge(e,t){return t.reduce((n,r)=>(n[r]=Jge(e,r),n),{})}function rK(e){const t=function(n,r){const i={delimiter:e};return a9(n,r?yt(r,i):i)};return t.responseType="text",t}function a9(e,t){return t.header&&(e=t.header.map(He).join(t.delimiter)+`
`+e),pgt(t.delimiter).parse(e+"")}a9.responseType="text";function Wgt(e){return typeof Buffer=="function"&&zt(Buffer.isBuffer)?Buffer.isBuffer(e):!1}function u9(e,t){const n=t&&t.property?Gf(t.property):Po;return dt(e)&&!Wgt(e)?Vgt(n(e),t):n(JSON.parse(e))}u9.responseType="json";function Vgt(e,t){return!it(e)&&Xae(e)&&(e=[...e]),t&&t.copy?JSON.parse(JSON.stringify(e)):e}const Ggt={interior:(e,t)=>e!==t,exterior:(e,t)=>e===t};function eme(e,t){let n,r,i,s;return e=u9(e,t),t&&t.feature?(n=sue,i=t.feature):t&&t.mesh?(n=aue,i=t.mesh,s=Ggt[t.filter]):le("Missing TopoJSON feature or mesh parameter."),r=(r=e.objects[i])?n(e,r,s):le("Invalid TopoJSON object: "+i),r&&r.features||[r]}eme.responseType="json";const sk={dsv:a9,csv:rK(","),tsv:rK("	"),json:u9,topojson:eme};function l9(e,t){return arguments.length>1?(sk[e]=t,this):nt(sk,e)?sk[e]:null}function Hgt(e){const t=l9(e);return t&&t.responseType||"text"}function qgt(e,t,n,r){t=t||{};const i=l9(t.type||"json");return i||le("Unknown data format type: "+t.type),e=i(e,t),t.parse&&Xgt(e,t.parse,n,r),nt(e,"columns")&&delete e.columns,e}function Xgt(e,t,n,r){if(!e.length)return;const i=Uv();n=n||i.timeParse,r=r||i.utcParse;let s=e.columns||Object.keys(e[0]),o,a,u,l,c,f;t==="auto"&&(t=Qge(e,s)),s=Object.keys(t);const h=s.map(d=>{const p=t[d];let g,m;if(p&&(p.startsWith("date:")||p.startsWith("utc:")))return g=p.split(/:(.+)?/,2),m=g[1],(m[0]==="'"&&m[m.length-1]==="'"||m[0]==='"'&&m[m.length-1]==='"')&&(m=m.slice(1,-1)),(g[0]==="utc"?r:n)(m);if(!fL[p])throw Error("Illegal format pattern: "+d+":"+p);return fL[p]});for(u=0,c=e.length,f=s.length;u<c;++u)for(o=e[u],l=0;l<f;++l)a=s[l],o[a]=h[l](o[a])}const c9=Dgt(typeof fetch<"u"&&fetch,null);let tme=0;function Ygt(){tme=0}const __="p_";function f9(e){return e&&e.gradient}function nme(e,t,n){const r=e.gradient;let i=e.id,s=r==="radial"?__:"";return i||(i=e.id="gradient_"+tme++,r==="radial"?(e.x1=tu(e.x1,.5),e.y1=tu(e.y1,.5),e.r1=tu(e.r1,0),e.x2=tu(e.x2,.5),e.y2=tu(e.y2,.5),e.r2=tu(e.r2,.5),s=__):(e.x1=tu(e.x1,0),e.y1=tu(e.y1,0),e.x2=tu(e.x2,1),e.y2=tu(e.y2,0))),t[i]=e,"url("+(n||"")+"#"+s+i+")"}function tu(e,t){return e??t}function rme(e,t){var n=[],r;return r={gradient:"linear",x1:e?e[0]:0,y1:e?e[1]:0,x2:t?t[0]:1,y2:t?t[1]:0,stops:n,stop:function(i,s){return n.push({offset:i,color:s}),r}}}const iK={basis:{curve:Xpt},"basis-closed":{curve:Ypt},"basis-open":{curve:Kpt},bundle:{curve:Zpt,tension:"beta",value:.85},cardinal:{curve:Jpt,tension:"tension",value:0},"cardinal-open":{curve:egt,tension:"tension",value:0},"cardinal-closed":{curve:Qpt,tension:"tension",value:0},"catmull-rom":{curve:tgt,tension:"alpha",value:.5},"catmull-rom-closed":{curve:ngt,tension:"alpha",value:.5},"catmull-rom-open":{curve:rgt,tension:"alpha",value:.5},linear:{curve:t9},"linear-closed":{curve:igt},monotone:{horizontal:ogt,vertical:sgt},natural:{curve:agt},step:{curve:ugt},"step-after":{curve:cgt},"step-before":{curve:lgt}};function h9(e,t,n){var r=nt(iK,e)&&iK[e],i=null;return r&&(i=r.curve||r[t||"vertical"],r.tension&&n!=null&&(i=i[r.tension](n))),i}const Kgt={m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7},hb=[/([MLHVCSQTAZmlhvcsqtaz])/g,/###/,/(\.\d+)(\.\d)/g,/(\d)([-+])/g,/\s|,|###/];function A0(e){const t=[];let n,r,i,s,o,a,u,l,c,f;const h=e.slice().replace(hb[0],"###$1").split(hb[1]).slice(1);for(u=0,c=h.length;u<c;++u){for(n=h[u],r=n.slice(1).trim().replace(hb[2],"$1###$2").replace(hb[3],"$1###$2").split(hb[4]),o=n.charAt(0),i=[o],l=0,f=r.length;l<f;++l)(s=+r[l])===s&&i.push(s);if(a=Kgt[o.toLowerCase()],i.length-1>a){const d=i.length;for(l=1,t.push([o].concat(i.slice(l,l+=a))),o=o==="M"?"L":o==="m"?"l":o;l<d;l+=a)t.push([o].concat(i.slice(l,l+a)))}else t.push(i)}return t}const ch=Math.PI/180,Zgt=1e-14,Dd=Math.PI/2,gu=Math.PI*2,am=Math.sqrt(3)/2;var kO={},EO={},ime=[].join;function Jgt(e,t,n,r,i,s,o,a,u){const l=ime.call(arguments);if(kO[l])return kO[l];const c=o*ch,f=Math.sin(c),h=Math.cos(c);n=Math.abs(n),r=Math.abs(r);const d=h*(a-e)*.5+f*(u-t)*.5,p=h*(u-t)*.5-f*(a-e)*.5;let g=d*d/(n*n)+p*p/(r*r);g>1&&(g=Math.sqrt(g),n*=g,r*=g);const m=h/n,y=f/n,b=-f/r,v=h/r,x=m*a+y*u,w=b*a+v*u,C=m*e+y*t,$=b*e+v*t;let k=1/((C-x)*(C-x)+($-w)*($-w))-.25;k<0&&(k=0);let E=Math.sqrt(k);s==i&&(E=-E);const _=.5*(x+C)-E*($-w),D=.5*(w+$)+E*(C-x),A=Math.atan2(w-D,x-_);let I=Math.atan2($-D,C-_)-A;I<0&&s===1?I+=gu:I>0&&s===0&&(I-=gu);const F=Math.ceil(Math.abs(I/(Dd+.001))),R=[];for(let L=0;L<F;++L){const P=A+L*I/F,q=A+(L+1)*I/F;R[L]=[_,D,P,q,n,r,f,h]}return kO[l]=R}function Qgt(e){const t=ime.call(e);if(EO[t])return EO[t];var n=e[0],r=e[1],i=e[2],s=e[3],o=e[4],a=e[5],u=e[6],l=e[7];const c=l*o,f=-u*a,h=u*o,d=l*a,p=Math.cos(i),g=Math.sin(i),m=Math.cos(s),y=Math.sin(s),b=.5*(s-i),v=Math.sin(b*.5),x=8/3*v*v/Math.sin(b),w=n+p-x*g,C=r+g+x*p,$=n+m,S=r+y,k=$+x*y,E=S-x*m;return EO[t]=[c*w+f*C,h*w+d*C,c*k+f*E,h*k+d*E,c*$+f*S,h*$+d*S]}const bo=["l",0,0,0,0,0,0,0];function emt(e,t,n){const r=bo[0]=e[0];if(r==="a"||r==="A")bo[1]=t*e[1],bo[2]=n*e[2],bo[3]=e[3],bo[4]=e[4],bo[5]=e[5],bo[6]=t*e[6],bo[7]=n*e[7];else if(r==="h"||r==="H")bo[1]=t*e[1];else if(r==="v"||r==="V")bo[1]=n*e[1];else for(var i=1,s=e.length;i<s;++i)bo[i]=(i%2==1?t:n)*e[i];return bo}function jv(e,t,n,r,i,s){var o,a=null,u=0,l=0,c=0,f=0,h,d,p,g;n==null&&(n=0),r==null&&(r=0),i==null&&(i=1),s==null&&(s=i),e.beginPath&&e.beginPath();for(var m=0,y=t.length;m<y;++m){switch(o=t[m],(i!==1||s!==1)&&(o=emt(o,i,s)),o[0]){case"l":u+=o[1],l+=o[2],e.lineTo(u+n,l+r);break;case"L":u=o[1],l=o[2],e.lineTo(u+n,l+r);break;case"h":u+=o[1],e.lineTo(u+n,l+r);break;case"H":u=o[1],e.lineTo(u+n,l+r);break;case"v":l+=o[1],e.lineTo(u+n,l+r);break;case"V":l=o[1],e.lineTo(u+n,l+r);break;case"m":u+=o[1],l+=o[2],e.moveTo(u+n,l+r);break;case"M":u=o[1],l=o[2],e.moveTo(u+n,l+r);break;case"c":h=u+o[5],d=l+o[6],c=u+o[3],f=l+o[4],e.bezierCurveTo(u+o[1]+n,l+o[2]+r,c+n,f+r,h+n,d+r),u=h,l=d;break;case"C":u=o[5],l=o[6],c=o[3],f=o[4],e.bezierCurveTo(o[1]+n,o[2]+r,c+n,f+r,u+n,l+r);break;case"s":h=u+o[3],d=l+o[4],c=2*u-c,f=2*l-f,e.bezierCurveTo(c+n,f+r,u+o[1]+n,l+o[2]+r,h+n,d+r),c=u+o[1],f=l+o[2],u=h,l=d;break;case"S":h=o[3],d=o[4],c=2*u-c,f=2*l-f,e.bezierCurveTo(c+n,f+r,o[1]+n,o[2]+r,h+n,d+r),u=h,l=d,c=o[1],f=o[2];break;case"q":h=u+o[3],d=l+o[4],c=u+o[1],f=l+o[2],e.quadraticCurveTo(c+n,f+r,h+n,d+r),u=h,l=d;break;case"Q":h=o[3],d=o[4],e.quadraticCurveTo(o[1]+n,o[2]+r,h+n,d+r),u=h,l=d,c=o[1],f=o[2];break;case"t":h=u+o[1],d=l+o[2],a[0].match(/[QqTt]/)===null?(c=u,f=l):a[0]==="t"?(c=2*u-p,f=2*l-g):a[0]==="q"&&(c=2*u-c,f=2*l-f),p=c,g=f,e.quadraticCurveTo(c+n,f+r,h+n,d+r),u=h,l=d,c=u+o[1],f=l+o[2];break;case"T":h=o[1],d=o[2],c=2*u-c,f=2*l-f,e.quadraticCurveTo(c+n,f+r,h+n,d+r),u=h,l=d;break;case"a":sK(e,u+n,l+r,[o[1],o[2],o[3],o[4],o[5],o[6]+u+n,o[7]+l+r]),u+=o[6],l+=o[7];break;case"A":sK(e,u+n,l+r,[o[1],o[2],o[3],o[4],o[5],o[6]+n,o[7]+r]),u=o[6],l=o[7];break;case"z":case"Z":e.closePath();break}a=o}}function sK(e,t,n,r){const i=Jgt(r[5],r[6],r[0],r[1],r[3],r[4],r[2],t,n);for(let s=0;s<i.length;++s){const o=Qgt(i[s]);e.bezierCurveTo(o[0],o[1],o[2],o[3],o[4],o[5])}}const oK=.5773502691896257,aK={circle:{draw:function(e,t){const n=Math.sqrt(t)/2;e.moveTo(n,0),e.arc(0,0,n,0,gu)}},cross:{draw:function(e,t){var n=Math.sqrt(t)/2,r=n/2.5;e.moveTo(-n,-r),e.lineTo(-n,r),e.lineTo(-r,r),e.lineTo(-r,n),e.lineTo(r,n),e.lineTo(r,r),e.lineTo(n,r),e.lineTo(n,-r),e.lineTo(r,-r),e.lineTo(r,-n),e.lineTo(-r,-n),e.lineTo(-r,-r),e.closePath()}},diamond:{draw:function(e,t){const n=Math.sqrt(t)/2;e.moveTo(-n,0),e.lineTo(0,-n),e.lineTo(n,0),e.lineTo(0,n),e.closePath()}},square:{draw:function(e,t){var n=Math.sqrt(t),r=-n/2;e.rect(r,r,n,n)}},arrow:{draw:function(e,t){var n=Math.sqrt(t)/2,r=n/7,i=n/2.5,s=n/8;e.moveTo(-r,n),e.lineTo(r,n),e.lineTo(r,-s),e.lineTo(i,-s),e.lineTo(0,-n),e.lineTo(-i,-s),e.lineTo(-r,-s),e.closePath()}},wedge:{draw:function(e,t){var n=Math.sqrt(t)/2,r=am*n,i=r-n*oK,s=n/4;e.moveTo(0,-r-i),e.lineTo(-s,r-i),e.lineTo(s,r-i),e.closePath()}},triangle:{draw:function(e,t){var n=Math.sqrt(t)/2,r=am*n,i=r-n*oK;e.moveTo(0,-r-i),e.lineTo(-n,r-i),e.lineTo(n,r-i),e.closePath()}},"triangle-up":{draw:function(e,t){var n=Math.sqrt(t)/2,r=am*n;e.moveTo(0,-r),e.lineTo(-n,r),e.lineTo(n,r),e.closePath()}},"triangle-down":{draw:function(e,t){var n=Math.sqrt(t)/2,r=am*n;e.moveTo(0,r),e.lineTo(-n,-r),e.lineTo(n,-r),e.closePath()}},"triangle-right":{draw:function(e,t){var n=Math.sqrt(t)/2,r=am*n;e.moveTo(r,0),e.lineTo(-r,-n),e.lineTo(-r,n),e.closePath()}},"triangle-left":{draw:function(e,t){var n=Math.sqrt(t)/2,r=am*n;e.moveTo(-r,0),e.lineTo(r,-n),e.lineTo(r,n),e.closePath()}},stroke:{draw:function(e,t){const n=Math.sqrt(t)/2;e.moveTo(-n,0),e.lineTo(n,0)}}};function sme(e){return nt(aK,e)?aK[e]:tmt(e)}var _O={};function tmt(e){if(!nt(_O,e)){const t=A0(e);_O[e]={draw:function(n,r){jv(n,t,0,0,Math.sqrt(r)/2)}}}return _O[e]}const Uc=.448084975506;function nmt(e){return e.x}function rmt(e){return e.y}function imt(e){return e.width}function smt(e){return e.height}function Cl(e){return typeof e=="function"?e:()=>+e}function yS(e,t,n){return Math.max(t,Math.min(e,n))}function ome(){var e=nmt,t=rmt,n=imt,r=smt,i=Cl(0),s=i,o=i,a=i,u=null;function l(c,f,h){var d,p=f??+e.call(this,c),g=h??+t.call(this,c),m=+n.call(this,c),y=+r.call(this,c),b=Math.min(m,y)/2,v=yS(+i.call(this,c),0,b),x=yS(+s.call(this,c),0,b),w=yS(+o.call(this,c),0,b),C=yS(+a.call(this,c),0,b);if(u||(u=d=Ag()),v<=0&&x<=0&&w<=0&&C<=0)u.rect(p,g,m,y);else{var $=p+m,S=g+y;u.moveTo(p+v,g),u.lineTo($-x,g),u.bezierCurveTo($-Uc*x,g,$,g+Uc*x,$,g+x),u.lineTo($,S-C),u.bezierCurveTo($,S-Uc*C,$-Uc*C,S,$-C,S),u.lineTo(p+w,S),u.bezierCurveTo(p+Uc*w,S,p,S-Uc*w,p,S-w),u.lineTo(p,g+v),u.bezierCurveTo(p,g+Uc*v,p+Uc*v,g,p+v,g),u.closePath()}if(d)return u=null,d+""||null}return l.x=function(c){return arguments.length?(e=Cl(c),l):e},l.y=function(c){return arguments.length?(t=Cl(c),l):t},l.width=function(c){return arguments.length?(n=Cl(c),l):n},l.height=function(c){return arguments.length?(r=Cl(c),l):r},l.cornerRadius=function(c,f,h,d){return arguments.length?(i=Cl(c),s=f!=null?Cl(f):i,a=h!=null?Cl(h):i,o=d!=null?Cl(d):s,l):i},l.context=function(c){return arguments.length?(u=c??null,l):u},l}function ame(){var e,t,n,r,i=null,s,o,a,u;function l(f,h,d){const p=d/2;if(s){var g=a-h,m=f-o;if(g||m){var y=Math.sqrt(g*g+m*m),b=(g/=y)*u,v=(m/=y)*u,x=Math.atan2(m,g);i.moveTo(o-b,a-v),i.lineTo(f-g*p,h-m*p),i.arc(f,h,p,x-Math.PI,x),i.lineTo(o+b,a+v),i.arc(o,a,u,x,x+Math.PI)}else i.arc(f,h,p,0,gu);i.closePath()}else s=1;o=f,a=h,u=p}function c(f){var h,d=f.length,p,g=!1,m;for(i==null&&(i=m=Ag()),h=0;h<=d;++h)!(h<d&&r(p=f[h],h,f))===g&&(g=!g)&&(s=0),g&&l(+e(p,h,f),+t(p,h,f),+n(p,h,f));if(m)return i=null,m+""||null}return c.x=function(f){return arguments.length?(e=f,c):e},c.y=function(f){return arguments.length?(t=f,c):t},c.size=function(f){return arguments.length?(n=f,c):n},c.defined=function(f){return arguments.length?(r=f,c):r},c.context=function(f){return arguments.length?(f==null?i=null:i=f,c):i},c}function T$(e,t){return e??t}const I$=e=>e.x||0,D$=e=>e.y||0,omt=e=>e.width||0,amt=e=>e.height||0,umt=e=>(e.x||0)+(e.width||0),lmt=e=>(e.y||0)+(e.height||0),cmt=e=>e.startAngle||0,fmt=e=>e.endAngle||0,hmt=e=>e.padAngle||0,dmt=e=>e.innerRadius||0,pmt=e=>e.outerRadius||0,gmt=e=>e.cornerRadius||0,mmt=e=>T$(e.cornerRadiusTopLeft,e.cornerRadius)||0,ymt=e=>T$(e.cornerRadiusTopRight,e.cornerRadius)||0,bmt=e=>T$(e.cornerRadiusBottomRight,e.cornerRadius)||0,xmt=e=>T$(e.cornerRadiusBottomLeft,e.cornerRadius)||0,vmt=e=>T$(e.size,64),wmt=e=>e.size||1,sN=e=>e.defined!==!1,$mt=e=>sme(e.shape||"circle"),Cmt=Gpt().startAngle(cmt).endAngle(fmt).padAngle(hmt).innerRadius(dmt).outerRadius(pmt).cornerRadius(gmt),Smt=_ge().x(I$).y1(D$).y0(lmt).defined(sN),kmt=_ge().y(D$).x1(I$).x0(umt).defined(sN),Emt=Ege().x(I$).y(D$).defined(sN),_mt=ome().x(I$).y(D$).width(omt).height(amt).cornerRadius(mmt,ymt,bmt,xmt),Amt=qpt().type($mt).size(vmt),Tmt=ame().x(I$).y(D$).defined(sN).size(wmt);function d9(e){return e.cornerRadius||e.cornerRadiusTopLeft||e.cornerRadiusTopRight||e.cornerRadiusBottomRight||e.cornerRadiusBottomLeft}function Imt(e,t){return Cmt.context(e)(t)}function Dmt(e,t){const n=t[0],r=n.interpolate||"linear";return(n.orient==="horizontal"?kmt:Smt).curve(h9(r,n.orient,n.tension)).context(e)(t)}function Nmt(e,t){const n=t[0],r=n.interpolate||"linear";return Emt.curve(h9(r,n.orient,n.tension)).context(e)(t)}function xy(e,t,n,r){return _mt.context(e)(t,n,r)}function Fmt(e,t){return(t.mark.shape||t.shape).context(e)(t)}function Omt(e,t){return Amt.context(e)(t)}function Rmt(e,t){return Tmt.context(e)(t)}var ume=1;function lme(){ume=1}function p9(e,t,n){var r=t.clip,i=e._defs,s=t.clip_id||(t.clip_id="clip"+ume++),o=i.clipping[s]||(i.clipping[s]={id:s});return zt(r)?o.path=r(null):d9(n)?o.path=xy(null,n,0,0):(o.width=n.width||0,o.height=n.height||0),"url(#"+s+")"}function Ji(e){this.clear(),e&&this.union(e)}Ji.prototype={clone(){return new Ji(this)},clear(){return this.x1=+Number.MAX_VALUE,this.y1=+Number.MAX_VALUE,this.x2=-Number.MAX_VALUE,this.y2=-Number.MAX_VALUE,this},empty(){return this.x1===+Number.MAX_VALUE&&this.y1===+Number.MAX_VALUE&&this.x2===-Number.MAX_VALUE&&this.y2===-Number.MAX_VALUE},equals(e){return this.x1===e.x1&&this.y1===e.y1&&this.x2===e.x2&&this.y2===e.y2},set(e,t,n,r){return n<e?(this.x2=e,this.x1=n):(this.x1=e,this.x2=n),r<t?(this.y2=t,this.y1=r):(this.y1=t,this.y2=r),this},add(e,t){return e<this.x1&&(this.x1=e),t<this.y1&&(this.y1=t),e>this.x2&&(this.x2=e),t>this.y2&&(this.y2=t),this},expand(e){return this.x1-=e,this.y1-=e,this.x2+=e,this.y2+=e,this},round(){return this.x1=Math.floor(this.x1),this.y1=Math.floor(this.y1),this.x2=Math.ceil(this.x2),this.y2=Math.ceil(this.y2),this},scale(e){return this.x1*=e,this.y1*=e,this.x2*=e,this.y2*=e,this},translate(e,t){return this.x1+=e,this.x2+=e,this.y1+=t,this.y2+=t,this},rotate(e,t,n){const r=this.rotatedPoints(e,t,n);return this.clear().add(r[0],r[1]).add(r[2],r[3]).add(r[4],r[5]).add(r[6],r[7])},rotatedPoints(e,t,n){var{x1:r,y1:i,x2:s,y2:o}=this,a=Math.cos(e),u=Math.sin(e),l=t-t*a+n*u,c=n-t*u-n*a;return[a*r-u*i+l,u*r+a*i+c,a*r-u*o+l,u*r+a*o+c,a*s-u*i+l,u*s+a*i+c,a*s-u*o+l,u*s+a*o+c]},union(e){return e.x1<this.x1&&(this.x1=e.x1),e.y1<this.y1&&(this.y1=e.y1),e.x2>this.x2&&(this.x2=e.x2),e.y2>this.y2&&(this.y2=e.y2),this},intersect(e){return e.x1>this.x1&&(this.x1=e.x1),e.y1>this.y1&&(this.y1=e.y1),e.x2<this.x2&&(this.x2=e.x2),e.y2<this.y2&&(this.y2=e.y2),this},encloses(e){return e&&this.x1<=e.x1&&this.x2>=e.x2&&this.y1<=e.y1&&this.y2>=e.y2},alignsWith(e){return e&&(this.x1==e.x1||this.x2==e.x2||this.y1==e.y1||this.y2==e.y2)},intersects(e){return e&&!(this.x2<e.x1||this.x1>e.x2||this.y2<e.y1||this.y1>e.y2)},contains(e,t){return!(e<this.x1||e>this.x2||t<this.y1||t>this.y2)},width(){return this.x2-this.x1},height(){return this.y2-this.y1}};function g9(e){this.mark=e,this.bounds=this.bounds||new Ji}function m9(e){g9.call(this,e),this.items=this.items||[]}$e(m9,g9);function y9(e){this._pending=0,this._loader=e||c9()}function uK(e){e._pending+=1}function db(e){e._pending-=1}y9.prototype={pending(){return this._pending},sanitizeURL(e){const t=this;return uK(t),t._loader.sanitize(e,{context:"href"}).then(n=>(db(t),n)).catch(()=>(db(t),null))},loadImage(e){const t=this,n=Fce();return uK(t),t._loader.sanitize(e,{context:"image"}).then(r=>{const i=r.href;if(!i||!n)throw{url:i};const s=new n,o=nt(r,"crossOrigin")?r.crossOrigin:"anonymous";return o!=null&&(s.crossOrigin=o),s.onload=()=>db(t),s.onerror=()=>db(t),s.src=i,s}).catch(r=>(db(t),{complete:!1,width:0,height:0,src:r&&r.url||""}))},ready(){const e=this;return new Promise(t=>{function n(r){e.pending()?setTimeout(()=>{n(!0)},10):t(r)}n(!1)})}};function Tg(e,t,n){if(t.stroke&&t.opacity!==0&&t.strokeOpacity!==0){const r=t.strokeWidth!=null?+t.strokeWidth:1;e.expand(r+(n?Mmt(t,r):0))}return e}function Mmt(e,t){return e.strokeJoin&&e.strokeJoin!=="miter"?0:t}const Lmt=gu-1e-8;let oN,ok,ak,Wd,hL,uk,dL,pL;const hf=(e,t)=>oN.add(e,t),lk=(e,t)=>hf(ok=e,ak=t),lK=e=>hf(e,oN.y1),cK=e=>hf(oN.x1,e),Nd=(e,t)=>hL*e+dL*t,Fd=(e,t)=>uk*e+pL*t,AO=(e,t)=>hf(Nd(e,t),Fd(e,t)),TO=(e,t)=>lk(Nd(e,t),Fd(e,t));function N$(e,t){return oN=e,t?(Wd=t*ch,hL=pL=Math.cos(Wd),uk=Math.sin(Wd),dL=-uk):(hL=pL=1,Wd=uk=dL=0),Pmt}const Pmt={beginPath(){},closePath(){},moveTo:TO,lineTo:TO,rect(e,t,n,r){Wd?(AO(e+n,t),AO(e+n,t+r),AO(e,t+r),TO(e,t)):(hf(e+n,t+r),lk(e,t))},quadraticCurveTo(e,t,n,r){const i=Nd(e,t),s=Fd(e,t),o=Nd(n,r),a=Fd(n,r);fK(ok,i,o,lK),fK(ak,s,a,cK),lk(o,a)},bezierCurveTo(e,t,n,r,i,s){const o=Nd(e,t),a=Fd(e,t),u=Nd(n,r),l=Fd(n,r),c=Nd(i,s),f=Fd(i,s);hK(ok,o,u,c,lK),hK(ak,a,l,f,cK),lk(c,f)},arc(e,t,n,r,i,s){if(r+=Wd,i+=Wd,ok=n*Math.cos(i)+e,ak=n*Math.sin(i)+t,Math.abs(i-r)>Lmt)hf(e-n,t-n),hf(e+n,t+n);else{const o=l=>hf(n*Math.cos(l)+e,n*Math.sin(l)+t);let a,u;if(o(r),o(i),i!==r)if(r=r%gu,r<0&&(r+=gu),i=i%gu,i<0&&(i+=gu),i<r&&(s=!s,a=r,r=i,i=a),s)for(i-=gu,a=r-r%Dd,u=0;u<4&&a>i;++u,a-=Dd)o(a);else for(a=r-r%Dd+Dd,u=0;u<4&&a<i;++u,a=a+Dd)o(a)}}};function fK(e,t,n,r){const i=(e-t)/(e+n-2*t);0<i&&i<1&&r(e+(t-e)*i)}function hK(e,t,n,r,i){const s=r-e+3*t-3*n,o=e+n-2*t,a=e-t;let u=0,l=0,c;Math.abs(s)>Zgt?(c=o*o+a*s,c>=0&&(c=Math.sqrt(c),u=(-o+c)/s,l=(-o-c)/s)):u=.5*a/o,0<u&&u<1&&i(dK(u,e,t,n,r)),0<l&&l<1&&i(dK(l,e,t,n,r))}function dK(e,t,n,r,i){const s=1-e,o=s*s,a=e*e;return o*s*t+3*o*e*n+3*s*a*r+a*e*i}var If=(If=Ec(1,1))?If.getContext("2d"):null;const gL=new Ji;function b9(e){return function(t,n){if(!If)return!0;e(If,t),gL.clear().union(t.bounds).intersect(n).round();const{x1:r,y1:i,x2:s,y2:o}=gL;for(let a=i;a<=o;++a)for(let u=r;u<=s;++u)if(If.isPointInPath(u,a))return!0;return!1}}function x9(e,t){return t.contains(e.x||0,e.y||0)}function cme(e,t){const n=e.x||0,r=e.y||0,i=e.width||0,s=e.height||0;return t.intersects(gL.set(n,r,n+i,r+s))}function fme(e,t){const n=e.x||0,r=e.y||0,i=e.x2!=null?e.x2:n,s=e.y2!=null?e.y2:r;return $m(t,n,r,i,s)}function $m(e,t,n,r,i){const{x1:s,y1:o,x2:a,y2:u}=e,l=r-t,c=i-n;let f=0,h=1,d,p,g,m;for(m=0;m<4;++m){if(m===0&&(d=-l,p=-(s-t)),m===1&&(d=l,p=a-t),m===2&&(d=-c,p=-(o-n)),m===3&&(d=c,p=u-n),Math.abs(d)<1e-10&&p<0)return!1;if(g=p/d,d<0){if(g>h)return!1;g>f&&(f=g)}else if(d>0){if(g<f)return!1;g<h&&(h=g)}}return!0}function T0(e,t){e.globalCompositeOperation=t.blend||"source-over"}function ra(e,t){return e??t}function pK(e,t){const n=t.length;for(let r=0;r<n;++r)e.addColorStop(t[r].offset,t[r].color);return e}function Bmt(e,t,n){const r=n.width(),i=n.height();let s;if(t.gradient==="radial")s=e.createRadialGradient(n.x1+ra(t.x1,.5)*r,n.y1+ra(t.y1,.5)*i,Math.max(r,i)*ra(t.r1,0),n.x1+ra(t.x2,.5)*r,n.y1+ra(t.y2,.5)*i,Math.max(r,i)*ra(t.r2,.5));else{const o=ra(t.x1,0),a=ra(t.y1,0),u=ra(t.x2,1),l=ra(t.y2,0);if(o===u||a===l||r===i)s=e.createLinearGradient(n.x1+o*r,n.y1+a*i,n.x1+u*r,n.y1+l*i);else{const c=Ec(Math.ceil(r),Math.ceil(i)),f=c.getContext("2d");return f.scale(r,i),f.fillStyle=pK(f.createLinearGradient(o,a,u,l),t.stops),f.fillRect(0,0,r,i),e.createPattern(c,"no-repeat")}}return pK(s,t.stops)}function hme(e,t,n){return f9(n)?Bmt(e,n,t.bounds):n}function A_(e,t,n){return n*=t.fillOpacity==null?1:t.fillOpacity,n>0?(e.globalAlpha=n,e.fillStyle=hme(e,t,t.fill),!0):!1}var zmt=[];function I0(e,t,n){var r=(r=t.strokeWidth)!=null?r:1;return r<=0?!1:(n*=t.strokeOpacity==null?1:t.strokeOpacity,n>0?(e.globalAlpha=n,e.strokeStyle=hme(e,t,t.stroke),e.lineWidth=r,e.lineCap=t.strokeCap||"butt",e.lineJoin=t.strokeJoin||"miter",e.miterLimit=t.strokeMiterLimit||10,e.setLineDash&&(e.setLineDash(t.strokeDash||zmt),e.lineDashOffset=t.strokeDashOffset||0),!0):!1)}function Umt(e,t){return e.zindex-t.zindex||e.index-t.index}function v9(e){if(!e.zdirty)return e.zitems;var t=e.items,n=[],r,i,s;for(i=0,s=t.length;i<s;++i)r=t[i],r.index=i,r.zindex&&n.push(r);return e.zdirty=!1,e.zitems=n.sort(Umt)}function Ma(e,t){var n=e.items,r,i;if(!n||!n.length)return;const s=v9(e);if(s&&s.length){for(r=0,i=n.length;r<i;++r)n[r].zindex||t(n[r]);n=s}for(r=0,i=n.length;r<i;++r)t(n[r])}function T_(e,t){var n=e.items,r,i;if(!n||!n.length)return null;const s=v9(e);for(s&&s.length&&(n=s),i=n.length;--i>=0;)if(r=t(n[i]))return r;if(n===s){for(n=e.items,i=n.length;--i>=0;)if(!n[i].zindex&&(r=t(n[i])))return r}return null}function w9(e){return function(t,n,r){Ma(n,i=>{(!r||r.intersects(i.bounds))&&dme(e,t,i,i)})}}function jmt(e){return function(t,n,r){n.items.length&&(!r||r.intersects(n.bounds))&&dme(e,t,n.items[0],n.items)}}function dme(e,t,n,r){var i=n.opacity==null?1:n.opacity;i!==0&&(e(t,r)||(T0(t,n),n.fill&&A_(t,n,i)&&t.fill(),n.stroke&&I0(t,n,i)&&t.stroke()))}function aN(e){return e=e||ny,function(t,n,r,i,s,o){return r*=t.pixelRatio,i*=t.pixelRatio,T_(n,a=>{const u=a.bounds;if(!(u&&!u.contains(s,o)||!u)&&e(t,a,r,i,s,o))return a})}}function F$(e,t){return function(n,r,i,s){var o=Array.isArray(r)?r[0]:r,a=t??o.fill,u=o.stroke&&n.isPointInStroke,l,c;return u&&(l=o.strokeWidth,c=o.strokeCap,n.lineWidth=l??1,n.lineCap=c??"butt"),e(n,r)?!1:a&&n.isPointInPath(i,s)||u&&n.isPointInStroke(i,s)}}function $9(e){return aN(F$(e))}function sp(e,t){return"translate("+e+","+t+")"}function C9(e){return"rotate("+e+")"}function Wmt(e,t){return"scale("+e+","+t+")"}function pme(e){return sp(e.x||0,e.y||0)}function Vmt(e){return sp(e.x||0,e.y||0)+(e.angle?" "+C9(e.angle):"")}function Gmt(e){return sp(e.x||0,e.y||0)+(e.angle?" "+C9(e.angle):"")+(e.scaleX||e.scaleY?" "+Wmt(e.scaleX||1,e.scaleY||1):"")}function S9(e,t,n){function r(o,a){o("transform",Vmt(a)),o("d",t(null,a))}function i(o,a){return t(N$(o,a.angle),a),Tg(o,a).translate(a.x||0,a.y||0)}function s(o,a){var u=a.x||0,l=a.y||0,c=a.angle||0;o.translate(u,l),c&&o.rotate(c*=ch),o.beginPath(),t(o,a),c&&o.rotate(-c),o.translate(-u,-l)}return{type:e,tag:"path",nested:!1,attr:r,bound:i,draw:w9(s),pick:$9(s),isect:n||b9(s)}}var Hmt=S9("arc",Imt);function qmt(e,t){for(var n=e[0].orient==="horizontal"?t[1]:t[0],r=e[0].orient==="horizontal"?"y":"x",i=e.length,s=1/0,o,a;--i>=0;)e[i].defined!==!1&&(a=Math.abs(e[i][r]-n),a<s&&(s=a,o=e[i]));return o}function Xmt(e,t){for(var n=Math.pow(e[0].strokeWidth||1,2),r=e.length,i,s,o;--r>=0;)if(e[r].defined!==!1&&(i=e[r].x-t[0],s=e[r].y-t[1],o=i*i+s*s,o<n))return e[r];return null}function Ymt(e,t){for(var n=e.length,r,i,s;--n>=0;)if(e[n].defined!==!1&&(r=e[n].x-t[0],i=e[n].y-t[1],s=r*r+i*i,r=e[n].size||1,s<r*r))return e[n];return null}function k9(e,t,n){function r(u,l){var c=l.mark.items;c.length&&u("d",t(null,c))}function i(u,l){var c=l.items;return c.length===0?u:(t(N$(u),c),Tg(u,c[0]))}function s(u,l){u.beginPath(),t(u,l)}const o=F$(s);function a(u,l,c,f,h,d){var p=l.items,g=l.bounds;return!p||!p.length||g&&!g.contains(h,d)?null:(c*=u.pixelRatio,f*=u.pixelRatio,o(u,p,c,f)?p[0]:null)}return{type:e,tag:"path",nested:!0,attr:r,bound:i,draw:jmt(s),pick:a,isect:x9,tip:n}}var Kmt=k9("area",Dmt,qmt);function Zmt(e,t){var n=t.clip;e.save(),zt(n)?(e.beginPath(),n(e),e.clip()):gme(e,t.group)}function gme(e,t){e.beginPath(),d9(t)?xy(e,t,0,0):e.rect(0,0,t.width||0,t.height||0),e.clip()}function mme(e){const t=ra(e.strokeWidth,1);return e.strokeOffset!=null?e.strokeOffset:e.stroke&&t>.5&&t<1.5?.5-Math.abs(t-1):0}function Jmt(e,t){e("transform",pme(t))}function yme(e,t){const n=mme(t);e("d",xy(null,t,n,n))}function Qmt(e,t){e("class","background"),e("aria-hidden",!0),yme(e,t)}function e0t(e,t){e("class","foreground"),e("aria-hidden",!0),t.strokeForeground?yme(e,t):e("d","")}function t0t(e,t,n){const r=t.clip?p9(n,t,t):null;e("clip-path",r)}function n0t(e,t){if(!t.clip&&t.items){const n=t.items,r=n.length;for(let i=0;i<r;++i)e.union(n[i].bounds)}return(t.clip||t.width||t.height)&&!t.noBound&&e.add(0,0).add(t.width||0,t.height||0),Tg(e,t),e.translate(t.x||0,t.y||0)}function Wv(e,t,n,r){const i=mme(t);e.beginPath(),xy(e,t,(n||0)+i,(r||0)+i)}const r0t=F$(Wv),i0t=F$(Wv,!1),s0t=F$(Wv,!0);function o0t(e,t,n){Ma(t,r=>{const i=r.x||0,s=r.y||0,o=r.strokeForeground,a=r.opacity==null?1:r.opacity;(r.stroke||r.fill)&&a&&(Wv(e,r,i,s),T0(e,r),r.fill&&A_(e,r,a)&&e.fill(),r.stroke&&!o&&I0(e,r,a)&&e.stroke()),e.save(),e.translate(i,s),r.clip&&gme(e,r),n&&n.translate(-i,-s),Ma(r,u=>{this.draw(e,u,n)}),n&&n.translate(i,s),e.restore(),o&&r.stroke&&a&&(Wv(e,r,i,s),T0(e,r),I0(e,r,a)&&e.stroke())})}function a0t(e,t,n,r,i,s){if(t.bounds&&!t.bounds.contains(i,s)||!t.items)return null;const o=n*e.pixelRatio,a=r*e.pixelRatio;return T_(t,u=>{let l,c,f;const h=u.bounds;if(h&&!h.contains(i,s))return;c=u.x||0,f=u.y||0;const d=c+(u.width||0),p=f+(u.height||0),g=u.clip;if(g&&(i<c||i>d||s<f||s>p))return;if(e.save(),e.translate(c,f),c=i-c,f=s-f,g&&d9(u)&&!s0t(e,u,o,a))return e.restore(),null;const m=u.strokeForeground,y=t.interactive!==!1;return y&&m&&u.stroke&&i0t(e,u,o,a)?(e.restore(),u):(l=T_(u,b=>u0t(b,c,f)?this.pick(b,n,r,c,f):null),!l&&y&&(u.fill||!m&&u.stroke)&&r0t(e,u,o,a)&&(l=u),e.restore(),l||null)})}function u0t(e,t,n){return(e.interactive!==!1||e.marktype==="group")&&e.bounds&&e.bounds.contains(t,n)}var l0t={type:"group",tag:"g",nested:!1,attr:Jmt,bound:n0t,draw:o0t,pick:a0t,isect:cme,content:t0t,background:Qmt,foreground:e0t},Vv={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",version:"1.1"};function E9(e,t){var n=e.image;return(!n||e.url&&e.url!==n.url)&&(n={complete:!1,width:0,height:0},t.loadImage(e.url).then(r=>{e.image=r,e.image.url=e.url})),n}function _9(e,t){return e.width!=null?e.width:!t||!t.width?0:e.aspect!==!1&&e.height?e.height*t.width/t.height:t.width}function A9(e,t){return e.height!=null?e.height:!t||!t.height?0:e.aspect!==!1&&e.width?e.width*t.height/t.width:t.height}function uN(e,t){return e==="center"?t/2:e==="right"?t:0}function lN(e,t){return e==="middle"?t/2:e==="bottom"?t:0}function c0t(e,t,n){const r=E9(t,n),i=_9(t,r),s=A9(t,r),o=(t.x||0)-uN(t.align,i),a=(t.y||0)-lN(t.baseline,s),u=!r.src&&r.toDataURL?r.toDataURL():r.src||"";e("href",u,Vv["xmlns:xlink"],"xlink:href"),e("transform",sp(o,a)),e("width",i),e("height",s),e("preserveAspectRatio",t.aspect===!1?"none":"xMidYMid")}function f0t(e,t){const n=t.image,r=_9(t,n),i=A9(t,n),s=(t.x||0)-uN(t.align,r),o=(t.y||0)-lN(t.baseline,i);return e.set(s,o,s+r,o+i)}function h0t(e,t,n){Ma(t,r=>{if(n&&!n.intersects(r.bounds))return;const i=E9(r,this);let s=_9(r,i),o=A9(r,i);if(s===0||o===0)return;let a=(r.x||0)-uN(r.align,s),u=(r.y||0)-lN(r.baseline,o),l,c,f,h;r.aspect!==!1&&(c=i.width/i.height,f=r.width/r.height,c===c&&f===f&&c!==f&&(f<c?(h=s/c,u+=(o-h)/2,o=h):(h=o*c,a+=(s-h)/2,s=h))),(i.complete||i.toDataURL)&&(T0(e,r),e.globalAlpha=(l=r.opacity)!=null?l:1,e.imageSmoothingEnabled=r.smooth!==!1,e.drawImage(i,a,u,s,o))})}var d0t={type:"image",tag:"image",nested:!1,attr:c0t,bound:f0t,draw:h0t,pick:aN(),isect:ny,get:E9,xOffset:uN,yOffset:lN},p0t=k9("line",Nmt,Xmt);function g0t(e,t){var n=t.scaleX||1,r=t.scaleY||1;(n!==1||r!==1)&&e("vector-effect","non-scaling-stroke"),e("transform",Gmt(t)),e("d",t.path)}function ck(e,t){var n=t.path;if(n==null)return!0;var r=t.x||0,i=t.y||0,s=t.scaleX||1,o=t.scaleY||1,a=(t.angle||0)*ch,u=t.pathCache;(!u||u.path!==n)&&((t.pathCache=u=A0(n)).path=n),a&&e.rotate&&e.translate?(e.translate(r,i),e.rotate(a),jv(e,u,0,0,s,o),e.rotate(-a),e.translate(-r,-i)):jv(e,u,r,i,s,o)}function m0t(e,t){return ck(N$(e,t.angle),t)?e.set(0,0,0,0):Tg(e,t,!0)}var y0t={type:"path",tag:"path",nested:!1,attr:g0t,bound:m0t,draw:w9(ck),pick:$9(ck),isect:b9(ck)};function b0t(e,t){e("d",xy(null,t))}function x0t(e,t){var n,r;return Tg(e.set(n=t.x||0,r=t.y||0,n+t.width||0,r+t.height||0),t)}function gK(e,t){e.beginPath(),xy(e,t)}var v0t={type:"rect",tag:"path",nested:!1,attr:b0t,bound:x0t,draw:w9(gK),pick:$9(gK),isect:cme};function w0t(e,t){e("transform",pme(t)),e("x2",t.x2!=null?t.x2-(t.x||0):0),e("y2",t.y2!=null?t.y2-(t.y||0):0)}function $0t(e,t){var n,r;return Tg(e.set(n=t.x||0,r=t.y||0,t.x2!=null?t.x2:n,t.y2!=null?t.y2:r),t)}function bme(e,t,n){var r,i,s,o;return t.stroke&&I0(e,t,n)?(r=t.x||0,i=t.y||0,s=t.x2!=null?t.x2:r,o=t.y2!=null?t.y2:i,e.beginPath(),e.moveTo(r,i),e.lineTo(s,o),!0):!1}function C0t(e,t,n){Ma(t,r=>{if(!(n&&!n.intersects(r.bounds))){var i=r.opacity==null?1:r.opacity;i&&bme(e,r,i)&&(T0(e,r),e.stroke())}})}function S0t(e,t,n,r){return e.isPointInStroke?bme(e,t,1)&&e.isPointInStroke(n,r):!1}var k0t={type:"rule",tag:"line",nested:!1,attr:w0t,bound:$0t,draw:C0t,pick:aN(S0t),isect:fme},E0t=S9("shape",Fmt),_0t=S9("symbol",Omt,x9);const mK=Kae();var Iu={height:rl,measureWidth:T9,estimateWidth:mL,width:mL,canvas:xme};xme(!0);function xme(e){Iu.width=e&&If?T9:mL}function mL(e,t){return vme(hh(e,t),rl(e))}function vme(e,t){return~~(.8*e.length*t)}function T9(e,t){return rl(e)<=0||!(t=hh(e,t))?0:wme(t,cN(e))}function wme(e,t){const n=`(${t}) ${e}`;let r=mK.get(n);return r===void 0&&(If.font=t,r=If.measureText(e).width,mK.set(n,r)),r}function rl(e){return e.fontSize!=null?+e.fontSize||0:11}function fh(e){return e.lineHeight!=null?e.lineHeight:rl(e)+2}function A0t(e){return it(e)?e.length>1?e:e[0]:e}function O$(e){return A0t(e.lineBreak&&e.text&&!it(e.text)?e.text.split(e.lineBreak):e.text)}function T0t(e){const t=O$(e);return(it(t)?t.length-1:0)*fh(e)}function hh(e,t){const n=t==null?"":(t+"").trim();return e.limit>0&&n.length?D0t(e,n):n}function I0t(e){if(Iu.width===T9){const t=cN(e);return n=>wme(n,t)}else{const t=rl(e);return n=>vme(n,t)}}function D0t(e,t){var n=+e.limit,r=I0t(e);if(r(t)<n)return t;var i=e.ellipsis||"",s=e.dir==="rtl",o=0,a=t.length,u;if(n-=r(i),s){for(;o<a;)u=o+a>>>1,r(t.slice(u))>n?o=u+1:a=u;return i+t.slice(o)}else{for(;o<a;)u=1+(o+a>>>1),r(t.slice(0,u))<n?o=u:a=u-1;return t.slice(0,o)+i}}function R$(e,t){var n=e.font;return(t&&n?String(n).replace(/"/g,"'"):n)||"sans-serif"}function cN(e,t){return(e.fontStyle?e.fontStyle+" ":"")+(e.fontVariant?e.fontVariant+" ":"")+(e.fontWeight?e.fontWeight+" ":"")+rl(e)+"px "+R$(e,t)}function I9(e){var t=e.baseline,n=rl(e);return Math.round(t==="top"?.79*n:t==="middle"?.3*n:t==="bottom"?-.21*n:t==="line-top"?.29*n+.5*fh(e):t==="line-bottom"?.29*n-.5*fh(e):0)}const N0t={left:"start",center:"middle",right:"end"},bx=new Ji;function fN(e){var t=e.x||0,n=e.y||0,r=e.radius||0,i;return r&&(i=(e.theta||0)-Dd,t+=r*Math.cos(i),n+=r*Math.sin(i)),bx.x1=t,bx.y1=n,bx}function F0t(e,t){var n=t.dx||0,r=(t.dy||0)+I9(t),i=fN(t),s=i.x1,o=i.y1,a=t.angle||0,u;e("text-anchor",N0t[t.align]||"start"),a?(u=sp(s,o)+" "+C9(a),(n||r)&&(u+=" "+sp(n,r))):u=sp(s+n,o+r),e("transform",u)}function D9(e,t,n){var r=Iu.height(t),i=t.align,s=fN(t),o=s.x1,a=s.y1,u=t.dx||0,l=(t.dy||0)+I9(t)-Math.round(.8*r),c=O$(t),f;if(it(c)?(r+=fh(t)*(c.length-1),f=c.reduce((h,d)=>Math.max(h,Iu.width(t,d)),0)):f=Iu.width(t,c),i==="center"?u-=f/2:i==="right"&&(u-=f),e.set(u+=o,l+=a,u+f,l+r),t.angle&&!n)e.rotate(t.angle*ch,o,a);else if(n===2)return e.rotatedPoints(t.angle*ch,o,a);return e}function O0t(e,t,n){Ma(t,r=>{var i=r.opacity==null?1:r.opacity,s,o,a,u,l,c,f;if(!(n&&!n.intersects(r.bounds)||i===0||r.fontSize<=0||r.text==null||r.text.length===0)){if(e.font=cN(r),e.textAlign=r.align||"left",s=fN(r),o=s.x1,a=s.y1,r.angle&&(e.save(),e.translate(o,a),e.rotate(r.angle*ch),o=a=0),o+=r.dx||0,a+=(r.dy||0)+I9(r),c=O$(r),T0(e,r),it(c))for(l=fh(r),u=0;u<c.length;++u)f=hh(r,c[u]),r.fill&&A_(e,r,i)&&e.fillText(f,o,a),r.stroke&&I0(e,r,i)&&e.strokeText(f,o,a),a+=l;else f=hh(r,c),r.fill&&A_(e,r,i)&&e.fillText(f,o,a),r.stroke&&I0(e,r,i)&&e.strokeText(f,o,a);r.angle&&e.restore()}})}function R0t(e,t,n,r,i,s){if(t.fontSize<=0)return!1;if(!t.angle)return!0;var o=fN(t),a=o.x1,u=o.y1,l=D9(bx,t,1),c=-t.angle*ch,f=Math.cos(c),h=Math.sin(c),d=f*i-h*s+(a-f*a+h*u),p=h*i+f*s+(u-h*a-f*u);return l.contains(d,p)}function M0t(e,t){const n=D9(bx,e,2);return $m(t,n[0],n[1],n[2],n[3])||$m(t,n[0],n[1],n[4],n[5])||$m(t,n[4],n[5],n[6],n[7])||$m(t,n[2],n[3],n[6],n[7])}var L0t={type:"text",tag:"text",nested:!1,attr:F0t,bound:D9,draw:O0t,pick:aN(R0t),isect:M0t},P0t=k9("trail",Rmt,Ymt),jo={arc:Hmt,area:Kmt,group:l0t,image:d0t,line:p0t,path:y0t,rect:v0t,rule:k0t,shape:E0t,symbol:_0t,text:L0t,trail:P0t};function yL(e,t,n){var r=jo[e.mark.marktype],i=t||r.bound;return r.nested&&(e=e.mark),i(e.bounds||(e.bounds=new Ji),e,n)}var yK={mark:null};function $me(e,t,n){var r=jo[e.marktype],i=r.bound,s=e.items,o=s&&s.length,a,u,l,c;if(r.nested)return o?l=s[0]:(yK.mark=e,l=yK),c=yL(l,i,n),t=t&&t.union(c)||c,t;if(t=t||e.bounds&&e.bounds.clear()||new Ji,o)for(a=0,u=s.length;a<u;++a)t.union(yL(s[a],i,n));return e.bounds=t}const B0t=["marktype","name","role","interactive","clip","items","zindex","x","y","width","height","align","baseline","fill","fillOpacity","opacity","blend","stroke","strokeOpacity","strokeWidth","strokeCap","strokeDash","strokeDashOffset","strokeForeground","strokeOffset","startAngle","endAngle","innerRadius","outerRadius","cornerRadius","padAngle","cornerRadiusTopLeft","cornerRadiusTopRight","cornerRadiusBottomLeft","cornerRadiusBottomRight","interpolate","tension","orient","defined","url","aspect","smooth","path","scaleX","scaleY","x2","y2","size","shape","text","angle","theta","radius","dir","dx","dy","ellipsis","limit","lineBreak","lineHeight","font","fontSize","fontWeight","fontStyle","fontVariant","description","aria","ariaRole","ariaRoleDescription"];function Cme(e,t){return JSON.stringify(e,B0t,t)}function Sme(e){const t=typeof e=="string"?JSON.parse(e):e;return kme(t)}function kme(e){var t=e.marktype,n=e.items,r,i,s;if(n)for(i=0,s=n.length;i<s;++i)r=t?"mark":"group",n[i][r]=e,n[i].zindex&&(n[i][r].zdirty=!0),(t||r)==="group"&&kme(n[i]);return t&&$me(e),e}function N9(e){arguments.length?this.root=Sme(e):(this.root=Eme({marktype:"group",name:"root",role:"frame"}),this.root.items=[new m9(this.root)])}N9.prototype={toJSON(e){return Cme(this.root,e||0)},mark(e,t,n){t=t||this.root.items[0];const r=Eme(e,t);return t.items[n]=r,r.zindex&&(r.group.zdirty=!0),r}};function Eme(e,t){const n={bounds:new Ji,clip:!!e.clip,group:t,interactive:e.interactive!==!1,items:[],marktype:e.marktype,name:e.name||void 0,role:e.role||void 0,zindex:e.zindex||0};return e.aria!=null&&(n.aria=e.aria),e.description&&(n.description=e.description),n}function df(e,t,n){return!e&&typeof document<"u"&&document.createElement&&(e=document),e?n?e.createElementNS(n,t):e.createElement(t):null}function F9(e,t){t=t.toLowerCase();for(var n=e.childNodes,r=0,i=n.length;r<i;++r)if(n[r].tagName.toLowerCase()===t)return n[r]}function ys(e,t,n,r){var i=e.childNodes[t],s;return(!i||i.tagName.toLowerCase()!==n.toLowerCase())&&(s=i||null,i=df(e.ownerDocument,n,r),e.insertBefore(i,s)),i}function ba(e,t){for(var n=e.childNodes,r=n.length;r>t;)e.removeChild(n[--r]);return e}function _me(e){return"mark-"+e.marktype+(e.role?" role-"+e.role:"")+(e.name?" "+e.name:"")}function hN(e,t){const n=t.getBoundingClientRect();return[e.clientX-n.left-(t.clientLeft||0),e.clientY-n.top-(t.clientTop||0)]}function z0t(e,t,n,r){var i=e&&e.mark,s,o;if(i&&(s=jo[i.marktype]).tip){for(o=hN(t,n),o[0]-=r[0],o[1]-=r[1];e=e.mark.group;)o[0]-=e.x||0,o[1]-=e.y||0;e=s.tip(i.items,o)}return e}function dh(e,t){this._active=null,this._handlers={},this._loader=e||c9(),this._tooltip=t||U0t}function U0t(e,t,n,r){e.element().setAttribute("title",r||"")}dh.prototype={initialize(e,t,n){return this._el=e,this._obj=n||null,this.origin(t)},element(){return this._el},canvas(){return this._el&&this._el.firstChild},origin(e){return arguments.length?(this._origin=e||[0,0],this):this._origin.slice()},scene(e){return arguments.length?(this._scene=e,this):this._scene},on(){},off(){},_handlerIndex(e,t,n){for(let r=e?e.length:0;--r>=0;)if(e[r].type===t&&(!n||e[r].handler===n))return r;return-1},handlers(e){const t=this._handlers,n=[];if(e)n.push(...t[this.eventName(e)]);else for(const r in t)n.push(...t[r]);return n},eventName(e){const t=e.indexOf(".");return t<0?e:e.slice(0,t)},handleHref(e,t,n){this._loader.sanitize(n,{context:"href"}).then(r=>{const i=new MouseEvent(e.type,e),s=df(null,"a");for(const o in r)s.setAttribute(o,r[o]);s.dispatchEvent(i)}).catch(()=>{})},handleTooltip(e,t,n){if(t&&t.tooltip!=null){t=z0t(t,e,this.canvas(),this._origin);const r=n&&t&&t.tooltip||null;this._tooltip.call(this._obj,this,e,t,r)}},getItemBoundingClientRect(e){const t=this.canvas();if(!t)return;const n=t.getBoundingClientRect(),r=this._origin,i=e.bounds,s=i.width(),o=i.height();let a=i.x1+r[0]+n.left,u=i.y1+r[1]+n.top;for(;e.mark&&(e=e.mark.group);)a+=e.x||0,u+=e.y||0;return{x:a,y:u,width:s,height:o,left:a,top:u,right:a+s,bottom:u+o}}};function il(e){this._el=null,this._bgcolor=null,this._loader=new y9(e)}il.prototype={initialize(e,t,n,r,i){return this._el=e,this.resize(t,n,r,i)},element(){return this._el},canvas(){return this._el&&this._el.firstChild},background(e){return arguments.length===0?this._bgcolor:(this._bgcolor=e,this)},resize(e,t,n,r){return this._width=e,this._height=t,this._origin=n||[0,0],this._scale=r||1,this},dirty(){},render(e){const t=this;return t._call=function(){t._render(e)},t._call(),t._call=null,t},_render(){},renderAsync(e){const t=this.render(e);return this._ready?this._ready.then(()=>t):Promise.resolve(t)},_load(e,t){var n=this,r=n._loader[e](t);if(!n._ready){const i=n._call;n._ready=n._loader.ready().then(s=>{s&&i(),n._ready=null})}return r},sanitizeURL(e){return this._load("sanitizeURL",e)},loadImage(e){return this._load("loadImage",e)}};const j0t="keydown",W0t="keypress",V0t="keyup",Ame="dragenter",fk="dragleave",Tme="dragover",bL="mousedown",G0t="mouseup",I_="mousemove",xx="mouseout",Ime="mouseover",D_="click",H0t="dblclick",q0t="wheel",Dme="mousewheel",N_="touchstart",F_="touchmove",O_="touchend",X0t=[j0t,W0t,V0t,Ame,fk,Tme,bL,G0t,I_,xx,Ime,D_,H0t,q0t,Dme,N_,F_,O_],xL=I_,Gv=xx,vL=D_;function M$(e,t){dh.call(this,e,t),this._down=null,this._touch=null,this._first=!0,this._events={}}const Y0t=e=>e===N_||e===F_||e===O_?[N_,F_,O_]:[e];function bK(e,t){Y0t(t).forEach(n=>K0t(e,n))}function K0t(e,t){const n=e.canvas();n&&!e._events[t]&&(e._events[t]=1,n.addEventListener(t,e[t]?r=>e[t](r):r=>e.fire(t,r)))}function xK(e,t,n){return function(r){const i=this._active,s=this.pickEvent(r);s===i?this.fire(e,r):((!i||!i.exit)&&this.fire(n,r),this._active=s,this.fire(t,r),this.fire(e,r))}}function vK(e){return function(t){this.fire(e,t),this._active=null}}$e(M$,dh,{initialize(e,t,n){return this._canvas=e&&F9(e,"canvas"),[D_,bL,I_,xx,fk].forEach(r=>bK(this,r)),dh.prototype.initialize.call(this,e,t,n)},canvas(){return this._canvas},context(){return this._canvas.getContext("2d")},events:X0t,DOMMouseScroll(e){this.fire(Dme,e)},mousemove:xK(I_,Ime,xx),dragover:xK(Tme,Ame,fk),mouseout:vK(xx),dragleave:vK(fk),mousedown(e){this._down=this._active,this.fire(bL,e)},click(e){this._down===this._active&&(this.fire(D_,e),this._down=null)},touchstart(e){this._touch=this.pickEvent(e.changedTouches[0]),this._first&&(this._active=this._touch,this._first=!1),this.fire(N_,e,!0)},touchmove(e){this.fire(F_,e,!0)},touchend(e){this.fire(O_,e,!0),this._touch=null},fire(e,t,n){const r=n?this._touch:this._active,i=this._handlers[e];if(t.vegaType=e,e===vL&&r&&r.href?this.handleHref(t,r,r.href):(e===xL||e===Gv)&&this.handleTooltip(t,r,e!==Gv),i)for(let s=0,o=i.length;s<o;++s)i[s].handler.call(this._obj,t,r)},on(e,t){const n=this.eventName(e),r=this._handlers;return this._handlerIndex(r[n],e,t)<0&&(bK(this,e),(r[n]||(r[n]=[])).push({type:e,handler:t})),this},off(e,t){const n=this.eventName(e),r=this._handlers[n],i=this._handlerIndex(r,e,t);return i>=0&&r.splice(i,1),this},pickEvent(e){const t=hN(e,this._canvas),n=this._origin;return this.pick(this._scene,t[0],t[1],t[0]-n[0],t[1]-n[1])},pick(e,t,n,r,i){const s=this.context();return jo[e.marktype].pick.call(this,s,e,t,n,r,i)}});function Z0t(){return typeof window<"u"&&window.devicePixelRatio||1}var J0t=Z0t();function Q0t(e,t,n,r,i,s){const o=typeof HTMLElement<"u"&&e instanceof HTMLElement&&e.parentNode!=null,a=e.getContext("2d"),u=o?J0t:i;e.width=t*u,e.height=n*u;for(const l in s)a[l]=s[l];return o&&u!==1&&(e.style.width=t+"px",e.style.height=n+"px"),a.pixelRatio=u,a.setTransform(u,0,0,u,u*r[0],u*r[1]),e}function R_(e){il.call(this,e),this._options={},this._redraw=!1,this._dirty=new Ji,this._tempb=new Ji}const wK=il.prototype,e1t=(e,t,n)=>new Ji().set(0,0,t,n).translate(-e[0],-e[1]);function t1t(e,t,n){return t.expand(1).round(),e.pixelRatio%1&&t.scale(e.pixelRatio).round().scale(1/e.pixelRatio),t.translate(-(n[0]%1),-(n[1]%1)),e.beginPath(),e.rect(t.x1,t.y1,t.width(),t.height()),e.clip(),t}$e(R_,il,{initialize(e,t,n,r,i,s){return this._options=s||{},this._canvas=this._options.externalContext?null:Ec(1,1,this._options.type),e&&this._canvas&&(ba(e,0).appendChild(this._canvas),this._canvas.setAttribute("class","marks")),wK.initialize.call(this,e,t,n,r,i)},resize(e,t,n,r){if(wK.resize.call(this,e,t,n,r),this._canvas)Q0t(this._canvas,this._width,this._height,this._origin,this._scale,this._options.context);else{const i=this._options.externalContext;i||le("CanvasRenderer is missing a valid canvas or context"),i.scale(this._scale,this._scale),i.translate(this._origin[0],this._origin[1])}return this._redraw=!0,this},canvas(){return this._canvas},context(){return this._options.externalContext||(this._canvas?this._canvas.getContext("2d"):null)},dirty(e){const t=this._tempb.clear().union(e.bounds);let n=e.mark.group;for(;n;)t.translate(n.x||0,n.y||0),n=n.mark.group;this._dirty.union(t)},_render(e){const t=this.context(),n=this._origin,r=this._width,i=this._height,s=this._dirty,o=e1t(n,r,i);t.save();const a=this._redraw||s.empty()?(this._redraw=!1,o.expand(1)):t1t(t,o.intersect(s),n);return this.clear(-n[0],-n[1],r,i),this.draw(t,e,a),t.restore(),s.clear(),this},draw(e,t,n){const r=jo[t.marktype];t.clip&&Zmt(e,t),r.draw.call(this,e,t,n),t.clip&&e.restore()},clear(e,t,n,r){const i=this._options,s=this.context();i.type!=="pdf"&&!i.externalContext&&s.clearRect(e,t,n,r),this._bgcolor!=null&&(s.fillStyle=this._bgcolor,s.fillRect(e,t,n,r))}});function O9(e,t){dh.call(this,e,t);const n=this;n._hrefHandler=wL(n,(r,i)=>{i&&i.href&&n.handleHref(r,i,i.href)}),n._tooltipHandler=wL(n,(r,i)=>{n.handleTooltip(r,i,r.type!==Gv)})}const wL=(e,t)=>n=>{let r=n.target.__data__;r=Array.isArray(r)?r[0]:r,n.vegaType=n.type,t.call(e._obj,n,r)};$e(O9,dh,{initialize(e,t,n){let r=this._svg;return r&&(r.removeEventListener(vL,this._hrefHandler),r.removeEventListener(xL,this._tooltipHandler),r.removeEventListener(Gv,this._tooltipHandler)),this._svg=r=e&&F9(e,"svg"),r&&(r.addEventListener(vL,this._hrefHandler),r.addEventListener(xL,this._tooltipHandler),r.addEventListener(Gv,this._tooltipHandler)),dh.prototype.initialize.call(this,e,t,n)},canvas(){return this._svg},on(e,t){const n=this.eventName(e),r=this._handlers;if(this._handlerIndex(r[n],e,t)<0){const s={type:e,handler:t,listener:wL(this,t)};(r[n]||(r[n]=[])).push(s),this._svg&&this._svg.addEventListener(n,s.listener)}return this},off(e,t){const n=this.eventName(e),r=this._handlers[n],i=this._handlerIndex(r,e,t);return i>=0&&(this._svg&&this._svg.removeEventListener(n,r[i].listener),r.splice(i,1)),this}});const Nme="aria-hidden",R9="aria-label",M9="role",L9="aria-roledescription",Fme="graphics-object",P9="graphics-symbol",Ome=(e,t,n)=>({[M9]:e,[L9]:t,[R9]:n||void 0}),n1t=cc(["axis-domain","axis-grid","axis-label","axis-tick","axis-title","legend-band","legend-entry","legend-gradient","legend-label","legend-title","legend-symbol","title"]),$K={axis:{desc:"axis",caption:s1t},legend:{desc:"legend",caption:o1t},"title-text":{desc:"title",caption:e=>`Title text '${SK(e)}'`},"title-subtitle":{desc:"subtitle",caption:e=>`Subtitle text '${SK(e)}'`}},CK={ariaRole:M9,ariaRoleDescription:L9,description:R9};function Rme(e,t){const n=t.aria===!1;if(e(Nme,n||void 0),n||t.description==null)for(const r in CK)e(CK[r],void 0);else{const r=t.mark.marktype;e(R9,t.description),e(M9,t.ariaRole||(r==="group"?Fme:P9)),e(L9,t.ariaRoleDescription||`${r} mark`)}}function Mme(e){return e.aria===!1?{[Nme]:!0}:n1t[e.role]?null:$K[e.role]?i1t(e,$K[e.role]):r1t(e)}function r1t(e){const t=e.marktype,n=t==="group"||t==="text"||e.items.some(r=>r.description!=null&&r.aria!==!1);return Ome(n?Fme:P9,`${t} mark container`,e.description)}function i1t(e,t){try{const n=e.items[0],r=t.caption||(()=>"");return Ome(t.role||P9,t.desc,n.description||r(n))}catch{return null}}function SK(e){return et(e.text).join(" ")}function s1t(e){const t=e.datum,n=e.orient,r=t.title?Lme(e):null,i=e.context,s=i.scales[t.scale].value,o=i.dataflow.locale(),a=s.type;return`${n==="left"||n==="right"?"Y":"X"}-axis`+(r?` titled '${r}'`:"")+` for a ${w0(a)?"discrete":a} scale with ${Kde(o,s,e)}`}function o1t(e){const t=e.datum,n=t.title?Lme(e):null,r=`${t.type||""} legend`.trim(),i=t.scales,s=Object.keys(i),o=e.context,a=o.scales[i[s[0]]].value,u=o.dataflow.locale();return u1t(r)+(n?` titled '${n}'`:"")+` for ${a1t(s)} with ${Kde(u,a,e)}`}function Lme(e){try{return et(Kt(e.items).items[0].text).join(" ")}catch{return null}}function a1t(e){return e=e.map(t=>t+(t==="fill"||t==="stroke"?" color":"")),e.length<2?e[0]:e.slice(0,-1).join(", ")+" and "+Kt(e)}function u1t(e){return e.length?e[0].toUpperCase()+e.slice(1):e}const Pme=e=>(e+"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"),l1t=e=>Pme(e).replace(/"/g,"&quot;").replace(/\t/g,"&#x9;").replace(/\n/g,"&#xA;").replace(/\r/g,"&#xD;");function B9(){let e="",t="",n="";const r=[],i=()=>t=n="",s=u=>{t&&(e+=`${t}>${n}`,i()),r.push(u)},o=(u,l)=>(l!=null&&(t+=` ${u}="${l1t(l)}"`),a),a={open(u,...l){s(u),t="<"+u;for(const c of l)for(const f in c)o(f,c[f]);return a},close(){const u=r.pop();return t?e+=t+(n?`>${n}</${u}>`:"/>"):e+=`</${u}>`,i(),a},attr:o,text:u=>(n+=Pme(u),a),toString:()=>e};return a}const Bme=e=>zme(B9(),e)+"";function zme(e,t){if(e.open(t.tagName),t.hasAttributes()){const n=t.attributes,r=n.length;for(let i=0;i<r;++i)e.attr(n[i].name,n[i].value)}if(t.hasChildNodes()){const n=t.childNodes,r=n.length;for(let i=0;i<r;i++){const s=n[i];s.nodeType===3?e.text(s.nodeValue):zme(e,s)}}return e.close()}const M_={fill:"fill",fillOpacity:"fill-opacity",stroke:"stroke",strokeOpacity:"stroke-opacity",strokeWidth:"stroke-width",strokeCap:"stroke-linecap",strokeJoin:"stroke-linejoin",strokeDash:"stroke-dasharray",strokeDashOffset:"stroke-dashoffset",strokeMiterLimit:"stroke-miterlimit",opacity:"opacity",blend:"mix-blend-mode"},Ume={fill:"none","stroke-miterlimit":10},pb=0,kK="http://www.w3.org/2000/xmlns/",sr=Vv.xmlns;function z9(e){il.call(this,e),this._dirtyID=0,this._dirty=[],this._svg=null,this._root=null,this._defs=null}const IO=il.prototype;$e(z9,il,{initialize(e,t,n,r,i){return this._defs={},this._clearDefs(),e&&(this._svg=ys(e,0,"svg",sr),this._svg.setAttributeNS(kK,"xmlns",sr),this._svg.setAttributeNS(kK,"xmlns:xlink",Vv["xmlns:xlink"]),this._svg.setAttribute("version",Vv.version),this._svg.setAttribute("class","marks"),ba(e,1),this._root=ys(this._svg,pb,"g",sr),pf(this._root,Ume),ba(this._svg,pb+1)),this.background(this._bgcolor),IO.initialize.call(this,e,t,n,r,i)},background(e){return arguments.length&&this._svg&&this._svg.style.setProperty("background-color",e),IO.background.apply(this,arguments)},resize(e,t,n,r){return IO.resize.call(this,e,t,n,r),this._svg&&(pf(this._svg,{width:this._width*this._scale,height:this._height*this._scale,viewBox:`0 0 ${this._width} ${this._height}`}),this._root.setAttribute("transform",`translate(${this._origin})`)),this._dirty=[],this},canvas(){return this._svg},svg(){const e=this._svg,t=this._bgcolor;if(!e)return null;let n;t&&(e.removeAttribute("style"),n=ys(e,pb,"rect",sr),pf(n,{width:this._width,height:this._height,fill:t}));const r=Bme(e);return t&&(e.removeChild(n),this._svg.style.setProperty("background-color",t)),r},_render(e){return this._dirtyCheck()&&(this._dirtyAll&&this._clearDefs(),this.mark(this._root,e),ba(this._root,1)),this.defs(),this._dirty=[],++this._dirtyID,this},dirty(e){e.dirty!==this._dirtyID&&(e.dirty=this._dirtyID,this._dirty.push(e))},isDirty(e){return this._dirtyAll||!e._svg||e.dirty===this._dirtyID},_dirtyCheck(){this._dirtyAll=!0;const e=this._dirty;if(!e.length||!this._dirtyID)return!0;const t=++this._dirtyID;let n,r,i,s,o,a,u;for(o=0,a=e.length;o<a;++o)if(n=e[o],r=n.mark,r.marktype!==i&&(i=r.marktype,s=jo[i]),r.zdirty&&r.dirty!==t&&(this._dirtyAll=!1,EK(n,t),r.items.forEach(l=>{l.dirty=t})),!r.zdirty){if(n.exit){s.nested&&r.items.length?(u=r.items[0],u._svg&&this._update(s,u._svg,u)):n._svg&&(u=n._svg.parentNode,u&&u.removeChild(n._svg)),n._svg=null;continue}n=s.nested?r.items[0]:n,n._update!==t&&(!n._svg||!n._svg.ownerSVGElement?(this._dirtyAll=!1,EK(n,t)):this._update(s,n._svg,n),n._update=t)}return!this._dirtyAll},mark(e,t,n){if(!this.isDirty(t))return t._svg;const r=this._svg,i=jo[t.marktype],s=t.interactive===!1?"none":null,o=i.tag==="g";let a=null,u=0;const l=_K(t,e,n,"g",r);l.setAttribute("class",_me(t));const c=Mme(t);for(const h in c)Mi(l,h,c[h]);o||Mi(l,"pointer-events",s),Mi(l,"clip-path",t.clip?p9(this,t,t.group):null);const f=h=>{const d=this.isDirty(h),p=_K(h,l,a,i.tag,r);d&&(this._update(i,p,h),o&&h1t(this,p,h)),a=p,++u};return i.nested?t.items.length&&f(t.items[0]):Ma(t,f),ba(l,u),l},_update(e,t,n){ql=t,ai=t.__values__,Rme(vx,n),e.attr(vx,n,this);const r=p1t[e.type];r&&r.call(this,e,t,n),ql&&this.style(ql,n)},style(e,t){if(t!=null)for(const n in M_){let r=n==="font"?R$(t):t[n];if(r===ai[n])continue;const i=M_[n];r==null?e.removeAttribute(i):(f9(r)&&(r=nme(r,this._defs.gradient,jme())),e.setAttribute(i,r+"")),ai[n]=r}},defs(){const e=this._svg,t=this._defs;let n=t.el,r=0;for(const i in t.gradient)n||(t.el=n=ys(e,pb+1,"defs",sr)),r=c1t(n,t.gradient[i],r);for(const i in t.clipping)n||(t.el=n=ys(e,pb+1,"defs",sr)),r=f1t(n,t.clipping[i],r);n&&(r===0?(e.removeChild(n),t.el=null):ba(n,r))},_clearDefs(){const e=this._defs;e.gradient={},e.clipping={}}});function EK(e,t){for(;e&&e.dirty!==t;e=e.mark.group)if(e.dirty=t,e.mark&&e.mark.dirty!==t)e.mark.dirty=t;else return}function c1t(e,t,n){let r,i,s;if(t.gradient==="radial"){let o=ys(e,n++,"pattern",sr);pf(o,{id:__+t.id,viewBox:"0,0,1,1",width:"100%",height:"100%",preserveAspectRatio:"xMidYMid slice"}),o=ys(o,0,"rect",sr),pf(o,{width:1,height:1,fill:`url(${jme()}#${t.id})`}),e=ys(e,n++,"radialGradient",sr),pf(e,{id:t.id,fx:t.x1,fy:t.y1,fr:t.r1,cx:t.x2,cy:t.y2,r:t.r2})}else e=ys(e,n++,"linearGradient",sr),pf(e,{id:t.id,x1:t.x1,x2:t.x2,y1:t.y1,y2:t.y2});for(r=0,i=t.stops.length;r<i;++r)s=ys(e,r,"stop",sr),s.setAttribute("offset",t.stops[r].offset),s.setAttribute("stop-color",t.stops[r].color);return ba(e,r),n}function f1t(e,t,n){let r;return e=ys(e,n,"clipPath",sr),e.setAttribute("id",t.id),t.path?(r=ys(e,0,"path",sr),r.setAttribute("d",t.path)):(r=ys(e,0,"rect",sr),pf(r,{x:0,y:0,width:t.width,height:t.height})),ba(e,1),n+1}function h1t(e,t,n){t=t.lastChild.previousSibling;let r,i=0;Ma(n,s=>{r=e.mark(t,s,r),++i}),ba(t,1+i)}function _K(e,t,n,r,i){let s=e._svg,o;if(!s&&(o=t.ownerDocument,s=df(o,r,sr),e._svg=s,e.mark&&(s.__data__=e,s.__values__={fill:"default"},r==="g"))){const a=df(o,"path",sr);s.appendChild(a),a.__data__=e;const u=df(o,"g",sr);s.appendChild(u),u.__data__=e;const l=df(o,"path",sr);s.appendChild(l),l.__data__=e,l.__values__={fill:"default"}}return(s.ownerSVGElement!==i||d1t(s,n))&&t.insertBefore(s,n?n.nextSibling:t.firstChild),s}function d1t(e,t){return e.parentNode&&e.parentNode.childNodes.length>1&&e.previousSibling!=t}let ql=null,ai=null;const p1t={group(e,t,n){const r=ql=t.childNodes[2];ai=r.__values__,e.foreground(vx,n,this),ai=t.__values__,ql=t.childNodes[1],e.content(vx,n,this);const i=ql=t.childNodes[0];e.background(vx,n,this);const s=n.mark.interactive===!1?"none":null;if(s!==ai.events&&(Mi(r,"pointer-events",s),Mi(i,"pointer-events",s),ai.events=s),n.strokeForeground&&n.stroke){const o=n.fill;Mi(r,"display",null),this.style(i,n),Mi(i,"stroke",null),o&&(n.fill=null),ai=r.__values__,this.style(r,n),o&&(n.fill=o),ql=null}else Mi(r,"display","none")},image(e,t,n){n.smooth===!1?(DO(t,"image-rendering","optimizeSpeed"),DO(t,"image-rendering","pixelated")):DO(t,"image-rendering",null)},text(e,t,n){const r=O$(n);let i,s,o,a;it(r)?(s=r.map(u=>hh(n,u)),i=s.join(`
`),i!==ai.text&&(ba(t,0),o=t.ownerDocument,a=fh(n),s.forEach((u,l)=>{const c=df(o,"tspan",sr);c.__data__=n,c.textContent=u,l&&(c.setAttribute("x",0),c.setAttribute("dy",a)),t.appendChild(c)}),ai.text=i)):(s=hh(n,r),s!==ai.text&&(t.textContent=s,ai.text=s)),Mi(t,"font-family",R$(n)),Mi(t,"font-size",rl(n)+"px"),Mi(t,"font-style",n.fontStyle),Mi(t,"font-variant",n.fontVariant),Mi(t,"font-weight",n.fontWeight)}};function vx(e,t,n){t!==ai[e]&&(n?g1t(ql,e,t,n):Mi(ql,e,t),ai[e]=t)}function DO(e,t,n){n!==ai[t]&&(n==null?e.style.removeProperty(t):e.style.setProperty(t,n+""),ai[t]=n)}function pf(e,t){for(const n in t)Mi(e,n,t[n])}function Mi(e,t,n){n!=null?e.setAttribute(t,n):e.removeAttribute(t)}function g1t(e,t,n,r){n!=null?e.setAttributeNS(r,t,n):e.removeAttributeNS(r,t)}function jme(){let e;return typeof window>"u"?"":(e=window.location).hash?e.href.slice(0,-e.hash.length):e.href}function U9(e){il.call(this,e),this._text=null,this._defs={gradient:{},clipping:{}}}$e(U9,il,{svg(){return this._text},_render(e){const t=B9();t.open("svg",yt({},Vv,{class:"marks",width:this._width*this._scale,height:this._height*this._scale,viewBox:`0 0 ${this._width} ${this._height}`}));const n=this._bgcolor;return n&&n!=="transparent"&&n!=="none"&&t.open("rect",{width:this._width,height:this._height,fill:n}).close(),t.open("g",Ume,{transform:"translate("+this._origin+")"}),this.mark(t,e),t.close(),this.defs(t),this._text=t.close()+"",this},mark(e,t){const n=jo[t.marktype],r=n.tag,i=[Rme,n.attr];e.open("g",{class:_me(t),"clip-path":t.clip?p9(this,t,t.group):null},Mme(t),{"pointer-events":r!=="g"&&t.interactive===!1?"none":null});const s=o=>{const a=this.href(o);if(a&&e.open("a",a),e.open(r,this.attr(t,o,i,r!=="g"?r:null)),r==="text"){const u=O$(o);if(it(u)){const l={x:0,dy:fh(o)};for(let c=0;c<u.length;++c)e.open("tspan",c?l:null).text(hh(o,u[c])).close()}else e.text(hh(o,u))}else if(r==="g"){const u=o.strokeForeground,l=o.fill,c=o.stroke;u&&c&&(o.stroke=null),e.open("path",this.attr(t,o,n.background,"bgrect")).close(),e.open("g",this.attr(t,o,n.content)),Ma(o,f=>this.mark(e,f)),e.close(),u&&c?(l&&(o.fill=null),o.stroke=c,e.open("path",this.attr(t,o,n.foreground,"bgrect")).close(),l&&(o.fill=l)):e.open("path",this.attr(t,o,n.foreground,"bgfore")).close()}e.close(),a&&e.close()};return n.nested?t.items&&t.items.length&&s(t.items[0]):Ma(t,s),e.close()},href(e){const t=e.href;let n;if(t){if(n=this._hrefs&&this._hrefs[t])return n;this.sanitizeURL(t).then(r=>{r["xlink:href"]=r.href,r.href=null,(this._hrefs||(this._hrefs={}))[t]=r})}return null},attr(e,t,n,r){const i={},s=(o,a,u,l)=>{i[l||o]=a};return Array.isArray(n)?n.forEach(o=>o(s,t,this)):n(s,t,this),r&&m1t(i,t,e,r,this._defs),i},defs(e){const t=this._defs.gradient,n=this._defs.clipping;if(Object.keys(t).length+Object.keys(n).length!==0){e.open("defs");for(const i in t){const s=t[i],o=s.stops;s.gradient==="radial"?(e.open("pattern",{id:__+i,viewBox:"0,0,1,1",width:"100%",height:"100%",preserveAspectRatio:"xMidYMid slice"}),e.open("rect",{width:"1",height:"1",fill:"url(#"+i+")"}).close(),e.close(),e.open("radialGradient",{id:i,fx:s.x1,fy:s.y1,fr:s.r1,cx:s.x2,cy:s.y2,r:s.r2})):e.open("linearGradient",{id:i,x1:s.x1,x2:s.x2,y1:s.y1,y2:s.y2});for(let a=0;a<o.length;++a)e.open("stop",{offset:o[a].offset,"stop-color":o[a].color}).close();e.close()}for(const i in n){const s=n[i];e.open("clipPath",{id:i}),s.path?e.open("path",{d:s.path}).close():e.open("rect",{x:0,y:0,width:s.width,height:s.height}).close(),e.close()}e.close()}}});function m1t(e,t,n,r,i){if(t==null||(r==="bgrect"&&n.interactive===!1&&(e["pointer-events"]="none"),r==="bgfore"&&(n.interactive===!1&&(e["pointer-events"]="none"),e.display="none",t.fill!==null)))return e;r==="image"&&t.smooth===!1&&(e.style="image-rendering: optimizeSpeed; image-rendering: pixelated;"),r==="text"&&(e["font-family"]=R$(t),e["font-size"]=rl(t)+"px",e["font-style"]=t.fontStyle,e["font-variant"]=t.fontVariant,e["font-weight"]=t.fontWeight);for(const s in M_){let o=t[s];const a=M_[s];o==="transparent"&&(a==="fill"||a==="stroke")||o!=null&&(f9(o)&&(o=nme(o,i.gradient,"")),e[a]=o)}return e}const Wme="canvas",Vme="png",Gme="svg",Hme="none",gf={Canvas:Wme,PNG:Vme,SVG:Gme,None:Hme},D0={};D0[Wme]=D0[Vme]={renderer:R_,headless:R_,handler:M$};D0[Gme]={renderer:z9,headless:U9,handler:O9};D0[Hme]={};function dN(e,t){return e=String(e||"").toLowerCase(),arguments.length>1?(D0[e]=t,this):D0[e]}function qme(e,t,n){const r=[],i=new Ji().union(t),s=e.marktype;return s?Xme(e,i,n,r):s==="group"?Yme(e,i,n,r):le("Intersect scene must be mark node or group item.")}function Xme(e,t,n,r){if(y1t(e,t,n)){const i=e.items,s=e.marktype,o=i.length;let a=0;if(s==="group")for(;a<o;++a)Yme(i[a],t,n,r);else for(const u=jo[s].isect;a<o;++a){const l=i[a];Kme(l,t,u)&&r.push(l)}}return r}function y1t(e,t,n){return e.bounds&&t.intersects(e.bounds)&&(e.marktype==="group"||e.interactive!==!1&&(!n||n(e)))}function Yme(e,t,n,r){n&&n(e.mark)&&Kme(e,t,jo.group.isect)&&r.push(e);const i=e.items,s=i&&i.length;if(s){const o=e.x||0,a=e.y||0;t.translate(-o,-a);for(let u=0;u<s;++u)Xme(i[u],t,n,r);t.translate(o,a)}return r}function Kme(e,t,n){const r=e.bounds;return t.encloses(r)||t.intersects(r)&&n(e,t)}const NO=new Ji;function b1t(e){const t=e.clip;if(zt(t))t(N$(NO.clear()));else if(t)NO.set(0,0,e.group.width,e.group.height);else return;e.bounds.intersect(NO)}const x1t=1e-9;function j9(e,t,n){return e===t?!0:n==="path"?Zme(e,t):e instanceof Date&&t instanceof Date?+e==+t:kp(e)&&kp(t)?Math.abs(e-t)<=x1t:!e||!t||!dt(e)&&!dt(t)?e==t:v1t(e,t)}function Zme(e,t){return j9(A0(e),A0(t))}function v1t(e,t){var n=Object.keys(e),r=Object.keys(t),i,s;if(n.length!==r.length)return!1;for(n.sort(),r.sort(),s=n.length-1;s>=0;s--)if(n[s]!=r[s])return!1;for(s=n.length-1;s>=0;s--)if(i=n[s],!j9(e[i],t[i],i))return!1;return typeof e==typeof t}function w1t(){lme(),Ygt()}const $1t=4278190080,C1t=268435456,S1t=.0625;function k1t(e,t){const n=e.bitmap();return(t||[]).forEach(r=>n.set(e(r.boundary[0]),e(r.boundary[3]))),[n,void 0]}function E1t(e,t,n,r){const i=e.width,s=e.height,o=n||r,a=Ec(i,s).getContext("2d");t.forEach(m=>Jme(a,m,o));const u=new Uint32Array(a.getImageData(0,0,i,s).data.buffer),l=e.bitmap(),c=o&&e.bitmap();let f,h,d,p,g;for(h=0;h<s;++h)for(f=0;f<i;++f)g=u[h*i+f]&$1t,g&&(d=e(f),p=e(h),r||l.set(d,p),o&&g^C1t&&c.set(d,p));return[l,c]}function Jme(e,t,n){if(!t.length)return;const r=t[0].mark.marktype;r==="group"?t.forEach(i=>{i.items.forEach(s=>Jme(e,s.items,n))}):jo[r].draw(e,{items:n?t.map(_1t):t})}function _1t(e){const t=tD(e,{});return t.stroke&&(t.strokeOpacity=1),t.fill&&(t.fillOpacity=S1t,t.stroke="#000",t.strokeOpacity=1,t.strokeWidth=2),t}const Sl=5,Oi=31,Hv=32,Kc=new Uint32Array(Hv+1),pa=new Uint32Array(Hv+1);pa[0]=0;Kc[0]=~pa[0];for(let e=1;e<=Hv;++e)pa[e]=pa[e-1]<<1|1,Kc[e]=~pa[e];function A1t(e,t){const n=new Uint32Array(~~((e*t+Hv)/Hv));function r(s,o){n[s]|=o}function i(s,o){n[s]&=o}return{array:n,get:(s,o)=>{const a=o*e+s;return n[a>>>Sl]&1<<(a&Oi)},set:(s,o)=>{const a=o*e+s;r(a>>>Sl,1<<(a&Oi))},clear:(s,o)=>{const a=o*e+s;i(a>>>Sl,~(1<<(a&Oi)))},getRange:(s,o,a,u)=>{let l=u,c,f,h,d;for(;l>=o;--l)if(c=l*e+s,f=l*e+a,h=c>>>Sl,d=f>>>Sl,h===d){if(n[h]&Kc[c&Oi]&pa[(f&Oi)+1])return!0}else{if(n[h]&Kc[c&Oi]||n[d]&pa[(f&Oi)+1])return!0;for(let p=h+1;p<d;++p)if(n[p])return!0}return!1},setRange:(s,o,a,u)=>{let l,c,f,h,d;for(;o<=u;++o)if(l=o*e+s,c=o*e+a,f=l>>>Sl,h=c>>>Sl,f===h)r(f,Kc[l&Oi]&pa[(c&Oi)+1]);else for(r(f,Kc[l&Oi]),r(h,pa[(c&Oi)+1]),d=f+1;d<h;++d)r(d,4294967295)},clearRange:(s,o,a,u)=>{let l,c,f,h,d;for(;o<=u;++o)if(l=o*e+s,c=o*e+a,f=l>>>Sl,h=c>>>Sl,f===h)i(f,pa[l&Oi]|Kc[(c&Oi)+1]);else for(i(f,pa[l&Oi]),i(h,Kc[(c&Oi)+1]),d=f+1;d<h;++d)i(d,0)},outOfBounds:(s,o,a,u)=>s<0||o<0||u>=t||a>=e}}function T1t(e,t,n){const r=Math.max(1,Math.sqrt(e*t/1e6)),i=~~((e+2*n+r)/r),s=~~((t+2*n+r)/r),o=a=>~~((a+n)/r);return o.invert=a=>a*r-n,o.bitmap=()=>A1t(i,s),o.ratio=r,o.padding=n,o.width=e,o.height=t,o}function I1t(e,t,n,r){const i=e.width,s=e.height;return function(o){const a=o.datum.datum.items[r].items,u=a.length,l=o.datum.fontSize,c=Iu.width(o.datum,o.datum.text);let f=0,h,d,p,g,m,y,b;for(let v=0;v<u;++v)h=a[v].x,p=a[v].y,d=a[v].x2===void 0?h:a[v].x2,g=a[v].y2===void 0?p:a[v].y2,m=(h+d)/2,y=(p+g)/2,b=Math.abs(d-h+g-p),b>=f&&(f=b,o.x=m,o.y=y);return m=c/2,y=l/2,h=o.x-m,d=o.x+m,p=o.y-y,g=o.y+y,o.align="center",h<0&&d<=i?o.align="left":0<=h&&i<d&&(o.align="right"),o.baseline="middle",p<0&&g<=s?o.baseline="top":0<=p&&s<g&&(o.baseline="bottom"),!0}}function L_(e,t,n,r,i,s){let o=n/2;return e-o<0||e+o>i||t-(o=r/2)<0||t+o>s}function mf(e,t,n,r,i,s,o,a){const u=i*s/(r*2),l=e(t-u),c=e(t+u),f=e(n-(s=s/2)),h=e(n+s);return o.outOfBounds(l,f,c,h)||o.getRange(l,f,c,h)||a&&a.getRange(l,f,c,h)}function D1t(e,t,n,r){const i=e.width,s=e.height,o=t[0],a=t[1];function u(l,c,f,h,d){const p=e.invert(l),g=e.invert(c);let m=f,y=s,b;if(!L_(p,g,h,d,i,s)&&!mf(e,p,g,d,h,m,o,a)&&!mf(e,p,g,d,h,d,o,null)){for(;y-m>=1;)b=(m+y)/2,mf(e,p,g,d,h,b,o,a)?y=b:m=b;if(m>f)return[p,g,m,!0]}}return function(l){const c=l.datum.datum.items[r].items,f=c.length,h=l.datum.fontSize,d=Iu.width(l.datum,l.datum.text);let p=n?h:0,g=!1,m=!1,y=0,b,v,x,w,C,$,S,k,E,_,D,A,T,I,F,R,L;for(let P=0;P<f;++P){for(b=c[P].x,x=c[P].y,v=c[P].x2===void 0?b:c[P].x2,w=c[P].y2===void 0?x:c[P].y2,b>v&&(L=b,b=v,v=L),x>w&&(L=x,x=w,w=L),E=e(b),D=e(v),_=~~((E+D)/2),A=e(x),I=e(w),T=~~((A+I)/2),S=_;S>=E;--S)for(k=T;k>=A;--k)R=u(S,k,p,d,h),R&&([l.x,l.y,p,g]=R);for(S=_;S<=D;++S)for(k=T;k<=I;++k)R=u(S,k,p,d,h),R&&([l.x,l.y,p,g]=R);!g&&!n&&(F=Math.abs(v-b+w-x),C=(b+v)/2,$=(x+w)/2,F>=y&&!L_(C,$,d,h,i,s)&&!mf(e,C,$,h,d,h,o,null)&&(y=F,l.x=C,l.y=$,m=!0))}return g||m?(C=d/2,$=h/2,o.setRange(e(l.x-C),e(l.y-$),e(l.x+C),e(l.y+$)),l.align="center",l.baseline="middle",!0):!1}}const N1t=[-1,-1,1,1],F1t=[-1,1,-1,1];function O1t(e,t,n,r){const i=e.width,s=e.height,o=t[0],a=t[1],u=e.bitmap();return function(l){const c=l.datum.datum.items[r].items,f=c.length,h=l.datum.fontSize,d=Iu.width(l.datum,l.datum.text),p=[];let g=n?h:0,m=!1,y=!1,b=0,v,x,w,C,$,S,k,E,_,D,A,T;for(let I=0;I<f;++I){for(v=c[I].x,w=c[I].y,x=c[I].x2===void 0?v:c[I].x2,C=c[I].y2===void 0?w:c[I].y2,p.push([e((v+x)/2),e((w+C)/2)]);p.length;)if([k,E]=p.pop(),!(o.get(k,E)||a.get(k,E)||u.get(k,E))){u.set(k,E);for(let F=0;F<4;++F)$=k+N1t[F],S=E+F1t[F],u.outOfBounds($,S,$,S)||p.push([$,S]);if($=e.invert(k),S=e.invert(E),_=g,D=s,!L_($,S,d,h,i,s)&&!mf(e,$,S,h,d,_,o,a)&&!mf(e,$,S,h,d,h,o,null)){for(;D-_>=1;)A=(_+D)/2,mf(e,$,S,h,d,A,o,a)?D=A:_=A;_>g&&(l.x=$,l.y=S,g=_,m=!0)}}!m&&!n&&(T=Math.abs(x-v+C-w),$=(v+x)/2,S=(w+C)/2,T>=b&&!L_($,S,d,h,i,s)&&!mf(e,$,S,h,d,h,o,null)&&(b=T,l.x=$,l.y=S,y=!0))}return m||y?($=d/2,S=h/2,o.setRange(e(l.x-$),e(l.y-S),e(l.x+$),e(l.y+S)),l.align="center",l.baseline="middle",!0):!1}}const R1t=["right","center","left"],M1t=["bottom","middle","top"];function L1t(e,t,n,r){const i=e.width,s=e.height,o=t[0],a=t[1],u=r.length;return function(l){const c=l.boundary,f=l.datum.fontSize;if(c[2]<0||c[5]<0||c[0]>i||c[3]>s)return!1;let h=0,d,p,g,m,y,b,v,x,w,C,$,S,k,E,_;for(let D=0;D<u;++D){if(d=(n[D]&3)-1,p=(n[D]>>>2&3)-1,g=d===0&&p===0||r[D]<0,m=d&&p?Math.SQRT1_2:1,y=r[D]<0?-1:1,b=c[1+d]+r[D]*d*m,$=c[4+p]+y*f*p/2+r[D]*p*m,x=$-f/2,w=$+f/2,S=e(b),E=e(x),_=e(w),!h)if(AK(S,S,E,_,o,a,b,b,x,w,c,g))h=Iu.width(l.datum,l.datum.text);else continue;if(C=b+y*h*d/2,b=C-h/2,v=C+h/2,S=e(b),k=e(v),AK(S,k,E,_,o,a,b,v,x,w,c,g))return l.x=d?d*y<0?v:b:C,l.y=p?p*y<0?w:x:$,l.align=R1t[d*y+1],l.baseline=M1t[p*y+1],o.setRange(S,E,k,_),!0}return!1}}function AK(e,t,n,r,i,s,o,a,u,l,c,f){return!(i.outOfBounds(e,n,t,r)||(f&&s?s.getRange(e,n,t,r)||!P1t(o,u,a,l,c):i.getRange(e,n,t,r)))}function P1t(e,t,n,r,i){return i[0]<=e&&n<=i[2]&&i[3]<=t&&r<=i[5]}const FO=0,OO=4,RO=8,MO=0,LO=1,PO=2,B1t={"top-left":FO+MO,top:FO+LO,"top-right":FO+PO,left:OO+MO,middle:OO+LO,right:OO+PO,"bottom-left":RO+MO,bottom:RO+LO,"bottom-right":RO+PO},z1t={naive:I1t,"reduced-search":D1t,floodfill:O1t};function U1t(e,t,n,r,i,s,o,a,u,l,c){if(!e.length)return e;const f=Math.max(r.length,i.length),h=j1t(r,f),d=W1t(i,f),p=V1t(e[0].datum),g=p==="group"&&e[0].datum.items[u].marktype,m=g==="area",y=G1t(p,g,a,u),b=T1t(t[0],t[1],l),v=m&&c==="naive",x=e.map($=>({datum:$,opacity:0,x:void 0,y:void 0,align:void 0,baseline:void 0,boundary:y($)}));let w;if(!v){n&&x.sort((S,k)=>n(S.datum,k.datum));let $=!1;for(let S=0;S<d.length&&!$;++S)$=d[S]===5||h[S]<0;p&&(o||m)&&(s=[e.map(S=>S.datum)].concat(s)),w=s.length?E1t(b,s,$,m):k1t(b,o&&x)}const C=m?z1t[c](b,w,o,u):L1t(b,w,d,h);return x.forEach($=>$.opacity=+C($)),x}function j1t(e,t){const n=new Float64Array(t),r=e.length;for(let i=0;i<r;++i)n[i]=e[i]||0;for(let i=r;i<t;++i)n[i]=n[r-1];return n}function W1t(e,t){const n=new Int8Array(t),r=e.length;for(let i=0;i<r;++i)n[i]|=B1t[e[i]];for(let i=r;i<t;++i)n[i]=n[r-1];return n}function V1t(e){return e&&e.mark&&e.mark.marktype}function G1t(e,t,n,r){const i=s=>[s.x,s.x,s.x,s.y,s.y,s.y];return e?e==="line"||e==="area"?s=>i(s.datum):t==="line"?s=>{const o=s.datum.items[r].items;return i(o.length?o[n==="start"?0:o.length-1]:{x:NaN,y:NaN})}:s=>{const o=s.datum.bounds;return[o.x1,(o.x1+o.x2)/2,o.x2,o.y1,(o.y1+o.y2)/2,o.y2]}:i}const $L=["x","y","opacity","align","baseline"],Qme=["top-left","left","bottom-left","top","bottom","top-right","right","bottom-right"];function W9(e){re.call(this,null,e)}W9.Definition={type:"Label",metadata:{modifies:!0},params:[{name:"size",type:"number",array:!0,length:2,required:!0},{name:"sort",type:"compare"},{name:"anchor",type:"string",array:!0,default:Qme},{name:"offset",type:"number",array:!0,default:[1]},{name:"padding",type:"number",default:0},{name:"lineAnchor",type:"string",values:["start","end"],default:"end"},{name:"markIndex",type:"number",default:0},{name:"avoidBaseMark",type:"boolean",default:!0},{name:"avoidMarks",type:"data",array:!0},{name:"method",type:"string",default:"naive"},{name:"as",type:"string",array:!0,length:$L.length,default:$L}]};$e(W9,re,{transform(e,t){function n(s){const o=e[s];return zt(o)&&t.modified(o.fields)}const r=e.modified();if(!(r||t.changed(t.ADD_REM)||n("sort")))return;(!e.size||e.size.length!==2)&&le("Size parameter should be specified as a [width, height] array.");const i=e.as||$L;return U1t(t.materialize(t.SOURCE).source,e.size,e.sort,et(e.offset||1),et(e.anchor||Qme),e.avoidMarks||[],e.avoidBaseMark!==!1,e.lineAnchor||"end",e.markIndex||0,e.padding||0,e.method||"naive").forEach(s=>{const o=s.datum;o[i[0]]=s.x,o[i[1]]=s.y,o[i[2]]=s.opacity,o[i[3]]=s.align,o[i[4]]=s.baseline}),t.reflow(r).modifies(i)}});const H1t=Object.freeze(Object.defineProperty({__proto__:null,label:W9},Symbol.toStringTag,{value:"Module"}));function e0e(e,t){var n=[],r=function(c){return c(a)},i,s,o,a,u,l;if(t==null)n.push(e);else for(i={},s=0,o=e.length;s<o;++s)a=e[s],u=t.map(r),l=i[u],l||(i[u]=l=[],l.dims=u,n.push(l)),l.push(a);return n}function V9(e){re.call(this,null,e)}V9.Definition={type:"Loess",metadata:{generates:!0},params:[{name:"x",type:"field",required:!0},{name:"y",type:"field",required:!0},{name:"groupby",type:"field",array:!0},{name:"bandwidth",type:"number",default:.3},{name:"as",type:"string",array:!0}]};$e(V9,re,{transform(e,t){const n=t.fork(t.NO_SOURCE|t.NO_FIELDS);if(!this.value||t.changed()||e.modified()){const r=t.materialize(t.SOURCE).source,i=e0e(r,e.groupby),s=(e.groupby||[]).map(Nn),o=s.length,a=e.as||[Nn(e.x),Nn(e.y)],u=[];i.forEach(l=>{lle(l,e.x,e.y,e.bandwidth||.3).forEach(c=>{const f={};for(let h=0;h<o;++h)f[s[h]]=l.dims[h];f[a[0]]=c[0],f[a[1]]=c[1],u.push(Ot(f))})}),this.value&&(n.rem=this.value),this.value=n.add=n.source=u}return n}});const CL={linear:rz,log:sle,exp:ole,pow:ale,quad:iz,poly:ule},q1t=(e,t)=>e==="poly"?t:e==="quad"?2:1;function G9(e){re.call(this,null,e)}G9.Definition={type:"Regression",metadata:{generates:!0},params:[{name:"x",type:"field",required:!0},{name:"y",type:"field",required:!0},{name:"groupby",type:"field",array:!0},{name:"method",type:"string",default:"linear",values:Object.keys(CL)},{name:"order",type:"number",default:3},{name:"extent",type:"number",array:!0,length:2},{name:"params",type:"boolean",default:!1},{name:"as",type:"string",array:!0}]};$e(G9,re,{transform(e,t){const n=t.fork(t.NO_SOURCE|t.NO_FIELDS);if(!this.value||t.changed()||e.modified()){const r=t.materialize(t.SOURCE).source,i=e0e(r,e.groupby),s=(e.groupby||[]).map(Nn),o=e.method||"linear",a=e.order||3,u=q1t(o,a),l=e.as||[Nn(e.x),Nn(e.y)],c=CL[o],f=[];let h=e.extent;nt(CL,o)||le("Invalid regression method: "+o),h!=null&&o==="log"&&h[0]<=0&&(t.dataflow.warn("Ignoring extent with values <= 0 for log regression."),h=null),i.forEach(d=>{if(d.length<=u){t.dataflow.warn("Skipping regression with more parameters than data points.");return}const g=c(d,e.x,e.y,a);if(e.params){f.push(Ot({keys:d.dims,coef:g.coef,rSquared:g.rSquared}));return}const m=h||qf(d,e.x),y=b=>{const v={};for(let x=0;x<s.length;++x)v[s[x]]=d.dims[x];v[l[0]]=b[0],v[l[1]]=b[1],f.push(Ot(v))};o==="linear"?m.forEach(b=>y([b,g.predict(b)])):uD(g.predict,m,25,200).forEach(y)}),this.value&&(n.rem=this.value),this.value=n.add=n.source=f}return n}});const X1t=Object.freeze(Object.defineProperty({__proto__:null,loess:V9,regression:G9},Symbol.toStringTag,{value:"Module"})),TK=Math.pow(2,-52),bS=new Uint32Array(512);class P_{static from(t,n=Q1t,r=eyt){const i=t.length,s=new Float64Array(i*2);for(let o=0;o<i;o++){const a=t[o];s[2*o]=n(a),s[2*o+1]=r(a)}return new P_(s)}constructor(t){const n=t.length>>1;if(n>0&&typeof t[0]!="number")throw new Error("Expected coords to contain numbers.");this.coords=t;const r=Math.max(2*n-5,0);this._triangles=new Uint32Array(r*3),this._halfedges=new Int32Array(r*3),this._hashSize=Math.ceil(Math.sqrt(n)),this._hullPrev=new Uint32Array(n),this._hullNext=new Uint32Array(n),this._hullTri=new Uint32Array(n),this._hullHash=new Int32Array(this._hashSize).fill(-1),this._ids=new Uint32Array(n),this._dists=new Float64Array(n),this.update()}update(){const{coords:t,_hullPrev:n,_hullNext:r,_hullTri:i,_hullHash:s}=this,o=t.length>>1;let a=1/0,u=1/0,l=-1/0,c=-1/0;for(let E=0;E<o;E++){const _=t[2*E],D=t[2*E+1];_<a&&(a=_),D<u&&(u=D),_>l&&(l=_),D>c&&(c=D),this._ids[E]=E}const f=(a+l)/2,h=(u+c)/2;let d=1/0,p,g,m;for(let E=0;E<o;E++){const _=BO(f,h,t[2*E],t[2*E+1]);_<d&&(p=E,d=_)}const y=t[2*p],b=t[2*p+1];d=1/0;for(let E=0;E<o;E++){if(E===p)continue;const _=BO(y,b,t[2*E],t[2*E+1]);_<d&&_>0&&(g=E,d=_)}let v=t[2*g],x=t[2*g+1],w=1/0;for(let E=0;E<o;E++){if(E===p||E===g)continue;const _=Z1t(y,b,v,x,t[2*E],t[2*E+1]);_<w&&(m=E,w=_)}let C=t[2*m],$=t[2*m+1];if(w===1/0){for(let D=0;D<o;D++)this._dists[D]=t[2*D]-t[0]||t[2*D+1]-t[1];Cm(this._ids,this._dists,0,o-1);const E=new Uint32Array(o);let _=0;for(let D=0,A=-1/0;D<o;D++){const T=this._ids[D];this._dists[T]>A&&(E[_++]=T,A=this._dists[T])}this.hull=E.subarray(0,_),this.triangles=new Uint32Array(0),this.halfedges=new Uint32Array(0);return}if(xS(y,b,v,x,C,$)){const E=g,_=v,D=x;g=m,v=C,x=$,m=E,C=_,$=D}const S=J1t(y,b,v,x,C,$);this._cx=S.x,this._cy=S.y;for(let E=0;E<o;E++)this._dists[E]=BO(t[2*E],t[2*E+1],S.x,S.y);Cm(this._ids,this._dists,0,o-1),this._hullStart=p;let k=3;r[p]=n[m]=g,r[g]=n[p]=m,r[m]=n[g]=p,i[p]=0,i[g]=1,i[m]=2,s.fill(-1),s[this._hashKey(y,b)]=p,s[this._hashKey(v,x)]=g,s[this._hashKey(C,$)]=m,this.trianglesLen=0,this._addTriangle(p,g,m,-1,-1,-1);for(let E=0,_,D;E<this._ids.length;E++){const A=this._ids[E],T=t[2*A],I=t[2*A+1];if(E>0&&Math.abs(T-_)<=TK&&Math.abs(I-D)<=TK||(_=T,D=I,A===p||A===g||A===m))continue;let F=0;for(let X=0,G=this._hashKey(T,I);X<this._hashSize&&(F=s[(G+X)%this._hashSize],!(F!==-1&&F!==r[F]));X++);F=n[F];let R=F,L;for(;L=r[R],!xS(T,I,t[2*R],t[2*R+1],t[2*L],t[2*L+1]);)if(R=L,R===F){R=-1;break}if(R===-1)continue;let P=this._addTriangle(R,A,r[R],-1,-1,i[R]);i[A]=this._legalize(P+2),i[R]=P,k++;let q=r[R];for(;L=r[q],xS(T,I,t[2*q],t[2*q+1],t[2*L],t[2*L+1]);)P=this._addTriangle(q,A,L,i[A],-1,i[q]),i[A]=this._legalize(P+2),r[q]=q,k--,q=L;if(R===F)for(;L=n[R],xS(T,I,t[2*L],t[2*L+1],t[2*R],t[2*R+1]);)P=this._addTriangle(L,A,R,-1,i[R],i[L]),this._legalize(P+2),i[L]=P,r[R]=R,k--,R=L;this._hullStart=n[A]=R,r[R]=n[q]=A,r[A]=q,s[this._hashKey(T,I)]=A,s[this._hashKey(t[2*R],t[2*R+1])]=R}this.hull=new Uint32Array(k);for(let E=0,_=this._hullStart;E<k;E++)this.hull[E]=_,_=r[_];this.triangles=this._triangles.subarray(0,this.trianglesLen),this.halfedges=this._halfedges.subarray(0,this.trianglesLen)}_hashKey(t,n){return Math.floor(Y1t(t-this._cx,n-this._cy)*this._hashSize)%this._hashSize}_legalize(t){const{_triangles:n,_halfedges:r,coords:i}=this;let s=0,o=0;for(;;){const a=r[t],u=t-t%3;if(o=u+(t+2)%3,a===-1){if(s===0)break;t=bS[--s];continue}const l=a-a%3,c=u+(t+1)%3,f=l+(a+2)%3,h=n[o],d=n[t],p=n[c],g=n[f];if(K1t(i[2*h],i[2*h+1],i[2*d],i[2*d+1],i[2*p],i[2*p+1],i[2*g],i[2*g+1])){n[t]=g,n[a]=h;const y=r[f];if(y===-1){let v=this._hullStart;do{if(this._hullTri[v]===f){this._hullTri[v]=t;break}v=this._hullPrev[v]}while(v!==this._hullStart)}this._link(t,y),this._link(a,r[o]),this._link(o,f);const b=l+(a+1)%3;s<bS.length&&(bS[s++]=b)}else{if(s===0)break;t=bS[--s]}}return o}_link(t,n){this._halfedges[t]=n,n!==-1&&(this._halfedges[n]=t)}_addTriangle(t,n,r,i,s,o){const a=this.trianglesLen;return this._triangles[a]=t,this._triangles[a+1]=n,this._triangles[a+2]=r,this._link(a,i),this._link(a+1,s),this._link(a+2,o),this.trianglesLen+=3,a}}function Y1t(e,t){const n=e/(Math.abs(e)+Math.abs(t));return(t>0?3-n:1+n)/4}function BO(e,t,n,r){const i=e-n,s=t-r;return i*i+s*s}function zO(e,t,n,r,i,s){const o=(r-t)*(i-e),a=(n-e)*(s-t);return Math.abs(o-a)>=33306690738754716e-32*Math.abs(o+a)?o-a:0}function xS(e,t,n,r,i,s){return(zO(i,s,e,t,n,r)||zO(e,t,n,r,i,s)||zO(n,r,i,s,e,t))<0}function K1t(e,t,n,r,i,s,o,a){const u=e-o,l=t-a,c=n-o,f=r-a,h=i-o,d=s-a,p=u*u+l*l,g=c*c+f*f,m=h*h+d*d;return u*(f*m-g*d)-l*(c*m-g*h)+p*(c*d-f*h)<0}function Z1t(e,t,n,r,i,s){const o=n-e,a=r-t,u=i-e,l=s-t,c=o*o+a*a,f=u*u+l*l,h=.5/(o*l-a*u),d=(l*c-a*f)*h,p=(o*f-u*c)*h;return d*d+p*p}function J1t(e,t,n,r,i,s){const o=n-e,a=r-t,u=i-e,l=s-t,c=o*o+a*a,f=u*u+l*l,h=.5/(o*l-a*u),d=e+(l*c-a*f)*h,p=t+(o*f-u*c)*h;return{x:d,y:p}}function Cm(e,t,n,r){if(r-n<=20)for(let i=n+1;i<=r;i++){const s=e[i],o=t[s];let a=i-1;for(;a>=n&&t[e[a]]>o;)e[a+1]=e[a--];e[a+1]=s}else{const i=n+r>>1;let s=n+1,o=r;gb(e,i,s),t[e[n]]>t[e[r]]&&gb(e,n,r),t[e[s]]>t[e[r]]&&gb(e,s,r),t[e[n]]>t[e[s]]&&gb(e,n,s);const a=e[s],u=t[a];for(;;){do s++;while(t[e[s]]<u);do o--;while(t[e[o]]>u);if(o<s)break;gb(e,s,o)}e[n+1]=e[o],e[o]=a,r-s+1>=o-n?(Cm(e,t,s,r),Cm(e,t,n,o-1)):(Cm(e,t,n,o-1),Cm(e,t,s,r))}}function gb(e,t,n){const r=e[t];e[t]=e[n],e[n]=r}function Q1t(e){return e[0]}function eyt(e){return e[1]}const IK=1e-6;class Vd{constructor(){this._x0=this._y0=this._x1=this._y1=null,this._=""}moveTo(t,n){this._+=`M${this._x0=this._x1=+t},${this._y0=this._y1=+n}`}closePath(){this._x1!==null&&(this._x1=this._x0,this._y1=this._y0,this._+="Z")}lineTo(t,n){this._+=`L${this._x1=+t},${this._y1=+n}`}arc(t,n,r){t=+t,n=+n,r=+r;const i=t+r,s=n;if(r<0)throw new Error("negative radius");this._x1===null?this._+=`M${i},${s}`:(Math.abs(this._x1-i)>IK||Math.abs(this._y1-s)>IK)&&(this._+="L"+i+","+s),r&&(this._+=`A${r},${r},0,1,1,${t-r},${n}A${r},${r},0,1,1,${this._x1=i},${this._y1=s}`)}rect(t,n,r,i){this._+=`M${this._x0=this._x1=+t},${this._y0=this._y1=+n}h${+r}v${+i}h${-r}Z`}value(){return this._||null}}class SL{constructor(){this._=[]}moveTo(t,n){this._.push([t,n])}closePath(){this._.push(this._[0].slice())}lineTo(t,n){this._.push([t,n])}value(){return this._.length?this._:null}}let tyt=class{constructor(t,[n,r,i,s]=[0,0,960,500]){if(!((i=+i)>=(n=+n))||!((s=+s)>=(r=+r)))throw new Error("invalid bounds");this.delaunay=t,this._circumcenters=new Float64Array(t.points.length*2),this.vectors=new Float64Array(t.points.length*2),this.xmax=i,this.xmin=n,this.ymax=s,this.ymin=r,this._init()}update(){return this.delaunay.update(),this._init(),this}_init(){const{delaunay:{points:t,hull:n,triangles:r},vectors:i}=this,s=this.circumcenters=this._circumcenters.subarray(0,r.length/3*2);for(let d=0,p=0,g=r.length,m,y;d<g;d+=3,p+=2){const b=r[d]*2,v=r[d+1]*2,x=r[d+2]*2,w=t[b],C=t[b+1],$=t[v],S=t[v+1],k=t[x],E=t[x+1],_=$-w,D=S-C,A=k-w,T=E-C,I=_*_+D*D,F=A*A+T*T,R=(_*T-D*A)*2;if(!R)m=(w+k)/2-1e8*T,y=(C+E)/2+1e8*A;else if(Math.abs(R)<1e-8)m=(w+k)/2,y=(C+E)/2;else{const L=1/R;m=w+(T*I-D*F)*L,y=C+(_*F-A*I)*L}s[p]=m,s[p+1]=y}let o=n[n.length-1],a,u=o*4,l,c=t[2*o],f,h=t[2*o+1];i.fill(0);for(let d=0;d<n.length;++d)o=n[d],a=u,l=c,f=h,u=o*4,c=t[2*o],h=t[2*o+1],i[a+2]=i[u]=f-h,i[a+3]=i[u+1]=c-l}render(t){const n=t==null?t=new Vd:void 0,{delaunay:{halfedges:r,inedges:i,hull:s},circumcenters:o,vectors:a}=this;if(s.length<=1)return null;for(let c=0,f=r.length;c<f;++c){const h=r[c];if(h<c)continue;const d=Math.floor(c/3)*2,p=Math.floor(h/3)*2,g=o[d],m=o[d+1],y=o[p],b=o[p+1];this._renderSegment(g,m,y,b,t)}let u,l=s[s.length-1];for(let c=0;c<s.length;++c){u=l,l=s[c];const f=Math.floor(i[l]/3)*2,h=o[f],d=o[f+1],p=u*4,g=this._project(h,d,a[p+2],a[p+3]);g&&this._renderSegment(h,d,g[0],g[1],t)}return n&&n.value()}renderBounds(t){const n=t==null?t=new Vd:void 0;return t.rect(this.xmin,this.ymin,this.xmax-this.xmin,this.ymax-this.ymin),n&&n.value()}renderCell(t,n){const r=n==null?n=new Vd:void 0,i=this._clip(t);if(i===null||!i.length)return;n.moveTo(i[0],i[1]);let s=i.length;for(;i[0]===i[s-2]&&i[1]===i[s-1]&&s>1;)s-=2;for(let o=2;o<s;o+=2)(i[o]!==i[o-2]||i[o+1]!==i[o-1])&&n.lineTo(i[o],i[o+1]);return n.closePath(),r&&r.value()}*cellPolygons(){const{delaunay:{points:t}}=this;for(let n=0,r=t.length/2;n<r;++n){const i=this.cellPolygon(n);i&&(i.index=n,yield i)}}cellPolygon(t){const n=new SL;return this.renderCell(t,n),n.value()}_renderSegment(t,n,r,i,s){let o;const a=this._regioncode(t,n),u=this._regioncode(r,i);a===0&&u===0?(s.moveTo(t,n),s.lineTo(r,i)):(o=this._clipSegment(t,n,r,i,a,u))&&(s.moveTo(o[0],o[1]),s.lineTo(o[2],o[3]))}contains(t,n,r){return n=+n,n!==n||(r=+r,r!==r)?!1:this.delaunay._step(t,n,r)===t}*neighbors(t){const n=this._clip(t);if(n)for(const r of this.delaunay.neighbors(t)){const i=this._clip(r);if(i){e:for(let s=0,o=n.length;s<o;s+=2)for(let a=0,u=i.length;a<u;a+=2)if(n[s]==i[a]&&n[s+1]==i[a+1]&&n[(s+2)%o]==i[(a+u-2)%u]&&n[(s+3)%o]==i[(a+u-1)%u]){yield r;break e}}}}_cell(t){const{circumcenters:n,delaunay:{inedges:r,halfedges:i,triangles:s}}=this,o=r[t];if(o===-1)return null;const a=[];let u=o;do{const l=Math.floor(u/3);if(a.push(n[l*2],n[l*2+1]),u=u%3===2?u-2:u+1,s[u]!==t)break;u=i[u]}while(u!==o&&u!==-1);return a}_clip(t){if(t===0&&this.delaunay.hull.length===1)return[this.xmax,this.ymin,this.xmax,this.ymax,this.xmin,this.ymax,this.xmin,this.ymin];const n=this._cell(t);if(n===null)return null;const{vectors:r}=this,i=t*4;return r[i]||r[i+1]?this._clipInfinite(t,n,r[i],r[i+1],r[i+2],r[i+3]):this._clipFinite(t,n)}_clipFinite(t,n){const r=n.length;let i=null,s,o,a=n[r-2],u=n[r-1],l,c=this._regioncode(a,u),f,h;for(let d=0;d<r;d+=2)if(s=a,o=u,a=n[d],u=n[d+1],l=c,c=this._regioncode(a,u),l===0&&c===0)f=h,h=0,i?i.push(a,u):i=[a,u];else{let p,g,m,y,b;if(l===0){if((p=this._clipSegment(s,o,a,u,l,c))===null)continue;[g,m,y,b]=p}else{if((p=this._clipSegment(a,u,s,o,c,l))===null)continue;[y,b,g,m]=p,f=h,h=this._edgecode(g,m),f&&h&&this._edge(t,f,h,i,i.length),i?i.push(g,m):i=[g,m]}f=h,h=this._edgecode(y,b),f&&h&&this._edge(t,f,h,i,i.length),i?i.push(y,b):i=[y,b]}if(i)f=h,h=this._edgecode(i[0],i[1]),f&&h&&this._edge(t,f,h,i,i.length);else if(this.contains(t,(this.xmin+this.xmax)/2,(this.ymin+this.ymax)/2))return[this.xmax,this.ymin,this.xmax,this.ymax,this.xmin,this.ymax,this.xmin,this.ymin];return i}_clipSegment(t,n,r,i,s,o){for(;;){if(s===0&&o===0)return[t,n,r,i];if(s&o)return null;let a,u,l=s||o;l&8?(a=t+(r-t)*(this.ymax-n)/(i-n),u=this.ymax):l&4?(a=t+(r-t)*(this.ymin-n)/(i-n),u=this.ymin):l&2?(u=n+(i-n)*(this.xmax-t)/(r-t),a=this.xmax):(u=n+(i-n)*(this.xmin-t)/(r-t),a=this.xmin),s?(t=a,n=u,s=this._regioncode(t,n)):(r=a,i=u,o=this._regioncode(r,i))}}_clipInfinite(t,n,r,i,s,o){let a=Array.from(n),u;if((u=this._project(a[0],a[1],r,i))&&a.unshift(u[0],u[1]),(u=this._project(a[a.length-2],a[a.length-1],s,o))&&a.push(u[0],u[1]),a=this._clipFinite(t,a))for(let l=0,c=a.length,f,h=this._edgecode(a[c-2],a[c-1]);l<c;l+=2)f=h,h=this._edgecode(a[l],a[l+1]),f&&h&&(l=this._edge(t,f,h,a,l),c=a.length);else this.contains(t,(this.xmin+this.xmax)/2,(this.ymin+this.ymax)/2)&&(a=[this.xmin,this.ymin,this.xmax,this.ymin,this.xmax,this.ymax,this.xmin,this.ymax]);return a}_edge(t,n,r,i,s){for(;n!==r;){let o,a;switch(n){case 5:n=4;continue;case 4:n=6,o=this.xmax,a=this.ymin;break;case 6:n=2;continue;case 2:n=10,o=this.xmax,a=this.ymax;break;case 10:n=8;continue;case 8:n=9,o=this.xmin,a=this.ymax;break;case 9:n=1;continue;case 1:n=5,o=this.xmin,a=this.ymin;break}(i[s]!==o||i[s+1]!==a)&&this.contains(t,o,a)&&(i.splice(s,0,o,a),s+=2)}if(i.length>4)for(let o=0;o<i.length;o+=2){const a=(o+2)%i.length,u=(o+4)%i.length;(i[o]===i[a]&&i[a]===i[u]||i[o+1]===i[a+1]&&i[a+1]===i[u+1])&&(i.splice(a,2),o-=2)}return s}_project(t,n,r,i){let s=1/0,o,a,u;if(i<0){if(n<=this.ymin)return null;(o=(this.ymin-n)/i)<s&&(u=this.ymin,a=t+(s=o)*r)}else if(i>0){if(n>=this.ymax)return null;(o=(this.ymax-n)/i)<s&&(u=this.ymax,a=t+(s=o)*r)}if(r>0){if(t>=this.xmax)return null;(o=(this.xmax-t)/r)<s&&(a=this.xmax,u=n+(s=o)*i)}else if(r<0){if(t<=this.xmin)return null;(o=(this.xmin-t)/r)<s&&(a=this.xmin,u=n+(s=o)*i)}return[a,u]}_edgecode(t,n){return(t===this.xmin?1:t===this.xmax?2:0)|(n===this.ymin?4:n===this.ymax?8:0)}_regioncode(t,n){return(t<this.xmin?1:t>this.xmax?2:0)|(n<this.ymin?4:n>this.ymax?8:0)}};const nyt=2*Math.PI,um=Math.pow;function ryt(e){return e[0]}function iyt(e){return e[1]}function syt(e){const{triangles:t,coords:n}=e;for(let r=0;r<t.length;r+=3){const i=2*t[r],s=2*t[r+1],o=2*t[r+2];if((n[o]-n[i])*(n[s+1]-n[i+1])-(n[s]-n[i])*(n[o+1]-n[i+1])>1e-10)return!1}return!0}function oyt(e,t,n){return[e+Math.sin(e+t)*n,t+Math.cos(e-t)*n]}class H9{static from(t,n=ryt,r=iyt,i){return new H9("length"in t?ayt(t,n,r,i):Float64Array.from(uyt(t,n,r,i)))}constructor(t){this._delaunator=new P_(t),this.inedges=new Int32Array(t.length/2),this._hullIndex=new Int32Array(t.length/2),this.points=this._delaunator.coords,this._init()}update(){return this._delaunator.update(),this._init(),this}_init(){const t=this._delaunator,n=this.points;if(t.hull&&t.hull.length>2&&syt(t)){this.collinear=Int32Array.from({length:n.length/2},(h,d)=>d).sort((h,d)=>n[2*h]-n[2*d]||n[2*h+1]-n[2*d+1]);const u=this.collinear[0],l=this.collinear[this.collinear.length-1],c=[n[2*u],n[2*u+1],n[2*l],n[2*l+1]],f=1e-8*Math.hypot(c[3]-c[1],c[2]-c[0]);for(let h=0,d=n.length/2;h<d;++h){const p=oyt(n[2*h],n[2*h+1],f);n[2*h]=p[0],n[2*h+1]=p[1]}this._delaunator=new P_(n)}else delete this.collinear;const r=this.halfedges=this._delaunator.halfedges,i=this.hull=this._delaunator.hull,s=this.triangles=this._delaunator.triangles,o=this.inedges.fill(-1),a=this._hullIndex.fill(-1);for(let u=0,l=r.length;u<l;++u){const c=s[u%3===2?u-2:u+1];(r[u]===-1||o[c]===-1)&&(o[c]=u)}for(let u=0,l=i.length;u<l;++u)a[i[u]]=u;i.length<=2&&i.length>0&&(this.triangles=new Int32Array(3).fill(-1),this.halfedges=new Int32Array(3).fill(-1),this.triangles[0]=i[0],this.triangles[1]=i[1],this.triangles[2]=i[1],o[i[0]]=1,i.length===2&&(o[i[1]]=0))}voronoi(t){return new tyt(this,t)}*neighbors(t){const{inedges:n,hull:r,_hullIndex:i,halfedges:s,triangles:o,collinear:a}=this;if(a){const f=a.indexOf(t);f>0&&(yield a[f-1]),f<a.length-1&&(yield a[f+1]);return}const u=n[t];if(u===-1)return;let l=u,c=-1;do{if(yield c=o[l],l=l%3===2?l-2:l+1,o[l]!==t)return;if(l=s[l],l===-1){const f=r[(i[t]+1)%r.length];f!==c&&(yield f);return}}while(l!==u)}find(t,n,r=0){if(t=+t,t!==t||(n=+n,n!==n))return-1;const i=r;let s;for(;(s=this._step(r,t,n))>=0&&s!==r&&s!==i;)r=s;return s}_step(t,n,r){const{inedges:i,hull:s,_hullIndex:o,halfedges:a,triangles:u,points:l}=this;if(i[t]===-1||!l.length)return(t+1)%(l.length>>1);let c=t,f=um(n-l[t*2],2)+um(r-l[t*2+1],2);const h=i[t];let d=h;do{let p=u[d];const g=um(n-l[p*2],2)+um(r-l[p*2+1],2);if(g<f&&(f=g,c=p),d=d%3===2?d-2:d+1,u[d]!==t)break;if(d=a[d],d===-1){if(d=s[(o[t]+1)%s.length],d!==p&&um(n-l[d*2],2)+um(r-l[d*2+1],2)<f)return d;break}}while(d!==h);return c}render(t){const n=t==null?t=new Vd:void 0,{points:r,halfedges:i,triangles:s}=this;for(let o=0,a=i.length;o<a;++o){const u=i[o];if(u<o)continue;const l=s[o]*2,c=s[u]*2;t.moveTo(r[l],r[l+1]),t.lineTo(r[c],r[c+1])}return this.renderHull(t),n&&n.value()}renderPoints(t,n=2){const r=t==null?t=new Vd:void 0,{points:i}=this;for(let s=0,o=i.length;s<o;s+=2){const a=i[s],u=i[s+1];t.moveTo(a+n,u),t.arc(a,u,n,0,nyt)}return r&&r.value()}renderHull(t){const n=t==null?t=new Vd:void 0,{hull:r,points:i}=this,s=r[0]*2,o=r.length;t.moveTo(i[s],i[s+1]);for(let a=1;a<o;++a){const u=2*r[a];t.lineTo(i[u],i[u+1])}return t.closePath(),n&&n.value()}hullPolygon(){const t=new SL;return this.renderHull(t),t.value()}renderTriangle(t,n){const r=n==null?n=new Vd:void 0,{points:i,triangles:s}=this,o=s[t*=3]*2,a=s[t+1]*2,u=s[t+2]*2;return n.moveTo(i[o],i[o+1]),n.lineTo(i[a],i[a+1]),n.lineTo(i[u],i[u+1]),n.closePath(),r&&r.value()}*trianglePolygons(){const{triangles:t}=this;for(let n=0,r=t.length/3;n<r;++n)yield this.trianglePolygon(n)}trianglePolygon(t){const n=new SL;return this.renderTriangle(t,n),n.value()}}function ayt(e,t,n,r){const i=e.length,s=new Float64Array(i*2);for(let o=0;o<i;++o){const a=e[o];s[o*2]=t.call(r,a,o,e),s[o*2+1]=n.call(r,a,o,e)}return s}function*uyt(e,t,n,r){let i=0;for(const s of e)yield t.call(r,s,i,e),yield n.call(r,s,i,e),++i}function q9(e){re.call(this,null,e)}q9.Definition={type:"Voronoi",metadata:{modifies:!0},params:[{name:"x",type:"field",required:!0},{name:"y",type:"field",required:!0},{name:"size",type:"number",array:!0,length:2},{name:"extent",type:"array",array:!0,length:2,default:[[-1e5,-1e5],[1e5,1e5]],content:{type:"number",array:!0,length:2}},{name:"as",type:"string",default:"path"}]};const lyt=[-1e5,-1e5,1e5,1e5];$e(q9,re,{transform(e,t){const n=e.as||"path",r=t.source;if(!r||!r.length)return t;let i=e.size;i=i?[0,0,i[0],i[1]]:(i=e.extent)?[i[0][0],i[0][1],i[1][0],i[1][1]]:lyt;const s=this.value=H9.from(r,e.x,e.y).voronoi(i);for(let o=0,a=r.length;o<a;++o){const u=s.cellPolygon(o);r[o][n]=u?cyt(u):null}return t.reflow(e.modified()).modifies(n)}});function cyt(e){const t=e[0][0],n=e[0][1];let r=e.length-1;for(;e[r][0]===t&&e[r][1]===n;--r);return"M"+e.slice(0,r+1).join("L")+"Z"}const fyt=Object.freeze(Object.defineProperty({__proto__:null,voronoi:q9},Symbol.toStringTag,{value:"Module"}));function vy(e,t,n){return e.fields=t||[],e.fname=n,e}function hyt(e){return e.length===1?dyt(e[0]):pyt(e)}const dyt=e=>function(t){return t[e]},pyt=e=>{const t=e.length;return function(n){for(let r=0;r<t;++r)n=n[e[r]];return n}};function hk(e){throw Error(e)}function gyt(e){const t=[],n=e.length;let r=null,i=0,s="",o,a,u;e=e+"";function l(){t.push(s+e.substring(o,a)),s="",o=a+1}for(o=a=0;a<n;++a)if(u=e[a],u==="\\")s+=e.substring(o,a++),o=a;else if(u===r)l(),r=null,i=-1;else{if(r)continue;o===i&&u==='"'||o===i&&u==="'"?(o=a+1,r=u):u==="."&&!i?a>o?l():o=a+1:u==="["?(a>o&&l(),i=o=a+1):u==="]"&&(i||hk("Access path missing open bracket: "+e),i>0&&l(),i=0,o=a+1)}return i&&hk("Access path missing closing bracket: "+e),r&&hk("Access path missing closing quote: "+e),a>o&&(a++,l()),t}function myt(e,t,n){const r=gyt(e);return e=r.length===1?r[0]:e,vy((n&&n.get||hyt)(r),[e],t||e)}myt("id");vy(e=>e,[],"identity");vy(()=>0,[],"zero");vy(()=>1,[],"one");vy(()=>!0,[],"true");vy(()=>!1,[],"false");var yyt=Array.isArray;function byt(e){return e[e.length-1]}function xyt(e){return e==null||e===""?null:+e}function vyt(e){return e!=null?yyt(e)?e:[e]:[]}function kL(e){return typeof e=="function"}function wyt(e){return kL(e)?e:()=>e}function $yt(e){for(let t,n,r=1,i=arguments.length;r<i;++r){t=arguments[r];for(n in t)e[n]=t[n]}return e}function Cyt(e,t){let n=0,r,i,s,o;if(e&&(r=e.length))if(t==null){for(i=e[n];n<r&&(i==null||i!==i);i=e[++n]);for(s=o=i;n<r;++n)i=e[n],i!=null&&(i<s&&(s=i),i>o&&(o=i))}else{for(i=t(e[n]);n<r&&(i==null||i!==i);i=t(e[++n]));for(s=o=i;n<r;++n)i=t(e[n]),i!=null&&(i<s&&(s=i),i>o&&(o=i))}return[s,o]}function Syt(e,t,n){const r=e.prototype=Object.create(t.prototype);return Object.defineProperty(r,"constructor",{value:e,writable:!0,enumerable:!0,configurable:!0}),$yt(r,n)}function kyt(e){const t={},n=e.length;for(let r=0;r<n;++r)t[e[r]]=!0;return t}function wx(e,t){return e==null||t==null?NaN:e<t?-1:e>t?1:e>=t?0:NaN}function Eyt(e,t){return e==null||t==null?NaN:t<e?-1:t>e?1:t>=e?0:NaN}function X9(e){let t,n,r;e.length!==2?(t=wx,n=(a,u)=>wx(e(a),u),r=(a,u)=>e(a)-u):(t=e===wx||e===Eyt?e:_yt,n=e,r=e);function i(a,u,l=0,c=a.length){if(l<c){if(t(u,u)!==0)return c;do{const f=l+c>>>1;n(a[f],u)<0?l=f+1:c=f}while(l<c)}return l}function s(a,u,l=0,c=a.length){if(l<c){if(t(u,u)!==0)return c;do{const f=l+c>>>1;n(a[f],u)<=0?l=f+1:c=f}while(l<c)}return l}function o(a,u,l=0,c=a.length){const f=i(a,u,l,c-1);return f>l&&r(a[f-1],u)>-r(a[f],u)?f-1:f}return{left:i,center:o,right:s}}function _yt(){return 0}function t0e(e){return e===null?NaN:+e}const Ayt=X9(wx),EL=Ayt.right;X9(t0e).center;const L$=EL,Tyt=Math.sqrt(50),Iyt=Math.sqrt(10),Dyt=Math.sqrt(2);function B_(e,t,n){const r=(t-e)/Math.max(0,n),i=Math.floor(Math.log10(r)),s=r/Math.pow(10,i),o=s>=Tyt?10:s>=Iyt?5:s>=Dyt?2:1;let a,u,l;return i<0?(l=Math.pow(10,-i)/o,a=Math.round(e*l),u=Math.round(t*l),a/l<e&&++a,u/l>t&&--u,l=-l):(l=Math.pow(10,i)*o,a=Math.round(e/l),u=Math.round(t/l),a*l<e&&++a,u*l>t&&--u),u<a&&.5<=n&&n<2?B_(e,t,n*2):[a,u,l]}function _L(e,t,n){if(t=+t,e=+e,n=+n,!(n>0))return[];if(e===t)return[e];const r=t<e,[i,s,o]=r?B_(t,e,n):B_(e,t,n);if(!(s>=i))return[];const a=s-i+1,u=new Array(a);if(r)if(o<0)for(let l=0;l<a;++l)u[l]=(s-l)/-o;else for(let l=0;l<a;++l)u[l]=(s-l)*o;else if(o<0)for(let l=0;l<a;++l)u[l]=(i+l)/-o;else for(let l=0;l<a;++l)u[l]=(i+l)*o;return u}function AL(e,t,n){return t=+t,e=+e,n=+n,B_(e,t,n)[2]}function TL(e,t,n){t=+t,e=+e,n=+n;const r=t<e,i=r?AL(t,e,n):AL(e,t,n);return(r?-1:1)*(i<0?1/-i:i)}function Nyt(e,t,n=t0e){if(!(!(r=e.length)||isNaN(t=+t))){if(t<=0||r<2)return+n(e[0],0,e);if(t>=1)return+n(e[r-1],r-1,e);var r,i=(r-1)*t,s=Math.floor(i),o=+n(e[s],s,e),a=+n(e[s+1],s+1,e);return o+(a-o)*(i-s)}}function Fyt(e,t,n){e=+e,t=+t,n=(i=arguments.length)<2?(t=e,e=0,1):i<3?1:+n;for(var r=-1,i=Math.max(0,Math.ceil((t-e)/n))|0,s=new Array(i);++r<i;)s[r]=e+r*n;return s}function sl(e,t){switch(arguments.length){case 0:break;case 1:this.range(e);break;default:this.range(t).domain(e);break}return this}function zh(e,t){switch(arguments.length){case 0:break;case 1:{typeof e=="function"?this.interpolator(e):this.range(e);break}default:{this.domain(e),typeof t=="function"?this.interpolator(t):this.range(t);break}}return this}const DK=Symbol("implicit");function Y9(){var e=new lE,t=[],n=[],r=DK;function i(s){let o=e.get(s);if(o===void 0){if(r!==DK)return r;e.set(s,o=t.push(s)-1)}return n[o%n.length]}return i.domain=function(s){if(!arguments.length)return t.slice();t=[],e=new lE;for(const o of s)e.has(o)||e.set(o,t.push(o)-1);return i},i.range=function(s){return arguments.length?(n=Array.from(s),i):n.slice()},i.unknown=function(s){return arguments.length?(r=s,i):r},i.copy=function(){return Y9(t,n).unknown(r)},sl.apply(i,arguments),i}function n0e(e,t,n,r,i){var s=e*e,o=s*e;return((1-3*e+3*s-o)*t+(4-6*s+3*o)*n+(1+3*e+3*s-3*o)*r+o*i)/6}function r0e(e){var t=e.length-1;return function(n){var r=n<=0?n=0:n>=1?(n=1,t-1):Math.floor(n*t),i=e[r],s=e[r+1],o=r>0?e[r-1]:2*i-s,a=r<t-1?e[r+2]:2*s-i;return n0e((n-r/t)*t,o,i,s,a)}}function i0e(e){var t=e.length;return function(n){var r=Math.floor(((n%=1)<0?++n:n)*t),i=e[(r+t-1)%t],s=e[r%t],o=e[(r+1)%t],a=e[(r+2)%t];return n0e((n-r/t)*t,i,s,o,a)}}const pN=e=>()=>e;function s0e(e,t){return function(n){return e+n*t}}function Oyt(e,t,n){return e=Math.pow(e,n),t=Math.pow(t,n)-e,n=1/n,function(r){return Math.pow(e+r*t,n)}}function gN(e,t){var n=t-e;return n?s0e(e,n>180||n<-180?n-360*Math.round(n/360):n):pN(isNaN(e)?t:e)}function Ryt(e){return(e=+e)==1?kr:function(t,n){return n-t?Oyt(t,n,e):pN(isNaN(t)?n:t)}}function kr(e,t){var n=t-e;return n?s0e(e,n):pN(isNaN(e)?t:e)}const IL=function e(t){var n=Ryt(t);function r(i,s){var o=n((i=Ns(i)).r,(s=Ns(s)).r),a=n(i.g,s.g),u=n(i.b,s.b),l=kr(i.opacity,s.opacity);return function(c){return i.r=o(c),i.g=a(c),i.b=u(c),i.opacity=l(c),i+""}}return r.gamma=e,r}(1);function o0e(e){return function(t){var n=t.length,r=new Array(n),i=new Array(n),s=new Array(n),o,a;for(o=0;o<n;++o)a=Ns(t[o]),r[o]=a.r||0,i[o]=a.g||0,s[o]=a.b||0;return r=e(r),i=e(i),s=e(s),a.opacity=1,function(u){return a.r=r(u),a.g=i(u),a.b=s(u),a+""}}}var Myt=o0e(r0e),Lyt=o0e(i0e);function K9(e,t){t||(t=[]);var n=e?Math.min(t.length,e.length):0,r=t.slice(),i;return function(s){for(i=0;i<n;++i)r[i]=e[i]*(1-s)+t[i]*s;return r}}function a0e(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}function Pyt(e,t){return(a0e(t)?K9:u0e)(e,t)}function u0e(e,t){var n=t?t.length:0,r=e?Math.min(n,e.length):0,i=new Array(r),s=new Array(n),o;for(o=0;o<r;++o)i[o]=Ig(e[o],t[o]);for(;o<n;++o)s[o]=t[o];return function(a){for(o=0;o<r;++o)s[o]=i[o](a);return s}}function l0e(e,t){var n=new Date;return e=+e,t=+t,function(r){return n.setTime(e*(1-r)+t*r),n}}function ga(e,t){return e=+e,t=+t,function(n){return e*(1-n)+t*n}}function c0e(e,t){var n={},r={},i;(e===null||typeof e!="object")&&(e={}),(t===null||typeof t!="object")&&(t={});for(i in t)i in e?n[i]=Ig(e[i],t[i]):r[i]=t[i];return function(s){for(i in n)r[i]=n[i](s);return r}}var DL=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,UO=new RegExp(DL.source,"g");function Byt(e){return function(){return e}}function zyt(e){return function(t){return e(t)+""}}function f0e(e,t){var n=DL.lastIndex=UO.lastIndex=0,r,i,s,o=-1,a=[],u=[];for(e=e+"",t=t+"";(r=DL.exec(e))&&(i=UO.exec(t));)(s=i.index)>n&&(s=t.slice(n,s),a[o]?a[o]+=s:a[++o]=s),(r=r[0])===(i=i[0])?a[o]?a[o]+=i:a[++o]=i:(a[++o]=null,u.push({i:o,x:ga(r,i)})),n=UO.lastIndex;return n<t.length&&(s=t.slice(n),a[o]?a[o]+=s:a[++o]=s),a.length<2?u[0]?zyt(u[0].x):Byt(t):(t=u.length,function(l){for(var c=0,f;c<t;++c)a[(f=u[c]).i]=f.x(l);return a.join("")})}function Ig(e,t){var n=typeof t,r;return t==null||n==="boolean"?pN(t):(n==="number"?ga:n==="string"?(r=hc(t))?(t=r,IL):f0e:t instanceof hc?IL:t instanceof Date?l0e:a0e(t)?K9:Array.isArray(t)?u0e:typeof t.valueOf!="function"&&typeof t.toString!="function"||isNaN(t)?c0e:ga)(e,t)}function Uyt(e){var t=e.length;return function(n){return e[Math.max(0,Math.min(t-1,Math.floor(n*t)))]}}function jyt(e,t){var n=gN(+e,+t);return function(r){var i=n(r);return i-360*Math.floor(i/360)}}function mN(e,t){return e=+e,t=+t,function(n){return Math.round(e*(1-n)+t*n)}}var NK=180/Math.PI,NL={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function h0e(e,t,n,r,i,s){var o,a,u;return(o=Math.sqrt(e*e+t*t))&&(e/=o,t/=o),(u=e*n+t*r)&&(n-=e*u,r-=t*u),(a=Math.sqrt(n*n+r*r))&&(n/=a,r/=a,u/=a),e*r<t*n&&(e=-e,t=-t,u=-u,o=-o),{translateX:i,translateY:s,rotate:Math.atan2(t,e)*NK,skewX:Math.atan(u)*NK,scaleX:o,scaleY:a}}var vS;function Wyt(e){const t=new(typeof DOMMatrix=="function"?DOMMatrix:WebKitCSSMatrix)(e+"");return t.isIdentity?NL:h0e(t.a,t.b,t.c,t.d,t.e,t.f)}function Vyt(e){return e==null||(vS||(vS=document.createElementNS("http://www.w3.org/2000/svg","g")),vS.setAttribute("transform",e),!(e=vS.transform.baseVal.consolidate()))?NL:(e=e.matrix,h0e(e.a,e.b,e.c,e.d,e.e,e.f))}function d0e(e,t,n,r){function i(l){return l.length?l.pop()+" ":""}function s(l,c,f,h,d,p){if(l!==f||c!==h){var g=d.push("translate(",null,t,null,n);p.push({i:g-4,x:ga(l,f)},{i:g-2,x:ga(c,h)})}else(f||h)&&d.push("translate("+f+t+h+n)}function o(l,c,f,h){l!==c?(l-c>180?c+=360:c-l>180&&(l+=360),h.push({i:f.push(i(f)+"rotate(",null,r)-2,x:ga(l,c)})):c&&f.push(i(f)+"rotate("+c+r)}function a(l,c,f,h){l!==c?h.push({i:f.push(i(f)+"skewX(",null,r)-2,x:ga(l,c)}):c&&f.push(i(f)+"skewX("+c+r)}function u(l,c,f,h,d,p){if(l!==f||c!==h){var g=d.push(i(d)+"scale(",null,",",null,")");p.push({i:g-4,x:ga(l,f)},{i:g-2,x:ga(c,h)})}else(f!==1||h!==1)&&d.push(i(d)+"scale("+f+","+h+")")}return function(l,c){var f=[],h=[];return l=e(l),c=e(c),s(l.translateX,l.translateY,c.translateX,c.translateY,f,h),o(l.rotate,c.rotate,f,h),a(l.skewX,c.skewX,f,h),u(l.scaleX,l.scaleY,c.scaleX,c.scaleY,f,h),l=c=null,function(d){for(var p=-1,g=h.length,m;++p<g;)f[(m=h[p]).i]=m.x(d);return f.join("")}}}var Gyt=d0e(Wyt,"px, ","px)","deg)"),Hyt=d0e(Vyt,", ",")",")"),qyt=1e-12;function FK(e){return((e=Math.exp(e))+1/e)/2}function Xyt(e){return((e=Math.exp(e))-1/e)/2}function Yyt(e){return((e=Math.exp(2*e))-1)/(e+1)}const Kyt=function e(t,n,r){function i(s,o){var a=s[0],u=s[1],l=s[2],c=o[0],f=o[1],h=o[2],d=c-a,p=f-u,g=d*d+p*p,m,y;if(g<qyt)y=Math.log(h/l)/t,m=function($){return[a+$*d,u+$*p,l*Math.exp(t*$*y)]};else{var b=Math.sqrt(g),v=(h*h-l*l+r*g)/(2*l*n*b),x=(h*h-l*l-r*g)/(2*h*n*b),w=Math.log(Math.sqrt(v*v+1)-v),C=Math.log(Math.sqrt(x*x+1)-x);y=(C-w)/t,m=function($){var S=$*y,k=FK(w),E=l/(n*b)*(k*Yyt(t*S+w)-Xyt(w));return[a+E*d,u+E*p,l*k/FK(t*S+w)]}}return m.duration=y*1e3*t/Math.SQRT2,m}return i.rho=function(s){var o=Math.max(.001,+s),a=o*o,u=a*a;return e(o,a,u)},i}(Math.SQRT2,2,4);function p0e(e){return function(t,n){var r=e((t=nh(t)).h,(n=nh(n)).h),i=kr(t.s,n.s),s=kr(t.l,n.l),o=kr(t.opacity,n.opacity);return function(a){return t.h=r(a),t.s=i(a),t.l=s(a),t.opacity=o(a),t+""}}}const Zyt=p0e(gN);var Jyt=p0e(kr);function Qyt(e,t){var n=kr((e=rh(e)).l,(t=rh(t)).l),r=kr(e.a,t.a),i=kr(e.b,t.b),s=kr(e.opacity,t.opacity);return function(o){return e.l=n(o),e.a=r(o),e.b=i(o),e.opacity=s(o),e+""}}function g0e(e){return function(t,n){var r=e((t=ih(t)).h,(n=ih(n)).h),i=kr(t.c,n.c),s=kr(t.l,n.l),o=kr(t.opacity,n.opacity);return function(a){return t.h=r(a),t.c=i(a),t.l=s(a),t.opacity=o(a),t+""}}}const ebt=g0e(gN);var tbt=g0e(kr);function m0e(e){return function t(n){n=+n;function r(i,s){var o=e((i=Tp(i)).h,(s=Tp(s)).h),a=kr(i.s,s.s),u=kr(i.l,s.l),l=kr(i.opacity,s.opacity);return function(c){return i.h=o(c),i.s=a(c),i.l=u(Math.pow(c,n)),i.opacity=l(c),i+""}}return r.gamma=t,r}(1)}const nbt=m0e(gN);var rbt=m0e(kr);function Z9(e,t){t===void 0&&(t=e,e=Ig);for(var n=0,r=t.length-1,i=t[0],s=new Array(r<0?0:r);n<r;)s[n]=e(i,i=t[++n]);return function(o){var a=Math.max(0,Math.min(r-1,Math.floor(o*=r)));return s[a](o-a)}}function ibt(e,t){for(var n=new Array(t),r=0;r<t;++r)n[r]=e(r/(t-1));return n}const sbt=Object.freeze(Object.defineProperty({__proto__:null,interpolate:Ig,interpolateArray:Pyt,interpolateBasis:r0e,interpolateBasisClosed:i0e,interpolateCubehelix:nbt,interpolateCubehelixLong:rbt,interpolateDate:l0e,interpolateDiscrete:Uyt,interpolateHcl:ebt,interpolateHclLong:tbt,interpolateHsl:Zyt,interpolateHslLong:Jyt,interpolateHue:jyt,interpolateLab:Qyt,interpolateNumber:ga,interpolateNumberArray:K9,interpolateObject:c0e,interpolateRgb:IL,interpolateRgbBasis:Myt,interpolateRgbBasisClosed:Lyt,interpolateRound:mN,interpolateString:f0e,interpolateTransformCss:Gyt,interpolateTransformSvg:Hyt,interpolateZoom:Kyt,piecewise:Z9,quantize:ibt},Symbol.toStringTag,{value:"Module"}));function obt(e){return function(){return e}}function FL(e){return+e}var OK=[0,1];function Ss(e){return e}function OL(e,t){return(t-=e=+e)?function(n){return(n-e)/t}:obt(isNaN(t)?NaN:.5)}function abt(e,t){var n;return e>t&&(n=e,e=t,t=n),function(r){return Math.max(e,Math.min(t,r))}}function ubt(e,t,n){var r=e[0],i=e[1],s=t[0],o=t[1];return i<r?(r=OL(i,r),s=n(o,s)):(r=OL(r,i),s=n(s,o)),function(a){return s(r(a))}}function lbt(e,t,n){var r=Math.min(e.length,t.length)-1,i=new Array(r),s=new Array(r),o=-1;for(e[r]<e[0]&&(e=e.slice().reverse(),t=t.slice().reverse());++o<r;)i[o]=OL(e[o],e[o+1]),s[o]=n(t[o],t[o+1]);return function(a){var u=L$(e,a,1,r)-1;return s[u](i[u](a))}}function P$(e,t){return t.domain(e.domain()).range(e.range()).interpolate(e.interpolate()).clamp(e.clamp()).unknown(e.unknown())}function yN(){var e=OK,t=OK,n=Ig,r,i,s,o=Ss,a,u,l;function c(){var h=Math.min(e.length,t.length);return o!==Ss&&(o=abt(e[0],e[h-1])),a=h>2?lbt:ubt,u=l=null,f}function f(h){return h==null||isNaN(h=+h)?s:(u||(u=a(e.map(r),t,n)))(r(o(h)))}return f.invert=function(h){return o(i((l||(l=a(t,e.map(r),ga)))(h)))},f.domain=function(h){return arguments.length?(e=Array.from(h,FL),c()):e.slice()},f.range=function(h){return arguments.length?(t=Array.from(h),c()):t.slice()},f.rangeRound=function(h){return t=Array.from(h),n=mN,c()},f.clamp=function(h){return arguments.length?(o=h?!0:Ss,c()):o!==Ss},f.interpolate=function(h){return arguments.length?(n=h,c()):n},f.unknown=function(h){return arguments.length?(s=h,f):s},function(h,d){return r=h,i=d,c()}}function y0e(){return yN()(Ss,Ss)}function b0e(e,t,n,r){var i=TL(e,t,n),s;switch(r=Fp(r??",f"),r.type){case"s":{var o=Math.max(Math.abs(e),Math.abs(t));return r.precision==null&&!isNaN(s=n7(i,o))&&(r.precision=s),WD(r,o)}case"":case"e":case"g":case"p":case"r":{r.precision==null&&!isNaN(s=r7(i,Math.max(Math.abs(e),Math.abs(t))))&&(r.precision=s-(r.type==="e"));break}case"f":case"%":{r.precision==null&&!isNaN(s=t7(i))&&(r.precision=s-(r.type==="%")*2);break}}return my(r)}function Dg(e){var t=e.domain;return e.ticks=function(n){var r=t();return _L(r[0],r[r.length-1],n??10)},e.tickFormat=function(n,r){var i=t();return b0e(i[0],i[i.length-1],n??10,r)},e.nice=function(n){n==null&&(n=10);var r=t(),i=0,s=r.length-1,o=r[i],a=r[s],u,l,c=10;for(a<o&&(l=o,o=a,a=l,l=i,i=s,s=l);c-- >0;){if(l=AL(o,a,n),l===u)return r[i]=o,r[s]=a,t(r);if(l>0)o=Math.floor(o/l)*l,a=Math.ceil(a/l)*l;else if(l<0)o=Math.ceil(o*l)/l,a=Math.floor(a*l)/l;else break;u=l}return e},e}function x0e(){var e=y0e();return e.copy=function(){return P$(e,x0e())},sl.apply(e,arguments),Dg(e)}function v0e(e){var t;function n(r){return r==null||isNaN(r=+r)?t:r}return n.invert=n,n.domain=n.range=function(r){return arguments.length?(e=Array.from(r,FL),n):e.slice()},n.unknown=function(r){return arguments.length?(t=r,n):t},n.copy=function(){return v0e(e).unknown(t)},e=arguments.length?Array.from(e,FL):[0,1],Dg(n)}function w0e(e,t){e=e.slice();var n=0,r=e.length-1,i=e[n],s=e[r],o;return s<i&&(o=n,n=r,r=o,o=i,i=s,s=o),e[n]=t.floor(i),e[r]=t.ceil(s),e}function RK(e){return Math.log(e)}function MK(e){return Math.exp(e)}function cbt(e){return-Math.log(-e)}function fbt(e){return-Math.exp(-e)}function hbt(e){return isFinite(e)?+("1e"+e):e<0?0:e}function dbt(e){return e===10?hbt:e===Math.E?Math.exp:t=>Math.pow(e,t)}function pbt(e){return e===Math.E?Math.log:e===10&&Math.log10||e===2&&Math.log2||(e=Math.log(e),t=>Math.log(t)/e)}function LK(e){return(t,n)=>-e(-t,n)}function J9(e){const t=e(RK,MK),n=t.domain;let r=10,i,s;function o(){return i=pbt(r),s=dbt(r),n()[0]<0?(i=LK(i),s=LK(s),e(cbt,fbt)):e(RK,MK),t}return t.base=function(a){return arguments.length?(r=+a,o()):r},t.domain=function(a){return arguments.length?(n(a),o()):n()},t.ticks=a=>{const u=n();let l=u[0],c=u[u.length-1];const f=c<l;f&&([l,c]=[c,l]);let h=i(l),d=i(c),p,g;const m=a==null?10:+a;let y=[];if(!(r%1)&&d-h<m){if(h=Math.floor(h),d=Math.ceil(d),l>0){for(;h<=d;++h)for(p=1;p<r;++p)if(g=h<0?p/s(-h):p*s(h),!(g<l)){if(g>c)break;y.push(g)}}else for(;h<=d;++h)for(p=r-1;p>=1;--p)if(g=h>0?p/s(-h):p*s(h),!(g<l)){if(g>c)break;y.push(g)}y.length*2<m&&(y=_L(l,c,m))}else y=_L(h,d,Math.min(d-h,m)).map(s);return f?y.reverse():y},t.tickFormat=(a,u)=>{if(a==null&&(a=10),u==null&&(u=r===10?"s":","),typeof u!="function"&&(!(r%1)&&(u=Fp(u)).precision==null&&(u.trim=!0),u=my(u)),a===1/0)return u;const l=Math.max(1,r*a/t.ticks().length);return c=>{let f=c/s(Math.round(i(c)));return f*r<r-.5&&(f*=r),f<=l?u(c):""}},t.nice=()=>n(w0e(n(),{floor:a=>s(Math.floor(i(a))),ceil:a=>s(Math.ceil(i(a)))})),t}function $0e(){const e=J9(yN()).domain([1,10]);return e.copy=()=>P$(e,$0e()).base(e.base()),sl.apply(e,arguments),e}function PK(e){return function(t){return Math.sign(t)*Math.log1p(Math.abs(t/e))}}function BK(e){return function(t){return Math.sign(t)*Math.expm1(Math.abs(t))*e}}function Q9(e){var t=1,n=e(PK(t),BK(t));return n.constant=function(r){return arguments.length?e(PK(t=+r),BK(t)):t},Dg(n)}function C0e(){var e=Q9(yN());return e.copy=function(){return P$(e,C0e()).constant(e.constant())},sl.apply(e,arguments)}function zK(e){return function(t){return t<0?-Math.pow(-t,e):Math.pow(t,e)}}function gbt(e){return e<0?-Math.sqrt(-e):Math.sqrt(e)}function mbt(e){return e<0?-e*e:e*e}function eU(e){var t=e(Ss,Ss),n=1;function r(){return n===1?e(Ss,Ss):n===.5?e(gbt,mbt):e(zK(n),zK(1/n))}return t.exponent=function(i){return arguments.length?(n=+i,r()):n},Dg(t)}function tU(){var e=eU(yN());return e.copy=function(){return P$(e,tU()).exponent(e.exponent())},sl.apply(e,arguments),e}function ybt(){return tU.apply(null,arguments).exponent(.5)}function S0e(){var e=[],t=[],n=[],r;function i(){var o=0,a=Math.max(1,t.length);for(n=new Array(a-1);++o<a;)n[o-1]=Nyt(e,o/a);return s}function s(o){return o==null||isNaN(o=+o)?r:t[L$(n,o)]}return s.invertExtent=function(o){var a=t.indexOf(o);return a<0?[NaN,NaN]:[a>0?n[a-1]:e[0],a<n.length?n[a]:e[e.length-1]]},s.domain=function(o){if(!arguments.length)return e.slice();e=[];for(let a of o)a!=null&&!isNaN(a=+a)&&e.push(a);return e.sort(wx),i()},s.range=function(o){return arguments.length?(t=Array.from(o),i()):t.slice()},s.unknown=function(o){return arguments.length?(r=o,s):r},s.quantiles=function(){return n.slice()},s.copy=function(){return S0e().domain(e).range(t).unknown(r)},sl.apply(s,arguments)}function k0e(){var e=0,t=1,n=1,r=[.5],i=[0,1],s;function o(u){return u!=null&&u<=u?i[L$(r,u,0,n)]:s}function a(){var u=-1;for(r=new Array(n);++u<n;)r[u]=((u+1)*t-(u-n)*e)/(n+1);return o}return o.domain=function(u){return arguments.length?([e,t]=u,e=+e,t=+t,a()):[e,t]},o.range=function(u){return arguments.length?(n=(i=Array.from(u)).length-1,a()):i.slice()},o.invertExtent=function(u){var l=i.indexOf(u);return l<0?[NaN,NaN]:l<1?[e,r[0]]:l>=n?[r[n-1],t]:[r[l-1],r[l]]},o.unknown=function(u){return arguments.length&&(s=u),o},o.thresholds=function(){return r.slice()},o.copy=function(){return k0e().domain([e,t]).range(i).unknown(s)},sl.apply(Dg(o),arguments)}function E0e(){var e=[.5],t=[0,1],n,r=1;function i(s){return s!=null&&s<=s?t[L$(e,s,0,r)]:n}return i.domain=function(s){return arguments.length?(e=Array.from(s),r=Math.min(e.length,t.length-1),i):e.slice()},i.range=function(s){return arguments.length?(t=Array.from(s),r=Math.min(e.length,t.length-1),i):t.slice()},i.invertExtent=function(s){var o=t.indexOf(s);return[e[o-1],e[o]]},i.unknown=function(s){return arguments.length?(n=s,i):n},i.copy=function(){return E0e().domain(e).range(t).unknown(n)},sl.apply(i,arguments)}const jO=new Date,WO=new Date;function br(e,t,n,r){function i(s){return e(s=arguments.length===0?new Date:new Date(+s)),s}return i.floor=s=>(e(s=new Date(+s)),s),i.ceil=s=>(e(s=new Date(s-1)),t(s,1),e(s),s),i.round=s=>{const o=i(s),a=i.ceil(s);return s-o<a-s?o:a},i.offset=(s,o)=>(t(s=new Date(+s),o==null?1:Math.floor(o)),s),i.range=(s,o,a)=>{const u=[];if(s=i.ceil(s),a=a==null?1:Math.floor(a),!(s<o)||!(a>0))return u;let l;do u.push(l=new Date(+s)),t(s,a),e(s);while(l<s&&s<o);return u},i.filter=s=>br(o=>{if(o>=o)for(;e(o),!s(o);)o.setTime(o-1)},(o,a)=>{if(o>=o)if(a<0)for(;++a<=0;)for(;t(o,-1),!s(o););else for(;--a>=0;)for(;t(o,1),!s(o););}),n&&(i.count=(s,o)=>(jO.setTime(+s),WO.setTime(+o),e(jO),e(WO),Math.floor(n(jO,WO))),i.every=s=>(s=Math.floor(s),!isFinite(s)||!(s>0)?null:s>1?i.filter(r?o=>r(o)%s===0:o=>i.count(0,o)%s===0):i)),i}const N0=br(()=>{},(e,t)=>{e.setTime(+e+t)},(e,t)=>t-e);N0.every=e=>(e=Math.floor(e),!isFinite(e)||!(e>0)?null:e>1?br(t=>{t.setTime(Math.floor(t/e)*e)},(t,n)=>{t.setTime(+t+n*e)},(t,n)=>(n-t)/e):N0);N0.range;const Xl=1e3,Io=Xl*60,Yl=Io*60,gc=Yl*24,nU=gc*7,UK=gc*30,VO=gc*365,Kl=br(e=>{e.setTime(e-e.getMilliseconds())},(e,t)=>{e.setTime(+e+t*Xl)},(e,t)=>(t-e)/Xl,e=>e.getUTCSeconds());Kl.range;const bN=br(e=>{e.setTime(e-e.getMilliseconds()-e.getSeconds()*Xl)},(e,t)=>{e.setTime(+e+t*Io)},(e,t)=>(t-e)/Io,e=>e.getMinutes());bN.range;const xN=br(e=>{e.setUTCSeconds(0,0)},(e,t)=>{e.setTime(+e+t*Io)},(e,t)=>(t-e)/Io,e=>e.getUTCMinutes());xN.range;const vN=br(e=>{e.setTime(e-e.getMilliseconds()-e.getSeconds()*Xl-e.getMinutes()*Io)},(e,t)=>{e.setTime(+e+t*Yl)},(e,t)=>(t-e)/Yl,e=>e.getHours());vN.range;const wN=br(e=>{e.setUTCMinutes(0,0,0)},(e,t)=>{e.setTime(+e+t*Yl)},(e,t)=>(t-e)/Yl,e=>e.getUTCHours());wN.range;const Lm=br(e=>e.setHours(0,0,0,0),(e,t)=>e.setDate(e.getDate()+t),(e,t)=>(t-e-(t.getTimezoneOffset()-e.getTimezoneOffset())*Io)/gc,e=>e.getDate()-1);Lm.range;const $x=br(e=>{e.setUTCHours(0,0,0,0)},(e,t)=>{e.setUTCDate(e.getUTCDate()+t)},(e,t)=>(t-e)/gc,e=>e.getUTCDate()-1);$x.range;const _0e=br(e=>{e.setUTCHours(0,0,0,0)},(e,t)=>{e.setUTCDate(e.getUTCDate()+t)},(e,t)=>(t-e)/gc,e=>Math.floor(e/gc));_0e.range;function Ng(e){return br(t=>{t.setDate(t.getDate()-(t.getDay()+7-e)%7),t.setHours(0,0,0,0)},(t,n)=>{t.setDate(t.getDate()+n*7)},(t,n)=>(n-t-(n.getTimezoneOffset()-t.getTimezoneOffset())*Io)/nU)}const $N=Ng(0),bbt=Ng(1),xbt=Ng(2),vbt=Ng(3),wbt=Ng(4),$bt=Ng(5),Cbt=Ng(6);$N.range;bbt.range;xbt.range;vbt.range;wbt.range;$bt.range;Cbt.range;function Fg(e){return br(t=>{t.setUTCDate(t.getUTCDate()-(t.getUTCDay()+7-e)%7),t.setUTCHours(0,0,0,0)},(t,n)=>{t.setUTCDate(t.getUTCDate()+n*7)},(t,n)=>(n-t)/nU)}const CN=Fg(0),Sbt=Fg(1),kbt=Fg(2),Ebt=Fg(3),_bt=Fg(4),Abt=Fg(5),Tbt=Fg(6);CN.range;Sbt.range;kbt.range;Ebt.range;_bt.range;Abt.range;Tbt.range;const qv=br(e=>{e.setDate(1),e.setHours(0,0,0,0)},(e,t)=>{e.setMonth(e.getMonth()+t)},(e,t)=>t.getMonth()-e.getMonth()+(t.getFullYear()-e.getFullYear())*12,e=>e.getMonth());qv.range;const Xv=br(e=>{e.setUTCDate(1),e.setUTCHours(0,0,0,0)},(e,t)=>{e.setUTCMonth(e.getUTCMonth()+t)},(e,t)=>t.getUTCMonth()-e.getUTCMonth()+(t.getUTCFullYear()-e.getUTCFullYear())*12,e=>e.getUTCMonth());Xv.range;const B$=br(e=>{e.setMonth(0,1),e.setHours(0,0,0,0)},(e,t)=>{e.setFullYear(e.getFullYear()+t)},(e,t)=>t.getFullYear()-e.getFullYear(),e=>e.getFullYear());B$.every=e=>!isFinite(e=Math.floor(e))||!(e>0)?null:br(t=>{t.setFullYear(Math.floor(t.getFullYear()/e)*e),t.setMonth(0,1),t.setHours(0,0,0,0)},(t,n)=>{t.setFullYear(t.getFullYear()+n*e)});B$.range;const z$=br(e=>{e.setUTCMonth(0,1),e.setUTCHours(0,0,0,0)},(e,t)=>{e.setUTCFullYear(e.getUTCFullYear()+t)},(e,t)=>t.getUTCFullYear()-e.getUTCFullYear(),e=>e.getUTCFullYear());z$.every=e=>!isFinite(e=Math.floor(e))||!(e>0)?null:br(t=>{t.setUTCFullYear(Math.floor(t.getUTCFullYear()/e)*e),t.setUTCMonth(0,1),t.setUTCHours(0,0,0,0)},(t,n)=>{t.setUTCFullYear(t.getUTCFullYear()+n*e)});z$.range;function A0e(e,t,n,r,i,s){const o=[[Kl,1,Xl],[Kl,5,5*Xl],[Kl,15,15*Xl],[Kl,30,30*Xl],[s,1,Io],[s,5,5*Io],[s,15,15*Io],[s,30,30*Io],[i,1,Yl],[i,3,3*Yl],[i,6,6*Yl],[i,12,12*Yl],[r,1,gc],[r,2,2*gc],[n,1,nU],[t,1,UK],[t,3,3*UK],[e,1,VO]];function a(l,c,f){const h=c<l;h&&([l,c]=[c,l]);const d=f&&typeof f.range=="function"?f:u(l,c,f),p=d?d.range(l,+c+1):[];return h?p.reverse():p}function u(l,c,f){const h=Math.abs(c-l)/f,d=X9(([,,m])=>m).right(o,h);if(d===o.length)return e.every(TL(l/VO,c/VO,f));if(d===0)return N0.every(Math.max(TL(l,c,f),1));const[p,g]=o[h/o[d-1][2]<o[d][2]/h?d-1:d];return p.every(g)}return[a,u]}const[Ibt,Dbt]=A0e(z$,Xv,CN,_0e,wN,xN),[Nbt,Fbt]=A0e(B$,qv,$N,Lm,vN,bN);function Obt(e){return new Date(e)}function Rbt(e){return e instanceof Date?+e:+new Date(+e)}function rU(e,t,n,r,i,s,o,a,u,l){var c=y0e(),f=c.invert,h=c.domain,d=l(".%L"),p=l(":%S"),g=l("%I:%M"),m=l("%I %p"),y=l("%a %d"),b=l("%b %d"),v=l("%B"),x=l("%Y");function w(C){return(u(C)<C?d:a(C)<C?p:o(C)<C?g:s(C)<C?m:r(C)<C?i(C)<C?y:b:n(C)<C?v:x)(C)}return c.invert=function(C){return new Date(f(C))},c.domain=function(C){return arguments.length?h(Array.from(C,Rbt)):h().map(Obt)},c.ticks=function(C){var $=h();return e($[0],$[$.length-1],C??10)},c.tickFormat=function(C,$){return $==null?w:l($)},c.nice=function(C){var $=h();return(!C||typeof C.range!="function")&&(C=t($[0],$[$.length-1],C??10)),C?h(w0e($,C)):c},c.copy=function(){return P$(c,rU(e,t,n,r,i,s,o,a,u,l))},c}function Mbt(){return sl.apply(rU(Nbt,Fbt,B$,qv,$N,Lm,vN,bN,Kl,VD).domain([new Date(2e3,0,1),new Date(2e3,0,2)]),arguments)}function Lbt(){return sl.apply(rU(Ibt,Dbt,z$,Xv,CN,$x,wN,xN,Kl,GD).domain([Date.UTC(2e3,0,1),Date.UTC(2e3,0,2)]),arguments)}function SN(){var e=0,t=1,n,r,i,s,o=Ss,a=!1,u;function l(f){return f==null||isNaN(f=+f)?u:o(i===0?.5:(f=(s(f)-n)*i,a?Math.max(0,Math.min(1,f)):f))}l.domain=function(f){return arguments.length?([e,t]=f,n=s(e=+e),r=s(t=+t),i=n===r?0:1/(r-n),l):[e,t]},l.clamp=function(f){return arguments.length?(a=!!f,l):a},l.interpolator=function(f){return arguments.length?(o=f,l):o};function c(f){return function(h){var d,p;return arguments.length?([d,p]=h,o=f(d,p),l):[o(0),o(1)]}}return l.range=c(Ig),l.rangeRound=c(mN),l.unknown=function(f){return arguments.length?(u=f,l):u},function(f){return s=f,n=f(e),r=f(t),i=n===r?0:1/(r-n),l}}function Uh(e,t){return t.domain(e.domain()).interpolator(e.interpolator()).clamp(e.clamp()).unknown(e.unknown())}function iU(){var e=Dg(SN()(Ss));return e.copy=function(){return Uh(e,iU())},zh.apply(e,arguments)}function T0e(){var e=J9(SN()).domain([1,10]);return e.copy=function(){return Uh(e,T0e()).base(e.base())},zh.apply(e,arguments)}function I0e(){var e=Q9(SN());return e.copy=function(){return Uh(e,I0e()).constant(e.constant())},zh.apply(e,arguments)}function sU(){var e=eU(SN());return e.copy=function(){return Uh(e,sU()).exponent(e.exponent())},zh.apply(e,arguments)}function Pbt(){return sU.apply(null,arguments).exponent(.5)}function kN(){var e=0,t=.5,n=1,r=1,i,s,o,a,u,l=Ss,c,f=!1,h;function d(g){return isNaN(g=+g)?h:(g=.5+((g=+c(g))-s)*(r*g<r*s?a:u),l(f?Math.max(0,Math.min(1,g)):g))}d.domain=function(g){return arguments.length?([e,t,n]=g,i=c(e=+e),s=c(t=+t),o=c(n=+n),a=i===s?0:.5/(s-i),u=s===o?0:.5/(o-s),r=s<i?-1:1,d):[e,t,n]},d.clamp=function(g){return arguments.length?(f=!!g,d):f},d.interpolator=function(g){return arguments.length?(l=g,d):l};function p(g){return function(m){var y,b,v;return arguments.length?([y,b,v]=m,l=Z9(g,[y,b,v]),d):[l(0),l(.5),l(1)]}}return d.range=p(Ig),d.rangeRound=p(mN),d.unknown=function(g){return arguments.length?(h=g,d):h},function(g){return c=g,i=g(e),s=g(t),o=g(n),a=i===s?0:.5/(s-i),u=s===o?0:.5/(o-s),r=s<i?-1:1,d}}function D0e(){var e=Dg(kN()(Ss));return e.copy=function(){return Uh(e,D0e())},zh.apply(e,arguments)}function N0e(){var e=J9(kN()).domain([.1,1,10]);return e.copy=function(){return Uh(e,N0e()).base(e.base())},zh.apply(e,arguments)}function F0e(){var e=Q9(kN());return e.copy=function(){return Uh(e,F0e()).constant(e.constant())},zh.apply(e,arguments)}function oU(){var e=eU(kN());return e.copy=function(){return Uh(e,oU()).exponent(e.exponent())},zh.apply(e,arguments)}function Bbt(){return oU.apply(null,arguments).exponent(.5)}const aU="year",uU="quarter",lU="month",cU="week",fU="date",hU="day",dU="dayofyear",pU="hours",gU="minutes",mU="seconds",yU="milliseconds",zbt=[aU,uU,lU,cU,fU,hU,dU,pU,gU,mU,yU];zbt.reduce((e,t,n)=>(e[t]=1+n,e),{});aU+"",uU+"",qv.every(3),lU+"",cU+"",fU+"",hU+"",dU+"",pU+"",gU+"",mU+"",yU+"";aU+"",uU+"",Xv.every(3),lU+"",cU+"",fU+"",hU+"",dU+"",pU+"",gU+"",mU+"",yU+"";function Ubt(e,t,n){const r=e-t+n*2;return e?r>0?r:1:0}const jbt="identity",bU="linear",F0="log",xU="pow",vU="sqrt",wU="symlog",Wbt="time",Vbt="utc",wy="sequential",U$="diverging",jK="quantile",Gbt="quantize",Hbt="threshold",qbt="ordinal",Xbt="point",Ybt="band",Kbt="bin-ordinal",jr="continuous",EN="discrete",_N="discretizing",Wa="interpolating",O0e="temporal";function Zbt(e){return function(t){let n=t[0],r=t[1],i;return r<n&&(i=n,n=r,r=i),[e.invert(n),e.invert(r)]}}function Jbt(e){return function(t){const n=e.range();let r=t[0],i=t[1],s=-1,o,a,u,l;for(i<r&&(a=r,r=i,i=a),u=0,l=n.length;u<l;++u)n[u]>=r&&n[u]<=i&&(s<0&&(s=u),o=u);if(!(s<0))return r=e.invertExtent(n[s]),i=e.invertExtent(n[o]),[r[0]===void 0?r[1]:r[0],i[1]===void 0?i[0]:i[1]]}}function $U(){const e=Y9().unknown(void 0),t=e.domain,n=e.range;let r=[0,1],i,s,o=!1,a=0,u=0,l=.5;delete e.unknown;function c(){const f=t().length,h=r[1]<r[0],d=r[1-h],p=Ubt(f,a,u);let g=r[h-0];i=(d-g)/(p||1),o&&(i=Math.floor(i)),g+=(d-g-i*(f-a))*l,s=i*(1-a),o&&(g=Math.round(g),s=Math.round(s));const m=Fyt(f).map(y=>g+i*y);return n(h?m.reverse():m)}return e.domain=function(f){return arguments.length?(t(f),c()):t()},e.range=function(f){return arguments.length?(r=[+f[0],+f[1]],c()):r.slice()},e.rangeRound=function(f){return r=[+f[0],+f[1]],o=!0,c()},e.bandwidth=function(){return s},e.step=function(){return i},e.round=function(f){return arguments.length?(o=!!f,c()):o},e.padding=function(f){return arguments.length?(u=Math.max(0,Math.min(1,f)),a=u,c()):a},e.paddingInner=function(f){return arguments.length?(a=Math.max(0,Math.min(1,f)),c()):a},e.paddingOuter=function(f){return arguments.length?(u=Math.max(0,Math.min(1,f)),c()):u},e.align=function(f){return arguments.length?(l=Math.max(0,Math.min(1,f)),c()):l},e.invertRange=function(f){if(f[0]==null||f[1]==null)return;const h=r[1]<r[0],d=h?n().reverse():n(),p=d.length-1;let g=+f[0],m=+f[1],y,b,v;if(!(g!==g||m!==m)&&(m<g&&(v=g,g=m,m=v),!(m<d[0]||g>r[1-h])))return y=Math.max(0,EL(d,g)-1),b=g===m?y:EL(d,m)-1,g-d[y]>s+1e-10&&++y,h&&(v=y,y=p-b,b=p-v),y>b?void 0:t().slice(y,b+1)},e.invert=function(f){const h=e.invertRange([f,f]);return h&&h[0]},e.copy=function(){return $U().domain(t()).range(r).round(o).paddingInner(a).paddingOuter(u).align(l)},c()}function R0e(e){const t=e.copy;return e.padding=e.paddingOuter,delete e.paddingInner,e.copy=function(){return R0e(t())},e}function Qbt(){return R0e($U().paddingInner(1))}var ext=Array.prototype.map;function txt(e){return ext.call(e,xyt)}const nxt=Array.prototype.slice;function M0e(){let e=[],t=[];function n(r){return r==null||r!==r?void 0:t[(L$(e,r)-1)%t.length]}return n.domain=function(r){return arguments.length?(e=txt(r),n):e.slice()},n.range=function(r){return arguments.length?(t=nxt.call(r),n):t.slice()},n.tickFormat=function(r,i){return b0e(e[0],byt(e),r??10,i)},n.copy=function(){return M0e().domain(n.domain()).range(n.range())},n}const RL=new Map,rxt=Symbol("vega_scale");function ixt(e){return e[rxt]=!0,e}function sxt(e,t,n){const r=function(){const s=t();return s.invertRange||(s.invertRange=s.invert?Zbt(s):s.invertExtent?Jbt(s):void 0),s.type=e,ixt(s)};return r.metadata=kyt(vyt(n)),r}function rn(e,t,n){return arguments.length>1?(RL.set(e,sxt(e,t,n)),this):oxt(e)?RL.get(e):void 0}rn(jbt,v0e);rn(bU,x0e,jr);rn(F0,$0e,[jr,F0]);rn(xU,tU,jr);rn(vU,ybt,jr);rn(wU,C0e,jr);rn(Wbt,Mbt,[jr,O0e]);rn(Vbt,Lbt,[jr,O0e]);rn(wy,iU,[jr,Wa]);rn(`${wy}-${bU}`,iU,[jr,Wa]);rn(`${wy}-${F0}`,T0e,[jr,Wa,F0]);rn(`${wy}-${xU}`,sU,[jr,Wa]);rn(`${wy}-${vU}`,Pbt,[jr,Wa]);rn(`${wy}-${wU}`,I0e,[jr,Wa]);rn(`${U$}-${bU}`,D0e,[jr,Wa]);rn(`${U$}-${F0}`,N0e,[jr,Wa,F0]);rn(`${U$}-${xU}`,oU,[jr,Wa]);rn(`${U$}-${vU}`,Bbt,[jr,Wa]);rn(`${U$}-${wU}`,F0e,[jr,Wa]);rn(jK,S0e,[_N,jK]);rn(Gbt,k0e,_N);rn(Hbt,E0e,_N);rn(Kbt,M0e,[EN,_N]);rn(qbt,Y9,EN);rn(Ybt,$U,EN);rn(Xbt,Qbt,EN);function oxt(e){return RL.has(e)}function axt(e,t,n){return Z9(uxt(t||"rgb",n),e)}function uxt(e,t){const n=sbt[lxt(e)];return t!=null&&n&&n.gamma?n.gamma(t):n}function lxt(e){return"interpolate"+e.toLowerCase().split("-").map(t=>t[0].toUpperCase()+t.slice(1)).join("")}const cxt={blues:"cfe1f2bed8eca8cee58fc1de74b2d75ba3cf4592c63181bd206fb2125ca40a4a90",greens:"d3eecdc0e6baabdda594d3917bc77d60ba6c46ab5e329a512089430e7735036429",greys:"e2e2e2d4d4d4c4c4c4b1b1b19d9d9d8888887575756262624d4d4d3535351e1e1e",oranges:"fdd8b3fdc998fdb87bfda55efc9244f87f2cf06b18e4580bd14904b93d029f3303",purples:"e2e1efd4d4e8c4c5e0b4b3d6a3a0cc928ec3827cb97566ae684ea25c3696501f8c",reds:"fdc9b4fcb49afc9e80fc8767fa7051f6573fec3f2fdc2a25c81b1db21218970b13",blueGreen:"d5efedc1e8e0a7ddd18bd2be70c6a958ba9144ad77319c5d2089460e7736036429",bluePurple:"ccddecbad0e4a8c2dd9ab0d4919cc98d85be8b6db28a55a6873c99822287730f71",greenBlue:"d3eecec5e8c3b1e1bb9bd8bb82cec269c2ca51b2cd3c9fc7288abd1675b10b60a1",orangeRed:"fddcaffdcf9bfdc18afdad77fb9562f67d53ee6545e24932d32d1ebf130da70403",purpleBlue:"dbdaebc8cee4b1c3de97b7d87bacd15b9fc93a90c01e7fb70b70ab056199045281",purpleBlueGreen:"dbd8eac8cee4b0c3de93b7d872acd1549fc83892bb1c88a3097f8702736b016353",purpleRed:"dcc9e2d3b3d7ce9eccd186c0da6bb2e14da0e23189d91e6fc61159ab07498f023a",redPurple:"fccfccfcbec0faa9b8f98faff571a5ec539ddb3695c41b8aa908808d0179700174",yellowGreen:"e4f4acd1eca0b9e2949ed68880c97c62bb6e47aa5e3297502083440e723b036034",yellowOrangeBrown:"feeaa1fedd84fecc63feb746fca031f68921eb7215db5e0bc54c05ab3d038f3204",yellowOrangeRed:"fee087fed16ffebd59fea849fd903efc7335f9522bee3423de1b20ca0b22af0225",blueOrange:"134b852f78b35da2cb9dcae1d2e5eff2f0ebfce0bafbbf74e8932fc5690d994a07",brownBlueGreen:"704108a0651ac79548e3c78af3e6c6eef1eac9e9e48ed1c74da79e187a72025147",purpleGreen:"5b1667834792a67fb6c9aed3e6d6e8eff0efd9efd5aedda971bb75368e490e5e29",purpleOrange:"4114696647968f83b7b9b4d6dadbebf3eeeafce0bafbbf74e8932fc5690d994a07",redBlue:"8c0d25bf363adf745ef4ae91fbdbc9f2efeed2e5ef9dcae15da2cb2f78b3134b85",redGrey:"8c0d25bf363adf745ef4ae91fcdccbfaf4f1e2e2e2c0c0c0969696646464343434",yellowGreenBlue:"eff9bddbf1b4bde5b594d5b969c5be45b4c22c9ec02182b82163aa23479c1c3185",redYellowBlue:"a50026d4322cf16e43fcac64fedd90faf8c1dcf1ecabd6e875abd04a74b4313695",redYellowGreen:"a50026d4322cf16e43fcac63fedd8df9f7aed7ee8ea4d86e64bc6122964f006837",pinkYellowGreen:"8e0152c0267edd72adf0b3d6faddedf5f3efe1f2cab6de8780bb474f9125276419",spectral:"9e0142d13c4bf0704afcac63fedd8dfbf8b0e0f3a1a9dda269bda94288b55e4fa2",viridis:"440154470e61481a6c482575472f7d443a834144873d4e8a39568c35608d31688e2d708e2a788e27818e23888e21918d1f988b1fa08822a8842ab07f35b77943bf7154c56866cc5d7ad1518fd744a5db36bcdf27d2e21be9e51afde725",magma:"0000040404130b0924150e3720114b2c11603b0f704a107957157e651a80721f817f24828c29819a2e80a8327db6377ac43c75d1426fde4968e95462f1605df76f5cfa7f5efc8f65fe9f6dfeaf78febf84fece91fddea0fcedaffcfdbf",inferno:"0000040403130c0826170c3b240c4f330a5f420a68500d6c5d126e6b176e781c6d86216b932667a12b62ae305cbb3755c73e4cd24644dd513ae65c30ed6925f3771af8850ffb9506fca50afcb519fac62df6d645f2e661f3f484fcffa4",plasma:"0d088723069033059742039d5002a25d01a66a00a87801a88405a7900da49c179ea72198b12a90ba3488c33d80cb4779d35171da5a69e16462e76e5bed7953f2834cf68f44fa9a3dfca636fdb32ffec029fcce25f9dc24f5ea27f0f921",cividis:"00205100235800265d002961012b65042e670831690d346b11366c16396d1c3c6e213f6e26426e2c456e31476e374a6e3c4d6e42506e47536d4c566d51586e555b6e5a5e6e5e616e62646f66676f6a6a706e6d717270717573727976737c79747f7c75827f758682768985778c8877908b78938e789691789a94789e9778a19b78a59e77a9a177aea575b2a874b6ab73bbaf71c0b26fc5b66dc9b96acebd68d3c065d8c462ddc85fe2cb5ce7cf58ebd355f0d652f3da4ff7de4cfae249fce647",rainbow:"6e40aa883eb1a43db3bf3cafd83fa4ee4395fe4b83ff576eff6659ff7847ff8c38f3a130e2b72fcfcc36bee044aff05b8ff4576ff65b52f6673af27828ea8d1ddfa319d0b81cbecb23abd82f96e03d82e14c6edb5a5dd0664dbf6e40aa",sinebow:"ff4040fc582af47218e78d0bd5a703bfbf00a7d5038de70b72f41858fc2a40ff402afc5818f4720be78d03d5a700bfbf03a7d50b8de71872f42a58fc4040ff582afc7218f48d0be7a703d5bf00bfd503a7e70b8df41872fc2a58ff4040",turbo:"23171b32204a3e2a71453493493eae4b49c54a53d7485ee44569ee4074f53c7ff8378af93295f72e9ff42ba9ef28b3e926bce125c5d925cdcf27d5c629dcbc2de3b232e9a738ee9d3ff39347f68950f9805afc7765fd6e70fe667cfd5e88fc5795fb51a1f84badf545b9f140c5ec3cd0e637dae034e4d931ecd12ef4c92bfac029ffb626ffad24ffa223ff9821ff8d1fff821dff771cfd6c1af76118f05616e84b14df4111d5380fcb2f0dc0260ab61f07ac1805a313029b0f00950c00910b00",browns:"eedbbdecca96e9b97ae4a865dc9856d18954c7784cc0673fb85536ad44339f3632",tealBlues:"bce4d89dd3d181c3cb65b3c245a2b9368fae347da0306a932c5985",teals:"bbdfdfa2d4d58ac9c975bcbb61b0af4da5a43799982b8b8c1e7f7f127273006667",warmGreys:"dcd4d0cec5c1c0b8b4b3aaa7a59c9998908c8b827f7e7673726866665c5a59504e",goldGreen:"f4d166d5ca60b6c35c98bb597cb25760a6564b9c533f8f4f33834a257740146c36",goldOrange:"f4d166f8be5cf8aa4cf5983bf3852aef701be2621fd65322c54923b142239e3a26",goldRed:"f4d166f6be59f9aa51fc964ef6834bee734ae56249db5247cf4244c43141b71d3e",lightGreyRed:"efe9e6e1dad7d5cbc8c8bdb9bbaea9cd967ddc7b43e15f19df4011dc000b",lightGreyTeal:"e4eaead6dcddc8ced2b7c2c7a6b4bc64b0bf22a6c32295c11f85be1876bc",lightMulti:"e0f1f2c4e9d0b0de9fd0e181f6e072f6c053f3993ef77440ef4a3c",lightOrange:"f2e7daf7d5baf9c499fab184fa9c73f68967ef7860e8645bde515bd43d5b",lightTealBlue:"e3e9e0c0dccf9aceca7abfc859afc0389fb9328dad2f7ca0276b95255988",darkBlue:"3232322d46681a5c930074af008cbf05a7ce25c0dd38daed50f3faffffff",darkGold:"3c3c3c584b37725e348c7631ae8b2bcfa424ecc31ef9de30fff184ffffff",darkGreen:"3a3a3a215748006f4d048942489e4276b340a6c63dd2d836ffeb2cffffaa",darkMulti:"3737371f5287197d8c29a86995ce3fffe800ffffff",darkRed:"3434347036339e3c38cc4037e75d1eec8620eeab29f0ce32ffeb2c"},fxt={category10:"1f77b4ff7f0e2ca02cd627289467bd8c564be377c27f7f7fbcbd2217becf",category20:"1f77b4aec7e8ff7f0effbb782ca02c98df8ad62728ff98969467bdc5b0d58c564bc49c94e377c2f7b6d27f7f7fc7c7c7bcbd22dbdb8d17becf9edae5",category20b:"393b795254a36b6ecf9c9ede6379398ca252b5cf6bcedb9c8c6d31bd9e39e7ba52e7cb94843c39ad494ad6616be7969c7b4173a55194ce6dbdde9ed6",category20c:"3182bd6baed69ecae1c6dbefe6550dfd8d3cfdae6bfdd0a231a35474c476a1d99bc7e9c0756bb19e9ac8bcbddcdadaeb636363969696bdbdbdd9d9d9",tableau10:"4c78a8f58518e4575672b7b254a24beeca3bb279a2ff9da69d755dbab0ac",tableau20:"4c78a89ecae9f58518ffbf7954a24b88d27ab79a20f2cf5b43989483bcb6e45756ff9d9879706ebab0acd67195fcbfd2b279a2d6a5c99e765fd8b5a5",accent:"7fc97fbeaed4fdc086ffff99386cb0f0027fbf5b17666666",dark2:"1b9e77d95f027570b3e7298a66a61ee6ab02a6761d666666",paired:"a6cee31f78b4b2df8a33a02cfb9a99e31a1cfdbf6fff7f00cab2d66a3d9affff99b15928",pastel1:"fbb4aeb3cde3ccebc5decbe4fed9a6ffffcce5d8bdfddaecf2f2f2",pastel2:"b3e2cdfdcdaccbd5e8f4cae4e6f5c9fff2aef1e2cccccccc",set1:"e41a1c377eb84daf4a984ea3ff7f00ffff33a65628f781bf999999",set2:"66c2a5fc8d628da0cbe78ac3a6d854ffd92fe5c494b3b3b3",set3:"8dd3c7ffffb3bebadafb807280b1d3fdb462b3de69fccde5d9d9d9bc80bdccebc5ffed6f"};function L0e(e){const t=e.length/6|0,n=new Array(t);for(let r=0;r<t;)n[r]="#"+e.slice(r*6,++r*6);return n}function P0e(e,t){for(const n in e)hxt(n,t(e[n]))}const WK={};P0e(fxt,L0e);P0e(cxt,e=>axt(L0e(e)));function hxt(e,t){return e=e&&e.toLowerCase(),arguments.length>1?(WK[e]=t,this):WK[e]}var dxt=Math.random,GO=Math.PI/180,ex=64,dk=2048;function pxt(){var e=[256,256],t,n,r,i,s,o,a,u=B0e,l=[],c=Math.random,f={};f.layout=function(){for(var p=h(Ec()),g=vxt((e[0]>>5)*e[1]),m=null,y=l.length,b=-1,v=[],x=l.map(C=>({text:t(C),font:n(C),style:i(C),weight:s(C),rotate:o(C),size:~~(r(C)+1e-14),padding:a(C),xoff:0,yoff:0,x1:0,y1:0,x0:0,y0:0,hasText:!1,sprite:null,datum:C})).sort((C,$)=>$.size-C.size);++b<y;){var w=x[b];w.x=e[0]*(c()+.5)>>1,w.y=e[1]*(c()+.5)>>1,gxt(p,w,x,b),w.hasText&&d(g,w,m)&&(v.push(w),m?yxt(m,w):m=[{x:w.x+w.x0,y:w.y+w.y0},{x:w.x+w.x1,y:w.y+w.y1}],w.x-=e[0]>>1,w.y-=e[1]>>1)}return v};function h(p){p.width=p.height=1;var g=Math.sqrt(p.getContext("2d").getImageData(0,0,1,1).data.length>>2);p.width=(ex<<5)/g,p.height=dk/g;var m=p.getContext("2d");return m.fillStyle=m.strokeStyle="red",m.textAlign="center",{context:m,ratio:g}}function d(p,g,m){for(var y=g.x,b=g.y,v=Math.sqrt(e[0]*e[0]+e[1]*e[1]),x=u(e),w=c()<.5?1:-1,C=-w,$,S,k;($=x(C+=w))&&(S=~~$[0],k=~~$[1],!(Math.min(Math.abs(S),Math.abs(k))>=v));)if(g.x=y+S,g.y=b+k,!(g.x+g.x0<0||g.y+g.y0<0||g.x+g.x1>e[0]||g.y+g.y1>e[1])&&(!m||!mxt(g,p,e[0]))&&(!m||bxt(g,m))){for(var E=g.sprite,_=g.width>>5,D=e[0]>>5,A=g.x-(_<<4),T=A&127,I=32-T,F=g.y1-g.y0,R=(g.y+g.y0)*D+(A>>5),L,P=0;P<F;P++){L=0;for(var q=0;q<=_;q++)p[R+q]|=L<<I|(q<_?(L=E[P*_+q])>>>T:0);R+=D}return g.sprite=null,!0}return!1}return f.words=function(p){return arguments.length?(l=p,f):l},f.size=function(p){return arguments.length?(e=[+p[0],+p[1]],f):e},f.font=function(p){return arguments.length?(n=sd(p),f):n},f.fontStyle=function(p){return arguments.length?(i=sd(p),f):i},f.fontWeight=function(p){return arguments.length?(s=sd(p),f):s},f.rotate=function(p){return arguments.length?(o=sd(p),f):o},f.text=function(p){return arguments.length?(t=sd(p),f):t},f.spiral=function(p){return arguments.length?(u=wxt[p]||p,f):u},f.fontSize=function(p){return arguments.length?(r=sd(p),f):r},f.padding=function(p){return arguments.length?(a=sd(p),f):a},f.random=function(p){return arguments.length?(c=p,f):c},f}function gxt(e,t,n,r){if(!t.sprite){var i=e.context,s=e.ratio;i.clearRect(0,0,(ex<<5)/s,dk/s);var o=0,a=0,u=0,l=n.length,c,f,h,d,p;for(--r;++r<l;){if(t=n[r],i.save(),i.font=t.style+" "+t.weight+" "+~~((t.size+1)/s)+"px "+t.font,c=i.measureText(t.text+"m").width*s,h=t.size<<1,t.rotate){var g=Math.sin(t.rotate*GO),m=Math.cos(t.rotate*GO),y=c*m,b=c*g,v=h*m,x=h*g;c=Math.max(Math.abs(y+x),Math.abs(y-x))+31>>5<<5,h=~~Math.max(Math.abs(b+v),Math.abs(b-v))}else c=c+31>>5<<5;if(h>u&&(u=h),o+c>=ex<<5&&(o=0,a+=u,u=0),a+h>=dk)break;i.translate((o+(c>>1))/s,(a+(h>>1))/s),t.rotate&&i.rotate(t.rotate*GO),i.fillText(t.text,0,0),t.padding&&(i.lineWidth=2*t.padding,i.strokeText(t.text,0,0)),i.restore(),t.width=c,t.height=h,t.xoff=o,t.yoff=a,t.x1=c>>1,t.y1=h>>1,t.x0=-t.x1,t.y0=-t.y1,t.hasText=!0,o+=c}for(var w=i.getImageData(0,0,(ex<<5)/s,dk/s).data,C=[];--r>=0;)if(t=n[r],!!t.hasText){for(c=t.width,f=c>>5,h=t.y1-t.y0,d=0;d<h*f;d++)C[d]=0;if(o=t.xoff,o==null)return;a=t.yoff;var $=0,S=-1;for(p=0;p<h;p++){for(d=0;d<c;d++){var k=f*p+(d>>5),E=w[(a+p)*(ex<<5)+(o+d)<<2]?1<<31-d%32:0;C[k]|=E,$|=E}$?S=p:(t.y0++,h--,p--,a++)}t.y1=t.y0+S,t.sprite=C.slice(0,(t.y1-t.y0)*f)}}}function mxt(e,t,n){n>>=5;for(var r=e.sprite,i=e.width>>5,s=e.x-(i<<4),o=s&127,a=32-o,u=e.y1-e.y0,l=(e.y+e.y0)*n+(s>>5),c,f=0;f<u;f++){c=0;for(var h=0;h<=i;h++)if((c<<a|(h<i?(c=r[f*i+h])>>>o:0))&t[l+h])return!0;l+=n}return!1}function yxt(e,t){var n=e[0],r=e[1];t.x+t.x0<n.x&&(n.x=t.x+t.x0),t.y+t.y0<n.y&&(n.y=t.y+t.y0),t.x+t.x1>r.x&&(r.x=t.x+t.x1),t.y+t.y1>r.y&&(r.y=t.y+t.y1)}function bxt(e,t){return e.x+e.x1>t[0].x&&e.x+e.x0<t[1].x&&e.y+e.y1>t[0].y&&e.y+e.y0<t[1].y}function B0e(e){var t=e[0]/e[1];return function(n){return[t*(n*=.1)*Math.cos(n),n*Math.sin(n)]}}function xxt(e){var t=4,n=t*e[0]/e[1],r=0,i=0;return function(s){var o=s<0?-1:1;switch(Math.sqrt(1+4*o*s)-o&3){case 0:r+=n;break;case 1:i+=t;break;case 2:r-=n;break;default:i-=t;break}return[r,i]}}function vxt(e){for(var t=[],n=-1;++n<e;)t[n]=0;return t}function sd(e){return typeof e=="function"?e:function(){return e}}var wxt={archimedean:B0e,rectangular:xxt};const z0e=["x","y","font","fontSize","fontStyle","fontWeight","angle"],$xt=["text","font","rotate","fontSize","fontStyle","fontWeight"];function CU(e){re.call(this,pxt(),e)}CU.Definition={type:"Wordcloud",metadata:{modifies:!0},params:[{name:"size",type:"number",array:!0,length:2},{name:"font",type:"string",expr:!0,default:"sans-serif"},{name:"fontStyle",type:"string",expr:!0,default:"normal"},{name:"fontWeight",type:"string",expr:!0,default:"normal"},{name:"fontSize",type:"number",expr:!0,default:14},{name:"fontSizeRange",type:"number",array:"nullable",default:[10,50]},{name:"rotate",type:"number",expr:!0,default:0},{name:"text",type:"field"},{name:"spiral",type:"string",values:["archimedean","rectangular"]},{name:"padding",type:"number",expr:!0},{name:"as",type:"string",array:!0,length:7,default:z0e}]};Syt(CU,re,{transform(e,t){e.size&&!(e.size[0]&&e.size[1])&&hk("Wordcloud size dimensions must be non-zero.");function n(p){const g=e[p];return kL(g)&&t.modified(g.fields)}const r=e.modified();if(!(r||t.changed(t.ADD_REM)||$xt.some(n)))return;const i=t.materialize(t.SOURCE).source,s=this.value,o=e.as||z0e;let a=e.fontSize||14,u;if(kL(a)?u=e.fontSizeRange:a=wyt(a),u){const p=a,g=rn("sqrt")().domain(Cyt(i,p)).range(u);a=m=>g(p(m))}i.forEach(p=>{p[o[0]]=NaN,p[o[1]]=NaN,p[o[3]]=0});const l=s.words(i).text(e.text).size(e.size||[500,500]).padding(e.padding||1).spiral(e.spiral||"archimedean").rotate(e.rotate||0).font(e.font||"sans-serif").fontStyle(e.fontStyle||"normal").fontWeight(e.fontWeight||"normal").fontSize(a).random(dxt).layout(),c=s.size(),f=c[0]>>1,h=c[1]>>1,d=l.length;for(let p=0,g,m;p<d;++p)g=l[p],m=g.datum,m[o[0]]=g.x+f,m[o[1]]=g.y+h,m[o[2]]=g.font,m[o[3]]=g.size,m[o[4]]=g.style,m[o[5]]=g.weight,m[o[6]]=g.rotate;return t.reflow(r).modifies(o)}});const Cxt=Object.freeze(Object.defineProperty({__proto__:null,wordcloud:CU},Symbol.toStringTag,{value:"Module"})),Sxt=e=>new Uint8Array(e),kxt=e=>new Uint16Array(e),Cx=e=>new Uint32Array(e);function Ext(){let e=8,t=[],n=Cx(0),r=wS(0,e),i=wS(0,e);return{data:()=>t,seen:()=>n=_xt(n,t.length),add(s){for(let o=0,a=t.length,u=s.length,l;o<u;++o)l=s[o],l._index=a++,t.push(l)},remove(s,o){const a=t.length,u=Array(a-s),l=t;let c,f,h;for(f=0;!o[f]&&f<a;++f)u[f]=t[f],l[f]=f;for(h=f;f<a;++f)c=t[f],o[f]?l[f]=-1:(l[f]=h,r[h]=r[f],i[h]=i[f],u[h]=c,c._index=h++),r[f]=0;return t=u,l},size:()=>t.length,curr:()=>r,prev:()=>i,reset:s=>i[s]=r[s],all:()=>e<257?255:e<65537?65535:4294967295,set(s,o){r[s]|=o},clear(s,o){r[s]&=~o},resize(s,o){const a=r.length;(s>a||o>e)&&(e=Math.max(o,e),r=wS(s,e,r),i=wS(s,e))}}}function _xt(e,t,n){return e.length>=t?e:(n=n||new e.constructor(t),n.set(e),n)}function wS(e,t,n){const r=(t<257?Sxt:t<65537?kxt:Cx)(e);return n&&r.set(n),r}function VK(e,t,n){const r=1<<t;return{one:r,zero:~r,range:n.slice(),bisect:e.bisect,index:e.index,size:e.size,onAdd(i,s){const o=this,a=o.bisect(o.range,i.value),u=i.index,l=a[0],c=a[1],f=u.length;let h;for(h=0;h<l;++h)s[u[h]]|=r;for(h=c;h<f;++h)s[u[h]]|=r;return o}}}function GK(){let e=Cx(0),t=[],n=0;function r(a,u,l){if(!u.length)return[];const c=n,f=u.length,h=Cx(f);let d=Array(f),p,g,m;for(m=0;m<f;++m)d[m]=a(u[m]),h[m]=m;if(d=Axt(d,h),c)p=t,g=e,t=Array(c+f),e=Cx(c+f),Txt(l,p,g,c,d,h,f,t,e);else{if(l>0)for(m=0;m<f;++m)h[m]+=l;t=d,e=h}return n=c+f,{index:h,value:d}}function i(a,u){const l=n;let c,f,h;for(f=0;!u[e[f]]&&f<l;++f);for(h=f;f<l;++f)u[c=e[f]]||(e[h]=c,t[h]=t[f],++h);n=l-a}function s(a){for(let u=0,l=n;u<l;++u)e[u]=a[e[u]]}function o(a,u){let l;return u?l=u.length:(u=t,l=n),[DJe(u,a[0],0,l),gE(u,a[1],0,l)]}return{insert:r,remove:i,bisect:o,reindex:s,index:()=>e,size:()=>n}}function Axt(e,t){return e.sort.call(t,(n,r)=>{const i=e[n],s=e[r];return i<s?-1:i>s?1:0}),OJe(e,t)}function Txt(e,t,n,r,i,s,o,a,u){let l=0,c=0,f;for(f=0;l<r&&c<o;++f)t[l]<i[c]?(a[f]=t[l],u[f]=n[l++]):(a[f]=i[c],u[f]=s[c++]+e);for(;l<r;++l,++f)a[f]=t[l],u[f]=n[l];for(;c<o;++c,++f)a[f]=i[c],u[f]=s[c]+e}function SU(e){re.call(this,Ext(),e),this._indices=null,this._dims=null}SU.Definition={type:"CrossFilter",metadata:{},params:[{name:"fields",type:"field",array:!0,required:!0},{name:"query",type:"array",array:!0,required:!0,content:{type:"number",array:!0,length:2}}]};$e(SU,re,{transform(e,t){if(this._dims){var n=e.modified("fields")||e.fields.some(r=>t.modified(r.fields));return n?this.reinit(e,t):this.eval(e,t)}else return this.init(e,t)},init(e,t){const n=e.fields,r=e.query,i=this._indices={},s=this._dims=[],o=r.length;let a=0,u,l;for(;a<o;++a)u=n[a].fname,l=i[u]||(i[u]=GK()),s.push(VK(l,a,r[a]));return this.eval(e,t)},reinit(e,t){const n=t.materialize().fork(),r=e.fields,i=e.query,s=this._indices,o=this._dims,a=this.value,u=a.curr(),l=a.prev(),c=a.all(),f=n.rem=n.add,h=n.mod,d=i.length,p={};let g,m,y,b,v,x,w,C,$;if(l.set(u),t.rem.length&&(v=this.remove(e,t,n)),t.add.length&&a.add(t.add),t.mod.length)for(x={},b=t.mod,w=0,C=b.length;w<C;++w)x[b[w]._index]=1;for(w=0;w<d;++w)$=r[w],(!o[w]||e.modified("fields",w)||t.modified($.fields))&&(y=$.fname,(g=p[y])||(s[y]=m=GK(),p[y]=g=m.insert($,t.source,0)),o[w]=VK(m,w,i[w]).onAdd(g,u));for(w=0,C=a.data().length;w<C;++w)v[w]||(l[w]!==u[w]?f.push(w):x[w]&&u[w]!==c&&h.push(w));return a.mask=(1<<d)-1,n},eval(e,t){const n=t.materialize().fork(),r=this._dims.length;let i=0;return t.rem.length&&(this.remove(e,t,n),i|=(1<<r)-1),e.modified("query")&&!e.modified("fields")&&(i|=this.update(e,t,n)),t.add.length&&(this.insert(e,t,n),i|=(1<<r)-1),t.mod.length&&(this.modify(t,n),i|=(1<<r)-1),this.value.mask=i,n},insert(e,t,n){const r=t.add,i=this.value,s=this._dims,o=this._indices,a=e.fields,u={},l=n.add,c=i.size()+r.length,f=s.length;let h=i.size(),d,p,g;i.resize(c,f),i.add(r);const m=i.curr(),y=i.prev(),b=i.all();for(d=0;d<f;++d)p=a[d].fname,g=u[p]||(u[p]=o[p].insert(a[d],r,h)),s[d].onAdd(g,m);for(;h<c;++h)y[h]=b,m[h]!==b&&l.push(h)},modify(e,t){const n=t.mod,r=this.value,i=r.curr(),s=r.all(),o=e.mod;let a,u,l;for(a=0,u=o.length;a<u;++a)l=o[a]._index,i[l]!==s&&n.push(l)},remove(e,t,n){const r=this._indices,i=this.value,s=i.curr(),o=i.prev(),a=i.all(),u={},l=n.rem,c=t.rem;let f,h,d,p;for(f=0,h=c.length;f<h;++f)d=c[f]._index,u[d]=1,o[d]=p=s[d],s[d]=a,p!==a&&l.push(d);for(d in r)r[d].remove(h,u);return this.reindex(t,h,u),u},reindex(e,t,n){const r=this._indices,i=this.value;e.runAfter(()=>{const s=i.remove(t,n);for(const o in r)r[o].reindex(s)})},update(e,t,n){const r=this._dims,i=e.query,s=t.stamp,o=r.length;let a=0,u,l;for(n.filters=0,l=0;l<o;++l)e.modified("query",l)&&(u=l,++a);if(a===1)a=r[u].one,this.incrementOne(r[u],i[u],n.add,n.rem);else for(l=0,a=0;l<o;++l)e.modified("query",l)&&(a|=r[l].one,this.incrementAll(r[l],i[l],s,n.add),n.rem=n.add);return a},incrementAll(e,t,n,r){const i=this.value,s=i.seen(),o=i.curr(),a=i.prev(),u=e.index(),l=e.bisect(e.range),c=e.bisect(t),f=c[0],h=c[1],d=l[0],p=l[1],g=e.one;let m,y,b;if(f<d)for(m=f,y=Math.min(d,h);m<y;++m)b=u[m],s[b]!==n&&(a[b]=o[b],s[b]=n,r.push(b)),o[b]^=g;else if(f>d)for(m=d,y=Math.min(f,p);m<y;++m)b=u[m],s[b]!==n&&(a[b]=o[b],s[b]=n,r.push(b)),o[b]^=g;if(h>p)for(m=Math.max(f,p),y=h;m<y;++m)b=u[m],s[b]!==n&&(a[b]=o[b],s[b]=n,r.push(b)),o[b]^=g;else if(h<p)for(m=Math.max(d,h),y=p;m<y;++m)b=u[m],s[b]!==n&&(a[b]=o[b],s[b]=n,r.push(b)),o[b]^=g;e.range=t.slice()},incrementOne(e,t,n,r){const i=this.value,s=i.curr(),o=e.index(),a=e.bisect(e.range),u=e.bisect(t),l=u[0],c=u[1],f=a[0],h=a[1],d=e.one;let p,g,m;if(l<f)for(p=l,g=Math.min(f,c);p<g;++p)m=o[p],s[m]^=d,n.push(m);else if(l>f)for(p=f,g=Math.min(l,h);p<g;++p)m=o[p],s[m]^=d,r.push(m);if(c>h)for(p=Math.max(l,h),g=c;p<g;++p)m=o[p],s[m]^=d,n.push(m);else if(c<h)for(p=Math.max(f,c),g=h;p<g;++p)m=o[p],s[m]^=d,r.push(m);e.range=t.slice()}});function kU(e){re.call(this,null,e)}kU.Definition={type:"ResolveFilter",metadata:{},params:[{name:"ignore",type:"number",required:!0,description:"A bit mask indicating which filters to ignore."},{name:"filter",type:"object",required:!0,description:"Per-tuple filter bitmaps from a CrossFilter transform."}]};$e(kU,re,{transform(e,t){const n=~(e.ignore||0),r=e.filter,i=r.mask;if(!(i&n))return t.StopPropagation;const s=t.fork(t.ALL),o=r.data(),a=r.curr(),u=r.prev(),l=c=>a[c]&n?null:o[c];return s.filter(s.MOD,l),i&i-1?(s.filter(s.ADD,c=>{const f=a[c]&n;return!f&&f^u[c]&n?o[c]:null}),s.filter(s.REM,c=>{const f=a[c]&n;return f&&!(f^(f^u[c]&n))?o[c]:null})):(s.filter(s.ADD,l),s.filter(s.REM,c=>(a[c]&n)===i?o[c]:null)),s.filter(s.SOURCE,c=>l(c._index))}});const Ixt=Object.freeze(Object.defineProperty({__proto__:null,crossfilter:SU,resolvefilter:kU},Symbol.toStringTag,{value:"Module"}));function $y(e,t,n){return e.fields=t||[],e.fname=n,e}function Dxt(e){return e.length===1?Nxt(e[0]):Fxt(e)}const Nxt=e=>function(t){return t[e]},Fxt=e=>{const t=e.length;return function(n){for(let r=0;r<t;++r)n=n[e[r]];return n}};function yi(e){throw Error(e)}function Oxt(e){const t=[],n=e.length;let r=null,i=0,s="",o,a,u;e=e+"";function l(){t.push(s+e.substring(o,a)),s="",o=a+1}for(o=a=0;a<n;++a)if(u=e[a],u==="\\")s+=e.substring(o,a++),o=a;else if(u===r)l(),r=null,i=-1;else{if(r)continue;o===i&&u==='"'||o===i&&u==="'"?(o=a+1,r=u):u==="."&&!i?a>o?l():o=a+1:u==="["?(a>o&&l(),i=o=a+1):u==="]"&&(i||yi("Access path missing open bracket: "+e),i>0&&l(),i=0,o=a+1)}return i&&yi("Access path missing closing bracket: "+e),r&&yi("Access path missing closing quote: "+e),a>o&&(a++,l()),t}function U0e(e,t,n){const r=Oxt(e);return e=r.length===1?r[0]:e,$y((n&&n.get||Dxt)(r),[e],t||e)}U0e("id");const EU=$y(e=>e,[],"identity");$y(()=>0,[],"zero");$y(()=>1,[],"one");const j0e=$y(()=>!0,[],"true");$y(()=>!1,[],"false");var mc=Array.isArray;function z_(e){return e===Object(e)}function ph(e){return e[e.length-1]}function _U(e){return e==null||e===""?null:+e}const W0e=e=>t=>e*Math.exp(t),V0e=e=>t=>Math.log(e*t),G0e=e=>t=>Math.sign(t)*Math.log1p(Math.abs(t/e)),H0e=e=>t=>Math.sign(t)*Math.expm1(Math.abs(t))*e,U_=e=>t=>t<0?-Math.pow(-t,e):Math.pow(t,e);function AN(e,t,n,r){const i=n(e[0]),s=n(ph(e)),o=(s-i)*t;return[r(i-o),r(s-o)]}function Rxt(e,t){return AN(e,t,_U,EU)}function Mxt(e,t){var n=Math.sign(e[0]);return AN(e,t,V0e(n),W0e(n))}function Lxt(e,t,n){return AN(e,t,U_(n),U_(1/n))}function Pxt(e,t,n){return AN(e,t,G0e(n),H0e(n))}function TN(e,t,n,r,i){const s=r(e[0]),o=r(ph(e)),a=t!=null?r(t):(s+o)/2;return[i(a+(s-a)*n),i(a+(o-a)*n)]}function Bxt(e,t,n){return TN(e,t,n,_U,EU)}function zxt(e,t,n){const r=Math.sign(e[0]);return TN(e,t,n,V0e(r),W0e(r))}function Uxt(e,t,n,r){return TN(e,t,n,U_(r),U_(1/r))}function jxt(e,t,n,r){return TN(e,t,n,G0e(r),H0e(r))}function Wxt(e){return 1+~~(new Date(e).getMonth()/3)}function Vxt(e){return 1+~~(new Date(e).getUTCMonth()/3)}function HK(e){return e!=null?mc(e)?e:[e]:[]}function Gxt(e,t,n){let r=e[0],i=e[1],s;return i<r&&(s=i,i=r,r=s),s=i-r,s>=n-t?[t,n]:[r=Math.min(Math.max(r,t),n-s),r+s]}function j_(e){return typeof e=="function"}function AU(e){for(let t,n,r=1,i=arguments.length;r<i;++r){t=arguments[r];for(n in t)e[n]=t[n]}return e}function Hxt(e,t){let n=0,r,i,s,o;if(e&&(r=e.length))if(t==null){for(i=e[n];n<r&&(i==null||i!==i);i=e[++n]);for(s=o=i;n<r;++n)i=e[n],i!=null&&(i<s&&(s=i),i>o&&(o=i))}else{for(i=t(e[n]);n<r&&(i==null||i!==i);i=t(e[++n]));for(s=o=i;n<r;++n)i=t(e[n]),i!=null&&(i<s&&(s=i),i>o&&(o=i))}return[s,o]}const qxt=Object.prototype.hasOwnProperty;function yf(e,t){return qxt.call(e,t)}function Xxt(e,t,n,r,i,s){if(!n&&n!==0)return s;const o=+n;let a=e[0],u=ph(e),l;u<a&&(l=a,a=u,u=l),l=Math.abs(t-a);const c=Math.abs(u-t);return l<c&&l<=o?r:c<=o?i:s}function Yxt(e,t,n,r){let i=t[0],s=t[t.length-1],o;return i>s&&(o=i,i=s,s=o),n=n===void 0||n,r=r===void 0||r,(n?i<=e:i<e)&&(r?e<=s:e<s)}function Kxt(e){return typeof e=="boolean"}function q0e(e){return Object.prototype.toString.call(e)==="[object Date]"}function X0e(e){return typeof e=="number"}function Zxt(e){return Object.prototype.toString.call(e)==="[object RegExp]"}function Cy(e){return typeof e=="string"}function Jxt(e,t){const n=e[0],r=ph(e),i=+t;return i?i===1?r:n+i*(r-n):n}function $S(e,t){let n="";for(;--t>=0;)n+=e;return n}function Qxt(e,t,n,r){const i=n||" ",s=e+"",o=t-s.length;return o<=0?s:r==="left"?$S(i,o)+s:r==="center"?$S(i,~~(o/2))+s+$S(i,Math.ceil(o/2)):s+$S(i,o)}function evt(e){return e&&ph(e)-e[0]||0}function Yv(e){return mc(e)?"["+e.map(Yv)+"]":z_(e)||Cy(e)?JSON.stringify(e).replace("\u2028","\\u2028").replace("\u2029","\\u2029"):e}function tvt(e){return e==null||e===""?null:!e||e==="false"||e==="0"?!1:!!e}const nvt=e=>X0e(e)||q0e(e)?e:Date.parse(e);function rvt(e,t){return t=t||nvt,e==null||e===""?null:t(e)}function ivt(e){return e==null||e===""?null:e+""}function qK(e){const t={},n=e.length;for(let r=0;r<n;++r)t[e[r]]=!0;return t}function svt(e,t,n,r){const i=r??"",s=e+"",o=s.length,a=Math.max(0,t-i.length);return o<=t?s:n==="left"?i+s.slice(o-a):n==="center"?s.slice(0,Math.ceil(a/2))+i+s.slice(o-~~(a/2)):s.slice(0,a)+i}const ovt="RawCode",O0="Literal",avt="Property",uvt="Identifier",lvt="ArrayExpression",cvt="BinaryExpression",Y0e="CallExpression",fvt="ConditionalExpression",hvt="LogicalExpression",dvt="MemberExpression",pvt="ObjectExpression",gvt="UnaryExpression";function Va(e){this.type=e}Va.prototype.visit=function(e){let t,n,r;if(e(this))return 1;for(t=mvt(this),n=0,r=t.length;n<r;++n)if(t[n].visit(e))return 1};function mvt(e){switch(e.type){case lvt:return e.elements;case cvt:case hvt:return[e.left,e.right];case Y0e:return[e.callee].concat(e.arguments);case fvt:return[e.test,e.consequent,e.alternate];case dvt:return[e.object,e.property];case pvt:return e.properties;case avt:return[e.key,e.value];case gvt:return[e.argument];case uvt:case O0:case ovt:default:return[]}}var ol,Ie,ie,Si,jt,IN=1,j$=2,Bp=3,jh=4,DN=5,Og=6,hs=7,W$=8,yvt=9;ol={};ol[IN]="Boolean";ol[j$]="<end>";ol[Bp]="Identifier";ol[jh]="Keyword";ol[DN]="Null";ol[Og]="Numeric";ol[hs]="Punctuator";ol[W$]="String";ol[yvt]="RegularExpression";var bvt="ArrayExpression",xvt="BinaryExpression",vvt="CallExpression",wvt="ConditionalExpression",K0e="Identifier",$vt="Literal",Cvt="LogicalExpression",Svt="MemberExpression",kvt="ObjectExpression",Evt="Property",_vt="UnaryExpression",Er="Unexpected token %0",Avt="Unexpected number",Tvt="Unexpected string",Ivt="Unexpected identifier",Dvt="Unexpected reserved word",Nvt="Unexpected end of input",ML="Invalid regular expression",HO="Invalid regular expression: missing /",Z0e="Octal literals are not allowed in strict mode.",Fvt="Duplicate data property in object literal not allowed in strict mode",Gr="ILLEGAL",Kv="Disabled.",Ovt=new RegExp("[\\xAA\\xB5\\xBA\\xC0-\\xD6\\xD8-\\xF6\\xF8-\\u02C1\\u02C6-\\u02D1\\u02E0-\\u02E4\\u02EC\\u02EE\\u0370-\\u0374\\u0376\\u0377\\u037A-\\u037D\\u037F\\u0386\\u0388-\\u038A\\u038C\\u038E-\\u03A1\\u03A3-\\u03F5\\u03F7-\\u0481\\u048A-\\u052F\\u0531-\\u0556\\u0559\\u0561-\\u0587\\u05D0-\\u05EA\\u05F0-\\u05F2\\u0620-\\u064A\\u066E\\u066F\\u0671-\\u06D3\\u06D5\\u06E5\\u06E6\\u06EE\\u06EF\\u06FA-\\u06FC\\u06FF\\u0710\\u0712-\\u072F\\u074D-\\u07A5\\u07B1\\u07CA-\\u07EA\\u07F4\\u07F5\\u07FA\\u0800-\\u0815\\u081A\\u0824\\u0828\\u0840-\\u0858\\u08A0-\\u08B2\\u0904-\\u0939\\u093D\\u0950\\u0958-\\u0961\\u0971-\\u0980\\u0985-\\u098C\\u098F\\u0990\\u0993-\\u09A8\\u09AA-\\u09B0\\u09B2\\u09B6-\\u09B9\\u09BD\\u09CE\\u09DC\\u09DD\\u09DF-\\u09E1\\u09F0\\u09F1\\u0A05-\\u0A0A\\u0A0F\\u0A10\\u0A13-\\u0A28\\u0A2A-\\u0A30\\u0A32\\u0A33\\u0A35\\u0A36\\u0A38\\u0A39\\u0A59-\\u0A5C\\u0A5E\\u0A72-\\u0A74\\u0A85-\\u0A8D\\u0A8F-\\u0A91\\u0A93-\\u0AA8\\u0AAA-\\u0AB0\\u0AB2\\u0AB3\\u0AB5-\\u0AB9\\u0ABD\\u0AD0\\u0AE0\\u0AE1\\u0B05-\\u0B0C\\u0B0F\\u0B10\\u0B13-\\u0B28\\u0B2A-\\u0B30\\u0B32\\u0B33\\u0B35-\\u0B39\\u0B3D\\u0B5C\\u0B5D\\u0B5F-\\u0B61\\u0B71\\u0B83\\u0B85-\\u0B8A\\u0B8E-\\u0B90\\u0B92-\\u0B95\\u0B99\\u0B9A\\u0B9C\\u0B9E\\u0B9F\\u0BA3\\u0BA4\\u0BA8-\\u0BAA\\u0BAE-\\u0BB9\\u0BD0\\u0C05-\\u0C0C\\u0C0E-\\u0C10\\u0C12-\\u0C28\\u0C2A-\\u0C39\\u0C3D\\u0C58\\u0C59\\u0C60\\u0C61\\u0C85-\\u0C8C\\u0C8E-\\u0C90\\u0C92-\\u0CA8\\u0CAA-\\u0CB3\\u0CB5-\\u0CB9\\u0CBD\\u0CDE\\u0CE0\\u0CE1\\u0CF1\\u0CF2\\u0D05-\\u0D0C\\u0D0E-\\u0D10\\u0D12-\\u0D3A\\u0D3D\\u0D4E\\u0D60\\u0D61\\u0D7A-\\u0D7F\\u0D85-\\u0D96\\u0D9A-\\u0DB1\\u0DB3-\\u0DBB\\u0DBD\\u0DC0-\\u0DC6\\u0E01-\\u0E30\\u0E32\\u0E33\\u0E40-\\u0E46\\u0E81\\u0E82\\u0E84\\u0E87\\u0E88\\u0E8A\\u0E8D\\u0E94-\\u0E97\\u0E99-\\u0E9F\\u0EA1-\\u0EA3\\u0EA5\\u0EA7\\u0EAA\\u0EAB\\u0EAD-\\u0EB0\\u0EB2\\u0EB3\\u0EBD\\u0EC0-\\u0EC4\\u0EC6\\u0EDC-\\u0EDF\\u0F00\\u0F40-\\u0F47\\u0F49-\\u0F6C\\u0F88-\\u0F8C\\u1000-\\u102A\\u103F\\u1050-\\u1055\\u105A-\\u105D\\u1061\\u1065\\u1066\\u106E-\\u1070\\u1075-\\u1081\\u108E\\u10A0-\\u10C5\\u10C7\\u10CD\\u10D0-\\u10FA\\u10FC-\\u1248\\u124A-\\u124D\\u1250-\\u1256\\u1258\\u125A-\\u125D\\u1260-\\u1288\\u128A-\\u128D\\u1290-\\u12B0\\u12B2-\\u12B5\\u12B8-\\u12BE\\u12C0\\u12C2-\\u12C5\\u12C8-\\u12D6\\u12D8-\\u1310\\u1312-\\u1315\\u1318-\\u135A\\u1380-\\u138F\\u13A0-\\u13F4\\u1401-\\u166C\\u166F-\\u167F\\u1681-\\u169A\\u16A0-\\u16EA\\u16EE-\\u16F8\\u1700-\\u170C\\u170E-\\u1711\\u1720-\\u1731\\u1740-\\u1751\\u1760-\\u176C\\u176E-\\u1770\\u1780-\\u17B3\\u17D7\\u17DC\\u1820-\\u1877\\u1880-\\u18A8\\u18AA\\u18B0-\\u18F5\\u1900-\\u191E\\u1950-\\u196D\\u1970-\\u1974\\u1980-\\u19AB\\u19C1-\\u19C7\\u1A00-\\u1A16\\u1A20-\\u1A54\\u1AA7\\u1B05-\\u1B33\\u1B45-\\u1B4B\\u1B83-\\u1BA0\\u1BAE\\u1BAF\\u1BBA-\\u1BE5\\u1C00-\\u1C23\\u1C4D-\\u1C4F\\u1C5A-\\u1C7D\\u1CE9-\\u1CEC\\u1CEE-\\u1CF1\\u1CF5\\u1CF6\\u1D00-\\u1DBF\\u1E00-\\u1F15\\u1F18-\\u1F1D\\u1F20-\\u1F45\\u1F48-\\u1F4D\\u1F50-\\u1F57\\u1F59\\u1F5B\\u1F5D\\u1F5F-\\u1F7D\\u1F80-\\u1FB4\\u1FB6-\\u1FBC\\u1FBE\\u1FC2-\\u1FC4\\u1FC6-\\u1FCC\\u1FD0-\\u1FD3\\u1FD6-\\u1FDB\\u1FE0-\\u1FEC\\u1FF2-\\u1FF4\\u1FF6-\\u1FFC\\u2071\\u207F\\u2090-\\u209C\\u2102\\u2107\\u210A-\\u2113\\u2115\\u2119-\\u211D\\u2124\\u2126\\u2128\\u212A-\\u212D\\u212F-\\u2139\\u213C-\\u213F\\u2145-\\u2149\\u214E\\u2160-\\u2188\\u2C00-\\u2C2E\\u2C30-\\u2C5E\\u2C60-\\u2CE4\\u2CEB-\\u2CEE\\u2CF2\\u2CF3\\u2D00-\\u2D25\\u2D27\\u2D2D\\u2D30-\\u2D67\\u2D6F\\u2D80-\\u2D96\\u2DA0-\\u2DA6\\u2DA8-\\u2DAE\\u2DB0-\\u2DB6\\u2DB8-\\u2DBE\\u2DC0-\\u2DC6\\u2DC8-\\u2DCE\\u2DD0-\\u2DD6\\u2DD8-\\u2DDE\\u2E2F\\u3005-\\u3007\\u3021-\\u3029\\u3031-\\u3035\\u3038-\\u303C\\u3041-\\u3096\\u309D-\\u309F\\u30A1-\\u30FA\\u30FC-\\u30FF\\u3105-\\u312D\\u3131-\\u318E\\u31A0-\\u31BA\\u31F0-\\u31FF\\u3400-\\u4DB5\\u4E00-\\u9FCC\\uA000-\\uA48C\\uA4D0-\\uA4FD\\uA500-\\uA60C\\uA610-\\uA61F\\uA62A\\uA62B\\uA640-\\uA66E\\uA67F-\\uA69D\\uA6A0-\\uA6EF\\uA717-\\uA71F\\uA722-\\uA788\\uA78B-\\uA78E\\uA790-\\uA7AD\\uA7B0\\uA7B1\\uA7F7-\\uA801\\uA803-\\uA805\\uA807-\\uA80A\\uA80C-\\uA822\\uA840-\\uA873\\uA882-\\uA8B3\\uA8F2-\\uA8F7\\uA8FB\\uA90A-\\uA925\\uA930-\\uA946\\uA960-\\uA97C\\uA984-\\uA9B2\\uA9CF\\uA9E0-\\uA9E4\\uA9E6-\\uA9EF\\uA9FA-\\uA9FE\\uAA00-\\uAA28\\uAA40-\\uAA42\\uAA44-\\uAA4B\\uAA60-\\uAA76\\uAA7A\\uAA7E-\\uAAAF\\uAAB1\\uAAB5\\uAAB6\\uAAB9-\\uAABD\\uAAC0\\uAAC2\\uAADB-\\uAADD\\uAAE0-\\uAAEA\\uAAF2-\\uAAF4\\uAB01-\\uAB06\\uAB09-\\uAB0E\\uAB11-\\uAB16\\uAB20-\\uAB26\\uAB28-\\uAB2E\\uAB30-\\uAB5A\\uAB5C-\\uAB5F\\uAB64\\uAB65\\uABC0-\\uABE2\\uAC00-\\uD7A3\\uD7B0-\\uD7C6\\uD7CB-\\uD7FB\\uF900-\\uFA6D\\uFA70-\\uFAD9\\uFB00-\\uFB06\\uFB13-\\uFB17\\uFB1D\\uFB1F-\\uFB28\\uFB2A-\\uFB36\\uFB38-\\uFB3C\\uFB3E\\uFB40\\uFB41\\uFB43\\uFB44\\uFB46-\\uFBB1\\uFBD3-\\uFD3D\\uFD50-\\uFD8F\\uFD92-\\uFDC7\\uFDF0-\\uFDFB\\uFE70-\\uFE74\\uFE76-\\uFEFC\\uFF21-\\uFF3A\\uFF41-\\uFF5A\\uFF66-\\uFFBE\\uFFC2-\\uFFC7\\uFFCA-\\uFFCF\\uFFD2-\\uFFD7\\uFFDA-\\uFFDC]"),Rvt=new RegExp("[\\xAA\\xB5\\xBA\\xC0-\\xD6\\xD8-\\xF6\\xF8-\\u02C1\\u02C6-\\u02D1\\u02E0-\\u02E4\\u02EC\\u02EE\\u0300-\\u0374\\u0376\\u0377\\u037A-\\u037D\\u037F\\u0386\\u0388-\\u038A\\u038C\\u038E-\\u03A1\\u03A3-\\u03F5\\u03F7-\\u0481\\u0483-\\u0487\\u048A-\\u052F\\u0531-\\u0556\\u0559\\u0561-\\u0587\\u0591-\\u05BD\\u05BF\\u05C1\\u05C2\\u05C4\\u05C5\\u05C7\\u05D0-\\u05EA\\u05F0-\\u05F2\\u0610-\\u061A\\u0620-\\u0669\\u066E-\\u06D3\\u06D5-\\u06DC\\u06DF-\\u06E8\\u06EA-\\u06FC\\u06FF\\u0710-\\u074A\\u074D-\\u07B1\\u07C0-\\u07F5\\u07FA\\u0800-\\u082D\\u0840-\\u085B\\u08A0-\\u08B2\\u08E4-\\u0963\\u0966-\\u096F\\u0971-\\u0983\\u0985-\\u098C\\u098F\\u0990\\u0993-\\u09A8\\u09AA-\\u09B0\\u09B2\\u09B6-\\u09B9\\u09BC-\\u09C4\\u09C7\\u09C8\\u09CB-\\u09CE\\u09D7\\u09DC\\u09DD\\u09DF-\\u09E3\\u09E6-\\u09F1\\u0A01-\\u0A03\\u0A05-\\u0A0A\\u0A0F\\u0A10\\u0A13-\\u0A28\\u0A2A-\\u0A30\\u0A32\\u0A33\\u0A35\\u0A36\\u0A38\\u0A39\\u0A3C\\u0A3E-\\u0A42\\u0A47\\u0A48\\u0A4B-\\u0A4D\\u0A51\\u0A59-\\u0A5C\\u0A5E\\u0A66-\\u0A75\\u0A81-\\u0A83\\u0A85-\\u0A8D\\u0A8F-\\u0A91\\u0A93-\\u0AA8\\u0AAA-\\u0AB0\\u0AB2\\u0AB3\\u0AB5-\\u0AB9\\u0ABC-\\u0AC5\\u0AC7-\\u0AC9\\u0ACB-\\u0ACD\\u0AD0\\u0AE0-\\u0AE3\\u0AE6-\\u0AEF\\u0B01-\\u0B03\\u0B05-\\u0B0C\\u0B0F\\u0B10\\u0B13-\\u0B28\\u0B2A-\\u0B30\\u0B32\\u0B33\\u0B35-\\u0B39\\u0B3C-\\u0B44\\u0B47\\u0B48\\u0B4B-\\u0B4D\\u0B56\\u0B57\\u0B5C\\u0B5D\\u0B5F-\\u0B63\\u0B66-\\u0B6F\\u0B71\\u0B82\\u0B83\\u0B85-\\u0B8A\\u0B8E-\\u0B90\\u0B92-\\u0B95\\u0B99\\u0B9A\\u0B9C\\u0B9E\\u0B9F\\u0BA3\\u0BA4\\u0BA8-\\u0BAA\\u0BAE-\\u0BB9\\u0BBE-\\u0BC2\\u0BC6-\\u0BC8\\u0BCA-\\u0BCD\\u0BD0\\u0BD7\\u0BE6-\\u0BEF\\u0C00-\\u0C03\\u0C05-\\u0C0C\\u0C0E-\\u0C10\\u0C12-\\u0C28\\u0C2A-\\u0C39\\u0C3D-\\u0C44\\u0C46-\\u0C48\\u0C4A-\\u0C4D\\u0C55\\u0C56\\u0C58\\u0C59\\u0C60-\\u0C63\\u0C66-\\u0C6F\\u0C81-\\u0C83\\u0C85-\\u0C8C\\u0C8E-\\u0C90\\u0C92-\\u0CA8\\u0CAA-\\u0CB3\\u0CB5-\\u0CB9\\u0CBC-\\u0CC4\\u0CC6-\\u0CC8\\u0CCA-\\u0CCD\\u0CD5\\u0CD6\\u0CDE\\u0CE0-\\u0CE3\\u0CE6-\\u0CEF\\u0CF1\\u0CF2\\u0D01-\\u0D03\\u0D05-\\u0D0C\\u0D0E-\\u0D10\\u0D12-\\u0D3A\\u0D3D-\\u0D44\\u0D46-\\u0D48\\u0D4A-\\u0D4E\\u0D57\\u0D60-\\u0D63\\u0D66-\\u0D6F\\u0D7A-\\u0D7F\\u0D82\\u0D83\\u0D85-\\u0D96\\u0D9A-\\u0DB1\\u0DB3-\\u0DBB\\u0DBD\\u0DC0-\\u0DC6\\u0DCA\\u0DCF-\\u0DD4\\u0DD6\\u0DD8-\\u0DDF\\u0DE6-\\u0DEF\\u0DF2\\u0DF3\\u0E01-\\u0E3A\\u0E40-\\u0E4E\\u0E50-\\u0E59\\u0E81\\u0E82\\u0E84\\u0E87\\u0E88\\u0E8A\\u0E8D\\u0E94-\\u0E97\\u0E99-\\u0E9F\\u0EA1-\\u0EA3\\u0EA5\\u0EA7\\u0EAA\\u0EAB\\u0EAD-\\u0EB9\\u0EBB-\\u0EBD\\u0EC0-\\u0EC4\\u0EC6\\u0EC8-\\u0ECD\\u0ED0-\\u0ED9\\u0EDC-\\u0EDF\\u0F00\\u0F18\\u0F19\\u0F20-\\u0F29\\u0F35\\u0F37\\u0F39\\u0F3E-\\u0F47\\u0F49-\\u0F6C\\u0F71-\\u0F84\\u0F86-\\u0F97\\u0F99-\\u0FBC\\u0FC6\\u1000-\\u1049\\u1050-\\u109D\\u10A0-\\u10C5\\u10C7\\u10CD\\u10D0-\\u10FA\\u10FC-\\u1248\\u124A-\\u124D\\u1250-\\u1256\\u1258\\u125A-\\u125D\\u1260-\\u1288\\u128A-\\u128D\\u1290-\\u12B0\\u12B2-\\u12B5\\u12B8-\\u12BE\\u12C0\\u12C2-\\u12C5\\u12C8-\\u12D6\\u12D8-\\u1310\\u1312-\\u1315\\u1318-\\u135A\\u135D-\\u135F\\u1380-\\u138F\\u13A0-\\u13F4\\u1401-\\u166C\\u166F-\\u167F\\u1681-\\u169A\\u16A0-\\u16EA\\u16EE-\\u16F8\\u1700-\\u170C\\u170E-\\u1714\\u1720-\\u1734\\u1740-\\u1753\\u1760-\\u176C\\u176E-\\u1770\\u1772\\u1773\\u1780-\\u17D3\\u17D7\\u17DC\\u17DD\\u17E0-\\u17E9\\u180B-\\u180D\\u1810-\\u1819\\u1820-\\u1877\\u1880-\\u18AA\\u18B0-\\u18F5\\u1900-\\u191E\\u1920-\\u192B\\u1930-\\u193B\\u1946-\\u196D\\u1970-\\u1974\\u1980-\\u19AB\\u19B0-\\u19C9\\u19D0-\\u19D9\\u1A00-\\u1A1B\\u1A20-\\u1A5E\\u1A60-\\u1A7C\\u1A7F-\\u1A89\\u1A90-\\u1A99\\u1AA7\\u1AB0-\\u1ABD\\u1B00-\\u1B4B\\u1B50-\\u1B59\\u1B6B-\\u1B73\\u1B80-\\u1BF3\\u1C00-\\u1C37\\u1C40-\\u1C49\\u1C4D-\\u1C7D\\u1CD0-\\u1CD2\\u1CD4-\\u1CF6\\u1CF8\\u1CF9\\u1D00-\\u1DF5\\u1DFC-\\u1F15\\u1F18-\\u1F1D\\u1F20-\\u1F45\\u1F48-\\u1F4D\\u1F50-\\u1F57\\u1F59\\u1F5B\\u1F5D\\u1F5F-\\u1F7D\\u1F80-\\u1FB4\\u1FB6-\\u1FBC\\u1FBE\\u1FC2-\\u1FC4\\u1FC6-\\u1FCC\\u1FD0-\\u1FD3\\u1FD6-\\u1FDB\\u1FE0-\\u1FEC\\u1FF2-\\u1FF4\\u1FF6-\\u1FFC\\u200C\\u200D\\u203F\\u2040\\u2054\\u2071\\u207F\\u2090-\\u209C\\u20D0-\\u20DC\\u20E1\\u20E5-\\u20F0\\u2102\\u2107\\u210A-\\u2113\\u2115\\u2119-\\u211D\\u2124\\u2126\\u2128\\u212A-\\u212D\\u212F-\\u2139\\u213C-\\u213F\\u2145-\\u2149\\u214E\\u2160-\\u2188\\u2C00-\\u2C2E\\u2C30-\\u2C5E\\u2C60-\\u2CE4\\u2CEB-\\u2CF3\\u2D00-\\u2D25\\u2D27\\u2D2D\\u2D30-\\u2D67\\u2D6F\\u2D7F-\\u2D96\\u2DA0-\\u2DA6\\u2DA8-\\u2DAE\\u2DB0-\\u2DB6\\u2DB8-\\u2DBE\\u2DC0-\\u2DC6\\u2DC8-\\u2DCE\\u2DD0-\\u2DD6\\u2DD8-\\u2DDE\\u2DE0-\\u2DFF\\u2E2F\\u3005-\\u3007\\u3021-\\u302F\\u3031-\\u3035\\u3038-\\u303C\\u3041-\\u3096\\u3099\\u309A\\u309D-\\u309F\\u30A1-\\u30FA\\u30FC-\\u30FF\\u3105-\\u312D\\u3131-\\u318E\\u31A0-\\u31BA\\u31F0-\\u31FF\\u3400-\\u4DB5\\u4E00-\\u9FCC\\uA000-\\uA48C\\uA4D0-\\uA4FD\\uA500-\\uA60C\\uA610-\\uA62B\\uA640-\\uA66F\\uA674-\\uA67D\\uA67F-\\uA69D\\uA69F-\\uA6F1\\uA717-\\uA71F\\uA722-\\uA788\\uA78B-\\uA78E\\uA790-\\uA7AD\\uA7B0\\uA7B1\\uA7F7-\\uA827\\uA840-\\uA873\\uA880-\\uA8C4\\uA8D0-\\uA8D9\\uA8E0-\\uA8F7\\uA8FB\\uA900-\\uA92D\\uA930-\\uA953\\uA960-\\uA97C\\uA980-\\uA9C0\\uA9CF-\\uA9D9\\uA9E0-\\uA9FE\\uAA00-\\uAA36\\uAA40-\\uAA4D\\uAA50-\\uAA59\\uAA60-\\uAA76\\uAA7A-\\uAAC2\\uAADB-\\uAADD\\uAAE0-\\uAAEF\\uAAF2-\\uAAF6\\uAB01-\\uAB06\\uAB09-\\uAB0E\\uAB11-\\uAB16\\uAB20-\\uAB26\\uAB28-\\uAB2E\\uAB30-\\uAB5A\\uAB5C-\\uAB5F\\uAB64\\uAB65\\uABC0-\\uABEA\\uABEC\\uABED\\uABF0-\\uABF9\\uAC00-\\uD7A3\\uD7B0-\\uD7C6\\uD7CB-\\uD7FB\\uF900-\\uFA6D\\uFA70-\\uFAD9\\uFB00-\\uFB06\\uFB13-\\uFB17\\uFB1D-\\uFB28\\uFB2A-\\uFB36\\uFB38-\\uFB3C\\uFB3E\\uFB40\\uFB41\\uFB43\\uFB44\\uFB46-\\uFBB1\\uFBD3-\\uFD3D\\uFD50-\\uFD8F\\uFD92-\\uFDC7\\uFDF0-\\uFDFB\\uFE00-\\uFE0F\\uFE20-\\uFE2D\\uFE33\\uFE34\\uFE4D-\\uFE4F\\uFE70-\\uFE74\\uFE76-\\uFEFC\\uFF10-\\uFF19\\uFF21-\\uFF3A\\uFF3F\\uFF41-\\uFF5A\\uFF66-\\uFFBE\\uFFC2-\\uFFC7\\uFFCA-\\uFFCF\\uFFD2-\\uFFD7\\uFFDA-\\uFFDC]");function NN(e,t){if(!e)throw new Error("ASSERT: "+t)}function Dl(e){return e>=48&&e<=57}function TU(e){return"0123456789abcdefABCDEF".indexOf(e)>=0}function Sx(e){return"01234567".indexOf(e)>=0}function Mvt(e){return e===32||e===9||e===11||e===12||e===160||e>=5760&&[5760,6158,8192,8193,8194,8195,8196,8197,8198,8199,8200,8201,8202,8239,8287,12288,65279].indexOf(e)>=0}function Zv(e){return e===10||e===13||e===8232||e===8233}function V$(e){return e===36||e===95||e>=65&&e<=90||e>=97&&e<=122||e===92||e>=128&&Ovt.test(String.fromCharCode(e))}function W_(e){return e===36||e===95||e>=65&&e<=90||e>=97&&e<=122||e>=48&&e<=57||e===92||e>=128&&Rvt.test(String.fromCharCode(e))}const Lvt={if:1,in:1,do:1,var:1,for:1,new:1,try:1,let:1,this:1,else:1,case:1,void:1,with:1,enum:1,while:1,break:1,catch:1,throw:1,const:1,yield:1,class:1,super:1,return:1,typeof:1,delete:1,switch:1,export:1,import:1,public:1,static:1,default:1,finally:1,extends:1,package:1,private:1,function:1,continue:1,debugger:1,interface:1,protected:1,instanceof:1,implements:1};function J0e(){for(;ie<Si;){const e=Ie.charCodeAt(ie);if(Mvt(e)||Zv(e))++ie;else break}}function LL(e){var t,n,r,i=0;for(n=e==="u"?4:2,t=0;t<n;++t)ie<Si&&TU(Ie[ie])?(r=Ie[ie++],i=i*16+"0123456789abcdef".indexOf(r.toLowerCase())):_t({},Er,Gr);return String.fromCharCode(i)}function Pvt(){var e,t,n,r;for(e=Ie[ie],t=0,e==="}"&&_t({},Er,Gr);ie<Si&&(e=Ie[ie++],!!TU(e));)t=t*16+"0123456789abcdef".indexOf(e.toLowerCase());return(t>1114111||e!=="}")&&_t({},Er,Gr),t<=65535?String.fromCharCode(t):(n=(t-65536>>10)+55296,r=(t-65536&1023)+56320,String.fromCharCode(n,r))}function Q0e(){var e,t;for(e=Ie.charCodeAt(ie++),t=String.fromCharCode(e),e===92&&(Ie.charCodeAt(ie)!==117&&_t({},Er,Gr),++ie,e=LL("u"),(!e||e==="\\"||!V$(e.charCodeAt(0)))&&_t({},Er,Gr),t=e);ie<Si&&(e=Ie.charCodeAt(ie),!!W_(e));)++ie,t+=String.fromCharCode(e),e===92&&(t=t.substr(0,t.length-1),Ie.charCodeAt(ie)!==117&&_t({},Er,Gr),++ie,e=LL("u"),(!e||e==="\\"||!W_(e.charCodeAt(0)))&&_t({},Er,Gr),t+=e);return t}function Bvt(){var e,t;for(e=ie++;ie<Si;){if(t=Ie.charCodeAt(ie),t===92)return ie=e,Q0e();if(W_(t))++ie;else break}return Ie.slice(e,ie)}function zvt(){var e,t,n;return e=ie,t=Ie.charCodeAt(ie)===92?Q0e():Bvt(),t.length===1?n=Bp:Lvt.hasOwnProperty(t)?n=jh:t==="null"?n=DN:t==="true"||t==="false"?n=IN:n=Bp,{type:n,value:t,start:e,end:ie}}function qO(){var e=ie,t=Ie.charCodeAt(ie),n,r=Ie[ie],i,s,o;switch(t){case 46:case 40:case 41:case 59:case 44:case 123:case 125:case 91:case 93:case 58:case 63:case 126:return++ie,{type:hs,value:String.fromCharCode(t),start:e,end:ie};default:if(n=Ie.charCodeAt(ie+1),n===61)switch(t){case 43:case 45:case 47:case 60:case 62:case 94:case 124:case 37:case 38:case 42:return ie+=2,{type:hs,value:String.fromCharCode(t)+String.fromCharCode(n),start:e,end:ie};case 33:case 61:return ie+=2,Ie.charCodeAt(ie)===61&&++ie,{type:hs,value:Ie.slice(e,ie),start:e,end:ie}}}if(o=Ie.substr(ie,4),o===">>>=")return ie+=4,{type:hs,value:o,start:e,end:ie};if(s=o.substr(0,3),s===">>>"||s==="<<="||s===">>=")return ie+=3,{type:hs,value:s,start:e,end:ie};if(i=s.substr(0,2),r===i[1]&&"+-<>&|".indexOf(r)>=0||i==="=>")return ie+=2,{type:hs,value:i,start:e,end:ie};if(i==="//"&&_t({},Er,Gr),"<>=!+-*%&|^/".indexOf(r)>=0)return++ie,{type:hs,value:r,start:e,end:ie};_t({},Er,Gr)}function Uvt(e){let t="";for(;ie<Si&&TU(Ie[ie]);)t+=Ie[ie++];return t.length===0&&_t({},Er,Gr),V$(Ie.charCodeAt(ie))&&_t({},Er,Gr),{type:Og,value:parseInt("0x"+t,16),start:e,end:ie}}function jvt(e){let t="0"+Ie[ie++];for(;ie<Si&&Sx(Ie[ie]);)t+=Ie[ie++];return(V$(Ie.charCodeAt(ie))||Dl(Ie.charCodeAt(ie)))&&_t({},Er,Gr),{type:Og,value:parseInt(t,8),octal:!0,start:e,end:ie}}function XK(){var e,t,n;if(n=Ie[ie],NN(Dl(n.charCodeAt(0))||n===".","Numeric literal must start with a decimal digit or a decimal point"),t=ie,e="",n!=="."){if(e=Ie[ie++],n=Ie[ie],e==="0"){if(n==="x"||n==="X")return++ie,Uvt(t);if(Sx(n))return jvt(t);n&&Dl(n.charCodeAt(0))&&_t({},Er,Gr)}for(;Dl(Ie.charCodeAt(ie));)e+=Ie[ie++];n=Ie[ie]}if(n==="."){for(e+=Ie[ie++];Dl(Ie.charCodeAt(ie));)e+=Ie[ie++];n=Ie[ie]}if(n==="e"||n==="E")if(e+=Ie[ie++],n=Ie[ie],(n==="+"||n==="-")&&(e+=Ie[ie++]),Dl(Ie.charCodeAt(ie)))for(;Dl(Ie.charCodeAt(ie));)e+=Ie[ie++];else _t({},Er,Gr);return V$(Ie.charCodeAt(ie))&&_t({},Er,Gr),{type:Og,value:parseFloat(e),start:t,end:ie}}function Wvt(){var e="",t,n,r,i,s=!1;for(t=Ie[ie],NN(t==="'"||t==='"',"String literal must starts with a quote"),n=ie,++ie;ie<Si;)if(r=Ie[ie++],r===t){t="";break}else if(r==="\\")if(r=Ie[ie++],!r||!Zv(r.charCodeAt(0)))switch(r){case"u":case"x":Ie[ie]==="{"?(++ie,e+=Pvt()):e+=LL(r);break;case"n":e+=`
`;break;case"r":e+="\r";break;case"t":e+="	";break;case"b":e+="\b";break;case"f":e+="\f";break;case"v":e+="\v";break;default:Sx(r)?(i="01234567".indexOf(r),i!==0&&(s=!0),ie<Si&&Sx(Ie[ie])&&(s=!0,i=i*8+"01234567".indexOf(Ie[ie++]),"0123".indexOf(r)>=0&&ie<Si&&Sx(Ie[ie])&&(i=i*8+"01234567".indexOf(Ie[ie++]))),e+=String.fromCharCode(i)):e+=r;break}else r==="\r"&&Ie[ie]===`
`&&++ie;else{if(Zv(r.charCodeAt(0)))break;e+=r}return t!==""&&_t({},Er,Gr),{type:W$,value:e,octal:s,start:n,end:ie}}function Vvt(e,t){let n=e;t.indexOf("u")>=0&&(n=n.replace(/\\u\{([0-9a-fA-F]+)\}/g,(r,i)=>{if(parseInt(i,16)<=1114111)return"x";_t({},ML)}).replace(/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,"x"));try{new RegExp(n)}catch{_t({},ML)}try{return new RegExp(e,t)}catch{return null}}function Gvt(){var e,t,n,r,i;for(e=Ie[ie],NN(e==="/","Regular expression literal must start with a slash"),t=Ie[ie++],n=!1,r=!1;ie<Si;)if(e=Ie[ie++],t+=e,e==="\\")e=Ie[ie++],Zv(e.charCodeAt(0))&&_t({},HO),t+=e;else if(Zv(e.charCodeAt(0)))_t({},HO);else if(n)e==="]"&&(n=!1);else if(e==="/"){r=!0;break}else e==="["&&(n=!0);return r||_t({},HO),i=t.substr(1,t.length-2),{value:i,literal:t}}function Hvt(){var e,t,n;for(t="",n="";ie<Si&&(e=Ie[ie],!!W_(e.charCodeAt(0)));)++ie,e==="\\"&&ie<Si?_t({},Er,Gr):(n+=e,t+=e);return n.search(/[^gimuy]/g)>=0&&_t({},ML,n),{value:n,literal:t}}function qvt(){var e,t,n,r;return jt=null,J0e(),e=ie,t=Gvt(),n=Hvt(),r=Vvt(t.value,n.value),{literal:t.literal+n.literal,value:r,regex:{pattern:t.value,flags:n.value},start:e,end:ie}}function Xvt(e){return e.type===Bp||e.type===jh||e.type===IN||e.type===DN}function e1e(){if(J0e(),ie>=Si)return{type:j$,start:ie,end:ie};const e=Ie.charCodeAt(ie);return V$(e)?zvt():e===40||e===41||e===59?qO():e===39||e===34?Wvt():e===46?Dl(Ie.charCodeAt(ie+1))?XK():qO():Dl(e)?XK():qO()}function bs(){const e=jt;return ie=e.end,jt=e1e(),ie=e.end,e}function t1e(){const e=ie;jt=e1e(),ie=e}function Yvt(e){const t=new Va(bvt);return t.elements=e,t}function YK(e,t,n){const r=new Va(e==="||"||e==="&&"?Cvt:xvt);return r.operator=e,r.left=t,r.right=n,r}function Kvt(e,t){const n=new Va(vvt);return n.callee=e,n.arguments=t,n}function Zvt(e,t,n){const r=new Va(wvt);return r.test=e,r.consequent=t,r.alternate=n,r}function IU(e){const t=new Va(K0e);return t.name=e,t}function tx(e){const t=new Va($vt);return t.value=e.value,t.raw=Ie.slice(e.start,e.end),e.regex&&(t.raw==="//"&&(t.raw="/(?:)/"),t.regex=e.regex),t}function KK(e,t,n){const r=new Va(Svt);return r.computed=e==="[",r.object=t,r.property=n,r.computed||(n.member=!0),r}function Jvt(e){const t=new Va(kvt);return t.properties=e,t}function ZK(e,t,n){const r=new Va(Evt);return r.key=t,r.value=n,r.kind=e,r}function Qvt(e,t){const n=new Va(_vt);return n.operator=e,n.argument=t,n.prefix=!0,n}function _t(e,t){var n,r=Array.prototype.slice.call(arguments,2),i=t.replace(/%(\d)/g,(s,o)=>(NN(o<r.length,"Message reference must be in range"),r[o]));throw n=new Error(i),n.index=ie,n.description=i,n}function FN(e){e.type===j$&&_t(e,Nvt),e.type===Og&&_t(e,Avt),e.type===W$&&_t(e,Tvt),e.type===Bp&&_t(e,Ivt),e.type===jh&&_t(e,Dvt),_t(e,Er,e.value)}function ki(e){const t=bs();(t.type!==hs||t.value!==e)&&FN(t)}function fn(e){return jt.type===hs&&jt.value===e}function XO(e){return jt.type===jh&&jt.value===e}function e2t(){const e=[];for(ie=jt.start,ki("[");!fn("]");)fn(",")?(bs(),e.push(null)):(e.push(zp()),fn("]")||ki(","));return bs(),Yvt(e)}function JK(){ie=jt.start;const e=bs();return e.type===W$||e.type===Og?(e.octal&&_t(e,Z0e),tx(e)):IU(e.value)}function t2t(){var e,t,n,r;if(ie=jt.start,e=jt,e.type===Bp)return n=JK(),ki(":"),r=zp(),ZK("init",n,r);if(e.type===j$||e.type===hs)FN(e);else return t=JK(),ki(":"),r=zp(),ZK("init",t,r)}function n2t(){var e=[],t,n,r,i={},s=String;for(ie=jt.start,ki("{");!fn("}");)t=t2t(),t.key.type===K0e?n=t.key.name:n=s(t.key.value),r="$"+n,Object.prototype.hasOwnProperty.call(i,r)?_t({},Fvt):i[r]=!0,e.push(t),fn("}")||ki(",");return ki("}"),Jvt(e)}function r2t(){ki("(");const e=DU();return ki(")"),e}const i2t={if:1};function s2t(){var e,t,n;if(fn("("))return r2t();if(fn("["))return e2t();if(fn("{"))return n2t();if(e=jt.type,ie=jt.start,e===Bp||i2t[jt.value])n=IU(bs().value);else if(e===W$||e===Og)jt.octal&&_t(jt,Z0e),n=tx(bs());else{if(e===jh)throw new Error(Kv);e===IN?(t=bs(),t.value=t.value==="true",n=tx(t)):e===DN?(t=bs(),t.value=null,n=tx(t)):fn("/")||fn("/=")?(n=tx(qvt()),t1e()):FN(bs())}return n}function o2t(){const e=[];if(ki("("),!fn(")"))for(;ie<Si&&(e.push(zp()),!fn(")"));)ki(",");return ki(")"),e}function a2t(){ie=jt.start;const e=bs();return Xvt(e)||FN(e),IU(e.value)}function u2t(){return ki("."),a2t()}function l2t(){ki("[");const e=DU();return ki("]"),e}function c2t(){var e,t,n;for(e=s2t();;)if(fn("."))n=u2t(),e=KK(".",e,n);else if(fn("("))t=o2t(),e=Kvt(e,t);else if(fn("["))n=l2t(),e=KK("[",e,n);else break;return e}function QK(){const e=c2t();if(jt.type===hs&&(fn("++")||fn("--")))throw new Error(Kv);return e}function pk(){var e,t;if(jt.type!==hs&&jt.type!==jh)t=QK();else{if(fn("++")||fn("--"))throw new Error(Kv);if(fn("+")||fn("-")||fn("~")||fn("!"))e=bs(),t=pk(),t=Qvt(e.value,t);else{if(XO("delete")||XO("void")||XO("typeof"))throw new Error(Kv);t=QK()}}return t}function eZ(e){let t=0;if(e.type!==hs&&e.type!==jh)return 0;switch(e.value){case"||":t=1;break;case"&&":t=2;break;case"|":t=3;break;case"^":t=4;break;case"&":t=5;break;case"==":case"!=":case"===":case"!==":t=6;break;case"<":case">":case"<=":case">=":case"instanceof":case"in":t=7;break;case"<<":case">>":case">>>":t=8;break;case"+":case"-":t=9;break;case"*":case"/":case"%":t=11;break}return t}function f2t(){var e,t,n,r,i,s,o,a,u,l;if(e=jt,u=pk(),r=jt,i=eZ(r),i===0)return u;for(r.prec=i,bs(),t=[e,jt],o=pk(),s=[u,r,o];(i=eZ(jt))>0;){for(;s.length>2&&i<=s[s.length-2].prec;)o=s.pop(),a=s.pop().value,u=s.pop(),t.pop(),n=YK(a,u,o),s.push(n);r=bs(),r.prec=i,s.push(r),t.push(jt),n=pk(),s.push(n)}for(l=s.length-1,n=s[l],t.pop();l>1;)t.pop(),n=YK(s[l-1].value,s[l-2],n),l-=2;return n}function zp(){var e,t,n;return e=f2t(),fn("?")&&(bs(),t=zp(),ki(":"),n=zp(),e=Zvt(e,t,n)),e}function DU(){const e=zp();if(fn(","))throw new Error(Kv);return e}function h2t(e){Ie=e,ie=0,Si=Ie.length,jt=null,t1e();const t=DU();if(jt.type!==j$)throw new Error("Unexpect token after expression.");return t}var n1e={NaN:"NaN",E:"Math.E",LN2:"Math.LN2",LN10:"Math.LN10",LOG2E:"Math.LOG2E",LOG10E:"Math.LOG10E",PI:"Math.PI",SQRT1_2:"Math.SQRT1_2",SQRT2:"Math.SQRT2",MIN_VALUE:"Number.MIN_VALUE",MAX_VALUE:"Number.MAX_VALUE"};function r1e(e){function t(o,a,u,l){let c=e(a[0]);return u&&(c=u+"("+c+")",u.lastIndexOf("new ",0)===0&&(c="("+c+")")),c+"."+o+(l<0?"":l===0?"()":"("+a.slice(1).map(e).join(",")+")")}function n(o,a,u){return l=>t(o,l,a,u)}const r="new Date",i="String",s="RegExp";return{isNaN:"Number.isNaN",isFinite:"Number.isFinite",abs:"Math.abs",acos:"Math.acos",asin:"Math.asin",atan:"Math.atan",atan2:"Math.atan2",ceil:"Math.ceil",cos:"Math.cos",exp:"Math.exp",floor:"Math.floor",hypot:"Math.hypot",log:"Math.log",max:"Math.max",min:"Math.min",pow:"Math.pow",random:"Math.random",round:"Math.round",sin:"Math.sin",sqrt:"Math.sqrt",tan:"Math.tan",clamp:function(o){o.length<3&&yi("Missing arguments to clamp function."),o.length>3&&yi("Too many arguments to clamp function.");const a=o.map(e);return"Math.max("+a[1]+", Math.min("+a[2]+","+a[0]+"))"},now:"Date.now",utc:"Date.UTC",datetime:r,date:n("getDate",r,0),day:n("getDay",r,0),year:n("getFullYear",r,0),month:n("getMonth",r,0),hours:n("getHours",r,0),minutes:n("getMinutes",r,0),seconds:n("getSeconds",r,0),milliseconds:n("getMilliseconds",r,0),time:n("getTime",r,0),timezoneoffset:n("getTimezoneOffset",r,0),utcdate:n("getUTCDate",r,0),utcday:n("getUTCDay",r,0),utcyear:n("getUTCFullYear",r,0),utcmonth:n("getUTCMonth",r,0),utchours:n("getUTCHours",r,0),utcminutes:n("getUTCMinutes",r,0),utcseconds:n("getUTCSeconds",r,0),utcmilliseconds:n("getUTCMilliseconds",r,0),length:n("length",null,-1),parseFloat:"parseFloat",parseInt:"parseInt",upper:n("toUpperCase",i,0),lower:n("toLowerCase",i,0),substring:n("substring",i),split:n("split",i),trim:n("trim",i,0),regexp:s,test:n("test",s),if:function(o){o.length<3&&yi("Missing arguments to if function."),o.length>3&&yi("Too many arguments to if function.");const a=o.map(e);return"("+a[0]+"?"+a[1]+":"+a[2]+")"}}}function d2t(e){const t=e&&e.length-1;return t&&(e[0]==='"'&&e[t]==='"'||e[0]==="'"&&e[t]==="'")?e.slice(1,-1):e}function p2t(e){e=e||{};const t=e.allowed?qK(e.allowed):{},n=e.forbidden?qK(e.forbidden):{},r=e.constants||n1e,i=(e.functions||r1e)(f),s=e.globalvar,o=e.fieldvar,a=j_(s)?s:p=>`${s}["${p}"]`;let u={},l={},c=0;function f(p){if(Cy(p))return p;const g=h[p.type];return g==null&&yi("Unsupported type: "+p.type),g(p)}const h={Literal:p=>p.raw,Identifier:p=>{const g=p.name;return c>0?g:yf(n,g)?yi("Illegal identifier: "+g):yf(r,g)?r[g]:yf(t,g)?g:(u[g]=1,a(g))},MemberExpression:p=>{const g=!p.computed,m=f(p.object);g&&(c+=1);const y=f(p.property);return m===o&&(l[d2t(y)]=1),g&&(c-=1),m+(g?"."+y:"["+y+"]")},CallExpression:p=>{p.callee.type!=="Identifier"&&yi("Illegal callee type: "+p.callee.type);const g=p.callee.name,m=p.arguments,y=yf(i,g)&&i[g];return y||yi("Unrecognized function: "+g),j_(y)?y(m):y+"("+m.map(f).join(",")+")"},ArrayExpression:p=>"["+p.elements.map(f).join(",")+"]",BinaryExpression:p=>"("+f(p.left)+" "+p.operator+" "+f(p.right)+")",UnaryExpression:p=>"("+p.operator+f(p.argument)+")",ConditionalExpression:p=>"("+f(p.test)+"?"+f(p.consequent)+":"+f(p.alternate)+")",LogicalExpression:p=>"("+f(p.left)+p.operator+f(p.right)+")",ObjectExpression:p=>"{"+p.properties.map(f).join(",")+"}",Property:p=>{c+=1;const g=f(p.key);return c-=1,g+":"+f(p.value)}};function d(p){const g={code:f(p),globals:Object.keys(u),fields:Object.keys(l)};return u={},l={},g}return d.functions=i,d.constants=r,d}function YO(e,t){return e==null||t==null?NaN:e<t?-1:e>t?1:e>=t?0:NaN}function g2t(e,t){return e==null||t==null?NaN:t<e?-1:t>e?1:t>=e?0:NaN}function m2t(e){let t,n,r;e.length!==2?(t=YO,n=(a,u)=>YO(e(a),u),r=(a,u)=>e(a)-u):(t=e===YO||e===g2t?e:y2t,n=e,r=e);function i(a,u,l=0,c=a.length){if(l<c){if(t(u,u)!==0)return c;do{const f=l+c>>>1;n(a[f],u)<0?l=f+1:c=f}while(l<c)}return l}function s(a,u,l=0,c=a.length){if(l<c){if(t(u,u)!==0)return c;do{const f=l+c>>>1;n(a[f],u)<=0?l=f+1:c=f}while(l<c)}return l}function o(a,u,l=0,c=a.length){const f=i(a,u,l,c-1);return f>l&&r(a[f-1],u)>-r(a[f],u)?f-1:f}return{left:i,center:o,right:s}}function y2t(){return 0}function b2t(e,...t){e=new cE(e),t=t.map(x2t);e:for(const n of e)for(const r of t)if(!r.has(n)){e.delete(n);continue e}return e}function x2t(e){return e instanceof cE?e:new cE(e)}function v2t(...e){const t=new cE;for(const n of e)for(const r of n)t.add(r);return t}function Sy(e,t,n){return e.fields=t||[],e.fname=n,e}function w2t(e){return e.length===1?$2t(e[0]):C2t(e)}const $2t=e=>function(t){return t[e]},C2t=e=>{const t=e.length;return function(n){for(let r=0;r<t;++r)n=n[e[r]];return n}};function gk(e){throw Error(e)}function S2t(e){const t=[],n=e.length;let r=null,i=0,s="",o,a,u;e=e+"";function l(){t.push(s+e.substring(o,a)),s="",o=a+1}for(o=a=0;a<n;++a)if(u=e[a],u==="\\")s+=e.substring(o,a++),o=a;else if(u===r)l(),r=null,i=-1;else{if(r)continue;o===i&&u==='"'||o===i&&u==="'"?(o=a+1,r=u):u==="."&&!i?a>o?l():o=a+1:u==="["?(a>o&&l(),i=o=a+1):u==="]"&&(i||gk("Access path missing open bracket: "+e),i>0&&l(),i=0,o=a+1)}return i&&gk("Access path missing closing bracket: "+e),r&&gk("Access path missing closing quote: "+e),a>o&&(a++,l()),t}function Jv(e,t,n){const r=S2t(e);return e=r.length===1?r[0]:e,Sy((n&&n.get||w2t)(r),[e],t||e)}Jv("id");Sy(e=>e,[],"identity");Sy(()=>0,[],"zero");Sy(()=>1,[],"one");Sy(()=>!0,[],"true");Sy(()=>!1,[],"false");var i1e=Array.isArray;function k2t(e){return e[e.length-1]}function Gd(e){return e==null||e===""?null:+e}function tZ(e){return e!=null?i1e(e)?e:[e]:[]}function E2t(e){for(let t,n,r=1,i=arguments.length;r<i;++r){t=arguments[r];for(n in t)e[n]=t[n]}return e}const _2t=Object.prototype.hasOwnProperty;function nZ(e,t){return _2t.call(e,t)}function CS(e,t,n,r){let i=t[0],s=t[t.length-1],o;return i>s&&(o=i,i=s,s=o),n=n===void 0||n,r=r===void 0||r,(n?i<=e:i<e)&&(r?e<=s:e<s)}function KO(e){return Object.prototype.toString.call(e)==="[object Date]"}const A2t="Literal";var al,T2t=1,I2t=2,D2t=3,N2t=4,F2t=5,O2t=6,R2t=7,M2t=8,L2t=9;al={};al[T2t]="Boolean";al[I2t]="<end>";al[D2t]="Identifier";al[N2t]="Keyword";al[F2t]="Null";al[O2t]="Numeric";al[R2t]="Punctuator";al[M2t]="String";al[L2t]="RegularExpression";const NU="intersect",rZ="union",P2t="vlMulti",B2t="vlPoint",iZ="or",z2t="and",lu="_vgsid_",Qv=Jv(lu),U2t="E",j2t="R",W2t="R-E",V2t="R-LE",G2t="R-RE",V_="index:unit";function sZ(e,t){for(var n=t.fields,r=t.values,i=n.length,s=0,o,a;s<i;++s)if(a=n[s],a.getter=Jv.getter||Jv(a.field),o=a.getter(e),KO(o)&&(o=Gd(o)),KO(r[s])&&(r[s]=Gd(r[s])),KO(r[s][0])&&(r[s]=r[s].map(Gd)),a.type===U2t){if(i1e(r[s])?r[s].indexOf(o)<0:o!==r[s])return!1}else if(a.type===j2t){if(!CS(o,r[s]))return!1}else if(a.type===G2t){if(!CS(o,r[s],!0,!1))return!1}else if(a.type===W2t){if(!CS(o,r[s],!1,!1))return!1}else if(a.type===V2t&&!CS(o,r[s],!1,!0))return!1;return!0}function H2t(e,t,n){for(var r=this.context.data[e],i=r?r.values.value:[],s=r?r[V_]&&r[V_].value:void 0,o=n===NU,a=i.length,u=0,l,c,f,h,d;u<a;++u)if(l=i[u],s&&o){if(c=c||{},f=c[h=l.unit]||0,f===-1)continue;if(d=sZ(t,l),c[h]=d?-1:++f,d&&s.size===1)return!0;if(!d&&f===s.get(h).count)return!1}else if(d=sZ(t,l),o^d)return d;return a&&o}const s1e=m2t(Qv),q2t=s1e.left,X2t=s1e.right;function Y2t(e,t,n){const r=this.context.data[e],i=r?r.values.value:[],s=r?r[V_]&&r[V_].value:void 0,o=n===NU,a=Qv(t),u=q2t(i,a);if(u===i.length||Qv(i[u])!==a)return!1;if(s&&o){if(s.size===1)return!0;if(X2t(i,a)-u<s.size)return!1}return!0}function K2t(e,t){return e.map(n=>E2t(t.fields?{values:t.fields.map(r=>(r.getter||(r.getter=Jv(r.field)))(n.datum))}:{[lu]:Qv(n.datum)},t))}function Z2t(e,t,n,r){for(var i=this.context.data[e],s=i?i.values.value:[],o={},a={},u={},l,c,f,h,d,p,g,m,y,b,v=s.length,x=0,w,C;x<v;++x)if(l=s[x],h=l.unit,c=l.fields,f=l.values,c&&f){for(w=0,C=c.length;w<C;++w)d=c[w],g=o[d.field]||(o[d.field]={}),m=g[h]||(g[h]=[]),u[d.field]=y=d.type.charAt(0),b=ZO[`${y}_union`],g[h]=b(m,tZ(f[w]));n&&(m=a[h]||(a[h]=[]),m.push(tZ(f).reduce(($,S,k)=>($[c[k].field]=S,$),{})))}else d=lu,p=Qv(l),g=o[d]||(o[d]={}),m=g[h]||(g[h]=[]),m.push(p),n&&(m=a[h]||(a[h]=[]),m.push({[lu]:p}));if(t=t||rZ,o[lu]?o[lu]=ZO[`${lu}_${t}`](...Object.values(o[lu])):Object.keys(o).forEach($=>{o[$]=Object.keys(o[$]).map(S=>o[$][S]).reduce((S,k)=>S===void 0?k:ZO[`${u[$]}_${t}`](S,k))}),s=Object.keys(a),n&&s.length){const $=r?B2t:P2t;o[$]=t===rZ?{[iZ]:s.reduce((S,k)=>(S.push(...a[k]),S),[])}:{[z2t]:s.map(S=>({[iZ]:a[S]}))}}return o}var ZO={[`${lu}_union`]:v2t,[`${lu}_intersect`]:b2t,E_union:function(e,t){if(!e.length)return t;for(var n=0,r=t.length;n<r;++n)e.indexOf(t[n])<0&&e.push(t[n]);return e},E_intersect:function(e,t){return e.length?e.filter(n=>t.indexOf(n)>=0):t},R_union:function(e,t){var n=Gd(t[0]),r=Gd(t[1]);return n>r&&(n=t[1],r=t[0]),e.length?(e[0]>n&&(e[0]=n),e[1]<r&&(e[1]=r),e):[n,r]},R_intersect:function(e,t){var n=Gd(t[0]),r=Gd(t[1]);return n>r&&(n=t[1],r=t[0]),e.length?r<e[0]||e[1]<n?[]:(e[0]<n&&(e[0]=n),e[1]>r&&(e[1]=r),e):[n,r]}};const J2t=":",Q2t="@";function FU(e,t,n,r){t[0].type!==A2t&&gk("First argument to selection functions must be a string literal.");const i=t[0].value,s=t.length>=2&&k2t(t).value,o="unit",a=Q2t+o,u=J2t+i;s===NU&&!nZ(r,a)&&(r[a]=n.getData(i).indataRef(n,o)),nZ(r,u)||(r[u]=n.getData(i).tuplesRef())}function o1e(e){const t=this.context.data[e];return t?t.values.value:[]}function ewt(e,t,n){const r=this.context.data[e]["index:"+t],i=r?r.value.get(n):void 0;return i&&i.count}function twt(e,t){const n=this.context.dataflow,r=this.context.data[e],i=r.input;return n.pulse(i,n.changeset().remove(j0e).insert(t)),1}function nwt(e,t,n){if(e){const r=this.context.dataflow,i=e.mark.source;r.pulse(i,r.changeset().encode(e,t))}return n!==void 0?n:e}const G$=e=>function(t,n){return this.context.dataflow.locale()[e](n)(t)},rwt=G$("format"),a1e=G$("timeFormat"),iwt=G$("utcFormat"),swt=G$("timeParse"),owt=G$("utcParse"),SS=new Date(2e3,0,1);function ON(e,t,n){return!Number.isInteger(e)||!Number.isInteger(t)?"":(SS.setYear(2e3),SS.setMonth(e),SS.setDate(t),a1e.call(this,SS,n))}function awt(e){return ON.call(this,e,1,"%B")}function uwt(e){return ON.call(this,e,1,"%b")}function lwt(e){return ON.call(this,0,2+e,"%A")}function cwt(e){return ON.call(this,0,2+e,"%a")}const fwt=":",hwt="@",PL="%",u1e="$";function OU(e,t,n,r){t[0].type!==O0&&yi("First argument to data functions must be a string literal.");const i=t[0].value,s=fwt+i;if(!yf(s,r))try{r[s]=n.getData(i).tuplesRef()}catch{}}function dwt(e,t,n,r){t[0].type!==O0&&yi("First argument to indata must be a string literal."),t[1].type!==O0&&yi("Second argument to indata must be a string literal.");const i=t[0].value,s=t[1].value,o=hwt+s;yf(o,r)||(r[o]=n.getData(i).indataRef(n,s))}function Es(e,t,n,r){if(t[0].type===O0)oZ(n,r,t[0].value);else for(e in n.scales)oZ(n,r,e)}function oZ(e,t,n){const r=PL+n;if(!yf(t,r))try{t[r]=e.scaleRef(n)}catch{}}function Ic(e,t){let n;return j_(e)?e:Cy(e)?(n=t.scales[e])&&n.value:void 0}function pwt(e,t,n){t.__bandwidth=i=>i&&i.bandwidth?i.bandwidth():0,n._bandwidth=Es,n._range=Es,n._scale=Es;const r=i=>"_["+(i.type===O0?Yv(PL+i.value):Yv(PL)+"+"+e(i))+"]";return{_bandwidth:i=>`this.__bandwidth(${r(i[0])})`,_range:i=>`${r(i[0])}.range()`,_scale:i=>`${r(i[0])}(${e(i[1])})`}}function RU(e,t){return function(n,r,i){if(n){const s=Ic(n,(i||this).context);return s&&s.path[e](r)}else return t(r)}}const gwt=RU("area",rft),mwt=RU("bounds",aft),ywt=RU("centroid",dft);function bwt(e){const t=this.context.group;let n=!1;if(t)for(;e;){if(e===t){n=!0;break}e=e.mark.group}return n}function MU(e,t,n){try{e[t].apply(e,["EXPRESSION"].concat([].slice.call(n)))}catch(r){e.warn(r)}return n[n.length-1]}function xwt(){return MU(this.context.dataflow,"warn",arguments)}function vwt(){return MU(this.context.dataflow,"info",arguments)}function wwt(){return MU(this.context.dataflow,"debug",arguments)}function JO(e){const t=e/255;return t<=.03928?t/12.92:Math.pow((t+.055)/1.055,2.4)}function BL(e){const t=Ns(e),n=JO(t.r),r=JO(t.g),i=JO(t.b);return .2126*n+.7152*r+.0722*i}function $wt(e,t){const n=BL(e),r=BL(t),i=Math.max(n,r),s=Math.min(n,r);return(i+.05)/(s+.05)}function Cwt(){const e=[].slice.call(arguments);return e.unshift({}),AU(...e)}function l1e(e,t){return e===t||e!==e&&t!==t?!0:mc(e)?mc(t)&&e.length===t.length?Swt(e,t):!1:z_(e)&&z_(t)?c1e(e,t):!1}function Swt(e,t){for(let n=0,r=e.length;n<r;++n)if(!l1e(e[n],t[n]))return!1;return!0}function c1e(e,t){for(const n in e)if(!l1e(e[n],t[n]))return!1;return!0}function aZ(e){return t=>c1e(e,t)}function kwt(e,t,n,r,i,s){const o=this.context.dataflow,a=this.context.data[e],u=a.input,l=o.stamp();let c=a.changes,f,h;if(o._trigger===!1||!(u.value.length||t||r))return 0;if((!c||c.stamp<l)&&(a.changes=c=o.changeset(),c.stamp=l,o.runAfter(()=>{a.modified=!0,o.pulse(u,c).run()},!0,1)),n&&(f=n===!0?j0e:mc(n)||eD(n)?n:aZ(n),c.remove(f)),t&&c.insert(t),r&&(f=aZ(r),u.value.some(f)?c.remove(f):c.insert(r)),i)for(h in s)c.modify(i,h,s[h]);return 1}function Ewt(e){const t=e.touches,n=t[0].clientX-t[1].clientX,r=t[0].clientY-t[1].clientY;return Math.sqrt(n*n+r*r)}function _wt(e){const t=e.touches;return Math.atan2(t[0].clientY-t[1].clientY,t[0].clientX-t[1].clientX)}const uZ={};function Awt(e,t){const n=uZ[t]||(uZ[t]=U0e(t));return mc(e)?e.map(n):n(e)}function LU(e){return mc(e)||ArrayBuffer.isView(e)?e:null}function PU(e){return LU(e)||(Cy(e)?e:null)}function Twt(e,...t){return LU(e).join(...t)}function Iwt(e,...t){return PU(e).indexOf(...t)}function Dwt(e,...t){return PU(e).lastIndexOf(...t)}function Nwt(e,...t){return PU(e).slice(...t)}function Fwt(e,t,n){return j_(n)&&yi("Function argument passed to replace."),String(e).replace(t,n)}function Owt(e){return LU(e).slice().reverse()}function Rwt(e,t,n){return h7(e||0,t||0,n||0)}function Mwt(e,t){const n=Ic(e,(t||this).context);return n&&n.bandwidth?n.bandwidth():0}function Lwt(e,t){const n=Ic(e,(t||this).context);return n?n.copy():void 0}function Pwt(e,t){const n=Ic(e,(t||this).context);return n?n.domain():[]}function Bwt(e,t,n){const r=Ic(e,(n||this).context);return r?mc(t)?(r.invertRange||r.invert)(t):(r.invert||r.invertExtent)(t):void 0}function zwt(e,t){const n=Ic(e,(t||this).context);return n&&n.range?n.range():[]}function Uwt(e,t,n){const r=Ic(e,(n||this).context);return r?r(t):void 0}function jwt(e,t,n,r,i){e=Ic(e,(i||this).context);const s=rme(t,n);let o=e.domain(),a=o[0],u=ph(o),l=EU;return u-a?l=Ude(e,a,u):e=(e.interpolator?Rt("sequential")().interpolator(e.interpolator()):Rt("linear")().interpolate(e.interpolate()).range(e.range())).domain([a=0,u=1]),e.ticks&&(o=e.ticks(+r||15),a!==o[0]&&o.unshift(a),u!==ph(o)&&o.push(u)),o.forEach(c=>s.stop(l(c),e(c))),s}function Wwt(e,t,n){const r=Ic(e,(n||this).context);return function(i){return r?r.path.context(i)(t):""}}function Vwt(e){let t=null;return function(n){return n?jv(n,t=t||A0(e)):e}}const f1e=e=>e.data;function h1e(e,t){const n=o1e.call(t,e);return n.root&&n.root.lookup||{}}function Gwt(e,t,n){const r=h1e(e,this),i=r[t],s=r[n];return i&&s?i.path(s).map(f1e):void 0}function Hwt(e,t){const n=h1e(e,this)[t];return n?n.ancestors().map(f1e):void 0}const d1e=()=>typeof window<"u"&&window||null;function qwt(){const e=d1e();return e?e.screen:{}}function Xwt(){const e=d1e();return e?[e.innerWidth,e.innerHeight]:[void 0,void 0]}function Ywt(){const e=this.context.dataflow,t=e.container&&e.container();return t?[t.clientWidth,t.clientHeight]:[void 0,void 0]}function Kwt(e,t,n){if(!e)return[];const[r,i]=e,s=new Ji().set(r[0],r[1],i[0],i[1]),o=n||this.context.dataflow.scenegraph().root;return qme(o,s,Zwt(t))}function Zwt(e){let t=null;if(e){const n=HK(e.marktype),r=HK(e.markname);t=i=>(!n.length||n.some(s=>i.marktype===s))&&(!r.length||r.some(s=>i.name===s))}return t}const e2={random(){return Oa()},cumulativeNormal:sD,cumulativeLogNormal:Z6,cumulativeUniform:tz,densityNormal:H6,densityLogNormal:K6,densityUniform:ez,quantileNormal:oD,quantileLogNormal:J6,quantileUniform:nz,sampleNormal:iD,sampleLogNormal:Y6,sampleUniform:Q6,isArray:mc,isBoolean:Kxt,isDate:q0e,isDefined(e){return e!==void 0},isNumber:X0e,isObject:z_,isRegExp:Zxt,isString:Cy,isTuple:eD,isValid(e){return e!=null&&e===e},toBoolean:tvt,toDate:rvt,toNumber:_U,toString:ivt,indexof:Iwt,join:Twt,lastindexof:Dwt,replace:Fwt,reverse:Owt,slice:Nwt,flush:Xxt,lerp:Jxt,merge:Cwt,pad:Qxt,peek:ph,pluck:Awt,span:evt,inrange:Yxt,truncate:svt,rgb:Ns,lab:rh,hcl:ih,hsl:nh,luminance:BL,contrast:$wt,sequence:Js,format:rwt,utcFormat:iwt,utcParse:owt,utcOffset:Nle,utcSequence:Rle,timeFormat:a1e,timeParse:swt,timeOffset:Dle,timeSequence:Ole,timeUnitSpecifier:vle,monthFormat:awt,monthAbbrevFormat:uwt,dayFormat:lwt,dayAbbrevFormat:cwt,quarter:Wxt,utcquarter:Vxt,week:$le,utcweek:kle,dayofyear:wle,utcdayofyear:Sle,warn:xwt,info:vwt,debug:wwt,extent:Hxt,inScope:bwt,intersect:Kwt,clampRange:Gxt,pinchDistance:Ewt,pinchAngle:_wt,screen:qwt,containerSize:Ywt,windowSize:Xwt,bandspace:Rwt,setdata:twt,pathShape:Vwt,panLinear:Rxt,panLog:Mxt,panPow:Lxt,panSymlog:Pxt,zoomLinear:Bxt,zoomLog:zxt,zoomPow:Uxt,zoomSymlog:jxt,encode:nwt,modify:kwt},Jwt=["view","item","group","xy","x","y"],Qwt="event.vega.",p1e="this.",BU={},g1e={forbidden:["_"],allowed:["datum","event","item"],fieldvar:"datum",globalvar:e=>`_[${Yv(u1e+e)}]`,functions:e$t,constants:n1e,visitors:BU},zL=p2t(g1e);function e$t(e){const t=r1e(e);Jwt.forEach(n=>t[n]=Qwt+n);for(const n in e2)t[n]=p1e+n;return AU(t,pwt(e,e2,BU)),t}function er(e,t,n){return arguments.length===1?e2[e]:(e2[e]=t,n&&(BU[e]=n),zL&&(zL.functions[e]=p1e+e),this)}er("bandwidth",Mwt,Es);er("copy",Lwt,Es);er("domain",Pwt,Es);er("range",zwt,Es);er("invert",Bwt,Es);er("scale",Uwt,Es);er("gradient",jwt,Es);er("geoArea",gwt,Es);er("geoBounds",mwt,Es);er("geoCentroid",ywt,Es);er("geoShape",Wwt,Es);er("indata",ewt,dwt);er("data",o1e,OU);er("treePath",Gwt,OU);er("treeAncestors",Hwt,OU);er("vlSelectionTest",H2t,FU);er("vlSelectionIdTest",Y2t,FU);er("vlSelectionResolve",Z2t,FU);er("vlSelectionTuples",K2t);function Gu(e,t){const n={};let r;try{e=Cy(e)?e:Yv(e)+"",r=h2t(e)}catch{yi("Expression parse error: "+e)}r.visit(s=>{if(s.type!==Y0e)return;const o=s.callee.name,a=g1e.visitors[o];a&&a(o,s.arguments,t,n)});const i=zL(r);return i.globals.forEach(s=>{const o=u1e+s;!yf(n,o)&&t.getSignal(s)&&(n[o]=t.signalRef(s))}),{$expr:AU({code:i.code},t.options.ast?{ast:r}:null),$fields:i.fields,$params:n}}function ul(e,t,n){return e.fields=t||[],e.fname=n,e}function t$t(e){return e==null?null:e.fields}function m1e(e){return e.length===1?n$t(e[0]):r$t(e)}const n$t=e=>function(t){return t[e]},r$t=e=>{const t=e.length;return function(n){for(let r=0;r<t;++r)n=n[e[r]];return n}};function op(e){throw Error(e)}function y1e(e){const t=[],n=e.length;let r=null,i=0,s="",o,a,u;e=e+"";function l(){t.push(s+e.substring(o,a)),s="",o=a+1}for(o=a=0;a<n;++a)if(u=e[a],u==="\\")s+=e.substring(o,a++),o=a;else if(u===r)l(),r=null,i=-1;else{if(r)continue;o===i&&u==='"'||o===i&&u==="'"?(o=a+1,r=u):u==="."&&!i?a>o?l():o=a+1:u==="["?(a>o&&l(),i=o=a+1):u==="]"&&(i||op("Access path missing open bracket: "+e),i>0&&l(),i=0,o=a+1)}return i&&op("Access path missing closing bracket: "+e),r&&op("Access path missing closing quote: "+e),a>o&&(a++,l()),t}function zU(e,t,n){const r=y1e(e);return e=r.length===1?r[0]:e,ul((n&&n.get||m1e)(r),[e],t||e)}zU("id");ul(e=>e,[],"identity");ul(()=>0,[],"zero");ul(()=>1,[],"one");const i$t=ul(()=>!0,[],"true");ul(()=>!1,[],"false");var UU=Array.isArray;function jU(e){return e===Object(e)}function t2(e){return e!=null?UU(e)?e:[e]:[]}function s$t(e){return typeof e=="function"}const o$t="descending";function a$t(e,t,n){n=n||{},t=t2(t)||[];const r=[],i=[],s={},o=n.comparator||u$t;return t2(e).forEach((a,u)=>{a!=null&&(r.push(t[u]===o$t?-1:1),i.push(a=s$t(a)?a:zU(a,null,n)),(t$t(a)||[]).forEach(l=>s[l]=1))}),i.length===0?null:ul(o(i,r),Object.keys(s))}const b1e=(e,t)=>(e<t||e==null)&&t!=null?-1:(e>t||t==null)&&e!=null?1:(t=t instanceof Date?+t:t,(e=e instanceof Date?+e:e)!==e&&t===t?-1:t!==t&&e===e?1:0),u$t=(e,t)=>e.length===1?l$t(e[0],t[0]):c$t(e,t,e.length),l$t=(e,t)=>function(n,r){return b1e(e(n),e(r))*t},c$t=(e,t,n)=>(t.push(0),function(r,i){let s,o=0,a=-1;for(;o===0&&++a<n;)s=e[a],o=b1e(s(r),s(i));return o*t[a]}),f$t=Object.prototype.hasOwnProperty;function h$t(e,t){return f$t.call(e,t)}function d$t(e){return typeof e=="string"}function p$t(e,t,n){e&&(e=t?t2(e).map(a=>a.replace(/\\(.)/g,"$1")):t2(e));const r=e&&e.length,i=n&&n.get||m1e,s=a=>i(t?[a]:y1e(a));let o;if(!r)o=function(){return""};else if(r===1){const a=s(e[0]);o=function(u){return""+a(u)}}else{const a=e.map(s);o=function(u){let l=""+a[0](u),c=0;for(;++c<r;)l+="|"+a[c](u);return l}}return ul(o,e,"key")}function UL(e){return UU(e)?"["+e.map(UL)+"]":jU(e)||d$t(e)?JSON.stringify(e).replace("\u2028","\\u2028").replace("\u2029","\\u2029"):e}function x1e(e){const t={},n=e.length;for(let r=0;r<n;++r)t[e[r]]=!0;return t}function g$t(e){const t=this,n=e.operators||[];return e.background&&(t.background=e.background),e.eventConfig&&(t.eventConfig=e.eventConfig),e.locale&&(t.locale=e.locale),n.forEach(r=>t.parseOperator(r)),n.forEach(r=>t.parseOperatorParameters(r)),(e.streams||[]).forEach(r=>t.parseStream(r)),(e.updates||[]).forEach(r=>t.parseUpdate(r)),t.resolve()}const m$t=x1e(["rule"]),lZ=x1e(["group","image","rect"]);function y$t(e,t){let n="";return m$t[t]||(e.x2&&(e.x?(lZ[t]&&(n+="if(o.x>o.x2)$=o.x,o.x=o.x2,o.x2=$;"),n+="o.width=o.x2-o.x;"):n+="o.x=o.x2-(o.width||0);"),e.xc&&(n+="o.x=o.xc-(o.width||0)/2;"),e.y2&&(e.y?(lZ[t]&&(n+="if(o.y>o.y2)$=o.y,o.y=o.y2,o.y2=$;"),n+="o.height=o.y2-o.y;"):n+="o.y=o.y2-(o.height||0);"),e.yc&&(n+="o.y=o.yc-(o.height||0)/2;")),n}function WU(e){return(e+"").toLowerCase()}function b$t(e){return WU(e)==="operator"}function x$t(e){return WU(e)==="collect"}function mb(e,t,n){n.endsWith(";")||(n="return("+n+");");const r=Function(...t.concat(n));return e&&e.functions?r.bind(e.functions):r}function v$t(e,t,n,r){return`((u = ${e}) < (v = ${t}) || u == null) && v != null ? ${n}
  : (u > v || v == null) && u != null ? ${r}
  : ((v = v instanceof Date ? +v : v), (u = u instanceof Date ? +u : u)) !== u && v === v ? ${n}
  : v !== v && u === u ? ${r} : `}var w$t={operator:(e,t)=>mb(e,["_"],t.code),parameter:(e,t)=>mb(e,["datum","_"],t.code),event:(e,t)=>mb(e,["event"],t.code),handler:(e,t)=>{const n=`var datum=event.item&&event.item.datum;return ${t.code};`;return mb(e,["_","event"],n)},encode:(e,t)=>{const{marktype:n,channels:r}=t;let i="var o=item,datum=o.datum,m=0,$;";for(const s in r){const o="o["+UL(s)+"]";i+=`$=${r[s].code};if(${o}!==$)${o}=$,m=1;`}return i+=y$t(r,n),i+="return m;",mb(e,["item","_"],i)},codegen:{get(e){const t=`[${e.map(UL).join("][")}]`,n=Function("_",`return _${t};`);return n.path=t,n},comparator(e,t){let n;const r=(s,o)=>{const a=t[o];let u,l;return s.path?(u=`a${s.path}`,l=`b${s.path}`):((n=n||{})["f"+o]=s,u=`this.f${o}(a)`,l=`this.f${o}(b)`),v$t(u,l,-a,a)},i=Function("a","b","var u, v; return "+e.map(r).join("")+"0;");return n?i.bind(n):i}}};function $$t(e){const t=this;b$t(e.type)||!e.type?t.operator(e,e.update?t.operatorExpression(e.update):null):t.transform(e,e.type)}function C$t(e){const t=this;if(e.params){const n=t.get(e.id);n||op("Invalid operator id: "+e.id),t.dataflow.connect(n,n.parameters(t.parseParameters(e.params),e.react,e.initonly))}}function S$t(e,t){t=t||{};const n=this;for(const r in e){const i=e[r];t[r]=UU(i)?i.map(s=>cZ(s,n,t)):cZ(i,n,t)}return t}function cZ(e,t,n){if(!e||!jU(e))return e;for(let r=0,i=fZ.length,s;r<i;++r)if(s=fZ[r],h$t(e,s.key))return s.parse(e,t,n);return e}var fZ=[{key:"$ref",parse:k$t},{key:"$key",parse:_$t},{key:"$expr",parse:E$t},{key:"$field",parse:A$t},{key:"$encode",parse:I$t},{key:"$compare",parse:T$t},{key:"$context",parse:D$t},{key:"$subflow",parse:N$t},{key:"$tupleid",parse:F$t}];function k$t(e,t){return t.get(e.$ref)||op("Operator not defined: "+e.$ref)}function E$t(e,t,n){e.$params&&t.parseParameters(e.$params,n);const r="e:"+e.$expr.code;return t.fn[r]||(t.fn[r]=ul(t.parameterExpression(e.$expr),e.$fields))}function _$t(e,t){const n="k:"+e.$key+"_"+!!e.$flat;return t.fn[n]||(t.fn[n]=p$t(e.$key,e.$flat,t.expr.codegen))}function A$t(e,t){if(!e.$field)return null;const n="f:"+e.$field+"_"+e.$name;return t.fn[n]||(t.fn[n]=zU(e.$field,e.$name,t.expr.codegen))}function T$t(e,t){const n="c:"+e.$compare+"_"+e.$order,r=t2(e.$compare).map(i=>i&&i.$tupleid?Pe:i);return t.fn[n]||(t.fn[n]=a$t(r,e.$order,t.expr.codegen))}function I$t(e,t){const n=e.$encode,r={};for(const i in n){const s=n[i];r[i]=ul(t.encodeExpression(s.$expr),s.$fields),r[i].output=s.$output}return r}function D$t(e,t){return t}function N$t(e,t){const n=e.$subflow;return function(r,i,s){const o=t.fork().parse(n),a=o.get(n.operators[0].id),u=o.signals.parent;return u&&u.set(s),a.detachSubflow=()=>t.detach(o),a}}function F$t(){return Pe}function O$t(e){var t=this,n=e.filter!=null?t.eventExpression(e.filter):void 0,r=e.stream!=null?t.get(e.stream):void 0,i;e.source?r=t.events(e.source,e.type,n):e.merge&&(i=e.merge.map(s=>t.get(s)),r=i[0].merge.apply(i[0],i.slice(1))),e.between&&(i=e.between.map(s=>t.get(s)),r=r.between(i[0],i[1])),e.filter&&(r=r.filter(n)),e.throttle!=null&&(r=r.throttle(+e.throttle)),e.debounce!=null&&(r=r.debounce(+e.debounce)),r==null&&op("Invalid stream definition: "+JSON.stringify(e)),e.consume&&r.consume(!0),t.stream(e,r)}function R$t(e){var t=this,n=jU(n=e.source)?n.$ref:n,r=t.get(n),i=null,s=e.update,o=void 0;r||op("Source not defined: "+e.source),i=e.target&&e.target.$expr?t.eventExpression(e.target.$expr):t.get(e.target),s&&s.$expr&&(s.$params&&(o=t.parseParameters(s.$params)),s=t.handlerExpression(s.$expr)),t.update(e,r,i,s,o)}const M$t={skip:!0};function L$t(e){var t=this,n={};if(e.signals){var r=n.signals={};Object.keys(t.signals).forEach(s=>{const o=t.signals[s];e.signals(s,o)&&(r[s]=o.value)})}if(e.data){var i=n.data={};Object.keys(t.data).forEach(s=>{const o=t.data[s];e.data(s,o)&&(i[s]=o.input.value)})}return t.subcontext&&e.recurse!==!1&&(n.subcontext=t.subcontext.map(s=>s.getState(e))),n}function P$t(e){var t=this,n=t.dataflow,r=e.data,i=e.signals;Object.keys(i||{}).forEach(s=>{n.update(t.signals[s],i[s],M$t)}),Object.keys(r||{}).forEach(s=>{n.pulse(t.data[s].input,n.changeset().remove(i$t).insert(r[s]))}),(e.subcontext||[]).forEach((s,o)=>{const a=t.subcontext[o];a&&a.setState(s)})}function v1e(e,t,n,r){return new w1e(e,t,n,r)}function w1e(e,t,n,r){this.dataflow=e,this.transforms=t,this.events=e.events.bind(e),this.expr=r||w$t,this.signals={},this.scales={},this.nodes={},this.data={},this.fn={},n&&(this.functions=Object.create(n),this.functions.context=this)}function hZ(e){this.dataflow=e.dataflow,this.transforms=e.transforms,this.events=e.events,this.expr=e.expr,this.signals=Object.create(e.signals),this.scales=Object.create(e.scales),this.nodes=Object.create(e.nodes),this.data=Object.create(e.data),this.fn=Object.create(e.fn),e.functions&&(this.functions=Object.create(e.functions),this.functions.context=this)}w1e.prototype=hZ.prototype={fork(){const e=new hZ(this);return(this.subcontext||(this.subcontext=[])).push(e),e},detach(e){this.subcontext=this.subcontext.filter(n=>n!==e);const t=Object.keys(e.nodes);for(const n of t)e.nodes[n]._targets=null;for(const n of t)e.nodes[n].detach();e.nodes=null},get(e){return this.nodes[e]},set(e,t){return this.nodes[e]=t},add(e,t){const n=this,r=n.dataflow,i=e.value;if(n.set(e.id,t),x$t(e.type)&&i&&(i.$ingest?r.ingest(t,i.$ingest,i.$format):i.$request?r.preload(t,i.$request,i.$format):r.pulse(t,r.changeset().insert(i))),e.root&&(n.root=t),e.parent){let s=n.get(e.parent.$ref);s?(r.connect(s,[t]),t.targets().add(s)):(n.unresolved=n.unresolved||[]).push(()=>{s=n.get(e.parent.$ref),r.connect(s,[t]),t.targets().add(s)})}if(e.signal&&(n.signals[e.signal]=t),e.scale&&(n.scales[e.scale]=t),e.data)for(const s in e.data){const o=n.data[s]||(n.data[s]={});e.data[s].forEach(a=>o[a]=t)}},resolve(){return(this.unresolved||[]).forEach(e=>e()),delete this.unresolved,this},operator(e,t){this.add(e,this.dataflow.add(e.value,t))},transform(e,t){this.add(e,this.dataflow.add(this.transforms[WU(t)]))},stream(e,t){this.set(e.id,t)},update(e,t,n,r,i){this.dataflow.on(t,n,r,i,e.options)},operatorExpression(e){return this.expr.operator(this,e)},parameterExpression(e){return this.expr.parameter(this,e)},eventExpression(e){return this.expr.event(this,e)},handlerExpression(e){return this.expr.handler(this,e)},encodeExpression(e){return this.expr.encode(this,e)},parse:g$t,parseOperator:$$t,parseOperatorParameters:C$t,parseParameters:S$t,parseStream:O$t,parseUpdate:R$t,getState:L$t,setState:P$t};function B$t(e){const t=e.container();t&&(t.setAttribute("role","graphics-document"),t.setAttribute("aria-roleDescription","visualization"),$1e(t,e.description()))}function $1e(e,t){e&&(t==null?e.removeAttribute("aria-label"):e.setAttribute("aria-label",t))}function z$t(e){e.add(null,t=>(e._background=t.bg,e._resize=1,t.bg),{bg:e._signals.background})}const QO="default";function U$t(e){const t=e._signals.cursor||(e._signals.cursor=e.add({user:QO,item:null}));e.on(e.events("view","mousemove"),t,(n,r)=>{const i=t.value,s=i?mn(i)?i:i.user:QO,o=r.item&&r.item.cursor||null;return i&&s===i.user&&o==i.item?i:{user:s,item:o}}),e.add(null,function(n){let r=n.cursor,i=this.value;return mn(r)||(i=r.item,r=r.user),jL(e,r&&r!==QO?r:i||r),i},{cursor:t})}function jL(e,t){const n=e.globalCursor()?typeof document<"u"&&document.body:e.container();if(n)return t==null?n.style.removeProperty("cursor"):n.style.cursor=t}function G_(e,t){var n=e._runtime.data;return nt(n,t)||le("Unrecognized data set: "+t),n[t]}function j$t(e,t){return arguments.length<2?G_(this,e).values.value:RN.call(this,e,xg().remove(ny).insert(t))}function RN(e,t){Pue(t)||le("Second argument to changes must be a changeset.");const n=G_(this,e);return n.modified=!0,this.pulse(n.input,t)}function W$t(e,t){return RN.call(this,e,xg().insert(t))}function V$t(e,t){return RN.call(this,e,xg().remove(t))}function C1e(e){var t=e.padding();return Math.max(0,e._viewWidth+t.left+t.right)}function S1e(e){var t=e.padding();return Math.max(0,e._viewHeight+t.top+t.bottom)}function MN(e){var t=e.padding(),n=e._origin;return[t.left+n[0],t.top+n[1]]}function G$t(e){var t=MN(e),n=C1e(e),r=S1e(e);e._renderer.background(e.background()),e._renderer.resize(n,r,t),e._handler.origin(t),e._resizeListeners.forEach(i=>{try{i(n,r)}catch(s){e.error(s)}})}function H$t(e,t,n){var r=e._renderer,i=r&&r.canvas(),s,o,a;return i&&(a=MN(e),o=t.changedTouches?t.changedTouches[0]:t,s=hN(o,i),s[0]-=a[0],s[1]-=a[1]),t.dataflow=e,t.item=n,t.vega=q$t(e,n,s),t}function q$t(e,t,n){const r=t?t.mark.marktype==="group"?t:t.mark.group:null;function i(o){var a=r,u;if(o){for(u=t;u;u=u.mark.group)if(u.mark.name===o){a=u;break}}return a&&a.mark&&a.mark.interactive?a:{}}function s(o){if(!o)return n;mn(o)&&(o=i(o));const a=n.slice();for(;o;)a[0]-=o.x||0,a[1]-=o.y||0,o=o.mark&&o.mark.group;return a}return{view:Bo(e),item:Bo(t||{}),group:i,xy:s,x:o=>s(o)[0],y:o=>s(o)[1]}}const dZ="view",X$t="timer",Y$t="window",K$t={trap:!1};function Z$t(e){const t=yt({defaults:{}},e),n=(r,i)=>{i.forEach(s=>{it(r[s])&&(r[s]=cc(r[s]))})};return n(t.defaults,["prevent","allow"]),n(t,["view","window","selector"]),t}function k1e(e,t,n,r){e._eventListeners.push({type:n,sources:et(t),handler:r})}function J$t(e,t){var n=e._eventConfig.defaults,r=n.prevent,i=n.allow;return r===!1||i===!0?!1:r===!0||i===!1?!0:r?r[t]:i?!i[t]:e.preventDefault()}function kS(e,t,n){const r=e._eventConfig&&e._eventConfig[t];return r===!1||dt(r)&&!r[n]?(e.warn(`Blocked ${t} ${n} event listener.`),!1):!0}function Q$t(e,t,n){var r=this,i=new rD(n),s=function(l,c){r.runAsync(null,()=>{e===dZ&&J$t(r,t)&&l.preventDefault(),i.receive(H$t(r,l,c))})},o;if(e===X$t)kS(r,"timer",t)&&r.timer(s,t);else if(e===dZ)kS(r,"view",t)&&r.addEventListener(t,s,K$t);else if(e===Y$t?kS(r,"window",t)&&typeof window<"u"&&(o=[window]):typeof document<"u"&&kS(r,"selector",t)&&(o=document.querySelectorAll(e)),!o)r.warn("Can not resolve event source: "+e);else{for(var a=0,u=o.length;a<u;++a)o[a].addEventListener(t,s);k1e(r,o,t,s)}return i}function pZ(e){return e.item}function gZ(e){return e.item.mark.source}function mZ(e){return function(t,n){return n.vega.view().changeset().encode(n.item,e)}}function eCt(e,t){return e=[e||"hover"],t=[t||"update",e[0]],this.on(this.events("view","mouseover",pZ),gZ,mZ(e)),this.on(this.events("view","mouseout",pZ),gZ,mZ(t)),this}function tCt(){var e=this._tooltip,t=this._timers,n=this._eventListeners,r,i,s;for(r=t.length;--r>=0;)t[r].stop();for(r=n.length;--r>=0;)for(s=n[r],i=s.sources.length;--i>=0;)s.sources[i].removeEventListener(s.type,s.handler);return e&&e.call(this,this._handler,null,null,null),this}function eo(e,t,n){const r=document.createElement(e);for(const i in t)r.setAttribute(i,t[i]);return n!=null&&(r.textContent=n),r}const nCt="vega-bind",rCt="vega-bind-name",iCt="vega-bind-radio";function sCt(e,t,n){if(!t)return;const r=n.param;let i=n.state;return i||(i=n.state={elements:null,active:!1,set:null,update:o=>{o!=e.signal(r.signal)&&e.runAsync(null,()=>{i.source=!0,e.signal(r.signal,o)})}},r.debounce&&(i.update=Gae(r.debounce,i.update))),(r.input==null&&r.element?oCt:uCt)(i,t,r,e),i.active||(e.on(e._signals[r.signal],null,()=>{i.source?i.source=!1:i.set(e.signal(r.signal))}),i.active=!0),i}function oCt(e,t,n,r){const i=n.event||"input",s=()=>e.update(t.value);r.signal(n.signal,t.value),t.addEventListener(i,s),k1e(r,t,i,s),e.set=o=>{t.value=o,t.dispatchEvent(aCt(i))}}function aCt(e){return typeof Event<"u"?new Event(e):{type:e}}function uCt(e,t,n,r){const i=r.signal(n.signal),s=eo("div",{class:nCt}),o=n.input==="radio"?s:s.appendChild(eo("label"));o.appendChild(eo("span",{class:rCt},n.name||n.signal)),t.appendChild(s);let a=lCt;switch(n.input){case"checkbox":a=cCt;break;case"select":a=fCt;break;case"radio":a=hCt;break;case"range":a=dCt;break}a(e,o,n,i)}function lCt(e,t,n,r){const i=eo("input");for(const s in n)s!=="signal"&&s!=="element"&&i.setAttribute(s==="input"?"type":s,n[s]);i.setAttribute("name",n.signal),i.value=r,t.appendChild(i),i.addEventListener("input",()=>e.update(i.value)),e.elements=[i],e.set=s=>i.value=s}function cCt(e,t,n,r){const i={type:"checkbox",name:n.signal};r&&(i.checked=!0);const s=eo("input",i);t.appendChild(s),s.addEventListener("change",()=>e.update(s.checked)),e.elements=[s],e.set=o=>s.checked=!!o||null}function fCt(e,t,n,r){const i=eo("select",{name:n.signal}),s=n.labels||[];n.options.forEach((o,a)=>{const u={value:o};H_(o,r)&&(u.selected=!0),i.appendChild(eo("option",u,(s[a]||o)+""))}),t.appendChild(i),i.addEventListener("change",()=>{e.update(n.options[i.selectedIndex])}),e.elements=[i],e.set=o=>{for(let a=0,u=n.options.length;a<u;++a)if(H_(n.options[a],o)){i.selectedIndex=a;return}}}function hCt(e,t,n,r){const i=eo("span",{class:iCt}),s=n.labels||[];t.appendChild(i),e.elements=n.options.map((o,a)=>{const u={type:"radio",name:n.signal,value:o};H_(o,r)&&(u.checked=!0);const l=eo("input",u);l.addEventListener("change",()=>e.update(o));const c=eo("label",{},(s[a]||o)+"");return c.prepend(l),i.appendChild(c),l}),e.set=o=>{const a=e.elements,u=a.length;for(let l=0;l<u;++l)H_(a[l].value,o)&&(a[l].checked=!0)}}function dCt(e,t,n,r){r=r!==void 0?r:(+n.max+ +n.min)/2;const i=n.max!=null?n.max:Math.max(100,+r)||100,s=n.min||Math.min(0,i,+r)||0,o=n.step||Zf(s,i,100),a=eo("input",{type:"range",name:n.signal,min:s,max:i,step:o});a.value=r;const u=eo("span",{},+r);t.appendChild(a),t.appendChild(u);const l=()=>{u.textContent=a.value,e.update(+a.value)};a.addEventListener("input",l),a.addEventListener("change",l),e.elements=[a],e.set=c=>{a.value=c,u.textContent=c}}function H_(e,t){return e===t||e+""==t+""}function E1e(e,t,n,r,i,s){return t=t||new r(e.loader()),t.initialize(n,C1e(e),S1e(e),MN(e),i,s).background(e.background())}function VU(e,t){return t?function(){try{t.apply(this,arguments)}catch(n){e.error(n)}}:null}function pCt(e,t,n,r){const i=new r(e.loader(),VU(e,e.tooltip())).scene(e.scenegraph().root).initialize(n,MN(e),e);return t&&t.handlers().forEach(s=>{i.on(s.type,s.handler)}),i}function gCt(e,t){const n=this,r=n._renderType,i=n._eventConfig.bind,s=dN(r);e=n._el=e?eR(n,e,!0):null,B$t(n),s||n.error("Unrecognized renderer type: "+r);const o=s.handler||M$,a=e?s.renderer:s.headless;return n._renderer=a?E1e(n,n._renderer,e,a):null,n._handler=pCt(n,n._handler,e,o),n._redraw=!0,e&&i!=="none"&&(t=t?n._elBind=eR(n,t,!0):e.appendChild(eo("form",{class:"vega-bindings"})),n._bind.forEach(u=>{u.param.element&&i!=="container"&&(u.element=eR(n,u.param.element,!!u.param.input))}),n._bind.forEach(u=>{sCt(n,u.element||t,u)})),n}function eR(e,t,n){if(typeof t=="string")if(typeof document<"u"){if(t=document.querySelector(t),!t)return e.error("Signal bind element not found: "+t),null}else return e.error("DOM document instance not found."),null;if(t&&n)try{t.innerHTML=""}catch(r){t=null,e.error(r)}return t}const yb=e=>+e||0,mCt=e=>({top:e,bottom:e,left:e,right:e});function yZ(e){return dt(e)?{top:yb(e.top),bottom:yb(e.bottom),left:yb(e.left),right:yb(e.right)}:mCt(yb(e))}async function GU(e,t,n,r){const i=dN(t),s=i&&i.headless;return s||le("Unrecognized renderer type: "+t),await e.runAsync(),E1e(e,null,null,s,n,r).renderAsync(e._scenegraph.root)}async function yCt(e,t){e!==gf.Canvas&&e!==gf.SVG&&e!==gf.PNG&&le("Unrecognized image type: "+e);const n=await GU(this,e,t);return e===gf.SVG?bCt(n.svg(),"image/svg+xml"):n.canvas().toDataURL("image/png")}function bCt(e,t){const n=new Blob([e],{type:t});return window.URL.createObjectURL(n)}async function xCt(e,t){return(await GU(this,gf.Canvas,e,t)).canvas()}async function vCt(e){return(await GU(this,gf.SVG,e)).svg()}function wCt(e,t,n){return v1e(e,s0,e2,n).parse(t)}function $Ct(e){var t=this._runtime.scales;return nt(t,e)||le("Unrecognized scale or projection: "+e),t[e].value}var _1e="width",A1e="height",HU="padding",bZ={skip:!0};function T1e(e,t){var n=e.autosize(),r=e.padding();return t-(n&&n.contains===HU?r.left+r.right:0)}function I1e(e,t){var n=e.autosize(),r=e.padding();return t-(n&&n.contains===HU?r.top+r.bottom:0)}function CCt(e){var t=e._signals,n=t[_1e],r=t[A1e],i=t[HU];function s(){e._autosize=e._resize=1}e._resizeWidth=e.add(null,a=>{e._width=a.size,e._viewWidth=T1e(e,a.size),s()},{size:n}),e._resizeHeight=e.add(null,a=>{e._height=a.size,e._viewHeight=I1e(e,a.size),s()},{size:r});const o=e.add(null,s,{pad:i});e._resizeWidth.rank=n.rank+1,e._resizeHeight.rank=r.rank+1,o.rank=i.rank+1}function SCt(e,t,n,r,i,s){this.runAfter(o=>{let a=0;o._autosize=0,o.width()!==n&&(a=1,o.signal(_1e,n,bZ),o._resizeWidth.skip(!0)),o.height()!==r&&(a=1,o.signal(A1e,r,bZ),o._resizeHeight.skip(!0)),o._viewWidth!==e&&(o._resize=1,o._viewWidth=e),o._viewHeight!==t&&(o._resize=1,o._viewHeight=t),(o._origin[0]!==i[0]||o._origin[1]!==i[1])&&(o._resize=1,o._origin=i),a&&o.run("enter"),s&&o.runAfter(u=>u.resize())},!1,1)}function kCt(e){return this._runtime.getState(e||{data:ECt,signals:_Ct,recurse:!0})}function ECt(e,t){return t.modified&&it(t.input.value)&&e.indexOf("_:vega:_")}function _Ct(e,t){return!(e==="parent"||t instanceof s0.proxy)}function ACt(e){return this.runAsync(null,t=>{t._trigger=!1,t._runtime.setState(e)},t=>{t._trigger=!0}),this}function TCt(e,t){function n(r){e({timestamp:Date.now(),elapsed:r})}this._timers.push(pdt(n,t))}function ICt(e,t,n,r){const i=e.element();i&&i.setAttribute("title",DCt(r))}function DCt(e){return e==null?"":it(e)?D1e(e):dt(e)&&!qI(e)?NCt(e):e+""}function NCt(e){return Object.keys(e).map(t=>{const n=e[t];return t+": "+(it(n)?D1e(n):N1e(n))}).join(`
`)}function D1e(e){return"["+e.map(N1e).join(", ")+"]"}function N1e(e){return it(e)?"[]":dt(e)&&!qI(e)?"{}":e}function F1e(e,t){const n=this;if(t=t||{},Fm.call(n),t.loader&&n.loader(t.loader),t.logger&&n.logger(t.logger),t.logLevel!=null&&n.logLevel(t.logLevel),t.locale||e.locale){const s=yt({},e.locale,t.locale);n.locale(Yge(s.number,s.time))}n._el=null,n._elBind=null,n._renderType=t.renderer||gf.Canvas,n._scenegraph=new N9;const r=n._scenegraph.root;n._renderer=null,n._tooltip=t.tooltip||ICt,n._redraw=!0,n._handler=new M$().scene(r),n._globalCursor=!1,n._preventDefault=!1,n._timers=[],n._eventListeners=[],n._resizeListeners=[],n._eventConfig=Z$t(e.eventConfig),n.globalCursor(n._eventConfig.globalCursor);const i=wCt(n,e,t.expr);n._runtime=i,n._signals=i.signals,n._bind=(e.bindings||[]).map(s=>({state:null,param:yt({},s)})),i.root&&i.root.set(r),r.source=i.data.root.input,n.pulse(i.data.root.input,n.changeset().insert(r.items)),n._width=n.width(),n._height=n.height(),n._viewWidth=T1e(n,n._width),n._viewHeight=I1e(n,n._height),n._origin=[0,0],n._resize=0,n._autosize=1,CCt(n),z$t(n),U$t(n),n.description(e.description),t.hover&&n.hover(),t.container&&n.initialize(t.container,t.bind)}function ES(e,t){return nt(e._signals,t)?e._signals[t]:le("Unrecognized signal name: "+He(t))}function O1e(e,t){const n=(e._targets||[]).filter(r=>r._update&&r._update.handler===t);return n.length?n[0]:null}function xZ(e,t,n,r){let i=O1e(n,r);return i||(i=VU(e,()=>r(t,n.value)),i.handler=r,e.on(n,null,i)),e}function vZ(e,t,n){const r=O1e(t,n);return r&&t._targets.remove(r),e}$e(F1e,Fm,{async evaluate(e,t,n){if(await Fm.prototype.evaluate.call(this,e,t),this._redraw||this._resize)try{this._renderer&&(this._resize&&(this._resize=0,G$t(this)),await this._renderer.renderAsync(this._scenegraph.root)),this._redraw=!1}catch(r){this.error(r)}return n&&HS(this,n),this},dirty(e){this._redraw=!0,this._renderer&&this._renderer.dirty(e)},description(e){if(arguments.length){const t=e!=null?e+"":null;return t!==this._desc&&$1e(this._el,this._desc=t),this}return this._desc},container(){return this._el},scenegraph(){return this._scenegraph},origin(){return this._origin.slice()},signal(e,t,n){const r=ES(this,e);return arguments.length===1?r.value:this.update(r,t,n)},width(e){return arguments.length?this.signal("width",e):this.signal("width")},height(e){return arguments.length?this.signal("height",e):this.signal("height")},padding(e){return arguments.length?this.signal("padding",yZ(e)):yZ(this.signal("padding"))},autosize(e){return arguments.length?this.signal("autosize",e):this.signal("autosize")},background(e){return arguments.length?this.signal("background",e):this.signal("background")},renderer(e){return arguments.length?(dN(e)||le("Unrecognized renderer type: "+e),e!==this._renderType&&(this._renderType=e,this._resetRenderer()),this):this._renderType},tooltip(e){return arguments.length?(e!==this._tooltip&&(this._tooltip=e,this._resetRenderer()),this):this._tooltip},loader(e){return arguments.length?(e!==this._loader&&(Fm.prototype.loader.call(this,e),this._resetRenderer()),this):this._loader},resize(){return this._autosize=1,this.touch(ES(this,"autosize"))},_resetRenderer(){this._renderer&&(this._renderer=null,this.initialize(this._el,this._elBind))},_resizeView:SCt,addEventListener(e,t,n){let r=t;return n&&n.trap===!1||(r=VU(this,t),r.raw=t),this._handler.on(e,r),this},removeEventListener(e,t){for(var n=this._handler.handlers(e),r=n.length,i,s;--r>=0;)if(s=n[r].type,i=n[r].handler,e===s&&(t===i||t===i.raw)){this._handler.off(s,i);break}return this},addResizeListener(e){const t=this._resizeListeners;return t.indexOf(e)<0&&t.push(e),this},removeResizeListener(e){var t=this._resizeListeners,n=t.indexOf(e);return n>=0&&t.splice(n,1),this},addSignalListener(e,t){return xZ(this,e,ES(this,e),t)},removeSignalListener(e,t){return vZ(this,ES(this,e),t)},addDataListener(e,t){return xZ(this,e,G_(this,e).values,t)},removeDataListener(e,t){return vZ(this,G_(this,e).values,t)},globalCursor(e){if(arguments.length){if(this._globalCursor!==!!e){const t=jL(this,null);this._globalCursor=!!e,t&&jL(this,t)}return this}else return this._globalCursor},preventDefault(e){return arguments.length?(this._preventDefault=e,this):this._preventDefault},timer:TCt,events:Q$t,finalize:tCt,hover:eCt,data:j$t,change:RN,insert:W$t,remove:V$t,scale:$Ct,initialize:gCt,toImageURL:yCt,toCanvas:xCt,toSVG:vCt,getState:kCt,setState:ACt});const FCt="view",q_="[",X_="]",R1e="{",M1e="}",OCt=":",L1e=",",RCt="@",MCt=">",LCt=/[[\]{}]/,PCt={"*":1,arc:1,area:1,group:1,image:1,line:1,path:1,rect:1,rule:1,shape:1,symbol:1,text:1,trail:1};let P1e,B1e;function BCt(e,t,n){return P1e=t||FCt,B1e=n||PCt,z1e(e.trim()).map(WL)}function zCt(e){return B1e[e]}function kx(e,t,n,r,i){const s=e.length;let o=0,a;for(;t<s;++t){if(a=e[t],!o&&a===n)return t;i&&i.indexOf(a)>=0?--o:r&&r.indexOf(a)>=0&&++o}return t}function z1e(e){const t=[],n=e.length;let r=0,i=0;for(;i<n;)i=kx(e,i,L1e,q_+R1e,X_+M1e),t.push(e.substring(r,i).trim()),r=++i;if(t.length===0)throw"Empty event selector: "+e;return t}function WL(e){return e[0]==="["?UCt(e):jCt(e)}function UCt(e){const t=e.length;let n=1,r;if(n=kx(e,n,X_,q_,X_),n===t)throw"Empty between selector: "+e;if(r=z1e(e.substring(1,n)),r.length!==2)throw"Between selector must have two elements: "+e;if(e=e.slice(n+1).trim(),e[0]!==MCt)throw"Expected '>' after between selector: "+e;r=r.map(WL);const i=WL(e.slice(1).trim());return i.between?{between:r,stream:i}:(i.between=r,i)}function jCt(e){const t={source:P1e},n=[];let r=[0,0],i=0,s=0,o=e.length,a=0,u,l;if(e[o-1]===M1e){if(a=e.lastIndexOf(R1e),a>=0){try{r=WCt(e.substring(a+1,o-1))}catch{throw"Invalid throttle specification: "+e}e=e.slice(0,a).trim(),o=e.length}else throw"Unmatched right brace: "+e;a=0}if(!o)throw e;if(e[0]===RCt&&(i=++a),u=kx(e,a,OCt),u<o&&(n.push(e.substring(s,u).trim()),s=a=++u),a=kx(e,a,q_),a===o)n.push(e.substring(s,o).trim());else if(n.push(e.substring(s,a).trim()),l=[],s=++a,s===o)throw"Unmatched left bracket: "+e;for(;a<o;){if(a=kx(e,a,X_),a===o)throw"Unmatched left bracket: "+e;if(l.push(e.substring(s,a).trim()),a<o-1&&e[++a]!==q_)throw"Expected left bracket: "+e;s=++a}if(!(o=n.length)||LCt.test(n[o-1]))throw"Invalid event selector: "+e;return o>1?(t.type=n[1],i?t.markname=n[0].slice(1):zCt(n[0])?t.marktype=n[0]:t.source=n[0]):t.type=n[0],t.type.slice(-1)==="!"&&(t.consume=!0,t.type=t.type.slice(0,-1)),l!=null&&(t.filter=l),r[0]&&(t.throttle=r[0]),r[1]&&(t.debounce=r[1]),t}function WCt(e){const t=e.split(L1e);if(!e.length||t.length>2)throw e;return t.map(n=>{const r=+n;if(r!==r)throw e;return r})}function VCt(e){return dt(e)?e:{type:e||"pad"}}const bb=e=>+e||0,GCt=e=>({top:e,bottom:e,left:e,right:e});function HCt(e){return dt(e)?e.signal?e:{top:bb(e.top),bottom:bb(e.bottom),left:bb(e.left),right:bb(e.right)}:GCt(bb(e))}const _r=e=>dt(e)&&!it(e)?yt({},e):{value:e};function wZ(e,t,n,r){return n!=null?(dt(n)&&!it(n)||it(n)&&n.length&&dt(n[0])?e.update[t]=n:e[r||"enter"][t]={value:n},1):0}function Zr(e,t,n){for(const r in t)wZ(e,r,t[r]);for(const r in n)wZ(e,r,n[r],"update")}function ky(e,t,n){for(const r in t)n&&nt(n,r)||(e[r]=yt(e[r]||{},t[r]));return e}function mm(e,t){return t&&(t.enter&&t.enter[e]||t.update&&t.update[e])}const qU="mark",XU="frame",YU="scope",qCt="axis",XCt="axis-domain",YCt="axis-grid",KCt="axis-label",ZCt="axis-tick",JCt="axis-title",QCt="legend",eSt="legend-band",tSt="legend-entry",nSt="legend-gradient",U1e="legend-label",rSt="legend-symbol",iSt="legend-title",sSt="title",oSt="title-text",aSt="title-subtitle";function uSt(e,t,n,r,i){const s={},o={};let a,u,l,c;u="lineBreak",t==="text"&&i[u]!=null&&!mm(u,e)&&tR(s,u,i[u]),(n=="legend"||String(n).startsWith("axis"))&&(n=null),c=n===XU?i.group:n===qU?yt({},i.mark,i[t]):null;for(u in c)l=mm(u,e)||(u==="fill"||u==="stroke")&&(mm("fill",e)||mm("stroke",e)),l||tR(s,u,c[u]);et(r).forEach(f=>{const h=i.style&&i.style[f];for(const d in h)mm(d,e)||tR(s,d,h[d])}),e=yt({},e);for(u in s)c=s[u],c.signal?(a=a||{})[u]=c:o[u]=c;return e.enter=yt(o,e.enter),a&&(e.update=yt(a,e.update)),e}function tR(e,t,n){e[t]=n&&n.signal?{signal:n.signal}:{value:n}}const j1e=e=>mn(e)?He(e):e.signal?`(${e.signal})`:W1e(e);function LN(e){if(e.gradient!=null)return cSt(e);let t=e.signal?`(${e.signal})`:e.color?lSt(e.color):e.field!=null?W1e(e.field):e.value!==void 0?He(e.value):void 0;return e.scale!=null&&(t=fSt(e,t)),t===void 0&&(t=null),e.exponent!=null&&(t=`pow(${t},${mk(e.exponent)})`),e.mult!=null&&(t+=`*${mk(e.mult)}`),e.offset!=null&&(t+=`+${mk(e.offset)}`),e.round&&(t=`round(${t})`),t}const _S=(e,t,n,r)=>`(${e}(${[t,n,r].map(LN).join(",")})+'')`;function lSt(e){return e.c?_S("hcl",e.h,e.c,e.l):e.h||e.s?_S("hsl",e.h,e.s,e.l):e.l||e.a?_S("lab",e.l,e.a,e.b):e.r||e.g||e.b?_S("rgb",e.r,e.g,e.b):null}function cSt(e){const t=[e.start,e.stop,e.count].map(n=>n==null?null:He(n));for(;t.length&&Kt(t)==null;)t.pop();return t.unshift(j1e(e.gradient)),`gradient(${t.join(",")})`}function mk(e){return dt(e)?"("+LN(e)+")":e}function W1e(e){return V1e(dt(e)?e:{datum:e})}function V1e(e){let t,n,r;if(e.signal)t="datum",r=e.signal;else if(e.group||e.parent){for(n=Math.max(1,e.level||1),t="item";n-- >0;)t+=".mark.group";e.parent?(r=e.parent,t+=".datum"):r=e.group}else e.datum?(t="datum",r=e.datum):le("Invalid field reference: "+He(e));return e.signal||(r=mn(r)?UI(r).map(He).join("]["):V1e(r)),t+"["+r+"]"}function fSt(e,t){const n=j1e(e.scale);return e.range!=null?t=`lerp(_range(${n}), ${+e.range})`:(t!==void 0&&(t=`_scale(${n}, ${t})`),e.band&&(t=(t?t+"+":"")+`_bandwidth(${n})`+(+e.band==1?"":"*"+mk(e.band)),e.extra&&(t=`(datum.extra ? _scale(${n}, datum.extra.value) : ${t})`)),t==null&&(t="0")),t}function hSt(e){let t="";return e.forEach(n=>{const r=LN(n);t+=n.test?`(${n.test})?${r}:`:r}),Kt(t)===":"&&(t+="null"),t}function G1e(e,t,n,r,i,s){const o={};s=s||{},s.encoders={$encode:o},e=uSt(e,t,n,r,i.config);for(const a in e)o[a]=dSt(e[a],t,s,i);return s}function dSt(e,t,n,r){const i={},s={};for(const o in e)e[o]!=null&&(i[o]=gSt(pSt(e[o]),r,n,s));return{$expr:{marktype:t,channels:i},$fields:Object.keys(s),$output:Object.keys(e)}}function pSt(e){return it(e)?hSt(e):LN(e)}function gSt(e,t,n,r){const i=Gu(e,t);return i.$fields.forEach(s=>r[s]=1),yt(n,i.$params),i.$expr}const mSt="outer",ySt=["value","update","init","react","bind"];function $Z(e,t){le(e+' for "outer" push: '+He(t))}function H1e(e,t){const n=e.name;if(e.push===mSt)t.signals[n]||$Z("No prior signal definition",n),ySt.forEach(r=>{e[r]!==void 0&&$Z("Invalid property ",r)});else{const r=t.addSignal(n,e.value);e.react===!1&&(r.react=!1),e.bind&&t.addBinding(n,e.bind)}}function VL(e,t,n,r){this.id=-1,this.type=e,this.value=t,this.params=n,r&&(this.parent=r)}function PN(e,t,n,r){return new VL(e,t,n,r)}function Y_(e,t){return PN("operator",e,t)}function Le(e){const t={$ref:e.id};return e.id<0&&(e.refs=e.refs||[]).push(t),t}function n2(e,t){return t?{$field:e,$name:t}:{$field:e}}const GL=n2("key");function CZ(e,t){return{$compare:e,$order:t}}function bSt(e,t){const n={$key:e};return t&&(n.$flat=!0),n}const xSt="ascending",vSt="descending";function wSt(e){return dt(e)?(e.order===vSt?"-":"+")+BN(e.op,e.field):""}function BN(e,t){return(e&&e.signal?"$"+e.signal:e||"")+(e&&t?"_":"")+(t&&t.signal?"$"+t.signal:t||"")}const KU="scope",HL="view";function cr(e){return e&&e.signal}function $St(e){return e&&e.expr}function yk(e){if(cr(e))return!0;if(dt(e)){for(const t in e)if(yk(e[t]))return!0}return!1}function la(e,t){return e??t}function ap(e){return e&&e.signal||e}const SZ="timer";function r2(e,t){return(e.merge?SSt:e.stream?kSt:e.type?ESt:le("Invalid stream specification: "+He(e)))(e,t)}function CSt(e){return e===KU?HL:e||HL}function SSt(e,t){const n=e.merge.map(i=>r2(i,t)),r=ZU({merge:n},e,t);return t.addStream(r).id}function kSt(e,t){const n=r2(e.stream,t),r=ZU({stream:n},e,t);return t.addStream(r).id}function ESt(e,t){let n;e.type===SZ?(n=t.event(SZ,e.throttle),e={between:e.between,filter:e.filter}):n=t.event(CSt(e.source),e.type);const r=ZU({stream:n},e,t);return Object.keys(r).length===1?n:t.addStream(r).id}function ZU(e,t,n){let r=t.between;return r&&(r.length!==2&&le('Stream "between" parameter must have 2 entries: '+He(t)),e.between=[r2(r[0],n),r2(r[1],n)]),r=t.filter?[].concat(t.filter):[],(t.marktype||t.markname||t.markrole)&&r.push(_St(t.marktype,t.markname,t.markrole)),t.source===KU&&r.push("inScope(event.item)"),r.length&&(e.filter=Gu("("+r.join(")&&(")+")",n).$expr),(r=t.throttle)!=null&&(e.throttle=+r),(r=t.debounce)!=null&&(e.debounce=+r),t.consume&&(e.consume=!0),e}function _St(e,t,n){const r="event.item";return r+(e&&e!=="*"?"&&"+r+".mark.marktype==='"+e+"'":"")+(n?"&&"+r+".mark.role==='"+n+"'":"")+(t?"&&"+r+".mark.name==='"+t+"'":"")}const ASt={code:"_.$value",ast:{type:"Identifier",value:"value"}};function TSt(e,t,n){const r=e.encode,i={target:n};let s=e.events,o=e.update,a=[];s||le("Signal update missing events specification."),mn(s)&&(s=BCt(s,t.isSubscope()?KU:HL)),s=et(s).filter(u=>u.signal||u.scale?(a.push(u),0):1),a.length>1&&(a=[DSt(a)]),s.length&&a.push(s.length>1?{merge:s}:s[0]),r!=null&&(o&&le("Signal encode and update are mutually exclusive."),o="encode(item(),"+He(r)+")"),i.update=mn(o)?Gu(o,t):o.expr!=null?Gu(o.expr,t):o.value!=null?o.value:o.signal!=null?{$expr:ASt,$params:{$value:t.signalRef(o.signal)}}:le("Invalid signal update specification."),e.force&&(i.options={force:!0}),a.forEach(u=>t.addUpdate(yt(ISt(u,t),i)))}function ISt(e,t){return{source:e.signal?t.signalRef(e.signal):e.scale?t.scaleRef(e.scale):r2(e,t)}}function DSt(e){return{signal:"["+e.map(t=>t.scale?'scale("'+t.scale+'")':t.signal)+"]"}}function NSt(e,t){const n=t.getSignal(e.name);let r=e.update;e.init&&(r?le("Signals can not include both init and update expressions."):(r=e.init,n.initonly=!0)),r&&(r=Gu(r,t),n.update=r.$expr,n.params=r.$params),e.on&&e.on.forEach(i=>TSt(i,t,n.id))}const Zt=e=>(t,n,r)=>PN(e,n,t||void 0,r),q1e=Zt("aggregate"),FSt=Zt("axisticks"),X1e=Zt("bound"),Ga=Zt("collect"),kZ=Zt("compare"),OSt=Zt("datajoin"),Y1e=Zt("encode"),RSt=Zt("expression"),MSt=Zt("facet"),LSt=Zt("field"),PSt=Zt("key"),BSt=Zt("legendentries"),zSt=Zt("load"),USt=Zt("mark"),jSt=Zt("multiextent"),WSt=Zt("multivalues"),VSt=Zt("overlap"),GSt=Zt("params"),K1e=Zt("prefacet"),HSt=Zt("projection"),qSt=Zt("proxy"),XSt=Zt("relay"),Z1e=Zt("render"),YSt=Zt("scale"),Rg=Zt("sieve"),KSt=Zt("sortitems"),J1e=Zt("viewlayout"),ZSt=Zt("values");let JSt=0;const Q1e={min:"min",max:"max",count:"sum"};function QSt(e,t){const n=e.type||"linear";Rde(n)||le("Unrecognized scale type: "+He(n)),t.addScale(e.name,{type:n,domain:void 0})}function ekt(e,t){const n=t.getScale(e.name).params;let r;n.domain=eye(e.domain,e,t),e.range!=null&&(n.range=nye(e,t,n)),e.interpolate!=null&&ckt(e.interpolate,n),e.nice!=null&&(n.nice=lkt(e.nice)),e.bins!=null&&(n.bins=ukt(e.bins,t));for(r in e)nt(n,r)||r==="name"||(n[r]=Do(e[r],t))}function Do(e,t){return dt(e)?e.signal?t.signalRef(e.signal):le("Unsupported object: "+He(e)):e}function bk(e,t){return e.signal?t.signalRef(e.signal):e.map(n=>Do(n,t))}function zN(e){le("Can not find data set: "+He(e))}function eye(e,t,n){if(!e){(t.domainMin!=null||t.domainMax!=null)&&le("No scale domain defined for domainMin/domainMax to override.");return}return e.signal?n.signalRef(e.signal):(it(e)?tkt:e.fields?rkt:nkt)(e,t,n)}function tkt(e,t,n){return e.map(r=>Do(r,n))}function nkt(e,t,n){const r=n.getData(e.data);return r||zN(e.data),w0(t.type)?r.valuesRef(n,e.field,tye(e.sort,!1)):Pde(t.type)?r.domainRef(n,e.field):r.extentRef(n,e.field)}function rkt(e,t,n){const r=e.data,i=e.fields.reduce((s,o)=>(o=mn(o)?{data:r,field:o}:it(o)||o.signal?ikt(o,n):o,s.push(o),s),[]);return(w0(t.type)?skt:Pde(t.type)?okt:akt)(e,n,i)}function ikt(e,t){const n="_:vega:_"+JSt++,r=Ga({});if(it(e))r.value={$ingest:e};else if(e.signal){const i="setdata("+He(n)+","+e.signal+")";r.params.input=t.signalRef(i)}return t.addDataPipeline(n,[r,Rg({})]),{data:n,field:"data"}}function skt(e,t,n){const r=tye(e.sort,!0);let i,s;const o=n.map(l=>{const c=t.getData(l.data);return c||zN(l.data),c.countsRef(t,l.field,r)}),a={groupby:GL,pulse:o};r&&(i=r.op||"count",s=r.field?BN(i,r.field):"count",a.ops=[Q1e[i]],a.fields=[t.fieldRef(s)],a.as=[s]),i=t.add(q1e(a));const u=t.add(Ga({pulse:Le(i)}));return s=t.add(ZSt({field:GL,sort:t.sortRef(r),pulse:Le(u)})),Le(s)}function tye(e,t){return e&&(!e.field&&!e.op?dt(e)?e.field="key":e={field:"key"}:!e.field&&e.op!=="count"?le("No field provided for sort aggregate op: "+e.op):t&&e.field&&e.op&&!Q1e[e.op]&&le("Multiple domain scales can not be sorted using "+e.op)),e}function okt(e,t,n){const r=n.map(i=>{const s=t.getData(i.data);return s||zN(i.data),s.domainRef(t,i.field)});return Le(t.add(WSt({values:r})))}function akt(e,t,n){const r=n.map(i=>{const s=t.getData(i.data);return s||zN(i.data),s.extentRef(t,i.field)});return Le(t.add(jSt({extents:r})))}function ukt(e,t){return e.signal||it(e)?bk(e,t):t.objectProperty(e)}function lkt(e){return dt(e)?{interval:Do(e.interval),step:Do(e.step)}:Do(e)}function ckt(e,t){t.interpolate=Do(e.type||e),e.gamma!=null&&(t.interpolateGamma=Do(e.gamma))}function nye(e,t,n){const r=t.config.range;let i=e.range;if(i.signal)return t.signalRef(i.signal);if(mn(i)){if(r&&nt(r,i))return e=yt({},e,{range:r[i]}),nye(e,t,n);i==="width"?i=[0,{signal:"width"}]:i==="height"?i=w0(e.type)?[0,{signal:"height"}]:[{signal:"height"},0]:le("Unrecognized scale range value: "+He(i))}else if(i.scheme){n.scheme=it(i.scheme)?bk(i.scheme,t):Do(i.scheme,t),i.extent&&(n.schemeExtent=bk(i.extent,t)),i.count&&(n.schemeCount=Do(i.count,t));return}else if(i.step){n.rangeStep=Do(i.step,t);return}else{if(w0(e.type)&&!it(i))return eye(i,e,t);it(i)||le("Unsupported range type: "+He(i))}return i.map(s=>(it(s)?bk:Do)(s,t))}function fkt(e,t){const n=t.config.projection||{},r={};for(const i in e)i!=="name"&&(r[i]=qL(e[i],i,t));for(const i in n)r[i]==null&&(r[i]=qL(n[i],i,t));t.addProjection(e.name,r)}function qL(e,t,n){return it(e)?e.map(r=>qL(r,t,n)):dt(e)?e.signal?n.signalRef(e.signal):t==="fit"?e:le("Unsupported parameter object: "+He(e)):e}const Ha="top",Ey="left",_y="right",gh="bottom",rye="center",hkt="vertical",dkt="start",pkt="middle",gkt="end",XL="index",JU="label",mkt="offset",R0="perc",ykt="perc2",Ro="value",H$="guide-label",QU="guide-title",bkt="group-title",xkt="group-subtitle",EZ="symbol",xk="gradient",YL="discrete",KL="size",vkt="shape",wkt="fill",$kt="stroke",Ckt="strokeWidth",Skt="strokeDash",kkt="opacity",ej=[KL,vkt,wkt,$kt,Ckt,Skt,kkt],q$={name:1,style:1,interactive:1},$t={value:0},Mo={value:1},UN="group",iye="rect",tj="rule",Ekt="symbol",Mg="text";function i2(e){return e.type=UN,e.interactive=e.interactive||!1,e}function Us(e,t){const n=(r,i)=>la(e[r],la(t[r],i));return n.isVertical=r=>hkt===la(e.direction,t.direction||(r?t.symbolDirection:t.gradientDirection)),n.gradientLength=()=>la(e.gradientLength,t.gradientLength||t.gradientWidth),n.gradientThickness=()=>la(e.gradientThickness,t.gradientThickness||t.gradientHeight),n.entryColumns=()=>la(e.columns,la(t.columns,+n.isVertical(!0))),n}function sye(e,t){const n=t&&(t.update&&t.update[e]||t.enter&&t.enter[e]);return n&&n.signal?n:n?n.value:null}function _kt(e,t,n){const r=t.config.style[n];return r&&r[e]}function jN(e,t,n){return`item.anchor === '${dkt}' ? ${e} : item.anchor === '${gkt}' ? ${t} : ${n}`}const nj=jN(He(Ey),He(_y),He(rye));function Akt(e){const t=e("tickBand");let n=e("tickOffset"),r,i;return t?t.signal?(r={signal:`(${t.signal}) === 'extent' ? 1 : 0.5`},i={signal:`(${t.signal}) === 'extent'`},dt(n)||(n={signal:`(${t.signal}) === 'extent' ? 0 : ${n}`})):t==="extent"?(r=1,i=!0,n=0):(r=.5,i=!1):(r=e("bandPosition"),i=e("tickExtra")),{extra:i,band:r,offset:n}}function oye(e,t){return t?e?dt(e)?Object.assign({},e,{offset:oye(e.offset,t)}):{value:e,offset:t}:t:e}function uo(e,t){return t?(e.name=t.name,e.style=t.style||e.style,e.interactive=!!t.interactive,e.encode=ky(e.encode,t,q$)):e.interactive=!1,e}function Tkt(e,t,n,r){const i=Us(e,n),s=i.isVertical(),o=i.gradientThickness(),a=i.gradientLength();let u,l,c,f,h;s?(l=[0,1],c=[0,0],f=o,h=a):(l=[0,0],c=[1,0],f=a,h=o);const d={enter:u={opacity:$t,x:$t,y:$t,width:_r(f),height:_r(h)},update:yt({},u,{opacity:Mo,fill:{gradient:t,start:l,stop:c}}),exit:{opacity:$t}};return Zr(d,{stroke:i("gradientStrokeColor"),strokeWidth:i("gradientStrokeWidth")},{opacity:i("gradientOpacity")}),uo({type:iye,role:nSt,encode:d},r)}function Ikt(e,t,n,r,i){const s=Us(e,n),o=s.isVertical(),a=s.gradientThickness(),u=s.gradientLength();let l,c,f,h,d="";o?(l="y",f="y2",c="x",h="width",d="1-"):(l="x",f="x2",c="y",h="height");const p={opacity:$t,fill:{scale:t,field:Ro}};p[l]={signal:d+"datum."+R0,mult:u},p[c]=$t,p[f]={signal:d+"datum."+ykt,mult:u},p[h]=_r(a);const g={enter:p,update:yt({},p,{opacity:Mo}),exit:{opacity:$t}};return Zr(g,{stroke:s("gradientStrokeColor"),strokeWidth:s("gradientStrokeWidth")},{opacity:s("gradientOpacity")}),uo({type:iye,role:eSt,key:Ro,from:i,encode:g},r)}const Dkt=`datum.${R0}<=0?"${Ey}":datum.${R0}>=1?"${_y}":"${rye}"`,Nkt=`datum.${R0}<=0?"${gh}":datum.${R0}>=1?"${Ha}":"${pkt}"`;function _Z(e,t,n,r){const i=Us(e,t),s=i.isVertical(),o=_r(i.gradientThickness()),a=i.gradientLength();let u=i("labelOverlap"),l,c,f,h,d="";const p={enter:l={opacity:$t},update:c={opacity:Mo,text:{field:JU}},exit:{opacity:$t}};return Zr(p,{fill:i("labelColor"),fillOpacity:i("labelOpacity"),font:i("labelFont"),fontSize:i("labelFontSize"),fontStyle:i("labelFontStyle"),fontWeight:i("labelFontWeight"),limit:la(e.labelLimit,t.gradientLabelLimit)}),s?(l.align={value:"left"},l.baseline=c.baseline={signal:Nkt},f="y",h="x",d="1-"):(l.align=c.align={signal:Dkt},l.baseline={value:"top"},f="x",h="y"),l[f]=c[f]={signal:d+"datum."+R0,mult:a},l[h]=c[h]=o,o.offset=la(e.labelOffset,t.gradientLabelOffset)||0,u=u?{separation:i("labelSeparation"),method:u,order:"datum."+XL}:void 0,uo({type:Mg,role:U1e,style:H$,key:Ro,from:r,encode:p,overlap:u},n)}function Fkt(e,t,n,r,i){const s=Us(e,t),o=n.entries,a=!!(o&&o.interactive),u=o?o.name:void 0,l=s("clipHeight"),c=s("symbolOffset"),f={data:"value"},h=`(${i}) ? datum.${mkt} : datum.${KL}`,d=l?_r(l):{field:KL},p=`datum.${XL}`,g=`max(1, ${i})`;let m,y,b,v,x;d.mult=.5,m={enter:y={opacity:$t,x:{signal:h,mult:.5,offset:c},y:d},update:b={opacity:Mo,x:y.x,y:y.y},exit:{opacity:$t}};let w=null,C=null;e.fill||(w=t.symbolBaseFillColor,C=t.symbolBaseStrokeColor),Zr(m,{fill:s("symbolFillColor",w),shape:s("symbolType"),size:s("symbolSize"),stroke:s("symbolStrokeColor",C),strokeDash:s("symbolDash"),strokeDashOffset:s("symbolDashOffset"),strokeWidth:s("symbolStrokeWidth")},{opacity:s("symbolOpacity")}),ej.forEach(E=>{e[E]&&(b[E]=y[E]={scale:e[E],field:Ro})});const $=uo({type:Ekt,role:rSt,key:Ro,from:f,clip:l?!0:void 0,encode:m},n.symbols),S=_r(c);S.offset=s("labelOffset"),m={enter:y={opacity:$t,x:{signal:h,offset:S},y:d},update:b={opacity:Mo,text:{field:JU},x:y.x,y:y.y},exit:{opacity:$t}},Zr(m,{align:s("labelAlign"),baseline:s("labelBaseline"),fill:s("labelColor"),fillOpacity:s("labelOpacity"),font:s("labelFont"),fontSize:s("labelFontSize"),fontStyle:s("labelFontStyle"),fontWeight:s("labelFontWeight"),limit:s("labelLimit")});const k=uo({type:Mg,role:U1e,style:H$,key:Ro,from:f,encode:m},n.labels);return m={enter:{noBound:{value:!l},width:$t,height:l?_r(l):$t,opacity:$t},exit:{opacity:$t},update:b={opacity:Mo,row:{signal:null},column:{signal:null}}},s.isVertical(!0)?(v=`ceil(item.mark.items.length / ${g})`,b.row.signal=`${p}%${v}`,b.column.signal=`floor(${p} / ${v})`,x={field:["row",p]}):(b.row.signal=`floor(${p} / ${g})`,b.column.signal=`${p} % ${g}`,x={field:p}),b.column.signal=`(${i})?${b.column.signal}:${p}`,r={facet:{data:r,name:"value",groupby:XL}},i2({role:YU,from:r,encode:ky(m,o,q$),marks:[$,k],name:u,interactive:a,sort:x})}function Okt(e,t){const n=Us(e,t);return{align:n("gridAlign"),columns:n.entryColumns(),center:{row:!0,column:!1},padding:{row:n("rowPadding"),column:n("columnPadding")}}}const rj='item.orient === "left"',ij='item.orient === "right"',WN=`(${rj} || ${ij})`,Rkt=`datum.vgrad && ${WN}`,Mkt=jN('"top"','"bottom"','"middle"'),Lkt=jN('"right"','"left"','"center"'),Pkt=`datum.vgrad && ${ij} ? (${Lkt}) : (${WN} && !(datum.vgrad && ${rj})) ? "left" : ${nj}`,Bkt=`item._anchor || (${WN} ? "middle" : "start")`,zkt=`${Rkt} ? (${rj} ? -90 : 90) : 0`,Ukt=`${WN} ? (datum.vgrad ? (${ij} ? "bottom" : "top") : ${Mkt}) : "top"`;function jkt(e,t,n,r){const i=Us(e,t),s={enter:{opacity:$t},update:{opacity:Mo,x:{field:{group:"padding"}},y:{field:{group:"padding"}}},exit:{opacity:$t}};return Zr(s,{orient:i("titleOrient"),_anchor:i("titleAnchor"),anchor:{signal:Bkt},angle:{signal:zkt},align:{signal:Pkt},baseline:{signal:Ukt},text:e.title,fill:i("titleColor"),fillOpacity:i("titleOpacity"),font:i("titleFont"),fontSize:i("titleFontSize"),fontStyle:i("titleFontStyle"),fontWeight:i("titleFontWeight"),limit:i("titleLimit"),lineHeight:i("titleLineHeight")},{align:i("titleAlign"),baseline:i("titleBaseline")}),uo({type:Mg,role:iSt,style:QU,from:r,encode:s},n)}function Wkt(e,t){let n;return dt(e)&&(e.signal?n=e.signal:e.path?n="pathShape("+AZ(e.path)+")":e.sphere&&(n="geoShape("+AZ(e.sphere)+', {type: "Sphere"})')),n?t.signalRef(n):!!e}function AZ(e){return dt(e)&&e.signal?e.signal:He(e)}function aye(e){const t=e.role||"";return!t.indexOf("axis")||!t.indexOf("legend")||!t.indexOf("title")?t:e.type===UN?YU:t||qU}function Vkt(e){return{marktype:e.type,name:e.name||void 0,role:e.role||aye(e),zindex:+e.zindex||void 0,aria:e.aria,description:e.description}}function Gkt(e,t){return e&&e.signal?t.signalRef(e.signal):e!==!1}function sj(e,t){const n=Uue(e.type);n||le("Unrecognized transform type: "+He(e.type));const r=PN(n.type.toLowerCase(),null,uye(n,e,t));return e.signal&&t.addSignal(e.signal,t.proxy(r)),r.metadata=n.metadata||{},r}function uye(e,t,n){const r={},i=e.params.length;for(let s=0;s<i;++s){const o=e.params[s];r[o.name]=Hkt(o,t,n)}return r}function Hkt(e,t,n){const r=e.type,i=t[e.name];if(r==="index")return qkt(e,t,n);if(i===void 0){e.required&&le("Missing required "+He(t.type)+" parameter: "+He(e.name));return}else{if(r==="param")return Xkt(e,t,n);if(r==="projection")return n.projectionRef(t[e.name])}return e.array&&!cr(i)?i.map(s=>TZ(e,s,n)):TZ(e,i,n)}function TZ(e,t,n){const r=e.type;if(cr(t))return DZ(r)?le("Expression references can not be signals."):nR(r)?n.fieldRef(t):NZ(r)?n.compareRef(t):n.signalRef(t.signal);{const i=e.expr||nR(r);return i&&Ykt(t)?n.exprRef(t.expr,t.as):i&&Kkt(t)?n2(t.field,t.as):DZ(r)?Gu(t,n):Zkt(r)?Le(n.getData(t).values):nR(r)?n2(t):NZ(r)?n.compareRef(t):t}}function qkt(e,t,n){return mn(t.from)||le('Lookup "from" parameter must be a string literal.'),n.getData(t.from).lookupRef(n,t.key)}function Xkt(e,t,n){const r=t[e.name];return e.array?(it(r)||le("Expected an array of sub-parameters. Instead: "+He(r)),r.map(i=>IZ(e,i,n))):IZ(e,r,n)}function IZ(e,t,n){const r=e.params.length;let i;for(let o=0;o<r;++o){i=e.params[o];for(const a in i.key)if(i.key[a]!==t[a]){i=null;break}if(i)break}i||le("Unsupported parameter: "+He(t));const s=yt(uye(i,t,n),i.key);return Le(n.add(GSt(s)))}const Ykt=e=>e&&e.expr,Kkt=e=>e&&e.field,Zkt=e=>e==="data",DZ=e=>e==="expr",nR=e=>e==="field",NZ=e=>e==="compare";function Jkt(e,t,n){let r,i,s,o,a;return e?(r=e.facet)&&(t||le("Only group marks can be faceted."),r.field!=null?o=a=vk(r,n):(e.data?a=Le(n.getData(e.data).aggregate):(s=sj(yt({type:"aggregate",groupby:et(r.groupby)},r.aggregate),n),s.params.key=n.keyRef(r.groupby),s.params.pulse=vk(r,n),o=a=Le(n.add(s))),i=n.keyRef(r.groupby,!0))):o=Le(n.add(Ga(null,[{}]))),o||(o=vk(e,n)),{key:i,pulse:o,parent:a}}function vk(e,t){return e.$ref?e:e.data&&e.data.$ref?e.data:Le(t.getData(e.data).output)}function Up(e,t,n,r,i){this.scope=e,this.input=t,this.output=n,this.values=r,this.aggregate=i,this.index={}}Up.fromEntries=function(e,t){const n=t.length,r=t[n-1],i=t[n-2];let s=t[0],o=null,a=1;for(s&&s.type==="load"&&(s=t[1]),e.add(t[0]);a<n;++a)t[a].params.pulse=Le(t[a-1]),e.add(t[a]),t[a].type==="aggregate"&&(o=t[a]);return new Up(e,s,i,r,o)};function lye(e){return mn(e)?e:null}function FZ(e,t,n){const r=BN(n.op,n.field);let i;if(t.ops){for(let s=0,o=t.as.length;s<o;++s)if(t.as[s]===r)return}else t.ops=["count"],t.fields=[null],t.as=["count"];n.op&&(t.ops.push((i=n.op.signal)?e.signalRef(i):n.op),t.fields.push(e.fieldRef(n.field)),t.as.push(r))}function xb(e,t,n,r,i,s,o){const a=t[n]||(t[n]={}),u=wSt(s);let l=lye(i),c,f;if(l!=null&&(e=t.scope,l=l+(u?"|"+u:""),c=a[l]),!c){const h=s?{field:GL,pulse:t.countsRef(e,i,s)}:{field:e.fieldRef(i),pulse:Le(t.output)};u&&(h.sort=e.sortRef(s)),f=e.add(PN(r,void 0,h)),o&&(t.index[i]=f),c=Le(f),l!=null&&(a[l]=c)}return c}Up.prototype={countsRef(e,t,n){const r=this,i=r.counts||(r.counts={}),s=lye(t);let o,a,u;return s!=null&&(e=r.scope,o=i[s]),o?n&&n.field&&FZ(e,o.agg.params,n):(u={groupby:e.fieldRef(t,"key"),pulse:Le(r.output)},n&&n.field&&FZ(e,u,n),a=e.add(q1e(u)),o=e.add(Ga({pulse:Le(a)})),o={agg:a,ref:Le(o)},s!=null&&(i[s]=o)),o.ref},tuplesRef(){return Le(this.values)},extentRef(e,t){return xb(e,this,"extent","extent",t,!1)},domainRef(e,t){return xb(e,this,"domain","values",t,!1)},valuesRef(e,t,n){return xb(e,this,"vals","values",t,n||!0)},lookupRef(e,t){return xb(e,this,"lookup","tupleindex",t,!1)},indataRef(e,t){return xb(e,this,"indata","tupleindex",t,!0,!0)}};function Qkt(e,t,n){const r=e.from.facet,i=r.name,s=vk(r,t);let o;r.name||le("Facet must have a name: "+He(r)),r.data||le("Facet must reference a data set: "+He(r)),r.field?o=t.add(K1e({field:t.fieldRef(r.field),pulse:s})):r.groupby?o=t.add(MSt({key:t.keyRef(r.groupby),group:Le(t.proxy(n.parent)),pulse:s})):le("Facet must specify groupby or field: "+He(r));const a=t.fork(),u=a.add(Ga()),l=a.add(Rg({pulse:Le(u)}));a.addData(i,new Up(a,u,u,l)),a.addSignal("parent",null),o.params.subflow={$subflow:a.parse(e).toRuntime()}}function eEt(e,t,n){const r=t.add(K1e({pulse:n.pulse})),i=t.fork();i.add(Rg()),i.addSignal("parent",null),r.params.subflow={$subflow:i.parse(e).toRuntime()}}function cye(e,t,n){const r=e.remove,i=e.insert,s=e.toggle,o=e.modify,a=e.values,u=t.add(Y_()),l="if("+e.trigger+',modify("'+n+'",'+[i,r,s,o,a].map(f=>f??"null").join(",")+"),0)",c=Gu(l,t);u.update=c.$expr,u.params=c.$params}function VN(e,t){const n=aye(e),r=e.type===UN,i=e.from&&e.from.facet,s=e.overlap;let o=e.layout||n===YU||n===XU,a,u,l,c,f,h,d;const p=n===qU||o||i,g=Jkt(e.from,r,t);u=t.add(OSt({key:g.key||(e.key?n2(e.key):void 0),pulse:g.pulse,clean:!r}));const m=Le(u);u=l=t.add(Ga({pulse:m})),u=t.add(USt({markdef:Vkt(e),interactive:Gkt(e.interactive,t),clip:Wkt(e.clip,t),context:{$context:!0},groups:t.lookup(),parent:t.signals.parent?t.signalRef("parent"):null,index:t.markpath(),pulse:Le(u)}));const y=Le(u);u=c=t.add(Y1e(G1e(e.encode,e.type,n,e.style,t,{mod:!1,pulse:y}))),u.params.parent=t.encode(),e.transform&&e.transform.forEach(C=>{const $=sj(C,t),S=$.metadata;(S.generates||S.changes)&&le("Mark transforms should not generate new data."),S.nomod||(c.params.mod=!0),$.params.pulse=Le(u),t.add(u=$)}),e.sort&&(u=t.add(KSt({sort:t.compareRef(e.sort),pulse:Le(u)})));const b=Le(u);(i||o)&&(o=t.add(J1e({layout:t.objectProperty(e.layout),legends:t.legends,mark:y,pulse:b})),h=Le(o));const v=t.add(X1e({mark:y,pulse:h||b}));d=Le(v),r&&(p&&(a=t.operators,a.pop(),o&&a.pop()),t.pushState(b,h||d,m),i?Qkt(e,t,g):p?eEt(e,t,g):t.parse(e),t.popState(),p&&(o&&a.push(o),a.push(v))),s&&(d=tEt(s,d,t));const x=t.add(Z1e({pulse:d})),w=t.add(Rg({pulse:Le(x)},void 0,t.parent()));e.name!=null&&(f=e.name,t.addData(f,new Up(t,l,x,w)),e.on&&e.on.forEach(C=>{(C.insert||C.remove||C.toggle)&&le("Marks only support modify triggers."),cye(C,t,f)}))}function tEt(e,t,n){const r=e.method,i=e.bound,s=e.separation,o={separation:cr(s)?n.signalRef(s.signal):s,method:cr(r)?n.signalRef(r.signal):r,pulse:t};if(e.order&&(o.sort=n.compareRef({field:e.order})),i){const a=i.tolerance;o.boundTolerance=cr(a)?n.signalRef(a.signal):+a,o.boundScale=n.scaleRef(i.scale),o.boundOrient=i.orient}return Le(n.add(VSt(o)))}function nEt(e,t){const n=t.config.legend,r=e.encode||{},i=Us(e,n),s=r.legend||{},o=s.name||void 0,a=s.interactive,u=s.style,l={};let c=0,f,h,d;ej.forEach(v=>e[v]?(l[v]=e[v],c=c||e[v]):0),c||le("Missing valid scale for legend.");const p=rEt(e,t.scaleType(c)),g={title:e.title!=null,scales:l,type:p,vgrad:p!=="symbol"&&i.isVertical()},m=Le(t.add(Ga(null,[g]))),y={enter:{x:{value:0},y:{value:0}}},b=Le(t.add(BSt(h={type:p,scale:t.scaleRef(c),count:t.objectProperty(i("tickCount")),limit:t.property(i("symbolLimit")),values:t.objectProperty(e.values),minstep:t.property(e.tickMinStep),formatType:t.property(e.formatType),formatSpecifier:t.property(e.format)})));return p===xk?(d=[Tkt(e,c,n,r.gradient),_Z(e,n,r.labels,b)],h.count=h.count||t.signalRef(`max(2,2*floor((${ap(i.gradientLength())})/100))`)):p===YL?d=[Ikt(e,c,n,r.gradient,b),_Z(e,n,r.labels,b)]:(f=Okt(e,n),d=[Fkt(e,n,r,b,ap(f.columns))],h.size=oEt(e,t,d[0].marks)),d=[i2({role:tSt,from:m,encode:y,marks:d,layout:f,interactive:a})],g.title&&d.push(jkt(e,n,r.title,m)),VN(i2({role:QCt,from:m,encode:ky(sEt(i,e,n),s,q$),marks:d,aria:i("aria"),description:i("description"),zindex:i("zindex"),name:o,interactive:a,style:u}),t)}function rEt(e,t){let n=e.type||EZ;return!e.type&&iEt(e)===1&&(e.fill||e.stroke)&&(n=y7(t)?xk:k4(t)?YL:EZ),n!==xk?n:k4(t)?YL:xk}function iEt(e){return ej.reduce((t,n)=>t+(e[n]?1:0),0)}function sEt(e,t,n){const r={enter:{},update:{}};return Zr(r,{orient:e("orient"),offset:e("offset"),padding:e("padding"),titlePadding:e("titlePadding"),cornerRadius:e("cornerRadius"),fill:e("fillColor"),stroke:e("strokeColor"),strokeWidth:n.strokeWidth,strokeDash:n.strokeDash,x:e("legendX"),y:e("legendY"),format:t.format,formatType:t.formatType}),r}function oEt(e,t,n){const r=ap(OZ("size",e,n)),i=ap(OZ("strokeWidth",e,n)),s=ap(aEt(n[1].encode,t,H$));return Gu(`max(ceil(sqrt(${r})+${i}),${s})`,t)}function OZ(e,t,n){return t[e]?`scale("${t[e]}",datum)`:sye(e,n[0].encode)}function aEt(e,t,n){return sye("fontSize",e)||_kt("fontSize",t,n)}const uEt=`item.orient==="${Ey}"?-90:item.orient==="${_y}"?90:0`;function lEt(e,t){e=mn(e)?{text:e}:e;const n=Us(e,t.config.title),r=e.encode||{},i=r.group||{},s=i.name||void 0,o=i.interactive,a=i.style,u=[],l={},c=Le(t.add(Ga(null,[l])));return u.push(hEt(e,n,cEt(e),c)),e.subtitle&&u.push(dEt(e,n,r.subtitle,c)),VN(i2({role:sSt,from:c,encode:fEt(n,i),marks:u,aria:n("aria"),description:n("description"),zindex:n("zindex"),name:s,interactive:o,style:a}),t)}function cEt(e){const t=e.encode;return t&&t.title||yt({name:e.name,interactive:e.interactive,style:e.style},t)}function fEt(e,t){const n={enter:{},update:{}};return Zr(n,{orient:e("orient"),anchor:e("anchor"),align:{signal:nj},angle:{signal:uEt},limit:e("limit"),frame:e("frame"),offset:e("offset")||0,padding:e("subtitlePadding")}),ky(n,t,q$)}function hEt(e,t,n,r){const i={value:0},s=e.text,o={enter:{opacity:i},update:{opacity:{value:1}},exit:{opacity:i}};return Zr(o,{text:s,align:{signal:"item.mark.group.align"},angle:{signal:"item.mark.group.angle"},limit:{signal:"item.mark.group.limit"},baseline:"top",dx:t("dx"),dy:t("dy"),fill:t("color"),font:t("font"),fontSize:t("fontSize"),fontStyle:t("fontStyle"),fontWeight:t("fontWeight"),lineHeight:t("lineHeight")},{align:t("align"),angle:t("angle"),baseline:t("baseline")}),uo({type:Mg,role:oSt,style:bkt,from:r,encode:o},n)}function dEt(e,t,n,r){const i={value:0},s=e.subtitle,o={enter:{opacity:i},update:{opacity:{value:1}},exit:{opacity:i}};return Zr(o,{text:s,align:{signal:"item.mark.group.align"},angle:{signal:"item.mark.group.angle"},limit:{signal:"item.mark.group.limit"},baseline:"top",dx:t("dx"),dy:t("dy"),fill:t("subtitleColor"),font:t("subtitleFont"),fontSize:t("subtitleFontSize"),fontStyle:t("subtitleFontStyle"),fontWeight:t("subtitleFontWeight"),lineHeight:t("subtitleLineHeight")},{align:t("align"),angle:t("angle"),baseline:t("baseline")}),uo({type:Mg,role:aSt,style:xkt,from:r,encode:o},n)}function pEt(e,t){const n=[];e.transform&&e.transform.forEach(r=>{n.push(sj(r,t))}),e.on&&e.on.forEach(r=>{cye(r,t,e.name)}),t.addDataPipeline(e.name,gEt(e,t,n))}function gEt(e,t,n){const r=[];let i=null,s=!1,o=!1,a,u,l,c,f;for(e.values?cr(e.values)||yk(e.format)?(r.push(RZ(t,e)),r.push(i=od())):r.push(i=od({$ingest:e.values,$format:e.format})):e.url?yk(e.url)||yk(e.format)?(r.push(RZ(t,e)),r.push(i=od())):r.push(i=od({$request:e.url,$format:e.format})):e.source&&(i=a=et(e.source).map(h=>Le(t.getData(h).output)),r.push(null)),u=0,l=n.length;u<l;++u)c=n[u],f=c.metadata,!i&&!f.source&&r.push(i=od()),r.push(c),f.generates&&(o=!0),f.modifies&&!o&&(s=!0),f.source?i=c:f.changes&&(i=null);return a&&(l=a.length-1,r[0]=XSt({derive:s,pulse:l?a:a[0]}),(s||l)&&r.splice(1,0,od())),i||r.push(od()),r.push(Rg({})),r}function od(e){const t=Ga({},e);return t.metadata={source:!0},t}function RZ(e,t){return zSt({url:t.url?e.property(t.url):void 0,async:t.async?e.property(t.async):void 0,values:t.values?e.property(t.values):void 0,format:e.objectProperty(t.format)})}const fye=e=>e===gh||e===Ha,GN=(e,t,n)=>cr(e)?xEt(e.signal,t,n):e===Ey||e===Ha?t:n,Ar=(e,t,n)=>cr(e)?yEt(e.signal,t,n):fye(e)?t:n,Ea=(e,t,n)=>cr(e)?bEt(e.signal,t,n):fye(e)?n:t,hye=(e,t,n)=>cr(e)?vEt(e.signal,t,n):e===Ha?{value:t}:{value:n},mEt=(e,t,n)=>cr(e)?wEt(e.signal,t,n):e===_y?{value:t}:{value:n},yEt=(e,t,n)=>dye(`${e} === '${Ha}' || ${e} === '${gh}'`,t,n),bEt=(e,t,n)=>dye(`${e} !== '${Ha}' && ${e} !== '${gh}'`,t,n),xEt=(e,t,n)=>oj(`${e} === '${Ey}' || ${e} === '${Ha}'`,t,n),vEt=(e,t,n)=>oj(`${e} === '${Ha}'`,t,n),wEt=(e,t,n)=>oj(`${e} === '${_y}'`,t,n),dye=(e,t,n)=>(t=t!=null?_r(t):t,n=n!=null?_r(n):n,MZ(t)&&MZ(n)?(t=t?t.signal||He(t.value):null,n=n?n.signal||He(n.value):null,{signal:`${e} ? (${t}) : (${n})`}):[yt({test:e},t)].concat(n||[])),MZ=e=>e==null||Object.keys(e).length===1,oj=(e,t,n)=>({signal:`${e} ? (${Sm(t)}) : (${Sm(n)})`}),$Et=(e,t,n,r,i)=>({signal:(r!=null?`${e} === '${Ey}' ? (${Sm(r)}) : `:"")+(n!=null?`${e} === '${gh}' ? (${Sm(n)}) : `:"")+(i!=null?`${e} === '${_y}' ? (${Sm(i)}) : `:"")+(t!=null?`${e} === '${Ha}' ? (${Sm(t)}) : `:"")+"(null)"}),Sm=e=>cr(e)?e.signal:e==null?null:He(e),CEt=(e,t)=>t===0?0:cr(e)?{signal:`(${e.signal}) * ${t}`}:{value:e*t},Pm=(e,t)=>{const n=e.signal;return n&&n.endsWith("(null)")?{signal:n.slice(0,-6)+t.signal}:e};function lm(e,t,n,r){let i;if(t&&nt(t,e))return t[e];if(nt(n,e))return n[e];if(e.startsWith("title")){switch(e){case"titleColor":i="fill";break;case"titleFont":case"titleFontSize":case"titleFontWeight":i=e[5].toLowerCase()+e.slice(6)}return r[QU][i]}else if(e.startsWith("label")){switch(e){case"labelColor":i="fill";break;case"labelFont":case"labelFontSize":i=e[5].toLowerCase()+e.slice(6)}return r[H$][i]}return null}function LZ(e){const t={};for(const n of e)if(n)for(const r in n)t[r]=1;return Object.keys(t)}function SEt(e,t){var n=t.config,r=n.style,i=n.axis,s=t.scaleType(e.scale)==="band"&&n.axisBand,o=e.orient,a,u,l;if(cr(o)){const f=LZ([n.axisX,n.axisY]),h=LZ([n.axisTop,n.axisBottom,n.axisLeft,n.axisRight]);a={};for(l of f)a[l]=Ar(o,lm(l,n.axisX,i,r),lm(l,n.axisY,i,r));u={};for(l of h)u[l]=$Et(o.signal,lm(l,n.axisTop,i,r),lm(l,n.axisBottom,i,r),lm(l,n.axisLeft,i,r),lm(l,n.axisRight,i,r))}else a=o===Ha||o===gh?n.axisX:n.axisY,u=n["axis"+o[0].toUpperCase()+o.slice(1)];return a||u||s?yt({},i,a,u,s):i}function kEt(e,t,n,r){const i=Us(e,t),s=e.orient;let o,a;const u={enter:o={opacity:$t},update:a={opacity:Mo},exit:{opacity:$t}};Zr(u,{stroke:i("domainColor"),strokeCap:i("domainCap"),strokeDash:i("domainDash"),strokeDashOffset:i("domainDashOffset"),strokeWidth:i("domainWidth"),strokeOpacity:i("domainOpacity")});const l=PZ(e,0),c=PZ(e,1);return o.x=a.x=Ar(s,l,$t),o.x2=a.x2=Ar(s,c),o.y=a.y=Ea(s,l,$t),o.y2=a.y2=Ea(s,c),uo({type:tj,role:XCt,from:r,encode:u},n)}function PZ(e,t){return{scale:e.scale,range:t}}function EEt(e,t,n,r,i){const s=Us(e,t),o=e.orient,a=e.gridScale,u=GN(o,1,-1),l=_Et(e.offset,u);let c,f,h;const d={enter:c={opacity:$t},update:h={opacity:Mo},exit:f={opacity:$t}};Zr(d,{stroke:s("gridColor"),strokeCap:s("gridCap"),strokeDash:s("gridDash"),strokeDashOffset:s("gridDashOffset"),strokeOpacity:s("gridOpacity"),strokeWidth:s("gridWidth")});const p={scale:e.scale,field:Ro,band:i.band,extra:i.extra,offset:i.offset,round:s("tickRound")},g=Ar(o,{signal:"height"},{signal:"width"}),m=a?{scale:a,range:0,mult:u,offset:l}:{value:0,offset:l},y=a?{scale:a,range:1,mult:u,offset:l}:yt(g,{mult:u,offset:l});return c.x=h.x=Ar(o,p,m),c.y=h.y=Ea(o,p,m),c.x2=h.x2=Ea(o,y),c.y2=h.y2=Ar(o,y),f.x=Ar(o,p),f.y=Ea(o,p),uo({type:tj,role:YCt,key:Ro,from:r,encode:d},n)}function _Et(e,t){if(t!==1)if(!dt(e))e=cr(t)?{signal:`(${t.signal}) * (${e||0})`}:t*(e||0);else{let n=e=yt({},e);for(;n.mult!=null;)if(dt(n.mult))n=n.mult=yt({},n.mult);else return n.mult=cr(t)?{signal:`(${n.mult}) * (${t.signal})`}:n.mult*t,e;n.mult=t}return e}function AEt(e,t,n,r,i,s){const o=Us(e,t),a=e.orient,u=GN(a,-1,1);let l,c,f;const h={enter:l={opacity:$t},update:f={opacity:Mo},exit:c={opacity:$t}};Zr(h,{stroke:o("tickColor"),strokeCap:o("tickCap"),strokeDash:o("tickDash"),strokeDashOffset:o("tickDashOffset"),strokeOpacity:o("tickOpacity"),strokeWidth:o("tickWidth")});const d=_r(i);d.mult=u;const p={scale:e.scale,field:Ro,band:s.band,extra:s.extra,offset:s.offset,round:o("tickRound")};return f.y=l.y=Ar(a,$t,p),f.y2=l.y2=Ar(a,d),c.x=Ar(a,p),f.x=l.x=Ea(a,$t,p),f.x2=l.x2=Ea(a,d),c.y=Ea(a,p),uo({type:tj,role:ZCt,key:Ro,from:r,encode:h},n)}function rR(e,t,n,r,i){return{signal:'flush(range("'+e+'"), scale("'+e+'", datum.value), '+t+","+n+","+r+","+i+")"}}function TEt(e,t,n,r,i,s){const o=Us(e,t),a=e.orient,u=e.scale,l=GN(a,-1,1),c=ap(o("labelFlush")),f=ap(o("labelFlushOffset")),h=o("labelAlign"),d=o("labelBaseline");let p=c===0||!!c,g;const m=_r(i);m.mult=l,m.offset=_r(o("labelPadding")||0),m.offset.mult=l;const y={scale:u,field:Ro,band:.5,offset:oye(s.offset,o("labelOffset"))},b=Ar(a,p?rR(u,c,'"left"','"right"','"center"'):{value:"center"},mEt(a,"left","right")),v=Ar(a,hye(a,"bottom","top"),p?rR(u,c,'"top"','"bottom"','"middle"'):{value:"middle"}),x=rR(u,c,`-(${f})`,f,0);p=p&&f;const w={opacity:$t,x:Ar(a,y,m),y:Ea(a,y,m)},C={enter:w,update:g={opacity:Mo,text:{field:JU},x:w.x,y:w.y,align:b,baseline:v},exit:{opacity:$t,x:w.x,y:w.y}};Zr(C,{dx:!h&&p?Ar(a,x):null,dy:!d&&p?Ea(a,x):null}),Zr(C,{angle:o("labelAngle"),fill:o("labelColor"),fillOpacity:o("labelOpacity"),font:o("labelFont"),fontSize:o("labelFontSize"),fontWeight:o("labelFontWeight"),fontStyle:o("labelFontStyle"),limit:o("labelLimit"),lineHeight:o("labelLineHeight")},{align:h,baseline:d});const $=o("labelBound");let S=o("labelOverlap");return S=S||$?{separation:o("labelSeparation"),method:S,order:"datum.index",bound:$?{scale:u,orient:a,tolerance:$}:null}:void 0,g.align!==b&&(g.align=Pm(g.align,b)),g.baseline!==v&&(g.baseline=Pm(g.baseline,v)),uo({type:Mg,role:KCt,style:H$,key:Ro,from:r,encode:C,overlap:S},n)}function IEt(e,t,n,r){const i=Us(e,t),s=e.orient,o=GN(s,-1,1);let a,u;const l={enter:a={opacity:$t,anchor:_r(i("titleAnchor",null)),align:{signal:nj}},update:u=yt({},a,{opacity:Mo,text:_r(e.title)}),exit:{opacity:$t}},c={signal:`lerp(range("${e.scale}"), ${jN(0,1,.5)})`};return u.x=Ar(s,c),u.y=Ea(s,c),a.angle=Ar(s,$t,CEt(o,90)),a.baseline=Ar(s,hye(s,gh,Ha),{value:gh}),u.angle=a.angle,u.baseline=a.baseline,Zr(l,{fill:i("titleColor"),fillOpacity:i("titleOpacity"),font:i("titleFont"),fontSize:i("titleFontSize"),fontStyle:i("titleFontStyle"),fontWeight:i("titleFontWeight"),limit:i("titleLimit"),lineHeight:i("titleLineHeight")},{align:i("titleAlign"),angle:i("titleAngle"),baseline:i("titleBaseline")}),DEt(i,s,l,n),l.update.align=Pm(l.update.align,a.align),l.update.angle=Pm(l.update.angle,a.angle),l.update.baseline=Pm(l.update.baseline,a.baseline),uo({type:Mg,role:JCt,style:QU,from:r,encode:l},n)}function DEt(e,t,n,r){const i=(a,u)=>a!=null?(n.update[u]=Pm(_r(a),n.update[u]),!1):!mm(u,r),s=i(e("titleX"),"x"),o=i(e("titleY"),"y");n.enter.auto=o===s?_r(o):Ar(t,_r(o),_r(s))}function NEt(e,t){const n=SEt(e,t),r=e.encode||{},i=r.axis||{},s=i.name||void 0,o=i.interactive,a=i.style,u=Us(e,n),l=Akt(u),c={scale:e.scale,ticks:!!u("ticks"),labels:!!u("labels"),grid:!!u("grid"),domain:!!u("domain"),title:e.title!=null},f=Le(t.add(Ga({},[c]))),h=Le(t.add(FSt({scale:t.scaleRef(e.scale),extra:t.property(l.extra),count:t.objectProperty(e.tickCount),values:t.objectProperty(e.values),minstep:t.property(e.tickMinStep),formatType:t.property(e.formatType),formatSpecifier:t.property(e.format)}))),d=[];let p;return c.grid&&d.push(EEt(e,n,r.grid,h,l)),c.ticks&&(p=u("tickSize"),d.push(AEt(e,n,r.ticks,h,p,l))),c.labels&&(p=c.ticks?p:0,d.push(TEt(e,n,r.labels,h,p,l))),c.domain&&d.push(kEt(e,n,r.domain,f)),c.title&&d.push(IEt(e,n,r.title,f)),VN(i2({role:qCt,from:f,encode:ky(FEt(u,e),i,q$),marks:d,aria:u("aria"),description:u("description"),zindex:u("zindex"),name:s,interactive:o,style:a}),t)}function FEt(e,t){const n={enter:{},update:{}};return Zr(n,{orient:e("orient"),offset:e("offset")||0,position:la(t.position,0),titlePadding:e("titlePadding"),minExtent:e("minExtent"),maxExtent:e("maxExtent"),range:{signal:`abs(span(range("${t.scale}")))`},translate:e("translate"),format:t.format,formatType:t.formatType}),n}function pye(e,t,n){const r=et(e.signals),i=et(e.scales);return n||r.forEach(s=>H1e(s,t)),et(e.projections).forEach(s=>fkt(s,t)),i.forEach(s=>QSt(s,t)),et(e.data).forEach(s=>pEt(s,t)),i.forEach(s=>ekt(s,t)),(n||r).forEach(s=>NSt(s,t)),et(e.axes).forEach(s=>NEt(s,t)),et(e.marks).forEach(s=>VN(s,t)),et(e.legends).forEach(s=>nEt(s,t)),e.title&&lEt(e.title,t),t.parseLambdas(),t}const OEt=e=>ky({enter:{x:{value:0},y:{value:0}},update:{width:{signal:"width"},height:{signal:"height"}}},e);function REt(e,t){const n=t.config,r=Le(t.root=t.add(Y_())),i=MEt(e,n);i.forEach(l=>H1e(l,t)),t.description=e.description||n.description,t.eventConfig=n.events,t.legends=t.objectProperty(n.legend&&n.legend.layout),t.locale=n.locale;const s=t.add(Ga()),o=t.add(Y1e(G1e(OEt(e.encode),UN,XU,e.style,t,{pulse:Le(s)}))),a=t.add(J1e({layout:t.objectProperty(e.layout),legends:t.legends,autosize:t.signalRef("autosize"),mark:r,pulse:Le(o)}));t.operators.pop(),t.pushState(Le(o),Le(a),null),pye(e,t,i),t.operators.push(a);let u=t.add(X1e({mark:r,pulse:Le(a)}));return u=t.add(Z1e({pulse:Le(u)})),u=t.add(Rg({pulse:Le(u)})),t.addData("root",new Up(t,s,s,u)),t}function vb(e,t){return t&&t.signal?{name:e,update:t.signal}:{name:e,value:t}}function MEt(e,t){const n=o=>la(e[o],t[o]),r=[vb("background",n("background")),vb("autosize",VCt(n("autosize"))),vb("padding",HCt(n("padding"))),vb("width",n("width")||0),vb("height",n("height")||0)],i=r.reduce((o,a)=>(o[a.name]=a,o),{}),s={};return et(e.signals).forEach(o=>{nt(i,o.name)?o=yt(i[o.name],o):r.push(o),s[o.name]=o}),et(t.signals).forEach(o=>{!nt(s,o.name)&&!nt(i,o.name)&&r.push(o)}),r}function gye(e,t){this.config=e||{},this.options=t||{},this.bindings=[],this.field={},this.signals={},this.lambdas={},this.scales={},this.events={},this.data={},this.streams=[],this.updates=[],this.operators=[],this.eventConfig=null,this.locale=null,this._id=0,this._subid=0,this._nextsub=[0],this._parent=[],this._encode=[],this._lookup=[],this._markpath=[]}function BZ(e){this.config=e.config,this.options=e.options,this.legends=e.legends,this.field=Object.create(e.field),this.signals=Object.create(e.signals),this.lambdas=Object.create(e.lambdas),this.scales=Object.create(e.scales),this.events=Object.create(e.events),this.data=Object.create(e.data),this.streams=[],this.updates=[],this.operators=[],this._id=0,this._subid=++e._nextsub[0],this._nextsub=e._nextsub,this._parent=e._parent.slice(),this._encode=e._encode.slice(),this._lookup=e._lookup.slice(),this._markpath=e._markpath}gye.prototype=BZ.prototype={parse(e){return pye(e,this)},fork(){return new BZ(this)},isSubscope(){return this._subid>0},toRuntime(){return this.finish(),{description:this.description,operators:this.operators,streams:this.streams,updates:this.updates,bindings:this.bindings,eventConfig:this.eventConfig,locale:this.locale}},id(){return(this._subid?this._subid+":":0)+this._id++},add(e){return this.operators.push(e),e.id=this.id(),e.refs&&(e.refs.forEach(t=>{t.$ref=e.id}),e.refs=null),e},proxy(e){const t=e instanceof VL?Le(e):e;return this.add(qSt({value:t}))},addStream(e){return this.streams.push(e),e.id=this.id(),e},addUpdate(e){return this.updates.push(e),e},finish(){let e,t;this.root&&(this.root.root=!0);for(e in this.signals)this.signals[e].signal=e;for(e in this.scales)this.scales[e].scale=e;function n(r,i,s){let o,a;r&&(o=r.data||(r.data={}),a=o[i]||(o[i]=[]),a.push(s))}for(e in this.data){t=this.data[e],n(t.input,e,"input"),n(t.output,e,"output"),n(t.values,e,"values");for(const r in t.index)n(t.index[r],e,"index:"+r)}return this},pushState(e,t,n){this._encode.push(Le(this.add(Rg({pulse:e})))),this._parent.push(t),this._lookup.push(n?Le(this.proxy(n)):null),this._markpath.push(-1)},popState(){this._encode.pop(),this._parent.pop(),this._lookup.pop(),this._markpath.pop()},parent(){return Kt(this._parent)},encode(){return Kt(this._encode)},lookup(){return Kt(this._lookup)},markpath(){const e=this._markpath;return++e[e.length-1]},fieldRef(e,t){if(mn(e))return n2(e,t);e.signal||le("Unsupported field reference: "+He(e));const n=e.signal;let r=this.field[n];if(!r){const i={name:this.signalRef(n)};t&&(i.as=t),this.field[n]=r=Le(this.add(LSt(i)))}return r},compareRef(e){let t=!1;const n=s=>cr(s)?(t=!0,this.signalRef(s.signal)):$St(s)?(t=!0,this.exprRef(s.expr)):s,r=et(e.field).map(n),i=et(e.order).map(n);return t?Le(this.add(kZ({fields:r,orders:i}))):CZ(r,i)},keyRef(e,t){let n=!1;const r=s=>cr(s)?(n=!0,Le(i[s.signal])):s,i=this.signals;return e=et(e).map(r),n?Le(this.add(PSt({fields:e,flat:t}))):bSt(e,t)},sortRef(e){if(!e)return e;const t=BN(e.op,e.field),n=e.order||xSt;return n.signal?Le(this.add(kZ({fields:t,orders:this.signalRef(n.signal)}))):CZ(t,n)},event(e,t){const n=e+":"+t;if(!this.events[n]){const r=this.id();this.streams.push({id:r,source:e,type:t}),this.events[n]=r}return this.events[n]},hasOwnSignal(e){return nt(this.signals,e)},addSignal(e,t){this.hasOwnSignal(e)&&le("Duplicate signal name: "+He(e));const n=t instanceof VL?t:this.add(Y_(t));return this.signals[e]=n},getSignal(e){return this.signals[e]||le("Unrecognized signal name: "+He(e)),this.signals[e]},signalRef(e){return this.signals[e]?Le(this.signals[e]):(nt(this.lambdas,e)||(this.lambdas[e]=this.add(Y_(null))),Le(this.lambdas[e]))},parseLambdas(){const e=Object.keys(this.lambdas);for(let t=0,n=e.length;t<n;++t){const r=e[t],i=Gu(r,this),s=this.lambdas[r];s.params=i.$params,s.update=i.$expr}},property(e){return e&&e.signal?this.signalRef(e.signal):e},objectProperty(e){return!e||!dt(e)?e:this.signalRef(e.signal||aj(e))},exprRef(e,t){const n={expr:Gu(e,this)};return t&&(n.expr.$name=t),Le(this.add(RSt(n)))},addBinding(e,t){this.bindings||le("Nested signals do not support binding: "+He(e)),this.bindings.push(yt({signal:e},t))},addScaleProj(e,t){nt(this.scales,e)&&le("Duplicate scale or projection name: "+He(e)),this.scales[e]=this.add(t)},addScale(e,t){this.addScaleProj(e,YSt(t))},addProjection(e,t){this.addScaleProj(e,HSt(t))},getScale(e){return this.scales[e]||le("Unrecognized scale name: "+He(e)),this.scales[e]},scaleRef(e){return Le(this.getScale(e))},scaleType(e){return this.getScale(e).params.type},projectionRef(e){return this.scaleRef(e)},projectionType(e){return this.scaleType(e)},addData(e,t){return nt(this.data,e)&&le("Duplicate data set name: "+He(e)),this.data[e]=t},getData(e){return this.data[e]||le("Undefined data set name: "+He(e)),this.data[e]},addDataPipeline(e,t){return nt(this.data,e)&&le("Duplicate data set name: "+He(e)),this.addData(e,Up.fromEntries(this,t))}};function aj(e){return(it(e)?LEt:PEt)(e)}function LEt(e){const t=e.length;let n="[";for(let r=0;r<t;++r){const i=e[r];n+=(r>0?",":"")+(dt(i)?i.signal||aj(i):He(i))}return n+"]"}function PEt(e){let t="{",n=0,r,i;for(r in e)i=e[r],t+=(++n>1?",":"")+He(r)+":"+(dt(i)?i.signal||aj(i):He(i));return t+"}"}function BEt(){const e="sans-serif",r="#4c78a8",i="#000",s="#888",o="#ddd";return{description:"Vega visualization",padding:0,autosize:"pad",background:null,events:{defaults:{allow:["wheel"]}},group:null,mark:null,arc:{fill:r},area:{fill:r},image:null,line:{stroke:r,strokeWidth:2},path:{stroke:r},rect:{fill:r},rule:{stroke:i},shape:{stroke:r},symbol:{fill:r,size:64},text:{fill:i,font:e,fontSize:11},trail:{fill:r,size:2},style:{"guide-label":{fill:i,font:e,fontSize:10},"guide-title":{fill:i,font:e,fontSize:11,fontWeight:"bold"},"group-title":{fill:i,font:e,fontSize:13,fontWeight:"bold"},"group-subtitle":{fill:i,font:e,fontSize:12},point:{size:30,strokeWidth:2,shape:"circle"},circle:{size:30,strokeWidth:2},square:{size:30,strokeWidth:2,shape:"square"},cell:{fill:"transparent",stroke:o}},title:{orient:"top",anchor:"middle",offset:4,subtitlePadding:3},axis:{minExtent:0,maxExtent:200,bandPosition:.5,domain:!0,domainWidth:1,domainColor:s,grid:!1,gridWidth:1,gridColor:o,labels:!0,labelAngle:0,labelLimit:180,labelOffset:0,labelPadding:2,ticks:!0,tickColor:s,tickOffset:0,tickRound:!0,tickSize:5,tickWidth:1,titlePadding:4},axisBand:{tickOffset:-.5},projection:{type:"mercator"},legend:{orient:"right",padding:0,gridAlign:"each",columnPadding:10,rowPadding:2,symbolDirection:"vertical",gradientDirection:"vertical",gradientLength:200,gradientThickness:16,gradientStrokeColor:o,gradientStrokeWidth:0,gradientLabelOffset:2,labelAlign:"left",labelBaseline:"middle",labelLimit:160,labelOffset:4,labelOverlap:!0,symbolLimit:30,symbolType:"circle",symbolSize:100,symbolOffset:0,symbolStrokeWidth:1.5,symbolBaseFillColor:"transparent",symbolBaseStrokeColor:s,titleLimit:180,titleOrient:"top",titlePadding:5,layout:{offset:18,direction:"horizontal",left:{direction:"vertical"},right:{direction:"vertical"}}},range:{category:{scheme:"tableau10"},ordinal:{scheme:"blues"},heatmap:{scheme:"yellowgreenblue"},ramp:{scheme:"blues"},diverging:{scheme:"blueorange",extent:[1,0]},symbol:["circle","square","triangle-up","cross","diamond","triangle-right","triangle-down","triangle-left"]}}}function zEt(e,t,n){return dt(e)||le("Input Vega specification must be an object."),t=jI(BEt(),t,e.config),REt(e,new gye(t,n)).toRuntime()}const UEt="RawCode",jEt="Literal",WEt="Property",VEt="Identifier",GEt="ArrayExpression",HEt="BinaryExpression",qEt="CallExpression",XEt="ConditionalExpression",YEt="LogicalExpression",KEt="MemberExpression",ZEt="ObjectExpression",JEt="UnaryExpression";function qa(e){this.type=e}qa.prototype.visit=function(e){let t,n,r;if(e(this))return 1;for(t=QEt(this),n=0,r=t.length;n<r;++n)if(t[n].visit(e))return 1};function QEt(e){switch(e.type){case GEt:return e.elements;case HEt:case YEt:return[e.left,e.right];case qEt:return[e.callee].concat(e.arguments);case XEt:return[e.test,e.consequent,e.alternate];case KEt:return[e.object,e.property];case ZEt:return e.properties;case WEt:return[e.key,e.value];case JEt:return[e.argument];case VEt:case jEt:case UEt:default:return[]}}var ll,De,se,Ei,Wt,HN=1,X$=2,jp=3,Wh=4,qN=5,Lg=6,ds=7,Y$=8,e_t=9;ll={};ll[HN]="Boolean";ll[X$]="<end>";ll[jp]="Identifier";ll[Wh]="Keyword";ll[qN]="Null";ll[Lg]="Numeric";ll[ds]="Punctuator";ll[Y$]="String";ll[e_t]="RegularExpression";var t_t="ArrayExpression",n_t="BinaryExpression",r_t="CallExpression",i_t="ConditionalExpression",mye="Identifier",s_t="Literal",o_t="LogicalExpression",a_t="MemberExpression",u_t="ObjectExpression",l_t="Property",c_t="UnaryExpression",Tr="Unexpected token %0",f_t="Unexpected number",h_t="Unexpected string",d_t="Unexpected identifier",p_t="Unexpected reserved word",g_t="Unexpected end of input",ZL="Invalid regular expression",iR="Invalid regular expression: missing /",yye="Octal literals are not allowed in strict mode.",m_t="Duplicate data property in object literal not allowed in strict mode",Hr="ILLEGAL",s2="Disabled.",y_t=new RegExp("[\\xAA\\xB5\\xBA\\xC0-\\xD6\\xD8-\\xF6\\xF8-\\u02C1\\u02C6-\\u02D1\\u02E0-\\u02E4\\u02EC\\u02EE\\u0370-\\u0374\\u0376\\u0377\\u037A-\\u037D\\u037F\\u0386\\u0388-\\u038A\\u038C\\u038E-\\u03A1\\u03A3-\\u03F5\\u03F7-\\u0481\\u048A-\\u052F\\u0531-\\u0556\\u0559\\u0561-\\u0587\\u05D0-\\u05EA\\u05F0-\\u05F2\\u0620-\\u064A\\u066E\\u066F\\u0671-\\u06D3\\u06D5\\u06E5\\u06E6\\u06EE\\u06EF\\u06FA-\\u06FC\\u06FF\\u0710\\u0712-\\u072F\\u074D-\\u07A5\\u07B1\\u07CA-\\u07EA\\u07F4\\u07F5\\u07FA\\u0800-\\u0815\\u081A\\u0824\\u0828\\u0840-\\u0858\\u08A0-\\u08B2\\u0904-\\u0939\\u093D\\u0950\\u0958-\\u0961\\u0971-\\u0980\\u0985-\\u098C\\u098F\\u0990\\u0993-\\u09A8\\u09AA-\\u09B0\\u09B2\\u09B6-\\u09B9\\u09BD\\u09CE\\u09DC\\u09DD\\u09DF-\\u09E1\\u09F0\\u09F1\\u0A05-\\u0A0A\\u0A0F\\u0A10\\u0A13-\\u0A28\\u0A2A-\\u0A30\\u0A32\\u0A33\\u0A35\\u0A36\\u0A38\\u0A39\\u0A59-\\u0A5C\\u0A5E\\u0A72-\\u0A74\\u0A85-\\u0A8D\\u0A8F-\\u0A91\\u0A93-\\u0AA8\\u0AAA-\\u0AB0\\u0AB2\\u0AB3\\u0AB5-\\u0AB9\\u0ABD\\u0AD0\\u0AE0\\u0AE1\\u0B05-\\u0B0C\\u0B0F\\u0B10\\u0B13-\\u0B28\\u0B2A-\\u0B30\\u0B32\\u0B33\\u0B35-\\u0B39\\u0B3D\\u0B5C\\u0B5D\\u0B5F-\\u0B61\\u0B71\\u0B83\\u0B85-\\u0B8A\\u0B8E-\\u0B90\\u0B92-\\u0B95\\u0B99\\u0B9A\\u0B9C\\u0B9E\\u0B9F\\u0BA3\\u0BA4\\u0BA8-\\u0BAA\\u0BAE-\\u0BB9\\u0BD0\\u0C05-\\u0C0C\\u0C0E-\\u0C10\\u0C12-\\u0C28\\u0C2A-\\u0C39\\u0C3D\\u0C58\\u0C59\\u0C60\\u0C61\\u0C85-\\u0C8C\\u0C8E-\\u0C90\\u0C92-\\u0CA8\\u0CAA-\\u0CB3\\u0CB5-\\u0CB9\\u0CBD\\u0CDE\\u0CE0\\u0CE1\\u0CF1\\u0CF2\\u0D05-\\u0D0C\\u0D0E-\\u0D10\\u0D12-\\u0D3A\\u0D3D\\u0D4E\\u0D60\\u0D61\\u0D7A-\\u0D7F\\u0D85-\\u0D96\\u0D9A-\\u0DB1\\u0DB3-\\u0DBB\\u0DBD\\u0DC0-\\u0DC6\\u0E01-\\u0E30\\u0E32\\u0E33\\u0E40-\\u0E46\\u0E81\\u0E82\\u0E84\\u0E87\\u0E88\\u0E8A\\u0E8D\\u0E94-\\u0E97\\u0E99-\\u0E9F\\u0EA1-\\u0EA3\\u0EA5\\u0EA7\\u0EAA\\u0EAB\\u0EAD-\\u0EB0\\u0EB2\\u0EB3\\u0EBD\\u0EC0-\\u0EC4\\u0EC6\\u0EDC-\\u0EDF\\u0F00\\u0F40-\\u0F47\\u0F49-\\u0F6C\\u0F88-\\u0F8C\\u1000-\\u102A\\u103F\\u1050-\\u1055\\u105A-\\u105D\\u1061\\u1065\\u1066\\u106E-\\u1070\\u1075-\\u1081\\u108E\\u10A0-\\u10C5\\u10C7\\u10CD\\u10D0-\\u10FA\\u10FC-\\u1248\\u124A-\\u124D\\u1250-\\u1256\\u1258\\u125A-\\u125D\\u1260-\\u1288\\u128A-\\u128D\\u1290-\\u12B0\\u12B2-\\u12B5\\u12B8-\\u12BE\\u12C0\\u12C2-\\u12C5\\u12C8-\\u12D6\\u12D8-\\u1310\\u1312-\\u1315\\u1318-\\u135A\\u1380-\\u138F\\u13A0-\\u13F4\\u1401-\\u166C\\u166F-\\u167F\\u1681-\\u169A\\u16A0-\\u16EA\\u16EE-\\u16F8\\u1700-\\u170C\\u170E-\\u1711\\u1720-\\u1731\\u1740-\\u1751\\u1760-\\u176C\\u176E-\\u1770\\u1780-\\u17B3\\u17D7\\u17DC\\u1820-\\u1877\\u1880-\\u18A8\\u18AA\\u18B0-\\u18F5\\u1900-\\u191E\\u1950-\\u196D\\u1970-\\u1974\\u1980-\\u19AB\\u19C1-\\u19C7\\u1A00-\\u1A16\\u1A20-\\u1A54\\u1AA7\\u1B05-\\u1B33\\u1B45-\\u1B4B\\u1B83-\\u1BA0\\u1BAE\\u1BAF\\u1BBA-\\u1BE5\\u1C00-\\u1C23\\u1C4D-\\u1C4F\\u1C5A-\\u1C7D\\u1CE9-\\u1CEC\\u1CEE-\\u1CF1\\u1CF5\\u1CF6\\u1D00-\\u1DBF\\u1E00-\\u1F15\\u1F18-\\u1F1D\\u1F20-\\u1F45\\u1F48-\\u1F4D\\u1F50-\\u1F57\\u1F59\\u1F5B\\u1F5D\\u1F5F-\\u1F7D\\u1F80-\\u1FB4\\u1FB6-\\u1FBC\\u1FBE\\u1FC2-\\u1FC4\\u1FC6-\\u1FCC\\u1FD0-\\u1FD3\\u1FD6-\\u1FDB\\u1FE0-\\u1FEC\\u1FF2-\\u1FF4\\u1FF6-\\u1FFC\\u2071\\u207F\\u2090-\\u209C\\u2102\\u2107\\u210A-\\u2113\\u2115\\u2119-\\u211D\\u2124\\u2126\\u2128\\u212A-\\u212D\\u212F-\\u2139\\u213C-\\u213F\\u2145-\\u2149\\u214E\\u2160-\\u2188\\u2C00-\\u2C2E\\u2C30-\\u2C5E\\u2C60-\\u2CE4\\u2CEB-\\u2CEE\\u2CF2\\u2CF3\\u2D00-\\u2D25\\u2D27\\u2D2D\\u2D30-\\u2D67\\u2D6F\\u2D80-\\u2D96\\u2DA0-\\u2DA6\\u2DA8-\\u2DAE\\u2DB0-\\u2DB6\\u2DB8-\\u2DBE\\u2DC0-\\u2DC6\\u2DC8-\\u2DCE\\u2DD0-\\u2DD6\\u2DD8-\\u2DDE\\u2E2F\\u3005-\\u3007\\u3021-\\u3029\\u3031-\\u3035\\u3038-\\u303C\\u3041-\\u3096\\u309D-\\u309F\\u30A1-\\u30FA\\u30FC-\\u30FF\\u3105-\\u312D\\u3131-\\u318E\\u31A0-\\u31BA\\u31F0-\\u31FF\\u3400-\\u4DB5\\u4E00-\\u9FCC\\uA000-\\uA48C\\uA4D0-\\uA4FD\\uA500-\\uA60C\\uA610-\\uA61F\\uA62A\\uA62B\\uA640-\\uA66E\\uA67F-\\uA69D\\uA6A0-\\uA6EF\\uA717-\\uA71F\\uA722-\\uA788\\uA78B-\\uA78E\\uA790-\\uA7AD\\uA7B0\\uA7B1\\uA7F7-\\uA801\\uA803-\\uA805\\uA807-\\uA80A\\uA80C-\\uA822\\uA840-\\uA873\\uA882-\\uA8B3\\uA8F2-\\uA8F7\\uA8FB\\uA90A-\\uA925\\uA930-\\uA946\\uA960-\\uA97C\\uA984-\\uA9B2\\uA9CF\\uA9E0-\\uA9E4\\uA9E6-\\uA9EF\\uA9FA-\\uA9FE\\uAA00-\\uAA28\\uAA40-\\uAA42\\uAA44-\\uAA4B\\uAA60-\\uAA76\\uAA7A\\uAA7E-\\uAAAF\\uAAB1\\uAAB5\\uAAB6\\uAAB9-\\uAABD\\uAAC0\\uAAC2\\uAADB-\\uAADD\\uAAE0-\\uAAEA\\uAAF2-\\uAAF4\\uAB01-\\uAB06\\uAB09-\\uAB0E\\uAB11-\\uAB16\\uAB20-\\uAB26\\uAB28-\\uAB2E\\uAB30-\\uAB5A\\uAB5C-\\uAB5F\\uAB64\\uAB65\\uABC0-\\uABE2\\uAC00-\\uD7A3\\uD7B0-\\uD7C6\\uD7CB-\\uD7FB\\uF900-\\uFA6D\\uFA70-\\uFAD9\\uFB00-\\uFB06\\uFB13-\\uFB17\\uFB1D\\uFB1F-\\uFB28\\uFB2A-\\uFB36\\uFB38-\\uFB3C\\uFB3E\\uFB40\\uFB41\\uFB43\\uFB44\\uFB46-\\uFBB1\\uFBD3-\\uFD3D\\uFD50-\\uFD8F\\uFD92-\\uFDC7\\uFDF0-\\uFDFB\\uFE70-\\uFE74\\uFE76-\\uFEFC\\uFF21-\\uFF3A\\uFF41-\\uFF5A\\uFF66-\\uFFBE\\uFFC2-\\uFFC7\\uFFCA-\\uFFCF\\uFFD2-\\uFFD7\\uFFDA-\\uFFDC]"),b_t=new RegExp("[\\xAA\\xB5\\xBA\\xC0-\\xD6\\xD8-\\xF6\\xF8-\\u02C1\\u02C6-\\u02D1\\u02E0-\\u02E4\\u02EC\\u02EE\\u0300-\\u0374\\u0376\\u0377\\u037A-\\u037D\\u037F\\u0386\\u0388-\\u038A\\u038C\\u038E-\\u03A1\\u03A3-\\u03F5\\u03F7-\\u0481\\u0483-\\u0487\\u048A-\\u052F\\u0531-\\u0556\\u0559\\u0561-\\u0587\\u0591-\\u05BD\\u05BF\\u05C1\\u05C2\\u05C4\\u05C5\\u05C7\\u05D0-\\u05EA\\u05F0-\\u05F2\\u0610-\\u061A\\u0620-\\u0669\\u066E-\\u06D3\\u06D5-\\u06DC\\u06DF-\\u06E8\\u06EA-\\u06FC\\u06FF\\u0710-\\u074A\\u074D-\\u07B1\\u07C0-\\u07F5\\u07FA\\u0800-\\u082D\\u0840-\\u085B\\u08A0-\\u08B2\\u08E4-\\u0963\\u0966-\\u096F\\u0971-\\u0983\\u0985-\\u098C\\u098F\\u0990\\u0993-\\u09A8\\u09AA-\\u09B0\\u09B2\\u09B6-\\u09B9\\u09BC-\\u09C4\\u09C7\\u09C8\\u09CB-\\u09CE\\u09D7\\u09DC\\u09DD\\u09DF-\\u09E3\\u09E6-\\u09F1\\u0A01-\\u0A03\\u0A05-\\u0A0A\\u0A0F\\u0A10\\u0A13-\\u0A28\\u0A2A-\\u0A30\\u0A32\\u0A33\\u0A35\\u0A36\\u0A38\\u0A39\\u0A3C\\u0A3E-\\u0A42\\u0A47\\u0A48\\u0A4B-\\u0A4D\\u0A51\\u0A59-\\u0A5C\\u0A5E\\u0A66-\\u0A75\\u0A81-\\u0A83\\u0A85-\\u0A8D\\u0A8F-\\u0A91\\u0A93-\\u0AA8\\u0AAA-\\u0AB0\\u0AB2\\u0AB3\\u0AB5-\\u0AB9\\u0ABC-\\u0AC5\\u0AC7-\\u0AC9\\u0ACB-\\u0ACD\\u0AD0\\u0AE0-\\u0AE3\\u0AE6-\\u0AEF\\u0B01-\\u0B03\\u0B05-\\u0B0C\\u0B0F\\u0B10\\u0B13-\\u0B28\\u0B2A-\\u0B30\\u0B32\\u0B33\\u0B35-\\u0B39\\u0B3C-\\u0B44\\u0B47\\u0B48\\u0B4B-\\u0B4D\\u0B56\\u0B57\\u0B5C\\u0B5D\\u0B5F-\\u0B63\\u0B66-\\u0B6F\\u0B71\\u0B82\\u0B83\\u0B85-\\u0B8A\\u0B8E-\\u0B90\\u0B92-\\u0B95\\u0B99\\u0B9A\\u0B9C\\u0B9E\\u0B9F\\u0BA3\\u0BA4\\u0BA8-\\u0BAA\\u0BAE-\\u0BB9\\u0BBE-\\u0BC2\\u0BC6-\\u0BC8\\u0BCA-\\u0BCD\\u0BD0\\u0BD7\\u0BE6-\\u0BEF\\u0C00-\\u0C03\\u0C05-\\u0C0C\\u0C0E-\\u0C10\\u0C12-\\u0C28\\u0C2A-\\u0C39\\u0C3D-\\u0C44\\u0C46-\\u0C48\\u0C4A-\\u0C4D\\u0C55\\u0C56\\u0C58\\u0C59\\u0C60-\\u0C63\\u0C66-\\u0C6F\\u0C81-\\u0C83\\u0C85-\\u0C8C\\u0C8E-\\u0C90\\u0C92-\\u0CA8\\u0CAA-\\u0CB3\\u0CB5-\\u0CB9\\u0CBC-\\u0CC4\\u0CC6-\\u0CC8\\u0CCA-\\u0CCD\\u0CD5\\u0CD6\\u0CDE\\u0CE0-\\u0CE3\\u0CE6-\\u0CEF\\u0CF1\\u0CF2\\u0D01-\\u0D03\\u0D05-\\u0D0C\\u0D0E-\\u0D10\\u0D12-\\u0D3A\\u0D3D-\\u0D44\\u0D46-\\u0D48\\u0D4A-\\u0D4E\\u0D57\\u0D60-\\u0D63\\u0D66-\\u0D6F\\u0D7A-\\u0D7F\\u0D82\\u0D83\\u0D85-\\u0D96\\u0D9A-\\u0DB1\\u0DB3-\\u0DBB\\u0DBD\\u0DC0-\\u0DC6\\u0DCA\\u0DCF-\\u0DD4\\u0DD6\\u0DD8-\\u0DDF\\u0DE6-\\u0DEF\\u0DF2\\u0DF3\\u0E01-\\u0E3A\\u0E40-\\u0E4E\\u0E50-\\u0E59\\u0E81\\u0E82\\u0E84\\u0E87\\u0E88\\u0E8A\\u0E8D\\u0E94-\\u0E97\\u0E99-\\u0E9F\\u0EA1-\\u0EA3\\u0EA5\\u0EA7\\u0EAA\\u0EAB\\u0EAD-\\u0EB9\\u0EBB-\\u0EBD\\u0EC0-\\u0EC4\\u0EC6\\u0EC8-\\u0ECD\\u0ED0-\\u0ED9\\u0EDC-\\u0EDF\\u0F00\\u0F18\\u0F19\\u0F20-\\u0F29\\u0F35\\u0F37\\u0F39\\u0F3E-\\u0F47\\u0F49-\\u0F6C\\u0F71-\\u0F84\\u0F86-\\u0F97\\u0F99-\\u0FBC\\u0FC6\\u1000-\\u1049\\u1050-\\u109D\\u10A0-\\u10C5\\u10C7\\u10CD\\u10D0-\\u10FA\\u10FC-\\u1248\\u124A-\\u124D\\u1250-\\u1256\\u1258\\u125A-\\u125D\\u1260-\\u1288\\u128A-\\u128D\\u1290-\\u12B0\\u12B2-\\u12B5\\u12B8-\\u12BE\\u12C0\\u12C2-\\u12C5\\u12C8-\\u12D6\\u12D8-\\u1310\\u1312-\\u1315\\u1318-\\u135A\\u135D-\\u135F\\u1380-\\u138F\\u13A0-\\u13F4\\u1401-\\u166C\\u166F-\\u167F\\u1681-\\u169A\\u16A0-\\u16EA\\u16EE-\\u16F8\\u1700-\\u170C\\u170E-\\u1714\\u1720-\\u1734\\u1740-\\u1753\\u1760-\\u176C\\u176E-\\u1770\\u1772\\u1773\\u1780-\\u17D3\\u17D7\\u17DC\\u17DD\\u17E0-\\u17E9\\u180B-\\u180D\\u1810-\\u1819\\u1820-\\u1877\\u1880-\\u18AA\\u18B0-\\u18F5\\u1900-\\u191E\\u1920-\\u192B\\u1930-\\u193B\\u1946-\\u196D\\u1970-\\u1974\\u1980-\\u19AB\\u19B0-\\u19C9\\u19D0-\\u19D9\\u1A00-\\u1A1B\\u1A20-\\u1A5E\\u1A60-\\u1A7C\\u1A7F-\\u1A89\\u1A90-\\u1A99\\u1AA7\\u1AB0-\\u1ABD\\u1B00-\\u1B4B\\u1B50-\\u1B59\\u1B6B-\\u1B73\\u1B80-\\u1BF3\\u1C00-\\u1C37\\u1C40-\\u1C49\\u1C4D-\\u1C7D\\u1CD0-\\u1CD2\\u1CD4-\\u1CF6\\u1CF8\\u1CF9\\u1D00-\\u1DF5\\u1DFC-\\u1F15\\u1F18-\\u1F1D\\u1F20-\\u1F45\\u1F48-\\u1F4D\\u1F50-\\u1F57\\u1F59\\u1F5B\\u1F5D\\u1F5F-\\u1F7D\\u1F80-\\u1FB4\\u1FB6-\\u1FBC\\u1FBE\\u1FC2-\\u1FC4\\u1FC6-\\u1FCC\\u1FD0-\\u1FD3\\u1FD6-\\u1FDB\\u1FE0-\\u1FEC\\u1FF2-\\u1FF4\\u1FF6-\\u1FFC\\u200C\\u200D\\u203F\\u2040\\u2054\\u2071\\u207F\\u2090-\\u209C\\u20D0-\\u20DC\\u20E1\\u20E5-\\u20F0\\u2102\\u2107\\u210A-\\u2113\\u2115\\u2119-\\u211D\\u2124\\u2126\\u2128\\u212A-\\u212D\\u212F-\\u2139\\u213C-\\u213F\\u2145-\\u2149\\u214E\\u2160-\\u2188\\u2C00-\\u2C2E\\u2C30-\\u2C5E\\u2C60-\\u2CE4\\u2CEB-\\u2CF3\\u2D00-\\u2D25\\u2D27\\u2D2D\\u2D30-\\u2D67\\u2D6F\\u2D7F-\\u2D96\\u2DA0-\\u2DA6\\u2DA8-\\u2DAE\\u2DB0-\\u2DB6\\u2DB8-\\u2DBE\\u2DC0-\\u2DC6\\u2DC8-\\u2DCE\\u2DD0-\\u2DD6\\u2DD8-\\u2DDE\\u2DE0-\\u2DFF\\u2E2F\\u3005-\\u3007\\u3021-\\u302F\\u3031-\\u3035\\u3038-\\u303C\\u3041-\\u3096\\u3099\\u309A\\u309D-\\u309F\\u30A1-\\u30FA\\u30FC-\\u30FF\\u3105-\\u312D\\u3131-\\u318E\\u31A0-\\u31BA\\u31F0-\\u31FF\\u3400-\\u4DB5\\u4E00-\\u9FCC\\uA000-\\uA48C\\uA4D0-\\uA4FD\\uA500-\\uA60C\\uA610-\\uA62B\\uA640-\\uA66F\\uA674-\\uA67D\\uA67F-\\uA69D\\uA69F-\\uA6F1\\uA717-\\uA71F\\uA722-\\uA788\\uA78B-\\uA78E\\uA790-\\uA7AD\\uA7B0\\uA7B1\\uA7F7-\\uA827\\uA840-\\uA873\\uA880-\\uA8C4\\uA8D0-\\uA8D9\\uA8E0-\\uA8F7\\uA8FB\\uA900-\\uA92D\\uA930-\\uA953\\uA960-\\uA97C\\uA980-\\uA9C0\\uA9CF-\\uA9D9\\uA9E0-\\uA9FE\\uAA00-\\uAA36\\uAA40-\\uAA4D\\uAA50-\\uAA59\\uAA60-\\uAA76\\uAA7A-\\uAAC2\\uAADB-\\uAADD\\uAAE0-\\uAAEF\\uAAF2-\\uAAF6\\uAB01-\\uAB06\\uAB09-\\uAB0E\\uAB11-\\uAB16\\uAB20-\\uAB26\\uAB28-\\uAB2E\\uAB30-\\uAB5A\\uAB5C-\\uAB5F\\uAB64\\uAB65\\uABC0-\\uABEA\\uABEC\\uABED\\uABF0-\\uABF9\\uAC00-\\uD7A3\\uD7B0-\\uD7C6\\uD7CB-\\uD7FB\\uF900-\\uFA6D\\uFA70-\\uFAD9\\uFB00-\\uFB06\\uFB13-\\uFB17\\uFB1D-\\uFB28\\uFB2A-\\uFB36\\uFB38-\\uFB3C\\uFB3E\\uFB40\\uFB41\\uFB43\\uFB44\\uFB46-\\uFBB1\\uFBD3-\\uFD3D\\uFD50-\\uFD8F\\uFD92-\\uFDC7\\uFDF0-\\uFDFB\\uFE00-\\uFE0F\\uFE20-\\uFE2D\\uFE33\\uFE34\\uFE4D-\\uFE4F\\uFE70-\\uFE74\\uFE76-\\uFEFC\\uFF10-\\uFF19\\uFF21-\\uFF3A\\uFF3F\\uFF41-\\uFF5A\\uFF66-\\uFFBE\\uFFC2-\\uFFC7\\uFFCA-\\uFFCF\\uFFD2-\\uFFD7\\uFFDA-\\uFFDC]");function XN(e,t){if(!e)throw new Error("ASSERT: "+t)}function Nl(e){return e>=48&&e<=57}function uj(e){return"0123456789abcdefABCDEF".indexOf(e)>=0}function Ex(e){return"01234567".indexOf(e)>=0}function x_t(e){return e===32||e===9||e===11||e===12||e===160||e>=5760&&[5760,6158,8192,8193,8194,8195,8196,8197,8198,8199,8200,8201,8202,8239,8287,12288,65279].indexOf(e)>=0}function o2(e){return e===10||e===13||e===8232||e===8233}function K$(e){return e===36||e===95||e>=65&&e<=90||e>=97&&e<=122||e===92||e>=128&&y_t.test(String.fromCharCode(e))}function K_(e){return e===36||e===95||e>=65&&e<=90||e>=97&&e<=122||e>=48&&e<=57||e===92||e>=128&&b_t.test(String.fromCharCode(e))}const v_t={if:1,in:1,do:1,var:1,for:1,new:1,try:1,let:1,this:1,else:1,case:1,void:1,with:1,enum:1,while:1,break:1,catch:1,throw:1,const:1,yield:1,class:1,super:1,return:1,typeof:1,delete:1,switch:1,export:1,import:1,public:1,static:1,default:1,finally:1,extends:1,package:1,private:1,function:1,continue:1,debugger:1,interface:1,protected:1,instanceof:1,implements:1};function bye(){for(;se<Ei;){const e=De.charCodeAt(se);if(x_t(e)||o2(e))++se;else break}}function JL(e){var t,n,r,i=0;for(n=e==="u"?4:2,t=0;t<n;++t)se<Ei&&uj(De[se])?(r=De[se++],i=i*16+"0123456789abcdef".indexOf(r.toLowerCase())):At({},Tr,Hr);return String.fromCharCode(i)}function w_t(){var e,t,n,r;for(e=De[se],t=0,e==="}"&&At({},Tr,Hr);se<Ei&&(e=De[se++],!!uj(e));)t=t*16+"0123456789abcdef".indexOf(e.toLowerCase());return(t>1114111||e!=="}")&&At({},Tr,Hr),t<=65535?String.fromCharCode(t):(n=(t-65536>>10)+55296,r=(t-65536&1023)+56320,String.fromCharCode(n,r))}function xye(){var e,t;for(e=De.charCodeAt(se++),t=String.fromCharCode(e),e===92&&(De.charCodeAt(se)!==117&&At({},Tr,Hr),++se,e=JL("u"),(!e||e==="\\"||!K$(e.charCodeAt(0)))&&At({},Tr,Hr),t=e);se<Ei&&(e=De.charCodeAt(se),!!K_(e));)++se,t+=String.fromCharCode(e),e===92&&(t=t.substr(0,t.length-1),De.charCodeAt(se)!==117&&At({},Tr,Hr),++se,e=JL("u"),(!e||e==="\\"||!K_(e.charCodeAt(0)))&&At({},Tr,Hr),t+=e);return t}function $_t(){var e,t;for(e=se++;se<Ei;){if(t=De.charCodeAt(se),t===92)return se=e,xye();if(K_(t))++se;else break}return De.slice(e,se)}function C_t(){var e,t,n;return e=se,t=De.charCodeAt(se)===92?xye():$_t(),t.length===1?n=jp:v_t.hasOwnProperty(t)?n=Wh:t==="null"?n=qN:t==="true"||t==="false"?n=HN:n=jp,{type:n,value:t,start:e,end:se}}function sR(){var e=se,t=De.charCodeAt(se),n,r=De[se],i,s,o;switch(t){case 46:case 40:case 41:case 59:case 44:case 123:case 125:case 91:case 93:case 58:case 63:case 126:return++se,{type:ds,value:String.fromCharCode(t),start:e,end:se};default:if(n=De.charCodeAt(se+1),n===61)switch(t){case 43:case 45:case 47:case 60:case 62:case 94:case 124:case 37:case 38:case 42:return se+=2,{type:ds,value:String.fromCharCode(t)+String.fromCharCode(n),start:e,end:se};case 33:case 61:return se+=2,De.charCodeAt(se)===61&&++se,{type:ds,value:De.slice(e,se),start:e,end:se}}}if(o=De.substr(se,4),o===">>>=")return se+=4,{type:ds,value:o,start:e,end:se};if(s=o.substr(0,3),s===">>>"||s==="<<="||s===">>=")return se+=3,{type:ds,value:s,start:e,end:se};if(i=s.substr(0,2),r===i[1]&&"+-<>&|".indexOf(r)>=0||i==="=>")return se+=2,{type:ds,value:i,start:e,end:se};if(i==="//"&&At({},Tr,Hr),"<>=!+-*%&|^/".indexOf(r)>=0)return++se,{type:ds,value:r,start:e,end:se};At({},Tr,Hr)}function S_t(e){let t="";for(;se<Ei&&uj(De[se]);)t+=De[se++];return t.length===0&&At({},Tr,Hr),K$(De.charCodeAt(se))&&At({},Tr,Hr),{type:Lg,value:parseInt("0x"+t,16),start:e,end:se}}function k_t(e){let t="0"+De[se++];for(;se<Ei&&Ex(De[se]);)t+=De[se++];return(K$(De.charCodeAt(se))||Nl(De.charCodeAt(se)))&&At({},Tr,Hr),{type:Lg,value:parseInt(t,8),octal:!0,start:e,end:se}}function zZ(){var e,t,n;if(n=De[se],XN(Nl(n.charCodeAt(0))||n===".","Numeric literal must start with a decimal digit or a decimal point"),t=se,e="",n!=="."){if(e=De[se++],n=De[se],e==="0"){if(n==="x"||n==="X")return++se,S_t(t);if(Ex(n))return k_t(t);n&&Nl(n.charCodeAt(0))&&At({},Tr,Hr)}for(;Nl(De.charCodeAt(se));)e+=De[se++];n=De[se]}if(n==="."){for(e+=De[se++];Nl(De.charCodeAt(se));)e+=De[se++];n=De[se]}if(n==="e"||n==="E")if(e+=De[se++],n=De[se],(n==="+"||n==="-")&&(e+=De[se++]),Nl(De.charCodeAt(se)))for(;Nl(De.charCodeAt(se));)e+=De[se++];else At({},Tr,Hr);return K$(De.charCodeAt(se))&&At({},Tr,Hr),{type:Lg,value:parseFloat(e),start:t,end:se}}function E_t(){var e="",t,n,r,i,s=!1;for(t=De[se],XN(t==="'"||t==='"',"String literal must starts with a quote"),n=se,++se;se<Ei;)if(r=De[se++],r===t){t="";break}else if(r==="\\")if(r=De[se++],!r||!o2(r.charCodeAt(0)))switch(r){case"u":case"x":De[se]==="{"?(++se,e+=w_t()):e+=JL(r);break;case"n":e+=`
`;break;case"r":e+="\r";break;case"t":e+="	";break;case"b":e+="\b";break;case"f":e+="\f";break;case"v":e+="\v";break;default:Ex(r)?(i="01234567".indexOf(r),i!==0&&(s=!0),se<Ei&&Ex(De[se])&&(s=!0,i=i*8+"01234567".indexOf(De[se++]),"0123".indexOf(r)>=0&&se<Ei&&Ex(De[se])&&(i=i*8+"01234567".indexOf(De[se++]))),e+=String.fromCharCode(i)):e+=r;break}else r==="\r"&&De[se]===`
`&&++se;else{if(o2(r.charCodeAt(0)))break;e+=r}return t!==""&&At({},Tr,Hr),{type:Y$,value:e,octal:s,start:n,end:se}}function __t(e,t){let n=e;t.indexOf("u")>=0&&(n=n.replace(/\\u\{([0-9a-fA-F]+)\}/g,(r,i)=>{if(parseInt(i,16)<=1114111)return"x";At({},ZL)}).replace(/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,"x"));try{new RegExp(n)}catch{At({},ZL)}try{return new RegExp(e,t)}catch{return null}}function A_t(){var e,t,n,r,i;for(e=De[se],XN(e==="/","Regular expression literal must start with a slash"),t=De[se++],n=!1,r=!1;se<Ei;)if(e=De[se++],t+=e,e==="\\")e=De[se++],o2(e.charCodeAt(0))&&At({},iR),t+=e;else if(o2(e.charCodeAt(0)))At({},iR);else if(n)e==="]"&&(n=!1);else if(e==="/"){r=!0;break}else e==="["&&(n=!0);return r||At({},iR),i=t.substr(1,t.length-2),{value:i,literal:t}}function T_t(){var e,t,n;for(t="",n="";se<Ei&&(e=De[se],!!K_(e.charCodeAt(0)));)++se,e==="\\"&&se<Ei?At({},Tr,Hr):(n+=e,t+=e);return n.search(/[^gimuy]/g)>=0&&At({},ZL,n),{value:n,literal:t}}function I_t(){var e,t,n,r;return Wt=null,bye(),e=se,t=A_t(),n=T_t(),r=__t(t.value,n.value),{literal:t.literal+n.literal,value:r,regex:{pattern:t.value,flags:n.value},start:e,end:se}}function D_t(e){return e.type===jp||e.type===Wh||e.type===HN||e.type===qN}function vye(){if(bye(),se>=Ei)return{type:X$,start:se,end:se};const e=De.charCodeAt(se);return K$(e)?C_t():e===40||e===41||e===59?sR():e===39||e===34?E_t():e===46?Nl(De.charCodeAt(se+1))?zZ():sR():Nl(e)?zZ():sR()}function xs(){const e=Wt;return se=e.end,Wt=vye(),se=e.end,e}function wye(){const e=se;Wt=vye(),se=e}function N_t(e){const t=new qa(t_t);return t.elements=e,t}function UZ(e,t,n){const r=new qa(e==="||"||e==="&&"?o_t:n_t);return r.operator=e,r.left=t,r.right=n,r}function F_t(e,t){const n=new qa(r_t);return n.callee=e,n.arguments=t,n}function O_t(e,t,n){const r=new qa(i_t);return r.test=e,r.consequent=t,r.alternate=n,r}function lj(e){const t=new qa(mye);return t.name=e,t}function nx(e){const t=new qa(s_t);return t.value=e.value,t.raw=De.slice(e.start,e.end),e.regex&&(t.raw==="//"&&(t.raw="/(?:)/"),t.regex=e.regex),t}function jZ(e,t,n){const r=new qa(a_t);return r.computed=e==="[",r.object=t,r.property=n,r.computed||(n.member=!0),r}function R_t(e){const t=new qa(u_t);return t.properties=e,t}function WZ(e,t,n){const r=new qa(l_t);return r.key=t,r.value=n,r.kind=e,r}function M_t(e,t){const n=new qa(c_t);return n.operator=e,n.argument=t,n.prefix=!0,n}function At(e,t){var n,r=Array.prototype.slice.call(arguments,2),i=t.replace(/%(\d)/g,(s,o)=>(XN(o<r.length,"Message reference must be in range"),r[o]));throw n=new Error(i),n.index=se,n.description=i,n}function YN(e){e.type===X$&&At(e,g_t),e.type===Lg&&At(e,f_t),e.type===Y$&&At(e,h_t),e.type===jp&&At(e,d_t),e.type===Wh&&At(e,p_t),At(e,Tr,e.value)}function _i(e){const t=xs();(t.type!==ds||t.value!==e)&&YN(t)}function hn(e){return Wt.type===ds&&Wt.value===e}function oR(e){return Wt.type===Wh&&Wt.value===e}function L_t(){const e=[];for(se=Wt.start,_i("[");!hn("]");)hn(",")?(xs(),e.push(null)):(e.push(Wp()),hn("]")||_i(","));return xs(),N_t(e)}function VZ(){se=Wt.start;const e=xs();return e.type===Y$||e.type===Lg?(e.octal&&At(e,yye),nx(e)):lj(e.value)}function P_t(){var e,t,n,r;if(se=Wt.start,e=Wt,e.type===jp)return n=VZ(),_i(":"),r=Wp(),WZ("init",n,r);if(e.type===X$||e.type===ds)YN(e);else return t=VZ(),_i(":"),r=Wp(),WZ("init",t,r)}function B_t(){var e=[],t,n,r,i={},s=String;for(se=Wt.start,_i("{");!hn("}");)t=P_t(),t.key.type===mye?n=t.key.name:n=s(t.key.value),r="$"+n,Object.prototype.hasOwnProperty.call(i,r)?At({},m_t):i[r]=!0,e.push(t),hn("}")||_i(",");return _i("}"),R_t(e)}function z_t(){_i("(");const e=cj();return _i(")"),e}const U_t={if:1};function j_t(){var e,t,n;if(hn("("))return z_t();if(hn("["))return L_t();if(hn("{"))return B_t();if(e=Wt.type,se=Wt.start,e===jp||U_t[Wt.value])n=lj(xs().value);else if(e===Y$||e===Lg)Wt.octal&&At(Wt,yye),n=nx(xs());else{if(e===Wh)throw new Error(s2);e===HN?(t=xs(),t.value=t.value==="true",n=nx(t)):e===qN?(t=xs(),t.value=null,n=nx(t)):hn("/")||hn("/=")?(n=nx(I_t()),wye()):YN(xs())}return n}function W_t(){const e=[];if(_i("("),!hn(")"))for(;se<Ei&&(e.push(Wp()),!hn(")"));)_i(",");return _i(")"),e}function V_t(){se=Wt.start;const e=xs();return D_t(e)||YN(e),lj(e.value)}function G_t(){return _i("."),V_t()}function H_t(){_i("[");const e=cj();return _i("]"),e}function q_t(){var e,t,n;for(e=j_t();;)if(hn("."))n=G_t(),e=jZ(".",e,n);else if(hn("("))t=W_t(),e=F_t(e,t);else if(hn("["))n=H_t(),e=jZ("[",e,n);else break;return e}function GZ(){const e=q_t();if(Wt.type===ds&&(hn("++")||hn("--")))throw new Error(s2);return e}function wk(){var e,t;if(Wt.type!==ds&&Wt.type!==Wh)t=GZ();else{if(hn("++")||hn("--"))throw new Error(s2);if(hn("+")||hn("-")||hn("~")||hn("!"))e=xs(),t=wk(),t=M_t(e.value,t);else{if(oR("delete")||oR("void")||oR("typeof"))throw new Error(s2);t=GZ()}}return t}function HZ(e){let t=0;if(e.type!==ds&&e.type!==Wh)return 0;switch(e.value){case"||":t=1;break;case"&&":t=2;break;case"|":t=3;break;case"^":t=4;break;case"&":t=5;break;case"==":case"!=":case"===":case"!==":t=6;break;case"<":case">":case"<=":case">=":case"instanceof":case"in":t=7;break;case"<<":case">>":case">>>":t=8;break;case"+":case"-":t=9;break;case"*":case"/":case"%":t=11;break}return t}function X_t(){var e,t,n,r,i,s,o,a,u,l;if(e=Wt,u=wk(),r=Wt,i=HZ(r),i===0)return u;for(r.prec=i,xs(),t=[e,Wt],o=wk(),s=[u,r,o];(i=HZ(Wt))>0;){for(;s.length>2&&i<=s[s.length-2].prec;)o=s.pop(),a=s.pop().value,u=s.pop(),t.pop(),n=UZ(a,u,o),s.push(n);r=xs(),r.prec=i,s.push(r),t.push(Wt),n=wk(),s.push(n)}for(l=s.length-1,n=s[l],t.pop();l>1;)t.pop(),n=UZ(s[l-1].value,s[l-2],n),l-=2;return n}function Wp(){var e,t,n;return e=X_t(),hn("?")&&(xs(),t=Wp(),_i(":"),n=Wp(),e=O_t(e,t,n)),e}function cj(){const e=Wp();if(hn(","))throw new Error(s2);return e}function Y_t(e){De=e,se=0,Ei=De.length,Wt=null,wye();const t=cj();if(Wt.type!==X$)throw new Error("Unexpect token after expression.");return t}var K_t={NaN:"NaN",E:"Math.E",LN2:"Math.LN2",LN10:"Math.LN10",LOG2E:"Math.LOG2E",LOG10E:"Math.LOG10E",PI:"Math.PI",SQRT1_2:"Math.SQRT1_2",SQRT2:"Math.SQRT2",MIN_VALUE:"Number.MIN_VALUE",MAX_VALUE:"Number.MAX_VALUE"};function Z_t(e){function t(o,a,u,l){let c=e(a[0]);return u&&(c=u+"("+c+")",u.lastIndexOf("new ",0)===0&&(c="("+c+")")),c+"."+o+(l<0?"":l===0?"()":"("+a.slice(1).map(e).join(",")+")")}function n(o,a,u){return l=>t(o,l,a,u)}const r="new Date",i="String",s="RegExp";return{isNaN:"Number.isNaN",isFinite:"Number.isFinite",abs:"Math.abs",acos:"Math.acos",asin:"Math.asin",atan:"Math.atan",atan2:"Math.atan2",ceil:"Math.ceil",cos:"Math.cos",exp:"Math.exp",floor:"Math.floor",log:"Math.log",max:"Math.max",min:"Math.min",pow:"Math.pow",random:"Math.random",round:"Math.round",sin:"Math.sin",sqrt:"Math.sqrt",tan:"Math.tan",clamp:function(o){o.length<3&&le("Missing arguments to clamp function."),o.length>3&&le("Too many arguments to clamp function.");const a=o.map(e);return"Math.max("+a[1]+", Math.min("+a[2]+","+a[0]+"))"},now:"Date.now",utc:"Date.UTC",datetime:r,date:n("getDate",r,0),day:n("getDay",r,0),year:n("getFullYear",r,0),month:n("getMonth",r,0),hours:n("getHours",r,0),minutes:n("getMinutes",r,0),seconds:n("getSeconds",r,0),milliseconds:n("getMilliseconds",r,0),time:n("getTime",r,0),timezoneoffset:n("getTimezoneOffset",r,0),utcdate:n("getUTCDate",r,0),utcday:n("getUTCDay",r,0),utcyear:n("getUTCFullYear",r,0),utcmonth:n("getUTCMonth",r,0),utchours:n("getUTCHours",r,0),utcminutes:n("getUTCMinutes",r,0),utcseconds:n("getUTCSeconds",r,0),utcmilliseconds:n("getUTCMilliseconds",r,0),length:n("length",null,-1),parseFloat:"parseFloat",parseInt:"parseInt",upper:n("toUpperCase",i,0),lower:n("toLowerCase",i,0),substring:n("substring",i),split:n("split",i),trim:n("trim",i,0),regexp:s,test:n("test",s),if:function(o){o.length<3&&le("Missing arguments to if function."),o.length>3&&le("Too many arguments to if function.");const a=o.map(e);return"("+a[0]+"?"+a[1]+":"+a[2]+")"}}}function J_t(e){const t=e&&e.length-1;return t&&(e[0]==='"'&&e[t]==='"'||e[0]==="'"&&e[t]==="'")?e.slice(1,-1):e}function Q_t(e){e=e||{};const t=e.allowed?cc(e.allowed):{},n=e.forbidden?cc(e.forbidden):{},r=e.constants||K_t,i=(e.functions||Z_t)(f),s=e.globalvar,o=e.fieldvar,a=zt(s)?s:p=>"".concat(s,'["').concat(p,'"]');let u={},l={},c=0;function f(p){if(mn(p))return p;const g=h[p.type];return g==null&&le("Unsupported type: "+p.type),g(p)}const h={Literal:p=>p.raw,Identifier:p=>{const g=p.name;return c>0?g:nt(n,g)?le("Illegal identifier: "+g):nt(r,g)?r[g]:nt(t,g)?g:(u[g]=1,a(g))},MemberExpression:p=>{const g=!p.computed,m=f(p.object);g&&(c+=1);const y=f(p.property);return m===o&&(l[J_t(y)]=1),g&&(c-=1),m+(g?"."+y:"["+y+"]")},CallExpression:p=>{p.callee.type!=="Identifier"&&le("Illegal callee type: "+p.callee.type);const g=p.callee.name,m=p.arguments,y=nt(i,g)&&i[g];return y||le("Unrecognized function: "+g),zt(y)?y(m):y+"("+m.map(f).join(",")+")"},ArrayExpression:p=>"["+p.elements.map(f).join(",")+"]",BinaryExpression:p=>"("+f(p.left)+" "+p.operator+" "+f(p.right)+")",UnaryExpression:p=>"("+p.operator+f(p.argument)+")",ConditionalExpression:p=>"("+f(p.test)+"?"+f(p.consequent)+":"+f(p.alternate)+")",LogicalExpression:p=>"("+f(p.left)+p.operator+f(p.right)+")",ObjectExpression:p=>"{"+p.properties.map(f).join(",")+"}",Property:p=>{c+=1;const g=f(p.key);return c-=1,g+":"+f(p.value)}};function d(p){const g={code:f(p),globals:Object.keys(u),fields:Object.keys(l)};return u={},l={},g}return d.functions=i,d.constants=r,d}const eAt="view",Z_="[",J_="]",$ye="{",Cye="}",tAt=":",Sye=",",nAt="@",rAt=">",iAt=/[[\]{}]/,sAt={"*":1,arc:1,area:1,group:1,image:1,line:1,path:1,rect:1,rule:1,shape:1,symbol:1,text:1,trail:1};let kye,Eye;function Pg(e,t,n){return kye=t||eAt,Eye=n||sAt,_ye(e.trim()).map(QL)}function oAt(e){return Eye[e]}function _x(e,t,n,r,i){const s=e.length;let o=0,a;for(;t<s;++t){if(a=e[t],!o&&a===n)return t;i&&i.indexOf(a)>=0?--o:r&&r.indexOf(a)>=0&&++o}return t}function _ye(e){const t=[],n=e.length;let r=0,i=0;for(;i<n;)i=_x(e,i,Sye,Z_+$ye,J_+Cye),t.push(e.substring(r,i).trim()),r=++i;if(t.length===0)throw"Empty event selector: "+e;return t}function QL(e){return e[0]==="["?aAt(e):uAt(e)}function aAt(e){const t=e.length;let n=1,r;if(n=_x(e,n,J_,Z_,J_),n===t)throw"Empty between selector: "+e;if(r=_ye(e.substring(1,n)),r.length!==2)throw"Between selector must have two elements: "+e;if(e=e.slice(n+1).trim(),e[0]!==rAt)throw"Expected '>' after between selector: "+e;r=r.map(QL);const i=QL(e.slice(1).trim());return i.between?{between:r,stream:i}:(i.between=r,i)}function uAt(e){const t={source:kye},n=[];let r=[0,0],i=0,s=0,o=e.length,a=0,u,l;if(e[o-1]===Cye){if(a=e.lastIndexOf($ye),a>=0){try{r=lAt(e.substring(a+1,o-1))}catch{throw"Invalid throttle specification: "+e}e=e.slice(0,a).trim(),o=e.length}else throw"Unmatched right brace: "+e;a=0}if(!o)throw e;if(e[0]===nAt&&(i=++a),u=_x(e,a,tAt),u<o&&(n.push(e.substring(s,u).trim()),s=a=++u),a=_x(e,a,Z_),a===o)n.push(e.substring(s,o).trim());else if(n.push(e.substring(s,a).trim()),l=[],s=++a,s===o)throw"Unmatched left bracket: "+e;for(;a<o;){if(a=_x(e,a,J_),a===o)throw"Unmatched left bracket: "+e;if(l.push(e.substring(s,a).trim()),a<o-1&&e[++a]!==Z_)throw"Expected left bracket: "+e;s=++a}if(!(o=n.length)||iAt.test(n[o-1]))throw"Invalid event selector: "+e;return o>1?(t.type=n[1],i?t.markname=n[0].slice(1):oAt(n[0])?t.marktype=n[0]:t.source=n[0]):t.type=n[0],t.type.slice(-1)==="!"&&(t.consume=!0,t.type=t.type.slice(0,-1)),l!=null&&(t.filter=l),r[0]&&(t.throttle=r[0]),r[1]&&(t.debounce=r[1]),t}function lAt(e){const t=e.split(Sye);if(!e.length||t.length>2)throw e;return t.map(n=>{const r=+n;if(r!==r)throw e;return r})}var cAt="vega",fAt="5.20.0",hAt="The Vega visualization grammar.",dAt=["vega","visualization","interaction","dataflow","library","data","d3"],pAt="BSD-3-Clause",gAt="UW Interactive Data Lab (http://idl.cs.washington.edu)",mAt="build/vega-node.js",yAt="build/vega.module.js",bAt="build/vega.min.js",xAt="build/vega.min.js",vAt="index.d.ts",wAt="vega/vega",$At={bundle:"rollup -c --config-bundle",prebuild:"rimraf build && rimraf build-es5",build:"rollup -c --config-core --config-bundle --config-ie",postbuild:"node schema-copy",pretest:"yarn build --config-test",test:"TZ=America/Los_Angeles tape 'test/**/*-test.js'",prepublishOnly:"yarn test && yarn build",postpublish:"./schema-deploy.sh"},CAt={"vega-crossfilter":"~4.0.5","vega-dataflow":"~5.7.3","vega-encode":"~4.8.3","vega-event-selector":"~2.0.6","vega-expression":"~4.0.1","vega-force":"~4.0.7","vega-format":"~1.0.4","vega-functions":"~5.12.0","vega-geo":"~4.3.8","vega-hierarchy":"~4.0.9","vega-label":"~1.0.0","vega-loader":"~4.4.0","vega-parser":"~6.1.3","vega-projection":"~1.4.5","vega-regression":"~1.0.9","vega-runtime":"~6.1.3","vega-scale":"~7.1.1","vega-scenegraph":"~4.9.4","vega-statistics":"~1.7.9","vega-time":"~2.0.4","vega-transforms":"~4.9.3","vega-typings":"~0.20.0","vega-util":"~1.16.1","vega-view":"~5.10.0","vega-view-transforms":"~4.5.8","vega-voronoi":"~4.1.5","vega-wordcloud":"~4.1.3"},SAt={"vega-schema":"*"},kAt="f262105e75449760b0f35fda70e6b576a31d68a4",EAt={name:cAt,version:fAt,description:hAt,keywords:dAt,license:pAt,author:gAt,main:mAt,module:yAt,unpkg:bAt,jsdelivr:xAt,types:vAt,repository:wAt,scripts:$At,dependencies:CAt,devDependencies:SAt,gitHead:kAt};yt(s0,aet,Jat,Qct,Pht,Ndt,H1t,Rpt,X1t,fyt,Cxt,Ixt);const _At=EAt.version,AAt=Object.freeze(Object.defineProperty({__proto__:null,Bounds:Ji,CanvasHandler:M$,CanvasRenderer:R_,DATE:Ds,DAY:gi,DAYOFYEAR:zu,Dataflow:Fm,Debug:Mae,Error:Fae,EventStream:rD,Gradient:rme,GroupItem:m9,HOURS:so,Handler:dh,Info:Rae,Item:g9,MILLISECONDS:Ra,MINUTES:oo,MONTH:Ci,Marks:jo,MultiPulse:U6,None:Nae,Operator:en,Parameters:nD,Pulse:kf,QUARTER:Is,RenderType:gf,Renderer:il,ResourceLoader:y9,SECONDS:zo,SVGHandler:O9,SVGRenderer:z9,SVGStringRenderer:U9,Scenegraph:N9,TIME_UNITS:dz,Transform:re,View:F1e,WEEK:ar,Warn:Oae,YEAR:Yr,accessor:Yo,accessorFields:wi,accessorName:Nn,array:et,ascending:HI,bandwidthNRD:G6,bin:Jue,bootstrapCI:Que,boundClip:b1t,boundContext:N$,boundItem:yL,boundMark:$me,boundStroke:Tg,changeset:xg,clampRange:QXe,codegenExpression:Q_t,compare:Vae,constant:Bo,cumulativeLogNormal:Z6,cumulativeNormal:sD,cumulativeUniform:tz,dayofyear:wle,debounce:Gae,defaultLocale:Kge,definition:Uue,densityLogNormal:K6,densityNormal:H6,densityUniform:ez,domChild:ys,domClear:ba,domCreate:df,domFind:F9,dotbin:ele,error:le,expressionFunction:er,extend:yt,extent:qf,extentIndex:Hae,falsy:Wc,fastmap:ry,field:Gf,flush:sYe,font:cN,fontFamily:R$,fontSize:rl,format:sk,formatLocale:E_,formats:l9,hasOwnProperty:nt,id:VXe,identity:Po,inferType:Jge,inferTypes:Qge,ingest:Ot,inherits:$e,inrange:oYe,interpolate:b7,interpolateColors:ZD,interpolateRange:Bde,intersect:qme,intersectBoxLine:$m,intersectPath:b9,intersectPoint:x9,intersectRule:fme,isArray:it,isBoolean:qae,isDate:qI,isFunction:zt,isIterable:Xae,isNumber:kp,isObject:dt,isRegExp:aYe,isString:mn,isTuple:eD,key:Yae,lerp:uYe,lineHeight:fh,loader:c9,locale:Yge,logger:GXe,lruCache:Kae,markup:B9,merge:Zae,mergeConfig:jI,multiLineOffset:T0t,one:ty,pad:cYe,panLinear:qXe,panLog:XXe,panPow:YXe,panSymlog:KXe,parse:zEt,parseExpression:Y_t,parseSelector:Pg,pathCurves:h9,pathEqual:Zme,pathParse:A0,pathRectangle:ome,pathRender:jv,pathSymbols:sme,pathTrail:ame,peek:Kt,point:hN,projection:N7,quantileLogNormal:J6,quantileNormal:oD,quantileUniform:nz,quantiles:W6,quantizeInterpolator:zde,quarter:ZXe,quartiles:V6,get random(){return Oa},randomInteger:zJe,randomKDE:X6,randomLCG:BJe,randomLogNormal:nle,randomMixture:rle,randomNormal:q6,randomUniform:ile,read:qgt,regressionExp:ole,regressionLinear:rz,regressionLoess:lle,regressionLog:sle,regressionPoly:ule,regressionPow:ale,regressionQuad:iz,renderModule:dN,repeat:Fb,resetDefaultLocale:_gt,resetSVGClipId:lme,resetSVGDefIds:w1t,responseType:Hgt,runtimeContext:v1e,sampleCurve:uD,sampleLogNormal:Y6,sampleNormal:iD,sampleUniform:Q6,scale:Rt,sceneEqual:j9,sceneFromJSON:Sme,scenePickVisit:T_,sceneToJSON:Cme,sceneVisit:Ma,sceneZOrder:v9,scheme:x7,serializeXML:Bme,setRandom:LJe,span:XI,splitAccessPath:UI,stringValue:He,textMetrics:Iu,timeBin:Ple,timeFloor:Ale,timeFormatLocale:Uv,timeInterval:cy,timeOffset:Dle,timeSequence:Ole,timeUnitSpecifier:vle,timeUnits:pz,toBoolean:Jae,toDate:Qae,toNumber:Hf,toSet:cc,toString:eue,transform:jue,transforms:s0,truncate:hYe,truthy:ny,tupleid:Pe,typeParsers:fL,utcFloor:Tle,utcInterval:fy,utcOffset:Nle,utcSequence:Rle,utcdayofyear:Sle,utcquarter:JXe,utcweek:kle,version:_At,visitArray:dYe,week:$le,writeConfig:WI,zero:Qc,zoomLinear:Uae,zoomLog:jae,zoomPow:_M,zoomSymlog:Wae},Symbol.toStringTag,{value:"Module"})),TAt="vega-lite",IAt='Dominik Moritz, Kanit "Ham" Wongsuphasawat, Arvind Satyanarayan, Jeffrey Heer',DAt="4.13.1",NAt=["Kanit Wongsuphasawat (http://kanitw.yellowpigz.com)","Dominik Moritz (https://www.domoritz.de)","Arvind Satyanarayan (https://arvindsatya.com)","Jeffrey Heer (https://jheer.org)"],FAt="https://vega.github.io/vega-lite/",OAt="Vega-Lite is a concise high-level language for interactive visualization.",RAt="build/vega-lite.js",MAt="build/vega-lite.min.js",LAt="build/vega-lite.min.js",PAt="build/src/index",BAt="build/src/index.d.ts",zAt={vl2png:"./bin/vl2png",vl2svg:"./bin/vl2svg",vl2pdf:"./bin/vl2pdf",vl2vg:"./bin/vl2vg"},UAt={test:"test"},jAt={changelog:"conventional-changelog -p angular -r 2",build:"yarn build:only","build:only":"yarn tsc:src && rollup -c",postbuild:"terser build/vega-lite.js -cm --source-map content=build/vega-lite.js.map,filename=build/vega-lite.min.js.map -o build/vega-lite.min.js && yarn schema && babel build/vega-lite.js --out-dir build-es5 --config-file ./babel.config.js","prebuild:examples":"yarn build:only","build:examples":"yarn data && TZ=America/Los_Angeles scripts/build-examples.sh","prebuild:examples-full":"yarn build:only","build:examples-full":"TZ=America/Los_Angeles scripts/build-examples.sh 1","build:example":"TZ=America/Los_Angeles scripts/build-example.sh","build:toc":"yarn build:jekyll && scripts/generate-toc","build:site":"yarn tsc:site && rollup -c site/rollup.config.js","build:jekyll":"pushd site && bundle exec jekyll build -q && popd","build:versions":"scripts/update-version.sh",clean:"find build ! -name 'vega-lite-schema.json' -type f -delete && rm -rf site/data/* && rm -f examples/compiled/*.png && find site/examples ! -name 'index.md' ! -name 'data' -type f -delete","predeploy:site":"yarn presite","deploy:site":"gh-pages -d site",data:"rsync -r node_modules/vega-datasets/data/* site/data",schema:"mkdir -p build && ts-json-schema-generator -f tsconfig.json -p src/index.ts -t TopLevelSpec --no-type-check --no-ref-encode > build/vega-lite-schema.json && yarn renameschema && cp build/vega-lite-schema.json site/_data/",renameschema:"scripts/rename-schema.sh",presite:"yarn data && yarn schema && yarn build:site && yarn build:versions && scripts/create-example-pages.sh",site:"pushd site && bundle exec jekyll serve -I -l && popd","tsc:src":"tsc -b src/tsconfig.src.json","tsc:site":"tsc -b site/tsconfig.site.json",prettierbase:"prettier '**/*.{md,css,yml}'",eslintbase:"eslint .",format:"yarn eslintbase --fix && yarn prettierbase --write",lint:"yarn eslintbase && yarn prettierbase --check",test:"jest test/ && yarn lint && yarn schema && jest examples/ && yarn test:runtime","test:inspect":"node --inspect-brk ./node_modules/.bin/jest --runInBand test","test:runtime":"TZ=America/Los_Angeles jest test-runtime/","test:runtime:generate":"yarn build:only && rm -Rf test-runtime/resources && VL_GENERATE_TESTS=true yarn test:runtime","watch:build":"yarn build:only && concurrently --kill-others -n Typescript,Rollup 'yarn tsc:src -w' 'rollup -c -w'","watch:site":"concurrently --kill-others -n Typescript,Rollup 'yarn tsc:site -w' 'rollup -c site/rollup.config.js -w'","watch:test":"jest --watch"},WAt={type:"git",url:"https://github.com/vega/vega-lite.git"},VAt="BSD-3-Clause",GAt={url:"https://github.com/vega/vega-lite/issues"},HAt={"@babel/cli":"^7.10.1","@babel/core":"^7.10.1","@babel/preset-env":"^7.10.1","@rollup/plugin-commonjs":"12.0.0","@rollup/plugin-json":"^4.0.3","@rollup/plugin-node-resolve":"^8.0.0","@types/chai":"^4.2.11","@types/d3":"^5.7.2","@types/jest":"^25.2.3","@types/mkdirp":"^1.0.0","@types/puppeteer":"^3.0.0","@typescript-eslint/eslint-plugin":"^3.0.2","@typescript-eslint/parser":"^3.0.2",ajv:"^6.12.2",chai:"^4.2.0",cheerio:"^1.0.0-rc.3",codecov:"^3.7.0",concurrently:"^5.2.0","conventional-changelog-cli":"^2.0.34",d3:"^5.16.0",eslint:"^7.1.0","eslint-config-prettier":"^6.11.0","eslint-plugin-jest":"^23.13.2","eslint-plugin-prettier":"^3.1.3","gh-pages":"^2.2.0","highlight.js":"^10.0.3","http-server":"^0.12.3",jest:"^26.0.1","jest-puppeteer":"^4.4.0",mkdirp:"^1.0.4",prettier:"^2.0.5",puppeteer:"^3.1.0",rollup:"^2.11.0","rollup-plugin-sourcemaps":"^0.6.2","rollup-plugin-terser":"^6.1.0","svg2png-many":"^0.0.7",terser:"^4.7.0","ts-jest":"^26.0.0","ts-json-schema-generator":"^0.68.1",typescript:"~3.9.3","vega-cli":"^5.12.1","vega-datasets":"^1.30.2","vega-embed":"^6.8.0","vega-tooltip":"^0.23.0","vega-typings":"^0.17.0","yaml-front-matter":"^4.1.0"},qAt={"@types/clone":"~0.1.30","@types/fast-json-stable-stringify":"^2.0.0","array-flat-polyfill":"^1.0.1",clone:"~2.1.2","fast-deep-equal":"~3.1.1","fast-json-stable-stringify":"~2.1.0","json-stringify-pretty-compact":"~2.0.0",tslib:"~2.0.0","vega-event-selector":"~2.0.3","vega-expression":"~2.6.5","vega-util":"~1.14.0",yargs:"~15.3.1"},XAt={vega:"^5.12.1"},YAt={preset:"jest-puppeteer",transform:{"^.+\\.tsx?$":"ts-jest"},testRegex:"(/__tests__/.*|(\\.|/)(test|spec))\\.(jsx?|tsx?)$",moduleFileExtensions:["ts","tsx","js","jsx","json","node"],testPathIgnorePatterns:["<rootDir>/node_modules","<rootDir>/build","<rootDir>/_site","<rootDir>/src"],coverageDirectory:"./coverage/",collectCoverage:!1},KAt={name:TAt,author:IAt,version:DAt,collaborators:NAt,homepage:FAt,description:OAt,main:RAt,unpkg:MAt,jsdelivr:LAt,module:PAt,types:BAt,bin:zAt,directories:UAt,scripts:jAt,repository:WAt,license:VAt,bugs:GAt,devDependencies:HAt,dependencies:qAt,peerDependencies:XAt,jest:YAt};function Ay(e,t,n){return e.fields=t||[],e.fname=n,e}function ZAt(e){return e.length===1?JAt(e[0]):QAt(e)}const JAt=e=>function(t){return t[e]},QAt=e=>{const t=e.length;return function(n){for(let r=0;r<t;++r)n=n[e[r]];return n}};function aR(e){throw Error(e)}function Bg(e){var t=[],n=null,r=0,i=e.length,s="",o,a,u;e=e+"";function l(){t.push(s+e.substring(o,a)),s="",o=a+1}for(o=a=0;a<i;++a)if(u=e[a],u==="\\")s+=e.substring(o,a),s+=e.substring(++a,++a),o=a;else if(u===n)l(),n=null,r=-1;else{if(n)continue;o===r&&u==='"'||o===r&&u==="'"?(o=a+1,n=u):u==="."&&!r?a>o?l():o=a+1:u==="["?(a>o&&l(),r=o=a+1):u==="]"&&(r||aR("Access path missing open bracket: "+e),r>0&&l(),r=0,o=a+1)}return r&&aR("Access path missing closing bracket: "+e),n&&aR("Access path missing closing quote: "+e),a>o&&(a++,l()),t}function eTt(e,t,n){const r=Bg(e);return e=r.length===1?r[0]:e,Ay((n&&n.get||ZAt)(r),[e],t||e)}var Z$=[];eTt("id");var tTt=Ay(function(e){return e},Z$,"identity");Ay(function(){return 0},Z$,"zero");Ay(function(){return 1},Z$,"one");Ay(function(){return!0},Z$,"true");Ay(function(){return!1},Z$,"false");function AS(e,t,n){var r=[t].concat([].slice.call(n));console[e].apply(console,r)}var nTt=0,rTt=1,Aye=2,iTt=3,sTt=4;function oTt(e,t){var n=e||nTt;return{level:function(r){return arguments.length?(n=+r,this):n},error:function(){return n>=rTt&&AS(t||"error","ERROR",arguments),this},warn:function(){return n>=Aye&&AS(t||"warn","WARN",arguments),this},info:function(){return n>=iTt&&AS(t||"log","INFO",arguments),this},debug:function(){return n>=sTt&&AS(t||"log","DEBUG",arguments),this}}}const je=Array.isArray;function Dr(e){return e===Object(e)}const qZ=e=>e!=="__proto__";function Tye(...e){return e.reduce((t,n)=>{for(var r in n)if(r==="signals")t.signals=aTt(t.signals,n.signals);else{var i=r==="legend"?{layout:1}:r==="style"?!0:null;fj(t,r,n[r],i)}return t},{})}function fj(e,t,n,r){if(qZ(t)){var i,s;if(Dr(n)&&!je(n)){s=Dr(e[t])?e[t]:e[t]={};for(i in n)r&&(r===!0||r[i])?fj(s,i,n[i]):qZ(i)&&(s[i]=n[i])}else e[t]=n}}function aTt(e,t){if(e==null)return t;const n={},r=[];function i(s){n[s.name]||(n[s.name]=1,r.push(s))}return t.forEach(i),e.forEach(i),r}function jn(e){return e!=null?je(e)?e:[e]:[]}function uTt(e){return typeof e=="function"}const lTt=Object.prototype.hasOwnProperty;function Hd(e,t){return lTt.call(e,t)}function J$(e){return typeof e=="boolean"}function Zn(e){return typeof e=="number"}function ft(e){return typeof e=="string"}function Ct(e){return je(e)?"["+e.map(Ct)+"]":Dr(e)||ft(e)?JSON.stringify(e).replace("\u2028","\\u2028").replace("\u2029","\\u2029"):e}function zg(e){for(var t={},n=0,r=e.length;n<r;++n)t[e[n]]=!0;return t}/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */function Be(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]]);return n}Array.prototype.flat||Object.defineProperty(Array.prototype,"flat",{configurable:!0,value:function e(){var t=isNaN(arguments[0])?1:Number(arguments[0]);return t?Array.prototype.reduce.call(this,function(n,r){return Array.isArray(r)?n.push.apply(n,e.call(r,t-1)):n.push(r),n},[]):Array.prototype.slice.call(this)},writable:!0}),Array.prototype.flatMap||Object.defineProperty(Array.prototype,"flatMap",{configurable:!0,value:function(e){return Array.prototype.map.apply(this,arguments).flat()},writable:!0});var Iye={exports:{}};(function(e){var t=function(){function n(h,d){return d!=null&&h instanceof d}var r;try{r=Map}catch{r=function(){}}var i;try{i=Set}catch{i=function(){}}var s;try{s=Promise}catch{s=function(){}}function o(h,d,p,g,m){typeof d=="object"&&(p=d.depth,g=d.prototype,m=d.includeNonEnumerable,d=d.circular);var y=[],b=[],v=typeof Buffer<"u";typeof d>"u"&&(d=!0),typeof p>"u"&&(p=1/0);function x(w,C){if(w===null)return null;if(C===0)return w;var $,S;if(typeof w!="object")return w;if(n(w,r))$=new r;else if(n(w,i))$=new i;else if(n(w,s))$=new s(function(R,L){w.then(function(P){R(x(P,C-1))},function(P){L(x(P,C-1))})});else if(o.__isArray(w))$=[];else if(o.__isRegExp(w))$=new RegExp(w.source,f(w)),w.lastIndex&&($.lastIndex=w.lastIndex);else if(o.__isDate(w))$=new Date(w.getTime());else{if(v&&Buffer.isBuffer(w))return Buffer.allocUnsafe?$=Buffer.allocUnsafe(w.length):$=new Buffer(w.length),w.copy($),$;n(w,Error)?$=Object.create(w):typeof g>"u"?(S=Object.getPrototypeOf(w),$=Object.create(S)):($=Object.create(g),S=g)}if(d){var k=y.indexOf(w);if(k!=-1)return b[k];y.push(w),b.push($)}n(w,r)&&w.forEach(function(R,L){var P=x(L,C-1),q=x(R,C-1);$.set(P,q)}),n(w,i)&&w.forEach(function(R){var L=x(R,C-1);$.add(L)});for(var E in w){var _;S&&(_=Object.getOwnPropertyDescriptor(S,E)),!(_&&_.set==null)&&($[E]=x(w[E],C-1))}if(Object.getOwnPropertySymbols)for(var D=Object.getOwnPropertySymbols(w),E=0;E<D.length;E++){var A=D[E],T=Object.getOwnPropertyDescriptor(w,A);T&&!T.enumerable&&!m||($[A]=x(w[A],C-1),T.enumerable||Object.defineProperty($,A,{enumerable:!1}))}if(m)for(var I=Object.getOwnPropertyNames(w),E=0;E<I.length;E++){var F=I[E],T=Object.getOwnPropertyDescriptor(w,F);T&&T.enumerable||($[F]=x(w[F],C-1),Object.defineProperty($,F,{enumerable:!1}))}return $}return x(h,p)}o.clonePrototype=function(d){if(d===null)return null;var p=function(){};return p.prototype=d,new p};function a(h){return Object.prototype.toString.call(h)}o.__objToStr=a;function u(h){return typeof h=="object"&&a(h)==="[object Date]"}o.__isDate=u;function l(h){return typeof h=="object"&&a(h)==="[object Array]"}o.__isArray=l;function c(h){return typeof h=="object"&&a(h)==="[object RegExp]"}o.__isRegExp=c;function f(h){var d="";return h.global&&(d+="g"),h.ignoreCase&&(d+="i"),h.multiline&&(d+="m"),d}return o.__getRegExpFlags=f,o}();e.exports&&(e.exports=t)})(Iye);var cTt=Iye.exports;const fTt=k2(cTt);var hTt=function e(t,n){if(t===n)return!0;if(t&&n&&typeof t=="object"&&typeof n=="object"){if(t.constructor!==n.constructor)return!1;var r,i,s;if(Array.isArray(t)){if(r=t.length,r!=n.length)return!1;for(i=r;i--!==0;)if(!e(t[i],n[i]))return!1;return!0}if(t.constructor===RegExp)return t.source===n.source&&t.flags===n.flags;if(t.valueOf!==Object.prototype.valueOf)return t.valueOf()===n.valueOf();if(t.toString!==Object.prototype.toString)return t.toString()===n.toString();if(s=Object.keys(t),r=s.length,r!==Object.keys(n).length)return!1;for(i=r;i--!==0;)if(!Object.prototype.hasOwnProperty.call(n,s[i]))return!1;for(i=r;i--!==0;){var o=s[i];if(!e(t[o],n[o]))return!1}return!0}return t!==t&&n!==n};const dTt=k2(hTt);var pTt=function(e,t){t||(t={}),typeof t=="function"&&(t={cmp:t});var n=typeof t.cycles=="boolean"?t.cycles:!1,r=t.cmp&&function(s){return function(o){return function(a,u){var l={key:a,value:o[a]},c={key:u,value:o[u]};return s(l,c)}}}(t.cmp),i=[];return function s(o){if(o&&o.toJSON&&typeof o.toJSON=="function"&&(o=o.toJSON()),o!==void 0){if(typeof o=="number")return isFinite(o)?""+o:"null";if(typeof o!="object")return JSON.stringify(o);var a,u;if(Array.isArray(o)){for(u="[",a=0;a<o.length;a++)a&&(u+=","),u+=s(o[a])||"null";return u+"]"}if(o===null)return"null";if(i.indexOf(o)!==-1){if(n)return JSON.stringify("__cycle__");throw new TypeError("Converting circular structure to JSON")}var l=i.push(o)-1,c=Object.keys(o).sort(r&&r(o));for(u="",a=0;a<c.length;a++){var f=c[a],h=s(o[f]);h&&(u&&(u+=","),u+=JSON.stringify(f)+":"+h)}return i.splice(l,1),"{"+u+"}"}}(e)};const a2=k2(pTt);function hj(e){return!!e.or}function dj(e){return!!e.and}function pj(e){return!!e.not}function $k(e,t){if(pj(e))$k(e.not,t);else if(dj(e))for(const n of e.and)$k(n,t);else if(hj(e))for(const n of e.or)$k(n,t);else t(e)}function Ck(e,t){return pj(e)?{not:Ck(e.not,t)}:dj(e)?{and:e.and.map(n=>Ck(n,t))}:hj(e)?{or:e.or.map(n=>Ck(n,t))}:t(e)}const Q$=dTt,ht=fTt;function u2(e,t){const n={};for(const r of t)Hd(e,r)&&(n[r]=e[r]);return n}function tc(e,t){const n=Object.assign({},e);for(const r of t)delete n[r];return n}Set.prototype.toJSON=function(){return`Set(${[...this].map(e=>a2(e)).join(",")})`};const xn=a2;function Et(e){if(Zn(e))return e;const t=ft(e)?e:a2(e);if(t.length<250)return t;let n=0;for(let r=0;r<t.length;r++){const i=t.charCodeAt(r);n=(n<<5)-n+i,n=n&n}return n}function XZ(e){return e===!1||e===null}function Ve(e,t){return e.indexOf(t)>-1}function l2(e,t){let n=0;for(const[r,i]of e.entries())if(t(i,r,n++))return!0;return!1}function Dye(e,t){let n=0;for(const[r,i]of e.entries())if(!t(i,r,n++))return!1;return!0}function gTt(e,...t){for(const n of t)mTt(e,n??{});return e}function mTt(e,t){for(const n of be(t))fj(e,n,t[n],!0)}function bf(e,t){const n=[],r={};let i;for(const s of e)i=t(s),!(i in r)&&(r[i]=1,n.push(s));return n}function yTt(e,t){if(e.size!==t.size)return!1;for(const n of e)if(!t.has(n))return!1;return!0}function Nye(e,t){for(const n of e)if(t.has(n))return!0;return!1}function YZ(e){const t=new Set;for(const n of e){const i=Bg(n).map((o,a)=>a===0?o:`[${o}]`),s=i.map((o,a)=>i.slice(0,a+1).join(""));for(const o of s)t.add(o)}return t}function Fye(e,t){return e===void 0||t===void 0?!0:Nye(YZ(e),YZ(t))}function tn(e){return be(e).length===0}const be=Object.keys,Df=Object.values;function Oye(e){const t=[];for(const n in e)Hd(e,n)&&t.push({key:n,value:e[n]});return t}function Q_(e){return e===!0||e===!1}function wn(e){const t=e.replace(/\W/g,"_");return(e.match(/^\d+/)?"_":"")+t}function Ax(e,t){return pj(e)?"!("+Ax(e.not,t)+")":dj(e)?"("+e.and.map(n=>Ax(n,t)).join(") && (")+")":hj(e)?"("+e.or.map(n=>Ax(n,t)).join(") || (")+")":t(e)}function eP(e,t){if(t.length===0)return!0;const n=t.shift();return n in e&&eP(e[n],t)&&delete e[n],tn(e)}function KN(e){return e.charAt(0).toUpperCase()+e.substr(1)}function Rye(e,t="datum"){const n=Bg(e),r=[];for(let i=1;i<=n.length;i++){const s=`[${n.slice(0,i).map(Ct).join("][")}]`;r.push(`${t}${s}`)}return r.join(" && ")}function bTt(e,t="datum"){return`${t}[${Ct(Bg(e).join("."))}]`}function xTt(e){return e.replace(/(\[|\]|\.|'|")/g,"\\$1")}function mh(e){return`${Bg(e).map(xTt).join("\\.")}`}function M0(e,t,n){return e.replace(new RegExp(t.replace(/[-/\\^$*+?.()|[\]{}]/g,"\\$&"),"g"),n)}function Mye(e){return`${Bg(e).join(".")}`}function c2(e){return e?Bg(e).length:0}function Jn(...e){for(const t of e)if(t!==void 0)return t}let vTt=42;function wTt(e){const t=++vTt;return e?String(e)+t:t}function $Tt(e){return CTt(e)?e:`__${e}`}function CTt(e){return e.indexOf("__")===0}function eA(e){if(e!==void 0)return(e%360+360)%360}function gj(e){return Zn(e)?!0:!isNaN(e)&&!isNaN(parseFloat(e))}const KZ={domainColor:{part:"domain",vgProp:"stroke"},labelAlign:{part:"labels",vgProp:"align"},labelBaseline:{part:"labels",vgProp:"baseline"},labelColor:{part:"labels",vgProp:"fill"},labelFont:{part:"labels",vgProp:"font"},labelFontSize:{part:"labels",vgProp:"fontSize"},labelFontStyle:{part:"labels",vgProp:"fontStyle"},labelFontWeight:{part:"labels",vgProp:"fontWeight"},labelOpacity:{part:"labels",vgProp:"opacity"},labelOffset:null,labelPadding:null,gridColor:{part:"grid",vgProp:"stroke"},gridDash:{part:"grid",vgProp:"strokeDash"},gridDashOffset:{part:"grid",vgProp:"strokeDash"},gridOpacity:{part:"grid",vgProp:"opacity"},gridWidth:{part:"grid",vgProp:"strokeWidth"},tickColor:{part:"ticks",vgProp:"stroke"},tickDash:{part:"ticks",vgProp:"strokeDash"},tickDashOffset:{part:"ticks",vgProp:"strokeDash"},tickOpacity:{part:"ticks",vgProp:"opacity"},tickSize:null,tickWidth:{part:"ticks",vgProp:"strokeWidth"},titleColor:{part:"title",vgProp:"fill"},title:null};function mj(e){return e&&e.condition}const Lye=["domain","grid","labels","ticks","title"],STt={grid:"grid",gridCap:"grid",gridColor:"grid",gridDash:"grid",gridDashOffset:"grid",gridOpacity:"grid",gridScale:"grid",gridWidth:"grid",orient:"main",bandPosition:"both",aria:"main",description:"main",domain:"main",domainCap:"main",domainColor:"main",domainDash:"main",domainDashOffset:"main",domainOpacity:"main",domainWidth:"main",format:"main",formatType:"main",labelAlign:"main",labelAngle:"main",labelBaseline:"main",labelBound:"main",labelColor:"main",labelFlush:"main",labelFlushOffset:"main",labelFont:"main",labelFontSize:"main",labelFontStyle:"main",labelFontWeight:"main",labelLimit:"main",labelLineHeight:"main",labelOffset:"main",labelOpacity:"main",labelOverlap:"main",labelPadding:"main",labels:"main",labelSeparation:"main",maxExtent:"main",minExtent:"main",offset:"both",position:"main",tickCap:"main",tickColor:"main",tickDash:"main",tickDashOffset:"main",tickMinStep:"main",tickOffset:"both",tickOpacity:"main",tickRound:"both",ticks:"main",tickSize:"main",tickWidth:"both",title:"main",titleAlign:"main",titleAnchor:"main",titleAngle:"main",titleBaseline:"main",titleColor:"main",titleFont:"main",titleFontSize:"main",titleFontStyle:"main",titleFontWeight:"main",titleLimit:"main",titleLineHeight:"main",titleOpacity:"main",titlePadding:"main",titleX:"main",titleY:"main",encode:"both",scale:"both",tickBand:"both",tickCount:"both",tickExtra:"both",translate:"both",values:"both",zindex:"both"},Pye={orient:1,aria:1,bandPosition:1,description:1,domain:1,domainCap:1,domainColor:1,domainDash:1,domainDashOffset:1,domainOpacity:1,domainWidth:1,format:1,formatType:1,grid:1,gridCap:1,gridColor:1,gridDash:1,gridDashOffset:1,gridOpacity:1,gridWidth:1,labelAlign:1,labelAngle:1,labelBaseline:1,labelBound:1,labelColor:1,labelFlush:1,labelFlushOffset:1,labelFont:1,labelFontSize:1,labelFontStyle:1,labelFontWeight:1,labelLimit:1,labelLineHeight:1,labelOffset:1,labelOpacity:1,labelOverlap:1,labelPadding:1,labels:1,labelSeparation:1,maxExtent:1,minExtent:1,offset:1,position:1,tickBand:1,tickCap:1,tickColor:1,tickCount:1,tickDash:1,tickDashOffset:1,tickExtra:1,tickMinStep:1,tickOffset:1,tickOpacity:1,tickRound:1,ticks:1,tickSize:1,tickWidth:1,title:1,titleAlign:1,titleAnchor:1,titleAngle:1,titleBaseline:1,titleColor:1,titleFont:1,titleFontSize:1,titleFontStyle:1,titleFontWeight:1,titleLimit:1,titleLineHeight:1,titleOpacity:1,titlePadding:1,titleX:1,titleY:1,translate:1,values:1,zindex:1},kTt=Object.assign(Object.assign({},Pye),{style:1,labelExpr:1,encoding:1});function ZZ(e){return!!kTt[e]}const is={arc:"arc",area:"area",bar:"bar",image:"image",line:"line",point:"point",rect:"rect",rule:"rule",text:"text",tick:"tick",trail:"trail",circle:"circle",square:"square",geoshape:"geoshape"},Bye=is.arc,ZN=is.area,JN=is.bar,ETt=is.image,QN=is.line,eF=is.point,_Tt=is.rect,tA=is.rule,zye=is.text,yj=is.tick,ATt=is.trail,bj=is.circle,xj=is.square,Uye=is.geoshape;function Ug(e){return Ve(["line","area","trail"],e)}function JZ(e){return Ve(["rect","bar","image","arc"],e)}const jye=be(is);function Hu(e){return e.type}zg(jye);const TTt=["stroke","strokeWidth","strokeDash","strokeDashOffset","strokeOpacity","strokeJoin","strokeMiterLimit"],ITt=["fill","fillOpacity"],DTt=[...TTt,...ITt],NTt={color:1,filled:1,invalid:1,order:1,radius2:1,theta2:1,timeUnitBand:1,timeUnitBandPosition:1},QZ=be(NTt),FTt={area:["line","point"],bar:["binSpacing","continuousBandSize","discreteBandSize"],rect:["binSpacing","continuousBandSize","discreteBandSize"],line:["point"],tick:["bandSize","thickness"]},OTt={color:"#4c78a8",invalid:"filter",timeUnitBand:1},RTt={horizontal:["cornerRadiusTopRight","cornerRadiusBottomRight"],vertical:["cornerRadiusTopLeft","cornerRadiusTopRight"]},Wye=5,MTt={binSpacing:1,continuousBandSize:Wye,timeUnitBandPosition:.5},LTt={binSpacing:0,continuousBandSize:Wye,timeUnitBandPosition:.5},PTt={thickness:1};function BTt(e){return Hu(e)?e.type:e}function Dc(e){return"mark"in e}class tF{constructor(t,n){this.name=t,this.run=n}hasMatchingType(t){return Dc(t)?BTt(t.mark)===this.name:!1}}const zTt={argmax:1,argmin:1,average:1,count:1,distinct:1,product:1,max:1,mean:1,median:1,min:1,missing:1,q1:1,q3:1,ci0:1,ci1:1,stderr:1,stdev:1,stdevp:1,sum:1,valid:1,values:1,variance:1,variancep:1},UTt={count:1,min:1,max:1};function yh(e){return!!e&&!!e.argmin}function jg(e){return!!e&&!!e.argmax}function vj(e){return ft(e)&&!!zTt[e]}const jTt=["count","valid","missing","distinct"];function Vye(e){return ft(e)&&Ve(jTt,e)}function WTt(e){return ft(e)&&Ve(["min","max"],e)}const VTt=["count","sum","distinct","valid","missing"],GTt=["mean","average","median","q1","q3","min","max"],HTt=zg(GTt),nc="row",rc="column",nF="facet",_n="x",fr="y",Xa="x2",cl="y2",fl="radius",Nc="radius2",Ya="theta",Fc="theta2",hl="latitude",dl="longitude",Ka="latitude2",Wo="longitude2",Os="color",pl="fill",gl="stroke",Rs="shape",Oc="size",Wg="angle",Rc="opacity",Vh="fillOpacity",Gh="strokeOpacity",Hh="strokeWidth",qh="strokeDash",eC="text",tC="order",nC="detail",rF="key",Vp="tooltip",iF="href",sF="url",oF="description",qTt={x:1,y:1,x2:1,y2:1},Gye={theta:1,theta2:1,radius:1,radius2:1};function Hye(e){return e in Gye}const wj={longitude:1,longitude2:1,latitude:1,latitude2:1};function XTt(e){switch(e){case hl:return"y";case Ka:return"y2";case dl:return"x";case Wo:return"x2"}}function YTt(e){return e in wj}const KTt=be(wj),qye=Object.assign(Object.assign(Object.assign(Object.assign({},qTt),Gye),wj),{color:1,fill:1,stroke:1,opacity:1,fillOpacity:1,strokeOpacity:1,strokeWidth:1,strokeDash:1,size:1,angle:1,shape:1,order:1,text:1,detail:1,key:1,tooltip:1,href:1,url:1,description:1});function Bm(e){return e===Os||e===pl||e===gl}const Xye={row:1,column:1,facet:1},No=be(Xye),$j=Object.assign(Object.assign({},qye),Xye),Yye=be($j),ZTt=Be($j,["order","detail","tooltip"]),JTt=Be(ZTt,["row","column","facet"]);function QTt(e){return!!JTt[e]}function Kye(e){return!!$j[e]}const eIt=[Xa,cl,Ka,Wo,Fc,Nc];function Zye(e){return Vg(e)!==e}function Vg(e){switch(e){case Xa:return _n;case cl:return fr;case Ka:return hl;case Wo:return dl;case Fc:return Ya;case Nc:return fl}return e}function bh(e){if(Hye(e))switch(e){case Ya:return"startAngle";case Fc:return"endAngle";case fl:return"outerRadius";case Nc:return"innerRadius"}return e}function ml(e){switch(e){case _n:return Xa;case fr:return cl;case hl:return Ka;case dl:return Wo;case Ya:return Fc;case fl:return Nc}}function yl(e){switch(e){case _n:case Xa:return"width";case fr:case cl:return"height"}}function tIt(e){switch(e){case _n:return"xOffset";case fr:return"yOffset";case Xa:return"x2Offset";case cl:return"y2Offset";case Ya:return"thetaOffset";case fl:return"radiusOffset";case Fc:return"theta2Offset";case Nc:return"radius2Offset"}}const Cj=Be(qye,["x","y","x2","y2","latitude","longitude","latitude2","longitude2","theta","theta2","radius","radius2"]),nIt=be(Cj),Xh={x:1,y:1},Vo=be(Xh);function qu(e){return e in Xh}const Sj={theta:1,radius:1},rIt=be(Sj);function aF(e){return e==="width"?_n:fr}const Jye=Be(Cj,["text","tooltip","href","url","description","detail","key","order"]),iIt=be(Jye);function sIt(e){return!!Cj[e]}function oIt(e){switch(e){case Os:case pl:case gl:case Oc:case Rs:case Rc:case Hh:case qh:return!0;case Vh:case Gh:case Wg:return!1}}const Qye=Object.assign(Object.assign(Object.assign({},Xh),Sj),Jye),uF=be(Qye);function Yh(e){return!!Qye[e]}function aIt(e,t){return lIt(e)[t]}const ebe={arc:"always",area:"always",bar:"always",circle:"always",geoshape:"always",image:"always",line:"always",rule:"always",point:"always",rect:"always",square:"always",trail:"always",text:"always",tick:"always"},uIt=Be(ebe,["geoshape"]);function lIt(e){switch(e){case Os:case pl:case gl:case oF:case nC:case rF:case Vp:case iF:case tC:case Rc:case Vh:case Gh:case Hh:case nF:case nc:case rc:return ebe;case _n:case fr:case hl:case dl:return uIt;case Xa:case cl:case Ka:case Wo:return{area:"always",bar:"always",image:"always",rect:"always",rule:"always",circle:"binned",point:"binned",square:"binned",tick:"binned",line:"binned",trail:"binned"};case Oc:return{point:"always",tick:"always",rule:"always",circle:"always",square:"always",bar:"always",text:"always",line:"always",trail:"always"};case qh:return{line:"always",point:"always",tick:"always",rule:"always",circle:"always",square:"always",bar:"always",geoshape:"always"};case Rs:return{point:"always",geoshape:"always"};case eC:return{text:"always"};case Wg:return{point:"always",square:"always",text:"always"};case sF:return{image:"always"};case Ya:return{text:"always",arc:"always"};case fl:return{text:"always",arc:"always"};case Fc:case Nc:return{arc:"always"}}}function Sk(e){switch(e){case _n:case fr:case Ya:case fl:case Oc:case Wg:case Hh:case Rc:case Vh:case Gh:case Xa:case cl:case Fc:case Nc:return;case nF:case nc:case rc:case Rs:case qh:case eC:case Vp:case iF:case sF:case oF:return"discrete";case Os:case pl:case gl:return"flexible";case hl:case dl:case Ka:case Wo:case nC:case rF:case tC:return}}function tbe(e){return J$(e)&&(e=gF(e,void 0)),"bin"+be(e).map(t=>lF(e[t])?wn(`_${t}_${Object.entries(e[t])}`):wn(`_${t}_${e[t]}`)).join("")}function ln(e){return e===!0||rC(e)&&!e.binned}function ji(e){return e==="binned"||rC(e)&&e.binned===!0}function rC(e){return Dr(e)}function lF(e){return e==null?void 0:e.selection}function eJ(e){switch(e){case nc:case rc:case Oc:case Os:case pl:case gl:case Hh:case Rc:case Vh:case Gh:case Rs:return 6;case qh:return 4;default:return 10}}function kj(e){return`Invalid specification ${JSON.stringify(e)}. Make sure the specification includes at least one of the following properties: "mark", "layer", "facet", "hconcat", "vconcat", "concat", or "repeat".`}const cIt='Autosize "fit" only works for single views and layered views.';function tJ(e){return`${e=="width"?"Width":"Height"} "container" only works for single views and layered views.`}function nJ(e){const t=e=="width"?"Width":"Height",n=e=="width"?"x":"y";return`${t} "container" only works well with autosize "fit" or "fit-${n}".`}function rJ(e){return e?`Dropping "fit-${e}" because spec has discrete ${yl(e)}.`:'Dropping "fit" because spec has discrete size.'}function iJ(e){return`Cannot project a selection on encoding channel "${e}", which has no field.`}function fIt(e,t){return`Cannot project a selection on encoding channel "${e}" as it uses an aggregate function ("${t}").`}function hIt(e){return`The "nearest" transform is not supported for ${e} marks.`}function nbe(e){return`Selection not supported for ${e} yet.`}function dIt(e){return`Cannot find a selection named "${e}".`}const pIt="Scale bindings are currently only supported for scales with unbinned, continuous domains.",gIt="Legend bindings are only supported for selections over an individual field or encoding channel.";function mIt(e){return`Cannot define and lookup the "${e}" selection in the same view. Try moving the lookup into a second, layered view?`}function yIt(e){return`Unknown repeated value "${e}".`}function sJ(e){return`The "columns" property cannot be used when "${e}" has nested row/column.`}const bIt="Axes cannot be shared in concatenated or repeated views yet (https://github.com/vega/vega-lite/issues/2415).";function xIt(e){return`Unrecognized parse "${e}".`}function oJ(e,t,n){return`An ancestor parsed field "${e}" as ${n} but a child wants to parse the field as ${t}.`}function vIt(e){return`Ignoring an invalid transform: ${xn(e)}.`}const wIt='If "from.fields" is not specified, "as" has to be a string that specifies the key to be used for the data from the secondary source.';function aJ(e){return`Config.customFormatTypes is not true, thus custom format type and format for channel ${e} are dropped.`}function $It(e){return`Layer's shared ${e.join(",")} channel ${e.length===1?"is":"are"} overriden.`}function CIt(e){const{parentProjection:t,projection:n}=e;return`Layer's shared projection ${xn(t)} is overridden by a child projection ${xn(n)}.`}const SIt="Arc marks uses theta channel rather than angle, replacing angle with theta.";function kIt(e,t,n){return`Channel ${e} is a ${t}. Converted to {value: ${xn(n)}}.`}function rbe(e){return`Invalid field type "${e}".`}function EIt(e,t){return`Invalid field type "${e}" for aggregate: "${t}", using "quantitative" instead.`}function _It(e){return`Invalid aggregation operator "${e}".`}function AIt(e,t){return`Missing type for channel "${e}", using "${t}" instead.`}function ibe(e,t){const{fill:n,stroke:r}=t;return`Dropping color ${e} as the plot also has ${n&&r?"fill and stroke":n?"fill":"stroke"}.`}function tP(e,t){return`Dropping ${xn(e)} from channel "${t}" since it does not contain any data field, datum, value, or signal.`}const TIt="Line marks cannot encode size with a non-groupby field. You may want to use trail marks instead.";function cF(e,t,n){return`${e} dropped as it is incompatible with "${t}"${n?` when ${n}`:""}.`}function IIt(e){return`${e}-encoding is dropped as ${e} is not a valid encoding channel.`}function DIt(e){return`${e} encoding should be discrete (ordinal / nominal / binned).`}function NIt(e){return`Facet encoding dropped as ${e.join(" and ")} ${e.length>1?"are":"is"} also specified.`}function uR(e,t){return`Using discrete channel "${e}" to encode "${t}" field can be misleading as it does not encode ${t==="ordinal"?"order":"magnitude"}.`}function FIt(e,t){return`Line mark is for continuous lines and thus cannot be used with ${e&&t?"x2 and y2":e?"x2":"y2"}. We will use the rule mark (line segments) instead.`}function OIt(e,t){return`Specified orient "${e}" overridden with "${t}".`}const RIt=`Scale's "rangeStep" is deprecated and will be removed in Vega-Lite 5.0. Please use "width"/"height": {"step": ...} instead. See https://vega.github.io/vega-lite/docs/size.html.`;function MIt(e){return`Cannot use the scale property "${e}" with non-color channel.`}function LIt(e){return`Using unaggregated domain with raw field has no effect (${xn(e)}).`}function PIt(e){return`Unaggregated domain not applicable for "${e}" since it produces values outside the origin domain of the source data.`}function BIt(e){return`Unaggregated domain is currently unsupported for log scale (${xn(e)}).`}function zIt(e){return`Cannot apply size to non-oriented mark "${e}".`}function UIt(e,t,n){return`Channel "${e}" does not work with "${t}" scale. We are using "${n}" scale instead.`}function jIt(e,t){return`FieldDef does not work with "${e}" scale. We are using "${t}" scale instead.`}function sbe(e,t,n){return`${n}-scale's "${t}" is dropped as it does not work with ${e} scale.`}function obe(e){return`The step for "${e}" is dropped because the ${e==="width"?"x":"y"} is continuous.`}function WIt(e,t,n,r){return`Conflicting ${t.toString()} property "${e.toString()}" (${xn(n)} and ${xn(r)}). Using ${xn(n)}.`}function VIt(e,t,n,r){return`Conflicting ${t.toString()} property "${e.toString()}" (${xn(n)} and ${xn(r)}). Using the union of the two domains.`}function GIt(e){return`Setting the scale to be independent for "${e}" means we also have to set the guide (axis or legend) to be independent.`}function HIt(e){return`Dropping sort property ${xn(e)} as unioned domains only support boolean or op "count", "min", and "max".`}const uJ="Domains that should be unioned has conflicting sort properties. Sort will be set to true.",qIt="Detected faceted independent scales that union domain of multiple fields from different data sources. We will use the first field. The result view size may be incorrect.",XIt="Detected faceted independent scales that union domain of the same fields from different source. We will assume that this is the same field from a different fork of the same data source. However, if this is not the case, the result view size may be incorrect.",YIt="Detected faceted independent scales that union domain of multiple fields from the same data source. We will use the first field. The result view size may be incorrect.";function KIt(e){return`Cannot stack "${e}" if there is already "${e}2".`}function ZIt(e){return`Cannot stack non-linear scale (${e}).`}function JIt(e){return`Stacking is applied even though the aggregate function is non-summative ("${e}").`}function nA(e,t){return`Invalid ${e}: ${xn(t)}.`}function QIt(e){return`Dropping day from datetime ${xn(e)} as day cannot be combined with other units.`}function eDt(e,t){return`${t?"extent ":""}${t&&e?"and ":""}${e?"center ":""}${t&&e?"are ":"is "}not needed when data are aggregated.`}function tDt(e,t,n){return`${e} is not usually used with ${t} for ${n}.`}function nDt(e,t){return`Continuous axis should not have customized aggregation function ${e}; ${t} already agregates the axis.`}function rDt(e,t){return`Center is not needed to be specified in ${t} when extent is ${e}.`}function lJ(e){return`1D error band does not support ${e}.`}function abe(e){return`Channel ${e} is required for "binned" bin.`}function iDt(e){return`Domain for ${e} is required for threshold scale.`}const ube=oTt(Aye);let L0=ube;function sDt(e){return L0=e,L0}function oDt(){return L0=ube,L0}function pe(...e){L0.warn(...e)}function aDt(...e){L0.debug(...e)}function Ty(e){if(e&&Dr(e)){for(const t of _j)if(t in e)return!0}return!1}const lbe=["january","february","march","april","may","june","july","august","september","october","november","december"],uDt=lbe.map(e=>e.substr(0,3)),cbe=["sunday","monday","tuesday","wednesday","thursday","friday","saturday"],lDt=cbe.map(e=>e.substr(0,3));function cDt(e){if(gj(e)&&(e=+e),Zn(e))return e>4&&pe(nA("quarter",e)),e-1;throw new Error(nA("quarter",e))}function fDt(e){if(gj(e)&&(e=+e),Zn(e))return e-1;{const t=e.toLowerCase(),n=lbe.indexOf(t);if(n!==-1)return n;const r=t.substr(0,3),i=uDt.indexOf(r);if(i!==-1)return i;throw new Error(nA("month",e))}}function hDt(e){if(gj(e)&&(e=+e),Zn(e))return e%7;{const t=e.toLowerCase(),n=cbe.indexOf(t);if(n!==-1)return n;const r=t.substr(0,3),i=lDt.indexOf(r);if(i!==-1)return i;throw new Error(nA("day",e))}}function Ej(e,t){const n=[];if(t&&e.day!==void 0&&be(e).length>1&&(pe(QIt(e)),e=ht(e),delete e.day),e.year!==void 0?n.push(e.year):n.push(2012),e.month!==void 0){const r=t?fDt(e.month):e.month;n.push(r)}else if(e.quarter!==void 0){const r=t?cDt(e.quarter):e.quarter;n.push(Zn(r)?r*3:r+"*3")}else n.push(0);if(e.date!==void 0)n.push(e.date);else if(e.day!==void 0){const r=t?hDt(e.day):e.day;n.push(Zn(r)?r+1:r+"+1")}else n.push(1);for(const r of["hours","minutes","seconds","milliseconds"]){const i=e[r];n.push(typeof i>"u"?0:i)}return n}function f2(e){const n=Ej(e,!0).join(", ");return e.utc?`utc(${n})`:`datetime(${n})`}function dDt(e){const n=Ej(e,!1).join(", ");return e.utc?`utc(${n})`:`datetime(${n})`}function pDt(e){const t=Ej(e,!0);return e.utc?+new Date(Date.UTC(...t)):+new Date(...t)}const fbe={year:1,quarter:1,month:1,week:1,day:1,dayofyear:1,date:1,hours:1,minutes:1,seconds:1,milliseconds:1},_j=be(fbe);function gDt(e){return!!fbe[e]}function Aj(e){return e.startsWith("utc")}function mDt(e){return e.substr(3)}const yDt={"year-month":"%b %Y ","year-month-date":"%b %d, %Y "};function Tj(e){const t=[];for(const n of _j)hbe(e,n)&&t.push(n);return t}function hbe(e,t){const n=e.indexOf(t);return!(n<0||n>0&&t==="seconds"&&e.charAt(n-1)==="i"||e.length>n+3&&t==="day"&&e.charAt(n+3)==="o"||n>0&&t==="year"&&e.charAt(n-1)==="f")}function bDt(e,t,{end:n}={end:!1}){const r=Rye(t),i=Aj(e)?"utc":"";function s(u){return u==="quarter"?`(${i}quarter(${r})-1)`:`${i}${u}(${r})`}let o;const a={};for(const u of _j)hbe(e,u)&&(a[u]=s(u),o=u);return n&&(a[o]+="+1"),dDt(a)}function dbe(e){if(!e)return;const t=Tj(e);return`timeUnitSpecifier(${a2(t)}, ${a2(yDt)})`}function xDt(e,t,n){if(!e)return;const r=dbe(e);return`${n||Aj(e)?"utc":"time"}Format(${t}, ${r})`}function Qi(e){if(!e)return;let t;return ft(e)?t={unit:e}:Dr(e)&&(t=Object.assign(Object.assign({},e),e.unit?{unit:e.unit}:{})),Aj(t.unit)&&(t.utc=!0,t.unit=mDt(t.unit)),t}function vDt(e){const t=Qi(e),{utc:n}=t,r=Be(t,["utc"]);return r.unit?(n?"utc":"")+be(r).map(i=>wn(`${i==="unit"?"":`_${i}_`}${r[i]}`)).join(""):(n?"utc":"")+"timeunit"+be(r).map(i=>wn(`_${i}_${r[i]}`)).join("")}function Xe(e){return e&&!!e.signal}function Kh(e){return!!e.step}function wDt(e){return je(e)?!1:"fields"in e&&!("data"in e)}function $Dt(e){return je(e)?!1:"fields"in e&&"data"in e}function xf(e){return je(e)?!1:"field"in e&&"data"in e}const CDt={aria:1,description:1,ariaRole:1,ariaRoleDescription:1,blend:1,opacity:1,fill:1,fillOpacity:1,stroke:1,strokeCap:1,strokeWidth:1,strokeOpacity:1,strokeDash:1,strokeDashOffset:1,strokeJoin:1,strokeOffset:1,strokeMiterLimit:1,startAngle:1,endAngle:1,padAngle:1,innerRadius:1,outerRadius:1,size:1,shape:1,interpolate:1,tension:1,orient:1,align:1,baseline:1,text:1,dir:1,dx:1,dy:1,ellipsis:1,limit:1,radius:1,theta:1,angle:1,font:1,fontSize:1,fontWeight:1,fontStyle:1,lineBreak:1,lineHeight:1,cursor:1,href:1,tooltip:1,cornerRadius:1,cornerRadiusTopLeft:1,cornerRadiusTopRight:1,cornerRadiusBottomLeft:1,cornerRadiusBottomRight:1,aspect:1,width:1,height:1},SDt=be(CDt),kDt={arc:1,area:1,group:1,image:1,line:1,path:1,rect:1,rule:1,shape:1,symbol:1,text:1,trail:1},lR=["cornerRadius","cornerRadiusTopLeft","cornerRadiusTopRight","cornerRadiusBottomLeft","cornerRadiusBottomRight"];function EDt(e){return e==null?void 0:e.selection}function Ij(e){return e&&!!e.field&&e.equal!==void 0}function pbe(e){return e&&!!e.field&&e.lt!==void 0}function gbe(e){return e&&!!e.field&&e.lte!==void 0}function mbe(e){return e&&!!e.field&&e.gt!==void 0}function ybe(e){return e&&!!e.field&&e.gte!==void 0}function Dj(e){if(e&&e.field){if(je(e.range)&&e.range.length===2)return!0;if(Xe(e.range))return!0}return!1}function Nj(e){return e&&!!e.field&&(je(e.oneOf)||je(e.in))}function _Dt(e){return e&&!!e.field&&e.valid!==void 0}function bbe(e){return Nj(e)||Ij(e)||Dj(e)||pbe(e)||mbe(e)||gbe(e)||ybe(e)}function iu(e,t){return qj(e,{timeUnit:t,wrapTime:!0})}function ADt(e,t){return e.map(n=>iu(n,t))}function xbe(e,t=!0){var n;const{field:r}=e,i=(n=Qi(e.timeUnit))===null||n===void 0?void 0:n.unit,s=i?"time("+bDt(i,r)+")":ve(e,{expr:"datum"});if(Ij(e))return s+"==="+iu(e.equal,i);if(pbe(e)){const o=e.lt;return`${s}<${iu(o,i)}`}else if(mbe(e)){const o=e.gt;return`${s}>${iu(o,i)}`}else if(gbe(e)){const o=e.lte;return`${s}<=${iu(o,i)}`}else if(ybe(e)){const o=e.gte;return`${s}>=${iu(o,i)}`}else{if(Nj(e))return`indexof([${ADt(e.oneOf,i).join(",")}], ${s}) !== -1`;if(_Dt(e))return Fj(s,e.valid);if(Dj(e)){const{range:o}=e,a=Xe(o)?{signal:`${o.signal}[0]`}:o[0],u=Xe(o)?{signal:`${o.signal}[1]`}:o[1];if(a!==null&&u!==null&&t)return"inrange("+s+", ["+iu(a,i)+", "+iu(u,i)+"])";const l=[];return a!==null&&l.push(`${s} >= ${iu(a,i)}`),u!==null&&l.push(`${s} <= ${iu(u,i)}`),l.length>0?l.join(" && "):"true"}}throw new Error(`Invalid field predicate: ${JSON.stringify(e)}`)}function Fj(e,t=!0){return t?`isValid(${e}) && isFinite(+${e})`:`!isValid(${e}) || !isFinite(+${e})`}function TDt(e){var t;return bbe(e)&&e.timeUnit?Object.assign(Object.assign({},e),{timeUnit:(t=Qi(e.timeUnit))===null||t===void 0?void 0:t.unit}):e}const Iy={quantitative:"quantitative",ordinal:"ordinal",temporal:"temporal",nominal:"nominal",geojson:"geojson"},Gp=Iy.quantitative,Oj=Iy.ordinal,P0=Iy.temporal,Rj=Iy.nominal,Dy=Iy.geojson,IDt=be(Iy);function DDt(e){if(e)switch(e=e.toLowerCase(),e){case"q":case Gp:return"quantitative";case"t":case P0:return"temporal";case"o":case Oj:return"ordinal";case"n":case Rj:return"nominal";case Dy:return"geojson"}}const Vn={LINEAR:"linear",LOG:"log",POW:"pow",SQRT:"sqrt",SYMLOG:"symlog",IDENTITY:"identity",SEQUENTIAL:"sequential",TIME:"time",UTC:"utc",QUANTILE:"quantile",QUANTIZE:"quantize",THRESHOLD:"threshold",BIN_ORDINAL:"bin-ordinal",ORDINAL:"ordinal",POINT:"point",BAND:"band"},nP={linear:"numeric",log:"numeric",pow:"numeric",sqrt:"numeric",symlog:"numeric",identity:"numeric",sequential:"numeric",time:"time",utc:"time",ordinal:"ordinal","bin-ordinal":"bin-ordinal",point:"ordinal-position",band:"ordinal-position",quantile:"discretizing",quantize:"discretizing",threshold:"discretizing"},NDt=be(nP);function FDt(e,t){const n=nP[e],r=nP[t];return n===r||n==="ordinal-position"&&r==="time"||r==="ordinal-position"&&n==="time"}const ODt={linear:0,log:1,pow:1,sqrt:1,symlog:1,identity:1,sequential:1,time:0,utc:0,point:10,band:11,ordinal:0,"bin-ordinal":0,quantile:0,quantize:0,threshold:0};function cJ(e){return ODt[e]}const vbe=["linear","log","pow","sqrt","symlog","time","utc"],RDt=zg(vbe),MDt=["linear","log","pow","sqrt","symlog"],LDt=zg(MDt);function PDt(e){return e in LDt}const BDt=["quantile","quantize","threshold"],zDt=zg(BDt),UDt=vbe.concat(["quantile","quantize","threshold","sequential","identity"]),jDt=zg(UDt),WDt=["ordinal","bin-ordinal","point","band"],VDt=zg(WDt);function Ms(e){return e in VDt}function Go(e){return e in jDt}function wa(e){return e in RDt}function rA(e){return e in zDt}const GDt={pointPadding:.5,barBandPaddingInner:.1,rectBandPaddingInner:0,minBandSize:2,minFontSize:8,maxFontSize:40,minOpacity:.3,maxOpacity:.8,minSize:9,minStrokeWidth:1,maxStrokeWidth:4,quantileCount:4,quantizeCount:4};function HDt(e){return!ft(e)&&!!e.name}function wbe(e){return e==null?void 0:e.selection}function qDt(e){return e&&e.unionWith}const XDt={type:1,domain:1,domainMid:1,align:1,range:1,scheme:1,bins:1,reverse:1,round:1,clamp:1,nice:1,base:1,exponent:1,constant:1,interpolate:1,zero:1,padding:1,paddingInner:1,paddingOuter:1},YDt=Be(XDt,["type","domain","range","scheme"]),KDt=be(YDt);ZDt();function $be(e,t){switch(t){case"type":case"domain":case"reverse":case"range":return!0;case"scheme":case"interpolate":return!Ve(["point","band","identity"],e);case"bins":return!Ve(["point","band","identity","ordinal"],e);case"round":return wa(e)||e==="band"||e==="point";case"padding":return wa(e)||Ve(["point","band"],e);case"paddingOuter":case"align":return Ve(["point","band"],e);case"paddingInner":return e==="band";case"domainMid":case"clamp":return wa(e);case"nice":return wa(e)||e==="quantize"||e==="threshold";case"exponent":return e==="pow";case"base":return e==="log";case"constant":return e==="symlog";case"zero":return Go(e)&&!Ve(["log","time","utc","threshold","quantile"],e)}}function Cbe(e,t){switch(t){case"interpolate":case"scheme":case"domainMid":return Bm(e)?void 0:MIt(e);case"align":case"type":case"bins":case"domain":case"range":case"base":case"exponent":case"constant":case"nice":case"padding":case"paddingInner":case"paddingOuter":case"reverse":case"round":case"clamp":case"zero":return}}function Sbe(e,t){return Ve([Oj,Rj],t)?e===void 0||Ms(e):t===P0?Ve([Vn.TIME,Vn.UTC,void 0],e):t===Gp?Ve([Vn.LOG,Vn.POW,Vn.SQRT,Vn.SYMLOG,Vn.QUANTILE,Vn.QUANTIZE,Vn.THRESHOLD,Vn.LINEAR,void 0],e):!0}function kbe(e,t){if(!Yh(e))return!1;switch(e){case _n:case fr:case Ya:case fl:return wa(t)||Ve(["band","point"],t);case Oc:case Hh:case Rc:case Vh:case Gh:case Wg:return wa(t)||rA(t)||Ve(["band","point","ordinal"],t);case Os:case pl:case gl:return t!=="band";case qh:return t==="ordinal"||rA(t);case Rs:return t==="ordinal"}}function ZDt(){var e;const t={};for(const n of Yye)for(const r of IDt)for(const i of NDt){const s=JDt(n,r);kbe(n,i)&&Sbe(i,r)&&(t[s]=(e=t[s])!==null&&e!==void 0?e:[],t[s].push(i))}return t}function JDt(e,t){return e+"_"+t}function Mj(e){const{channel:t,channelDef:n,markDef:r,scale:i,config:s}=e,o=_be(e);return ke(n)&&!Vye(n.aggregate)&&i&&wa(i.get("type"))&&i.get("zero")===!1?Ebe({fieldDef:n,channel:t,markDef:r,ref:o,config:s}):o}function Ebe({fieldDef:e,channel:t,markDef:n,ref:r,config:i}){return Ug(n.type)||Bt("invalid",n,i)===null?r:[QDt(e,t),r]}function QDt(e,t){const n=Lj(e,!0),i=Vg(t)==="y"?{field:{group:"height"}}:{value:0};return Object.assign({test:n},i)}function Lj(e,t=!0){return Fj(ft(e)?e:ve(e,{expr:"datum"}),!t)}function eNt(e){const{datum:t}=e;return Ty(t)?f2(t):`${JSON.stringify(t)}`}function up(e,t,n,r){const i={};if(t&&(i.scale=t),Zh(e)){const{datum:s}=e;Ty(s)?i.signal=f2(s):Xe(s)?i.signal=s.signal:i.value=s}else i.field=ve(e,n);if(r){const{offset:s,band:o}=r;s&&(i.offset=s),o&&(i.band=o)}return i}function iA({scaleName:e,fieldOrDatumDef:t,fieldOrDatumDef2:n,offset:r,startSuffix:i,band:s=.5}){const o=0<s&&s<1?"datum":void 0,a=ve(t,{expr:o,suffix:i}),u=n!==void 0?ve(n,{expr:o}):ve(t,{suffix:"end",expr:o}),l={};if(s===0||s===1){l.scale=e;const c=s===0?a:u;l.field=c}else{const c=`${s} * ${a} + ${1-s} * ${u}`;l.signal=`scale("${e}", ${c})`}return r&&(l.offset=r),l}function _be({channel:e,channelDef:t,channel2Def:n,markDef:r,config:i,scaleName:s,scale:o,stack:a,offset:u,defaultRef:l,band:c}){var f;if(t){if(Qe(t)){if(lo(t)){c=c??sC({channel:e,fieldDef:t,fieldDef2:n,markDef:r,stack:a,config:i,isMidPoint:!0});const{bin:d,timeUnit:p,type:g}=t;if(ln(d)||c&&p&&g===P0)return a&&a.impute?up(t,s,{binSuffix:"mid"},{offset:u}):c?iA({scaleName:s,fieldOrDatumDef:t,band:c,offset:u}):up(t,s,oC(t,e)?{binSuffix:"range"}:{},{offset:u});if(ji(d)){if(ke(n))return iA({scaleName:s,fieldOrDatumDef:t,fieldOrDatumDef2:n,band:c,offset:u});pe(abe(e===_n?Xa:cl))}}const h=o==null?void 0:o.get("type");return up(t,s,Ms(h)?{binSuffix:"range"}:{},{offset:u,band:h==="band"?(f=c??t.band)!==null&&f!==void 0?f:.5:void 0})}else if(yc(t)){const h=t.value,d=u?{offset:u}:{};return Object.assign(Object.assign({},Tx(e,h)),d)}}return uTt(l)&&(l=l()),l&&Object.assign(Object.assign({},l),u?{offset:u}:{})}function Tx(e,t){return Ve(["x","x2"],e)&&t==="width"?{field:{group:"width"}}:Ve(["y","y2"],e)&&t==="height"?{field:{group:"height"}}:Bn(t)}function Hp(e){return e&&e!=="number"&&e!=="time"}function Abe(e,t,n){return`${e}(${t}${n?`, ${JSON.stringify(n)}`:""})`}const tNt="  ";function Pj({fieldOrDatumDef:e,format:t,formatType:n,expr:r,normalizeStack:i,config:s}){var o,a;if(Hp(n))return Bj({fieldOrDatumDef:e,format:t,formatType:n,expr:r,config:s});const u=Tbe(e,r,i);if(mF(e)){const l=rNt(u,ke(e)?(o=Qi(e.timeUnit))===null||o===void 0?void 0:o.unit:void 0,t,s.timeFormat,Vj(e)&&((a=e.scale)===null||a===void 0?void 0:a.type)===Vn.UTC);return l?{signal:l}:void 0}if(t=Nbe(Zc(e),t,s),ke(e)&&ln(e.bin)){const l=ve(e,{expr:r,binSuffix:"end"});return{signal:fF(u,l,t,n,s)}}else return t||Zc(e)==="quantitative"?{signal:`${Fbe(u,t)}`}:{signal:`isValid(${u}) ? ${u} : ""+${u}`}}function Tbe(e,t,n){return ke(e)?n?`${ve(e,{expr:t,suffix:"end"})}-${ve(e,{expr:t,suffix:"start"})}`:ve(e,{expr:t}):eNt(e)}function Bj({fieldOrDatumDef:e,format:t,formatType:n,expr:r,normalizeStack:i,config:s,field:o}){if(o=o??Tbe(e,r,i),ke(e)&&ln(e.bin)){const a=ve(e,{expr:r,binSuffix:"end"});return{signal:fF(o,a,t,n,s)}}return{signal:Abe(n,o,t)}}function Ibe(e,t,n,r,i,s){var o;if(!Hp(r)){if(mF(e)){const a=ke(e)?(o=Qi(e.timeUnit))===null||o===void 0?void 0:o.unit:void 0;return nNt(n,a,i,s)}return Nbe(t,n,i)}}function Dbe(e,t,n){if(e&&(Xe(e)||e==="number"||e==="time"))return e;if(mF(t)&&n!=="time"&&n!=="utc")return"time"}function Nbe(e,t,n){if(ft(t))return t;if(e===Gp)return n.numberFormat}function nNt(e,t,n,r){return e||(t?{signal:dbe(t)}:r?void 0:n.timeFormat)}function Fbe(e,t){return`format(${e}, "${t||""}")`}function fJ(e,t,n,r){var i;return Hp(n)?Abe(n,e,t):Fbe(e,(i=ft(t)?t:void 0)!==null&&i!==void 0?i:r.numberFormat)}function fF(e,t,n,r,i){const s=fJ(e,n,r,i),o=fJ(t,n,r,i);return`${Fj(e,!1)} ? "null" : ${s} + "${tNt}" + ${o}`}function rNt(e,t,n,r,i){return!t||n?(n=ft(n)?n:r,`${i?"utc":"time"}Format(${e}, '${n}')`):xDt(t,e,i)}const hF="min",iNt={x:1,y:1,color:1,fill:1,stroke:1,strokeWidth:1,size:1,shape:1,fillOpacity:1,strokeOpacity:1,opacity:1,text:1};function hJ(e){return e in iNt}function Obe(e){return!!e&&!!e.encoding}function Du(e){return!!e&&(e.op==="count"||!!e.field)}function Rbe(e){return!!e&&je(e)}function iC(e){return"row"in e||"column"in e}function zj(e){return!!e&&"header"in e}function dF(e){return"facet"in e}function sNt(e){return e.selection}function oNt(e){return e&&!ft(e)&&"repeat"in e}function dJ(e){const{field:t,timeUnit:n,bin:r,aggregate:i}=e;return Object.assign(Object.assign(Object.assign(Object.assign({},n?{timeUnit:n}:{}),r?{bin:r}:{}),i?{aggregate:i}:{}),{field:t})}function Mbe(e){return lo(e)&&"sort"in e}function sC({channel:e,fieldDef:t,fieldDef2:n,markDef:r,stack:i,config:s,isMidPoint:o}){if(Qe(t)&&t.band!==void 0)return t.band;if(ke(t)){const{timeUnit:a,bin:u}=t;if(a&&!n)return o?qp("timeUnitBandPosition",r,s):JZ(r.type)?qp("timeUnitBand",r,s):0;if(ln(u))return JZ(r.type)&&!o?1:.5}if((i==null?void 0:i.fieldChannel)===e&&o)return .5}function Uj(e,t,n,r,i,s){return ln(t.bin)||t.timeUnit&&lo(t)&&t.type==="temporal"?!!sC({channel:e,fieldDef:t,fieldDef2:n,stack:r,markDef:i,config:s}):!1}function jj(e){return!!e&&"condition"in e}function pF(e){const t=e&&e.condition;return!!t&&!je(t)&&ke(t)}function Wj(e){const t=e&&e.condition;return!!t&&!je(t)&&Qe(t)}function aNt(e){const t=e&&e.condition;return!!t&&(je(t)||yc(t))}function ke(e){return!!e&&(!!e.field||e.aggregate==="count")}function Zc(e){return e&&e.type}function Zh(e){return!!e&&"datum"in e}function vu(e){return lo(e)&&zbe(e)||rP(e)}function rP(e){return Zh(e)&&Zn(e.datum)}function Qe(e){return ke(e)||Zh(e)}function lo(e){return!!e&&("field"in e&&"type"in e||e.aggregate==="count")}function yc(e){return e&&"value"in e&&"value"in e}function Vj(e){return!!e&&("scale"in e||"sort"in e)}function Gj(e){return e&&("axis"in e||"stack"in e||"impute"in e)}function Lbe(e){return!!e&&"legend"in e}function Pbe(e){return!!e&&("format"in e||"formatType"in e)}function uNt(e){return"op"in e}function ve(e,t={}){var n,r,i;let s=e.field;const o=t.prefix;let a=t.suffix,u="";if(lNt(e))s=$Tt("count");else{let l;if(!t.nofn)if(uNt(e))l=e.op;else{const{bin:c,aggregate:f,timeUnit:h}=e;ln(c)?(l=tbe(c),a=((n=t.binSuffix)!==null&&n!==void 0?n:"")+((r=t.suffix)!==null&&r!==void 0?r:"")):f?jg(f)?(u=`["${s}"]`,s=`argmax_${f.argmax}`):yh(f)?(u=`["${s}"]`,s=`argmin_${f.argmin}`):l=String(f):h&&(l=vDt(h),a=(!Ve(["range","mid"],t.binSuffix)&&t.binSuffix||"")+((i=t.suffix)!==null&&i!==void 0?i:""))}l&&(s=s?`${l}_${s}`:l)}return a&&(s=`${s}_${a}`),o&&(s=`${o}_${s}`),t.forAs?Mye(s):t.expr?bTt(s,t.expr)+u:mh(s)+u}function Bbe(e){switch(e.type){case"nominal":case"ordinal":case"geojson":return!0;case"quantitative":return ke(e)&&!!e.bin;case"temporal":return!1}throw new Error(rbe(e.type))}function zbe(e){return!Bbe(e)}function lNt(e){return e.aggregate==="count"}function cNt(e,t){var n;const{field:r,bin:i,timeUnit:s,aggregate:o}=e;if(o==="count")return t.countTitle;if(ln(i))return`${r} (binned)`;if(s){const a=(n=Qi(s))===null||n===void 0?void 0:n.unit;if(a)return`${r} (${Tj(a).join("-")})`}else if(o)return jg(o)?`${r} for max ${o.argmax}`:yh(o)?`${r} for min ${o.argmin}`:`${KN(o)} of ${r}`;return r}function fNt(e){const{aggregate:t,bin:n,timeUnit:r,field:i}=e;if(jg(t))return`${i} for argmax(${t.argmax})`;if(yh(t))return`${i} for argmin(${t.argmin})`;const s=Qi(r),o=t||(s==null?void 0:s.unit)||(s==null?void 0:s.maxbins)&&"timeunit"||ln(n)&&"bin";return o?o.toUpperCase()+"("+i+")":i}const Ube=(e,t)=>{switch(t.fieldTitle){case"plain":return e.field;case"functional":return fNt(e);default:return cNt(e,t)}};let jbe=Ube;function Wbe(e){jbe=e}function hNt(){Wbe(Ube)}function lp(e,t,{allowDisabling:n,includeDefault:r=!0}){var i,s;const a=((i=Hj(e))!==null&&i!==void 0?i:{}).title;if(!ke(e))return a;const u=e,l=r?Vbe(u,t):void 0;return n?Jn(a,u.title,l):(s=a??u.title)!==null&&s!==void 0?s:l}function Hj(e){if(Gj(e)&&e.axis)return e.axis;if(Lbe(e)&&e.legend)return e.legend;if(zj(e)&&e.header)return e.header}function Vbe(e,t){return jbe(e,t)}function sA(e){var t;if(Pbe(e)){const{format:n,formatType:r}=e;return{format:n,formatType:r}}else{const n=(t=Hj(e))!==null&&t!==void 0?t:{},{format:r,formatType:i}=n;return{format:r,formatType:i}}}function dNt(e,t){if(e.timeUnit)return"temporal";if(ln(e.bin))return"quantitative";switch(Sk(t)){case"continuous":return"quantitative";case"discrete":return"nominal";case"flexible":return"nominal";default:return"quantitative"}}function Xu(e){if(ke(e))return e;if(pF(e))return e.condition}function ur(e){if(Qe(e))return e;if(Wj(e))return e.condition}function iP(e,t,n){if(ft(e)||Zn(e)||J$(e)){const r=ft(e)?"string":Zn(e)?"number":"boolean";return pe(kIt(t,r,e)),{value:e}}return Qe(e)?oA(e,t,n):Wj(e)?Object.assign(Object.assign({},e),{condition:oA(e.condition,t,n)}):e}function oA(e,t,n){if(Pbe(e)){const{format:r,formatType:i}=e,s=Be(e,["format","formatType"]);if(Hp(i)&&!n.customFormatTypes)return pe(aJ(t)),oA(s,t,n)}else{const r=Gj(e)?"axis":Lbe(e)?"legend":zj(e)?"header":null;if(r&&e[r]){const i=e[r],{format:s,formatType:o}=i,a=Be(i,["format","formatType"]);if(Hp(o)&&!n.customFormatTypes)return pe(aJ(t)),oA(Object.assign(Object.assign({},e),{[r]:a}),t,n)}}return ke(e)?Gbe(e,t):pNt(e)}function pNt(e){let t=e.type;if(t)return e;const{datum:n}=e;return t=Zn(n)?"quantitative":ft(n)?"nominal":Ty(n)?"temporal":void 0,Object.assign(Object.assign({},e),{type:t})}function Gbe(e,t){const{aggregate:n,timeUnit:r,bin:i,field:s}=e,o=Object.assign({},e);if(n&&!vj(n)&&!jg(n)&&!yh(n)&&(pe(_It(n)),delete o.aggregate),r&&(o.timeUnit=Qi(r)),s&&(o.field=`${s}`),ln(i)&&(o.bin=gF(i,t)),ji(i)&&!qu(t)&&pe(`Channel ${t} should not be used with "binned" bin.`),lo(o)){const{type:a}=o,u=DDt(a);a!==u&&(o.type=u),a!=="quantitative"&&Vye(n)&&(pe(EIt(a,n)),o.type="quantitative")}else if(!Zye(t)){const a=dNt(o,t);pe(AIt(t,a)),o.type=a}if(lo(o)){const{compatible:a,warning:u}=gNt(o,t);a||pe(u)}if(Mbe(o)&&ft(o.sort)){const{sort:a}=o;if(hJ(a))return Object.assign(Object.assign({},o),{sort:{encoding:a}});const u=a.substr(1);if(a.charAt(0)==="-"&&hJ(u))return Object.assign(Object.assign({},o),{sort:{encoding:u,order:"descending"}})}if(zj(o)){const{header:a}=o,{orient:u}=a,l=Be(a,["orient"]);if(u)return Object.assign(Object.assign({},o),{header:Object.assign(Object.assign({},l),{labelOrient:a.labelOrient||u,titleOrient:a.titleOrient||u})})}return o}function gF(e,t){return J$(e)?{maxbins:eJ(t)}:e==="binned"?{binned:!0}:!e.maxbins&&!e.step?Object.assign(Object.assign({},e),{maxbins:eJ(t)}):e}const ad={compatible:!0};function gNt(e,t){const n=e.type;if(n==="geojson"&&t!=="shape")return{compatible:!1,warning:`Channel ${t} should not be used with a geojson data.`};switch(t){case nc:case rc:case nF:return zbe(e)?{compatible:!1,warning:DIt(t)}:ad;case _n:case fr:case Os:case pl:case gl:case eC:case nC:case rF:case Vp:case iF:case sF:case Wg:case Ya:case fl:case oF:return ad;case dl:case Wo:case hl:case Ka:return n!==Gp?{compatible:!1,warning:`Channel ${t} should be used with a quantitative field only, not ${e.type} field.`}:ad;case Rc:case Vh:case Gh:case Hh:case Oc:case Fc:case Nc:case Xa:case cl:return n==="nominal"&&!e.sort?{compatible:!1,warning:`Channel ${t} should not be used with an unsorted discrete field.`}:ad;case qh:return Ve(["ordinal","nominal"],e.type)?ad:{compatible:!1,warning:"StrokeDash channel should be used with only discrete data."};case Rs:return Ve(["ordinal","nominal","geojson"],e.type)?ad:{compatible:!1,warning:"Shape channel should be used with only either discrete or geojson data."};case tC:return e.type==="nominal"&&!("sort"in e)?{compatible:!1,warning:"Channel order is inappropriate for nominal field, which has no inherent order."}:ad}}function mF(e){const{formatType:t}=sA(e);return t==="time"||!t&&mNt(e)}function mNt(e){return e&&(e.type==="temporal"||ke(e)&&!!e.timeUnit)}function qj(e,{timeUnit:t,type:n,wrapTime:r,undefinedIfExprNotRequired:i}){var s;const o=t&&((s=Qi(t))===null||s===void 0?void 0:s.unit);let a=o||n==="temporal",u;return Xe(e)?u=e.signal:Ty(e)?(a=!0,u=f2(e)):(ft(e)||Zn(e))&&a&&(u=`datetime(${JSON.stringify(e)})`,gDt(o)&&(Zn(e)&&e<1e4||ft(e)&&isNaN(Date.parse(e)))&&(u=f2({[o]:e}))),u?r&&a?`time(${u})`:u:i?void 0:JSON.stringify(e)}function Hbe(e,t){const{type:n}=e;return t.map(r=>{const i=qj(r,{timeUnit:ke(e)?e.timeUnit:void 0,type:n,undefinedIfExprNotRequired:!0});return i!==void 0?{signal:i}:r})}function oC(e,t){return ln(e.bin)?Yh(t)&&Ve(["ordinal","nominal"],e.type):(console.warn("Only call this method for binned field defs."),!1)}function qbe(e){const{anchor:t,frame:n,offset:r,orient:i,color:s,subtitleColor:o,subtitleFont:a,subtitleFontSize:u,subtitleFontStyle:l,subtitleFontWeight:c,subtitleLineHeight:f,subtitlePadding:h}=e,d=Be(e,["anchor","frame","offset","orient","color","subtitleColor","subtitleFont","subtitleFontSize","subtitleFontStyle","subtitleFontWeight","subtitleLineHeight","subtitlePadding"]),p=Object.assign(Object.assign({},d),s?{fill:s}:{}),g=Object.assign(Object.assign(Object.assign(Object.assign({},t?{anchor:t}:{}),n?{frame:n}:{}),r?{offset:r}:{}),i?{orient:i}:{}),m=Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},o?{subtitleColor:o}:{}),a?{subtitleFont:a}:{}),u?{subtitleFontSize:u}:{}),l?{subtitleFontStyle:l}:{}),c?{subtitleFontWeight:c}:{}),f?{subtitleLineHeight:f}:{}),h?{subtitlePadding:h}:{}),y=u2(p,["align","baseline","dx","dy","limit"]);return{titleMarkConfig:p,subtitleMarkConfig:y,nonMark:g,subtitle:m}}function Jc(e){return ft(e)||je(e)&&ft(e[0])}function Bn(e){return Xe(e)?e:e!==void 0?{value:e}:void 0}function pJ(e){return Xe(e)?e.signal:Ct(e.value)}function h2(e){return Xe(e)?e.signal:e==null?null:Ct(e)}function yNt(e,t,n){for(const r of n){const i=qp(r,t.markDef,t.config);i!==void 0&&(e[r]=Bn(i))}return e}function Xbe(e){var t;return[].concat(e.type,(t=e.style)!==null&&t!==void 0?t:[])}function Bt(e,t,n,r={}){const{vgChannel:i,ignoreVgConfig:s}=r;return i&&t[i]!==void 0?t[i]:t[e]!==void 0?t[e]:s&&(!i||i===e)?void 0:qp(e,t,n,r)}function qp(e,t,n,{vgChannel:r}={}){return Jn(r?aA(e,t,n.style):void 0,aA(e,t,n.style),r?n[t.type][r]:void 0,n[t.type][e],r?n.mark[r]:n.mark[e])}function aA(e,t,n){return Ybe(e,Xbe(t),n)}function Ybe(e,t,n){t=jn(t);let r;for(const i of t){const s=n[i];s&&s[e]!==void 0&&(r=s[e])}return r}function Kbe(e,t){return jn(e).reduce((n,r)=>{var i;return n.field.push(ve(r,t)),n.order.push((i=r.sort)!==null&&i!==void 0?i:"ascending"),n},{field:[],order:[]})}function Zbe(e,t){const n=[...e];return t.forEach(r=>{for(const i of n)if(Q$(i,r))return;n.push(r)}),n}function Jbe(e,t){return Q$(e,t)||!t?e:e?[...jn(e),...jn(t)].join(", "):t}function Qbe(e,t){const n=e.value,r=t.value;if(n==null||r===null)return{explicit:e.explicit,value:null};if((Jc(n)||Xe(n))&&(Jc(r)||Xe(r)))return{explicit:e.explicit,value:Jbe(n,r)};if(Jc(n)||Xe(n))return{explicit:e.explicit,value:n};if(Jc(r)||Xe(r))return{explicit:e.explicit,value:r};if(!Jc(n)&&!Xe(n)&&!Jc(r)&&!Xe(r))return{explicit:e.explicit,value:Zbe(n,r)};throw new Error("It should never reach here")}function cp(e,t){const n=e&&e[t];return n?je(n)?l2(n,r=>!!r.field):ke(n)||pF(n):!1}function Xj(e){return l2(Yye,t=>{if(cp(e,t)){const n=e[t];if(je(n))return l2(n,r=>!!r.aggregate);{const r=Xu(n);return r&&!!r.aggregate}}return!1})}function Yj(e,t){const n=[],r=[],i=[],s=[],o={};return Kj(e,(a,u)=>{if(ke(a)){const{field:l,aggregate:c,bin:f,timeUnit:h}=a,d=Be(a,["field","aggregate","bin","timeUnit"]);if(c||h||f){const p=Hj(a),g=p&&p.title;let m=ve(a,{forAs:!0});const y=Object.assign(Object.assign(Object.assign({},g?[]:{title:lp(a,t,{allowDisabling:!0})}),d),{field:m});if(c){let b;if(jg(c)?(b="argmax",m=ve({op:"argmax",field:c.argmax},{forAs:!0}),y.field=`${m}.${l}`):yh(c)?(b="argmin",m=ve({op:"argmin",field:c.argmin},{forAs:!0}),y.field=`${m}.${l}`):c!=="boxplot"&&c!=="errorbar"&&c!=="errorband"&&(b=c),b){const v={op:b,as:m};l&&(v.field=l),s.push(v)}}else if(n.push(m),lo(a)&&ln(f)){if(r.push({bin:f,field:l,as:m}),n.push(ve(a,{binSuffix:"end"})),oC(a,u)&&n.push(ve(a,{binSuffix:"range"})),qu(u)){const b={field:m+"_end"};o[u+"2"]=b}y.bin="binned",Zye(u)||(y.type=Gp)}else if(h){i.push({timeUnit:h,field:l,as:m});const b=lo(a)&&a.type!==P0&&"time";b&&(u===eC||u===Vp?y.formatType=b:sIt(u)?y.legend=Object.assign({formatType:b},y.legend):qu(u)&&(y.axis=Object.assign({formatType:b},y.axis)))}o[u]=y}else n.push(l),o[u]=e[u]}else o[u]=e[u]}),{bins:r,timeUnits:i,aggregate:s,groupby:n,encoding:o}}function bNt(e,t,n){const r=aIt(t,n);if(r){if(r==="binned"){const i=e[t===Xa?_n:fr];return!!(ke(i)&&ke(e[t])&&ji(i.bin))}}else return!1;return!0}function xNt(e,t,n){const r=t.type;return be(e).reduce((i,s)=>{if(!Kye(s))return pe(IIt(s)),i;const o=e[s];if(s==="angle"&&r==="arc"&&!e.theta&&(pe(SIt),s=Ya),!bNt(e,s,r))return pe(cF(s,r)),i;if(s===Oc&&r==="line"){const a=Xu(e[s]);if(a!=null&&a.aggregate)return pe(TIt),i}if(s===Os&&(t.filled?"fill"in e:"stroke"in e))return pe(ibe("encoding",{fill:"fill"in e,stroke:"stroke"in e})),i;if(s===nC||s===tC&&!je(o)&&!yc(o)||s===Vp&&je(o))o&&(i[s]=jn(o).reduce((a,u)=>(ke(u)?a.push(Gbe(u,s)):pe(tP(u,s)),a),[]));else{if(s===Vp&&o===null)i[s]=null;else if(!ke(o)&&!Zh(o)&&!yc(o)&&!jj(o)&&!Xe(o))return pe(tP(o,s)),i;i[s]=iP(o,s,n)}return i},{})}function vNt(e){const t=[];for(const n of be(e))if(cp(e,n)){const r=e[n],i=jn(r);for(const s of i)ke(s)?t.push(s):pF(s)&&t.push(s.condition)}return t}function Kj(e,t,n){if(e)for(const r of be(e)){const i=e[r];if(je(i))for(const s of i)t.call(n,s,r);else t.call(n,i,r)}}function exe(e,t,n,r){return e?be(e).reduce((i,s)=>{const o=e[s];return je(o)?o.reduce((a,u)=>t.call(r,a,u,s),i):t.call(r,i,o,s)},n):n}function txe(e,t){return be(t).reduce((n,r)=>{switch(r){case _n:case fr:case iF:case oF:case sF:case Xa:case cl:case Ya:case Fc:case fl:case Nc:case hl:case dl:case Ka:case Wo:case eC:case Rs:case Wg:case Vp:return n;case tC:if(e==="line"||e==="trail")return n;case nC:case rF:{const i=t[r];if(je(i)||ke(i))for(const s of jn(i))s.aggregate||n.push(ve(s,{}));return n}case Oc:if(e==="trail")return n;case Os:case pl:case gl:case Rc:case Vh:case Gh:case qh:case Hh:{const i=Xu(t[r]);return i&&!i.aggregate&&n.push(ve(i,{})),n}}},[])}function wNt(e){const{tooltip:t}=e,n=Be(e,["tooltip"]);if(!t)return{filteredEncoding:e};let r,i;if(je(t)){for(const s of t)s.aggregate?(r||(r=[]),r.push(s)):(i||(i=[]),i.push(s));r&&(n.tooltip=r)}else t.aggregate?n.tooltip=t:i=t;return je(i)&&i.length===1&&(i=i[0]),{customTooltipWithoutAggregatedField:i,filteredEncoding:n}}function sP(e,t,n,r=!0){return"tooltip"in n?{tooltip:n.tooltip}:{tooltip:[...e.map(({fieldPrefix:s,titlePrefix:o})=>{const a=r?` of ${t.field}`:"";return{field:s+t.field,type:t.type,title:Xe(o)?{signal:o+`"${escape(a)}"`}:o+a}}),...vNt(n)]}}function nxe(e){const{axis:t,title:n,field:r}=e;return t&&t.title!==void 0?void 0:Jn(n,r)}function Zj(e,t,n,r,i){const{scale:s,axis:o}=n;return({partName:a,mark:u,positionPrefix:l,endPositionPrefix:c=void 0,aria:f,extraEncoding:h={}})=>{const d=nxe(n);return rxe(e,a,i,f,{mark:u,encoding:Object.assign(Object.assign(Object.assign({[t]:Object.assign(Object.assign(Object.assign({field:l+"_"+n.field,type:n.type},d!==void 0?{title:d}:{}),s!==void 0?{scale:s}:{}),o!==void 0?{axis:o}:{})},ft(c)?{[t+"2"]:{field:c+"_"+n.field}}:{}),r),h)})}}function rxe(e,t,n,r,i){const{clip:s,color:o,opacity:a}=e,u=e.type;return e[t]||e[t]===void 0&&n[t]?[Object.assign(Object.assign({},i),{mark:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},n[t]),s?{clip:s}:{}),o?{color:o}:{}),a?{opacity:a}:{}),Hu(i.mark)?i.mark:{type:i.mark}),{style:`${u}-${t}`}),J$(e[t])?{}:e[t]),r===!1?{aria:r}:{})})]:[]}function ixe(e,t,n){const{encoding:r}=e,i=t==="vertical"?"y":"x",s=r[i],o=r[i+"2"],a=r[i+"Error"],u=r[i+"Error2"];return{continuousAxisChannelDef:TS(s,n),continuousAxisChannelDef2:TS(o,n),continuousAxisChannelDefError:TS(a,n),continuousAxisChannelDefError2:TS(u,n),continuousAxis:i}}function TS(e,t){if(e&&e.aggregate){const{aggregate:n}=e,r=Be(e,["aggregate"]);return n!==t&&pe(nDt(n,t)),r}else return e}function sxe(e,t){const{mark:n,encoding:r}=e,{x:i,y:s}=r;if(vu(i)){if(vu(s)){const o=ke(i)&&i.aggregate,a=ke(s)&&s.aggregate;if(!o&&a===t)return"vertical";if(!a&&o===t)return"horizontal";if(o===t&&a===t)throw new Error("Both x and y cannot have aggregate");return Hu(n)&&n.orient?n.orient:"vertical"}return"horizontal"}else{if(vu(s))return"vertical";throw new Error("Need a valid continuous axis for "+t+"s")}}const uA="boxplot",$Nt=["box","median","outliers","rule","ticks"],CNt=new tF(uA,axe);function oxe(e){return Zn(e)?"tukey":e}function axe(e,{config:t}){var n,r;const{mark:i,encoding:s,selection:o,projection:a}=e,u=Be(e,["mark","encoding","selection","projection"]),l=Hu(i)?i:{type:i};o&&pe(nbe("boxplot"));const c=(n=l.extent)!==null&&n!==void 0?n:t.boxplot.extent,f=Bt("size",l,t),h=oxe(c),{transform:d,continuousAxisChannelDef:p,continuousAxis:g,groupby:m,aggregate:y,encodingWithoutContinuousAxis:b,ticksOrient:v,boxOrient:x,customTooltipWithoutAggregatedField:w}=SNt(e,c,t),{color:C,size:$}=b,S=Be(b,["color","size"]),k=P=>Zj(l,g,p,P,t.boxplot),E=k(S),_=k(b),D=k(Object.assign(Object.assign({},S),$?{size:$}:{})),A=sP([{fieldPrefix:h==="min-max"?"upper_whisker_":"max_",titlePrefix:"Max"},{fieldPrefix:"upper_box_",titlePrefix:"Q3"},{fieldPrefix:"mid_box_",titlePrefix:"Median"},{fieldPrefix:"lower_box_",titlePrefix:"Q1"},{fieldPrefix:h==="min-max"?"lower_whisker_":"min_",titlePrefix:"Min"}],p,b),T={type:"tick",color:"black",opacity:1,orient:v,invalid:null},I=h==="min-max"?A:sP([{fieldPrefix:"upper_whisker_",titlePrefix:"Upper Whisker"},{fieldPrefix:"lower_whisker_",titlePrefix:"Lower Whisker"}],p,b),F=[...E({partName:"rule",mark:{type:"rule",invalid:null},positionPrefix:"lower_whisker",endPositionPrefix:"lower_box",aria:!1,extraEncoding:I}),...E({partName:"rule",mark:{type:"rule",invalid:null},positionPrefix:"upper_box",endPositionPrefix:"upper_whisker",aria:!1,extraEncoding:I}),...E({partName:"ticks",mark:T,positionPrefix:"lower_whisker",aria:!1,extraEncoding:I}),...E({partName:"ticks",mark:T,positionPrefix:"upper_whisker",aria:!1,extraEncoding:I})],R=[...h!=="tukey"?F:[],..._({partName:"box",mark:Object.assign(Object.assign({type:"bar"},f?{size:f}:{}),{orient:x,invalid:null}),positionPrefix:"lower_box",endPositionPrefix:"upper_box",aria:!1,extraEncoding:A}),...D({partName:"median",mark:Object.assign(Object.assign(Object.assign({type:"tick",invalid:null},Dr(t.boxplot.median)&&t.boxplot.median.color?{color:t.boxplot.median.color}:{}),f?{size:f}:{}),{orient:v,ariaRoleDescription:"box"}),positionPrefix:"mid_box",extraEncoding:A})];let L;if(h!=="min-max"){const P=`datum["lower_box_${p.field}"]`,q=`datum["upper_box_${p.field}"]`,X=`(${q} - ${P})`,G=`${P} - ${c} * ${X}`,J=`${q} + ${c} * ${X}`,Q=`datum["${p.field}"]`,ee={joinaggregate:uxe(p.field),groupby:m};let ue;h==="tukey"&&(ue={transform:[{filter:`(${G} <= ${Q}) && (${Q} <= ${J})`},{aggregate:[{op:"min",field:p.field,as:"lower_whisker_"+p.field},{op:"max",field:p.field,as:"upper_whisker_"+p.field},{op:"min",field:"lower_box_"+p.field,as:"lower_box_"+p.field},{op:"max",field:"upper_box_"+p.field,as:"upper_box_"+p.field},...y],groupby:m}],layer:F});const ge=Be(S,["tooltip"]),{scale:xe,axis:B}=p,H=nxe(p),Y=rxe(l,"outliers",t.boxplot,!0,{transform:[{filter:`(${Q} < ${G}) || (${Q} > ${J})`}],mark:"point",encoding:Object.assign(Object.assign({[g]:Object.assign(Object.assign(Object.assign({field:p.field,type:p.type},H!==void 0?{title:H}:{}),xe!==void 0?{scale:xe}:{}),B!==void 0?{axis:B}:{})},ge),w?{tooltip:w}:{})})[0];Y&&ue?L={transform:[ee],layer:[Y,ue]}:Y?(L=Y,L.transform.unshift(ee)):ue&&(L=ue,L.transform.unshift(ee))}return L?Object.assign(Object.assign({},u),{layer:[L,{transform:d,layer:R}]}):Object.assign(Object.assign({},u),{transform:((r=u.transform)!==null&&r!==void 0?r:[]).concat(d),layer:R})}function uxe(e){return[{op:"q1",field:e,as:"lower_box_"+e},{op:"q3",field:e,as:"upper_box_"+e}]}function SNt(e,t,n){const r=sxe(e,uA),{continuousAxisChannelDef:i,continuousAxis:s}=ixe(e,r,uA),o=i.field,a=oxe(t),u=[...uxe(o),{op:"median",field:o,as:"mid_box_"+o},{op:"min",field:o,as:(a==="min-max"?"lower_whisker_":"min_")+o},{op:"max",field:o,as:(a==="min-max"?"upper_whisker_":"max_")+o}],l=a==="min-max"||a==="tukey"?[]:[{calculate:`datum["upper_box_${o}"] - datum["lower_box_${o}"]`,as:"iqr_"+o},{calculate:`min(datum["upper_box_${o}"] + datum["iqr_${o}"] * ${t}, datum["max_${o}"])`,as:"upper_whisker_"+o},{calculate:`max(datum["lower_box_${o}"] - datum["iqr_${o}"] * ${t}, datum["min_${o}"])`,as:"lower_whisker_"+o}],c=e.encoding,f=s;c[f];const h=Be(c,[typeof f=="symbol"?f:f+""]),{customTooltipWithoutAggregatedField:d,filteredEncoding:p}=wNt(h),{bins:g,timeUnits:m,aggregate:y,groupby:b,encoding:v}=Yj(p,n),x=r==="vertical"?"horizontal":"vertical",w=r;return{transform:[...g,...m,{aggregate:[...y,...u],groupby:b},...l],groupby:b,aggregate:y,continuousAxisChannelDef:i,continuousAxis:s,encodingWithoutContinuousAxis:v,ticksOrient:x,boxOrient:w,customTooltipWithoutAggregatedField:d}}const Jj="errorbar",kNt=["ticks","rule"],ENt=new tF(Jj,lxe);function lxe(e,{config:t}){const{transform:n,continuousAxisChannelDef:r,continuousAxis:i,encodingWithoutContinuousAxis:s,ticksOrient:o,markDef:a,outerSpec:u,tooltipEncoding:l}=cxe(e,Jj,t),c=Zj(a,i,r,s,t.errorbar),f={type:"tick",orient:o},h=[...c({partName:"ticks",mark:f,positionPrefix:"lower",aria:!1,extraEncoding:l}),...c({partName:"ticks",mark:f,positionPrefix:"upper",aria:!1,extraEncoding:l}),...c({partName:"rule",mark:{type:"rule",ariaRoleDescription:"errorbar"},positionPrefix:"lower",endPositionPrefix:"upper",extraEncoding:l})];return Object.assign(Object.assign(Object.assign({},u),{transform:n}),h.length>1?{layer:h}:Object.assign({},h[0]))}function _Nt(e,t){const{encoding:n}=e;if(ANt(n))return{orient:sxe(e,t),inputType:"raw"};const r=TNt(n),i=INt(n),s=n.x,o=n.y;if(r){if(i)throw new Error(`${t} cannot be both type aggregated-upper-lower and aggregated-error`);const a=n.x2,u=n.y2;if(Qe(a)&&Qe(u))throw new Error(`${t} cannot have both x2 and y2`);if(Qe(a)){if(vu(s))return{orient:"horizontal",inputType:"aggregated-upper-lower"};throw new Error(`Both x and x2 have to be quantitative in ${t}`)}else if(Qe(u)){if(vu(o))return{orient:"vertical",inputType:"aggregated-upper-lower"};throw new Error(`Both y and y2 have to be quantitative in ${t}`)}throw new Error("No ranged axis")}else{const a=n.xError,u=n.xError2,l=n.yError,c=n.yError2;if(Qe(u)&&!Qe(a))throw new Error(`${t} cannot have xError2 without xError`);if(Qe(c)&&!Qe(l))throw new Error(`${t} cannot have yError2 without yError`);if(Qe(a)&&Qe(l))throw new Error(`${t} cannot have both xError and yError with both are quantiative`);if(Qe(a)){if(vu(s))return{orient:"horizontal",inputType:"aggregated-error"};throw new Error("All x, xError, and xError2 (if exist) have to be quantitative")}else if(Qe(l)){if(vu(o))return{orient:"vertical",inputType:"aggregated-error"};throw new Error("All y, yError, and yError2 (if exist) have to be quantitative")}throw new Error("No ranged axis")}}function ANt(e){return(Qe(e.x)||Qe(e.y))&&!Qe(e.x2)&&!Qe(e.y2)&&!Qe(e.xError)&&!Qe(e.xError2)&&!Qe(e.yError)&&!Qe(e.yError2)}function TNt(e){return Qe(e.x2)||Qe(e.y2)}function INt(e){return Qe(e.xError)||Qe(e.xError2)||Qe(e.yError)||Qe(e.yError2)}function cxe(e,t,n){var r;const{mark:i,encoding:s,selection:o,projection:a}=e,u=Be(e,["mark","encoding","selection","projection"]),l=Hu(i)?i:{type:i};o&&pe(nbe(t));const{orient:c,inputType:f}=_Nt(e,t),{continuousAxisChannelDef:h,continuousAxisChannelDef2:d,continuousAxisChannelDefError:p,continuousAxisChannelDefError2:g,continuousAxis:m}=ixe(e,c,t),{errorBarSpecificAggregate:y,postAggregateCalculates:b,tooltipSummary:v,tooltipTitleWithFieldName:x}=DNt(l,h,d,p,g,f,t,n),w=s,C=m;w[C];const $=m==="x"?"x2":"y2";w[$];const S=m==="x"?"xError":"yError";w[S];const k=m==="x"?"xError2":"yError2";w[k];const E=Be(w,[typeof C=="symbol"?C:C+"",typeof $=="symbol"?$:$+"",typeof S=="symbol"?S:S+"",typeof k=="symbol"?k:k+""]),{bins:_,timeUnits:D,aggregate:A,groupby:T,encoding:I}=Yj(E,n),F=[...A,...y],R=f!=="raw"?[]:T,L=sP(v,h,I,x);return{transform:[...(r=u.transform)!==null&&r!==void 0?r:[],..._,...D,...F.length===0?[]:[{aggregate:F,groupby:R}],...b],groupby:R,continuousAxisChannelDef:h,continuousAxis:m,encodingWithoutContinuousAxis:I,ticksOrient:c==="vertical"?"horizontal":"vertical",markDef:l,outerSpec:u,tooltipEncoding:L}}function DNt(e,t,n,r,i,s,o,a){let u=[],l=[];const c=t.field;let f,h=!1;if(s==="raw"){const d=e.center?e.center:e.extent?e.extent==="iqr"?"median":"mean":a.errorbar.center,p=e.extent?e.extent:d==="mean"?"stderr":"iqr";if(d==="median"!=(p==="iqr")&&pe(tDt(d,p,o)),p==="stderr"||p==="stdev")u=[{op:p,field:c,as:"extent_"+c},{op:d,field:c,as:"center_"+c}],l=[{calculate:`datum["center_${c}"] + datum["extent_${c}"]`,as:"upper_"+c},{calculate:`datum["center_${c}"] - datum["extent_${c}"]`,as:"lower_"+c}],f=[{fieldPrefix:"center_",titlePrefix:KN(d)},{fieldPrefix:"upper_",titlePrefix:gJ(d,p,"+")},{fieldPrefix:"lower_",titlePrefix:gJ(d,p,"-")}],h=!0;else{e.center&&e.extent&&pe(rDt(e.extent,o));let g,m,y;p==="ci"?(g="mean",m="ci0",y="ci1"):(g="median",m="q1",y="q3"),u=[{op:m,field:c,as:"lower_"+c},{op:y,field:c,as:"upper_"+c},{op:g,field:c,as:"center_"+c}],f=[{fieldPrefix:"upper_",titlePrefix:lp({field:c,aggregate:y,type:"quantitative"},a,{allowDisabling:!1})},{fieldPrefix:"lower_",titlePrefix:lp({field:c,aggregate:m,type:"quantitative"},a,{allowDisabling:!1})},{fieldPrefix:"center_",titlePrefix:lp({field:c,aggregate:g,type:"quantitative"},a,{allowDisabling:!1})}]}}else{(e.center||e.extent)&&pe(eDt(e.center,e.extent)),s==="aggregated-upper-lower"?(f=[],l=[{calculate:`datum["${n.field}"]`,as:"upper_"+c},{calculate:`datum["${c}"]`,as:"lower_"+c}]):s==="aggregated-error"&&(f=[{fieldPrefix:"",titlePrefix:c}],l=[{calculate:`datum["${c}"] + datum["${r.field}"]`,as:"upper_"+c}],i?l.push({calculate:`datum["${c}"] + datum["${i.field}"]`,as:"lower_"+c}):l.push({calculate:`datum["${c}"] - datum["${r.field}"]`,as:"lower_"+c}));for(const d of l)f.push({fieldPrefix:d.as.substring(0,6),titlePrefix:M0(M0(d.calculate,'datum["',""),'"]',"")})}return{postAggregateCalculates:l,errorBarSpecificAggregate:u,tooltipSummary:f,tooltipTitleWithFieldName:h}}function gJ(e,t,n){return KN(e)+" "+n+" "+t}const Qj="errorband",NNt=["band","borders"],FNt=new tF(Qj,fxe);function fxe(e,{config:t}){const{transform:n,continuousAxisChannelDef:r,continuousAxis:i,encodingWithoutContinuousAxis:s,markDef:o,outerSpec:a,tooltipEncoding:u}=cxe(e,Qj,t),l=o,c=Zj(l,i,r,s,t.errorband),f=e.encoding.x!==void 0&&e.encoding.y!==void 0;let h={type:f?"area":"rect"},d={type:f?"line":"rule"};const p=Object.assign(Object.assign({},l.interpolate?{interpolate:l.interpolate}:{}),l.tension&&l.interpolate?{tension:l.tension}:{});return f?(h=Object.assign(Object.assign(Object.assign({},h),p),{ariaRoleDescription:"errorband"}),d=Object.assign(Object.assign({},d),p)):l.interpolate?pe(lJ("interpolate")):l.tension&&pe(lJ("tension")),Object.assign(Object.assign({},a),{transform:n,layer:[...c({partName:"band",mark:h,positionPrefix:"lower",endPositionPrefix:"upper",extraEncoding:u}),...c({partName:"borders",mark:d,positionPrefix:"lower",aria:!1,extraEncoding:u}),...c({partName:"borders",mark:d,positionPrefix:"upper",aria:!1,extraEncoding:u})]})}const hxe={};function eW(e,t,n){const r=new tF(e,t);hxe[e]={normalizer:r,parts:n}}function ONt(){return be(hxe)}eW(uA,axe,$Nt);eW(Jj,lxe,kNt);eW(Qj,fxe,NNt);const RNt=["gradientHorizontalMaxLength","gradientHorizontalMinLength","gradientVerticalMaxLength","gradientVerticalMinLength","unselectedOpacity"],dxe=["size","shape","fill","stroke","strokeDash","strokeWidth","opacity"],MNt={fillColor:{part:"legend",vgProp:"fill"},gradientStrokeColor:{part:"gradient",vgProp:"stroke"},labelColor:{part:"labels",vgProp:"fill"},strokeColor:{part:"legend",vgProp:"stroke"},symbolFillColor:{part:"symbols",vgProp:"fill"},symbolStrokeColor:{part:"symbols",vgProp:"stroke"},titleColor:{part:"title",vgProp:"fill"}},LNt={gradientHorizontalMaxLength:200,gradientHorizontalMinLength:100,gradientVerticalMaxLength:200,gradientVerticalMinLength:64,unselectedOpacity:.35},PNt={aria:1,clipHeight:1,columnPadding:1,columns:1,cornerRadius:1,description:1,direction:1,fillColor:1,format:1,formatType:1,gradientLength:1,gradientOpacity:1,gradientStrokeColor:1,gradientStrokeWidth:1,gradientThickness:1,gridAlign:1,labelAlign:1,labelBaseline:1,labelColor:1,labelFont:1,labelFontSize:1,labelFontStyle:1,labelFontWeight:1,labelLimit:1,labelOffset:1,labelOpacity:1,labelOverlap:1,labelPadding:1,labelSeparation:1,legendX:1,legendY:1,offset:1,orient:1,padding:1,rowPadding:1,strokeColor:1,symbolDash:1,symbolDashOffset:1,symbolFillColor:1,symbolLimit:1,symbolOffset:1,symbolOpacity:1,symbolSize:1,symbolStrokeColor:1,symbolStrokeWidth:1,symbolType:1,tickCount:1,tickMinStep:1,title:1,titleAlign:1,titleAnchor:1,titleBaseline:1,titleColor:1,titleFont:1,titleFontSize:1,titleFontStyle:1,titleFontWeight:1,titleLimit:1,titleLineHeight:1,titleOpacity:1,titleOrient:1,titlePadding:1,type:1,values:1,zindex:1},B0="_vgsid_",BNt={single:{on:"click",fields:[B0],resolve:"global",empty:"all",clear:"dblclick"},multi:{on:"click",fields:[B0],toggle:"event.shiftKey",resolve:"global",empty:"all",clear:"dblclick"},interval:{on:"[mousedown, window:mouseup] > window:mousemove!",encodings:["x","y"],translate:"[mousedown, window:mouseup] > window:mousemove!",zoom:"wheel!",mark:{fill:"#333",fillOpacity:.125,stroke:"white"},resolve:"global",clear:"dblclick"}};function tW(e){return!!e&&(e==="legend"||!!e.legend)}function cR(e){return tW(e)&&Dr(e)}function zNt(e){return yF(e)||rW(e)||nW(e)}function nW(e){return"concat"in e}function yF(e){return"vconcat"in e}function rW(e){return"hconcat"in e}function Yu(e){return Dr(e)&&e.step!==void 0}function mJ(e){return e.view||e.width||e.height}const yJ=20,UNt={align:1,bounds:1,center:1,columns:1,spacing:1},jNt=be(UNt);function WNt(e,t,n){var r,i;const s=n[t],o={},{spacing:a,columns:u}=s;a!==void 0&&(o.spacing=a),u!==void 0&&(dF(e)&&!iC(e.facet)||nW(e))&&(o.columns=u),yF(e)&&(o.columns=1);for(const l of jNt)if(e[l]!==void 0)if(l==="spacing"){const c=e[l];o[l]=Zn(c)?c:{row:(r=c.row)!==null&&r!==void 0?r:a,column:(i=c.column)!==null&&i!==void 0?i:a}}else o[l]=e[l];return o}function oP(e,t){var n;return(n=e[t])!==null&&n!==void 0?n:e[t==="width"?"continuousWidth":"continuousHeight"]}function lA(e,t){const n=d2(e,t);return Yu(n)?n.step:iW}function d2(e,t){var n;const r=(n=e[t])!==null&&n!==void 0?n:e[t==="width"?"discreteWidth":"discreteHeight"];return Jn(r,{step:e.step})}const iW=20,VNt={continuousWidth:200,continuousHeight:200,step:iW},GNt={background:"white",padding:5,timeFormat:"%b %d, %Y",countTitle:"Count of Records",view:VNt,mark:OTt,arc:{},area:{},bar:MTt,circle:{},geoshape:{},image:{},line:{},point:{},rect:LTt,rule:{color:"black"},square:{},text:{color:"black"},tick:PTt,trail:{},boxplot:{size:14,extent:1.5,box:{},median:{color:"white"},outliers:{},rule:{},ticks:null},errorbar:{center:"mean",rule:!0,ticks:!1},errorband:{band:{opacity:.3},borders:!1},scale:GDt,projection:{},legend:LNt,header:{titlePadding:10,labelPadding:10},headerColumn:{},headerRow:{},headerFacet:{},selection:BNt,style:{},title:{},facet:{spacing:yJ},concat:{spacing:yJ}},kl=["#4c78a8","#f58518","#e45756","#72b7b2","#54a24b","#eeca3b","#b279a2","#ff9da6","#9d755d","#bab0ac"],bJ={text:11,guideLabel:10,guideTitle:11,groupTitle:13,groupSubtitle:12},xJ={blue:kl[0],orange:kl[1],red:kl[2],teal:kl[3],green:kl[4],yellow:kl[5],purple:kl[6],pink:kl[7],brown:kl[8],gray0:"#000",gray1:"#111",gray2:"#222",gray3:"#333",gray4:"#444",gray5:"#555",gray6:"#666",gray7:"#777",gray8:"#888",gray9:"#999",gray10:"#aaa",gray11:"#bbb",gray12:"#ccc",gray13:"#ddd",gray14:"#eee",gray15:"#fff"};function HNt(e={}){return{signals:[{name:"color",value:Dr(e)?Object.assign(Object.assign({},xJ),e):xJ}],mark:{color:{signal:"color.blue"}},rule:{color:{signal:"color.gray0"}},text:{color:{signal:"color.gray0"}},style:{"guide-label":{fill:{signal:"color.gray0"}},"guide-title":{fill:{signal:"color.gray0"}},"group-title":{fill:{signal:"color.gray0"}},"group-subtitle":{fill:{signal:"color.gray0"}},cell:{stroke:{signal:"color.gray8"}}},axis:{domainColor:{signal:"color.gray13"},gridColor:{signal:"color.gray8"},tickColor:{signal:"color.gray13"}},range:{category:[{signal:"color.blue"},{signal:"color.orange"},{signal:"color.red"},{signal:"color.teal"},{signal:"color.green"},{signal:"color.yellow"},{signal:"color.purple"},{signal:"color.pink"},{signal:"color.brown"},{signal:"color.grey8"}]}}}function qNt(e){return{signals:[{name:"fontSize",value:Dr(e)?Object.assign(Object.assign({},bJ),e):bJ}],text:{fontSize:{signal:"fontSize.text"}},style:{"guide-label":{fontSize:{signal:"fontSize.guideLabel"}},"guide-title":{fontSize:{signal:"fontSize.guideTitle"}},"group-title":{fontSize:{signal:"fontSize.groupTitle"}},"group-subtitle":{fontSize:{signal:"fontSize.groupSubtitle"}}}}}function XNt(e){return{text:{font:e},style:{"guide-label":{font:e},"guide-title":{font:e},"group-title":{font:e},"group-subtitle":{font:e}}}}function pxe(e={}){const{color:t,font:n,fontSize:r}=e,i=Be(e,["color","font","fontSize"]);return Tye({},GNt,n?XNt(n):{},t?HNt(t):{},r?qNt(r):{},i||{})}const YNt=["view",...jye],KNt=["color","fontSize","background","padding","facet","concat","numberFormat","timeFormat","countTitle","header","axisQuantitative","axisTemporal","axisDiscrete","axisPoint","axisXBand","axisXPoint","axisXDiscrete","axisXQuantitative","axisXTemporal","axisYBand","axisYPoint","axisYDiscrete","axisYQuantitative","axisYTemporal","scale","selection","overlay"],ZNt=Object.assign({view:["continuousWidth","continuousHeight","discreteWidth","discreteHeight","step"]},FTt);function JNt(e){e=ht(e);for(const t of KNt)delete e[t];if(e.axis)for(const t in e.axis)mj(e.axis[t])&&delete e.axis[t];if(e.legend)for(const t of RNt)delete e.legend[t];if(e.mark){for(const t of QZ)delete e.mark[t];e.mark.tooltip&&Dr(e.mark.tooltip)&&delete e.mark.tooltip}for(const t of YNt){for(const r of QZ)delete e[t][r];const n=ZNt[t];if(n)for(const r of n)delete e[t][r];eFt(e,t)}for(const t of ONt())delete e[t];QNt(e);for(const t in e)Dr(e[t])&&tn(e[t])&&delete e[t];return tn(e)?void 0:e}function QNt(e){const{titleMarkConfig:t,subtitleMarkConfig:n,subtitle:r}=qbe(e.title);tn(t)||(e.style["group-title"]=Object.assign(Object.assign({},e.style["group-title"]),t)),tn(n)||(e.style["group-subtitle"]=Object.assign(Object.assign({},e.style["group-subtitle"]),n)),tn(r)?delete e.title:e.title=r}function eFt(e,t,n,r){const i=r?e[t][r]:e[t];t==="view"&&(n="cell");const s=Object.assign(Object.assign({},i),e.style[n??t]);tn(s)||(e.style[n??t]=s),r||delete e[t]}function bF(e){return"layer"in e}function tFt(e){return"repeat"in e}function nFt(e){return!je(e.repeat)&&e.repeat.layer}class gxe{map(t,n){return dF(t)?this.mapFacet(t,n):tFt(t)?this.mapRepeat(t,n):rW(t)?this.mapHConcat(t,n):yF(t)?this.mapVConcat(t,n):nW(t)?this.mapConcat(t,n):this.mapLayerOrUnit(t,n)}mapLayerOrUnit(t,n){if(bF(t))return this.mapLayer(t,n);if(Dc(t))return this.mapUnit(t,n);throw new Error(kj(t))}mapLayer(t,n){return Object.assign(Object.assign({},t),{layer:t.layer.map(r=>this.mapLayerOrUnit(r,n))})}mapHConcat(t,n){return Object.assign(Object.assign({},t),{hconcat:t.hconcat.map(r=>this.map(r,n))})}mapVConcat(t,n){return Object.assign(Object.assign({},t),{vconcat:t.vconcat.map(r=>this.map(r,n))})}mapConcat(t,n){const{concat:r}=t,i=Be(t,["concat"]);return Object.assign(Object.assign({},i),{concat:r.map(s=>this.map(s,n))})}mapFacet(t,n){return Object.assign(Object.assign({},t),{spec:this.map(t.spec,n)})}mapRepeat(t,n){return Object.assign(Object.assign({},t),{spec:this.map(t.spec,n)})}}const rFt={zero:1,center:1,normalize:1};function iFt(e){return e in rFt}const sFt=new Set([Bye,JN,ZN,tA,eF,bj,xj,QN,zye,yj]),oFt=new Set([JN,ZN,Bye]);function vJ(e,t){var n,r;const i=t==="x"?"y":"radius",s=e[t],o=e[i];if(ke(s)&&ke(o))if(Zc(s)==="quantitative"&&Zc(o)==="quantitative"){if(s.stack)return t;if(o.stack)return i;const a=ke(s)&&!!s.aggregate,u=ke(o)&&!!o.aggregate;if(a!==u)return a?t:i;{const l=(n=s.scale)===null||n===void 0?void 0:n.type,c=(r=o.scale)===null||r===void 0?void 0:r.type;if(l&&l!=="linear")return i;if(c&&c!=="linear")return t}}else{if(Zc(s)==="quantitative")return t;if(Zc(o)==="quantitative")return i}else{if(Zc(s)==="quantitative")return t;if(Zc(o)==="quantitative")return i}}function aFt(e){switch(e){case"x":return"y";case"y":return"x";case"theta":return"radius";case"radius":return"theta"}}function mxe(e,t,n={}){const r=Hu(e)?e.type:e;if(!sFt.has(r))return null;const i=vJ(t,"x")||vJ(t,"theta");if(!i)return null;const s=t[i],o=ke(s)?ve(s,{}):void 0;let a=aFt(i),u=t[a],l=ke(u)?ve(u,{}):void 0;l===o&&(l=void 0,u=void 0,a=void 0);const c=nIt.reduce((h,d)=>{if(d!=="tooltip"&&cp(t,d)){const p=t[d];for(const g of jn(p)){const m=Xu(g);if(m.aggregate)continue;const y=ve(m,{});(!y||y!==l)&&h.push({channel:d,fieldDef:m})}}return h},[]);let f;if(s.stack!==void 0?J$(s.stack)?f=s.stack?"zero":null:f=s.stack:c.length>0&&oFt.has(r)&&(f="zero"),!f||!iFt(f)||Xj(t)&&c.length===0)return null;if(s.scale&&s.scale.type&&s.scale.type!==Vn.LINEAR){if(n.disallowNonLinearStack)return null;pe(ZIt(s.scale.type))}return Qe(t[ml(i)])?(s.stack!==void 0&&pe(KIt(i)),null):(ke(s)&&s.aggregate&&!Ve(VTt,s.aggregate)&&pe(JIt(s.aggregate)),{groupbyChannel:u?a:void 0,groupbyField:l,fieldChannel:i,impute:s.impute===null?!1:Ug(r),stackBy:c,offset:f})}function uFt(e){const t=Be(e,["point","line"]);return be(t).length>1?t:t.type}function lFt(e){for(const t of["line","area","rule","trail"])e[t]&&(e=Object.assign(Object.assign({},e),{[t]:tc(e[t],["point","line"])}));return e}function fR(e,t={},n){return e.point==="transparent"?{opacity:0}:e.point?Dr(e.point)?e.point:{}:e.point!==void 0?null:t.point||n.shape?Dr(t.point)?t.point:{}:void 0}function wJ(e,t={}){return e.line?e.line===!0?{}:e.line:e.line!==void 0?null:t.line?t.line===!0?{}:t.line:void 0}class cFt{constructor(){this.name="path-overlay"}hasMatchingType(t,n){if(Dc(t)){const{mark:r,encoding:i}=t,s=Hu(r)?r:{type:r};switch(s.type){case"line":case"rule":case"trail":return!!fR(s,n[s.type],i);case"area":return!!fR(s,n[s.type],i)||!!wJ(s,n[s.type])}}return!1}run(t,n,r){const{config:i}=n,{selection:s,projection:o,encoding:a,mark:u}=t,l=Be(t,["selection","projection","encoding","mark"]),c=Hu(u)?u:{type:u},f=fR(c,i[c.type],a),h=c.type==="area"&&wJ(c,i[c.type]),d=[Object.assign(Object.assign({},s?{selection:s}:{}),{mark:uFt(Object.assign(Object.assign({},c.type==="area"&&c.opacity===void 0&&c.fillOpacity===void 0?{opacity:.7}:{}),c)),encoding:tc(a,["shape"])})],p=mxe(c,a);let g=a;if(p){const{fieldChannel:m,offset:y}=p;g=Object.assign(Object.assign({},a),{[m]:Object.assign(Object.assign({},a[m]),y?{stack:y}:{})})}return h&&d.push(Object.assign(Object.assign({},o?{projection:o}:{}),{mark:Object.assign(Object.assign({type:"line"},u2(c,["clip","interpolate","tension","tooltip"])),h),encoding:g})),f&&d.push(Object.assign(Object.assign({},o?{projection:o}:{}),{mark:Object.assign(Object.assign({type:"point",opacity:1,filled:!0},u2(c,["clip","tooltip"])),f),encoding:g})),r(Object.assign(Object.assign({},l),{layer:d}),Object.assign(Object.assign({},n),{config:lFt(i)}))}}class fFt{constructor(){this.name="RangeStep"}hasMatchingType(t){var n;if(Dc(t)&&t.encoding)for(const r of Vo){const i=t.encoding[r];if(i&&Qe(i)&&!((n=i==null?void 0:i.scale)===null||n===void 0)&&n.rangeStep)return!0}return!1}run(t){var n;const r={};let i=Object.assign({},t.encoding);for(const s of Vo){const o=yl(s),a=i[s];if(a&&Qe(a)&&!((n=a==null?void 0:a.scale)===null||n===void 0)&&n.rangeStep){const{scale:u}=a,l=Be(a,["scale"]),c=u,f=Be(c,["rangeStep"]);r[o]={step:u.rangeStep},pe(RIt),i=Object.assign(Object.assign({},i),{[s]:Object.assign(Object.assign({},l),tn(f)?{}:{scale:f})})}}return Object.assign(Object.assign(Object.assign({},r),t),{encoding:i})}}function hFt(e,t){return t?iC(e)?bxe(e,t):yxe(e,t):e}function hR(e,t){return t?bxe(e,t):e}function aP(e,t,n){const r=t[e];if(oNt(r)){if(r.repeat in n)return Object.assign(Object.assign({},t),{[e]:n[r.repeat]});pe(yIt(r.repeat));return}return t}function yxe(e,t){if(e=aP("field",e,t),e!==void 0){if(e===null)return null;if(Mbe(e)&&Du(e.sort)){const n=aP("field",e.sort,t);e=Object.assign(Object.assign({},e),n?{sort:n}:{})}return e}}function $J(e,t){if(ke(e))return yxe(e,t);{const n=aP("datum",e,t);return n!==e&&!n.type&&(n.type="nominal"),n}}function CJ(e,t){if(Qe(e)){const n=$J(e,t);if(n)return n;if(jj(e))return{condition:e.condition}}else{if(Wj(e)){const n=$J(e.condition,t);return n?Object.assign(Object.assign({},e),{condition:n}):Be(e,["condition"])}return e}}function bxe(e,t){const n={};for(const r in e)if(Hd(e,r)){const i=e[r];if(je(i))n[r]=i.map(s=>CJ(s,t)).filter(s=>s);else{const s=CJ(i,t);s!==void 0&&(n[r]=s)}}return n}class dFt{constructor(){this.name="RuleForRangedLine"}hasMatchingType(t){if(Dc(t)){const{encoding:n,mark:r}=t;if(r==="line")for(const i of eIt){const s=Vg(i),o=n[s];if(n[i]&&(ke(o)&&!ji(o.bin)||Zh(o)))return!0}}return!1}run(t,n,r){const{encoding:i}=t;return pe(FIt(!!i.x2,!!i.y2)),r(Object.assign(Object.assign({},t),{mark:"rule"}),n)}}class pFt extends gxe{constructor(){super(...arguments),this.nonFacetUnitNormalizers=[CNt,ENt,FNt,new cFt,new dFt,new fFt]}map(t,n){if(Dc(t)){const r=cp(t.encoding,nc),i=cp(t.encoding,rc),s=cp(t.encoding,nF);if(r||i||s)return this.mapFacetedUnit(t,n)}return super.map(t,n)}mapUnit(t,n){const{parentEncoding:r,parentProjection:i}=n,s=Object.assign(Object.assign({},t),{encoding:hR(t.encoding,n.repeater)});if(r||i)return this.mapUnitWithParentEncodingOrProjection(s,n);const o=this.mapLayerOrUnit.bind(this);for(const a of this.nonFacetUnitNormalizers)if(a.hasMatchingType(s,n.config))return a.run(s,n,o);return s}mapRepeat(t,n){return nFt(t)?this.mapLayerRepeat(t,n):this.mapNonLayerRepeat(t,n)}mapLayerRepeat(t,n){const{repeat:r,spec:i}=t,s=Be(t,["repeat","spec"]),{row:o,column:a,layer:u}=r,{repeater:l={},repeaterPrefix:c=""}=n;return o||a?this.mapRepeat(Object.assign(Object.assign({},t),{repeat:Object.assign(Object.assign({},o?{row:o}:{}),a?{column:a}:{}),spec:{repeat:{layer:u},spec:i}}),n):Object.assign(Object.assign({},s),{layer:u.map(f=>{const h=Object.assign(Object.assign({},l),{layer:f}),d=(i.name||"")+c+`child__layer_${wn(f)}`,p=this.mapLayerOrUnit(i,Object.assign(Object.assign({},n),{repeater:h,repeaterPrefix:d}));return p.name=d,p})})}mapNonLayerRepeat(t,n){var r;const{repeat:i,spec:s,data:o}=t,a=Be(t,["repeat","spec","data"]);!je(i)&&t.columns&&(t=tc(t,["columns"]),pe(sJ("repeat")));const u=[],{repeater:l={},repeaterPrefix:c=""}=n,f=!je(i)&&i.row||[l?l.row:null],h=!je(i)&&i.column||[l?l.column:null],d=je(i)&&i||[l?l.repeat:null];for(const g of d)for(const m of f)for(const y of h){const b={repeat:g,row:m,column:y,layer:l.layer},v=(s.name||"")+c+"child__"+(je(i)?`${wn(g)}`:(i.row?`row_${wn(m)}`:"")+(i.column?`column_${wn(y)}`:"")),x=this.map(s,Object.assign(Object.assign({},n),{repeater:b,repeaterPrefix:v}));x.name=v,u.push(tc(x,["data"]))}const p=je(i)?t.columns:i.column?i.column.length:1;return Object.assign(Object.assign({data:(r=s.data)!==null&&r!==void 0?r:o,align:"all"},a),{columns:p,concat:u})}mapFacet(t,n){const{facet:r}=t;return iC(r)&&t.columns&&(t=tc(t,["columns"]),pe(sJ("facet"))),super.mapFacet(t,n)}mapUnitWithParentEncodingOrProjection(t,n){const{encoding:r,projection:i}=t,{parentEncoding:s,parentProjection:o,config:a}=n,u=kJ({parentProjection:o,projection:i}),l=SJ({parentEncoding:s,encoding:hR(r,n.repeater)});return this.mapUnit(Object.assign(Object.assign(Object.assign({},t),u?{projection:u}:{}),l?{encoding:l}:{}),{config:a})}mapFacetedUnit(t,n){const r=t.encoding,{row:i,column:s,facet:o}=r,a=Be(r,["row","column","facet"]),{mark:u,width:l,projection:c,height:f,view:h,selection:d,encoding:p}=t,g=Be(t,["mark","width","projection","height","view","selection","encoding"]),{facetMapping:m,layout:y}=this.getFacetMappingAndLayout({row:i,column:s,facet:o},n),b=hR(a,n.repeater);return this.mapFacet(Object.assign(Object.assign(Object.assign({},g),y),{facet:m,spec:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},l?{width:l}:{}),f?{height:f}:{}),h?{view:h}:{}),c?{projection:c}:{}),{mark:u,encoding:b}),d?{selection:d}:{})}),n)}getFacetMappingAndLayout(t,n){var r;const{row:i,column:s,facet:o}=t;if(i||s){o&&pe(NIt([...i?[nc]:[],...s?[rc]:[]]));const a={},u={};for(const l of[nc,rc]){const c=t[l];if(c){const f=Be(c,["align","center","spacing","columns"]);a[l]=f;for(const h of["align","center","spacing"])c[h]!==void 0&&(u[h]=(r=u[h])!==null&&r!==void 0?r:{},u[h][l]=c[h])}}return{facetMapping:a,layout:u}}else{const{align:a,center:u,spacing:l,columns:c}=o,f=Be(o,["align","center","spacing","columns"]);return{facetMapping:hFt(f,n.repeater),layout:Object.assign(Object.assign(Object.assign(Object.assign({},a?{align:a}:{}),u?{center:u}:{}),l?{spacing:l}:{}),c?{columns:c}:{})}}}mapLayer(t,n){var{parentEncoding:r,parentProjection:i}=n,s=Be(n,["parentEncoding","parentProjection"]);const{encoding:o,projection:a}=t,u=Be(t,["encoding","projection"]),l=Object.assign(Object.assign({},s),{parentEncoding:SJ({parentEncoding:r,encoding:o}),parentProjection:kJ({parentProjection:i,projection:a})});return super.mapLayer(u,l)}}function SJ(e){const{parentEncoding:t,encoding:n}=e;if(t&&n){const i=be(t).reduce((s,o)=>(n[o]&&s.push(o),s),[]);i.length>0&&pe($It(i))}const r=Object.assign(Object.assign({},t??{}),n??{});return tn(r)?void 0:r}function kJ(e){const{parentProjection:t,projection:n}=e;return t&&n&&pe(CIt({parentProjection:t,projection:n})),n??t}function xxe(e,t){t===void 0&&(t=pxe(e.config));const n=mFt(e,t),{width:r,height:i}=e,s=yFt(n,{width:r,height:i,autosize:e.autosize},t);return Object.assign(Object.assign({},n),s?{autosize:s}:{})}const gFt=new pFt;function mFt(e,t={}){return gFt.map(e,{config:t})}function EJ(e){return ft(e)?{type:e}:e??{}}function yFt(e,t,n){let{width:r,height:i}=t;const s=Dc(e)||bF(e),o={};s?r=="container"&&i=="container"?(o.type="fit",o.contains="padding"):r=="container"?(o.type="fit-x",o.contains="padding"):i=="container"&&(o.type="fit-y",o.contains="padding"):(r=="container"&&(pe(tJ("width")),r=void 0),i=="container"&&(pe(tJ("height")),i=void 0));const a=Object.assign(Object.assign(Object.assign({type:"pad"},o),n?EJ(n.autosize):{}),EJ(e.autosize));if(a.type==="fit"&&!s&&(pe(cIt),a.type="pad"),r=="container"&&!(a.type=="fit"||a.type=="fit-x")&&pe(nJ("width")),i=="container"&&!(a.type=="fit"||a.type=="fit-y")&&pe(nJ("height")),!Q$(a,{type:"pad"}))return a}function bFt(e){return e==="fit"||e==="fit-x"||e==="fit-y"}function xFt(e){return e?`fit-${aF(e)}`:"fit"}const vFt=["background","padding"];function _J(e){return vFt.reduce((t,n)=>(e&&e[n]!==void 0&&(t[n]=e[n]),t),{})}class Mc{constructor(t={},n={}){this.explicit=t,this.implicit=n}clone(){return new Mc(ht(this.explicit),ht(this.implicit))}combine(){return Object.assign(Object.assign({},this.explicit),this.implicit)}get(t){return Jn(this.explicit[t],this.implicit[t])}getWithExplicit(t){return this.explicit[t]!==void 0?{explicit:!0,value:this.explicit[t]}:this.implicit[t]!==void 0?{explicit:!1,value:this.implicit[t]}:{explicit:!1,value:void 0}}setWithExplicit(t,n){n.value!==void 0&&this.set(t,n.value,n.explicit)}set(t,n,r){return delete this[r?"implicit":"explicit"][t],this[r?"explicit":"implicit"][t]=n,this}copyKeyFromSplit(t,n){n.explicit[t]!==void 0?this.set(t,n.explicit[t],!0):n.implicit[t]!==void 0&&this.set(t,n.implicit[t],!1)}copyKeyFromObject(t,n){n[t]!==void 0&&this.set(t,n[t],!0)}copyAll(t){for(const n of be(t.combine())){const r=t.getWithExplicit(n);this.setWithExplicit(n,r)}}}function qd(e){return{explicit:!0,value:e}}function Ws(e){return{explicit:!1,value:e}}function vxe(e){return(t,n,r,i)=>{const s=e(t.value,n.value);return s>0?t:s<0?n:xF(t,n,r,i)}}function xF(e,t,n,r){return e.explicit&&t.explicit&&pe(WIt(n,r,e.value,t.value)),e}function xh(e,t,n,r,i=xF){return e===void 0||e.value===void 0?t:e.explicit&&!t.explicit?e:t.explicit&&!e.explicit?t:Q$(e.value,t.value)?e:i(e,t,n,r)}class wFt extends Mc{constructor(t={},n={},r=!1){super(t,n),this.explicit=t,this.implicit=n,this.parseNothing=r}clone(){const t=super.clone();return t.parseNothing=this.parseNothing,t}}function p2(e){return"url"in e}function cA(e){return"values"in e}function wxe(e){return"name"in e&&!p2(e)&&!cA(e)&&!fp(e)}function fp(e){return e&&($xe(e)||Cxe(e)||sW(e))}function $xe(e){return"sequence"in e}function Cxe(e){return"sphere"in e}function sW(e){return"graticule"in e}const ci="main",fA="raw";function Sxe(e){return"filter"in e}function $Ft(e){return(e==null?void 0:e.stop)!==void 0}function CFt(e){return"lookup"in e}function SFt(e){return"data"in e}function kFt(e){return"selection"in e}function EFt(e){return"pivot"in e}function _Ft(e){return"density"in e}function AFt(e){return"quantile"in e}function TFt(e){return"regression"in e}function IFt(e){return"loess"in e}function DFt(e){return"sample"in e}function NFt(e){return"window"in e}function FFt(e){return"joinaggregate"in e}function OFt(e){return"flatten"in e}function RFt(e){return"calculate"in e}function MFt(e){return"bin"in e}function LFt(e){return"impute"in e}function PFt(e){return"timeUnit"in e}function BFt(e){return"aggregate"in e}function zFt(e){return"stack"in e}function UFt(e){return"fold"in e}function jFt(e){return e.map(t=>Sxe(t)?{filter:Ck(t.filter,TDt)}:t)}function aC(e,t,n,r){const i=jj(t)&&t.condition,s=r(t);if(i){const a=jn(i).map(u=>{const l=r(u),c=sNt(u)?Kxe(e,u.selection):gA(e,u.test);return Object.assign({test:c},l)});return{[n]:[...a,...s!==void 0?[s]:[]]}}else return s!==void 0?{[n]:s}:{}}function oW(e,t="text"){const n=e.encoding[t];return aC(e,n,t,r=>vF(r,e.config))}function vF(e,t,n="datum"){if(e){if(yc(e))return Bn(e.value);if(Qe(e)){const{format:r,formatType:i}=sA(e);return Pj({fieldOrDatumDef:e,format:r,formatType:i,expr:n,config:t})}}}function kxe(e,t={}){const{encoding:n,markDef:r,config:i,stack:s}=e,o=n.tooltip;if(je(o))return{tooltip:AJ({tooltip:o},s,i,t)};{const a=t.reactiveGeom?"datum.datum":"datum";return aC(e,o,"tooltip",u=>{const l=vF(u,i,a);if(l)return l;if(u===null)return;let c=Bt("tooltip",r,i);if(c===!0&&(c={content:"encoding"}),ft(c))return{value:c};if(Dr(c))return c.content==="encoding"?AJ(n,s,i,t):{signal:a}})}}function Exe(e,t,n,{reactiveGeom:r}={}){const i={},s=r?"datum.datum":"datum",o=[];function a(l,c){const f=Vg(c),h=lo(l)?l:Object.assign(Object.assign({},l),{type:e[f].type}),d=jn(lp(h,n,{allowDisabling:!1})).join(", ");let p;if(qu(c)){const g=c==="x"?"x2":"y2",m=Xu(e[g]);if(ji(h.bin)&&m){const y=ve(h,{expr:s}),b=ve(m,{expr:s}),{format:v,formatType:x}=sA(h);p=fF(y,b,v,x,n),i[g]=!0}else if(t&&t.fieldChannel===c&&t.offset==="normalize"){const{format:y,formatType:b}=sA(h);p=Pj({fieldOrDatumDef:h,format:y,formatType:b,expr:s,config:n,normalizeStack:!0}).signal}}p=p??vF(h,n,s).signal,o.push({channel:c,key:d,value:p})}Kj(e,(l,c)=>{ke(l)?a(l,c):pF(l)&&a(l.condition,c)});const u={};for(const{channel:l,key:c,value:f}of o)!i[l]&&!u[c]&&(u[Ct(c)]=f);return u}function AJ(e,t,n,{reactiveGeom:r}={}){const i=Exe(e,t,n,{reactiveGeom:r}),s=Oye(i).map(({key:o,value:a})=>`${o}: ${a}`);return s.length>0?{signal:`{${s.join(", ")}}`}:void 0}function WFt(e){const{markDef:t,config:n}=e,r=Bt("aria",t,n);return r===!1?{}:Object.assign(Object.assign(Object.assign({},r?{aria:r}:{}),VFt(e)),GFt(e))}function VFt(e){const{mark:t,markDef:n,config:r}=e;if(r.aria===!1)return{};const i=Bt("ariaRoleDescription",n,r);return i!=null?{ariaRoleDescription:{value:i}}:t in kDt?{}:{ariaRoleDescription:{value:t}}}function GFt(e){const{encoding:t,markDef:n,config:r,stack:i}=e,s=t.description;if(s)return aC(e,s,"description",u=>vF(u,e.config));const o=Bt("description",n,r);if(o!=null)return{description:Bn(o)};if(r.aria===!1)return{};const a=Exe(t,i,r);if(!tn(a))return{description:{signal:Oye(a).map(({key:u,value:l})=>`${u} + ": " + (${l})`).join(' + "; " + ')}}}function $r(e,t,n={}){const{markDef:r,encoding:i,config:s}=t,{vgChannel:o}=n;let{defaultRef:a,defaultValue:u}=n;a===void 0&&(u=u??Bt(e,r,s,{vgChannel:o,ignoreVgConfig:!0}),u!==void 0&&(a=Bn(u)));const l=i[e];return aC(t,l,o??e,c=>_be({channel:e,channelDef:c,markDef:r,config:s,scaleName:t.scaleName(e),scale:t.getScaleComponent(e),stack:null,defaultRef:a}))}function _xe(e,t={filled:void 0}){var n,r,i,s;const{markDef:o,encoding:a,config:u}=e,{type:l}=o,c=(n=t.filled)!==null&&n!==void 0?n:Bt("filled",o,u),f=Ve(["bar","point","circle","square","geoshape"],l)?"transparent":void 0,h=(i=(r=Bt(c===!0?"color":void 0,o,u,{vgChannel:"fill"}))!==null&&r!==void 0?r:u.mark[c===!0&&"color"])!==null&&i!==void 0?i:f,d=(s=Bt(c===!1?"color":void 0,o,u,{vgChannel:"stroke"}))!==null&&s!==void 0?s:u.mark[c===!1&&"color"],p=c?"fill":"stroke",g=Object.assign(Object.assign({},h?{fill:Bn(h)}:{}),d?{stroke:Bn(d)}:{});return o.color&&(c?o.fill:o.stroke)&&pe(ibe("property",{fill:"fill"in o,stroke:"stroke"in o})),Object.assign(Object.assign(Object.assign(Object.assign({},g),$r("color",e,{vgChannel:p,defaultValue:c?h:d})),$r("fill",e,{defaultValue:a.fill?h:void 0})),$r("stroke",e,{defaultValue:a.stroke?d:void 0}))}function g2(e,t){const n=tIt(e),r=t[n];if(r)return r}function bi(e,t,{defaultPos:n,vgChannel:r,isMidPoint:i}){const{encoding:s,markDef:o,config:a,stack:u}=t,l=s[e],c=s[ml(e)],f=t.scaleName(e),h=t.getScaleComponent(e),d=g2(e,o),p=aW({model:t,defaultPos:n,channel:e,scaleName:f,scale:h}),g=!l&&qu(e)&&(s.latitude||s.longitude)?{field:t.getName(e)}:HFt({channel:e,channelDef:l,channel2Def:c,markDef:o,config:a,isMidPoint:i,scaleName:f,scale:h,stack:u,offset:d,defaultRef:p});return g?{[r||e]:g}:void 0}function HFt(e){const{channel:t,channelDef:n,isMidPoint:r,scaleName:i,stack:s,offset:o,markDef:a,config:u}=e;if(Qe(n)&&s&&t===s.fieldChannel){if(ke(n)){const l=sC({channel:t,fieldDef:n,isMidPoint:r,markDef:a,stack:s,config:u});if(l!==void 0)return iA({scaleName:i,fieldOrDatumDef:n,startSuffix:"start",band:l,offset:o})}return up(n,i,{suffix:"end"},{offset:o})}return Mj(e)}function aW({model:e,defaultPos:t,channel:n,scaleName:r,scale:i}){const{markDef:s,config:o}=e;return()=>{const a=Vg(n),u=bh(n),l=Bt(n,s,o,{vgChannel:u});if(l!==void 0)return Tx(n,l);switch(t){case"zeroOrMin":case"zeroOrMax":if(r){const c=i.get("type");if(!Ve([Vn.LOG,Vn.TIME,Vn.UTC],c)){if(i.domainDefinitelyIncludesZero())return{scale:r,value:0}}}if(t==="zeroOrMin")return a==="y"?{field:{group:"height"}}:{value:0};switch(a){case"radius":return{signal:`min(${e.width.signal},${e.height.signal})/2`};case"theta":return{signal:"2*PI"};case"x":return{field:{group:"width"}};case"y":return{value:0}}break;case"mid":{const c=e[yl(n)];return Object.assign(Object.assign({},c),{mult:.5})}}}}const qFt={left:"x",center:"xc",right:"x2"},XFt={top:"y",middle:"yc",bottom:"y2"};function Axe(e,t,n,r="middle"){if(e==="radius"||e==="theta")return bh(e);const s=Bt(e==="x"?"align":"baseline",t,n);return e==="x"?qFt[s||(r==="top"?"left":"center")]:XFt[s||r]}function hA(e,t,{defaultPos:n,defaultPos2:r,range:i}){return i?Txe(e,t,{defaultPos:n,defaultPos2:r}):bi(e,t,{defaultPos:n})}function Txe(e,t,{defaultPos:n,defaultPos2:r}){const{markDef:i,config:s}=t,o=ml(e),a=yl(e),u=YFt(t,r,o),l=u[a]?Axe(e,i,s):bh(e);return Object.assign(Object.assign({},bi(e,t,{defaultPos:n,vgChannel:l})),u)}function YFt(e,t,n){const{encoding:r,mark:i,markDef:s,stack:o,config:a}=e,u=Vg(n),l=yl(n),c=bh(n),f=r[u],h=e.scaleName(u),d=e.getScaleComponent(u),p=n in r||n in s?g2(n,e.markDef):g2(u,e.markDef);if(!f&&(n==="x2"||n==="y2")&&(r.latitude||r.longitude))return{[c]:{field:e.getName(n)}};const g=KFt({channel:n,channelDef:f,channel2Def:r[n],markDef:s,config:a,scaleName:h,scale:d,stack:o,offset:p,defaultRef:void 0});return g!==void 0?{[c]:g}:IS(n,s)||IS(n,{[n]:aA(n,s,a.style),[l]:aA(l,s,a.style)})||IS(n,a[i])||IS(n,a.mark)||{[c]:aW({model:e,defaultPos:t,channel:n,scaleName:h,scale:d})()}}function KFt({channel:e,channelDef:t,channel2Def:n,markDef:r,config:i,scaleName:s,scale:o,stack:a,offset:u,defaultRef:l}){return Qe(t)&&a&&e.charAt(0)===a.fieldChannel.charAt(0)?up(t,s,{suffix:"start"},{offset:u}):Mj({channel:e,channelDef:n,scaleName:s,scale:o,stack:a,markDef:r,config:i,offset:u,defaultRef:l})}function IS(e,t){const n=yl(e),r=bh(e);if(t[r]!==void 0)return{[r]:Tx(e,t[r])};if(t[e]!==void 0)return{[r]:Tx(e,t[e])};if(t[n])return{[n]:Tx(e,t[n])}}function vh(e,t,n){var r,i,s,o;const{config:a,encoding:u,markDef:l,stack:c}=e,f=ml(t),h=yl(t),d=u[t],p=u[f],g=e.getScaleComponent(t),m=g?g.get("type"):void 0,y=e.scaleName(t),b=l.orient,v=(i=(r=u[h])!==null&&r!==void 0?r:u.size)!==null&&i!==void 0?i:Bt("size",l,a,{vgChannel:h}),x=n==="bar"&&(t==="x"?b==="vertical":b==="horizontal");if(ke(d)&&(ln(d.bin)||ji(d.bin)||d.timeUnit&&!p)&&!v&&!Ms(m)){const w=sC({channel:t,fieldDef:d,stack:c,markDef:l,config:a}),C=(s=e.component.axes[t])===null||s===void 0?void 0:s[0],$=(o=C==null?void 0:C.get("translate"))!==null&&o!==void 0?o:.5;return QFt({fieldDef:d,fieldDef2:p,channel:t,markDef:l,scaleName:y,band:w,axisTranslate:$,spacing:qu(t)?Bt("binSpacing",l,a):void 0,reverse:g.get("reverse"),config:a})}else return(Qe(d)&&Ms(m)||x)&&!p?JFt(n,d,t,e):Txe(t,e,{defaultPos:"zeroOrMax",defaultPos2:"zeroOrMin"})}function ZFt(e,t,n,r,i,s){if(r){const u=r.get("type");if(u==="point"||u==="band"){if(i[e].discreteBandSize!==void 0)return{value:i[e].discreteBandSize};if(u===Vn.POINT){const l=r.get("range");return Kh(l)&&Zn(l.step)?{value:l.step-2}:{value:iW-2}}else return{scale:n,band:s}}else return{value:i[e].continuousBandSize}}const o=lA(i.view,t),a=Jn(i[e].discreteBandSize,o-2);return a!==void 0?{value:a}:void 0}function JFt(e,t,n,r){var i;const{markDef:s,encoding:o,config:a,stack:u}=r,l=s.orient,c=r.scaleName(n),f=r.getScaleComponent(n),h=yl(n),d=ml(n),p=l==="horizontal"&&n==="y"||l==="vertical"&&n==="x",g=Bt(p?"size":h,s,a,{vgChannel:h});let m;(o.size||g!==void 0)&&(p?m=$r("size",r,{vgChannel:h,defaultValue:g}):pe(zIt(s.type)));const y=(i=Qe(t)?sC({channel:n,fieldDef:t,markDef:s,stack:u,config:a}):void 0)!==null&&i!==void 0?i:1;m=m||{[h]:ZFt(e,h,c,f,a,y)};const b=(f==null?void 0:f.get("type"))!=="band"||!("band"in m[h]),v=Axe(n,s,a,b?"middle":"top"),x=g2(n,s),w=Mj({channel:n,channelDef:t,markDef:s,config:a,scaleName:c,scale:f,stack:u,offset:x,defaultRef:aW({model:r,defaultPos:"mid",channel:n,scaleName:c,scale:f}),band:b?.5:(1-y)/2});if(h)return Object.assign({[v]:w},m);{const C=bh(d),$=m[h],S=x?Object.assign(Object.assign({},$),{offset:x}):$;return{[v]:w,[C]:je(w)?[w[0],Object.assign(Object.assign({},w[1]),{offset:S})]:Object.assign(Object.assign({},w),{offset:S})}}}function wb(e,t,n,r,i){if(Hye(e))return 0;const s=e==="x"||e==="y2"?-t/2:t/2;if(Xe(n)){const o=h2(i);return{signal:`${n.signal} ? ${r-s}${o?"-"+o:""} : ${r+s}${o?"+"+o:""}`}}else{if(Xe(i)){const o=r+(n?-s:s);return{signal:`${o||""}${n?" - ":o?" + ":""}${i.signal}`}}return i=i||0,r+(n?-i-s:+i+s)}}function QFt({fieldDef:e,fieldDef2:t,channel:n,band:r,scaleName:i,markDef:s,spacing:o=0,axisTranslate:a,reverse:u,config:l}){const c=ml(n),f=bh(n),h=bh(c),d=g2(n,s);if(ln(e.bin)||e.timeUnit)return{[h]:TJ({channel:n,fieldDef:e,scaleName:i,markDef:s,band:(1-r)/2,offset:wb(c,o,u,a,d),config:l}),[f]:TJ({channel:n,fieldDef:e,scaleName:i,markDef:s,band:1-(1-r)/2,offset:wb(n,o,u,a,d),config:l})};if(ji(e.bin)){const p=up(e,i,{},{offset:wb(c,o,u,a,d)});if(ke(t))return{[h]:p,[f]:up(t,i,{},{offset:wb(n,o,u,a,d)})};if(rC(e.bin)&&e.bin.step)return{[h]:p,[f]:{signal:`scale("${i}", ${ve(e,{expr:"datum"})} + ${e.bin.step})`,offset:wb(n,o,u,a,d)}}}pe(abe(c))}function TJ({channel:e,fieldDef:t,scaleName:n,markDef:r,band:i,offset:s,config:o}){const a=iA({scaleName:n,fieldOrDatumDef:t,band:i,offset:s});return Ebe({fieldDef:t,channel:e,markDef:r,ref:a,config:o})}const e3t=new Set(["aria"]);function Jo(e,t){const{fill:n=void 0,stroke:r=void 0}=t.color==="include"?_xe(e):{};return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},t3t(e.markDef,t)),IJ(e,"fill",n)),IJ(e,"stroke",r)),$r("opacity",e)),$r("fillOpacity",e)),$r("strokeOpacity",e)),$r("strokeWidth",e)),$r("strokeDash",e)),kxe(e)),oW(e,"href")),WFt(e))}function IJ(e,t,n){const{config:r,mark:i,markDef:s}=e;if(Bt("invalid",s,r)==="hide"&&n&&!Ug(i)){const a=n3t(e,{invalid:!0,channels:uF});if(a)return{[t]:[{test:a,value:null},...jn(n)]}}return n?{[t]:n}:{}}function t3t(e,t){return SDt.reduce((n,r)=>(!e3t.has(r)&&e[r]!==void 0&&t[r]!=="ignore"&&(n[r]=Bn(e[r])),n),{})}function n3t(e,{invalid:t=!1,channels:n}){const r=n.reduce((s,o)=>{const a=e.getScaleComponent(o);if(a){const u=a.get("type"),l=e.vgField(o,{expr:"datum"});l&&Go(u)&&(s[l]=!0)}return s},{}),i=be(r);if(i.length>0){const s=t?"||":"&&";return i.map(o=>Lj(o,t)).join(` ${s} `)}}function uW(e){const{config:t,markDef:n}=e;if(Bt("invalid",n,t)){const i=r3t(e,{channels:Vo});if(i)return{defined:{signal:i}}}return{}}function r3t(e,{invalid:t=!1,channels:n}){const r=n.reduce((s,o)=>{const a=e.getScaleComponent(o);if(a){const u=a.get("type"),l=e.vgField(o,{expr:"datum"});l&&Go(u)&&(s[l]=!0)}return s},{}),i=be(r);if(i.length>0){const s=t?"||":"&&";return i.map(o=>Lj(o,t)).join(` ${s} `)}}function DJ(e,t){if(t!==void 0)return{[e]:Bn(t)}}const dR="voronoi",Ixe={has:e=>e.type!=="interval"&&e.nearest,parse:(e,t)=>{if(t.events)for(const n of t.events)n.markname=e.getName(dR)},marks:(e,t,n)=>{const{x:r,y:i}=t.project.hasChannel,s=e.mark;if(Ug(s))return pe(hIt(s)),n;const o={name:e.getName(dR),type:"path",interactive:!0,from:{data:e.getName("marks")},encode:{update:Object.assign({fill:{value:"transparent"},strokeWidth:{value:.35},stroke:{value:"transparent"},isVoronoi:{value:!0}},kxe(e,{reactiveGeom:!0}))},transform:[{type:"voronoi",x:{expr:r||!i?"datum.datum.x || 0":"0"},y:{expr:i||!r?"datum.datum.y || 0":"0"},size:[e.getSizeSignalRef("width"),e.getSizeSignalRef("height")]}]};let a=0,u=!1;return n.forEach((l,c)=>{var f;const h=(f=l.name)!==null&&f!==void 0?f:"";h===e.component.mark[0].name?a=c:h.indexOf(dR)>=0&&(u=!0)}),u||n.splice(a+1,0,o),n}};class Jt{constructor(t,n){this.debugName=n,this._children=[],this._parent=null,t&&(this.parent=t)}clone(){throw new Error("Cannot clone node")}get parent(){return this._parent}set parent(t){this._parent=t,t&&t.addChild(this)}get children(){return this._children}numChildren(){return this._children.length}addChild(t,n){if(this._children.indexOf(t)>-1){console.warn("Attempt to add the same child twice.");return}n!==void 0?this._children.splice(n,0,t):this._children.push(t)}removeChild(t){const n=this._children.indexOf(t);return this._children.splice(n,1),n}remove(){let t=this._parent.removeChild(this);for(const n of this._children)n._parent=this._parent,this._parent.addChild(n,t++)}insertAsParentOf(t){const n=t.parent;n.removeChild(this),this.parent=n,t.parent=this}swapWithParent(){const t=this._parent,n=t.parent;for(const r of this._children)r.parent=t;this._children=[],t.removeChild(this),t.parent.removeChild(t),this.parent=n,t.parent=this}}class Hi extends Jt{constructor(t,n,r,i){super(t,n),this.type=r,this.refCounts=i,this._source=this._name=n,this.refCounts&&!(this._name in this.refCounts)&&(this.refCounts[this._name]=0)}clone(){const t=new this.constructor;return t.debugName="clone_"+this.debugName,t._source=this._source,t._name="clone_"+this._name,t.type=this.type,t.refCounts=this.refCounts,t.refCounts[t._name]=0,t}dependentFields(){return new Set}producedFields(){return new Set}hash(){return this._hash===void 0&&(this._hash=`Output ${wTt()}`),this._hash}getSource(){return this.refCounts[this._name]++,this._source}isRequired(){return!!this.refCounts[this._name]}setSource(t){this._source=t}}class Nu extends Jt{constructor(t,n){super(t),this.formula=n}clone(){return new Nu(null,ht(this.formula))}static makeFromEncoding(t,n){const r=n.reduceFieldDef((i,s,o)=>{const{field:a,timeUnit:u}=s,l=In(n)?n.encoding[ml(o)]:void 0,c=In(n)&&Uj(o,s,l,n.stack,n.markDef,n.config);if(u){const f=ve(s,{forAs:!0});i[Et({as:f,field:a,timeUnit:u})]=Object.assign({as:f,field:a,timeUnit:u},c?{band:!0}:{})}return i},{});return tn(r)?null:new Nu(t,r)}static makeFromTransform(t,n){const r=Object.assign({},n),{timeUnit:i}=r,s=Be(r,["timeUnit"]),o=Qi(i),a=Object.assign(Object.assign({},s),{timeUnit:o});return new Nu(t,{[Et(a)]:a})}merge(t){this.formula=Object.assign({},this.formula);for(const n in t.formula)(!this.formula[n]||t.formula[n].band)&&(this.formula[n]=t.formula[n]);for(const n of t.children)t.removeChild(n),n.parent=this;t.remove()}producedFields(){return new Set(Df(this.formula).map(t=>t.as))}dependentFields(){return new Set(Df(this.formula).map(t=>t.field))}hash(){return`TimeUnit ${Et(this.formula)}`}assemble(){const t=[];for(const n of Df(this.formula)){const{field:r,as:i,timeUnit:s}=n,o=Qi(s),{unit:a,utc:u}=o,l=Be(o,["unit","utc"]);t.push(Object.assign(Object.assign(Object.assign(Object.assign({field:mh(r),type:"timeunit"},a?{units:Tj(a)}:{}),u?{timezone:"utc"}:{}),l),{as:[i,`${i}_end`]}))}return t}}const uC="_tuple_fields";class i3t{constructor(...t){this.items=t,this.hasChannel={},this.hasField={}}}const s3t={has:()=>!0,parse:(e,t,n)=>{var r,i,s;const o=t.name,a=(r=t.project)!==null&&r!==void 0?r:t.project=new i3t,u={},l={},c=new Set,f=(h,d)=>{const p=d==="visual"?h.channel:h.field;let g=wn(`${o}_${p}`);for(let m=1;c.has(g);m++)g=wn(`${o}_${p}_${m}`);return c.add(g),{[d]:g}};if(!n.fields&&!n.encodings){const h=e.config.selection[n.type];if(n.init)for(const d of jn(n.init))for(const p of be(d))QTt(p)?(n.encodings||(n.encodings=[])).push(p):n.type==="interval"?(pe('Interval selections should be initialized using "x" and/or "y" keys.'),n.encodings=h.encodings):(n.fields||(n.fields=[])).push(p);else n.encodings=h.encodings,n.fields=h.fields}for(const h of(i=n.fields)!==null&&i!==void 0?i:[]){const d={type:"E",field:h};d.signals=Object.assign({},f(d,"data")),a.items.push(d),a.hasField[h]=d}for(const h of(s=n.encodings)!==null&&s!==void 0?s:[]){const d=e.fieldDef(h);if(d){let p=d.field;if(d.aggregate){pe(fIt(h,d.aggregate));continue}else if(!p){pe(iJ(h));continue}if(d.timeUnit){p=e.vgField(h);const g={timeUnit:d.timeUnit,as:p,field:d.field};l[Et(g)]=g}if(!u[p]){let g="E";if(t.type==="interval"){const y=e.getScaleComponent(h).get("type");Go(y)&&(g="R")}else d.bin&&(g="R-RE");const m={field:p,channel:h,type:g};m.signals=Object.assign(Object.assign({},f(m,"data")),f(m,"visual")),a.items.push(u[p]=m),a.hasField[p]=a.hasChannel[h]=u[p]}}else pe(iJ(h))}if(n.init){const h=d=>a.items.map(p=>d[p.channel]!==void 0?d[p.channel]:d[p.field]);if(n.type==="interval")t.init=h(n.init);else{const d=jn(n.init);t.init=d.map(h)}}tn(l)||(a.timeUnit=new Nu(null,l))},signals:(e,t,n)=>{const r=t.name+uC;return n.filter(s=>s.name===r).length>0?n:n.concat({name:r,value:t.project.items.map(s=>{const o=Be(s,["signals","hasLegend"]);return o.field=mh(o.field),o})})}},Dxe={has:e=>e.type==="single"&&e.resolve==="global"&&e.bind&&e.bind!=="scales"&&!tW(e.bind),parse:(e,t,n,r)=>{r.on||delete t.events,r.clear||delete t.clear},topLevelSignals:(e,t,n)=>{const r=t.name,i=t.project,s=t.bind,o=t.init&&t.init[0],a=Ixe.has(t)?"(item().isVoronoi ? datum.datum : datum)":"datum";return i.items.forEach((u,l)=>{var c,f;const h=wn(`${r}_${u.field}`);n.filter(p=>p.name===h).length||n.unshift(Object.assign(Object.assign({name:h},o?{init:z0(o[l])}:{value:null}),{on:t.events?[{events:t.events,update:`datum && item().mark.marktype !== 'group' ? ${a}[${Ct(u.field)}] : null`}]:[],bind:(f=(c=s[u.field])!==null&&c!==void 0?c:s[u.channel])!==null&&f!==void 0?f:s}))}),n},signals:(e,t,n)=>{const r=t.name,i=t.project,s=n.filter(l=>l.name===r+Ku)[0],o=r+uC,a=i.items.map(l=>wn(`${r}_${l.field}`)),u=a.map(l=>`${l} !== null`).join(" && ");return a.length&&(s.update=`${u} ? {fields: ${o}, values: [${a.join(", ")}]} : null`),delete s.value,delete s.on,n}},dA="_toggle",Nxe={has:e=>e.type==="multi"&&!!e.toggle,signals:(e,t,n)=>n.concat({name:t.name+dA,value:!1,on:[{events:t.events,update:t.toggle}]}),modifyExpr:(e,t)=>{const n=t.name+Ku,r=t.name+dA;return`${r} ? null : ${n}, `+(t.resolve==="global"?`${r} ? null : true, `:`${r} ? null : {unit: ${ic(e)}}, `)+`${r} ? ${n} : null`}},o3t={has:e=>e.clear!==void 0&&e.clear!==!1,parse:(e,t,n)=>{n.clear&&(t.clear=ft(n.clear)?Pg(n.clear,"scope"):n.clear)},topLevelSignals:(e,t,n)=>{if(Dxe.has(t))for(const r of t.project.items){const i=n.findIndex(s=>s.name===wn(`${t.name}_${r.field}`));i!==-1&&n[i].on.push({events:t.clear,update:"null"})}return n},signals:(e,t,n)=>{function r(i,s){i!==-1&&n[i].on&&n[i].on.push({events:t.clear,update:s})}if(t.type==="interval")for(const i of t.project.items){const s=n.findIndex(o=>o.name===i.signals.visual);if(r(s,"[0, 0]"),s===-1){const o=n.findIndex(a=>a.name===i.signals.data);r(o,"null")}}else{let i=n.findIndex(s=>s.name===t.name+Ku);r(i,"null"),Nxe.has(t)&&(i=n.findIndex(s=>s.name===t.name+dA),r(i,"false"))}return n}},wh={has:e=>e.type==="interval"&&e.resolve==="global"&&e.bind&&e.bind==="scales",parse:(e,t)=>{const n=t.scales=[];for(const r of t.project.items){const i=r.channel;if(!Yh(i))continue;const s=e.getScaleComponent(i),o=s?s.get("type"):void 0;if(!s||!Go(o)){pe(pIt);continue}const a={selection:t.name,field:r.field};s.set("selectionExtent",a,!0),n.push(r)}},topLevelSignals:(e,t,n)=>{const r=t.scales.filter(o=>n.filter(a=>a.name===o.signals.data).length===0);if(!e.parent||lP(e)||r.length===0)return n;const i=n.filter(o=>o.name===t.name)[0];let s=i.update;if(s.indexOf(Uxe)>=0)i.update=`{${r.map(o=>`${Ct(o.field)}: ${o.signals.data}`).join(", ")}}`;else{for(const o of r){const a=`${Ct(o.field)}: ${o.signals.data}`;s.indexOf(a)<0&&(s=`${s.substring(0,s.length-1)}, ${a}}`)}i.update=s}return n.concat(r.map(o=>({name:o.signals.data})))},signals:(e,t,n)=>{if(e.parent&&!lP(e))for(const r of t.scales){const i=n.filter(s=>s.name===r.signals.data)[0];i.push="outer",delete i.value,delete i.update}return n}};function uP(e,t){return`domain(${Ct(e.scaleName(t))})`}function lP(e){var t;return e.parent&&My(e.parent)&&((t=!e.parent.parent)!==null&&t!==void 0?t:lP(e.parent.parent))}const Fxe={has:e=>{const t=e.resolve==="global"&&e.bind&&tW(e.bind),n=e.project.items.length===1&&e.project.items[0].field!==B0;return t&&!n&&pe(gIt),t&&n},parse:(e,t,n,r)=>{var i;if(r.on||delete t.events,r.clear||delete t.clear,r.on||r.clear){const a='event.item && indexof(event.item.mark.role, "legend") < 0';for(const u of t.events)u.filter=jn((i=u.filter)!==null&&i!==void 0?i:[]),u.filter.indexOf(a)<0&&u.filter.push(a)}const s=cR(t.bind)?t.bind.legend:"click",o=ft(s)?Pg(s,"view"):jn(s);t.bind={legend:{merge:o}}},topLevelSignals:(e,t,n)=>{const r=t.name,i=cR(t.bind)&&t.bind.legend,s=o=>a=>{const u=ht(a);return u.markname=o,u};for(const o of t.project.items){if(!o.hasLegend)continue;const a=`${wn(o.field)}_legend`,u=`${r}_${a}`;if(n.filter(c=>c.name===u).length===0){const c=i.merge.map(s(`${a}_symbols`)).concat(i.merge.map(s(`${a}_labels`))).concat(i.merge.map(s(`${a}_entries`)));n.unshift(Object.assign(Object.assign({name:u},t.init?{}:{value:null}),{on:[{events:c,update:"datum.value || item().items[0].items[0].datum.value",force:!0},{events:i.merge,update:`!event.item || !datum ? null : ${u}`,force:!0}]}))}}return n},signals:(e,t,n)=>{const r=t.name,i=t.project,s=n.find(h=>h.name===r+Ku),o=r+uC,a=i.items.filter(h=>h.hasLegend).map(h=>wn(`${r}_${wn(h.field)}_legend`)),l=`${a.map(h=>`${h} !== null`).join(" && ")} ? {fields: ${o}, values: [${a.join(", ")}]} : null`;t.events&&a.length>0?s.on.push({events:a.map(h=>({signal:h})),update:l}):a.length>0&&(s.update=l,delete s.value,delete s.on);const c=n.find(h=>h.name===r+dA),f=cR(t.bind)&&t.bind.legend;return c&&(t.events?c.on.push(Object.assign(Object.assign({},c.on[0]),{events:f})):c.on[0].events=f),n}};function a3t(e,t,n){var r;const i=(r=e.fieldDef(t))===null||r===void 0?void 0:r.field;Gg(e,s=>{var o,a;const u=(o=s.project.hasField[i])!==null&&o!==void 0?o:s.project.hasChannel[t];if(u&&Fxe.has(s)){const l=(a=n.get("selections"))!==null&&a!==void 0?a:[];l.push(s.name),n.set("selections",l,!1),u.hasLegend=!0}})}const Oxe="_translate_anchor",Rxe="_translate_delta",u3t={has:e=>e.type==="interval"&&e.translate,signals:(e,t,n)=>{const r=t.name,i=wh.has(t),s=r+Oxe,{x:o,y:a}=t.project.hasChannel;let u=Pg(t.translate,"scope");return i||(u=u.map(l=>(l.between[0].markname=r+Ix,l))),n.push({name:s,value:{},on:[{events:u.map(l=>l.between[0]),update:"{x: x(unit), y: y(unit)"+(o!==void 0?", extent_x: "+(i?uP(e,_n):`slice(${o.signals.visual})`):"")+(a!==void 0?", extent_y: "+(i?uP(e,fr):`slice(${a.signals.visual})`):"")+"}"}]},{name:r+Rxe,value:{},on:[{events:u,update:`{x: ${s}.x - x(unit), y: ${s}.y - y(unit)}`}]}),o!==void 0&&NJ(e,t,o,"width",n),a!==void 0&&NJ(e,t,a,"height",n),n}};function NJ(e,t,n,r,i){var s;const o=t.name,a=o+Oxe,u=o+Rxe,l=n.channel,c=wh.has(t),f=i.filter(x=>x.name===n.signals[c?"data":"visual"])[0],h=e.getSizeSignalRef(r).signal,d=e.getScaleComponent(l),p=d.get("type"),g=c&&l===_n?"-":"",m=`${a}.extent_${l}`,y=`${g}${u}.${l} / `+(c?`${h}`:`span(${m})`),v=`${c?p==="log"?"panLog":p==="pow"?"panPow":"panLinear":"panLinear"}(${m}, ${y}`+(c&&p==="pow"?`, ${(s=d.get("exponent"))!==null&&s!==void 0?s:1}`:"")+")";f.on.push({events:{signal:u},update:c?v:`clampRange(${v}, 0, ${h})`})}const Mxe="_zoom_anchor",Lxe="_zoom_delta",l3t={has:e=>e.type==="interval"&&e.zoom,signals:(e,t,n)=>{const r=t.name,i=wh.has(t),s=r+Lxe,{x:o,y:a}=t.project.hasChannel,u=Ct(e.scaleName(_n)),l=Ct(e.scaleName(fr));let c=Pg(t.zoom,"scope");return i||(c=c.map(f=>(f.markname=r+Ix,f))),n.push({name:r+Mxe,on:[{events:c,update:i?"{"+[u?`x: invert(${u}, x(unit))`:"",l?`y: invert(${l}, y(unit))`:""].filter(f=>!!f).join(", ")+"}":"{x: x(unit), y: y(unit)}"}]},{name:s,on:[{events:c,force:!0,update:"pow(1.001, event.deltaY * pow(16, event.deltaMode))"}]}),o!==void 0&&FJ(e,t,o,"width",n),a!==void 0&&FJ(e,t,a,"height",n),n}};function FJ(e,t,n,r,i){var s;const o=t.name,a=n.channel,u=wh.has(t),l=i.filter(b=>b.name===n.signals[u?"data":"visual"])[0],c=e.getSizeSignalRef(r).signal,f=e.getScaleComponent(a),h=f.get("type"),d=u?uP(e,a):l.name,p=o+Lxe,g=`${o}${Mxe}.${a}`,y=`${u?h==="log"?"zoomLog":h==="pow"?"zoomPow":"zoomLinear":"zoomLinear"}(${d}, ${g}, ${p}`+(u&&h==="pow"?`, ${(s=f.get("exponent"))!==null&&s!==void 0?s:1}`:"")+")";l.on.push({events:{signal:p},update:u?y:`clampRange(${y}, 0, ${c})`})}const c3t=[s3t,Nxe,wh,Fxe,u3t,l3t,Dxe,Ixe,o3t];function wF(e,t){for(const n of c3t)n.has(e)&&t(n)}function z0(e,t=!0,n=tTt){if(je(e)){const r=e.map(i=>z0(i,t,n));return t?`[${r.join(", ")}]`:r}else if(Ty(e))return n(t?f2(e):pDt(e));return t?n(JSON.stringify(e)):e}function f3t(e,t){return Gg(e,(n,r)=>{const i=n.name;let s=r.modifyExpr(e,n);t.push(...r.signals(e,n)),wF(n,o=>{o.signals&&(t=o.signals(e,n,t)),o.modifyExpr&&(s=o.modifyExpr(e,n,s))}),t.push({name:i+w3t,on:[{events:{signal:n.name+Ku},update:`modify(${Ct(n.name+Xp)}, ${s})`}]})}),lW(t)}function h3t(e,t){if(e.component.selection&&be(e.component.selection).length){const n=Ct(e.getName("cell"));t.unshift({name:"facet",value:{},on:[{events:Pg("mousemove","scope"),update:`isTuple(facet) ? facet : group(${n}).datum`}]})}return lW(t)}function d3t(e,t){let n=!1;return Gg(e,(r,i)=>{const s=r.name,o=Ct(s+Xp);if(t.filter(u=>u.name===s).length===0){const u=r.resolve==="global"?"union":r.resolve,l=r.type==="multi"?", true)":")";t.push({name:r.name,update:`${Uxe}(${o}, ${Ct(u)}${l}`})}n=!0,i.topLevelSignals&&(t=i.topLevelSignals(e,r,t)),wF(r,u=>{u.topLevelSignals&&(t=u.topLevelSignals(e,r,t))})}),n&&t.filter(i=>i.name==="unit").length===0&&t.unshift({name:"unit",value:{},on:[{events:"mousemove",update:"isTuple(group()) ? group() : unit"}]}),lW(t)}function p3t(e,t){const n=[...t];return Gg(e,r=>{const i={name:r.name+Xp};if(r.init){const o=r.project.items.map(u=>Be(u,["signals"])),a=r.init.map(u=>z0(u,!1));i.values=r.type==="interval"?[{unit:ic(e,{escape:!1}),fields:o,values:a}]:a.map(u=>({unit:ic(e,{escape:!1}),fields:o,values:u}))}n.filter(o=>o.name===r.name+Xp).length||n.push(i)}),n}function Pxe(e,t){return Gg(e,(n,r)=>{t=r.marks?r.marks(e,n,t):t,wF(n,i=>{i.marks&&(t=i.marks(e,n,t))})}),t}function g3t(e,t){for(const n of e.children)In(n)&&(t=Pxe(n,t));return t}function m3t(e,t){const n=t.selection,r=e.getSelectionComponent(n,wn(n));return{signal:Zxe(r,t)}}function lW(e){return e.map(t=>(t.on&&!t.on.length&&delete t.on,t))}const Ix="_brush",cP="_scale_trigger",y3t={signals:(e,t)=>{const n=t.name,r=n+uC,i=wh.has(t),s=[],o=[],a=[];if(t.translate&&!i){const c=`!event.item || event.item.mark.name !== ${Ct(n+Ix)}`;Bxe(t,(f,h)=>{var d;const p=jn((d=h.between[0].filter)!==null&&d!==void 0?d:h.between[0].filter=[]);return p.indexOf(c)<0&&p.push(c),f})}t.project.items.forEach((c,f)=>{const h=c.channel;if(h!==_n&&h!==fr){pe("Interval selections only support x and y encoding channels.");return}const d=t.init?t.init[f]:null,p=b3t(e,t,c,d),g=c.signals.data,m=c.signals.visual,y=Ct(e.scaleName(h)),b=e.getScaleComponent(h).get("type"),v=Go(b)?"+":"";s.push(...p),o.push(g),a.push({scaleName:e.scaleName(h),expr:`(!isArray(${g}) || (${v}invert(${y}, ${m})[0] === ${v}${g}[0] && ${v}invert(${y}, ${m})[1] === ${v}${g}[1]))`})}),i||s.push({name:n+cP,value:{},on:[{events:a.map(c=>({scale:c.scaleName})),update:a.map(c=>c.expr).join(" && ")+` ? ${n+cP} : {}`}]});const u=t.init,l=`unit: ${ic(e)}, fields: ${r}, values`;return s.concat(Object.assign(Object.assign({name:n+Ku},u?{init:`{${l}: ${z0(u)}}`}:{}),{on:[{events:[{signal:o.join(" || ")}],update:o.join(" && ")+` ? {${l}: [${o}]} : null`}]}))},modifyExpr:(e,t)=>t.name+Ku+", "+(t.resolve==="global"?"true":`{unit: ${ic(e)}}`),marks:(e,t,n)=>{const r=t.name,{x:i,y:s}=t.project.hasChannel,o=i&&i.signals.visual,a=s&&s.signals.visual,u=`data(${Ct(t.name+Xp)})`;if(wh.has(t))return n;const l={x:i!==void 0?{signal:`${o}[0]`}:{value:0},y:s!==void 0?{signal:`${a}[0]`}:{value:0},x2:i!==void 0?{signal:`${o}[1]`}:{field:{group:"width"}},y2:s!==void 0?{signal:`${a}[1]`}:{field:{group:"height"}}};if(t.resolve==="global")for(const m of be(l))l[m]=[Object.assign({test:`${u}.length && ${u}[0].unit === ${ic(e)}`},l[m]),{value:0}];const c=t.mark,{fill:f,fillOpacity:h,cursor:d}=c,p=Be(c,["fill","fillOpacity","cursor"]),g=be(p).reduce((m,y)=>(m[y]=[{test:[i!==void 0&&`${o}[0] !== ${o}[1]`,s!==void 0&&`${a}[0] !== ${a}[1]`].filter(b=>b).join(" && "),value:p[y]},{value:null}],m),{});return[{name:r+Ix+"_bg",type:"rect",clip:!0,encode:{enter:{fill:{value:f},fillOpacity:{value:h}},update:l}},...n,{name:r+Ix,type:"rect",clip:!0,encode:{enter:Object.assign(Object.assign({},d?{cursor:{value:d}}:{}),{fill:{value:"transparent"}}),update:Object.assign(Object.assign({},l),g)}}]}};function b3t(e,t,n,r){const i=n.channel,s=n.signals.visual,o=n.signals.data,a=wh.has(t),u=Ct(e.scaleName(i)),l=e.getScaleComponent(i),c=l?l.get("type"):void 0,f=g=>`scale(${u}, ${g})`,h=e.getSizeSignalRef(i===_n?"width":"height").signal,d=`${i}(unit)`,p=Bxe(t,(g,m)=>[...g,{events:m.between[0],update:`[${d}, ${d}]`},{events:m,update:`[${s}[0], clamp(${d}, 0, ${h})]`}]);return p.push({events:{signal:t.name+cP},update:Go(c)?`[${f(`${o}[0]`)}, ${f(`${o}[1]`)}]`:"[0, 0]"}),a?[{name:o,on:[]}]:[Object.assign(Object.assign({name:s},r?{init:z0(r,!0,f)}:{value:[]}),{on:p}),Object.assign(Object.assign({name:o},r?{init:z0(r)}:{}),{on:[{events:{signal:s},update:`${s}[0] === ${s}[1] ? null : invert(${u}, ${s})`}]})]}function Bxe(e,t){return e.events.reduce((n,r)=>r.between?t(n,r):(pe(`${r} is not an ordered event stream for interval selections.`),n),[])}function zxe(e,t){const n=t.name,r=n+uC,i=t.project,s="(item().isVoronoi ? datum.datum : datum)",o=i.items.map(l=>{const c=e.fieldDef(l.channel);return c&&c.bin?`[${s}[${Ct(e.vgField(l.channel,{}))}], ${s}[${Ct(e.vgField(l.channel,{binSuffix:"end"}))}]]`:`${s}[${Ct(l.field)}]`}).join(", "),a=`unit: ${ic(e)}, fields: ${r}, values`,u=t.events;return[{name:n+Ku,on:u?[{events:u,update:`datum && item().mark.marktype !== 'group' ? {${a}: [${o}]} : null`,force:!0}]:[]}]}const x3t={signals:zxe,modifyExpr:(e,t)=>t.name+Ku+", "+(t.resolve==="global"?"null":`{unit: ${ic(e)}}`)},v3t={signals:zxe,modifyExpr:(e,t)=>t.name+Ku+", "+(t.resolve==="global"?"true":`{unit: ${ic(e)}}`)},Xp="_store",Ku="_tuple",w3t="_modify",Uxe="vlSelectionResolve",$3t={single:v3t,multi:x3t,interval:y3t};function Gg(e,t){const n=e.component.selection;if(n){for(const r of Df(n))if(t(r,$3t[r.type])===!0)break}}function C3t(e){let t=e.parent;for(;t&&!Aa(t);)t=t.parent;return t}function ic(e,{escape:t}={escape:!0}){let n=t?Ct(e.name):e.name;const r=C3t(e);if(r){const{facet:i}=r;for(const s of No)i[s]&&(n+=` + '__facet_${s}_' + (facet[${Ct(r.vgField(s))}])`)}return n}function cW(e){let t=!1;return Gg(e,n=>{t=t||n.project.items.some(r=>r.field===B0)}),t}const S3t="RawCode",k3t="Literal",E3t="Property",_3t="Identifier",A3t="ArrayExpression",T3t="BinaryExpression",I3t="CallExpression",D3t="ConditionalExpression",N3t="LogicalExpression",F3t="MemberExpression",O3t="ObjectExpression",R3t="UnaryExpression";function Za(e){this.type=e}Za.prototype.visit=function(e){let t,n,r;if(e(this))return 1;for(t=M3t(this),n=0,r=t.length;n<r;++n)if(t[n].visit(e))return 1};function M3t(e){switch(e.type){case A3t:return e.elements;case T3t:case N3t:return[e.left,e.right];case I3t:return[e.callee].concat(e.arguments);case D3t:return[e.test,e.consequent,e.alternate];case F3t:return[e.object,e.property];case O3t:return e.properties;case E3t:return[e.key,e.value];case R3t:return[e.argument];case _3t:case k3t:case S3t:default:return[]}}var bl,Ne,oe,Ai,Vt,$F=1,lC=2,Yp=3,Jh=4,CF=5,Hg=6,ps=7,cC=8,L3t=9;bl={};bl[$F]="Boolean";bl[lC]="<end>";bl[Yp]="Identifier";bl[Jh]="Keyword";bl[CF]="Null";bl[Hg]="Numeric";bl[ps]="Punctuator";bl[cC]="String";bl[L3t]="RegularExpression";var P3t="ArrayExpression",B3t="BinaryExpression",z3t="CallExpression",U3t="ConditionalExpression",jxe="Identifier",j3t="Literal",W3t="LogicalExpression",V3t="MemberExpression",G3t="ObjectExpression",H3t="Property",q3t="UnaryExpression",qr="Unexpected token %0",X3t="Unexpected number",Y3t="Unexpected string",K3t="Unexpected identifier",Z3t="Unexpected reserved word",J3t="Unexpected end of input",fP="Invalid regular expression",pR="Invalid regular expression: missing /",Wxe="Octal literals are not allowed in strict mode.",Q3t="Duplicate data property in object literal not allowed in strict mode",xi="ILLEGAL",m2="Disabled.",eOt=new RegExp("[\\xAA\\xB5\\xBA\\xC0-\\xD6\\xD8-\\xF6\\xF8-\\u02C1\\u02C6-\\u02D1\\u02E0-\\u02E4\\u02EC\\u02EE\\u0370-\\u0374\\u0376\\u0377\\u037A-\\u037D\\u037F\\u0386\\u0388-\\u038A\\u038C\\u038E-\\u03A1\\u03A3-\\u03F5\\u03F7-\\u0481\\u048A-\\u052F\\u0531-\\u0556\\u0559\\u0561-\\u0587\\u05D0-\\u05EA\\u05F0-\\u05F2\\u0620-\\u064A\\u066E\\u066F\\u0671-\\u06D3\\u06D5\\u06E5\\u06E6\\u06EE\\u06EF\\u06FA-\\u06FC\\u06FF\\u0710\\u0712-\\u072F\\u074D-\\u07A5\\u07B1\\u07CA-\\u07EA\\u07F4\\u07F5\\u07FA\\u0800-\\u0815\\u081A\\u0824\\u0828\\u0840-\\u0858\\u08A0-\\u08B2\\u0904-\\u0939\\u093D\\u0950\\u0958-\\u0961\\u0971-\\u0980\\u0985-\\u098C\\u098F\\u0990\\u0993-\\u09A8\\u09AA-\\u09B0\\u09B2\\u09B6-\\u09B9\\u09BD\\u09CE\\u09DC\\u09DD\\u09DF-\\u09E1\\u09F0\\u09F1\\u0A05-\\u0A0A\\u0A0F\\u0A10\\u0A13-\\u0A28\\u0A2A-\\u0A30\\u0A32\\u0A33\\u0A35\\u0A36\\u0A38\\u0A39\\u0A59-\\u0A5C\\u0A5E\\u0A72-\\u0A74\\u0A85-\\u0A8D\\u0A8F-\\u0A91\\u0A93-\\u0AA8\\u0AAA-\\u0AB0\\u0AB2\\u0AB3\\u0AB5-\\u0AB9\\u0ABD\\u0AD0\\u0AE0\\u0AE1\\u0B05-\\u0B0C\\u0B0F\\u0B10\\u0B13-\\u0B28\\u0B2A-\\u0B30\\u0B32\\u0B33\\u0B35-\\u0B39\\u0B3D\\u0B5C\\u0B5D\\u0B5F-\\u0B61\\u0B71\\u0B83\\u0B85-\\u0B8A\\u0B8E-\\u0B90\\u0B92-\\u0B95\\u0B99\\u0B9A\\u0B9C\\u0B9E\\u0B9F\\u0BA3\\u0BA4\\u0BA8-\\u0BAA\\u0BAE-\\u0BB9\\u0BD0\\u0C05-\\u0C0C\\u0C0E-\\u0C10\\u0C12-\\u0C28\\u0C2A-\\u0C39\\u0C3D\\u0C58\\u0C59\\u0C60\\u0C61\\u0C85-\\u0C8C\\u0C8E-\\u0C90\\u0C92-\\u0CA8\\u0CAA-\\u0CB3\\u0CB5-\\u0CB9\\u0CBD\\u0CDE\\u0CE0\\u0CE1\\u0CF1\\u0CF2\\u0D05-\\u0D0C\\u0D0E-\\u0D10\\u0D12-\\u0D3A\\u0D3D\\u0D4E\\u0D60\\u0D61\\u0D7A-\\u0D7F\\u0D85-\\u0D96\\u0D9A-\\u0DB1\\u0DB3-\\u0DBB\\u0DBD\\u0DC0-\\u0DC6\\u0E01-\\u0E30\\u0E32\\u0E33\\u0E40-\\u0E46\\u0E81\\u0E82\\u0E84\\u0E87\\u0E88\\u0E8A\\u0E8D\\u0E94-\\u0E97\\u0E99-\\u0E9F\\u0EA1-\\u0EA3\\u0EA5\\u0EA7\\u0EAA\\u0EAB\\u0EAD-\\u0EB0\\u0EB2\\u0EB3\\u0EBD\\u0EC0-\\u0EC4\\u0EC6\\u0EDC-\\u0EDF\\u0F00\\u0F40-\\u0F47\\u0F49-\\u0F6C\\u0F88-\\u0F8C\\u1000-\\u102A\\u103F\\u1050-\\u1055\\u105A-\\u105D\\u1061\\u1065\\u1066\\u106E-\\u1070\\u1075-\\u1081\\u108E\\u10A0-\\u10C5\\u10C7\\u10CD\\u10D0-\\u10FA\\u10FC-\\u1248\\u124A-\\u124D\\u1250-\\u1256\\u1258\\u125A-\\u125D\\u1260-\\u1288\\u128A-\\u128D\\u1290-\\u12B0\\u12B2-\\u12B5\\u12B8-\\u12BE\\u12C0\\u12C2-\\u12C5\\u12C8-\\u12D6\\u12D8-\\u1310\\u1312-\\u1315\\u1318-\\u135A\\u1380-\\u138F\\u13A0-\\u13F4\\u1401-\\u166C\\u166F-\\u167F\\u1681-\\u169A\\u16A0-\\u16EA\\u16EE-\\u16F8\\u1700-\\u170C\\u170E-\\u1711\\u1720-\\u1731\\u1740-\\u1751\\u1760-\\u176C\\u176E-\\u1770\\u1780-\\u17B3\\u17D7\\u17DC\\u1820-\\u1877\\u1880-\\u18A8\\u18AA\\u18B0-\\u18F5\\u1900-\\u191E\\u1950-\\u196D\\u1970-\\u1974\\u1980-\\u19AB\\u19C1-\\u19C7\\u1A00-\\u1A16\\u1A20-\\u1A54\\u1AA7\\u1B05-\\u1B33\\u1B45-\\u1B4B\\u1B83-\\u1BA0\\u1BAE\\u1BAF\\u1BBA-\\u1BE5\\u1C00-\\u1C23\\u1C4D-\\u1C4F\\u1C5A-\\u1C7D\\u1CE9-\\u1CEC\\u1CEE-\\u1CF1\\u1CF5\\u1CF6\\u1D00-\\u1DBF\\u1E00-\\u1F15\\u1F18-\\u1F1D\\u1F20-\\u1F45\\u1F48-\\u1F4D\\u1F50-\\u1F57\\u1F59\\u1F5B\\u1F5D\\u1F5F-\\u1F7D\\u1F80-\\u1FB4\\u1FB6-\\u1FBC\\u1FBE\\u1FC2-\\u1FC4\\u1FC6-\\u1FCC\\u1FD0-\\u1FD3\\u1FD6-\\u1FDB\\u1FE0-\\u1FEC\\u1FF2-\\u1FF4\\u1FF6-\\u1FFC\\u2071\\u207F\\u2090-\\u209C\\u2102\\u2107\\u210A-\\u2113\\u2115\\u2119-\\u211D\\u2124\\u2126\\u2128\\u212A-\\u212D\\u212F-\\u2139\\u213C-\\u213F\\u2145-\\u2149\\u214E\\u2160-\\u2188\\u2C00-\\u2C2E\\u2C30-\\u2C5E\\u2C60-\\u2CE4\\u2CEB-\\u2CEE\\u2CF2\\u2CF3\\u2D00-\\u2D25\\u2D27\\u2D2D\\u2D30-\\u2D67\\u2D6F\\u2D80-\\u2D96\\u2DA0-\\u2DA6\\u2DA8-\\u2DAE\\u2DB0-\\u2DB6\\u2DB8-\\u2DBE\\u2DC0-\\u2DC6\\u2DC8-\\u2DCE\\u2DD0-\\u2DD6\\u2DD8-\\u2DDE\\u2E2F\\u3005-\\u3007\\u3021-\\u3029\\u3031-\\u3035\\u3038-\\u303C\\u3041-\\u3096\\u309D-\\u309F\\u30A1-\\u30FA\\u30FC-\\u30FF\\u3105-\\u312D\\u3131-\\u318E\\u31A0-\\u31BA\\u31F0-\\u31FF\\u3400-\\u4DB5\\u4E00-\\u9FCC\\uA000-\\uA48C\\uA4D0-\\uA4FD\\uA500-\\uA60C\\uA610-\\uA61F\\uA62A\\uA62B\\uA640-\\uA66E\\uA67F-\\uA69D\\uA6A0-\\uA6EF\\uA717-\\uA71F\\uA722-\\uA788\\uA78B-\\uA78E\\uA790-\\uA7AD\\uA7B0\\uA7B1\\uA7F7-\\uA801\\uA803-\\uA805\\uA807-\\uA80A\\uA80C-\\uA822\\uA840-\\uA873\\uA882-\\uA8B3\\uA8F2-\\uA8F7\\uA8FB\\uA90A-\\uA925\\uA930-\\uA946\\uA960-\\uA97C\\uA984-\\uA9B2\\uA9CF\\uA9E0-\\uA9E4\\uA9E6-\\uA9EF\\uA9FA-\\uA9FE\\uAA00-\\uAA28\\uAA40-\\uAA42\\uAA44-\\uAA4B\\uAA60-\\uAA76\\uAA7A\\uAA7E-\\uAAAF\\uAAB1\\uAAB5\\uAAB6\\uAAB9-\\uAABD\\uAAC0\\uAAC2\\uAADB-\\uAADD\\uAAE0-\\uAAEA\\uAAF2-\\uAAF4\\uAB01-\\uAB06\\uAB09-\\uAB0E\\uAB11-\\uAB16\\uAB20-\\uAB26\\uAB28-\\uAB2E\\uAB30-\\uAB5A\\uAB5C-\\uAB5F\\uAB64\\uAB65\\uABC0-\\uABE2\\uAC00-\\uD7A3\\uD7B0-\\uD7C6\\uD7CB-\\uD7FB\\uF900-\\uFA6D\\uFA70-\\uFAD9\\uFB00-\\uFB06\\uFB13-\\uFB17\\uFB1D\\uFB1F-\\uFB28\\uFB2A-\\uFB36\\uFB38-\\uFB3C\\uFB3E\\uFB40\\uFB41\\uFB43\\uFB44\\uFB46-\\uFBB1\\uFBD3-\\uFD3D\\uFD50-\\uFD8F\\uFD92-\\uFDC7\\uFDF0-\\uFDFB\\uFE70-\\uFE74\\uFE76-\\uFEFC\\uFF21-\\uFF3A\\uFF41-\\uFF5A\\uFF66-\\uFFBE\\uFFC2-\\uFFC7\\uFFCA-\\uFFCF\\uFFD2-\\uFFD7\\uFFDA-\\uFFDC]"),tOt=new RegExp("[\\xAA\\xB5\\xBA\\xC0-\\xD6\\xD8-\\xF6\\xF8-\\u02C1\\u02C6-\\u02D1\\u02E0-\\u02E4\\u02EC\\u02EE\\u0300-\\u0374\\u0376\\u0377\\u037A-\\u037D\\u037F\\u0386\\u0388-\\u038A\\u038C\\u038E-\\u03A1\\u03A3-\\u03F5\\u03F7-\\u0481\\u0483-\\u0487\\u048A-\\u052F\\u0531-\\u0556\\u0559\\u0561-\\u0587\\u0591-\\u05BD\\u05BF\\u05C1\\u05C2\\u05C4\\u05C5\\u05C7\\u05D0-\\u05EA\\u05F0-\\u05F2\\u0610-\\u061A\\u0620-\\u0669\\u066E-\\u06D3\\u06D5-\\u06DC\\u06DF-\\u06E8\\u06EA-\\u06FC\\u06FF\\u0710-\\u074A\\u074D-\\u07B1\\u07C0-\\u07F5\\u07FA\\u0800-\\u082D\\u0840-\\u085B\\u08A0-\\u08B2\\u08E4-\\u0963\\u0966-\\u096F\\u0971-\\u0983\\u0985-\\u098C\\u098F\\u0990\\u0993-\\u09A8\\u09AA-\\u09B0\\u09B2\\u09B6-\\u09B9\\u09BC-\\u09C4\\u09C7\\u09C8\\u09CB-\\u09CE\\u09D7\\u09DC\\u09DD\\u09DF-\\u09E3\\u09E6-\\u09F1\\u0A01-\\u0A03\\u0A05-\\u0A0A\\u0A0F\\u0A10\\u0A13-\\u0A28\\u0A2A-\\u0A30\\u0A32\\u0A33\\u0A35\\u0A36\\u0A38\\u0A39\\u0A3C\\u0A3E-\\u0A42\\u0A47\\u0A48\\u0A4B-\\u0A4D\\u0A51\\u0A59-\\u0A5C\\u0A5E\\u0A66-\\u0A75\\u0A81-\\u0A83\\u0A85-\\u0A8D\\u0A8F-\\u0A91\\u0A93-\\u0AA8\\u0AAA-\\u0AB0\\u0AB2\\u0AB3\\u0AB5-\\u0AB9\\u0ABC-\\u0AC5\\u0AC7-\\u0AC9\\u0ACB-\\u0ACD\\u0AD0\\u0AE0-\\u0AE3\\u0AE6-\\u0AEF\\u0B01-\\u0B03\\u0B05-\\u0B0C\\u0B0F\\u0B10\\u0B13-\\u0B28\\u0B2A-\\u0B30\\u0B32\\u0B33\\u0B35-\\u0B39\\u0B3C-\\u0B44\\u0B47\\u0B48\\u0B4B-\\u0B4D\\u0B56\\u0B57\\u0B5C\\u0B5D\\u0B5F-\\u0B63\\u0B66-\\u0B6F\\u0B71\\u0B82\\u0B83\\u0B85-\\u0B8A\\u0B8E-\\u0B90\\u0B92-\\u0B95\\u0B99\\u0B9A\\u0B9C\\u0B9E\\u0B9F\\u0BA3\\u0BA4\\u0BA8-\\u0BAA\\u0BAE-\\u0BB9\\u0BBE-\\u0BC2\\u0BC6-\\u0BC8\\u0BCA-\\u0BCD\\u0BD0\\u0BD7\\u0BE6-\\u0BEF\\u0C00-\\u0C03\\u0C05-\\u0C0C\\u0C0E-\\u0C10\\u0C12-\\u0C28\\u0C2A-\\u0C39\\u0C3D-\\u0C44\\u0C46-\\u0C48\\u0C4A-\\u0C4D\\u0C55\\u0C56\\u0C58\\u0C59\\u0C60-\\u0C63\\u0C66-\\u0C6F\\u0C81-\\u0C83\\u0C85-\\u0C8C\\u0C8E-\\u0C90\\u0C92-\\u0CA8\\u0CAA-\\u0CB3\\u0CB5-\\u0CB9\\u0CBC-\\u0CC4\\u0CC6-\\u0CC8\\u0CCA-\\u0CCD\\u0CD5\\u0CD6\\u0CDE\\u0CE0-\\u0CE3\\u0CE6-\\u0CEF\\u0CF1\\u0CF2\\u0D01-\\u0D03\\u0D05-\\u0D0C\\u0D0E-\\u0D10\\u0D12-\\u0D3A\\u0D3D-\\u0D44\\u0D46-\\u0D48\\u0D4A-\\u0D4E\\u0D57\\u0D60-\\u0D63\\u0D66-\\u0D6F\\u0D7A-\\u0D7F\\u0D82\\u0D83\\u0D85-\\u0D96\\u0D9A-\\u0DB1\\u0DB3-\\u0DBB\\u0DBD\\u0DC0-\\u0DC6\\u0DCA\\u0DCF-\\u0DD4\\u0DD6\\u0DD8-\\u0DDF\\u0DE6-\\u0DEF\\u0DF2\\u0DF3\\u0E01-\\u0E3A\\u0E40-\\u0E4E\\u0E50-\\u0E59\\u0E81\\u0E82\\u0E84\\u0E87\\u0E88\\u0E8A\\u0E8D\\u0E94-\\u0E97\\u0E99-\\u0E9F\\u0EA1-\\u0EA3\\u0EA5\\u0EA7\\u0EAA\\u0EAB\\u0EAD-\\u0EB9\\u0EBB-\\u0EBD\\u0EC0-\\u0EC4\\u0EC6\\u0EC8-\\u0ECD\\u0ED0-\\u0ED9\\u0EDC-\\u0EDF\\u0F00\\u0F18\\u0F19\\u0F20-\\u0F29\\u0F35\\u0F37\\u0F39\\u0F3E-\\u0F47\\u0F49-\\u0F6C\\u0F71-\\u0F84\\u0F86-\\u0F97\\u0F99-\\u0FBC\\u0FC6\\u1000-\\u1049\\u1050-\\u109D\\u10A0-\\u10C5\\u10C7\\u10CD\\u10D0-\\u10FA\\u10FC-\\u1248\\u124A-\\u124D\\u1250-\\u1256\\u1258\\u125A-\\u125D\\u1260-\\u1288\\u128A-\\u128D\\u1290-\\u12B0\\u12B2-\\u12B5\\u12B8-\\u12BE\\u12C0\\u12C2-\\u12C5\\u12C8-\\u12D6\\u12D8-\\u1310\\u1312-\\u1315\\u1318-\\u135A\\u135D-\\u135F\\u1380-\\u138F\\u13A0-\\u13F4\\u1401-\\u166C\\u166F-\\u167F\\u1681-\\u169A\\u16A0-\\u16EA\\u16EE-\\u16F8\\u1700-\\u170C\\u170E-\\u1714\\u1720-\\u1734\\u1740-\\u1753\\u1760-\\u176C\\u176E-\\u1770\\u1772\\u1773\\u1780-\\u17D3\\u17D7\\u17DC\\u17DD\\u17E0-\\u17E9\\u180B-\\u180D\\u1810-\\u1819\\u1820-\\u1877\\u1880-\\u18AA\\u18B0-\\u18F5\\u1900-\\u191E\\u1920-\\u192B\\u1930-\\u193B\\u1946-\\u196D\\u1970-\\u1974\\u1980-\\u19AB\\u19B0-\\u19C9\\u19D0-\\u19D9\\u1A00-\\u1A1B\\u1A20-\\u1A5E\\u1A60-\\u1A7C\\u1A7F-\\u1A89\\u1A90-\\u1A99\\u1AA7\\u1AB0-\\u1ABD\\u1B00-\\u1B4B\\u1B50-\\u1B59\\u1B6B-\\u1B73\\u1B80-\\u1BF3\\u1C00-\\u1C37\\u1C40-\\u1C49\\u1C4D-\\u1C7D\\u1CD0-\\u1CD2\\u1CD4-\\u1CF6\\u1CF8\\u1CF9\\u1D00-\\u1DF5\\u1DFC-\\u1F15\\u1F18-\\u1F1D\\u1F20-\\u1F45\\u1F48-\\u1F4D\\u1F50-\\u1F57\\u1F59\\u1F5B\\u1F5D\\u1F5F-\\u1F7D\\u1F80-\\u1FB4\\u1FB6-\\u1FBC\\u1FBE\\u1FC2-\\u1FC4\\u1FC6-\\u1FCC\\u1FD0-\\u1FD3\\u1FD6-\\u1FDB\\u1FE0-\\u1FEC\\u1FF2-\\u1FF4\\u1FF6-\\u1FFC\\u200C\\u200D\\u203F\\u2040\\u2054\\u2071\\u207F\\u2090-\\u209C\\u20D0-\\u20DC\\u20E1\\u20E5-\\u20F0\\u2102\\u2107\\u210A-\\u2113\\u2115\\u2119-\\u211D\\u2124\\u2126\\u2128\\u212A-\\u212D\\u212F-\\u2139\\u213C-\\u213F\\u2145-\\u2149\\u214E\\u2160-\\u2188\\u2C00-\\u2C2E\\u2C30-\\u2C5E\\u2C60-\\u2CE4\\u2CEB-\\u2CF3\\u2D00-\\u2D25\\u2D27\\u2D2D\\u2D30-\\u2D67\\u2D6F\\u2D7F-\\u2D96\\u2DA0-\\u2DA6\\u2DA8-\\u2DAE\\u2DB0-\\u2DB6\\u2DB8-\\u2DBE\\u2DC0-\\u2DC6\\u2DC8-\\u2DCE\\u2DD0-\\u2DD6\\u2DD8-\\u2DDE\\u2DE0-\\u2DFF\\u2E2F\\u3005-\\u3007\\u3021-\\u302F\\u3031-\\u3035\\u3038-\\u303C\\u3041-\\u3096\\u3099\\u309A\\u309D-\\u309F\\u30A1-\\u30FA\\u30FC-\\u30FF\\u3105-\\u312D\\u3131-\\u318E\\u31A0-\\u31BA\\u31F0-\\u31FF\\u3400-\\u4DB5\\u4E00-\\u9FCC\\uA000-\\uA48C\\uA4D0-\\uA4FD\\uA500-\\uA60C\\uA610-\\uA62B\\uA640-\\uA66F\\uA674-\\uA67D\\uA67F-\\uA69D\\uA69F-\\uA6F1\\uA717-\\uA71F\\uA722-\\uA788\\uA78B-\\uA78E\\uA790-\\uA7AD\\uA7B0\\uA7B1\\uA7F7-\\uA827\\uA840-\\uA873\\uA880-\\uA8C4\\uA8D0-\\uA8D9\\uA8E0-\\uA8F7\\uA8FB\\uA900-\\uA92D\\uA930-\\uA953\\uA960-\\uA97C\\uA980-\\uA9C0\\uA9CF-\\uA9D9\\uA9E0-\\uA9FE\\uAA00-\\uAA36\\uAA40-\\uAA4D\\uAA50-\\uAA59\\uAA60-\\uAA76\\uAA7A-\\uAAC2\\uAADB-\\uAADD\\uAAE0-\\uAAEF\\uAAF2-\\uAAF6\\uAB01-\\uAB06\\uAB09-\\uAB0E\\uAB11-\\uAB16\\uAB20-\\uAB26\\uAB28-\\uAB2E\\uAB30-\\uAB5A\\uAB5C-\\uAB5F\\uAB64\\uAB65\\uABC0-\\uABEA\\uABEC\\uABED\\uABF0-\\uABF9\\uAC00-\\uD7A3\\uD7B0-\\uD7C6\\uD7CB-\\uD7FB\\uF900-\\uFA6D\\uFA70-\\uFAD9\\uFB00-\\uFB06\\uFB13-\\uFB17\\uFB1D-\\uFB28\\uFB2A-\\uFB36\\uFB38-\\uFB3C\\uFB3E\\uFB40\\uFB41\\uFB43\\uFB44\\uFB46-\\uFBB1\\uFBD3-\\uFD3D\\uFD50-\\uFD8F\\uFD92-\\uFDC7\\uFDF0-\\uFDFB\\uFE00-\\uFE0F\\uFE20-\\uFE2D\\uFE33\\uFE34\\uFE4D-\\uFE4F\\uFE70-\\uFE74\\uFE76-\\uFEFC\\uFF10-\\uFF19\\uFF21-\\uFF3A\\uFF3F\\uFF41-\\uFF5A\\uFF66-\\uFFBE\\uFFC2-\\uFFC7\\uFFCA-\\uFFCF\\uFFD2-\\uFFD7\\uFFDA-\\uFFDC]");function SF(e,t){if(!e)throw new Error("ASSERT: "+t)}function Fl(e){return e>=48&&e<=57}function fW(e){return"0123456789abcdefABCDEF".indexOf(e)>=0}function Dx(e){return"01234567".indexOf(e)>=0}function nOt(e){return e===32||e===9||e===11||e===12||e===160||e>=5760&&[5760,6158,8192,8193,8194,8195,8196,8197,8198,8199,8200,8201,8202,8239,8287,12288,65279].indexOf(e)>=0}function y2(e){return e===10||e===13||e===8232||e===8233}function fC(e){return e===36||e===95||e>=65&&e<=90||e>=97&&e<=122||e===92||e>=128&&eOt.test(String.fromCharCode(e))}function pA(e){return e===36||e===95||e>=65&&e<=90||e>=97&&e<=122||e>=48&&e<=57||e===92||e>=128&&tOt.test(String.fromCharCode(e))}var rOt={if:1,in:1,do:1,var:1,for:1,new:1,try:1,let:1,this:1,else:1,case:1,void:1,with:1,enum:1,while:1,break:1,catch:1,throw:1,const:1,yield:1,class:1,super:1,return:1,typeof:1,delete:1,switch:1,export:1,import:1,public:1,static:1,default:1,finally:1,extends:1,package:1,private:1,function:1,continue:1,debugger:1,interface:1,protected:1,instanceof:1,implements:1};function Vxe(){for(var e;oe<Ai&&(e=Ne.charCodeAt(oe),nOt(e)||y2(e));)++oe}function hP(e){var t,n,r,i=0;for(n=e==="u"?4:2,t=0;t<n;++t)oe<Ai&&fW(Ne[oe])?(r=Ne[oe++],i=i*16+"0123456789abcdef".indexOf(r.toLowerCase())):Ft({},qr,xi);return String.fromCharCode(i)}function iOt(){var e,t,n,r;for(e=Ne[oe],t=0,e==="}"&&Ft({},qr,xi);oe<Ai&&(e=Ne[oe++],!!fW(e));)t=t*16+"0123456789abcdef".indexOf(e.toLowerCase());return(t>1114111||e!=="}")&&Ft({},qr,xi),t<=65535?String.fromCharCode(t):(n=(t-65536>>10)+55296,r=(t-65536&1023)+56320,String.fromCharCode(n,r))}function Gxe(){var e,t;for(e=Ne.charCodeAt(oe++),t=String.fromCharCode(e),e===92&&(Ne.charCodeAt(oe)!==117&&Ft({},qr,xi),++oe,e=hP("u"),(!e||e==="\\"||!fC(e.charCodeAt(0)))&&Ft({},qr,xi),t=e);oe<Ai&&(e=Ne.charCodeAt(oe),!!pA(e));)++oe,t+=String.fromCharCode(e),e===92&&(t=t.substr(0,t.length-1),Ne.charCodeAt(oe)!==117&&Ft({},qr,xi),++oe,e=hP("u"),(!e||e==="\\"||!pA(e.charCodeAt(0)))&&Ft({},qr,xi),t+=e);return t}function sOt(){var e,t;for(e=oe++;oe<Ai;){if(t=Ne.charCodeAt(oe),t===92)return oe=e,Gxe();if(pA(t))++oe;else break}return Ne.slice(e,oe)}function oOt(){var e,t,n;return e=oe,t=Ne.charCodeAt(oe)===92?Gxe():sOt(),t.length===1?n=Yp:rOt.hasOwnProperty(t)?n=Jh:t==="null"?n=CF:t==="true"||t==="false"?n=$F:n=Yp,{type:n,value:t,start:e,end:oe}}function gR(){var e=oe,t=Ne.charCodeAt(oe),n,r=Ne[oe],i,s,o;switch(t){case 46:case 40:case 41:case 59:case 44:case 123:case 125:case 91:case 93:case 58:case 63:case 126:return++oe,{type:ps,value:String.fromCharCode(t),start:e,end:oe};default:if(n=Ne.charCodeAt(oe+1),n===61)switch(t){case 43:case 45:case 47:case 60:case 62:case 94:case 124:case 37:case 38:case 42:return oe+=2,{type:ps,value:String.fromCharCode(t)+String.fromCharCode(n),start:e,end:oe};case 33:case 61:return oe+=2,Ne.charCodeAt(oe)===61&&++oe,{type:ps,value:Ne.slice(e,oe),start:e,end:oe}}}if(o=Ne.substr(oe,4),o===">>>=")return oe+=4,{type:ps,value:o,start:e,end:oe};if(s=o.substr(0,3),s===">>>"||s==="<<="||s===">>=")return oe+=3,{type:ps,value:s,start:e,end:oe};if(i=s.substr(0,2),r===i[1]&&"+-<>&|".indexOf(r)>=0||i==="=>")return oe+=2,{type:ps,value:i,start:e,end:oe};if("<>=!+-*%&|^/".indexOf(r)>=0)return++oe,{type:ps,value:r,start:e,end:oe};Ft({},qr,xi)}function aOt(e){for(var t="";oe<Ai&&fW(Ne[oe]);)t+=Ne[oe++];return t.length===0&&Ft({},qr,xi),fC(Ne.charCodeAt(oe))&&Ft({},qr,xi),{type:Hg,value:parseInt("0x"+t,16),start:e,end:oe}}function uOt(e){for(var t="0"+Ne[oe++];oe<Ai&&Dx(Ne[oe]);)t+=Ne[oe++];return(fC(Ne.charCodeAt(oe))||Fl(Ne.charCodeAt(oe)))&&Ft({},qr,xi),{type:Hg,value:parseInt(t,8),octal:!0,start:e,end:oe}}function OJ(){var e,t,n;if(n=Ne[oe],SF(Fl(n.charCodeAt(0))||n===".","Numeric literal must start with a decimal digit or a decimal point"),t=oe,e="",n!=="."){if(e=Ne[oe++],n=Ne[oe],e==="0"){if(n==="x"||n==="X")return++oe,aOt(t);if(Dx(n))return uOt(t);n&&Fl(n.charCodeAt(0))&&Ft({},qr,xi)}for(;Fl(Ne.charCodeAt(oe));)e+=Ne[oe++];n=Ne[oe]}if(n==="."){for(e+=Ne[oe++];Fl(Ne.charCodeAt(oe));)e+=Ne[oe++];n=Ne[oe]}if(n==="e"||n==="E")if(e+=Ne[oe++],n=Ne[oe],(n==="+"||n==="-")&&(e+=Ne[oe++]),Fl(Ne.charCodeAt(oe)))for(;Fl(Ne.charCodeAt(oe));)e+=Ne[oe++];else Ft({},qr,xi);return fC(Ne.charCodeAt(oe))&&Ft({},qr,xi),{type:Hg,value:parseFloat(e),start:t,end:oe}}function lOt(){var e="",t,n,r,i,s=!1;for(t=Ne[oe],SF(t==="'"||t==='"',"String literal must starts with a quote"),n=oe,++oe;oe<Ai;)if(r=Ne[oe++],r===t){t="";break}else if(r==="\\")if(r=Ne[oe++],!r||!y2(r.charCodeAt(0)))switch(r){case"u":case"x":Ne[oe]==="{"?(++oe,e+=iOt()):e+=hP(r);break;case"n":e+=`
`;break;case"r":e+="\r";break;case"t":e+="	";break;case"b":e+="\b";break;case"f":e+="\f";break;case"v":e+="\v";break;default:Dx(r)?(i="01234567".indexOf(r),i!==0&&(s=!0),oe<Ai&&Dx(Ne[oe])&&(s=!0,i=i*8+"01234567".indexOf(Ne[oe++]),"0123".indexOf(r)>=0&&oe<Ai&&Dx(Ne[oe])&&(i=i*8+"01234567".indexOf(Ne[oe++]))),e+=String.fromCharCode(i)):e+=r;break}else r==="\r"&&Ne[oe]===`
`&&++oe;else{if(y2(r.charCodeAt(0)))break;e+=r}return t!==""&&Ft({},qr,xi),{type:cC,value:e,octal:s,start:n,end:oe}}function cOt(e,t){var n=e;t.indexOf("u")>=0&&(n=n.replace(/\\u\{([0-9a-fA-F]+)\}/g,function(r,i){if(parseInt(i,16)<=1114111)return"x";Ft({},fP)}).replace(/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,"x"));try{new RegExp(n)}catch{Ft({},fP)}try{return new RegExp(e,t)}catch{return null}}function fOt(){var e,t,n,r,i;for(e=Ne[oe],SF(e==="/","Regular expression literal must start with a slash"),t=Ne[oe++],n=!1,r=!1;oe<Ai;)if(e=Ne[oe++],t+=e,e==="\\")e=Ne[oe++],y2(e.charCodeAt(0))&&Ft({},pR),t+=e;else if(y2(e.charCodeAt(0)))Ft({},pR);else if(n)e==="]"&&(n=!1);else if(e==="/"){r=!0;break}else e==="["&&(n=!0);return r||Ft({},pR),i=t.substr(1,t.length-2),{value:i,literal:t}}function hOt(){var e,t,n;for(t="",n="";oe<Ai&&(e=Ne[oe],!!pA(e.charCodeAt(0)));)++oe,e==="\\"&&oe<Ai?Ft({},qr,xi):(n+=e,t+=e);return n.search(/[^gimuy]/g)>=0&&Ft({},fP,n),{value:n,literal:t}}function dOt(){var e,t,n,r;return Vt=null,Vxe(),e=oe,t=fOt(),n=hOt(),r=cOt(t.value,n.value),{literal:t.literal+n.literal,value:r,regex:{pattern:t.value,flags:n.value},start:e,end:oe}}function pOt(e){return e.type===Yp||e.type===Jh||e.type===$F||e.type===CF}function Hxe(){var e;return Vxe(),oe>=Ai?{type:lC,start:oe,end:oe}:(e=Ne.charCodeAt(oe),fC(e)?oOt():e===40||e===41||e===59?gR():e===39||e===34?lOt():e===46?Fl(Ne.charCodeAt(oe+1))?OJ():gR():Fl(e)?OJ():gR())}function vs(){var e;return e=Vt,oe=e.end,Vt=Hxe(),oe=e.end,e}function qxe(){var e;e=oe,Vt=Hxe(),oe=e}function gOt(e){var t=new Za(P3t);return t.elements=e,t}function RJ(e,t,n){var r=new Za(e==="||"||e==="&&"?W3t:B3t);return r.operator=e,r.left=t,r.right=n,r}function mOt(e,t){var n=new Za(z3t);return n.callee=e,n.arguments=t,n}function yOt(e,t,n){var r=new Za(U3t);return r.test=e,r.consequent=t,r.alternate=n,r}function hW(e){var t=new Za(jxe);return t.name=e,t}function rx(e){var t=new Za(j3t);return t.value=e.value,t.raw=Ne.slice(e.start,e.end),e.regex&&(t.raw==="//"&&(t.raw="/(?:)/"),t.regex=e.regex),t}function MJ(e,t,n){var r=new Za(V3t);return r.computed=e==="[",r.object=t,r.property=n,r.computed||(n.member=!0),r}function bOt(e){var t=new Za(G3t);return t.properties=e,t}function LJ(e,t,n){var r=new Za(H3t);return r.key=t,r.value=n,r.kind=e,r}function xOt(e,t){var n=new Za(q3t);return n.operator=e,n.argument=t,n.prefix=!0,n}function Ft(e,t){var n,r=Array.prototype.slice.call(arguments,2),i=t.replace(/%(\d)/g,function(s,o){return SF(o<r.length,"Message reference must be in range"),r[o]});throw n=new Error(i),n.index=oe,n.description=i,n}function kF(e){e.type===lC&&Ft(e,J3t),e.type===Hg&&Ft(e,X3t),e.type===cC&&Ft(e,Y3t),e.type===Yp&&Ft(e,K3t),e.type===Jh&&Ft(e,Z3t),Ft(e,qr,e.value)}function Ti(e){var t=vs();(t.type!==ps||t.value!==e)&&kF(t)}function dn(e){return Vt.type===ps&&Vt.value===e}function mR(e){return Vt.type===Jh&&Vt.value===e}function vOt(){var e=[];for(oe=Vt.start,Ti("[");!dn("]");)dn(",")?(vs(),e.push(null)):(e.push(Kp()),dn("]")||Ti(","));return vs(),gOt(e)}function PJ(){var e;return oe=Vt.start,e=vs(),e.type===cC||e.type===Hg?(e.octal&&Ft(e,Wxe),rx(e)):hW(e.value)}function wOt(){var e,t,n,r;if(oe=Vt.start,e=Vt,e.type===Yp)return n=PJ(),Ti(":"),r=Kp(),LJ("init",n,r);if(e.type===lC||e.type===ps)kF(e);else return t=PJ(),Ti(":"),r=Kp(),LJ("init",t,r)}function $Ot(){var e=[],t,n,r,i={},s=String;for(oe=Vt.start,Ti("{");!dn("}");)t=wOt(),t.key.type===jxe?n=t.key.name:n=s(t.key.value),r="$"+n,Object.prototype.hasOwnProperty.call(i,r)?Ft({},Q3t):i[r]=!0,e.push(t),dn("}")||Ti(",");return Ti("}"),bOt(e)}function COt(){var e;return Ti("("),e=dW(),Ti(")"),e}var SOt={if:1};function kOt(){var e,t,n;if(dn("("))return COt();if(dn("["))return vOt();if(dn("{"))return $Ot();if(e=Vt.type,oe=Vt.start,e===Yp||SOt[Vt.value])n=hW(vs().value);else if(e===cC||e===Hg)Vt.octal&&Ft(Vt,Wxe),n=rx(vs());else{if(e===Jh)throw new Error(m2);e===$F?(t=vs(),t.value=t.value==="true",n=rx(t)):e===CF?(t=vs(),t.value=null,n=rx(t)):dn("/")||dn("/=")?(n=rx(dOt()),qxe()):kF(vs())}return n}function EOt(){var e=[];if(Ti("("),!dn(")"))for(;oe<Ai&&(e.push(Kp()),!dn(")"));)Ti(",");return Ti(")"),e}function _Ot(){var e;return oe=Vt.start,e=vs(),pOt(e)||kF(e),hW(e.value)}function AOt(){return Ti("."),_Ot()}function TOt(){var e;return Ti("["),e=dW(),Ti("]"),e}function IOt(){var e,t,n;for(e=kOt();;)if(dn("."))n=AOt(),e=MJ(".",e,n);else if(dn("("))t=EOt(),e=mOt(e,t);else if(dn("["))n=TOt(),e=MJ("[",e,n);else break;return e}function BJ(){var e=IOt();if(Vt.type===ps&&(dn("++")||dn("--")))throw new Error(m2);return e}function kk(){var e,t;if(Vt.type!==ps&&Vt.type!==Jh)t=BJ();else{if(dn("++")||dn("--"))throw new Error(m2);if(dn("+")||dn("-")||dn("~")||dn("!"))e=vs(),t=kk(),t=xOt(e.value,t);else{if(mR("delete")||mR("void")||mR("typeof"))throw new Error(m2);t=BJ()}}return t}function zJ(e){var t=0;if(e.type!==ps&&e.type!==Jh)return 0;switch(e.value){case"||":t=1;break;case"&&":t=2;break;case"|":t=3;break;case"^":t=4;break;case"&":t=5;break;case"==":case"!=":case"===":case"!==":t=6;break;case"<":case">":case"<=":case">=":case"instanceof":case"in":t=7;break;case"<<":case">>":case">>>":t=8;break;case"+":case"-":t=9;break;case"*":case"/":case"%":t=11;break}return t}function DOt(){var e,t,n,r,i,s,o,a,u,l;if(e=Vt,u=kk(),r=Vt,i=zJ(r),i===0)return u;for(r.prec=i,vs(),t=[e,Vt],o=kk(),s=[u,r,o];(i=zJ(Vt))>0;){for(;s.length>2&&i<=s[s.length-2].prec;)o=s.pop(),a=s.pop().value,u=s.pop(),t.pop(),n=RJ(a,u,o),s.push(n);r=vs(),r.prec=i,s.push(r),t.push(Vt),n=kk(),s.push(n)}for(l=s.length-1,n=s[l],t.pop();l>1;)t.pop(),n=RJ(s[l-1].value,s[l-2],n),l-=2;return n}function Kp(){var e,t,n;return e=DOt(),dn("?")&&(vs(),t=Kp(),Ti(":"),n=Kp(),e=yOt(e,t,n)),e}function dW(){var e=Kp();if(dn(","))throw new Error(m2);return e}function NOt(e){Ne=e,oe=0,Ai=Ne.length,Vt=null,qxe();var t=dW();if(Vt.type!==lC)throw new Error("Unexpect token after expression.");return t}function Ny(e,t,n){return e.fields=t||[],e.fname=n,e}function FOt(e){return e.length===1?OOt(e[0]):ROt(e)}const OOt=e=>function(t){return t[e]},ROt=e=>{const t=e.length;return function(n){for(let r=0;r<t;++r)n=n[e[r]];return n}};function yR(e){throw Error(e)}function MOt(e){const t=[],n=e.length;let r=null,i=0,s="",o,a,u;e=e+"";function l(){t.push(s+e.substring(o,a)),s="",o=a+1}for(o=a=0;a<n;++a)if(u=e[a],u==="\\")s+=e.substring(o,a++),o=a;else if(u===r)l(),r=null,i=-1;else{if(r)continue;o===i&&u==='"'||o===i&&u==="'"?(o=a+1,r=u):u==="."&&!i?a>o?l():o=a+1:u==="["?(a>o&&l(),i=o=a+1):u==="]"&&(i||yR("Access path missing open bracket: "+e),i>0&&l(),i=0,o=a+1)}return i&&yR("Access path missing closing bracket: "+e),r&&yR("Access path missing closing quote: "+e),a>o&&(a++,l()),t}function LOt(e,t,n){const r=MOt(e);return e=r.length===1?r[0]:e,Ny((n&&n.get||FOt)(r),[e],t||e)}LOt("id");Ny(e=>e,[],"identity");Ny(()=>0,[],"zero");Ny(()=>1,[],"one");Ny(()=>!0,[],"true");Ny(()=>!1,[],"false");function dP(e){const t=[];return e.type==="Identifier"?[e.name]:e.type==="Literal"?[e.value]:(e.type==="MemberExpression"&&(t.push(...dP(e.object)),t.push(...dP(e.property))),t)}function Xxe(e){return e.object.type==="MemberExpression"?Xxe(e.object):e.object.name==="datum"}function Yxe(e){const t=NOt(e),n=new Set;return t.visit(r=>{r.type==="MemberExpression"&&Xxe(r)&&n.add(dP(r).slice(1).join("."))}),n}class Fy extends Jt{constructor(t,n,r){super(t),this.model=n,this.filter=r,this.expr=gA(this.model,this.filter,this),this._dependentFields=Yxe(this.expr)}clone(){return new Fy(null,this.model,ht(this.filter))}dependentFields(){return this._dependentFields}producedFields(){return new Set}assemble(){return{type:"filter",expr:this.expr}}hash(){return`Filter ${this.expr}`}}function POt(e,t){var n;const r={},i=e.config.selection;for(const s of be(t??{})){const o=ht(t[s]),a=i[o.type],u=Be(a,["fields","encodings"]);for(const f in u)f==="encodings"&&o.fields||f==="fields"&&o.encodings||(f==="mark"&&(o[f]=Object.assign(Object.assign({},u[f]),o[f])),(o[f]===void 0||o[f]===!0)&&(o[f]=(n=u[f])!==null&&n!==void 0?n:o[f]));const l=wn(s),c=r[l]=Object.assign(Object.assign({},o),{name:l,events:ft(o.on)?Pg(o.on,"scope"):ht(o.on)});wF(c,f=>{f.has(c)&&f.parse&&f.parse(e,c,o,t[s])})}return r}function Kxe(e,t,n,r="datum"){const i=[];function s(a){const u=wn(a),l=e.getSelectionComponent(u,a),c=Ct(u+Xp);if(l.project.timeUnit){const f=n??e.component.data.raw,h=l.project.timeUnit.clone();f.parent?h.insertAsParentOf(f):f.parent=h}return l.empty!=="none"&&i.push(c),`vlSelectionTest(${c}, ${r}`+(l.resolve==="global"?")":`, ${Ct(l.resolve)})`)}const o=Ax(t,s);return(i.length?"!("+i.map(a=>`length(data(${a}))`).join(" || ")+") || ":"")+`(${o})`}function Zxe(e,t){const n=t.encoding;let r=t.field;if(!n&&!r)r=e.project.items[0].field,e.project.items.length>1&&pe(`A "field" or "encoding" must be specified when using a selection as a scale domain. Using "field": ${Ct(r)}.`);else if(n&&!r){const i=e.project.items.filter(s=>s.channel===n);!i.length||i.length>1?(r=e.project.items[0].field,pe((i.length?"Multiple ":"No ")+`matching ${Ct(n)} encoding found for selection ${Ct(t.selection)}. Using "field": ${Ct(r)}.`)):r=i[0].field}return`${e.name}[${Ct(r)}]`}function BOt(e,t){Gg(e,n=>{const r=n.name,i=e.getName(`lookup_${r}`);e.component.data.outputNodes[i]=n.materialized=new Hi(new Fy(t,e,{selection:r}),i,"lookup",e.component.data.outputNodeRefCounts)})}function gA(e,t,n){return Ax(t,r=>ft(r)?r:EDt(r)?Kxe(e,r.selection,n):xbe(r))}function zOt(e,t){if(e)return je(e)&&!Jc(e)?e.map(n=>Vbe(n,t)).join(", "):e}function bR(e,t,n,r){var i,s,o;e.encode=(i=e.encode)!==null&&i!==void 0?i:{},e.encode[t]=(s=e.encode[t])!==null&&s!==void 0?s:{},e.encode[t].update=(o=e.encode[t].update)!==null&&o!==void 0?o:{},e.encode[t].update[n]=r}function ix(e,t,n,r={header:!1}){var i,s;const o=e.combine(),{disable:a,orient:u,scale:l,labelExpr:c,title:f,zindex:h}=o,d=Be(o,["disable","orient","scale","labelExpr","title","zindex"]);if(!a){for(const p in d){const g=STt[p],m=d[p];if(g&&g!==t&&g!=="both")delete d[p];else if(mj(m)){const{condition:y}=m,b=Be(m,["condition"]),v=jn(y),x=KZ[p];if(x){const{vgProp:w,part:C}=x,$=[...v.map(S=>{const{test:k}=S,E=Be(S,["test"]);return Object.assign({test:gA(null,k)},E)}),b];bR(d,C,w,$),delete d[p]}else if(x===null){const w={signal:v.map(C=>{const{test:$}=C,S=Be(C,["test"]);return`${gA(null,$)} ? ${pJ(S)} : `}).join("")+pJ(b)};d[p]=w}}else if(Xe(m)){const y=KZ[p];if(y){const{vgProp:b,part:v}=y;bR(d,v,b,m),delete d[p]}}}if(t==="grid"){if(!d.grid)return;if(d.encode){const{grid:p}=d.encode;d.encode=Object.assign({},p?{grid:p}:{}),tn(d.encode)&&delete d.encode}return Object.assign(Object.assign({scale:l,orient:u},d),{domain:!1,labels:!1,aria:!1,maxExtent:0,minExtent:0,ticks:!1,zindex:Jn(h,0)})}else{if(!r.header&&e.mainExtracted)return;if(c!==void 0){let g=c;!((s=(i=d.encode)===null||i===void 0?void 0:i.labels)===null||s===void 0)&&s.update&&Xe(d.encode.labels.update.text)&&(g=M0(c,"datum.label",d.encode.labels.update.text.signal)),bR(d,"labels","text",{signal:g})}if(d.labelAlign===null&&delete d.labelAlign,d.encode){for(const g of Lye)e.hasAxisPart(g)||delete d.encode[g];tn(d.encode)&&delete d.encode}const p=zOt(f,n);return Object.assign(Object.assign(Object.assign(Object.assign({scale:l,orient:u,grid:!1},p?{title:p}:{}),d),n.aria===!1?{aria:!1}:{}),{zindex:Jn(h,0)})}}}function Jxe(e){const{axes:t}=e.component,n=[];for(const r of Vo)if(t[r]){for(const i of t[r])if(!i.get("disable")&&!i.get("gridScale")){const s=r==="x"?"height":"width",o=e.getSizeSignalRef(s).signal;s!==o&&n.push({name:s,update:o})}}return n}function UOt(e,t){const{x:n=[],y:r=[]}=e;return[...n.map(i=>ix(i,"grid",t)),...r.map(i=>ix(i,"grid",t)),...n.map(i=>ix(i,"main",t)),...r.map(i=>ix(i,"main",t))].filter(i=>i)}const Qxe={titleAlign:"align",titleAnchor:"anchor",titleAngle:"angle",titleBaseline:"baseline",titleColor:"color",titleFont:"font",titleFontSize:"fontSize",titleFontStyle:"fontStyle",titleFontWeight:"fontWeight",titleLimit:"limit",titleLineHeight:"lineHeight",titleOrient:"orient",titlePadding:"offset"},eve={labelAlign:"align",labelAnchor:"anchor",labelAngle:"angle",labelBaseline:"baseline",labelColor:"color",labelFont:"font",labelFontSize:"fontSize",labelFontStyle:"fontStyle",labelFontWeight:"fontWeight",labelLimit:"limit",labelLineHeight:"lineHeight",labelOrient:"orient",labelPadding:"offset"},jOt=be(Qxe),WOt=be(eve);function UJ(e,t,n,r){return Object.assign.apply(null,[{},...e.map(i=>{if(i==="axisOrient"){const s=n==="x"?"bottom":"left",o=t[n==="x"?"axisBottom":"axisLeft"]||{},a=t[n==="x"?"axisTop":"axisRight"]||{},u=new Set([...be(o),...be(a)]),l={};for(const c of u.values())l[c]={signal:`${r.signal} === "${s}" ? ${h2(o[c])} : ${h2(a[c])}`};return l}return t[i]})])}function VOt(e,t,n,r){const i=t==="band"?["axisDiscrete","axisBand"]:t==="point"?["axisDiscrete","axisPoint"]:PDt(t)?["axisQuantitative"]:t==="time"||t==="utc"?["axisTemporal"]:[],s=e==="x"?"axisX":"axisY",o=Xe(n)?"axisOrient":"axis"+KN(n),a=[...i,...i.map(l=>s+l.substr(4))],u=["axis",o,s];return{vlOnlyAxisConfig:UJ(a,r,e,n),vgAxisConfig:UJ(u,r,e,n),axisConfigStyle:GOt([...u,...a],r)}}function GOt(e,t){var n;const r=[{}];for(const i of e){let s=(n=t[i])===null||n===void 0?void 0:n.style;if(s){s=jn(s);for(const o of s)r.push(t.style[o])}}return Object.assign.apply(null,r)}function pP(e,t,n,r={}){var i;const s=Ybe(e,n,t.style);if(s!==void 0)return{configFrom:"style",configValue:s};for(const o of["vlOnlyAxisConfig","vgAxisConfig","axisConfigStyle"])if(((i=r[o])===null||i===void 0?void 0:i[e])!==void 0)return{configFrom:o,configValue:r[o][e]};return{}}const jJ={scale:({model:e,channel:t})=>e.scaleName(t),format:({fieldOrDatumDef:e,config:t,axis:n})=>{const{format:r,formatType:i}=n;return Ibe(e,e.type,r,i,t,!0)},formatType:({axis:e,fieldOrDatumDef:t,scaleType:n})=>{const{formatType:r}=e;return Dbe(r,t,n)},grid:({fieldOrDatumDef:e,axis:t,scaleType:n})=>{var r;return ke(e)&&ji(e.bin)?!1:(r=t.grid)!==null&&r!==void 0?r:HOt(n,e)},gridScale:({model:e,channel:t})=>qOt(e,t),labelAlign:({axis:e,labelAngle:t,orient:n,channel:r})=>e.labelAlign||nve(t,n,r),labelAngle:({labelAngle:e})=>e,labelBaseline:({axis:e,labelAngle:t,orient:n,channel:r})=>e.labelBaseline||tve(t,n,r),labelFlush:({axis:e,fieldOrDatumDef:t,channel:n})=>{var r;return(r=e.labelFlush)!==null&&r!==void 0?r:YOt(t.type,n)},labelOverlap:({axis:e,fieldOrDatumDef:t,scaleType:n})=>{var r;return(r=e.labelOverlap)!==null&&r!==void 0?r:KOt(t.type,n)},orient:({orient:e})=>e,tickCount:({channel:e,model:t,axis:n,fieldOrDatumDef:r,scaleType:i})=>{var s;const o=e==="x"?"width":e==="y"?"height":void 0,a=o?t.getSizeSignalRef(o):void 0;return(s=n.tickCount)!==null&&s!==void 0?s:JOt({fieldOrDatumDef:r,scaleType:i,size:a,values:n.values})},title:({axis:e,model:t,channel:n})=>{if(e.title!==void 0)return e.title;const r=rve(t,n);if(r!==void 0)return r;const i=t.typedFieldDef(n),s=n==="x"?"x2":"y2",o=t.fieldDef(s);return Zbe(i?[dJ(i)]:[],ke(o)?[dJ(o)]:[])},values:({axis:e,fieldOrDatumDef:t})=>QOt(e,t),zindex:({axis:e,fieldOrDatumDef:t,mark:n})=>{var r;return(r=e.zindex)!==null&&r!==void 0?r:eRt(n,t)}};function HOt(e,t){return!Ms(e)&&ke(t)&&!ln(t==null?void 0:t.bin)}function qOt(e,t){const n=t==="x"?"y":"x";if(e.getScaleComponent(n))return e.scaleName(n)}function XOt(e,t,n,r,i){const s=t==null?void 0:t.labelAngle;if(s!==void 0)return Xe(s)?s:eA(s);{const{configValue:o}=pP("labelAngle",e.config,t==null?void 0:t.style,i);return o!==void 0?eA(o):n===_n&&Ve([Rj,Oj],r.type)?270:void 0}}function gP(e){return`(((${e.signal} % 360) + 360) % 360)`}function tve(e,t,n,r){if(e!==void 0)if(n==="x"){if(Xe(e)){const i=gP(e),s=Xe(t)?`(${t.signal} === "top")`:t==="top";return{signal:`(45 < ${i} && ${i} < 135) || (225 < ${i} && ${i} < 315) ? "middle" :(${i} <= 45 || 315 <= ${i}) === ${s} ? "bottom" : "top"`}}if(45<e&&e<135||225<e&&e<315)return"middle";if(Xe(t)){const i=e<=45||315<=e?"===":"!==";return{signal:`${t.signal} ${i} "top" ? "bottom" : "top"`}}return(e<=45||315<=e)==(t==="top")?"bottom":"top"}else{if(Xe(e)){const i=gP(e),s=Xe(t)?`(${t.signal} === "left")`:t==="left";return{signal:`${i} <= 45 || 315 <= ${i} || (135 <= ${i} && ${i} <= 225) ? ${r?'"middle"':"null"} : (45 <= ${i} && ${i} <= 135) === ${s} ? "top" : "bottom"`}}if(e<=45||315<=e||135<=e&&e<=225)return r?"middle":null;if(Xe(t)){const i=45<=e&&e<=135?"===":"!==";return{signal:`${t.signal} ${i} "left" ? "top" : "bottom"`}}return(45<=e&&e<=135)==(t==="left")?"top":"bottom"}}function nve(e,t,n){if(e===void 0)return;const r=n==="x",i=r?0:90,s=r?"bottom":"left";if(Xe(e)){const o=gP(e),a=Xe(t)?`(${t.signal} === "${s}")`:t===s;return{signal:`(${i?"("+o+" + 90)":o} % 180 === 0) ? ${r?null:'"center"'} :(${i} < ${o} && ${o} < ${180+i}) === ${a} ? "left" : "right"`}}if((e+i)%180===0)return r?null:"center";if(Xe(t)){const o=i<e&&e<180+i?"===":"!==";return{signal:`${`${t.signal} ${o} "${s}"`} ? "left" : "right"`}}return(i<e&&e<180+i)==(t===s)?"left":"right"}function YOt(e,t){if(t==="x"&&Ve(["quantitative","temporal"],e))return!0}function KOt(e,t){if(e!=="nominal")return t==="log"?"greedy":!0}function ZOt(e){return e==="x"?"bottom":"left"}function JOt({fieldOrDatumDef:e,scaleType:t,size:n,values:r}){var i;if(!r&&!Ms(t)&&t!=="log"){if(ke(e)){if(ln(e.bin))return{signal:`ceil(${n.signal}/10)`};if(e.timeUnit&&Ve(["month","hours","day","quarter"],(i=Qi(e.timeUnit))===null||i===void 0?void 0:i.unit))return}return{signal:`ceil(${n.signal}/40)`}}}function rve(e,t){const n=t==="x"?"x2":"y2",r=e.fieldDef(t),i=e.fieldDef(n),s=r?r.title:void 0,o=i?i.title:void 0;if(s&&o)return Jbe(s,o);if(s)return s;if(o)return o;if(s!==void 0)return s;if(o!==void 0)return o}function QOt(e,t){const n=e.values;if(je(n))return Hbe(t,n);if(Xe(n))return n}function eRt(e,t){return e==="rect"&&Bbe(t)?1:0}class U0 extends Jt{constructor(t,n){super(t),this.transform=n,this._dependentFields=Yxe(this.transform.calculate)}clone(){return new U0(null,ht(this.transform))}static parseAllForSortIndex(t,n){return n.forEachFieldDef((r,i)=>{if(Vj(r)&&Rbe(r.sort)){const{field:s,timeUnit:o}=r,a=r.sort,u=a.map((l,c)=>`${xbe({field:s,timeUnit:o,equal:l})} ? ${c} : `).join("")+a.length;t=new U0(t,{calculate:u,as:j0(r,i,{forAs:!0})})}}),t}producedFields(){return new Set([this.transform.as])}dependentFields(){return this._dependentFields}assemble(){return{type:"formula",expr:this.transform.calculate,as:this.transform.as}}hash(){return`Calculate ${Et(this.transform)}`}}function j0(e,t,n){return ve(e,Object.assign({prefix:t,suffix:"sort_index"},n??{}))}function EF(e,t){return Ve(["top","bottom"],t)?"column":Ve(["left","right"],t)||e==="row"?"row":"column"}function W0(e,t,n,r){const i=r==="row"?n.headerRow:r==="column"?n.headerColumn:n.headerFacet;return Jn(((t==null?void 0:t.header)||{})[e],i[e],n.header[e])}function _F(e,t,n,r){const i={};for(const s of e){const o=W0(s,t,n,r);o!==void 0&&(i[s]=o)}return i}const pW=["row","column"],gW=["header","footer"];function tRt(e,t){const n=e.component.layoutHeaders[t].title,r=e.config?e.config:void 0,i=e.component.layoutHeaders[t].facetFieldDef?e.component.layoutHeaders[t].facetFieldDef:void 0,{titleAnchor:s,titleAngle:o,titleOrient:a}=_F(["titleAnchor","titleAngle","titleOrient"],i,r,t),u=EF(t,a),l=eA(o);return{name:`${t}-title`,type:"group",role:`${u}-title`,title:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({text:n},t==="row"?{orient:"left"}:{}),{style:"guide-title"}),sve(l,u)),ive(u,l,s)),ove(r,i,t,jOt,Qxe))}}function ive(e,t,n="middle"){switch(n){case"start":return{align:"left"};case"end":return{align:"right"}}const r=nve(t,e==="row"?"left":"top",e==="row"?"y":"x");return r?{align:r}:{}}function sve(e,t){const n=tve(e,t==="row"?"left":"top",t==="row"?"y":"x",!0);return n?{baseline:n}:{}}function nRt(e,t){const n=e.component.layoutHeaders[t],r=[];for(const i of gW)if(n[i])for(const s of n[i]){const o=iRt(e,t,i,n,s);o!=null&&r.push(o)}return r}function rRt(e,t){var n;const{sort:r}=e;return Du(r)?{field:ve(r,{expr:"datum"}),order:(n=r.order)!==null&&n!==void 0?n:"ascending"}:je(r)?{field:j0(e,t,{expr:"datum"}),order:"ascending"}:{field:ve(e,{expr:"datum"}),order:r??"ascending"}}function mP(e,t,n){const{format:r,formatType:i,labelAngle:s,labelAnchor:o,labelOrient:a,labelExpr:u}=_F(["format","formatType","labelAngle","labelAnchor","labelOrient","labelExpr"],e,n,t),l=Pj({fieldOrDatumDef:e,format:r,formatType:i,expr:"parent",config:n}).signal,c=EF(t,a);return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({text:{signal:u?M0(M0(u,"datum.label",l),"datum.value",ve(e,{expr:"parent"})):l}},t==="row"?{orient:"left"}:{}),{style:"guide-label",frame:"group"}),sve(s,c)),ive(c,s,o)),ove(n,e,t,WOt,eve))}function iRt(e,t,n,r,i){if(i){let s=null;const{facetFieldDef:o}=r,a=e.config?e.config:void 0;if(o&&i.labels){const{labelOrient:f}=_F(["labelOrient"],o,a,t);(t==="row"&&!Ve(["top","bottom"],f)||t==="column"&&!Ve(["left","right"],f))&&(s=mP(o,t,a))}const u=Aa(e)&&!iC(e.facet),l=i.axes,c=(l==null?void 0:l.length)>0;if(s||c){const f=t==="row"?"height":"width";return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({name:e.getName(`${t}_${n}`),type:"group",role:`${t}-${n}`},r.facetFieldDef?{from:{data:e.getName(t+"_domain")},sort:rRt(o,t)}:{}),c&&u?{from:{data:e.getName(`facet_domain_${t}`)}}:{}),s?{title:s}:{}),i.sizeSignal?{encode:{update:{[f]:i.sizeSignal}}}:{}),c?{axes:l}:{})}}return null}const sRt={column:{start:0,end:1},row:{start:1,end:0}};function oRt(e,t){return sRt[t][e]}function aRt(e,t){const n={};for(const r of No){const i=e[r];if(i!=null&&i.facetFieldDef){const{titleAnchor:s,titleOrient:o}=_F(["titleAnchor","titleOrient"],i.facetFieldDef,t,r),a=EF(r,o),u=oRt(s,a);u!==void 0&&(n[a]=u)}}return tn(n)?void 0:n}function ove(e,t,n,r,i){const s={};for(const o of r){if(!i[o])continue;const a=W0(o,t,e,n);a!==void 0&&(s[i[o]]=a)}return s}function mW(e){return[...DS(e,"width"),...DS(e,"height"),...DS(e,"childWidth"),...DS(e,"childHeight")]}function DS(e,t){const n=t==="width"?"x":"y",r=e.component.layoutSize.get(t);if(!r||r==="merged")return[];const i=e.getSizeSignalRef(t).signal;if(r==="step"){const s=e.getScaleComponent(n);if(s){const o=s.get("type"),a=s.get("range");if(Ms(o)&&Kh(a)){const u=e.scaleName(n);return Aa(e.parent)&&e.parent.component.resolve.scale[n]==="independent"?[WJ(u,a)]:[WJ(u,a),{name:i,update:ave(u,s,`domain('${u}').length`)}]}}throw new Error("layout size is step although width/height is not step.")}else if(r=="container"){const s=i.endsWith("width"),o=s?"containerSize()[0]":"containerSize()[1]",a=oP(e.config.view,s?"width":"height"),u=`isFinite(${o}) ? ${o} : ${a}`;return[{name:i,init:u,on:[{update:u,events:"window:resize"}]}]}else return[{name:i,value:r}]}function WJ(e,t){return{name:e+"_step",value:t.step}}function ave(e,t,n){const r=t.get("type"),i=t.get("padding"),s=Jn(t.get("paddingOuter"),i);let o=t.get("paddingInner");return o=r==="band"?o!==void 0?o:i:1,`bandspace(${n}, ${o}, ${s}) * ${e}_step`}function uve(e){return e==="childWidth"?"width":e==="childHeight"?"height":e}function lve(e,t){return be(e).reduce((n,r)=>{const i=e[r];return Object.assign(Object.assign({},n),aC(t,i,r,s=>Xe(s)?s:{value:s.value}))},{})}function uRt(e,t){if(My(t)||Aa(t))return"shared";if(wW(t))return qu(e)?"independent":"shared";throw new Error("invalid model type for resolve")}function yW(e,t){const n=e.scale[t],r=qu(t)?"axis":"legend";return n==="independent"?(e[r][t]==="shared"&&pe(GIt(t)),"independent"):e[r][t]||"shared"}const lRt=Object.assign(Object.assign({},PNt),{disable:1,labelExpr:1,selections:1,opacity:1,shape:1,stroke:1,fill:1,size:1,strokeWidth:1,strokeDash:1,encode:1}),cve=be(lRt);class cRt extends Mc{}const VJ={symbols:fRt,gradient:hRt,labels:dRt,entries:pRt};function fRt(e,{fieldOrDatumDef:t,model:n,channel:r,legendCmpt:i,legendType:s}){var o,a,u,l,c;if(s!=="symbol")return;const{markDef:f,encoding:h,config:d,mark:p}=n,g=f.filled&&p!=="trail";let m=Object.assign(Object.assign({},yNt({},n,DTt)),_xe(n,{filled:g}));const y=(o=fve(h.opacity))!==null&&o!==void 0?o:f.opacity;if(m.fill){if(r==="fill"||g&&r===Os)delete m.fill;else if(m.fill.field)i.get("symbolFillColor")?delete m.fill:(m.fill=Bn((a=d.legend.symbolBaseFillColor)!==null&&a!==void 0?a:"black"),m.fillOpacity=Bn(y??1));else if(je(m.fill)){const b=(c=(l=yP((u=h.fill)!==null&&u!==void 0?u:h.color))!==null&&l!==void 0?l:f.fill)!==null&&c!==void 0?c:g&&f.color;b&&(m.fill=Bn(b))}}if(m.stroke){if(r==="stroke"||!g&&r===Os)delete m.stroke;else if(m.stroke.field)delete m.stroke;else if(je(m.stroke)){const b=Jn(yP(h.stroke||h.color),f.stroke,g?f.color:void 0);b&&(m.stroke={value:b})}}if(r!==Rc){const b=ke(t)&&dve(n,i,t);b?m.opacity=[Object.assign({test:b},Bn(y??1)),Bn(d.legend.unselectedOpacity)]:y&&(m.opacity=Bn(y))}return m=Object.assign(Object.assign({},m),e),tn(m)?void 0:m}function hRt(e,{model:t,legendType:n}){if(n!=="gradient")return;let r={};const i=fve(t.encoding.opacity)||t.markDef.opacity;return i&&(r.opacity=Bn(i)),r=Object.assign(Object.assign({},r),e),tn(r)?void 0:r}function dRt(e,{fieldOrDatumDef:t,model:n,channel:r,legendCmpt:i}){const s=n.legend(r)||{},o=n.config,a=ke(t)?dve(n,i,t):void 0,u=a?[{test:a,value:1},{value:o.legend.unselectedOpacity}]:void 0,{format:l,formatType:c}=s,f=Hp(c)?Bj({fieldOrDatumDef:t,field:"datum.value",format:l,formatType:c,config:o}):void 0,h=Object.assign(Object.assign(Object.assign({},u?{opacity:u}:{}),f?{text:f}:{}),e);return tn(h)?void 0:h}function pRt(e,{legendCmpt:t}){const n=t.get("selections");return n!=null&&n.length?Object.assign(Object.assign({},e),{fill:{value:"transparent"}}):e}function fve(e){return hve(e,(t,n)=>Math.max(t,n.value))}function yP(e){return hve(e,(t,n)=>Jn(t,n.value))}function hve(e,t){if(aNt(e))return jn(e.condition).reduce(t,e.value);if(yc(e))return e.value}function dve(e,t,n){const r=t.get("selections");if(!(r!=null&&r.length))return;const i=Ct(n.field);return r.map(s=>`(!length(data(${Ct(wn(s)+Xp)})) || (${s}[${i}] && indexof(${s}[${i}], datum.value) >= 0))`).join(" || ")}const GJ={direction:({direction:e})=>e,format:({fieldOrDatumDef:e,legend:t,config:n})=>{const{format:r,formatType:i}=t;return Ibe(e,e.type,r,i,n,!1)},formatType:({legend:e,fieldOrDatumDef:t,scaleType:n})=>{const{formatType:r}=e;return Dbe(r,t,n)},gradientLength:e=>{var t,n;const{legend:r,legendConfig:i}=e;return(n=(t=r.gradientLength)!==null&&t!==void 0?t:i.gradientLength)!==null&&n!==void 0?n:wRt(e)},labelOverlap:({legend:e,legendConfig:t,scaleType:n})=>{var r,i;return(i=(r=e.labelOverlap)!==null&&r!==void 0?r:t.labelOverlap)!==null&&i!==void 0?i:$Rt(n)},symbolType:({legend:e,markDef:t,channel:n,encoding:r})=>{var i;return(i=e.symbolType)!==null&&i!==void 0?i:mRt(t.type,n,r.shape,t.shape)},title:({fieldOrDatumDef:e,config:t})=>lp(e,t,{allowDisabling:!0}),type:({legendType:e,scaleType:t,channel:n})=>{if(Bm(n)&&wa(t)){if(e==="gradient")return}else if(e==="symbol")return;return e},values:({fieldOrDatumDef:e,legend:t})=>gRt(t,e)};function gRt(e,t){const n=e.values;if(je(n))return Hbe(t,n);if(Xe(n))return n}function mRt(e,t,n,r){var i;if(t!=="shape"){const s=(i=yP(n))!==null&&i!==void 0?i:r;if(s)return s}switch(e){case"bar":case"rect":case"image":case"square":return"square";case"line":case"trail":case"rule":return"stroke";case"arc":case"point":case"circle":case"tick":case"geoshape":case"area":case"text":return"circle"}}function yRt(e){const{legend:t}=e;return Jn(t.type,bRt(e))}function bRt({channel:e,timeUnit:t,scaleType:n}){if(Bm(e)){if(Ve(["quarter","month","day"],t))return"symbol";if(wa(n))return"gradient"}return"symbol"}function xRt({legendConfig:e,legendType:t,orient:n,legend:r}){var i,s;return(s=(i=r.direction)!==null&&i!==void 0?i:e[t?"gradientDirection":"symbolDirection"])!==null&&s!==void 0?s:vRt(n,t)}function vRt(e,t){switch(e){case"top":case"bottom":return"horizontal";case"left":case"right":case"none":case void 0:return;default:return t==="gradient"?"horizontal":void 0}}function wRt({legendConfig:e,model:t,direction:n,orient:r,scaleType:i}){const{gradientHorizontalMaxLength:s,gradientHorizontalMinLength:o,gradientVerticalMaxLength:a,gradientVerticalMinLength:u}=e;if(wa(i))return n==="horizontal"?r==="top"||r==="bottom"?HJ(t,"width",o,s):o:HJ(t,"height",u,a)}function HJ(e,t,n,r){return{signal:`clamp(${e.getSizeSignalRef(t).signal}, ${n}, ${r})`}}function $Rt(e){if(Ve(["quantile","threshold","log"],e))return"greedy"}function pve(e){const t=In(e)?CRt(e):_Rt(e);return e.component.legends=t,t}function CRt(e){const{encoding:t}=e,n={};for(const r of[Os,...dxe]){const i=ur(t[r]);!i||!e.getScaleComponent(r)||r===Rs&&ke(i)&&i.type===Dy||(n[r]=ERt(e,r))}return n}function SRt(e,t){const n=e.scaleName(t);if(e.mark==="trail"){if(t==="color")return{stroke:n};if(t==="size")return{strokeWidth:n}}return t==="color"?e.markDef.filled?{fill:n}:{stroke:n}:{[t]:n}}function kRt(e,t,n,r){switch(t){case"disable":return n!==void 0;case"values":return!!(n!=null&&n.values);case"title":if(t==="title"&&e===(r==null?void 0:r.title))return!0}return e===(n||{})[t]}function ERt(e,t){var n,r,i;let s=e.legend(t);const{markDef:o,encoding:a,config:u}=e,l=u.legend,c=new cRt({},SRt(e,t));a3t(e,t,c);const f=s!==void 0?!s:l.disable;if(c.set("disable",f,s!==void 0),f)return c;s=s||{};const h=e.getScaleComponent(t).get("type"),d=ur(a[t]),p=ke(d)?(n=Qi(d.timeUnit))===null||n===void 0?void 0:n.unit:void 0,g=s.orient||u.legend.orient||"right",m=yRt({legend:s,channel:t,timeUnit:p,scaleType:h}),y=xRt({legend:s,legendType:m,orient:g,legendConfig:l}),b={legend:s,channel:t,model:e,markDef:o,encoding:a,fieldOrDatumDef:d,legendConfig:l,config:u,scaleType:h,orient:g,legendType:m,direction:y};for(const $ of cve){const S=$ in GJ?GJ[$](b):s[$];if(S!==void 0){const k=kRt(S,$,s,e.fieldDef(t));(k||u.legend[$]===void 0)&&c.set($,S,k)}}const v=(r=s==null?void 0:s.encoding)!==null&&r!==void 0?r:{},x=c.get("selections"),w={},C={fieldOrDatumDef:d,model:e,channel:t,legendCmpt:c,legendType:m};for(const $ of["labels","legend","title","symbols","gradient","entries"]){const S=lve((i=v[$])!==null&&i!==void 0?i:{},e),k=$ in VJ?VJ[$](S,C):S;k!==void 0&&!tn(k)&&(w[$]=Object.assign(Object.assign(Object.assign({},x!=null&&x.length&&ke(d)?{name:`${wn(d.field)}_legend_${$}`}:{}),x!=null&&x.length?{interactive:!!x}:{}),{update:k}))}return tn(w)||c.set("encode",w,!!(s!=null&&s.encoding)),c}function _Rt(e){const{legends:t,resolve:n}=e.component;for(const r of e.children){pve(r);for(const i of be(r.component.legends))n.legend[i]=yW(e.component.resolve,i),n.legend[i]==="shared"&&(t[i]=gve(t[i],r.component.legends[i]),t[i]||(n.legend[i]="independent",delete t[i]))}for(const r of be(t))for(const i of e.children)i.component.legends[r]&&n.legend[r]==="shared"&&delete i.component.legends[r];return t}function gve(e,t){var n,r,i,s;if(!e)return t.clone();const o=e.getWithExplicit("orient"),a=t.getWithExplicit("orient");if(o.explicit&&a.explicit&&o.value!==a.value)return;let u=!1;for(const l of cve){const c=xh(e.getWithExplicit(l),t.getWithExplicit(l),l,"legend",(f,h)=>{switch(l){case"symbolType":return ARt(f,h);case"title":return Qbe(f,h);case"type":return u=!0,Ws("symbol")}return xF(f,h,l,"legend")});e.setWithExplicit(l,c)}return u&&(!((r=(n=e.implicit)===null||n===void 0?void 0:n.encode)===null||r===void 0)&&r.gradient&&eP(e.implicit,["encode","gradient"]),!((s=(i=e.explicit)===null||i===void 0?void 0:i.encode)===null||s===void 0)&&s.gradient&&eP(e.explicit,["encode","gradient"])),e}function ARt(e,t){return t.value==="circle"?t:e}function qJ(e,t,n,r){var i,s,o;e.encode=(i=e.encode)!==null&&i!==void 0?i:{},e.encode[t]=(s=e.encode[t])!==null&&s!==void 0?s:{},e.encode[t].update=(o=e.encode[t].update)!==null&&o!==void 0?o:{},e.encode[t].update[n]=r}function mve(e){const t=e.component.legends,n={};for(const i of be(t)){const s=e.getScaleComponent(i),o=xn(s.get("domains"));if(n[o])for(const a of n[o])gve(a,t[i])||n[o].push(t[i]);else n[o]=[t[i].clone()]}return Df(n).flat().map(i=>TRt(i,e.config)).filter(i=>i!==void 0)}function TRt(e,t){var n,r,i;const s=e.combine(),{disable:o,labelExpr:a,selections:u}=s,l=Be(s,["disable","labelExpr","selections"]);if(!o){if(t.aria===!1&&l.aria==null&&(l.aria=!1),!((n=l.encode)===null||n===void 0)&&n.symbols){const c=l.encode.symbols.update;c.fill&&c.fill.value!=="transparent"&&!c.stroke&&!l.stroke&&(c.stroke={value:"transparent"});for(const f of dxe)l[f]&&delete c[f]}if(l.title||delete l.title,a!==void 0){let c=a;!((i=(r=l.encode)===null||r===void 0?void 0:r.labels)===null||i===void 0)&&i.update&&Xe(l.encode.labels.update.text)&&(c=M0(a,"datum.label",l.encode.labels.update.text.signal)),qJ(l,"labels","text",{signal:c})}for(const c in l){const f=l[c];if(Xe(f)){const h=MNt[c];if(h){const{vgProp:d,part:p}=h;qJ(l,p,d,f),delete l[c]}}}return l}}function IRt(e){return My(e)||wW(e)?DRt(e):yve(e)}function DRt(e){return e.children.reduce((t,n)=>t.concat(n.assembleProjections()),yve(e))}function yve(e){const t=e.component.projection;if(!t||t.merged)return[];const n=t.combine(),{name:r}=n;if(t.data){const i={signal:`[${t.size.map(o=>o.signal).join(", ")}]`},s=t.data.reduce((o,a)=>{const u=Xe(a)?a.signal:`data('${e.lookupDataSource(a)}')`;return Ve(o,u)||o.push(u),o},[]);if(s.length<=0)throw new Error("Projection's fit didn't find any data sources");return[Object.assign({name:r,size:i,fit:{signal:s.length>1?`[${s.join(", ")}]`:s[0]}},n)]}else return[Object.assign(Object.assign({name:r},{translate:{signal:"[width / 2, height / 2]"}}),n)]}const NRt=["type","clipAngle","clipExtent","center","rotate","precision","reflectX","reflectY","coefficient","distance","fraction","lobes","parallel","radius","ratio","spacing","tilt"];class bve extends Mc{constructor(t,n,r,i){super(Object.assign({},n),{name:t}),this.specifiedProjection=n,this.size=r,this.data=i,this.merged=!1}get isFit(){return!!this.data}}function xve(e){e.component.projection=In(e)?FRt(e):MRt(e)}function FRt(e){var t;if(e.hasProjection){const n=e.specifiedProjection,r=!(n&&(n.scale!=null||n.translate!=null)),i=r?[e.getSizeSignalRef("width"),e.getSizeSignalRef("height")]:void 0,s=r?ORt(e):void 0;return new bve(e.projectionName(!0),Object.assign(Object.assign({},(t=e.config.projection)!==null&&t!==void 0?t:{}),n??{}),i,s)}}function ORt(e){const t=[],{encoding:n}=e;for(const r of[[dl,hl],[Wo,Ka]])(ur(n[r[0]])||ur(n[r[1]]))&&t.push({signal:e.getName(`geojson_${t.length}`)});return e.channelHasField(Rs)&&e.typedFieldDef(Rs).type===Dy&&t.push({signal:e.getName(`geojson_${t.length}`)}),t.length===0&&t.push(e.requestDataName(ci)),t}function RRt(e,t){const n=Dye(NRt,i=>!!(!Hd(e.explicit,i)&&!Hd(t.explicit,i)||Hd(e.explicit,i)&&Hd(t.explicit,i)&&xn(e.get(i))===xn(t.get(i))));if(xn(e.size)===xn(t.size)){if(n)return e;if(xn(e.explicit)===xn({}))return t;if(xn(t.explicit)===xn({}))return e}return null}function MRt(e){if(e.children.length===0)return;let t;for(const r of e.children)xve(r);const n=Dye(e.children,r=>{const i=r.component.projection;if(i)if(t){const s=RRt(t,i);return s&&(t=s),!!s}else return t=i,!0;else return!0});if(t&&n){const r=e.projectionName(!0),i=new bve(r,t.specifiedProjection,t.size,ht(t.data));for(const s of e.children){const o=s.component.projection;o&&(o.isFit&&i.data.push(...s.component.projection.data),s.renameProjection(o.get("name"),r),o.merged=!0)}return i}}function LRt(e,t,n,r){var i,s;if(oC(t,n)){const o=In(e)?(s=(i=e.axis(n))!==null&&i!==void 0?i:e.legend(n))!==null&&s!==void 0?s:{}:{},a=ve(t,{expr:"datum"}),u=ve(t,{expr:"datum",binSuffix:"end"});return{formulaAs:ve(t,{binSuffix:"range",forAs:!0}),formula:fF(a,u,o.format,o.formatType,r)}}return{}}function vve(e,t){return`${tbe(e)}_${t}`}function PRt(e,t){return{signal:e.getName(`${t}_bins`),extentSignal:e.getName(`${t}_extent`)}}function bW(e,t,n){var r;const i=(r=gF(n,void 0))!==null&&r!==void 0?r:{},s=vve(i,t);return e.getName(`${s}_bins`)}function BRt(e){return"as"in e}function XJ(e,t,n){let r,i;BRt(e)?r=ft(e.as)?[e.as,`${e.as}_end`]:[e.as[0],e.as[1]]:r=[ve(e,{forAs:!0}),ve(e,{binSuffix:"end",forAs:!0})];const s=Object.assign({},gF(t,void 0)),o=vve(s,e.field),{signal:a,extentSignal:u}=PRt(n,o);if(lF(s.extent)){const c=s.extent,f=c.selection;i=Zxe(n.getSelectionComponent(wn(f),f),c),delete s.extent}const l=Object.assign(Object.assign(Object.assign({bin:s,field:e.field,as:[r]},a?{signal:a}:{}),u?{extentSignal:u}:{}),i?{span:i}:{});return{key:o,binComponent:l}}class Fu extends Jt{constructor(t,n){super(t),this.bins=n}clone(){return new Fu(null,ht(this.bins))}static makeFromEncoding(t,n){const r=n.reduceFieldDef((i,s,o)=>{if(lo(s)&&ln(s.bin)){const{key:a,binComponent:u}=XJ(s,s.bin,n);i[a]=Object.assign(Object.assign(Object.assign({},u),i[a]),LRt(n,s,o,n.config))}return i},{});return tn(r)?null:new Fu(t,r)}static makeFromTransform(t,n,r){const{key:i,binComponent:s}=XJ(n,n.bin,r);return new Fu(t,{[i]:s})}merge(t,n){for(const r of be(t.bins))r in this.bins?(n(t.bins[r].signal,this.bins[r].signal),this.bins[r].as=bf([...this.bins[r].as,...t.bins[r].as],Et)):this.bins[r]=t.bins[r];for(const r of t.children)t.removeChild(r),r.parent=this;t.remove()}producedFields(){return new Set(Df(this.bins).map(t=>t.as).flat(2))}dependentFields(){return new Set(Df(this.bins).map(t=>t.field))}hash(){return`Bin ${Et(this.bins)}`}assemble(){return Df(this.bins).flatMap(t=>{const n=[],[r,...i]=t.as,s=t.bin,{extent:o}=s,a=Be(s,["extent"]),u=Object.assign(Object.assign(Object.assign({type:"bin",field:mh(t.field),as:r,signal:t.signal},lF(o)?{extent:null}:{extent:o}),t.span?{span:{signal:`span(${t.span})`}}:{}),a);!o&&t.extentSignal&&(n.push({type:"extent",field:mh(t.field),signal:t.extentSignal}),u.extent={signal:t.extentSignal}),n.push(u);for(const l of i)for(let c=0;c<2;c++)n.push({type:"formula",expr:ve({field:r[c]},{expr:"datum"}),as:l[c]});return t.formula&&n.push({type:"formula",expr:t.formula,as:t.formulaAs}),n})}}class V0 extends Jt{constructor(t){super(null),t=t??{name:"source"};let n;if(fp(t)||(n=t.format?Object.assign({},tc(t.format,["parse"])):{}),cA(t))this._data={values:t.values};else if(p2(t)){if(this._data={url:t.url},!n.type){let r=/(?:\.([^.]+))?$/.exec(t.url)[1];Ve(["json","csv","tsv","dsv","topojson"],r)||(r="json"),n.type=r}}else Cxe(t)?this._data={values:[{type:"Sphere"}]}:(wxe(t)||fp(t))&&(this._data={});this._generator=fp(t),t.name&&(this._name=t.name),n&&!tn(n)&&(this._data.format=n)}dependentFields(){return new Set}producedFields(){}get data(){return this._data}hasName(){return!!this._name}get isGenerator(){return this._generator}get dataName(){return this._name}set dataName(t){this._name=t}set parent(t){throw new Error("Source nodes have to be roots.")}remove(){throw new Error("Source nodes are roots and cannot be removed.")}hash(){throw new Error("Cannot hash sources")}assemble(){return Object.assign(Object.assign({name:this._name},this._data),{transform:[]})}}function bP(e){for(const t of e){for(const n of t.children)if(n.parent!==t)return console.error("Dataflow graph is inconsistent.",t,n),!1;if(!bP(t.children))return!1}return!0}class hC extends Jt{constructor(t,n){super(t),this.params=n}clone(){return new hC(null,this.params)}dependentFields(){return new Set}producedFields(){}hash(){return`Graticule ${Et(this.params)}`}assemble(){return Object.assign({type:"graticule"},this.params===!0?{}:this.params)}}class dC extends Jt{constructor(t,n){super(t),this.params=n}clone(){return new dC(null,this.params)}dependentFields(){return new Set}producedFields(){var t;return new Set([(t=this.params.as)!==null&&t!==void 0?t:"data"])}hash(){return`Hash ${Et(this.params)}`}assemble(){return Object.assign({type:"sequence"},this.params)}}function AF(e){return e instanceof V0||e instanceof hC||e instanceof dC}class wve{constructor(){this._mutated=!1}setMutated(){this._mutated=!0}get mutatedFlag(){return this._mutated}}class Lc extends wve{constructor(){super(),this._continue=!1}setContinue(){this._continue=!0}get continueFlag(){return this._continue}get flags(){return{continueFlag:this.continueFlag,mutatedFlag:this.mutatedFlag}}set flags({continueFlag:t,mutatedFlag:n}){t&&this.setContinue(),n&&this.setMutated()}reset(){}optimizeNextFromLeaves(t){if(AF(t))return!1;const n=t.parent,{continueFlag:r}=this.run(t);return r&&this.optimizeNextFromLeaves(n),this.mutatedFlag}}class xW extends wve{}function zRt(e,t,n,r){const i=In(r)?r.encoding[ml(t)]:void 0;if(lo(n)&&In(r)&&Uj(t,n,i,r.stack,r.markDef,r.config))e.add(ve(n,{})),e.add(ve(n,{suffix:"end"})),n.bin&&oC(n,t)&&e.add(ve(n,{binSuffix:"range"}));else if(YTt(t)){const s=XTt(t);e.add(r.getName(s))}else e.add(ve(n));return e}function URt(e,t){var n;for(const r of be(t)){const i=t[r];for(const s of be(i))r in e?e[r][s]=new Set([...(n=e[r][s])!==null&&n!==void 0?n:[],...i[s]]):e[r]={[s]:i[s]}}}class _a extends Jt{constructor(t,n,r){super(t),this.dimensions=n,this.measures=r}clone(){return new _a(null,new Set(this.dimensions),ht(this.measures))}get groupBy(){return this.dimensions}static makeFromEncoding(t,n){let r=!1;n.forEachFieldDef(o=>{o.aggregate&&(r=!0)});const i={},s=new Set;return!r||(n.forEachFieldDef((o,a)=>{var u,l,c,f;const{aggregate:h,field:d}=o;if(h)if(h==="count")i["*"]=(u=i["*"])!==null&&u!==void 0?u:{},i["*"].count=new Set([ve(o,{forAs:!0})]);else{if(yh(h)||jg(h)){const p=yh(h)?"argmin":"argmax",g=h[p];i[g]=(l=i[g])!==null&&l!==void 0?l:{},i[g][p]=new Set([ve({op:p,field:g},{forAs:!0})])}else i[d]=(c=i[d])!==null&&c!==void 0?c:{},i[d][h]=new Set([ve(o,{forAs:!0})]);Yh(a)&&n.scaleDomain(a)==="unaggregated"&&(i[d]=(f=i[d])!==null&&f!==void 0?f:{},i[d].min=new Set([ve({field:d,aggregate:"min"},{forAs:!0})]),i[d].max=new Set([ve({field:d,aggregate:"max"},{forAs:!0})]))}else zRt(s,a,o,n)}),s.size+be(i).length===0)?null:new _a(t,s,i)}static makeFromTransform(t,n){var r,i,s;const o=new Set,a={};for(const u of n.aggregate){const{op:l,field:c,as:f}=u;l&&(l==="count"?(a["*"]=(r=a["*"])!==null&&r!==void 0?r:{},a["*"].count=new Set([f||ve(u,{forAs:!0})])):(a[c]=(i=a[c])!==null&&i!==void 0?i:{},a[c][l]=new Set([f||ve(u,{forAs:!0})])))}for(const u of(s=n.groupby)!==null&&s!==void 0?s:[])o.add(u);return o.size+be(a).length===0?null:new _a(t,o,a)}merge(t){return yTt(this.dimensions,t.dimensions)?(URt(this.measures,t.measures),!0):(aDt("different dimensions, cannot merge"),!1)}addDimensions(t){t.forEach(this.dimensions.add,this.dimensions)}dependentFields(){return new Set([...this.dimensions,...be(this.measures)])}producedFields(){const t=new Set;for(const n of be(this.measures))for(const r of be(this.measures[n])){const i=this.measures[n][r];i.size===0?t.add(`${r}_${n}`):i.forEach(t.add,t)}return t}hash(){return`Aggregate ${Et({dimensions:this.dimensions,measures:this.measures})}`}assemble(){const t=[],n=[],r=[];for(const s of be(this.measures))for(const o of be(this.measures[s]))for(const a of this.measures[s][o])r.push(a),t.push(o),n.push(s==="*"?null:mh(s));return{type:"aggregate",groupby:[...this.dimensions].map(mh),ops:t,fields:n,as:r}}}class Oy extends Jt{constructor(t,n,r,i){super(t),this.model=n,this.name=r,this.data=i;for(const s of No){const o=n.facet[s];if(o){const{bin:a,sort:u}=o;this[s]=Object.assign({name:n.getName(`${s}_domain`),fields:[ve(o),...ln(a)?[ve(o,{binSuffix:"end"})]:[]]},Du(u)?{sortField:u}:je(u)?{sortIndexField:j0(o,s)}:{})}}this.childModel=n.child}hash(){let t="Facet";for(const n of No)this[n]&&(t+=` ${n.charAt(0)}:${Et(this[n])}`);return t}get fields(){var t;const n=[];for(const r of No)!((t=this[r])===null||t===void 0)&&t.fields&&n.push(...this[r].fields);return n}dependentFields(){const t=new Set(this.fields);for(const n of No)this[n]&&(this[n].sortField&&t.add(this[n].sortField.field),this[n].sortIndexField&&t.add(this[n].sortIndexField));return t}producedFields(){return new Set}getSource(){return this.name}getChildIndependentFieldsWithStep(){const t={};for(const n of Vo){const r=this.childModel.component.scales[n];if(r&&!r.merged){const i=r.get("type"),s=r.get("range");if(Ms(i)&&Kh(s)){const o=TF(this.childModel,n),a=vW(o);a?t[n]=a:pe(`Unknown field for ${n}. Cannot calculate view size.`)}}}return t}assembleRowColumnHeaderData(t,n,r){const i={row:"y",column:"x"}[t],s=[],o=[],a=[];r&&r[i]&&(n?(s.push(`distinct_${r[i]}`),o.push("max")):(s.push(r[i]),o.push("distinct")),a.push(`distinct_${r[i]}`));const{sortField:u,sortIndexField:l}=this[t];if(u){const{op:c=hF,field:f}=u;s.push(f),o.push(c),a.push(ve(u,{forAs:!0}))}else l&&(s.push(l),o.push("max"),a.push(l));return{name:this[t].name,source:n??this.data,transform:[Object.assign({type:"aggregate",groupby:this[t].fields},s.length?{fields:s,ops:o,as:a}:{})]}}assembleFacetHeaderData(t){var n,r;const{columns:i}=this.model.layout,{layoutHeaders:s}=this.model.component,o=[],a={};for(const c of pW){for(const f of gW){const h=(n=s[c]&&s[c][f])!==null&&n!==void 0?n:[];for(const d of h)if(((r=d.axes)===null||r===void 0?void 0:r.length)>0){a[c]=!0;break}}if(a[c]){const f=`length(data("${this.facet.name}"))`,h=c==="row"?i?{signal:`ceil(${f} / ${i})`}:1:i?{signal:`min(${f}, ${i})`}:{signal:f};o.push({name:`${this.facet.name}_${c}`,transform:[{type:"sequence",start:0,stop:h}]})}}const{row:u,column:l}=a;return(u||l)&&o.unshift(this.assembleRowColumnHeaderData("facet",null,t)),o}assemble(){var t,n;const r=[];let i=null;const s=this.getChildIndependentFieldsWithStep(),{column:o,row:a,facet:u}=this;if(o&&a&&(s.x||s.y)){i=`cross_${this.column.name}_${this.row.name}`;const l=[].concat((t=s.x)!==null&&t!==void 0?t:[],(n=s.y)!==null&&n!==void 0?n:[]),c=l.map(()=>"distinct");r.push({name:i,source:this.data,transform:[{type:"aggregate",groupby:this.fields,fields:l,ops:c}]})}for(const l of[rc,nc])this[l]&&r.push(this.assembleRowColumnHeaderData(l,i,s));if(u){const l=this.assembleFacetHeaderData(s);l&&r.push(...l)}return r}}function YJ(e){return e[0]==="'"&&e[e.length-1]==="'"||e[0]==='"'&&e[e.length-1]==='"'?e.slice(1,-1):e}function jRt(e,t){const n=Rye(e);if(t==="number")return`toNumber(${n})`;if(t==="boolean")return`toBoolean(${n})`;if(t==="string")return`toString(${n})`;if(t==="date")return`toDate(${n})`;if(t==="flatten")return n;if(t.indexOf("date:")===0){const r=YJ(t.slice(5,t.length));return`timeParse(${n},'${r}')`}else if(t.indexOf("utc:")===0){const r=YJ(t.slice(4,t.length));return`utcParse(${n},'${r}')`}else return pe(xIt(t)),null}function WRt(e){const t={};return $k(e.filter,n=>{var r;if(bbe(n)){let i=null;Ij(n)?i=n.equal:Dj(n)?i=n.range[0]:Nj(n)&&(i=((r=n.oneOf)!==null&&r!==void 0?r:n.in)[0]),i&&(Ty(i)?t[n.field]="date":Zn(i)?t[n.field]="number":ft(i)&&(t[n.field]="string")),n.timeUnit&&(t[n.field]="date")}}),t}function VRt(e){const t={};function n(r){mF(r)?t[r.field]="date":r.type==="quantitative"&&WTt(r.aggregate)?t[r.field]="number":c2(r.field)>1?r.field in t||(t[r.field]="flatten"):Vj(r)&&Du(r.sort)&&c2(r.sort.field)>1&&(r.sort.field in t||(t[r.sort.field]="flatten"))}if((In(e)||Aa(e))&&e.forEachFieldDef((r,i)=>{if(lo(r))n(r);else{const s=Vg(i),o=e.fieldDef(s);n(Object.assign(Object.assign({},r),{type:o.type}))}}),In(e)){const{mark:r,markDef:i,encoding:s}=e;if(Ug(r)&&!e.encoding.order){const o=i.orient==="horizontal"?"y":"x",a=s[o];ke(a)&&a.type==="quantitative"&&!(a.field in t)&&(t[a.field]="number")}}return t}function GRt(e){const t={};if(In(e)&&e.component.selection)for(const n of be(e.component.selection)){const r=e.component.selection[n];for(const i of r.project.items)!i.channel&&c2(i.field)>1&&(t[i.field]="flatten")}return t}class vi extends Jt{constructor(t,n){super(t),this._parse=n}clone(){return new vi(null,ht(this._parse))}hash(){return`Parse ${Et(this._parse)}`}static makeExplicit(t,n,r){let i={};const s=n.data;return!fp(s)&&s&&s.format&&s.format.parse&&(i=s.format.parse),this.makeWithAncestors(t,i,{},r)}static makeWithAncestors(t,n,r,i){for(const a of be(r)){const u=i.getWithExplicit(a);u.value!==void 0&&(u.explicit||u.value===r[a]||u.value==="derived"||r[a]==="flatten"?delete r[a]:pe(oJ(a,r[a],u.value)))}for(const a of be(n)){const u=i.get(a);u!==void 0&&(u===n[a]?delete n[a]:pe(oJ(a,n[a],u)))}const s=new Mc(n,r);i.copyAll(s);const o={};for(const a of be(s.combine())){const u=s.get(a);u!==null&&(o[a]=u)}return be(o).length===0||i.parseNothing?null:new vi(t,o)}get parse(){return this._parse}merge(t){this._parse=Object.assign(Object.assign({},this._parse),t.parse),t.remove()}assembleFormatParse(){const t={};for(const n of be(this._parse)){const r=this._parse[n];c2(n)===1&&(t[n]=r)}return t}producedFields(){return new Set(be(this._parse))}dependentFields(){return new Set(be(this._parse))}assembleTransforms(t=!1){return be(this._parse).filter(n=>t?c2(n)>1:!0).map(n=>{const r=jRt(n,this._parse[n]);return r?{type:"formula",expr:r,as:Mye(n)}:null}).filter(n=>n!==null)}}class $h extends Jt{clone(){return new $h(null)}constructor(t){super(t)}dependentFields(){return new Set}producedFields(){return new Set([B0])}hash(){return"Identifier"}assemble(){return{type:"identifier",as:B0}}}class qg extends Jt{constructor(t,n){super(t),this.transform=n}clone(){return new qg(null,ht(this.transform))}addDimensions(t){this.transform.groupby=bf(this.transform.groupby.concat(t),n=>n)}dependentFields(){const t=new Set;return this.transform.groupby&&this.transform.groupby.forEach(t.add,t),this.transform.joinaggregate.map(n=>n.field).filter(n=>n!==void 0).forEach(t.add,t),t}producedFields(){return new Set(this.transform.joinaggregate.map(this.getDefaultName))}getDefaultName(t){var n;return(n=t.as)!==null&&n!==void 0?n:ve(t)}hash(){return`JoinAggregateTransform ${Et(this.transform)}`}assemble(){const t=[],n=[],r=[];for(const s of this.transform.joinaggregate)n.push(s.op),r.push(this.getDefaultName(s)),t.push(s.field===void 0?null:s.field);const i=this.transform.groupby;return Object.assign({type:"joinaggregate",as:r,ops:n,fields:t},i!==void 0?{groupby:i}:{})}}function HRt(e){return e.stack.stackBy.reduce((t,n)=>{const r=n.fieldDef,i=ve(r);return i&&t.push(i),t},[])}function qRt(e){return je(e)&&e.every(t=>ft(t))&&e.length>1}class sc extends Jt{constructor(t,n){super(t),this._stack=n}clone(){return new sc(null,ht(this._stack))}static makeFromTransform(t,n){const{stack:r,groupby:i,as:s,offset:o="zero"}=n,a=[],u=[];if(n.sort!==void 0)for(const f of n.sort)a.push(f.field),u.push(Jn(f.order,"ascending"));const l={field:a,order:u};let c;return qRt(s)?c=s:ft(s)?c=[s,s+"_end"]:c=[n.stack+"_start",n.stack+"_end"],new sc(t,{stackField:r,groupby:i,offset:o,sort:l,facetby:[],as:c})}static makeFromEncoding(t,n){const r=n.stack,{encoding:i}=n;if(!r)return null;const{groupbyChannel:s,fieldChannel:o,offset:a,impute:u}=r;let l;if(s){const d=i[s];l=Xu(d)}const c=HRt(n),f=n.encoding.order;let h;return je(f)||ke(f)?h=Kbe(f):h=c.reduce((d,p)=>(d.field.push(p),d.order.push(o==="y"?"descending":"ascending"),d),{field:[],order:[]}),new sc(t,{dimensionFieldDef:l,stackField:n.vgField(o),facetby:[],stackby:c,sort:h,offset:a,impute:u,as:[n.vgField(o,{suffix:"start",forAs:!0}),n.vgField(o,{suffix:"end",forAs:!0})]})}get stack(){return this._stack}addDimensions(t){this._stack.facetby.push(...t)}dependentFields(){const t=new Set;return t.add(this._stack.stackField),this.getGroupbyFields().forEach(t.add,t),this._stack.facetby.forEach(t.add,t),this._stack.sort.field.forEach(t.add,t),t}producedFields(){return new Set(this._stack.as)}hash(){return`Stack ${Et(this._stack)}`}getGroupbyFields(){const{dimensionFieldDef:t,impute:n,groupby:r}=this._stack;return t?t.bin?n?[ve(t,{binSuffix:"mid"})]:[ve(t,{}),ve(t,{binSuffix:"end"})]:[ve(t)]:r??[]}assemble(){const t=[],{facetby:n,dimensionFieldDef:r,stackField:i,stackby:s,sort:o,offset:a,impute:u,as:l}=this._stack;if(u&&r){const{band:c=.5,bin:f}=r;f&&t.push({type:"formula",expr:`${c}*`+ve(r,{expr:"datum"})+`+${1-c}*`+ve(r,{expr:"datum",binSuffix:"end"}),as:ve(r,{binSuffix:"mid",forAs:!0})}),t.push({type:"impute",field:i,groupby:[...s,...n],key:ve(r,{binSuffix:"mid"}),method:"value",value:0})}return t.push({type:"stack",groupby:[...this.getGroupbyFields(),...n],field:i,sort:o,as:l,offset:a}),t}}class Ry extends Jt{constructor(t,n){super(t),this.transform=n}clone(){return new Ry(null,ht(this.transform))}addDimensions(t){this.transform.groupby=bf(this.transform.groupby.concat(t),n=>n)}dependentFields(){var t,n;const r=new Set;return((t=this.transform.groupby)!==null&&t!==void 0?t:[]).forEach(r.add,r),((n=this.transform.sort)!==null&&n!==void 0?n:[]).forEach(i=>r.add(i.field)),this.transform.window.map(i=>i.field).filter(i=>i!==void 0).forEach(r.add,r),r}producedFields(){return new Set(this.transform.window.map(this.getDefaultName))}getDefaultName(t){var n;return(n=t.as)!==null&&n!==void 0?n:ve(t)}hash(){return`WindowTransform ${Et(this.transform)}`}assemble(){var t;const n=[],r=[],i=[],s=[];for(const h of this.transform.window)r.push(h.op),i.push(this.getDefaultName(h)),s.push(h.param===void 0?null:h.param),n.push(h.field===void 0?null:h.field);const o=this.transform.frame,a=this.transform.groupby;if(o&&o[0]===null&&o[1]===null&&r.every(h=>vj(h)))return Object.assign({type:"joinaggregate",as:i,ops:r,fields:n},a!==void 0?{groupby:a}:{});const u=[],l=[];if(this.transform.sort!==void 0)for(const h of this.transform.sort)u.push(h.field),l.push((t=h.order)!==null&&t!==void 0?t:"ascending");const c={field:u,order:l},f=this.transform.ignorePeers;return Object.assign(Object.assign(Object.assign({type:"window",params:s,as:i,ops:r,fields:n,sort:c},f!==void 0?{ignorePeers:f}:{}),a!==void 0?{groupby:a}:{}),o!==void 0?{frame:o}:{})}}class XRt extends Lc{run(t){const n=t.parent;if(t instanceof vi){if(AF(n))return this.flags;if(n.numChildren()>1)return this.setContinue(),this.flags;if(n instanceof vi)this.setMutated(),n.merge(t);else{if(Fye(n.producedFields(),t.dependentFields()))return this.setContinue(),this.flags;this.setMutated(),t.swapWithParent()}}return this.setContinue(),this.flags}}class YRt extends xW{mergeNodes(t,n){const r=n.shift();for(const i of n)t.removeChild(i),i.parent=r,i.remove()}run(t){const n=t.children.map(i=>i.hash()),r={};for(let i=0;i<n.length;i++)r[n[i]]===void 0?r[n[i]]=[t.children[i]]:r[n[i]].push(t.children[i]);for(const i of be(r))r[i].length>1&&(this.setMutated(),this.mergeNodes(t,r[i]));for(const i of t.children)this.run(i);return this.mutatedFlag}}class KRt extends Lc{run(t){return t instanceof Hi||t.numChildren()>0||t instanceof Oy?this.flags:(this.setMutated(),t.remove(),this.flags)}}class ZRt extends Lc{constructor(){super(...arguments),this.fields=new Set,this.prev=null}run(t){if(this.setContinue(),t instanceof Nu){const n=t.producedFields();Nye(n,this.fields)?(this.setMutated(),this.prev.remove()):this.fields=new Set([...this.fields,...n]),this.prev=t}return this.flags}reset(){this.fields.clear()}}class JRt extends Lc{run(t){this.setContinue();const r=t.parent.children.filter(s=>s instanceof Nu),i=r.pop();for(const s of r)this.setMutated(),i.merge(s);return this.flags}}function QRt(e){function t(n){if(!(n instanceof Oy)){const r=n.clone();if(r instanceof Hi){const i=vP+r.getSource();r.setSource(i),e.model.component.data.outputNodes[i]=r}else(r instanceof _a||r instanceof sc||r instanceof Ry||r instanceof qg)&&r.addDimensions(e.fields);for(const i of n.children.flatMap(t))i.parent=r;return[r]}return n.children.flatMap(t)}return t}function xP(e){if(e instanceof Oy)if(e.numChildren()===1&&!(e.children[0]instanceof Hi)){const t=e.children[0];(t instanceof _a||t instanceof sc||t instanceof Ry||t instanceof qg)&&t.addDimensions(e.fields),t.swapWithParent(),xP(e)}else{const t=e.model.component.data.main;$ve(t);const n=QRt(e),r=e.children.map(n).flat();for(const i of r)i.parent=t}else e.children.map(xP)}function $ve(e){if(e instanceof Hi&&e.type===ci&&e.numChildren()===1){const t=e.children[0];t instanceof Oy||(t.swapWithParent(),$ve(e))}}class eMt extends xW{constructor(){super()}run(t){t instanceof Hi&&!t.isRequired()&&(this.setMutated(),t.remove());for(const n of t.children)this.run(n);return this.mutatedFlag}}class tMt extends xW{constructor(t){super(),this.requiresSelectionId=t&&cW(t)}run(t){t instanceof $h&&(this.requiresSelectionId&&(AF(t.parent)||t.parent instanceof _a||t.parent instanceof vi)||(this.setMutated(),t.remove()));for(const n of t.children)this.run(n);return this.mutatedFlag}}class nMt extends Lc{run(t){const n=t.parent,r=[...n.children],i=n.children.filter(s=>s instanceof vi);if(n.numChildren()>1&&i.length>=1){const s={},o=new Set;for(const a of i){const u=a.parse;for(const l of be(u))l in s?s[l]!==u[l]&&o.add(l):s[l]=u[l]}for(const a of o)delete s[a];if(!tn(s)){this.setMutated();const a=new vi(n,s);for(const u of r){if(u instanceof vi)for(const l of be(s))delete u.parse[l];n.removeChild(u),u.parent=a,u instanceof vi&&be(u.parse).length===0&&u.remove()}}}return this.setContinue(),this.flags}}class rMt extends Lc{run(t){const n=t.parent,r=n.children.filter(s=>s instanceof _a),i={};for(const s of r){const o=Et(s.groupBy);o in i||(i[o]=[]),i[o].push(s)}for(const s of be(i)){const o=i[s];if(o.length>1){const a=o.pop();for(const u of o)a.merge(u)&&(n.removeChild(u),u.parent=a,u.remove(),this.setMutated())}}return this.setContinue(),this.flags}}class iMt extends Lc{constructor(t){super(),this.model=t}run(t){const n=t.parent,r=!(AF(n)||n instanceof Fy||n instanceof vi||n instanceof $h),i=[],s=[];for(const o of n.children)o instanceof Fu&&(r&&!Fye(n.producedFields(),o.dependentFields())?i.push(o):s.push(o));if(i.length>0){const o=i.pop();for(const a of i)o.merge(a,this.model.renameSignal.bind(this.model));this.setMutated(),n instanceof Fu?n.merge(o,this.model.renameSignal.bind(this.model)):o.swapWithParent()}if(s.length>1){const o=s.pop();for(const a of s)o.merge(a,this.model.renameSignal.bind(this.model));this.setMutated()}return this.setContinue(),this.flags}}class sMt extends Lc{run(t){const n=t.parent,r=[...n.children];if(!l2(r,a=>a instanceof Hi)||n.numChildren()<=1)return this.setContinue(),this.flags;const s=[];let o;for(const a of r)if(a instanceof Hi){let u=a;for(;u.numChildren()===1;){const l=u.children[0];if(l instanceof Hi)u=l;else break}s.push(...u.children),o?(n.removeChild(a),a.parent=o.parent,o.parent.removeChild(o),o.parent=u,this.setMutated()):o=u}else s.push(a);if(s.length){this.setMutated();for(const a of s)a.parent.removeChild(a),a.parent=o}return this.setContinue(),this.flags}}const vP="scale_",NS=5;function jc(e){const t=[];function n(r){if(r.numChildren()===0)t.push(r);else for(const i of r.children)n(i)}for(const r of e)n(r);return t}function oMt(e){return e}function ta(e,t){return t.map(r=>{if(e instanceof Lc){const i=e.optimizeNextFromLeaves(r);return e.reset(),i}else return e.run(r)}).some(oMt)}function KJ(e,t){let n=e.sources;const r=new Set;return r.add(ta(new eMt,n)),r.add(ta(new tMt(t),n)),n=n.filter(i=>i.numChildren()>0),r.add(ta(new KRt,jc(n))),n=n.filter(i=>i.numChildren()>0),r.add(ta(new XRt,jc(n))),r.add(ta(new iMt(t),jc(n))),r.add(ta(new ZRt,jc(n))),r.add(ta(new nMt,jc(n))),r.add(ta(new rMt,jc(n))),r.add(ta(new JRt,jc(n))),r.add(ta(new YRt,n)),r.add(ta(new sMt,jc(n))),e.sources=n,r.has(!0)}function aMt(e,t){bP(e.sources);let n=0,r=0;for(let i=0;i<NS&&KJ(e,t);i++)n++;e.sources.map(xP);for(let i=0;i<NS&&KJ(e,t);i++)r++;bP(e.sources),Math.max(n,r)===NS&&pe(`Maximum optimization runs(${NS}) reached.`)}class to{constructor(t){Object.defineProperty(this,"signal",{enumerable:!0,get:t})}static fromName(t,n){return new to(()=>t(n))}}function Cve(e){In(e)?uMt(e):lMt(e)}function uMt(e){const t=e.component.scales;for(const n of be(t)){const r=fMt(e,n);if(t[n].setWithExplicit("domains",r),dMt(e,n),e.component.data.isFaceted){let s=e;for(;!Aa(s)&&s.parent;)s=s.parent;if(s.component.resolve.scale[n]==="shared")for(const a of r.value)xf(a)&&(a.data=vP+a.data.replace(vP,""))}}}function lMt(e){for(const n of e.children)Cve(n);const t=e.component.scales;for(const n of be(t)){let r,i=null;for(const s of e.children){const o=s.component.scales[n];if(o){r===void 0?r=o.getWithExplicit("domains"):r=xh(r,o.getWithExplicit("domains"),"domains","scale",wP);const a=o.get("selectionExtent");i&&a&&i.selection!==a.selection&&pe("The same selection must be used to override scale domains in a layered view."),i=a}}t[n].setWithExplicit("domains",r),i&&t[n].set("selectionExtent",i,!0)}}function cMt(e,t,n,r){if(e==="unaggregated"){const{valid:i,reason:s}=ZJ(t,n);if(!i){pe(s);return}}else if(e===void 0&&r.useUnaggregatedDomain){const{valid:i}=ZJ(t,n);if(i)return"unaggregated"}return e}function fMt(e,t){const n=e.getScaleComponent(t).get("type"),{encoding:r}=e,i=cMt(e.scaleDomain(t),e.typedFieldDef(t),n,e.config.scale);return i!==e.scaleDomain(t)&&(e.specifiedScales[t]=Object.assign(Object.assign({},e.specifiedScales[t]),{domain:i})),t==="x"&&ur(r.x2)?ur(r.x)?xh(Gc(n,i,e,"x"),Gc(n,i,e,"x2"),"domain","scale",wP):Gc(n,i,e,"x2"):t==="y"&&ur(r.y2)?ur(r.y)?xh(Gc(n,i,e,"y"),Gc(n,i,e,"y2"),"domain","scale",wP):Gc(n,i,e,"y2"):Gc(n,i,e,t)}function hMt(e,t,n){return e.map(r=>({signal:`{data: ${qj(r,{timeUnit:n,type:t})}}`}))}function xR(e,t,n){var r;const i=(r=Qi(n))===null||r===void 0?void 0:r.unit;return t==="temporal"||i?hMt(e,t,i):[e]}function Gc(e,t,n,r){const{encoding:i}=n,s=ur(i[r]),{type:o}=s,a=s.timeUnit;if(qDt(t)){const f=Gc(e,void 0,n,r),h=xR(t.unionWith,o,a);return qd([...f.value,...h])}else{if(Xe(t))return qd([t]);if(t&&t!=="unaggregated"&&!wbe(t))return qd(xR(t,o,a))}const u=n.stack;if(u&&r===u.fieldChannel){if(u.offset==="normalize")return Ws([[0,1]]);const f=n.requestDataName(ci);return Ws([{data:f,field:n.vgField(r,{suffix:"start"})},{data:f,field:n.vgField(r,{suffix:"end"})}])}const l=Yh(r)&&ke(s)?pMt(n,r,e):void 0;if(Zh(s)){const f=xR([s.datum],o,a);return Ws(f)}const c=s;if(t==="unaggregated"){const f=n.requestDataName(ci),{field:h}=s;return Ws([{data:f,field:ve({field:h,aggregate:"min"})},{data:f,field:ve({field:h,aggregate:"max"})}])}else if(ln(c.bin)){if(Ms(e))return Ws(e==="bin-ordinal"?[]:[{data:Q_(l)?n.requestDataName(ci):n.requestDataName(fA),field:n.vgField(r,oC(c,r)?{binSuffix:"range"}:{}),sort:l===!0||!Dr(l)?{field:n.vgField(r,{}),op:"min"}:l}]);{const{bin:f}=c;if(ln(f)){const h=bW(n,c.field,f);return Ws([new to(()=>{const d=n.getSignalName(h);return`[${d}.start, ${d}.stop]`})])}else return Ws([{data:n.requestDataName(ci),field:n.vgField(r,{})}])}}else if(c.timeUnit&&Ve(["time","utc"],e)&&Uj(r,c,In(n)?n.encoding[ml(r)]:void 0,n.stack,n.markDef,n.config)){const f=n.requestDataName(ci);return Ws([{data:f,field:n.vgField(r)},{data:f,field:n.vgField(r,{suffix:"end"})}])}else return Ws(l?[{data:Q_(l)?n.requestDataName(ci):n.requestDataName(fA),field:n.vgField(r),sort:l}]:[{data:n.requestDataName(ci),field:n.vgField(r)}])}function vR(e,t){const{op:n,field:r,order:i}=e;return Object.assign(Object.assign({op:n??(t?"sum":hF)},r?{field:mh(r)}:{}),i?{order:i}:{})}function dMt(e,t){var n;const r=e.component.scales[t],i=e.specifiedScales[t].domain,s=(n=e.fieldDef(t))===null||n===void 0?void 0:n.bin,o=wbe(i)&&i,a=rC(s)&&lF(s.extent)&&s.extent;(o||a)&&r.set("selectionExtent",o??a,!0)}function pMt(e,t,n){if(!Ms(n))return;const r=e.fieldDef(t),i=r.sort;if(Rbe(i))return{op:"min",field:j0(r,t),order:"ascending"};const{stack:s}=e,o=s?[...s.groupbyField?[s.groupbyField]:[],...s.stackBy.map(a=>a.fieldDef.field)]:void 0;if(Du(i)){const a=s&&!Ve(o,i.field);return vR(i,a)}else if(Obe(i)){const{encoding:a,order:u}=i,l=e.fieldDef(a),{aggregate:c,field:f}=l,h=s&&!Ve(o,f);if(yh(c)||jg(c))return vR({field:ve(l),order:u},h);if(vj(c)||!c)return vR({op:c,field:f,order:u},h)}else{if(i==="descending")return{op:"min",field:e.vgField(t),order:"descending"};if(Ve(["ascending",void 0],i))return!0}}function ZJ(e,t){const{aggregate:n,type:r}=e;return n?ft(n)&&!HTt[n]?{valid:!1,reason:PIt(n)}:r==="quantitative"&&t==="log"?{valid:!1,reason:BIt(e)}:{valid:!0}:{valid:!1,reason:LIt(e)}}function wP(e,t,n,r){return e.explicit&&t.explicit&&pe(VIt(n,r,e.value,t.value)),{explicit:e.explicit,value:[...e.value,...t.value]}}function gMt(e){const t=bf(e.map(o=>xf(o)?Be(o,["sort"]):o),Et),n=bf(e.map(o=>{if(xf(o)){const a=o.sort;return a!==void 0&&!Q_(a)&&("op"in a&&a.op==="count"&&delete a.field,a.order==="ascending"&&delete a.order),a}}).filter(o=>o!==void 0),Et);if(t.length===0)return;if(t.length===1){const o=e[0];if(xf(o)&&n.length>0){let a=n[0];if(n.length>1)pe(uJ),a=!0;else if(Dr(a)&&"field"in a){const u=a.field;o.field===u&&(a=a.order?{order:a.order}:!0)}return Object.assign(Object.assign({},o),{sort:a})}return o}const r=bf(n.map(o=>Q_(o)||!("op"in o)||o.op in UTt?o:(pe(HIt(o)),!0)),Et);let i;r.length===1?i=r[0]:r.length>1&&(pe(uJ),i=!0);const s=bf(e.map(o=>xf(o)?o.data:null),o=>o);return s.length===1&&s[0]!==null?Object.assign({data:s[0],fields:t.map(a=>a.field)},i?{sort:i}:{}):Object.assign({fields:t},i?{sort:i}:{})}function vW(e){if(xf(e)&&ft(e.field))return e.field;if(wDt(e)){let t;for(const n of e.fields)if(xf(n)&&ft(n.field)){if(!t)t=n.field;else if(t!==n.field)return pe(qIt),t}return pe(XIt),t}else if($Dt(e)){pe(YIt);const t=e.fields[0];return ft(t)?t:void 0}}function TF(e,t){const r=e.component.scales[t].get("domains").map(i=>(xf(i)&&(i.data=e.lookupDataSource(i.data)),i));return gMt(r)}function Sve(e){return My(e)||wW(e)?e.children.reduce((t,n)=>t.concat(Sve(n)),JJ(e)):JJ(e)}function JJ(e){return be(e.component.scales).reduce((t,n)=>{const r=e.component.scales[n];if(r.merged)return t;const i=r.combine(),{name:s,type:o,selectionExtent:a,domains:u,range:l,reverse:c}=i,f=Be(i,["name","type","selectionExtent","domains","range","reverse"]),h=mMt(i.range,s,n);let d;a&&(d=m3t(e,a));const p=TF(e,n);return t.push(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({name:s,type:o},p?{domain:p}:{}),d?{domainRaw:d}:{}),{range:h}),c!==void 0?{reverse:c}:{}),f)),t},[])}function mMt(e,t,n){return qu(n)&&Kh(e)?{step:{signal:t+"_step"}}:e}class kve extends Mc{constructor(t,n){super({},{name:t}),this.merged=!1,this.setWithExplicit("type",n)}domainDefinitelyIncludesZero(){return this.get("zero")!==!1?!0:l2(this.get("domains"),t=>je(t)&&t.length===2&&t[0]<=0&&t[1]>=0)}}const yMt=["range","scheme"];function Eve(e){return e==="x"?"width":e==="y"?"height":void 0}function bMt(e){const t=e.component.scales;for(const n of uF){const r=t[n];if(!r)continue;const i=xMt(n,e);r.setWithExplicit("range",i)}}function QJ(e,t){const n=e.fieldDef(t);if(n&&n.bin&&ln(n.bin)){const r=bW(e,n.field,n.bin),i=Eve(t),s=e.getName(i);return new to(()=>{const o=e.getSignalName(r),a=`(${o}.stop - ${o}.start) / ${o}.step`;return`${e.getSignalName(s)} / (${a})`})}}function xMt(e,t){const n=t.specifiedScales[e],{size:r}=t,s=t.getScaleComponent(e).get("type");for(const o of yMt)if(n[o]!==void 0){const a=$be(s,o),u=Cbe(e,o);if(!a)pe(sbe(s,o,e));else if(u)pe(u);else switch(o){case"range":return je(n.range)&&qu(e)?qd(n.range.map(l=>{if(l==="width"||l==="height"){const c=t.getName(l),f=t.getSignalName.bind(t);return to.fromName(f,c)}return l})):qd(n.range);case"scheme":return qd(vMt(n[o]))}}if(e===_n||e===fr){const o=e===_n?"width":"height",a=r[o];if(Yu(a)){if(Ms(s))return qd({step:a.step});pe(obe(o))}}return Ws(wMt(e,t))}function vMt(e){return HDt(e)?Object.assign({scheme:e.name},tc(e,["name"])):{scheme:e}}function wMt(e,t){const{size:n,config:r,mark:i,encoding:s}=t,o=t.getSignalName.bind(t),{type:a}=ur(s[e]),l=t.getScaleComponent(e).get("type"),{domain:c,domainMid:f}=t.specifiedScales[e];switch(e){case _n:case fr:{if(Ve(["point","band"],l)){if(e===_n&&!n.width){const p=d2(r.view,"width");if(Yu(p))return p}else if(e===fr&&!n.height){const p=d2(r.view,"height");if(Yu(p))return p}}const h=Eve(e),d=t.getName(h);return e===fr&&Go(l)?[to.fromName(o,d),0]:[0,to.fromName(o,d)]}case Oc:{const h=t.component.scales[e].get("zero"),d=_ve(i,h,r),p=SMt(i,n,t,r);return rA(l)?CMt(d,p,$Mt(l,r,c,e)):[d,p]}case Ya:return[0,Math.PI*2];case Wg:return[0,360];case fl:return[0,new to(()=>{const h=t.getSignalName("width"),d=t.getSignalName("height");return`min(${h},${d})/2`})];case Hh:return[r.scale.minStrokeWidth,r.scale.maxStrokeWidth];case qh:return[[1,0],[4,2],[2,1],[1,1],[1,2,4,2]];case Rs:return"symbol";case Os:case pl:case gl:return l==="ordinal"?a==="nominal"?"category":"ordinal":f!==void 0?"diverging":i==="rect"||i==="geoshape"?"heatmap":"ramp";case Rc:case Vh:case Gh:return[r.scale.minOpacity,r.scale.maxOpacity]}throw new Error(`Scale range undefined for channel ${e}`)}function $Mt(e,t,n,r){switch(e){case"quantile":return t.scale.quantileCount;case"quantize":return t.scale.quantizeCount;case"threshold":return n!==void 0&&je(n)?n.length+1:(pe(iDt(r)),3)}}function CMt(e,t,n){const r=()=>{const i=h2(t),s=h2(e),o=`(${i} - ${s}) / (${n} - 1)`;return`sequence(${s}, ${i} + ${o}, ${o})`};return Xe(t)?new to(r):{signal:r()}}function _ve(e,t,n){if(t)return Xe(t)?{signal:`${t.signal} ? 0 : ${_ve(e,!1,n)}`}:0;switch(e){case"bar":case"tick":return n.scale.minBandSize;case"line":case"trail":case"rule":return n.scale.minStrokeWidth;case"text":return n.scale.minFontSize;case"point":case"square":case"circle":return n.scale.minSize}throw new Error(cF("size",e))}const eQ=.95;function SMt(e,t,n,r){const i={x:QJ(n,"x"),y:QJ(n,"y")};switch(e){case"bar":case"tick":{if(r.scale.maxBandSize!==void 0)return r.scale.maxBandSize;const s=tQ(t,i,r.view);return Zn(s)?s-1:new to(()=>`${s.signal} - 1`)}case"line":case"trail":case"rule":return r.scale.maxStrokeWidth;case"text":return r.scale.maxFontSize;case"point":case"square":case"circle":{if(r.scale.maxSize)return r.scale.maxSize;const s=tQ(t,i,r.view);return Zn(s)?Math.pow(eQ*s,2):new to(()=>`pow(${eQ} * ${s.signal}, 2)`)}}throw new Error(cF("size",e))}function tQ(e,t,n){const r=Yu(e.width)?e.width.step:lA(n,"width"),i=Yu(e.height)?e.height.step:lA(n,"height");return t.x||t.y?new to(()=>`min(${[t.x?t.x.signal:r,t.y?t.y.signal:i].join(", ")})`):Math.min(r,i)}function Ave(e,t){In(e)?kMt(e,t):Ive(e,t)}function kMt(e,t){const n=e.component.scales,{config:r,encoding:i,markDef:s,specifiedScales:o}=e;for(const a of be(n)){const u=o[a],l=n[a],c=e.getScaleComponent(a),f=ur(i[a]),h=u[t],d=c.get("type"),p=c.get("padding"),g=c.get("paddingInner"),m=$be(d,t),y=Cbe(a,t);if(h!==void 0&&(m?y&&pe(y):pe(sbe(d,t,a))),m&&y===void 0)if(h!==void 0)l.copyKeyFromObject(t,u);else{const b=t in nQ?nQ[t]({model:e,channel:a,fieldOrDatumDef:f,scaleType:d,scalePadding:p,scalePaddingInner:g,domain:u.domain,markDef:s,config:r}):r.scale[t];b!==void 0&&l.set(t,b,!1)}}}const nQ={bins:({model:e,fieldOrDatumDef:t})=>ke(t)?EMt(e,t):void 0,interpolate:({channel:e,fieldOrDatumDef:t})=>_Mt(e,t.type),nice:({scaleType:e,channel:t,fieldOrDatumDef:n})=>AMt(e,t,n),padding:({channel:e,scaleType:t,fieldOrDatumDef:n,markDef:r,config:i})=>TMt(e,t,i.scale,n,r,i.bar),paddingInner:({scalePadding:e,channel:t,markDef:n,config:r})=>IMt(e,t,n.type,r.scale),paddingOuter:({scalePadding:e,channel:t,scaleType:n,markDef:r,scalePaddingInner:i,config:s})=>DMt(e,t,n,r.type,i,s.scale),reverse:({fieldOrDatumDef:e,scaleType:t,channel:n,config:r})=>{const i=ke(e)?e.sort:void 0;return NMt(t,i,n,r.scale)},zero:({channel:e,fieldOrDatumDef:t,domain:n,markDef:r,scaleType:i})=>FMt(e,t,n,r,i)};function Tve(e){In(e)?bMt(e):Ive(e,"range")}function Ive(e,t){const n=e.component.scales;for(const r of e.children)t==="range"?Tve(r):Ave(r,t);for(const r of be(n)){let i;for(const s of e.children){const o=s.component.scales[r];if(o){const a=o.getWithExplicit(t);i=xh(i,a,t,"scale",vxe((u,l)=>{switch(t){case"range":return u.step&&l.step?u.step-l.step:0}return 0}))}}n[r].setWithExplicit(t,i)}}function EMt(e,t){const n=t.bin;if(ln(n)){const r=bW(e,t.field,n);return new to(()=>e.getSignalName(r))}else if(ji(n)&&rC(n)&&n.step!==void 0)return{step:n.step}}function _Mt(e,t){if(Ve([Os,pl,gl],e)&&t!=="nominal")return"hcl"}function AMt(e,t,n){var r;if(!(!((r=Xu(n))===null||r===void 0)&&r.bin||Ve([Vn.TIME,Vn.UTC],e)))return t in Xh?!0:void 0}function TMt(e,t,n,r,i,s){if(e in Xh){if(wa(t)){if(n.continuousPadding!==void 0)return n.continuousPadding;const{type:o,orient:a}=i;if(o==="bar"&&!(ke(r)&&(r.bin||r.timeUnit))&&(a==="vertical"&&e==="x"||a==="horizontal"&&e==="y"))return s.continuousBandSize}if(t===Vn.POINT)return n.pointPadding}}function IMt(e,t,n,r){if(e===void 0&&t in Xh){const{bandPaddingInner:i,barBandPaddingInner:s,rectBandPaddingInner:o}=r;return Jn(i,n==="bar"?s:o)}}function DMt(e,t,n,r,i,s){if(e===void 0&&t in Xh&&n===Vn.BAND){const{bandPaddingOuter:o}=s;return Jn(o,Xe(i)?{signal:`${i.signal}/2`}:i/2)}}function NMt(e,t,n,r){if(n==="x"&&r.xReverse!==void 0)return Go(e)&&t==="descending"?Xe(r.xReverse)?{signal:`!${r.xReverse.signal}`}:!r.xReverse:r.xReverse;if(Go(e)&&t==="descending")return!0}function FMt(e,t,n,r,i){if(!!n&&n!=="unaggregated"&&Go(i)){if(je(n)){const o=n[0],a=n[n.length-1];if(o<=0&&a>=0)return!0}return!1}if(e==="size"&&t.type==="quantitative"&&!rA(i))return!0;if(!(ke(t)&&t.bin)&&Ve([...Vo,...rIt],e)){const{orient:o,type:a}=r;return!(Ve(["bar","area","line","trail"],a)&&(o==="horizontal"&&e==="y"||o==="vertical"&&e==="x"))}return!1}function OMt(e,t,n,r){const i=RMt(t,n,r),{type:s}=e;return Yh(t)?s!==void 0?kbe(t,s)?ke(n)&&!Sbe(s,n.type)?(pe(jIt(s,i)),i):s:(pe(UIt(t,s,i)),i):i:null}function RMt(e,t,n){var r;switch(t.type){case"nominal":case"ordinal":if(Bm(e)||Sk(e)==="discrete")return e==="shape"&&t.type==="ordinal"&&pe(uR(e,"ordinal")),"ordinal";if(e in Xh){if(Ve(["rect","bar","image","rule"],n))return"band"}else if(n==="arc"&&e in Sj)return"band";return t.band!==void 0||Gj(t)&&(!((r=t.axis)===null||r===void 0)&&r.tickBand)?"band":"point";case"temporal":return Bm(e)?"time":Sk(e)==="discrete"?(pe(uR(e,"temporal")),"ordinal"):ke(t)&&t.timeUnit&&Qi(t.timeUnit).utc?"utc":"time";case"quantitative":return Bm(e)?ke(t)&&ln(t.bin)?"bin-ordinal":"linear":Sk(e)==="discrete"?(pe(uR(e,"quantitative")),"ordinal"):"linear";case"geojson":return}throw new Error(rbe(t.type))}function MMt(e,{ignoreRange:t}={}){Dve(e),Cve(e);for(const n of KDt)Ave(e,n);t||Tve(e)}function Dve(e){In(e)?e.component.scales=LMt(e):e.component.scales=BMt(e)}function LMt(e){const{encoding:t,mark:n}=e;return uF.reduce((r,i)=>{const s=ur(t[i]);if(s&&n===Uye&&i===Rs&&s.type===Dy)return r;let o=s&&s.scale;if(s&&o!==null&&o!==!1){o=o??{};const a=OMt(o,i,s,n);r[i]=new kve(e.scaleName(i+"",!0),{value:a,explicit:o.type===a})}return r},{})}const PMt=vxe((e,t)=>cJ(e)-cJ(t));function BMt(e){var t;const n=e.component.scales={},r={},i=e.component.resolve;for(const s of e.children){Dve(s);for(const o of be(s.component.scales))if(i.scale[o]=(t=i.scale[o])!==null&&t!==void 0?t:uRt(o,e),i.scale[o]==="shared"){const a=r[o],u=s.component.scales[o].getWithExplicit("type");a?FDt(a.value,u.value)?r[o]=xh(a,u,"type","scale",PMt):(i.scale[o]="independent",delete r[o]):r[o]=u}}for(const s of be(r)){const o=e.scaleName(s,!0),a=r[s];n[s]=new kve(o,a);for(const u of e.children){const l=u.component.scales[s];l&&(u.renameScale(l.get("name"),o),l.merged=!0)}}return n}class wR{constructor(){this.nameMap={}}rename(t,n){this.nameMap[t]=n}has(t){return this.nameMap[t]!==void 0}get(t){for(;this.nameMap[t]&&t!==this.nameMap[t];)t=this.nameMap[t];return t}}function In(e){return(e==null?void 0:e.type)==="unit"}function Aa(e){return(e==null?void 0:e.type)==="facet"}function wW(e){return(e==null?void 0:e.type)==="concat"}function My(e){return(e==null?void 0:e.type)==="layer"}class $W{constructor(t,n,r,i,s,o,a){var u,l;this.type=n,this.parent=r,this.config=s,this.view=a,this.children=[],this.correctDataNames=c=>(c.from&&c.from.data&&(c.from.data=this.lookupDataSource(c.from.data)),c.from&&c.from.facet&&c.from.facet.data&&(c.from.facet.data=this.lookupDataSource(c.from.facet.data)),c),this.parent=r,this.config=s,this.name=(u=t.name)!==null&&u!==void 0?u:i,this.title=Jc(t.title)?{text:t.title}:t.title,this.scaleNameMap=r?r.scaleNameMap:new wR,this.projectionNameMap=r?r.projectionNameMap:new wR,this.signalNameMap=r?r.signalNameMap:new wR,this.data=t.data,this.description=t.description,this.transforms=jFt((l=t.transform)!==null&&l!==void 0?l:[]),this.layout=n==="layer"||n==="unit"?{}:WNt(t,n,s),this.component={data:{sources:r?r.component.data.sources:[],outputNodes:r?r.component.data.outputNodes:{},outputNodeRefCounts:r?r.component.data.outputNodeRefCounts:{},isFaceted:dF(t)||r&&r.component.data.isFaceted&&t.data===void 0},layoutSize:new Mc,layoutHeaders:{row:{},column:{},facet:{}},mark:null,resolve:Object.assign({scale:{},axis:{},legend:{}},o?ht(o):{}),selection:null,scales:null,projection:null,axes:{},legends:{}}}get width(){return this.getSizeSignalRef("width")}get height(){return this.getSizeSignalRef("height")}parse(){this.parseScale(),this.parseLayoutSize(),this.renameTopLevelLayoutSizeSignal(),this.parseSelections(),this.parseProjection(),this.parseData(),this.parseAxesAndHeaders(),this.parseLegends(),this.parseMarkGroup()}parseScale(){MMt(this)}parseProjection(){xve(this)}renameTopLevelLayoutSizeSignal(){this.getName("width")!=="width"&&this.renameSignal(this.getName("width"),"width"),this.getName("height")!=="height"&&this.renameSignal(this.getName("height"),"height")}parseLegends(){pve(this)}assembleGroupStyle(){var t,n;if(this.type==="unit"||this.type==="layer")return(n=(t=this.view)===null||t===void 0?void 0:t.style)!==null&&n!==void 0?n:"cell"}assembleEncodeFromView(t){const n=Be(t,["style"]),r={};for(const i of be(n)){const s=n[i];s!==void 0&&(r[i]=Bn(s))}return r}assembleGroupEncodeEntry(t){let n={};return this.view&&(n=this.assembleEncodeFromView(this.view)),!t&&(this.description&&(n.description=Bn(this.description)),this.type==="unit"||this.type==="layer")?Object.assign({width:this.getSizeSignalRef("width"),height:this.getSizeSignalRef("height")},n??{}):tn(n)?void 0:n}assembleLayout(){if(!this.layout)return;const t=this.layout,{spacing:n}=t,r=Be(t,["spacing"]),{component:i,config:s}=this,o=aRt(i.layoutHeaders,s);return Object.assign(Object.assign(Object.assign({padding:n},this.assembleDefaultLayout()),r),o?{titleBand:o}:{})}assembleDefaultLayout(){return{}}assembleHeaderMarks(){const{layoutHeaders:t}=this.component;let n=[];for(const r of No)t[r].title&&n.push(tRt(this,r));for(const r of pW)n=n.concat(nRt(this,r));return n}assembleAxes(){return UOt(this.component.axes,this.config)}assembleLegends(){return mve(this)}assembleProjections(){return IRt(this)}assembleTitle(){var t,n,r;const i=(t=this.title)!==null&&t!==void 0?t:{},{encoding:s}=i,o=Be(i,["encoding"]),a=Object.assign(Object.assign(Object.assign({},qbe(this.config.title).nonMark),o),s?{encode:{update:s}}:{});if(a.text)return Ve(["unit","layer"],this.type)?Ve(["middle",void 0],a.anchor)&&(a.frame=(n=a.frame)!==null&&n!==void 0?n:"group"):a.anchor=(r=a.anchor)!==null&&r!==void 0?r:"start",tn(a)?void 0:a}assembleGroup(t=[]){const n={};t=t.concat(this.assembleSignals()),t.length>0&&(n.signals=t);const r=this.assembleLayout();r&&(n.layout=r),n.marks=[].concat(this.assembleHeaderMarks(),this.assembleMarks());const i=!this.parent||Aa(this.parent)?Sve(this):[];i.length>0&&(n.scales=i);const s=this.assembleAxes();s.length>0&&(n.axes=s);const o=this.assembleLegends();return o.length>0&&(n.legends=o),n}getName(t){return wn((this.name?this.name+"_":"")+t)}requestDataName(t){var n;const r=this.getName(t),i=this.component.data.outputNodeRefCounts;return i[r]=((n=i[r])!==null&&n!==void 0?n:0)+1,r}getSizeSignalRef(t){if(Aa(this.parent)){const n=uve(t),r=aF(n),i=this.component.scales[r];if(i&&!i.merged){const s=i.get("type"),o=i.get("range");if(Ms(s)&&Kh(o)){const a=i.get("name"),u=TF(this,r),l=vW(u);if(l){const c=ve({aggregate:"distinct",field:l},{expr:"datum"});return{signal:ave(a,i,c)}}else return pe(`Unknown field for ${r}. Cannot calculate view size.`),null}}}return{signal:this.signalNameMap.get(this.getName(t))}}lookupDataSource(t){const n=this.component.data.outputNodes[t];return n?n.getSource():t}getSignalName(t){return this.signalNameMap.get(t)}renameSignal(t,n){this.signalNameMap.rename(t,n)}renameScale(t,n){this.scaleNameMap.rename(t,n)}renameProjection(t,n){this.projectionNameMap.rename(t,n)}scaleName(t,n){if(n)return this.getName(t);if(Kye(t)&&Yh(t)&&this.component.scales[t]||this.scaleNameMap.has(this.getName(t)))return this.scaleNameMap.get(this.getName(t))}projectionName(t){if(t)return this.getName("projection");if(this.component.projection&&!this.component.projection.merged||this.projectionNameMap.has(this.getName("projection")))return this.projectionNameMap.get(this.getName("projection"))}getScaleComponent(t){if(!this.component.scales)throw new Error("getScaleComponent cannot be called before parseScale(). Make sure you have called parseScale or use parseUnitModelWithScale().");const n=this.component.scales[t];return n&&!n.merged?n:this.parent?this.parent.getScaleComponent(t):void 0}getSelectionComponent(t,n){let r=this.component.selection[t];if(!r&&this.parent&&(r=this.parent.getSelectionComponent(t,n)),!r)throw new Error(dIt(n));return r}hasAxisOrientSignalRef(){var t,n;return((t=this.component.axes.x)===null||t===void 0?void 0:t.some(r=>r.hasOrientSignalRef()))||((n=this.component.axes.y)===null||n===void 0?void 0:n.some(r=>r.hasOrientSignalRef()))}}class Nve extends $W{vgField(t,n={}){const r=this.fieldDef(t);if(r)return ve(r,n)}reduceFieldDef(t,n){return exe(this.getMapping(),(r,i,s)=>{const o=Xu(i);return o?t(r,o,s):r},n)}forEachFieldDef(t,n){Kj(this.getMapping(),(r,i)=>{const s=Xu(r);s&&t(s,i)},n)}}class IF extends Jt{constructor(t,n){var r,i,s;super(t),this.transform=n,this.transform=ht(n);const o=(r=this.transform.as)!==null&&r!==void 0?r:[void 0,void 0];this.transform.as=[(i=o[0])!==null&&i!==void 0?i:"value",(s=o[1])!==null&&s!==void 0?s:"density"]}clone(){return new IF(null,ht(this.transform))}dependentFields(){var t;return new Set([this.transform.density,...(t=this.transform.groupby)!==null&&t!==void 0?t:[]])}producedFields(){return new Set(this.transform.as)}hash(){return`DensityTransform ${Et(this.transform)}`}assemble(){const t=this.transform,{density:n}=t,r=Be(t,["density"]);return Object.assign({type:"kde",field:n},r)}}class b2 extends Jt{constructor(t,n){super(t),this.filter=n}clone(){return new b2(null,Object.assign({},this.filter))}static make(t,n){const{config:r,mark:i,markDef:s}=n;if(Bt("invalid",s,r)!=="filter")return null;const a=n.reduceFieldDef((u,l,c)=>{const f=Yh(c)&&n.getScaleComponent(c);if(f){const h=f.get("type");Go(h)&&l.aggregate!=="count"&&!Ug(i)&&(u[l.field]=l)}return u},{});return be(a).length?new b2(t,a):null}dependentFields(){return new Set(be(this.filter))}producedFields(){return new Set}hash(){return`FilterInvalid ${Et(this.filter)}`}assemble(){const t=be(this.filter).reduce((n,r)=>{const i=this.filter[r],s=ve(i,{expr:"datum"});return i!==null&&(i.type==="temporal"?n.push(`(isDate(${s}) || (isValid(${s}) && isFinite(+${s})))`):i.type==="quantitative"&&(n.push(`isValid(${s})`),n.push(`isFinite(+${s})`))),n},[]);return t.length>0?{type:"filter",expr:t.join(" && ")}:null}}class DF extends Jt{constructor(t,n){super(t),this.transform=n,this.transform=ht(n);const{flatten:r,as:i=[]}=this.transform;this.transform.as=r.map((s,o)=>{var a;return(a=i[o])!==null&&a!==void 0?a:s})}clone(){return new DF(this.parent,ht(this.transform))}dependentFields(){return new Set(this.transform.flatten)}producedFields(){return new Set(this.transform.as)}hash(){return`FlattenTransform ${Et(this.transform)}`}assemble(){const{flatten:t,as:n}=this.transform;return{type:"flatten",fields:t,as:n}}}class NF extends Jt{constructor(t,n){var r,i,s;super(t),this.transform=n,this.transform=ht(n);const o=(r=this.transform.as)!==null&&r!==void 0?r:[void 0,void 0];this.transform.as=[(i=o[0])!==null&&i!==void 0?i:"key",(s=o[1])!==null&&s!==void 0?s:"value"]}clone(){return new NF(null,ht(this.transform))}dependentFields(){return new Set(this.transform.fold)}producedFields(){return new Set(this.transform.as)}hash(){return`FoldTransform ${Et(this.transform)}`}assemble(){const{fold:t,as:n}=this.transform;return{type:"fold",fields:t,as:n}}}class zm extends Jt{constructor(t,n,r,i){super(t),this.fields=n,this.geojson=r,this.signal=i}clone(){return new zm(null,ht(this.fields),this.geojson,this.signal)}static parseAll(t,n){if(n.component.projection&&!n.component.projection.isFit)return t;let r=0;for(const i of[[dl,hl],[Wo,Ka]]){const s=i.map(o=>{const a=ur(n.encoding[o]);return ke(a)?a.field:Zh(a)?{expr:`${a.datum}`}:yc(a)?{expr:`${a.value}`}:void 0});(s[0]||s[1])&&(t=new zm(t,s,null,n.getName(`geojson_${r++}`)))}if(n.channelHasField(Rs)){const i=n.typedFieldDef(Rs);i.type===Dy&&(t=new zm(t,null,i.field,n.getName(`geojson_${r++}`)))}return t}dependentFields(){var t;const n=((t=this.fields)!==null&&t!==void 0?t:[]).filter(ft);return new Set([...this.geojson?[this.geojson]:[],...n])}producedFields(){return new Set}hash(){return`GeoJSON ${this.geojson} ${this.signal} ${Et(this.fields)}`}assemble(){return Object.assign(Object.assign(Object.assign({type:"geojson"},this.fields?{fields:this.fields}:{}),this.geojson?{geojson:this.geojson}:{}),{signal:this.signal})}}class x2 extends Jt{constructor(t,n,r,i){super(t),this.projection=n,this.fields=r,this.as=i}clone(){return new x2(null,this.projection,ht(this.fields),ht(this.as))}static parseAll(t,n){if(!n.projectionName())return t;for(const r of[[dl,hl],[Wo,Ka]]){const i=r.map(o=>{const a=ur(n.encoding[o]);return ke(a)?a.field:Zh(a)?{expr:`${a.datum}`}:yc(a)?{expr:`${a.value}`}:void 0}),s=r[0]===Wo?"2":"";(i[0]||i[1])&&(t=new x2(t,n.projectionName(),i,[n.getName("x"+s),n.getName("y"+s)]))}return t}dependentFields(){return new Set(this.fields.filter(ft))}producedFields(){return new Set(this.as)}hash(){return`Geopoint ${this.projection} ${Et(this.fields)} ${Et(this.as)}`}assemble(){return{type:"geopoint",projection:this.projection,fields:this.fields,as:this.as}}}class hp extends Jt{constructor(t,n){super(t),this.transform=n}clone(){return new hp(null,ht(this.transform))}dependentFields(){var t;return new Set([this.transform.impute,this.transform.key,...(t=this.transform.groupby)!==null&&t!==void 0?t:[]])}producedFields(){return new Set([this.transform.impute])}processSequence(t){const{start:n=0,stop:r,step:i}=t;return{signal:`sequence(${[n,r,...i?[i]:[]].join(",")})`}}static makeFromTransform(t,n){return new hp(t,n)}static makeFromEncoding(t,n){const r=n.encoding,i=r.x,s=r.y;if(ke(i)&&ke(s)){const o=i.impute?i:s.impute?s:void 0;if(o===void 0)return;const a=i.impute?s:s.impute?i:void 0,{method:u,value:l,frame:c,keyvals:f}=o.impute,h=txe(n.mark,r);return new hp(t,Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({impute:o.field,key:a.field},u?{method:u}:{}),l!==void 0?{value:l}:{}),c?{frame:c}:{}),f!==void 0?{keyvals:f}:{}),h.length?{groupby:h}:{}))}return null}hash(){return`Impute ${Et(this.transform)}`}assemble(){const{impute:t,key:n,keyvals:r,method:i,groupby:s,value:o,frame:a=[null,null]}=this.transform,u=Object.assign(Object.assign(Object.assign(Object.assign({type:"impute",field:t,key:n},r?{keyvals:$Ft(r)?this.processSequence(r):r}:{}),{method:"value"}),s?{groupby:s}:{}),{value:!i||i==="value"?o:null});if(i&&i!=="value"){const l=Object.assign({type:"window",as:[`imputed_${t}_value`],ops:[i],fields:[t],frame:a,ignorePeers:!1},s?{groupby:s}:{}),c={type:"formula",expr:`datum.${t} === null ? datum.imputed_${t}_value : datum.${t}`,as:t};return[u,l,c]}else return[u]}}class FF extends Jt{constructor(t,n){var r,i,s;super(t),this.transform=n,this.transform=ht(n);const o=(r=this.transform.as)!==null&&r!==void 0?r:[void 0,void 0];this.transform.as=[(i=o[0])!==null&&i!==void 0?i:n.on,(s=o[1])!==null&&s!==void 0?s:n.loess]}clone(){return new FF(null,ht(this.transform))}dependentFields(){var t;return new Set([this.transform.loess,this.transform.on,...(t=this.transform.groupby)!==null&&t!==void 0?t:[]])}producedFields(){return new Set(this.transform.as)}hash(){return`LoessTransform ${Et(this.transform)}`}assemble(){const t=this.transform,{loess:n,on:r}=t,i=Be(t,["loess","on"]);return Object.assign({type:"loess",x:r,y:n},i)}}class v2 extends Jt{constructor(t,n,r){super(t),this.transform=n,this.secondary=r}clone(){return new v2(null,ht(this.transform),this.secondary)}static make(t,n,r,i){const s=n.component.data.sources,{from:o}=r;let a=null;if(SFt(o)){let u=Rve(o.data,s);u||(u=new V0(o.data),s.push(u));const l=n.getName(`lookup_${i}`);a=new Hi(u,l,"lookup",n.component.data.outputNodeRefCounts),n.component.data.outputNodes[l]=a}else if(kFt(o)){const u=o.selection;if(r=Object.assign({as:u},r),a=n.getSelectionComponent(wn(u),u).materialized,!a)throw new Error(mIt(u))}return new v2(t,r,a.getSource())}dependentFields(){return new Set([this.transform.lookup])}producedFields(){return new Set(this.transform.as?jn(this.transform.as):this.transform.from.fields)}hash(){return`Lookup ${Et({transform:this.transform,secondary:this.secondary})}`}assemble(){let t;if(this.transform.from.fields)t=Object.assign({values:this.transform.from.fields},this.transform.as?{as:jn(this.transform.as)}:{});else{let n=this.transform.as;ft(n)||(pe(wIt),n="_lookup"),t={as:[n]}}return Object.assign(Object.assign({type:"lookup",from:this.secondary,key:this.transform.from.key,fields:[this.transform.lookup]},t),this.transform.default?{default:this.transform.default}:{})}}class OF extends Jt{constructor(t,n){var r,i,s;super(t),this.transform=n,this.transform=ht(n);const o=(r=this.transform.as)!==null&&r!==void 0?r:[void 0,void 0];this.transform.as=[(i=o[0])!==null&&i!==void 0?i:"prob",(s=o[1])!==null&&s!==void 0?s:"value"]}clone(){return new OF(null,ht(this.transform))}dependentFields(){var t;return new Set([this.transform.quantile,...(t=this.transform.groupby)!==null&&t!==void 0?t:[]])}producedFields(){return new Set(this.transform.as)}hash(){return`QuantileTransform ${Et(this.transform)}`}assemble(){const t=this.transform,{quantile:n}=t,r=Be(t,["quantile"]);return Object.assign({type:"quantile",field:n},r)}}class RF extends Jt{constructor(t,n){var r,i,s;super(t),this.transform=n,this.transform=ht(n);const o=(r=this.transform.as)!==null&&r!==void 0?r:[void 0,void 0];this.transform.as=[(i=o[0])!==null&&i!==void 0?i:n.on,(s=o[1])!==null&&s!==void 0?s:n.regression]}clone(){return new RF(null,ht(this.transform))}dependentFields(){var t;return new Set([this.transform.regression,this.transform.on,...(t=this.transform.groupby)!==null&&t!==void 0?t:[]])}producedFields(){return new Set(this.transform.as)}hash(){return`RegressionTransform ${Et(this.transform)}`}assemble(){const t=this.transform,{regression:n,on:r}=t,i=Be(t,["regression","on"]);return Object.assign({type:"regression",x:r,y:n},i)}}class MF extends Jt{constructor(t,n){super(t),this.transform=n}clone(){return new MF(null,ht(this.transform))}addDimensions(t){var n;this.transform.groupby=bf(((n=this.transform.groupby)!==null&&n!==void 0?n:[]).concat(t),r=>r)}producedFields(){}dependentFields(){var t;return new Set([this.transform.pivot,this.transform.value,...(t=this.transform.groupby)!==null&&t!==void 0?t:[]])}hash(){return`PivotTransform ${Et(this.transform)}`}assemble(){const{pivot:t,value:n,groupby:r,limit:i,op:s}=this.transform;return Object.assign(Object.assign(Object.assign({type:"pivot",field:t,value:n},i!==void 0?{limit:i}:{}),s!==void 0?{op:s}:{}),r!==void 0?{groupby:r}:{})}}class LF extends Jt{constructor(t,n){super(t),this.transform=n}clone(){return new LF(null,ht(this.transform))}dependentFields(){return new Set}producedFields(){return new Set}hash(){return`SampleTransform ${Et(this.transform)}`}assemble(){return{type:"sample",size:this.transform.sample}}}function Fve(e){let t=0;function n(r,i){var s;if(r instanceof V0&&!r.isGenerator&&!p2(r.data)&&(e.push(i),i={name:null,source:i.name,transform:[]}),r instanceof vi&&(r.parent instanceof V0&&!i.source?(i.format=Object.assign(Object.assign({},(s=i.format)!==null&&s!==void 0?s:{}),{parse:r.assembleFormatParse()}),i.transform.push(...r.assembleTransforms(!0))):i.transform.push(...r.assembleTransforms())),r instanceof Oy){i.name||(i.name=`data_${t++}`),!i.source||i.transform.length>0?(e.push(i),r.data=i.name):r.data=i.source;for(const o of r.assemble())e.push(o);return}switch((r instanceof hC||r instanceof dC||r instanceof b2||r instanceof Fy||r instanceof U0||r instanceof x2||r instanceof zm||r instanceof _a||r instanceof v2||r instanceof Ry||r instanceof qg||r instanceof NF||r instanceof DF||r instanceof IF||r instanceof FF||r instanceof OF||r instanceof RF||r instanceof $h||r instanceof LF||r instanceof MF)&&i.transform.push(r.assemble()),(r instanceof Fu||r instanceof Nu||r instanceof hp||r instanceof sc)&&i.transform.push(...r.assemble()),r instanceof Hi&&(i.source&&i.transform.length===0?r.setSource(i.source):r.parent instanceof Hi?r.setSource(i.name):(i.name||(i.name=`data_${t++}`),r.setSource(i.name),r.numChildren()===1&&(e.push(i),i={name:null,source:i.name,transform:[]}))),r.numChildren()){case 0:r instanceof Hi&&(!i.source||i.transform.length>0)&&e.push(i);break;case 1:n(r.children[0],i);break;default:{i.name||(i.name=`data_${t++}`);let o=i.name;!i.source||i.transform.length>0?e.push(i):o=i.source;for(const a of r.children)n(a,{name:null,source:o,transform:[]});break}}}return n}function zMt(e){const t=[],n=Fve(t);for(const r of e.children)n(r,{source:e.name,name:null,transform:[]});return t}function UMt(e,t){var n,r;const i=[],s=Fve(i);let o=0;for(const u of e.sources){u.hasName()||(u.dataName=`source_${o++}`);const l=u.assemble();s(u,l)}for(const u of i)u.transform.length===0&&delete u.transform;let a=0;for(const[u,l]of i.entries())((n=l.transform)!==null&&n!==void 0?n:[]).length===0&&!l.source&&i.splice(a++,0,i.splice(u,1)[0]);for(const u of i)for(const l of(r=u.transform)!==null&&r!==void 0?r:[])l.type==="lookup"&&(l.from=e.outputNodes[l.from].getSource());for(const u of i)u.name in t&&(u.values=t[u.name]);return i}function jMt(e){return e==="top"||e==="left"||Xe(e)?"header":"footer"}function WMt(e){for(const t of No)VMt(e,t);rQ(e,"x"),rQ(e,"y")}function VMt(e,t){var n;const{facet:r,config:i,child:s,component:o}=e;if(e.channelHasField(t)){const a=r[t],u=W0("title",null,i,t);let l=lp(a,i,{allowDisabling:!0,includeDefault:u===void 0||!!u});s.component.layoutHeaders[t].title&&(l=je(l)?l.join(", "):l,l+=" / "+s.component.layoutHeaders[t].title,s.component.layoutHeaders[t].title=null);const c=W0("labelOrient",a,i,t),f=(n=a.header)!==null&&n!==void 0?n:{},h=Jn(f.labels,i.header.labels,!0),d=Ve(["bottom","right"],c)?"footer":"header";o.layoutHeaders[t]={title:l,facetFieldDef:a,[d]:t==="facet"?[]:[Ove(e,t,h)]}}}function Ove(e,t,n){const r=t==="row"?"height":"width";return{labels:n,sizeSignal:e.child.component.layoutSize.get(r)?e.child.getSizeSignalRef(r):void 0,axes:[]}}function rQ(e,t){var n;const{child:r}=e;if(r.component.axes[t]){const{layoutHeaders:i,resolve:s}=e.component;if(s.axis[t]=yW(s,t),s.axis[t]==="shared"){const o=t==="x"?"column":"row",a=i[o];for(const u of r.component.axes[t]){const l=jMt(u.get("orient"));a[l]=(n=a[l])!==null&&n!==void 0?n:[Ove(e,o,!1)];const c=ix(u,"main",e.config,{header:!0});c&&a[l][0].axes.push(c),u.mainExtracted=!0}}}}function GMt(e){CW(e),mA(e,"width"),mA(e,"height")}function HMt(e){CW(e);const t=e.layout.columns===1?"width":"childWidth",n=e.layout.columns===void 0?"height":"childHeight";mA(e,t),mA(e,n)}function CW(e){for(const t of e.children)t.parseLayoutSize()}function mA(e,t){const n=uve(t),r=aF(n),i=e.component.resolve,s=e.component.layoutSize;let o;for(const a of e.children){const u=a.component.layoutSize.getWithExplicit(n),l=i.scale[r];if(l==="independent"&&u.value==="step"){o=void 0;break}if(o){if(l==="independent"&&o.value!==u.value){o=void 0;break}o=xh(o,u,n,"")}else o=u}if(o){for(const a of e.children)e.renameSignal(a.getName(n),e.getName(t)),a.component.layoutSize.set(n,"merged",!1);s.setWithExplicit(t,o)}else s.setWithExplicit(t,{explicit:!1,value:void 0})}function qMt(e){const{size:t,component:n}=e;for(const r of Vo){const i=yl(r);if(t[i]){const s=t[i];n.layoutSize.set(i,Yu(s)?"step":s,!0)}else{const s=XMt(e,i);n.layoutSize.set(i,s,!1)}}}function XMt(e,t){const n=t==="width"?"x":"y",r=e.config,i=e.getScaleComponent(n);if(i){const s=i.get("type"),o=i.get("range");if(Ms(s)){const a=d2(r.view,t);return Kh(o)||Yu(a)?"step":a}else return oP(r.view,t)}else{if(e.hasProjection||e.mark==="arc")return oP(r.view,t);{const s=d2(r.view,t);return Yu(s)?s.step:s}}}function $P(e,t,n){return ve(t,Object.assign({suffix:`by_${ve(e)}`},n??{}))}class Nx extends Nve{constructor(t,n,r,i){super(t,"facet",n,r,i,t.resolve),this.child=_W(t.spec,this,this.getName("child"),void 0,i),this.children=[this.child],this.facet=this.initFacet(t.facet,i)}initFacet(t,n){return iC(t)?exe(t,(r,i,s)=>Ve([nc,rc],s)?i.field===void 0?(pe(tP(i,s)),r):(r[s]=iP(i,s,n),r):(pe(cF(s,"facet")),r),{}):{facet:iP(t,"facet",n)}}channelHasField(t){return!!this.facet[t]}fieldDef(t){return this.facet[t]}parseData(){this.component.data=PF(this),this.child.parseData()}parseLayoutSize(){CW(this)}parseSelections(){this.child.parseSelections(),this.component.selection=this.child.component.selection}parseMarkGroup(){this.child.parseMarkGroup()}parseAxesAndHeaders(){this.child.parseAxesAndHeaders(),WMt(this)}assembleSelectionTopLevelSignals(t){return this.child.assembleSelectionTopLevelSignals(t)}assembleSignals(){return this.child.assembleSignals(),[]}assembleSelectionData(t){return this.child.assembleSelectionData(t)}getHeaderLayoutMixins(){var t,n,r;const i={};for(const s of No)for(const o of gW){const a=this.component.layoutHeaders[s],u=a[o],{facetFieldDef:l}=a;if(l){const c=W0("titleOrient",l,this.config,s);if(Ve(["right","bottom"],c)){const f=EF(s,c);i.titleAnchor=(t=i.titleAnchor)!==null&&t!==void 0?t:{},i.titleAnchor[f]="end"}}if(u!=null&&u[0]){const c=s==="row"?"height":"width",f=o==="header"?"headerBand":"footerBand";s!=="facet"&&!this.child.component.layoutSize.get(c)&&(i[f]=(n=i[f])!==null&&n!==void 0?n:{},i[f][s]=.5),a.title&&(i.offset=(r=i.offset)!==null&&r!==void 0?r:{},i.offset[s==="row"?"rowTitle":"columnTitle"]=10)}}return i}assembleDefaultLayout(){const{column:t,row:n}=this.facet,r=t?this.columnDistinctSignal():n?1:void 0;let i="all";return(!n&&this.component.resolve.scale.x==="independent"||!t&&this.component.resolve.scale.y==="independent")&&(i="none"),Object.assign(Object.assign(Object.assign({},this.getHeaderLayoutMixins()),r?{columns:r}:{}),{bounds:"full",align:i})}assembleLayoutSignals(){return this.child.assembleLayoutSignals()}columnDistinctSignal(){if(!(this.parent&&this.parent instanceof Nx))return{signal:`length(data('${this.getName("column_domain")}'))`}}assembleGroup(t){return this.parent&&this.parent instanceof Nx?Object.assign(Object.assign({},this.channelHasField("column")?{encode:{update:{columns:{field:ve(this.facet.column,{prefix:"distinct"})}}}}:{}),super.assembleGroup(t)):super.assembleGroup(t)}getCardinalityAggregateForChild(){const t=[],n=[],r=[];if(this.child instanceof Nx){if(this.child.channelHasField("column")){const i=ve(this.child.facet.column);t.push(i),n.push("distinct"),r.push(`distinct_${i}`)}}else for(const i of Vo){const s=this.child.component.scales[i];if(s&&!s.merged){const o=s.get("type"),a=s.get("range");if(Ms(o)&&Kh(a)){const u=TF(this.child,i),l=vW(u);l?(t.push(l),n.push("distinct"),r.push(`distinct_${l}`)):pe(`Unknown field for ${i}. Cannot calculate view size.`)}}}return{fields:t,ops:n,as:r}}assembleFacet(){const{name:t,data:n}=this.component.data.facetRoot,{row:r,column:i}=this.facet,{fields:s,ops:o,as:a}=this.getCardinalityAggregateForChild(),u=[];for(const c of No){const f=this.facet[c];if(f){u.push(ve(f));const{bin:h,sort:d}=f;if(ln(h)&&u.push(ve(f,{binSuffix:"end"})),Du(d)){const{field:p,op:g=hF}=d,m=$P(f,d);r&&i?(s.push(m),o.push("max"),a.push(m)):(s.push(p),o.push(g),a.push(m))}else if(je(d)){const p=j0(f,c);s.push(p),o.push("max"),a.push(p)}}}const l=!!r&&!!i;return Object.assign({name:t,data:n,groupby:u},l||s.length>0?{aggregate:Object.assign(Object.assign({},l?{cross:l}:{}),s.length?{fields:s,ops:o,as:a}:{})}:{})}facetSortFields(t){const{facet:n}=this,r=n[t];return r?Du(r.sort)?[$P(r,r.sort,{expr:"datum"})]:je(r.sort)?[j0(r,t,{expr:"datum"})]:[ve(r,{expr:"datum"})]:[]}facetSortOrder(t){const{facet:n}=this,r=n[t];if(r){const{sort:i}=r;return[(Du(i)?i.order:!je(i)&&i)||"ascending"]}return[]}assembleLabelTitle(){const{facet:t,config:n}=this;if(t.facet)return mP(t.facet,"facet",n);const r={row:["top","bottom"],column:["left","right"]};for(const i of pW)if(t[i]){const s=W0("labelOrient",t[i],n,i);if(Ve(r[i],s))return mP(t[i],i,n)}}assembleMarks(){const{child:t}=this,n=this.component.data.facetRoot,r=zMt(n),i=t.assembleGroupEncodeEntry(!1),s=this.assembleLabelTitle()||t.assembleTitle(),o=t.assembleGroupStyle();return[Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({name:this.getName("cell"),type:"group"},s?{title:s}:{}),o?{style:o}:{}),{from:{facet:this.assembleFacet()},sort:{field:No.map(u=>this.facetSortFields(u)).flat(),order:No.map(u=>this.facetSortOrder(u)).flat()}}),r.length>0?{data:r}:{}),i?{encode:{update:i}}:{}),t.assembleGroup(h3t(this,[])))]}getMapping(){return this.facet}}function YMt(e,t){const{row:n,column:r}=t;if(n&&r){let i=null;for(const s of[n,r])if(Du(s.sort)){const{field:o,op:a=hF}=s.sort;e=i=new qg(e,{joinaggregate:[{op:a,field:o,as:$P(s,s.sort,{forAs:!0})}],groupby:[ve(s)]})}return i}return null}function Rve(e,t){var n,r,i,s,o,a,u,l,c,f;for(const h of t){const d=h.data;if(!(e.name&&h.hasName()&&e.name!==h.dataName)&&!(!((n=e.format)===null||n===void 0)&&n.mesh&&(!((r=d.format)===null||r===void 0)&&r.feature))&&!((!((i=e.format)===null||i===void 0)&&i.feature||!((s=d.format)===null||s===void 0)&&s.feature)&&((o=e.format)===null||o===void 0?void 0:o.feature)!==((a=d.format)===null||a===void 0?void 0:a.feature))&&!((!((u=e.format)===null||u===void 0)&&u.mesh||!((l=d.format)===null||l===void 0)&&l.mesh)&&((c=e.format)===null||c===void 0?void 0:c.mesh)!==((f=d.format)===null||f===void 0?void 0:f.mesh))){if(cA(e)&&cA(d)){if(Q$(e.values,d.values))return h}else if(p2(e)&&p2(d)){if(e.url===d.url)return h}else if(wxe(e)&&e.name===h.dataName)return h}}return null}function KMt(e,t){if(e.data||!e.parent){if(e.data===null){const r=new V0({values:[]});return t.push(r),r}const n=Rve(e.data,t);if(n)return fp(e.data)||(n.data.format=gTt({},e.data.format,n.data.format)),!n.hasName()&&e.data.name&&(n.dataName=e.data.name),n;{const r=new V0(e.data);return t.push(r),r}}else return e.parent.component.data.facetRoot?e.parent.component.data.facetRoot:e.parent.component.data.main}function ZMt(e,t,n){var r,i;let s=0;for(const o of t.transforms){let a,u;if(RFt(o))u=e=new U0(e,o),a="derived";else if(Sxe(o)){const l=WRt(o);u=e=(r=vi.makeWithAncestors(e,{},l,n))!==null&&r!==void 0?r:e,e=new Fy(e,t,o.filter)}else if(MFt(o))u=e=Fu.makeFromTransform(e,o,t),a="number";else if(PFt(o))a="date",n.getWithExplicit(o.field).value===void 0&&(e=new vi(e,{[o.field]:a}),n.set(o.field,a,!1)),u=e=Nu.makeFromTransform(e,o);else if(BFt(o))u=e=_a.makeFromTransform(e,o),a="number",cW(t)&&(e=new $h(e));else if(CFt(o))u=e=v2.make(e,t,o,s++),a="derived";else if(NFt(o))u=e=new Ry(e,o),a="number";else if(FFt(o))u=e=new qg(e,o),a="number";else if(zFt(o))u=e=sc.makeFromTransform(e,o),a="derived";else if(UFt(o))u=e=new NF(e,o),a="derived";else if(OFt(o))u=e=new DF(e,o),a="derived";else if(EFt(o))u=e=new MF(e,o),a="derived";else if(DFt(o))e=new LF(e,o);else if(LFt(o))u=e=hp.makeFromTransform(e,o),a="derived";else if(_Ft(o))u=e=new IF(e,o),a="derived";else if(AFt(o))u=e=new OF(e,o),a="derived";else if(TFt(o))u=e=new RF(e,o),a="derived";else if(IFt(o))u=e=new FF(e,o),a="derived";else{pe(vIt(o));continue}if(u&&a!==void 0)for(const l of(i=u.producedFields())!==null&&i!==void 0?i:[])n.set(l,a,!1)}return e}function PF(e){var t,n,r,i,s,o,a,u,l,c;let f=KMt(e,e.component.data.sources);const{outputNodes:h,outputNodeRefCounts:d}=e.component.data,p=e.parent?e.parent.component.data.ancestorParse.clone():new wFt,g=e.data;fp(g)?($xe(g)?f=new dC(f,g.sequence):sW(g)&&(f=new hC(f,g.graticule)),p.parseNothing=!0):((t=g==null?void 0:g.format)===null||t===void 0?void 0:t.parse)===null&&(p.parseNothing=!0),f=(n=vi.makeExplicit(f,e,p))!==null&&n!==void 0?n:f,f=new $h(f);const m=e.parent&&My(e.parent);(In(e)||Aa(e))&&m&&(f=(r=Fu.makeFromEncoding(f,e))!==null&&r!==void 0?r:f),e.transforms.length>0&&(f=ZMt(f,e,p));const y=GRt(e),b=VRt(e);f=(i=vi.makeWithAncestors(f,{},Object.assign(Object.assign({},y),b),p))!==null&&i!==void 0?i:f,In(e)&&(f=zm.parseAll(f,e),f=x2.parseAll(f,e)),(In(e)||Aa(e))&&(m||(f=(s=Fu.makeFromEncoding(f,e))!==null&&s!==void 0?s:f),f=(o=Nu.makeFromEncoding(f,e))!==null&&o!==void 0?o:f,f=U0.parseAllForSortIndex(f,e));const v=e.getName(fA),x=new Hi(f,v,fA,d);if(h[v]=x,f=x,In(e)){const S=_a.makeFromEncoding(f,e);S&&(f=S,cW(e)&&(f=new $h(f))),f=(a=hp.makeFromEncoding(f,e))!==null&&a!==void 0?a:f,f=(u=sc.makeFromEncoding(f,e))!==null&&u!==void 0?u:f}In(e)&&(f=(l=b2.make(f,e))!==null&&l!==void 0?l:f);const w=e.getName(ci),C=new Hi(f,w,ci,d);h[w]=C,f=C,In(e)&&BOt(e,C);let $=null;if(Aa(e)){const S=e.getName("facet");f=(c=YMt(f,e.facet))!==null&&c!==void 0?c:f,$=new Oy(f,e,S,C.getSource()),h[S]=$}return Object.assign(Object.assign({},e.component.data),{outputNodes:h,outputNodeRefCounts:d,raw:x,main:C,facetRoot:$,ancestorParse:p})}class JMt extends $W{constructor(t,n,r,i){var s,o,a,u;super(t,"concat",n,r,i,t.resolve),(((o=(s=t.resolve)===null||s===void 0?void 0:s.axis)===null||o===void 0?void 0:o.x)==="shared"||((u=(a=t.resolve)===null||a===void 0?void 0:a.axis)===null||u===void 0?void 0:u.y)==="shared")&&pe(bIt),this.children=this.getChildren(t).map((l,c)=>_W(l,this,this.getName("concat_"+c),void 0,i))}parseData(){this.component.data=PF(this);for(const t of this.children)t.parseData()}parseSelections(){this.component.selection={};for(const t of this.children){t.parseSelections();for(const n of be(t.component.selection))this.component.selection[n]=t.component.selection[n]}}parseMarkGroup(){for(const t of this.children)t.parseMarkGroup()}parseAxesAndHeaders(){for(const t of this.children)t.parseAxesAndHeaders()}getChildren(t){return yF(t)?t.vconcat:rW(t)?t.hconcat:t.concat}parseLayoutSize(){HMt(this)}parseAxisGroup(){return null}assembleSelectionTopLevelSignals(t){return this.children.reduce((n,r)=>r.assembleSelectionTopLevelSignals(n),t)}assembleSignals(){return this.children.forEach(t=>t.assembleSignals()),[]}assembleLayoutSignals(){const t=mW(this);for(const n of this.children)t.push(...n.assembleLayoutSignals());return t}assembleSelectionData(t){return this.children.reduce((n,r)=>r.assembleSelectionData(n),t)}assembleMarks(){return this.children.map(t=>{const n=t.assembleTitle(),r=t.assembleGroupStyle(),i=t.assembleGroupEncodeEntry(!1);return Object.assign(Object.assign(Object.assign(Object.assign({type:"group",name:t.getName("group")},n?{title:n}:{}),r?{style:r}:{}),i?{encode:{update:i}}:{}),t.assembleGroup())})}assembleDefaultLayout(){const t=this.layout.columns;return Object.assign(Object.assign({},t!=null?{columns:t}:{}),{bounds:"full",align:"each"})}}function QMt(e){return e===!1||e===null}const e4t=Object.assign(Object.assign({disable:1,gridScale:1,scale:1},Pye),{labelExpr:1,encode:1}),Mve=be(e4t);class SW extends Mc{constructor(t={},n={},r=!1){super(),this.explicit=t,this.implicit=n,this.mainExtracted=r}clone(){return new SW(ht(this.explicit),ht(this.implicit),this.mainExtracted)}hasAxisPart(t){return t==="axis"?!0:t==="grid"||t==="title"?!!this.get(t):!QMt(this.get(t))}hasOrientSignalRef(){return Xe(this.explicit.orient)}}function t4t(e,t,n){var r;const{encoding:i,config:s}=e,o=(r=ur(i[t]))!==null&&r!==void 0?r:ur(i[ml(t)]),a=e.axis(t)||{},{format:u,formatType:l}=a;return Hp(l)?Object.assign({text:Bj({fieldOrDatumDef:o,field:"datum.value",format:u,formatType:l,config:s})},n):n}function n4t(e){return Vo.reduce((t,n)=>(e.component.scales[n]&&(t[n]=[l4t(n,e)]),t),{})}const r4t={bottom:"top",top:"bottom",left:"right",right:"left"};function i4t(e){var t;const{axes:n,resolve:r}=e.component,i={top:0,bottom:0,right:0,left:0};for(const s of e.children){s.parseAxesAndHeaders();for(const o of be(s.component.axes))r.axis[o]=yW(e.component.resolve,o),r.axis[o]==="shared"&&(n[o]=s4t(n[o],s.component.axes[o]),n[o]||(r.axis[o]="independent",delete n[o]))}for(const s of Vo){for(const o of e.children)if(o.component.axes[s]){if(r.axis[s]==="independent"){n[s]=((t=n[s])!==null&&t!==void 0?t:[]).concat(o.component.axes[s]);for(const a of o.component.axes[s]){const{value:u,explicit:l}=a.getWithExplicit("orient");if(!Xe(u)){if(i[u]>0&&!l){const c=r4t[u];i[u]>i[c]&&a.set("orient",c,!1)}i[u]++}}}delete o.component.axes[s]}if(r.axis[s]==="independent"&&n[s]&&n[s].length>1)for(const o of n[s])o.get("grid")&&!o.explicit.grid&&(o.implicit.grid=!1)}}function s4t(e,t){if(e){if(e.length!==t.length)return;const n=e.length;for(let r=0;r<n;r++){const i=e[r],s=t[r];if(!!i!=!!s)return;if(i&&s){const o=i.getWithExplicit("orient"),a=s.getWithExplicit("orient");if(o.explicit&&a.explicit&&o.value!==a.value)return;e[r]=o4t(i,s)}}}else return t.map(n=>n.clone());return e}function o4t(e,t){for(const n of Mve){const r=xh(e.getWithExplicit(n),t.getWithExplicit(n),n,"axis",(i,s)=>{switch(n){case"title":return Qbe(i,s);case"gridScale":return{explicit:i.explicit,value:Jn(i.value,s.value)}}return xF(i,s,n,"axis")});e.setWithExplicit(n,r)}return e}function a4t(e,t,n,r,i){if(t==="disable")return n!==void 0;switch(n=n||{},t){case"titleAngle":case"labelAngle":return e===(Xe(n.labelAngle)?n.labelAngle:eA(n.labelAngle));case"values":return!!n.values;case"encode":return!!n.encoding||!!n.labelAngle;case"title":if(e===rve(r,i))return!0}return e===n[t]}const u4t=new Set(["grid","translate","format","formatType","orient","labelExpr","tickCount","position","tickMinStep"]);function l4t(e,t){var n,r,i;let s=t.axis(e);const o=new SW,a=ur(t.encoding[e]),{mark:u,config:l}=t,c=(s==null?void 0:s.orient)||((n=l[e==="x"?"axisX":"axisY"])===null||n===void 0?void 0:n.orient)||((r=l.axis)===null||r===void 0?void 0:r.orient)||ZOt(e),f=t.getScaleComponent(e).get("type"),h=VOt(e,f,c,t.config),d=s!==void 0?!s:pP("disable",l,s==null?void 0:s.style,h).configValue;if(o.set("disable",d,s!==void 0),d)return o;s=s||{};const p=XOt(t,s,e,a,h),g={fieldOrDatumDef:a,axis:s,channel:e,model:t,scaleType:f,orient:c,labelAngle:p,mark:u,config:l};for(const b of Mve){const v=b in jJ?jJ[b](g):ZZ(b)?s[b]:void 0,x=v!==void 0,w=a4t(v,b,s,t,e);if(x&&w)o.set(b,v,w);else{const{configValue:C=void 0,configFrom:$=void 0}=ZZ(b)&&b!=="values"?pP(b,t.config,s.style,h):{},S=C!==void 0;x&&!S?o.set(b,v,w):($!=="vgAxisConfig"||u4t.has(b)&&S||mj(C)||Xe(C))&&o.set(b,C,!1)}}const m=(i=s.encoding)!==null&&i!==void 0?i:{},y=Lye.reduce((b,v)=>{var x;if(!o.hasAxisPart(v))return b;const w=lve((x=m[v])!==null&&x!==void 0?x:{},t),C=v==="labels"?t4t(t,e,w):w;return C!==void 0&&!tn(C)&&(b[v]={update:C}),b},{});return tn(y)||o.set("encode",y,!!s.encoding||s.labelAngle!==void 0),o}function c4t({encoding:e,size:t}){for(const n of Vo){const r=yl(n);Yu(t[r])&&vu(e[n])&&(delete t[r],pe(obe(r)))}return t}function f4t(e,t,n,{graticule:r}){const i=Hu(e)?Object.assign({},e):{type:e},s=Bt("orient",i,n);if(i.orient=g4t(i.type,t,s),s!==void 0&&s!==i.orient&&pe(OIt(i.orient,s)),i.type==="bar"&&i.orient){const l=Bt("cornerRadiusEnd",i,n);if(l!==void 0){const c=i.orient==="horizontal"&&t.x2||i.orient==="vertical"&&t.y2?["cornerRadius"]:RTt[i.orient];for(const f of c)i[f]=l;i.cornerRadiusEnd!==void 0&&delete i.cornerRadiusEnd}}return Bt("opacity",i,n)===void 0&&(i.opacity=d4t(i.type,t)),i.filled===void 0&&(i.filled=r?!1:p4t(i,n)),Bt("cursor",i,n)===void 0&&(i.cursor=h4t(i,t,n)),i}function h4t(e,t,n){return t.href||e.href||Bt("href",e,n)?"pointer":e.cursor}function d4t(e,t){if(Ve([eF,yj,bj,xj],e)&&!Xj(t))return .7}function p4t(e,t){const n=qp("filled",e,t),r=e.type;return Jn(n,r!==eF&&r!==QN&&r!==tA)}function g4t(e,t,n){switch(e){case eF:case bj:case xj:case zye:case _Tt:case ETt:return}const{x:r,y:i,x2:s,y2:o}=t;switch(e){case JN:if(ke(r)&&(ji(r.bin)||ke(i)&&i.aggregate&&!r.aggregate))return"vertical";if(ke(i)&&(ji(i.bin)||ke(r)&&r.aggregate&&!i.aggregate))return"horizontal";if(o||s){if(n)return n;if(!s&&(ke(r)&&r.type===Gp&&!ln(r.bin)||rP(r)))return"horizontal";if(!o&&(ke(i)&&i.type===Gp&&!ln(i.bin)||rP(i)))return"vertical"}case tA:if(s&&!(ke(r)&&ji(r.bin))&&o&&!(ke(i)&&ji(i.bin)))return;case ZN:if(o)return ke(i)&&ji(i.bin)?"horizontal":"vertical";if(s)return ke(r)&&ji(r.bin)?"vertical":"horizontal";if(e===tA){if(r&&!i)return"vertical";if(i&&!r)return"horizontal"}case QN:case yj:{const a=vu(r),u=vu(i);if(a&&!u)return e!=="tick"?"horizontal":"vertical";if(!a&&u)return e!=="tick"?"vertical":"horizontal";if(a&&u){const l=r,c=i,f=l.type===P0,h=c.type===P0;return f&&!h?e!=="tick"?"vertical":"horizontal":!f&&h?e!=="tick"?"horizontal":"vertical":!l.aggregate&&c.aggregate?e!=="tick"?"vertical":"horizontal":l.aggregate&&!c.aggregate?e!=="tick"?"horizontal":"vertical":n||"vertical"}else return n||void 0}}return"vertical"}const m4t={vgMark:"arc",encodeEntry:e=>Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},Jo(e,{align:"ignore",baseline:"ignore",color:"include",size:"ignore",orient:"ignore",theta:"ignore"})),bi("x",e,{defaultPos:"mid"})),bi("y",e,{defaultPos:"mid"})),vh(e,"radius","arc")),vh(e,"theta","arc"))},y4t={vgMark:"area",encodeEntry:e=>Object.assign(Object.assign(Object.assign(Object.assign({},Jo(e,{align:"ignore",baseline:"ignore",color:"include",orient:"include",size:"ignore",theta:"ignore"})),hA("x",e,{defaultPos:"zeroOrMin",defaultPos2:"zeroOrMin",range:e.markDef.orient==="horizontal"})),hA("y",e,{defaultPos:"zeroOrMin",defaultPos2:"zeroOrMin",range:e.markDef.orient==="vertical"})),uW(e))},b4t={vgMark:"rect",encodeEntry:e=>Object.assign(Object.assign(Object.assign({},Jo(e,{align:"ignore",baseline:"ignore",color:"include",orient:"ignore",size:"ignore",theta:"ignore"})),vh(e,"x","bar")),vh(e,"y","bar"))},x4t={vgMark:"shape",encodeEntry:e=>Object.assign({},Jo(e,{align:"ignore",baseline:"ignore",color:"include",size:"ignore",orient:"ignore",theta:"ignore"})),postEncodingTransform:e=>{const{encoding:t}=e,n=t.shape;return[Object.assign({type:"geoshape",projection:e.projectionName()},n&&ke(n)&&n.type===Dy?{field:ve(n,{expr:"datum"})}:{})]}},v4t={vgMark:"image",encodeEntry:e=>Object.assign(Object.assign(Object.assign(Object.assign({},Jo(e,{align:"ignore",baseline:"ignore",color:"ignore",orient:"ignore",size:"ignore",theta:"ignore"})),vh(e,"x","image")),vh(e,"y","image")),oW(e,"url"))},w4t={vgMark:"line",encodeEntry:e=>Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},Jo(e,{align:"ignore",baseline:"ignore",color:"include",size:"ignore",orient:"ignore",theta:"ignore"})),bi("x",e,{defaultPos:"mid"})),bi("y",e,{defaultPos:"mid"})),$r("size",e,{vgChannel:"strokeWidth"})),uW(e))},$4t={vgMark:"trail",encodeEntry:e=>Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},Jo(e,{align:"ignore",baseline:"ignore",color:"include",size:"include",orient:"ignore",theta:"ignore"})),bi("x",e,{defaultPos:"mid"})),bi("y",e,{defaultPos:"mid"})),$r("size",e)),uW(e))};function kW(e,t){const{config:n}=e;return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},Jo(e,{align:"ignore",baseline:"ignore",color:"include",size:"include",orient:"ignore",theta:"ignore"})),bi("x",e,{defaultPos:"mid"})),bi("y",e,{defaultPos:"mid"})),$r("size",e)),$r("angle",e)),C4t(e,n,t))}function C4t(e,t,n){return n?{shape:{value:n}}:$r("shape",e)}const S4t={vgMark:"symbol",encodeEntry:e=>kW(e)},k4t={vgMark:"symbol",encodeEntry:e=>kW(e,"circle")},E4t={vgMark:"symbol",encodeEntry:e=>kW(e,"square")},_4t={vgMark:"rect",encodeEntry:e=>Object.assign(Object.assign(Object.assign({},Jo(e,{align:"ignore",baseline:"ignore",color:"include",orient:"ignore",size:"ignore",theta:"ignore"})),vh(e,"x","rect")),vh(e,"y","rect"))},A4t={vgMark:"rule",encodeEntry:e=>{const{markDef:t}=e,n=t.orient;return!e.encoding.x&&!e.encoding.y&&!e.encoding.latitude&&!e.encoding.longitude?{}:Object.assign(Object.assign(Object.assign(Object.assign({},Jo(e,{align:"ignore",baseline:"ignore",color:"include",orient:"ignore",size:"ignore",theta:"ignore"})),hA("x",e,{defaultPos:n==="horizontal"?"zeroOrMax":"mid",defaultPos2:"zeroOrMin",range:n!=="vertical"})),hA("y",e,{defaultPos:n==="vertical"?"zeroOrMax":"mid",defaultPos2:"zeroOrMin",range:n!=="horizontal"})),$r("size",e,{vgChannel:"strokeWidth"}))}},T4t={vgMark:"text",encodeEntry:e=>{const{config:t,encoding:n}=e;return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},Jo(e,{align:"include",baseline:"include",color:"include",size:"ignore",orient:"ignore",theta:"include"})),bi("x",e,{defaultPos:"mid"})),bi("y",e,{defaultPos:"mid"})),oW(e)),$r("size",e,{vgChannel:"fontSize"})),$r("angle",e)),DJ("align",I4t(e.markDef,n,t))),DJ("baseline",D4t(e.markDef,n,t))),bi("radius",e,{defaultPos:null,isMidPoint:!0})),bi("theta",e,{defaultPos:null,isMidPoint:!0}))}};function I4t(e,t,n){if(Bt("align",e,n)===void 0)return"center"}function D4t(e,t,n){if(Bt("baseline",e,n)===void 0)return"middle"}const N4t={vgMark:"rect",encodeEntry:e=>{const{config:t,markDef:n}=e,r=n.orient,i=r==="horizontal"?"width":"height",s=r==="horizontal"?"height":"width";return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},Jo(e,{align:"ignore",baseline:"ignore",color:"include",orient:"ignore",size:"ignore",theta:"ignore"})),bi("x",e,{defaultPos:"mid",vgChannel:"xc"})),bi("y",e,{defaultPos:"mid",vgChannel:"yc"})),$r("size",e,{defaultValue:F4t(e),vgChannel:i})),{[s]:Bn(Bt("thickness",n,t))})}};function F4t(e){var t;const{config:n,markDef:r}=e,{orient:i}=r,s=i==="horizontal"?"width":"height",o=e.getScaleComponent(i==="horizontal"?"x":"y"),a=(t=Bt("size",r,n,{vgChannel:s}))!==null&&t!==void 0?t:n.tick.bandSize;if(a!==void 0)return a;{const u=o?o.get("range"):void 0;return u&&Kh(u)&&Zn(u.step)?u.step*3/4:lA(n.view,s)*3/4}}const FS={arc:m4t,area:y4t,bar:b4t,circle:k4t,geoshape:x4t,image:v4t,line:w4t,point:S4t,rect:_4t,rule:A4t,square:E4t,text:T4t,tick:N4t,trail:$4t};function O4t(e){return Ve([QN,ZN,ATt],e.mark)?R4t(e):Ve([JN],e.mark)?M4t(e):yA(e)}const iQ="faceted_path_";function R4t(e){const t=txe(e.mark,e.encoding),n=yA(e,{fromPrefix:t.length>0?iQ:""});return t.length>0?[{name:e.getName("pathgroup"),type:"group",from:{facet:{name:iQ+e.requestDataName(ci),data:e.requestDataName(ci),groupby:t}},encode:{update:{width:{field:{group:"width"}},height:{field:{group:"height"}}}},marks:n}]:n}const sQ="stack_group_";function M4t(e){const t=lR.some(n=>Bt(n,e.markDef,e.config));if(e.stack&&!e.fieldDef("size")&&t){const[n]=yA(e,{fromPrefix:sQ}),r=e.scaleName(e.stack.fieldChannel),i=(f={})=>e.vgField(e.stack.fieldChannel,f),s=(f,h)=>{const d=[i({prefix:"min",suffix:"start",expr:h}),i({prefix:"max",suffix:"start",expr:h}),i({prefix:"min",suffix:"end",expr:h}),i({prefix:"max",suffix:"end",expr:h})];return`${f}(${d.map(p=>`scale('${r}',${p})`).join(",")})`};let o,a;e.stack.fieldChannel==="x"?(o=Object.assign(Object.assign({},u2(n.encode.update,["y","yc","y2","height",...lR])),{x:{signal:s("min","datum")},x2:{signal:s("max","datum")},clip:{value:!0}}),a={x:{field:{group:"x"},mult:-1},height:{field:{group:"height"}}},n.encode.update=Object.assign(Object.assign({},tc(n.encode.update,["y","yc","y2"])),{height:{field:{group:"height"}}})):(o=Object.assign(Object.assign({},u2(n.encode.update,["x","xc","x2","width"])),{y:{signal:s("min","datum")},y2:{signal:s("max","datum")},clip:{value:!0}}),a={y:{field:{group:"y"},mult:-1},width:{field:{group:"width"}}},n.encode.update=Object.assign(Object.assign({},tc(n.encode.update,["x","xc","x2"])),{width:{field:{group:"width"}}}));for(const f of lR){const h=qp(f,e.markDef,e.config);n.encode.update[f]?(o[f]=n.encode.update[f],delete n.encode.update[f]):h&&(o[f]=Bn(h)),h&&(n.encode.update[f]={value:0})}const u=e.fieldDef(e.stack.groupbyChannel),l=ve(u)?[ve(u)]:[];return(u!=null&&u.bin||u!=null&&u.timeUnit)&&l.push(ve(u,{binSuffix:"end"})),o=["stroke","strokeWidth","strokeJoin","strokeCap","strokeDash","strokeDashOffset","strokeMiterLimit","strokeOpacity"].reduce((f,h)=>{if(n.encode.update[h])return Object.assign(Object.assign({},f),{[h]:n.encode.update[h]});{const d=qp(h,e.markDef,e.config);return d!==void 0?Object.assign(Object.assign({},f),{[h]:Bn(d)}):f}},o),o.stroke&&(o.strokeForeground={value:!0},o.strokeOffset={value:0}),[{type:"group",from:{facet:{data:e.requestDataName(ci),name:sQ+e.requestDataName(ci),groupby:l,aggregate:{fields:[i({suffix:"start"}),i({suffix:"start"}),i({suffix:"end"}),i({suffix:"end"})],ops:["min","max","min","max"]}}},encode:{update:o},marks:[{type:"group",encode:{update:a},marks:[n]}]}]}else return yA(e)}function L4t(e){const{encoding:t,stack:n,mark:r,markDef:i,config:s}=e,o=t.order;if(!(!je(o)&&yc(o)&&XZ(o.value)||!o&&XZ(Bt("order",i,s)))){if((je(o)||ke(o))&&!n)return Kbe(o,{expr:"datum"});if(Ug(r)){const a=i.orient==="horizontal"?"y":"x",u=t[a];if(ke(u)){const l=u.sort;if(je(l))return{field:ve(u,{prefix:a,suffix:"sort_index",expr:"datum"})};if(Du(l))return{field:ve({aggregate:Xj(e.encoding)?l.op:void 0,field:l.field},{expr:"datum"})};if(Obe(l)){const c=e.fieldDef(l.encoding);return{field:ve(c,{expr:"datum"}),order:l.order}}else return l===null?void 0:{field:ve(u,{binSuffix:e.stack&&e.stack.impute?"mid":void 0,expr:"datum"})}}return}}}function yA(e,t={fromPrefix:""}){const{mark:n,markDef:r,config:i}=e,s=Jn(r.clip,P4t(e),B4t(e)),o=Xbe(r),a=e.encoding.key,u=L4t(e),l=z4t(e),c=Bt("aria",r,i),f=FS[n].postEncodingTransform?FS[n].postEncodingTransform(e):null;return[Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({name:e.getName("marks"),type:FS[n].vgMark},s?{clip:!0}:{}),o?{style:o}:{}),a?{key:a.field}:{}),u?{sort:u}:{}),l||{}),c===!1?{aria:c}:{}),{from:{data:t.fromPrefix+e.requestDataName(ci)},encode:{update:FS[n].encodeEntry(e)}}),f?{transform:f}:{})]}function P4t(e){const t=e.getScaleComponent("x"),n=e.getScaleComponent("y");return t&&t.get("selectionExtent")||n&&n.get("selectionExtent")?!0:void 0}function B4t(e){const t=e.component.projection;return t&&!t.isFit?!0:void 0}function z4t(e){if(!e.component.selection)return null;const t=be(e.component.selection).length;let n=t,r=e.parent;for(;r&&n===0;)n=be(r.component.selection).length,r=r.parent;return n?{interactive:t>0}:null}class Lve extends Nve{constructor(t,n,r,i={},s){var o,a;super(t,"unit",n,r,s,void 0,mJ(t)?t.view:void 0),this.specifiedScales={},this.specifiedAxes={},this.specifiedLegends={},this.specifiedProjection={},this.selection={},this.children=[];const u=Hu(t.mark)?t.mark.type:t.mark;this.markDef=f4t(t.mark,(o=t.encoding)!==null&&o!==void 0?o:{},s,{graticule:t.data&&sW(t.data)});const l=this.encoding=xNt((a=t.encoding)!==null&&a!==void 0?a:{},this.markDef,s);this.size=c4t({encoding:l,size:mJ(t)?Object.assign(Object.assign(Object.assign({},i),t.width?{width:t.width}:{}),t.height?{height:t.height}:{}):i}),this.stack=mxe(u,l),this.specifiedScales=this.initScales(u,l),this.specifiedAxes=this.initAxes(l),this.specifiedLegends=this.initLegend(l),this.specifiedProjection=t.projection,this.selection=t.selection}get hasProjection(){const{encoding:t}=this,n=this.mark===Uye,r=t&&KTt.some(i=>Qe(t[i]));return n||r}scaleDomain(t){const n=this.specifiedScales[t];return n?n.domain:void 0}axis(t){return this.specifiedAxes[t]}legend(t){return this.specifiedLegends[t]}initScales(t,n){return uF.reduce((r,i)=>{var s;const o=ur(n[i]);return o&&(r[i]=(s=o.scale)!==null&&s!==void 0?s:{}),r},{})}initAxes(t){return Vo.reduce((n,r)=>{const i=t[r];if(Qe(i)||r===_n&&Qe(t.x2)||r===fr&&Qe(t.y2)){const s=Qe(i)?i.axis:void 0;n[r]=s&&Object.assign({},s)}return n},{})}initLegend(t){return iIt.reduce((n,r)=>{const i=ur(t[r]);if(i&&oIt(r)){const s=i.legend;n[r]=s&&Object.assign({},s)}return n},{})}parseData(){this.component.data=PF(this)}parseLayoutSize(){qMt(this)}parseSelections(){this.component.selection=POt(this,this.selection)}parseMarkGroup(){this.component.mark=O4t(this)}parseAxesAndHeaders(){this.component.axes=n4t(this)}assembleSelectionTopLevelSignals(t){return d3t(this,t)}assembleSignals(){return[...Jxe(this),...f3t(this,[])]}assembleSelectionData(t){return p3t(this,t)}assembleLayout(){return null}assembleLayoutSignals(){return mW(this)}assembleMarks(){var t;let n=(t=this.component.mark)!==null&&t!==void 0?t:[];return(!this.parent||!My(this.parent))&&(n=Pxe(this,n)),n.map(this.correctDataNames)}getMapping(){return this.encoding}get mark(){return this.markDef.type}channelHasField(t){return cp(this.encoding,t)}fieldDef(t){const n=this.encoding[t];return Xu(n)}typedFieldDef(t){const n=this.fieldDef(t);return lo(n)?n:null}}class EW extends $W{constructor(t,n,r,i,s){super(t,"layer",n,r,s,t.resolve,t.view);const o=Object.assign(Object.assign(Object.assign({},i),t.width?{width:t.width}:{}),t.height?{height:t.height}:{});this.children=t.layer.map((a,u)=>{if(bF(a))return new EW(a,this,this.getName("layer_"+u),o,s);if(Dc(a))return new Lve(a,this,this.getName("layer_"+u),o,s);throw new Error(kj(a))})}parseData(){this.component.data=PF(this);for(const t of this.children)t.parseData()}parseLayoutSize(){GMt(this)}parseSelections(){this.component.selection={};for(const t of this.children){t.parseSelections();for(const n of be(t.component.selection))this.component.selection[n]=t.component.selection[n]}}parseMarkGroup(){for(const t of this.children)t.parseMarkGroup()}parseAxesAndHeaders(){i4t(this)}assembleSelectionTopLevelSignals(t){return this.children.reduce((n,r)=>r.assembleSelectionTopLevelSignals(n),t)}assembleSignals(){return this.children.reduce((t,n)=>t.concat(n.assembleSignals()),Jxe(this))}assembleLayoutSignals(){return this.children.reduce((t,n)=>t.concat(n.assembleLayoutSignals()),mW(this))}assembleSelectionData(t){return this.children.reduce((n,r)=>r.assembleSelectionData(n),t)}assembleTitle(){let t=super.assembleTitle();if(t)return t;for(const n of this.children)if(t=n.assembleTitle(),t)return t}assembleLayout(){return null}assembleMarks(){return g3t(this,this.children.flatMap(t=>t.assembleMarks()))}assembleLegends(){return this.children.reduce((t,n)=>t.concat(n.assembleLegends()),mve(this))}}function _W(e,t,n,r,i){if(dF(e))return new Nx(e,t,n,i);if(bF(e))return new EW(e,t,n,r,i);if(Dc(e))return new Lve(e,t,n,r,i);if(zNt(e))return new JMt(e,t,n,i);throw new Error(kj(e))}function U4t(e,t={}){t.logger&&sDt(t.logger),t.fieldTitle&&Wbe(t.fieldTitle);try{const n=pxe(Tye(t.config,e.config)),r=xxe(e,n),i=_W(r,null,"",void 0,n);return i.parse(),aMt(i.component.data,i),{spec:W4t(i,j4t(e,r.autosize,n,i),e.datasets,e.usermeta),normalized:r}}finally{t.logger&&oDt(),t.fieldTitle&&hNt()}}function j4t(e,t,n,r){const i=r.component.layoutSize.get("width"),s=r.component.layoutSize.get("height");if(t===void 0?(t={type:"pad"},r.hasAxisOrientSignalRef()&&(t.resize=!0)):ft(t)&&(t={type:t}),i&&s&&bFt(t.type)){if(i==="step"&&s==="step")pe(rJ()),t.type="pad";else if(i==="step"||s==="step"){const o=i==="step"?"width":"height";pe(rJ(aF(o)));const a=o==="width"?"height":"width";t.type=xFt(a)}}return Object.assign(Object.assign(Object.assign({},be(t).length===1&&t.type?t.type==="pad"?{}:{autosize:t.type}:{autosize:t}),_J(n)),_J(e))}function W4t(e,t,n={},r){const i=e.config?JNt(e.config):void 0,s=[].concat(e.assembleSelectionData([]),UMt(e.component.data,n)),o=e.assembleProjections(),a=e.assembleTitle(),u=e.assembleGroupStyle(),l=e.assembleGroupEncodeEntry(!0);let c=e.assembleLayoutSignals();return c=c.filter(f=>(f.name==="width"||f.name==="height")&&f.value!==void 0?(t[f.name]=+f.value,!1):!0),Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({$schema:"https://vega.github.io/schema/vega/v5.json"},e.description?{description:e.description}:{}),t),a?{title:a}:{}),u?{style:u}:{}),l?{encode:{update:l}}:{}),{data:s}),o.length>0?{projections:o}:{}),e.assembleGroup([...c,...e.assembleSelectionTopLevelSignals([])])),i?{config:i}:{}),r?{usermeta:r}:{})}class V4t extends gxe{mapUnit(t,{config:n}){if(t.encoding){const{encoding:r,transform:i}=t,{bins:s,timeUnits:o,aggregate:a,groupby:u,encoding:l}=Yj(r,n),c=[...i||[],...s,...o,...a.length===0?[]:[{aggregate:a,groupby:u}]];return Object.assign(Object.assign(Object.assign({},t),c.length>0?{transform:c}:{}),{encoding:l})}else return t}}const G4t=new V4t;function H4t(e,t){return G4t.map(e,{config:t})}const q4t=KAt.version,X4t=Object.freeze(Object.defineProperty({__proto__:null,compile:U4t,extractTransforms:H4t,normalize:xxe,version:q4t},Symbol.toStringTag,{value:"Module"}));function Pve(e){const[t,n]=/schema\/([\w-]+)\/([\w\.\-]+)\.json$/g.exec(e).slice(1,3);return{library:t,version:n}}var Y4t="vega-themes",K4t="2.14.0",Z4t="Themes for stylized Vega and Vega-Lite visualizations.",J4t=["vega","vega-lite","themes","style"],Q4t="BSD-3-Clause",eLt={name:"UW Interactive Data Lab",url:"https://idl.cs.washington.edu"},tLt=[{name:"Emily Gu",url:"https://github.com/emilygu"},{name:"Arvind Satyanarayan",url:"http://arvindsatya.com"},{name:"Jeffrey Heer",url:"https://idl.cs.washington.edu"},{name:"Dominik Moritz",url:"https://www.domoritz.de"}],nLt="build/vega-themes.js",AW="build/vega-themes.module.js",rLt="build/vega-themes.min.js",iLt="build/vega-themes.min.js",sLt="build/vega-themes.module.d.ts",oLt={type:"git",url:"https://github.com/vega/vega-themes.git"},aLt=["src","build"],uLt={prebuild:"yarn clean",build:"rollup -c",clean:"rimraf build && rimraf examples/build","copy:data":"rsync -r node_modules/vega-datasets/data/* examples/data","copy:build":"rsync -r build/* examples/build","deploy:gh":"yarn build && mkdir -p examples/build && rsync -r build/* examples/build && gh-pages -d examples",preversion:"yarn lint",serve:"browser-sync start -s -f build examples --serveStatic examples",start:"yarn build && concurrently --kill-others -n Server,Rollup 'yarn serve' 'rollup -c -w'",format:"eslint . --fix",lint:"eslint .",release:"release-it"},lLt={"@babel/core":"^7.22.9","@babel/plugin-proposal-async-generator-functions":"^7.20.7","@babel/plugin-proposal-json-strings":"^7.18.6","@babel/plugin-proposal-object-rest-spread":"^7.20.7","@babel/plugin-proposal-optional-catch-binding":"^7.18.6","@babel/plugin-transform-runtime":"^7.22.9","@babel/preset-env":"^7.22.9","@babel/preset-typescript":"^7.22.5","@release-it/conventional-changelog":"^7.0.0","@rollup/plugin-json":"^6.0.0","@rollup/plugin-node-resolve":"^15.1.0","@rollup/plugin-terser":"^0.4.3","@typescript-eslint/eslint-plugin":"^6.0.0","@typescript-eslint/parser":"^6.0.0","browser-sync":"^2.29.3",concurrently:"^8.2.0",eslint:"^8.45.0","eslint-config-prettier":"^8.8.0","eslint-plugin-prettier":"^5.0.0","gh-pages":"^5.0.0",prettier:"^3.0.0","release-it":"^16.1.0",rollup:"^3.26.2","rollup-plugin-bundle-size":"^1.0.3","rollup-plugin-ts":"^3.2.0",typescript:"^5.1.6",vega:"^5.25.0","vega-lite":"^5.9.3"},cLt={vega:"*","vega-lite":"*"},fLt={},hLt={name:Y4t,version:K4t,description:Z4t,keywords:J4t,license:Q4t,author:eLt,contributors:tLt,main:nLt,module:AW,unpkg:rLt,jsdelivr:iLt,types:sLt,repository:oLt,files:aLt,scripts:uLt,devDependencies:lLt,peerDependencies:cLt,dependencies:fLt};const cm="#fff",oQ="#888",dLt={background:"#333",view:{stroke:oQ},title:{color:cm,subtitleColor:cm},style:{"guide-label":{fill:cm},"guide-title":{fill:cm}},axis:{domainColor:cm,gridColor:oQ,tickColor:cm}},ud="#4572a7",pLt={background:"#fff",arc:{fill:ud},area:{fill:ud},line:{stroke:ud,strokeWidth:2},path:{stroke:ud},rect:{fill:ud},shape:{stroke:ud},symbol:{fill:ud,strokeWidth:1.5,size:50},axis:{bandPosition:.5,grid:!0,gridColor:"#000000",gridOpacity:1,gridWidth:.5,labelPadding:10,tickSize:5,tickWidth:.5},axisBand:{grid:!1,tickExtra:!0},legend:{labelBaseline:"middle",labelFontSize:11,symbolSize:50,symbolType:"square"},range:{category:["#4572a7","#aa4643","#8aa453","#71598e","#4598ae","#d98445","#94aace","#d09393","#b9cc98","#a99cbc"]}},ld="#30a2da",$R="#cbcbcb",gLt="#999",mLt="#333",aQ="#f0f0f0",uQ="#333",yLt={arc:{fill:ld},area:{fill:ld},axis:{domainColor:$R,grid:!0,gridColor:$R,gridWidth:1,labelColor:gLt,labelFontSize:10,titleColor:mLt,tickColor:$R,tickSize:10,titleFontSize:14,titlePadding:10,labelPadding:4},axisBand:{grid:!1},background:aQ,group:{fill:aQ},legend:{labelColor:uQ,labelFontSize:11,padding:1,symbolSize:30,symbolType:"square",titleColor:uQ,titleFontSize:14,titlePadding:10},line:{stroke:ld,strokeWidth:2},path:{stroke:ld,strokeWidth:.5},rect:{fill:ld},range:{category:["#30a2da","#fc4f30","#e5ae38","#6d904f","#8b8b8b","#b96db8","#ff9e27","#56cc60","#52d2ca","#52689e","#545454","#9fe4f8"],diverging:["#cc0020","#e77866","#f6e7e1","#d6e8ed","#91bfd9","#1d78b5"],heatmap:["#d6e8ed","#cee0e5","#91bfd9","#549cc6","#1d78b5"]},point:{filled:!0,shape:"circle"},shape:{stroke:ld},bar:{binSpacing:2,fill:ld,stroke:null},title:{anchor:"start",fontSize:24,fontWeight:600,offset:20}},cd="#000",bLt={group:{fill:"#e5e5e5"},arc:{fill:cd},area:{fill:cd},line:{stroke:cd},path:{stroke:cd},rect:{fill:cd},shape:{stroke:cd},symbol:{fill:cd,size:40},axis:{domain:!1,grid:!0,gridColor:"#FFFFFF",gridOpacity:1,labelColor:"#7F7F7F",labelPadding:4,tickColor:"#7F7F7F",tickSize:5.67,titleFontSize:16,titleFontWeight:"normal"},legend:{labelBaseline:"middle",labelFontSize:11,symbolSize:40},range:{category:["#000000","#7F7F7F","#1A1A1A","#999999","#333333","#B0B0B0","#4D4D4D","#C9C9C9","#666666","#DCDCDC"]}},xLt=22,vLt="normal",lQ="Benton Gothic, sans-serif",cQ=11.5,wLt="normal",fd="#82c6df",CR="Benton Gothic Bold, sans-serif",fQ="normal",hQ=13,$b={"category-6":["#ec8431","#829eb1","#c89d29","#3580b1","#adc839","#ab7fb4"],"fire-7":["#fbf2c7","#f9e39c","#f8d36e","#f4bb6a","#e68a4f","#d15a40","#ab4232"],"fireandice-6":["#e68a4f","#f4bb6a","#f9e39c","#dadfe2","#a6b7c6","#849eae"],"ice-7":["#edefee","#dadfe2","#c4ccd2","#a6b7c6","#849eae","#607785","#47525d"]},$Lt={background:"#ffffff",title:{anchor:"start",color:"#000000",font:CR,fontSize:xLt,fontWeight:vLt},arc:{fill:fd},area:{fill:fd},line:{stroke:fd,strokeWidth:2},path:{stroke:fd},rect:{fill:fd},shape:{stroke:fd},symbol:{fill:fd,size:30},axis:{labelFont:lQ,labelFontSize:cQ,labelFontWeight:wLt,titleFont:CR,titleFontSize:hQ,titleFontWeight:fQ},axisX:{labelAngle:0,labelPadding:4,tickSize:3},axisY:{labelBaseline:"middle",maxExtent:45,minExtent:45,tickSize:2,titleAlign:"left",titleAngle:0,titleX:-45,titleY:-11},legend:{labelFont:lQ,labelFontSize:cQ,symbolType:"square",titleFont:CR,titleFontSize:hQ,titleFontWeight:fQ},range:{category:$b["category-6"],diverging:$b["fireandice-6"],heatmap:$b["fire-7"],ordinal:$b["fire-7"],ramp:$b["fire-7"]}},hd="#ab5787",OS="#979797",CLt={background:"#f9f9f9",arc:{fill:hd},area:{fill:hd},line:{stroke:hd},path:{stroke:hd},rect:{fill:hd},shape:{stroke:hd},symbol:{fill:hd,size:30},axis:{domainColor:OS,domainWidth:.5,gridWidth:.2,labelColor:OS,tickColor:OS,tickWidth:.2,titleColor:OS},axisBand:{grid:!1},axisX:{grid:!0,tickSize:10},axisY:{domain:!1,grid:!0,tickSize:0},legend:{labelFontSize:11,padding:1,symbolSize:30,symbolType:"square"},range:{category:["#ab5787","#51b2e5","#703c5c","#168dd9","#d190b6","#00609f","#d365ba","#154866","#666666","#c4c4c4"]}},dd="#3e5c69",SLt={background:"#fff",arc:{fill:dd},area:{fill:dd},line:{stroke:dd},path:{stroke:dd},rect:{fill:dd},shape:{stroke:dd},symbol:{fill:dd},axis:{domainWidth:.5,grid:!0,labelPadding:2,tickSize:5,tickWidth:.5,titleFontWeight:"normal"},axisBand:{grid:!1},axisX:{gridWidth:.2},axisY:{gridDash:[3],gridWidth:.4},legend:{labelFontSize:11,padding:1,symbolType:"square"},range:{category:["#3e5c69","#6793a6","#182429","#0570b0","#3690c0","#74a9cf","#a6bddb","#e2ddf2"]}},xo="#1696d2",dQ="#000000",kLt="#FFFFFF",RS="Lato",SR="Lato",ELt="Lato",_Lt="#DEDDDD",ALt=18,Cb={"main-colors":["#1696d2","#d2d2d2","#000000","#fdbf11","#ec008b","#55b748","#5c5859","#db2b27"],"shades-blue":["#CFE8F3","#A2D4EC","#73BFE2","#46ABDB","#1696D2","#12719E","#0A4C6A","#062635"],"shades-gray":["#F5F5F5","#ECECEC","#E3E3E3","#DCDBDB","#D2D2D2","#9D9D9D","#696969","#353535"],"shades-yellow":["#FFF2CF","#FCE39E","#FDD870","#FCCB41","#FDBF11","#E88E2D","#CA5800","#843215"],"shades-magenta":["#F5CBDF","#EB99C2","#E46AA7","#E54096","#EC008B","#AF1F6B","#761548","#351123"],"shades-green":["#DCEDD9","#BCDEB4","#98CF90","#78C26D","#55B748","#408941","#2C5C2D","#1A2E19"],"shades-black":["#D5D5D4","#ADABAC","#848081","#5C5859","#332D2F","#262223","#1A1717","#0E0C0D"],"shades-red":["#F8D5D4","#F1AAA9","#E9807D","#E25552","#DB2B27","#A4201D","#6E1614","#370B0A"],"one-group":["#1696d2","#000000"],"two-groups-cat-1":["#1696d2","#000000"],"two-groups-cat-2":["#1696d2","#fdbf11"],"two-groups-cat-3":["#1696d2","#db2b27"],"two-groups-seq":["#a2d4ec","#1696d2"],"three-groups-cat":["#1696d2","#fdbf11","#000000"],"three-groups-seq":["#a2d4ec","#1696d2","#0a4c6a"],"four-groups-cat-1":["#000000","#d2d2d2","#fdbf11","#1696d2"],"four-groups-cat-2":["#1696d2","#ec0008b","#fdbf11","#5c5859"],"four-groups-seq":["#cfe8f3","#73bf42","#1696d2","#0a4c6a"],"five-groups-cat-1":["#1696d2","#fdbf11","#d2d2d2","#ec008b","#000000"],"five-groups-cat-2":["#1696d2","#0a4c6a","#d2d2d2","#fdbf11","#332d2f"],"five-groups-seq":["#cfe8f3","#73bf42","#1696d2","#0a4c6a","#000000"],"six-groups-cat-1":["#1696d2","#ec008b","#fdbf11","#000000","#d2d2d2","#55b748"],"six-groups-cat-2":["#1696d2","#d2d2d2","#ec008b","#fdbf11","#332d2f","#0a4c6a"],"six-groups-seq":["#cfe8f3","#a2d4ec","#73bfe2","#46abdb","#1696d2","#12719e"],"diverging-colors":["#ca5800","#fdbf11","#fdd870","#fff2cf","#cfe8f3","#73bfe2","#1696d2","#0a4c6a"]},TLt={background:kLt,title:{anchor:"start",fontSize:ALt,font:RS},axisX:{domain:!0,domainColor:dQ,domainWidth:1,grid:!1,labelFontSize:12,labelFont:SR,labelAngle:0,tickColor:dQ,tickSize:5,titleFontSize:12,titlePadding:10,titleFont:RS},axisY:{domain:!1,domainWidth:1,grid:!0,gridColor:_Lt,gridWidth:1,labelFontSize:12,labelFont:SR,labelPadding:8,ticks:!1,titleFontSize:12,titlePadding:10,titleFont:RS,titleAngle:0,titleY:-10,titleX:18},legend:{labelFontSize:12,labelFont:SR,symbolSize:100,titleFontSize:12,titlePadding:10,titleFont:RS,orient:"right",offset:10},view:{stroke:"transparent"},range:{category:Cb["six-groups-cat-1"],diverging:Cb["diverging-colors"],heatmap:Cb["diverging-colors"],ordinal:Cb["six-groups-seq"],ramp:Cb["shades-blue"]},area:{fill:xo},rect:{fill:xo},line:{color:xo,stroke:xo,strokeWidth:5},trail:{color:xo,stroke:xo,strokeWidth:0,size:1},path:{stroke:xo,strokeWidth:.5},point:{filled:!0},text:{font:ELt,color:xo,fontSize:11,align:"center",fontWeight:400,size:11},style:{bar:{fill:xo,stroke:null}},arc:{fill:xo},shape:{stroke:xo},symbol:{fill:xo,size:30}},pd="#3366CC",pQ="#ccc",MS="Arial, sans-serif",ILt={arc:{fill:pd},area:{fill:pd},path:{stroke:pd},rect:{fill:pd},shape:{stroke:pd},symbol:{stroke:pd},circle:{fill:pd},background:"#fff",padding:{top:10,right:10,bottom:10,left:10},style:{"guide-label":{font:MS,fontSize:12},"guide-title":{font:MS,fontSize:12},"group-title":{font:MS,fontSize:12}},title:{font:MS,fontSize:14,fontWeight:"bold",dy:-3,anchor:"start"},axis:{gridColor:pQ,tickColor:pQ,domain:!1,grid:!0},range:{category:["#4285F4","#DB4437","#F4B400","#0F9D58","#AB47BC","#00ACC1","#FF7043","#9E9D24","#5C6BC0","#F06292","#00796B","#C2185B"],heatmap:["#c6dafc","#5e97f6","#2a56c6"]}},TW=e=>e*(1/3+1),gQ=TW(9),mQ=TW(10),yQ=TW(12),Sb="Segoe UI",bQ="wf_standard-font, helvetica, arial, sans-serif",xQ="#252423",kb="#605E5C",vQ="transparent",DLt="#C8C6C4",ia="#118DFF",NLt="#12239E",FLt="#E66C37",OLt="#6B007B",RLt="#E044A7",MLt="#744EC2",LLt="#D9B300",PLt="#D64550",Bve=ia,zve="#DEEFFF",wQ=[zve,Bve],BLt=[zve,"#c7e4ff","#b0d9ff","#9aceff","#83c3ff","#6cb9ff","#55aeff","#3fa3ff","#2898ff",Bve],zLt={view:{stroke:vQ},background:vQ,font:Sb,header:{titleFont:bQ,titleFontSize:yQ,titleColor:xQ,labelFont:Sb,labelFontSize:mQ,labelColor:kb},axis:{ticks:!1,grid:!1,domain:!1,labelColor:kb,labelFontSize:gQ,titleFont:bQ,titleColor:xQ,titleFontSize:yQ,titleFontWeight:"normal"},axisQuantitative:{tickCount:3,grid:!0,gridColor:DLt,gridDash:[1,5],labelFlush:!1},axisBand:{tickExtra:!0},axisX:{labelPadding:5},axisY:{labelPadding:10},bar:{fill:ia},line:{stroke:ia,strokeWidth:3,strokeCap:"round",strokeJoin:"round"},text:{font:Sb,fontSize:gQ,fill:kb},arc:{fill:ia},area:{fill:ia,line:!0,opacity:.6},path:{stroke:ia},rect:{fill:ia},point:{fill:ia,filled:!0,size:75},shape:{stroke:ia},symbol:{fill:ia,strokeWidth:1.5,size:50},legend:{titleFont:Sb,titleFontWeight:"bold",titleColor:kb,labelFont:Sb,labelFontSize:mQ,labelColor:kb,symbolType:"circle",symbolSize:75},range:{category:[ia,NLt,FLt,OLt,RLt,MLt,LLt,PLt],diverging:wQ,heatmap:wQ,ordinal:BLt}},kR='IBM Plex Sans,system-ui,-apple-system,BlinkMacSystemFont,".sfnstext-regular",sans-serif',$Q=400,ULt=["#8a3ffc","#33b1ff","#007d79","#ff7eb6","#fa4d56","#fff1f1","#6fdc8c","#4589ff","#d12771","#d2a106","#08bdba","#bae6ff","#ba4e00","#d4bbff"],jLt=["#6929c4","#1192e8","#005d5d","#9f1853","#fa4d56","#570408","#198038","#002d9c","#ee538b","#b28600","#009d9a","#012749","#8a3800","#a56eff"];function BF({type:e,background:t}){const n=e==="dark"?"#161616":"#ffffff",r=e==="dark"?"#f4f4f4":"#161616",i=e==="dark"?ULt:jLt,s=e==="dark"?"#d4bbff":"#6929c4";return{background:t,arc:{fill:s},area:{fill:s},path:{stroke:s},rect:{fill:s},shape:{stroke:s},symbol:{stroke:s},circle:{fill:s},view:{fill:n,stroke:n},group:{fill:n},title:{color:r,anchor:"start",dy:-15,fontSize:16,font:kR,fontWeight:600},axis:{labelColor:r,labelFontSize:12,grid:!0,gridColor:"#525252",titleColor:r,labelAngle:0},style:{"guide-label":{font:kR,fill:r,fontWeight:$Q},"guide-title":{font:kR,fill:r,fontWeight:$Q}},range:{category:i,diverging:["#750e13","#a2191f","#da1e28","#fa4d56","#ff8389","#ffb3b8","#ffd7d9","#fff1f1","#e5f6ff","#bae6ff","#82cfff","#33b1ff","#1192e8","#0072c3","#00539a","#003a6d"],heatmap:["#f6f2ff","#e8daff","#d4bbff","#be95ff","#a56eff","#8a3ffc","#6929c4","#491d8b","#31135e","#1c0f30"]}}}const WLt=BF({type:"light",background:"#ffffff"}),VLt=BF({type:"light",background:"#f4f4f4"}),GLt=BF({type:"dark",background:"#262626"}),HLt=BF({type:"dark",background:"#161616"}),qLt=hLt.version,XLt=Object.freeze(Object.defineProperty({__proto__:null,carbong10:VLt,carbong100:HLt,carbong90:GLt,carbonwhite:WLt,dark:dLt,excel:pLt,fivethirtyeight:yLt,ggplot2:bLt,googlecharts:ILt,latimes:$Lt,powerbi:zLt,quartz:CLt,urbaninstitute:TLt,version:qLt,vox:SLt},Symbol.toStringTag,{value:"Module"}));var YLt=`#vg-tooltip-element {
  visibility: hidden;
  padding: 8px;
  position: fixed;
  z-index: 1000;
  font-family: sans-serif;
  font-size: 11px;
  border-radius: 3px;
  box-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
  /* The default theme is the light theme. */
  background-color: rgba(255, 255, 255, 0.95);
  border: 1px solid #d9d9d9;
  color: black; }
  #vg-tooltip-element.visible {
    visibility: visible; }
  #vg-tooltip-element h2 {
    margin-top: 0;
    margin-bottom: 10px;
    font-size: 13px; }
  #vg-tooltip-element img {
    max-width: 200px;
    max-height: 200px; }
  #vg-tooltip-element table {
    border-spacing: 0; }
    #vg-tooltip-element table tr {
      border: none; }
      #vg-tooltip-element table tr td {
        overflow: hidden;
        text-overflow: ellipsis;
        padding-top: 2px;
        padding-bottom: 2px; }
        #vg-tooltip-element table tr td.key {
          color: #808080;
          max-width: 150px;
          text-align: right;
          padding-right: 4px; }
        #vg-tooltip-element table tr td.value {
          display: block;
          max-width: 300px;
          max-height: 7em;
          text-align: left; }
  #vg-tooltip-element.dark-theme {
    background-color: rgba(32, 32, 32, 0.9);
    border: 1px solid #f5f5f5;
    color: white; }
    #vg-tooltip-element.dark-theme td.key {
      color: #bfbfbf; }
`;const Uve="vg-tooltip-element",KLt={offsetX:10,offsetY:10,id:Uve,styleId:"vega-tooltip-style",theme:"light",disableDefaultStyle:!1,sanitize:ZLt,maxDepth:2};function ZLt(e){return String(e).replace(/&/g,"&amp;").replace(/</g,"&lt;")}function JLt(e){if(!/^[A-Za-z]+[-:.\w]*$/.test(e))throw new Error("Invalid HTML ID");return YLt.toString().replace(Uve,e)}/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */function QLt(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]]);return n}function ePt(e,t,n){if(it(e))return`[${e.map(r=>t(mn(r)?r:CQ(r,n))).join(", ")}]`;if(dt(e)){let r="";const i=e,{title:s,image:o}=i,a=QLt(i,["title","image"]);s&&(r+=`<h2>${t(s)}</h2>`),o&&(r+=`<img src="${t(o)}">`);const u=Object.keys(a);if(u.length>0){r+="<table>";for(const l of u){let c=a[l];c!==void 0&&(dt(c)&&(c=CQ(c,n)),r+=`<tr><td class="key">${t(l)}:</td><td class="value">${t(c)}</td></tr>`)}r+="</table>"}return r||"{}"}return t(e)}function tPt(e){const t=[];return function(n,r){if(typeof r!="object"||r===null)return r;const i=t.indexOf(this)+1;return t.length=i,t.length>e?"[Object]":t.indexOf(r)>=0?"[Circular]":(t.push(r),r)}}function CQ(e,t){return JSON.stringify(e,tPt(t))}function nPt(e,t,n,r){let i=e.clientX+n;i+t.width>window.innerWidth&&(i=+e.clientX-n-t.width);let s=e.clientY+r;return s+t.height>window.innerHeight&&(s=+e.clientY-r-t.height),{x:i,y:s}}class rPt{constructor(t){this.options=Object.assign(Object.assign({},KLt),t);const n=this.options.id;if(this.el=null,this.call=this.tooltipHandler.bind(this),!this.options.disableDefaultStyle&&!document.getElementById(this.options.styleId)){const r=document.createElement("style");r.setAttribute("id",this.options.styleId),r.innerHTML=JLt(n);const i=document.head;i.childNodes.length>0?i.insertBefore(r,i.childNodes[0]):i.appendChild(r)}}tooltipHandler(t,n,r,i){if(this.el=document.getElementById(this.options.id),this.el||(this.el=document.createElement("div"),this.el.setAttribute("id",this.options.id),this.el.classList.add("vg-tooltip"),document.body.appendChild(this.el)),(document.fullscreenElement!=null?document.fullscreenElement:document.body).appendChild(this.el),i==null||i===""){this.el.classList.remove("visible",`${this.options.theme}-theme`);return}this.el.innerHTML=ePt(i,this.options.sanitize,this.options.maxDepth),this.el.classList.add("visible",`${this.options.theme}-theme`);const{x:o,y:a}=nPt(n,this.el.getBoundingClientRect(),this.options.offsetX,this.options.offsetY);this.el.setAttribute("style",`top: ${a}px; left: ${o}px`)}}/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */function bA(e,t,n,r){function i(s){return s instanceof n?s:new n(function(o){o(s)})}return new(n||(n=Promise))(function(s,o){function a(c){try{l(r.next(c))}catch(f){o(f)}}function u(c){try{l(r.throw(c))}catch(f){o(f)}}function l(c){c.done?s(c.value):i(c.value).then(a,u)}l((r=r.apply(e,t||[])).next())})}function iPt(e,t,n){const r=e.open(t),i=1e4,s=250,{origin:o}=new URL(t);let a=~~(i/s);function u(c){c.source===r&&(a=0,e.removeEventListener("message",u,!1))}e.addEventListener("message",u,!1);function l(){a<=0||(r.postMessage(n,o),setTimeout(l,s),a-=1)}setTimeout(l,s)}var sPt=`.vega-embed {
  position: relative;
  display: inline-block;
  box-sizing: border-box; }
  .vega-embed.has-actions {
    padding-right: 38px; }
  .vega-embed details:not([open]) > :not(summary) {
    display: none !important; }
  .vega-embed summary {
    list-style: none;
    position: absolute;
    top: 0;
    right: 0;
    padding: 6px;
    z-index: 1000;
    background: white;
    box-shadow: 1px 1px 3px rgba(0, 0, 0, 0.1);
    color: #1b1e23;
    border: 1px solid #aaa;
    border-radius: 999px;
    opacity: 0.2;
    transition: opacity 0.4s ease-in;
    outline: none;
    cursor: pointer;
    line-height: 0px; }
    .vega-embed summary::-webkit-details-marker {
      display: none; }
    .vega-embed summary:active {
      box-shadow: #aaa 0px 0px 0px 1px inset; }
    .vega-embed summary svg {
      width: 14px;
      height: 14px; }
  .vega-embed details[open] summary {
    opacity: 0.7; }
  .vega-embed:hover summary,
  .vega-embed:focus summary {
    opacity: 1 !important;
    transition: opacity 0.2s ease; }
  .vega-embed .vega-actions {
    position: absolute;
    z-index: 1001;
    top: 35px;
    right: -9px;
    display: flex;
    flex-direction: column;
    padding-bottom: 8px;
    padding-top: 8px;
    border-radius: 4px;
    box-shadow: 0 2px 8px 0 rgba(0, 0, 0, 0.2);
    border: 1px solid #d9d9d9;
    background: white;
    animation-duration: 0.15s;
    animation-name: scale-in;
    animation-timing-function: cubic-bezier(0.2, 0, 0.13, 1.5);
    text-align: left; }
    .vega-embed .vega-actions a {
      padding: 8px 16px;
      font-family: sans-serif;
      font-size: 14px;
      font-weight: 600;
      white-space: nowrap;
      color: #434a56;
      text-decoration: none; }
      .vega-embed .vega-actions a:hover {
        background-color: #f7f7f9;
        color: black; }
    .vega-embed .vega-actions::before, .vega-embed .vega-actions::after {
      content: "";
      display: inline-block;
      position: absolute; }
    .vega-embed .vega-actions::before {
      left: auto;
      right: 14px;
      top: -16px;
      border: 8px solid #0000;
      border-bottom-color: #d9d9d9; }
    .vega-embed .vega-actions::after {
      left: auto;
      right: 15px;
      top: -14px;
      border: 7px solid #0000;
      border-bottom-color: #fff; }
  .vega-embed .chart-wrapper {
    width: 100%;
    height: 100%; }

.vega-embed-wrapper {
  max-width: 100%;
  overflow: auto;
  padding-right: 14px; }

@keyframes scale-in {
  from {
    opacity: 0;
    transform: scale(0.6); }
  to {
    opacity: 1;
    transform: scale(1); } }
`;String.prototype.startsWith||(String.prototype.startsWith=function(e,t){return this.substr(!t||t<0?0:+t,e.length)===e});function jve(e,...t){for(const n of t)oPt(e,n);return e}function oPt(e,t){for(const n of Object.keys(t))WI(e,n,t[n],!0)}var ER;const Ol=AAt;let G0=X4t;const LS=typeof window<"u"?window:void 0;G0===void 0&&(!((ER=LS==null?void 0:LS.vl)===null||ER===void 0)&&ER.compile)&&(G0=LS.vl);const Wve={export:{svg:!0,png:!0},source:!0,compiled:!0,editor:!0},aPt={CLICK_TO_VIEW_ACTIONS:"Click to view actions",COMPILED_ACTION:"View Compiled Vega",EDITOR_ACTION:"Open in Vega Editor",PNG_ACTION:"Save as PNG",SOURCE_ACTION:"View Source",SVG_ACTION:"Save as SVG"},sx={vega:"Vega","vega-lite":"Vega-Lite"},xA={vega:Ol.version,"vega-lite":G0?G0.version:"not available"},uPt={vega:e=>e,"vega-lite":(e,t)=>G0.compile(e,{config:t}).spec},lPt=`
<svg viewBox="0 0 16 16" fill="currentColor" stroke="none" stroke-width="1" stroke-linecap="round" stroke-linejoin="round">
  <circle r="2" cy="8" cx="2"></circle>
  <circle r="2" cy="8" cx="8"></circle>
  <circle r="2" cy="8" cx="14"></circle>
</svg>`,cPt="chart-wrapper";function fPt(e){return typeof e=="function"}function SQ(e,t,n,r){const i=`<html><head>${t}</head><body><pre><code class="json">`,s=`</code></pre>${n}</body></html>`,o=window.open("");o.document.write(i+e+s),o.document.title=`${sx[r]} JSON Source`}function Vve(e,t){var n;if(e.$schema){const r=Pve(e.$schema);t&&t!==r.library&&console.warn(`The given visualization spec is written in ${sx[r.library]}, but mode argument sets ${(n=sx[t])!==null&&n!==void 0?n:t}.`);const i=r.library;return Iae.satisfies(xA[i],`^${r.version.slice(1)}`)||console.warn(`The input spec uses ${sx[i]} ${r.version}, but the current version of ${sx[i]} is v${xA[i]}.`),i}return"mark"in e||"encoding"in e||"layer"in e||"hconcat"in e||"vconcat"in e||"facet"in e||"repeat"in e?"vega-lite":"marks"in e||"signals"in e||"scales"in e||"axes"in e?"vega":t??"vega"}function hPt(e){return!!(e&&"load"in e)}function kQ(e){return hPt(e)?e:Ol.loader(e)}function EQ(e){var t;return(t=e.usermeta&&e.usermeta.embedOptions)!==null&&t!==void 0?t:{}}function dPt(e,t,n={}){var r,i,s;return bA(this,void 0,void 0,function*(){let o,a;mn(t)?(a=kQ(n.loader),o=JSON.parse(yield a.load(t))):o=t;const u=EQ(o).loader;(!a||u)&&(a=kQ((r=n.loader)!==null&&r!==void 0?r:u));const l=yield _Q(EQ(o),a),c=yield _Q(n,a),f=Object.assign(Object.assign({},jve(c,l)),{config:jI((i=c.config)!==null&&i!==void 0?i:{},(s=l.config)!==null&&s!==void 0?s:{})});return yield gPt(e,o,f,a)})}function _Q(e,t){var n;return bA(this,void 0,void 0,function*(){const r=mn(e.config)?JSON.parse(yield t.load(e.config)):(n=e.config)!==null&&n!==void 0?n:{},i=mn(e.patch)?JSON.parse(yield t.load(e.patch)):e.patch;return Object.assign(Object.assign(Object.assign({},e),i?{patch:i}:{}),r?{config:r}:{})})}function pPt(e){var t;const n=e.getRootNode?e.getRootNode():document;return n instanceof ShadowRoot?{root:n,rootContainer:n}:{root:document,rootContainer:(t=document.head)!==null&&t!==void 0?t:document.body}}function gPt(e,t,n={},r){var i,s,o,a,u,l;return bA(this,void 0,void 0,function*(){const c=n.theme?jI(XLt[n.theme],(i=n.config)!==null&&i!==void 0?i:{}):n.config,f=qae(n.actions)?n.actions:jve({},Wve,(s=n.actions)!==null&&s!==void 0?s:{}),h=Object.assign(Object.assign({},aPt),n.i18n),d=(o=n.renderer)!==null&&o!==void 0?o:"canvas",p=(a=n.logLevel)!==null&&a!==void 0?a:Ol.Warn,g=(u=n.downloadFileName)!==null&&u!==void 0?u:"visualization",m=typeof e=="string"?document.querySelector(e):e;if(!m)throw new Error(`${e} does not exist`);if(n.defaultStyle!==!1){const _="vega-embed-style",{root:D,rootContainer:A}=pPt(m);if(!D.getElementById(_)){const T=document.createElement("style");T.id=_,T.innerText=n.defaultStyle===void 0||n.defaultStyle===!0?sPt.toString():n.defaultStyle,A.appendChild(T)}}const y=Vve(t,n.mode);let b=uPt[y](t,c);if(y==="vega-lite"&&b.$schema){const _=Pve(b.$schema);Iae.satisfies(xA.vega,`^${_.version.slice(1)}`)||console.warn(`The compiled spec uses Vega ${_.version}, but current version is v${xA.vega}.`)}m.classList.add("vega-embed"),f&&m.classList.add("has-actions"),m.innerHTML="";let v=m;if(f){const _=document.createElement("div");_.classList.add(cPt),m.appendChild(_),v=_}const x=n.patch;x&&(x instanceof Function?b=x(b):b=RI(b,x,!0,!1).newDocument),n.formatLocale&&Ol.formatLocale(n.formatLocale),n.timeFormatLocale&&Ol.timeFormatLocale(n.timeFormatLocale);const{ast:w}=n,C=Ol.parse(b,y==="vega-lite"?{}:c,{ast:w}),$=new(n.viewClass||Ol.View)(C,Object.assign({loader:r,logLevel:p,renderer:d},w?{expr:Ol.expressionInterpreter}:{}));if(n.tooltip!==!1){let _;fPt(n.tooltip)?_=n.tooltip:_=new rPt(n.tooltip===!0?{}:n.tooltip).call,$.tooltip(_)}let{hover:S}=n;if(S===void 0&&(S=y==="vega"),S){const{hoverSet:_,updateSet:D}=typeof S=="boolean"?{}:S;$.hover(_,D)}n&&(n.width!=null&&$.width(n.width),n.height!=null&&$.height(n.height),n.padding!=null&&$.padding(n.padding)),yield $.initialize(v,n.bind).runAsync();let k;if(f!==!1){let _=m;if(n.defaultStyle!==!1){const A=document.createElement("details");A.title=h.CLICK_TO_VIEW_ACTIONS,m.append(A),_=A;const T=document.createElement("summary");T.innerHTML=lPt,A.append(T),k=I=>{A.contains(I.target)||A.removeAttribute("open")},document.addEventListener("click",k)}const D=document.createElement("div");if(_.append(D),D.classList.add("vega-actions"),f===!0||f.export!==!1){for(const A of["svg","png"])if(f===!0||f.export===!0||f.export[A]){const T=h[`${A.toUpperCase()}_ACTION`],I=document.createElement("a");I.text=T,I.href="#",I.target="_blank",I.download=`${g}.${A}`,I.addEventListener("mousedown",function(F){return bA(this,void 0,void 0,function*(){F.preventDefault();const R=yield $.toImageURL(A,n.scaleFactor);this.href=R})}),D.append(I)}}if(f===!0||f.source!==!1){const A=document.createElement("a");A.text=h.SOURCE_ACTION,A.href="#",A.addEventListener("click",function(T){var I,F;SQ(m3(t),(I=n.sourceHeader)!==null&&I!==void 0?I:"",(F=n.sourceFooter)!==null&&F!==void 0?F:"",y),T.preventDefault()}),D.append(A)}if(y==="vega-lite"&&(f===!0||f.compiled!==!1)){const A=document.createElement("a");A.text=h.COMPILED_ACTION,A.href="#",A.addEventListener("click",function(T){var I,F;SQ(m3(b),(I=n.sourceHeader)!==null&&I!==void 0?I:"",(F=n.sourceFooter)!==null&&F!==void 0?F:"","vega"),T.preventDefault()}),D.append(A)}if(f===!0||f.editor!==!1){const A=(l=n.editorUrl)!==null&&l!==void 0?l:"https://vega.github.io/editor/",T=document.createElement("a");T.text=h.EDITOR_ACTION,T.href="#",T.addEventListener("click",function(I){iPt(window,A,{config:c,mode:y,renderer:d,spec:m3(t)}),I.preventDefault()}),D.append(T)}}function E(){k&&document.removeEventListener("click",k),$.finalize()}return{view:$,spec:t,vgSpec:b,finalize:E}})}const mPt=Object.freeze(Object.defineProperty({__proto__:null,DEFAULT_ACTIONS:Wve,default:dPt,guessMode:Vve,vega:Ol,get vegaLite(){return G0}},Symbol.toStringTag,{value:"Module"})),Ly=Qp(mPt);var Qo={},ye={};/*
object-assign
(c) Sindre Sorhus
@license MIT
*/var AQ=Object.getOwnPropertySymbols,yPt=Object.prototype.hasOwnProperty,bPt=Object.prototype.propertyIsEnumerable;function xPt(e){if(e==null)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(e)}function vPt(){try{if(!Object.assign)return!1;var e=new String("abc");if(e[5]="de",Object.getOwnPropertyNames(e)[0]==="5")return!1;for(var t={},n=0;n<10;n++)t["_"+String.fromCharCode(n)]=n;var r=Object.getOwnPropertyNames(t).map(function(s){return t[s]});if(r.join("")!=="0123456789")return!1;var i={};return"abcdefghijklmnopqrst".split("").forEach(function(s){i[s]=s}),Object.keys(Object.assign({},i)).join("")==="abcdefghijklmnopqrst"}catch{return!1}}var IW=vPt()?Object.assign:function(e,t){for(var n,r=xPt(e),i,s=1;s<arguments.length;s++){n=Object(arguments[s]);for(var o in n)yPt.call(n,o)&&(r[o]=n[o]);if(AQ){i=AQ(n);for(var a=0;a<i.length;a++)bPt.call(n,i[a])&&(r[i[a]]=n[i[a]])}}return r},DW={};Object.defineProperty(DW,"__esModule",{value:!0});DW.StyleSheet=Gve;var wPt=IW,$Pt=CPt(wPt);function CPt(e){return e&&e.__esModule?e:{default:e}}function SPt(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}else return Array.from(e)}function _R(e){return e[e.length-1]}function TQ(e){if(e.sheet)return e.sheet;for(var t=0;t<document.styleSheets.length;t++)if(document.styleSheets[t].ownerNode===e)return document.styleSheets[t]}var Od=typeof window<"u",kPt=!1,EPt=function(){if(Od){var e=document.createElement("div");return e.innerHTML="<!--[if lt IE 10]><i></i><![endif]-->",e.getElementsByTagName("i").length===1}}();function IQ(){var e=document.createElement("style");return e.type="text/css",e.setAttribute("data-glamor",""),e.appendChild(document.createTextNode("")),(document.head||document.getElementsByTagName("head")[0]).appendChild(e),e}function Gve(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=e.speedy,n=t===void 0?!kPt:t,r=e.maxLength,i=r===void 0?Od&&EPt?4e3:65e3:r;this.isSpeedy=n,this.sheet=void 0,this.tags=[],this.maxLength=i,this.ctr=0}(0,$Pt.default)(Gve.prototype,{getSheet:function(){return TQ(_R(this.tags))},inject:function(){var t=this;if(this.injected)throw new Error("already injected stylesheet!");Od?this.tags[0]=IQ():this.sheet={cssRules:[],insertRule:function(r){t.sheet.cssRules.push({cssText:r})}},this.injected=!0},speedy:function(t){if(this.ctr!==0)throw new Error("cannot change speedy mode after inserting any rule to sheet. Either call speedy("+t+") earlier in your app, or call flush() before speedy("+t+")");this.isSpeedy=!!t},_insert:function(t){try{var n=this.getSheet();n.insertRule(t,t.indexOf("@import")!==-1?0:n.cssRules.length)}catch{}},insert:function(t){if(Od)if(this.isSpeedy&&this.getSheet().insertRule)this._insert(t);else if(t.indexOf("@import")!==-1){var n=_R(this.tags);n.insertBefore(document.createTextNode(t),n.firstChild)}else _R(this.tags).appendChild(document.createTextNode(t));else this.sheet.insertRule(t,t.indexOf("@import")!==-1?0:this.sheet.cssRules.length);return this.ctr++,Od&&this.ctr%this.maxLength===0&&this.tags.push(IQ()),this.ctr-1},delete:function(t){return this.replace(t,"")},flush:function(){Od?(this.tags.forEach(function(t){return t.parentNode.removeChild(t)}),this.tags=[],this.sheet=null,this.ctr=0):this.sheet.cssRules=[],this.injected=!1},rules:function(){if(!Od)return this.sheet.cssRules;var t=[];return this.tags.forEach(function(n){return t.splice.apply(t,[t.length,0].concat(SPt(Array.from(TQ(n).cssRules))))}),t}});var Py={},_Pt=/-(.)/g;function APt(e){return e.replace(_Pt,function(t,n){return n.toUpperCase()})}var TPt=APt,IPt=TPt,DPt=/^-ms-/;function NPt(e){return IPt(e.replace(DPt,"ms-"))}var FPt=NPt,NW={},FW={};Object.defineProperty(FW,"__esModule",{value:!0});var Ek={animationIterationCount:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridRow:!0,gridRowStart:!0,gridRowEnd:!0,gridColumn:!0,gridColumnStart:!0,gridColumnEnd:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0};function OPt(e,t){return e+t.charAt(0).toUpperCase()+t.substring(1)}var RPt=["Webkit","ms","Moz","O"];Object.keys(Ek).forEach(function(e){RPt.forEach(function(t){Ek[OPt(t,e)]=Ek[e]})});var MPt={background:{backgroundAttachment:!0,backgroundColor:!0,backgroundImage:!0,backgroundPositionX:!0,backgroundPositionY:!0,backgroundRepeat:!0},backgroundPosition:{backgroundPositionX:!0,backgroundPositionY:!0},border:{borderWidth:!0,borderStyle:!0,borderColor:!0},borderBottom:{borderBottomWidth:!0,borderBottomStyle:!0,borderBottomColor:!0},borderLeft:{borderLeftWidth:!0,borderLeftStyle:!0,borderLeftColor:!0},borderRight:{borderRightWidth:!0,borderRightStyle:!0,borderRightColor:!0},borderTop:{borderTopWidth:!0,borderTopStyle:!0,borderTopColor:!0},font:{fontStyle:!0,fontVariant:!0,fontWeight:!0,fontSize:!0,lineHeight:!0,fontFamily:!0},outline:{outlineWidth:!0,outlineStyle:!0,outlineColor:!0}},LPt={isUnitlessNumber:Ek,shorthandPropertyExpansions:MPt};FW.default=LPt;function zF(e){return function(){return e}}var Xg=function(){};Xg.thatReturns=zF;Xg.thatReturnsFalse=zF(!1);Xg.thatReturnsTrue=zF(!0);Xg.thatReturnsNull=zF(null);Xg.thatReturnsThis=function(){return this};Xg.thatReturnsArgument=function(e){return e};var PPt=Xg,BPt=PPt,zPt=BPt,Hve=zPt;Object.defineProperty(NW,"__esModule",{value:!0});var UPt=FW,jPt=qve(UPt),WPt=Hve;qve(WPt);function qve(e){return e&&e.__esModule?e:{default:e}}var DQ=jPt.default.isUnitlessNumber;function VPt(e,t,n){var r=t==null||typeof t=="boolean"||t==="";if(r)return"";var i=isNaN(t);return i||t===0||DQ.hasOwnProperty(e)&&DQ[e]?""+t:(typeof t=="string"&&(t=t.trim()),t+"px")}NW.default=VPt;var GPt=/([A-Z])/g;function HPt(e){return e.replace(GPt,"-$1").toLowerCase()}var qPt=HPt,XPt=qPt,YPt=/^ms-/;function KPt(e){return XPt(e).replace(YPt,"-ms-")}var ZPt=KPt;function JPt(e){var t={};return function(n){return t.hasOwnProperty(n)||(t[n]=e.call(this,n)),t[n]}}var QPt=JPt;Object.defineProperty(Py,"__esModule",{value:!0});Py.processStyleName=void 0;Py.createMarkupForStyles=lBt;var eBt=FPt;pC(eBt);var tBt=NW,nBt=pC(tBt),rBt=ZPt,iBt=pC(rBt),sBt=QPt,oBt=pC(sBt),aBt=Hve;pC(aBt);function pC(e){return e&&e.__esModule?e:{default:e}}var uBt=Py.processStyleName=(0,oBt.default)(iBt.default);function lBt(e,t){var n="";for(var r in e){var i=r.indexOf("--")===0;if(e.hasOwnProperty(r)&&r!=="label"){var s=e[r];s!=null&&(i?n+=r+":"+s+";":(n+=uBt(r)+":",n+=(0,nBt.default)(r,s,t)+";"))}}return n||null}var OW={};Object.defineProperty(OW,"__esModule",{value:!0});var Xve=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};OW.default=RW;function cBt(e){return e==null||e===!1||(typeof e>"u"?"undefined":Xve(e))==="object"&&Object.keys(e).length===0}function fBt(e){if(cBt(e))return null;if((typeof e>"u"?"undefined":Xve(e))!=="object")return e;for(var t={},n=Object.keys(e),r=!1,i=0;i<n.length;i++){var s=e[n[i]],o=RW(s);(o===null||o!==s)&&(r=!0),o!==null&&(t[n[i]]=o)}return Object.keys(t).length===0?null:r?t:e}function hBt(e){var t=!1,n=[];return e.forEach(function(r){var i=RW(r);(i===null||i!==r)&&(t=!0),i!==null&&n.push(i)}),n.length==0?null:t?n:e}function RW(e){return Array.isArray(e)?hBt(e):fBt(e)}var By={},MW={},CP={exports:{}};(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=["Webkit"],r=["Moz"],i=["ms"],s=["Webkit","Moz"],o=["Webkit","ms"],a=["Webkit","Moz","ms"];t.default={plugins:[],prefixMap:{appearance:s,userSelect:a,textEmphasisPosition:n,textEmphasis:n,textEmphasisStyle:n,textEmphasisColor:n,boxDecorationBreak:n,clipPath:n,maskImage:n,maskMode:n,maskRepeat:n,maskPosition:n,maskClip:n,maskOrigin:n,maskSize:n,maskComposite:n,mask:n,maskBorderSource:n,maskBorderMode:n,maskBorderSlice:n,maskBorderWidth:n,maskBorderOutset:n,maskBorderRepeat:n,maskBorder:n,maskType:n,textDecorationStyle:n,textDecorationSkip:n,textDecorationLine:n,textDecorationColor:n,filter:n,fontFeatureSettings:n,breakAfter:a,breakBefore:a,breakInside:a,columnCount:s,columnFill:s,columnGap:s,columnRule:s,columnRuleColor:s,columnRuleStyle:s,columnRuleWidth:s,columns:s,columnSpan:s,columnWidth:s,writingMode:o,flex:n,flexBasis:n,flexDirection:n,flexGrow:n,flexFlow:n,flexShrink:n,flexWrap:n,alignContent:n,alignItems:n,alignSelf:n,justifyContent:n,order:n,transform:n,transformOrigin:n,transformOriginX:n,transformOriginY:n,backfaceVisibility:n,perspective:n,perspectiveOrigin:n,transformStyle:n,transformOriginZ:n,animation:n,animationDelay:n,animationDirection:n,animationFillMode:n,animationDuration:n,animationIterationCount:n,animationName:n,animationPlayState:n,animationTimingFunction:n,backdropFilter:n,fontKerning:n,scrollSnapType:o,scrollSnapPointsX:o,scrollSnapPointsY:o,scrollSnapDestination:o,scrollSnapCoordinate:o,shapeImageThreshold:n,shapeImageMargin:n,shapeImageOutside:n,hyphens:a,flowInto:o,flowFrom:o,regionFragment:o,textAlignLast:r,tabSize:r,wrapFlow:i,wrapThrough:i,wrapMargin:i,gridTemplateColumns:i,gridTemplateRows:i,gridTemplateAreas:i,gridTemplate:i,gridAutoColumns:i,gridAutoRows:i,gridAutoFlow:i,grid:i,gridRowStart:i,gridColumnStart:i,gridRowEnd:i,gridRow:i,gridColumn:i,gridColumnEnd:i,gridColumnGap:i,gridRowGap:i,gridArea:i,gridGap:i,textSizeAdjust:o,borderImage:n,borderImageOutset:n,borderImageRepeat:n,borderImageSlice:n,borderImageSource:n,borderImageWidth:n,transitionDelay:n,transitionDuration:n,transitionProperty:n,transitionTimingFunction:n}},e.exports=t.default})(CP,CP.exports);var dBt=CP.exports,SP={exports:{}},kP={exports:{}};(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=n;function n(r){return r.charAt(0).toUpperCase()+r.slice(1)}e.exports=t.default})(kP,kP.exports);var Yve=kP.exports;(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=s;var n=Yve,r=i(n);function i(o){return o&&o.__esModule?o:{default:o}}function s(o,a,u){if(o.hasOwnProperty(a))for(var l=o[a],c=0,f=l.length;c<f;++c)u[l[c]+(0,r.default)(a)]=u[a]}e.exports=t.default})(SP,SP.exports);var pBt=SP.exports,EP={exports:{}};(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=n;function n(r,i,s,o,a){for(var u=0,l=r.length;u<l;++u){var c=r[u](i,s,o,a);if(c)return c}}e.exports=t.default})(EP,EP.exports);var gBt=EP.exports,_P={exports:{}};(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=i;var n=["-webkit-","-moz-",""],r={"zoom-in":!0,"zoom-out":!0,grab:!0,grabbing:!0};function i(s,o){if(s==="cursor"&&r.hasOwnProperty(o))return n.map(function(a){return a+o})}e.exports=t.default})(_P,_P.exports);var mBt=_P.exports,AP={exports:{}},TP={exports:{}};(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=r;var n=/-webkit-|-moz-|-ms-/;function r(i){return typeof i=="string"&&n.test(i)}e.exports=t.default})(TP,TP.exports);var gC=TP.exports;(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=o;var n=gC,r=i(n);function i(a){return a&&a.__esModule?a:{default:a}}var s=["-webkit-",""];function o(a,u){if(typeof u=="string"&&!(0,r.default)(u)&&u.indexOf("cross-fade(")>-1)return s.map(function(l){return u.replace(/cross-fade\(/g,l+"cross-fade(")})}e.exports=t.default})(AP,AP.exports);var yBt=AP.exports,IP={exports:{}};(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=o;var n=gC,r=i(n);function i(a){return a&&a.__esModule?a:{default:a}}var s=["-webkit-",""];function o(a,u){if(typeof u=="string"&&!(0,r.default)(u)&&u.indexOf("filter(")>-1)return s.map(function(l){return u.replace(/filter\(/g,l+"filter(")})}e.exports=t.default})(IP,IP.exports);var bBt=IP.exports,DP={exports:{}};(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=r;var n={flex:["-webkit-box","-moz-box","-ms-flexbox","-webkit-flex","flex"],"inline-flex":["-webkit-inline-box","-moz-inline-box","-ms-inline-flexbox","-webkit-inline-flex","inline-flex"]};function r(i,s){if(i==="display"&&n.hasOwnProperty(s))return n[s]}e.exports=t.default})(DP,DP.exports);var xBt=DP.exports,NP={exports:{}};(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=i;var n={"space-around":"justify","space-between":"justify","flex-start":"start","flex-end":"end","wrap-reverse":"multiple",wrap:"multiple"},r={alignItems:"WebkitBoxAlign",justifyContent:"WebkitBoxPack",flexWrap:"WebkitBoxLines"};function i(s,o,a){s==="flexDirection"&&typeof o=="string"&&(o.indexOf("column")>-1?a.WebkitBoxOrient="vertical":a.WebkitBoxOrient="horizontal",o.indexOf("reverse")>-1?a.WebkitBoxDirection="reverse":a.WebkitBoxDirection="normal"),r.hasOwnProperty(s)&&(a[r[s]]=n[o]||o)}e.exports=t.default})(NP,NP.exports);var vBt=NP.exports,FP={exports:{}};(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=a;var n=gC,r=i(n);function i(u){return u&&u.__esModule?u:{default:u}}var s=["-webkit-","-moz-",""],o=/linear-gradient|radial-gradient|repeating-linear-gradient|repeating-radial-gradient/;function a(u,l){if(typeof l=="string"&&!(0,r.default)(l)&&o.test(l))return s.map(function(c){return c+l})}e.exports=t.default})(FP,FP.exports);var wBt=FP.exports,OP={exports:{}};(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=o;var n=gC,r=i(n);function i(a){return a&&a.__esModule?a:{default:a}}var s=["-webkit-",""];function o(a,u){if(typeof u=="string"&&!(0,r.default)(u)&&u.indexOf("image-set(")>-1)return s.map(function(l){return u.replace(/image-set\(/g,l+"image-set(")})}e.exports=t.default})(OP,OP.exports);var $Bt=OP.exports,RP={exports:{}};(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=n;function n(r,i){if(r==="position"&&i==="sticky")return["-webkit-sticky","sticky"]}e.exports=t.default})(RP,RP.exports);var CBt=RP.exports,MP={exports:{}};(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=s;var n=["-webkit-","-moz-",""],r={maxHeight:!0,maxWidth:!0,width:!0,height:!0,columnWidth:!0,minWidth:!0,minHeight:!0},i={"min-content":!0,"max-content":!0,"fill-available":!0,"fit-content":!0,"contain-floats":!0};function s(o,a){if(r.hasOwnProperty(o)&&i.hasOwnProperty(a))return n.map(function(u){return u+a})}e.exports=t.default})(MP,MP.exports);var SBt=MP.exports,LP={exports:{}},PP={exports:{}},kBt=/[A-Z]/g,EBt=/^ms-/,AR={};function _Bt(e){return"-"+e.toLowerCase()}function ABt(e){if(AR.hasOwnProperty(e))return AR[e];var t=e.replace(kBt,_Bt);return AR[e]=EBt.test(t)?"-"+t:t}const TBt=Object.freeze(Object.defineProperty({__proto__:null,default:ABt},Symbol.toStringTag,{value:"Module"})),IBt=Qp(TBt);(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=s;var n=IBt,r=i(n);function i(o){return o&&o.__esModule?o:{default:o}}function s(o){return(0,r.default)(o)}e.exports=t.default})(PP,PP.exports);var DBt=PP.exports;(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=h;var n=DBt,r=u(n),i=gC,s=u(i),o=Yve,a=u(o);function u(d){return d&&d.__esModule?d:{default:d}}var l={transition:!0,transitionProperty:!0,WebkitTransition:!0,WebkitTransitionProperty:!0,MozTransition:!0,MozTransitionProperty:!0},c={Webkit:"-webkit-",Moz:"-moz-",ms:"-ms-"};function f(d,p){if((0,s.default)(d))return d;for(var g=d.split(/,(?![^()]*(?:\([^()]*\))?\))/g),m=0,y=g.length;m<y;++m){var b=g[m],v=[b];for(var x in p){var w=(0,r.default)(x);if(b.indexOf(w)>-1&&w!=="order")for(var C=p[x],$=0,S=C.length;$<S;++$)v.unshift(b.replace(w,c[C[$]]+w))}g[m]=v.join(",")}return g.join(",")}function h(d,p,g,m){if(typeof p=="string"&&l.hasOwnProperty(d)){var y=f(p,m),b=y.split(/,(?![^()]*(?:\([^()]*\))?\))/g).filter(function(x){return!/-moz-|-ms-/.test(x)}).join(",");if(d.indexOf("Webkit")>-1)return b;var v=y.split(/,(?![^()]*(?:\([^()]*\))?\))/g).filter(function(x){return!/-webkit-|-ms-/.test(x)}).join(",");return d.indexOf("Moz")>-1?v:(g["Webkit"+(0,a.default)(d)]=b,g["Moz"+(0,a.default)(d)]=v,y)}}e.exports=t.default})(LP,LP.exports);var NBt=LP.exports;Object.defineProperty(MW,"__esModule",{value:!0});MW.default=o5t;var FBt=dBt,OBt=fo(FBt),RBt=pBt,MBt=fo(RBt),LBt=gBt,PBt=fo(LBt),BBt=mBt,zBt=fo(BBt),UBt=yBt,jBt=fo(UBt),WBt=bBt,VBt=fo(WBt),GBt=xBt,HBt=fo(GBt),qBt=vBt,XBt=fo(qBt),YBt=wBt,KBt=fo(YBt),ZBt=$Bt,JBt=fo(ZBt),QBt=CBt,e5t=fo(QBt),t5t=SBt,n5t=fo(t5t),r5t=NBt,i5t=fo(r5t);function fo(e){return e&&e.__esModule?e:{default:e}}var s5t=[jBt.default,zBt.default,VBt.default,XBt.default,KBt.default,JBt.default,e5t.default,n5t.default,i5t.default,HBt.default],NQ=OBt.default.prefixMap;function o5t(e){for(var t in e){var n=e[t],r=(0,PBt.default)(s5t,t,n,e,NQ);r&&(e[t]=r),(0,MBt.default)(NQ,t,e)}return e}Object.defineProperty(By,"__esModule",{value:!0});var BP=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e};By.PluginSet=Zve;By.fallbacks=h5t;By.contentWrap=p5t;By.prefixes=g5t;var a5t=IW,LW=Kve(a5t),u5t=Py,l5t=MW,c5t=Kve(l5t);function Kve(e){return e&&e.__esModule?e:{default:e}}var f5t=function(e){return e==="development"||!e}("production");function Zve(e){this.fns=e||[]}(0,LW.default)(Zve.prototype,{add:function(){for(var t=this,n=arguments.length,r=Array(n),i=0;i<n;i++)r[i]=arguments[i];r.forEach(function(s){t.fns.indexOf(s)>=0?f5t&&console.warn("adding the same plugin again, ignoring"):t.fns=[s].concat(t.fns)})},remove:function(t){this.fns=this.fns.filter(function(n){return n!==t})},clear:function(){this.fns=[]},transform:function(t){return this.fns.reduce(function(n,r){return r(n)},t)}});function h5t(e){var t=Object.keys(e.style).map(function(i){return Array.isArray(e.style[i])}).indexOf(!0)>=0;if(t){var n=e.style,r=Object.keys(n).reduce(function(i,s){return i[s]=Array.isArray(n[s])?n[s].join("; "+(0,u5t.processStyleName)(s)+": "):n[s],i},{});return(0,LW.default)({},e,{style:r})}return e}var d5t=["normal","none","counter","open-quote","close-quote","no-open-quote","no-close-quote","initial","inherit"];function p5t(e){if(e.style.content){var t=e.style.content;return d5t.indexOf(t)>=0||/^(attr|calc|counters?|url)\(/.test(t)||t.charAt(0)===t.charAt(t.length-1)&&(t.charAt(0)==='"'||t.charAt(0)==="'")?e:BP({},e,{style:BP({},e.style,{content:'"'+t+'"'})})}return e}function g5t(e){return(0,LW.default)({},e,{style:(0,c5t.default)(BP({},e.style))})}var PW={};Object.defineProperty(PW,"__esModule",{value:!0});PW.default=m5t;function m5t(e,t){for(var n=1540483477,r=24,i=t^e.length,s=e.length,o=0;s>=4;){var a=y5t(e,o);a=gd(a,n),a^=a>>>r,a=gd(a,n),i=gd(i,n),i^=a,o+=4,s-=4}switch(s){case 3:i^=FQ(e,o),i^=e.charCodeAt(o+2)<<16,i=gd(i,n);break;case 2:i^=FQ(e,o),i=gd(i,n);break;case 1:i^=e.charCodeAt(o),i=gd(i,n);break}return i^=i>>>13,i=gd(i,n),i^=i>>>15,i>>>0}function y5t(e,t){return e.charCodeAt(t++)+(e.charCodeAt(t++)<<8)+(e.charCodeAt(t++)<<16)+(e.charCodeAt(t)<<24)}function FQ(e,t){return e.charCodeAt(t++)+(e.charCodeAt(t++)<<8)}function gd(e,t){e=e|0,t=t|0;var n=e&65535,r=e>>>16,i=n*t+((r*t&65535)<<16)|0;return i}Object.defineProperty(ye,"__esModule",{value:!0});ye.compose=ye.merge=ye.$=ye.style=ye.presets=ye.keyframes=ye.fontFace=ye.insertGlobal=ye.insertRule=ye.plugins=ye.styleSheet=void 0;ye.speedy=S5t;ye.simulations=k5t;ye.simulate=E5t;ye.cssLabels=_5t;ye.isLikeRule=WW;ye.idFor=VW;ye.css=Nr;ye.rehydrate=U5t;ye.flush=j5t;ye.select=GW;ye.parent=V5t;ye.media=G5t;ye.pseudo=Ke;ye.active=H5t;ye.any=q5t;ye.checked=X5t;ye.disabled=Y5t;ye.empty=K5t;ye.enabled=Z5t;ye._default=J5t;ye.first=Q5t;ye.firstChild=e6t;ye.firstOfType=t6t;ye.fullscreen=n6t;ye.focus=r6t;ye.hover=i6t;ye.indeterminate=s6t;ye.inRange=o6t;ye.invalid=a6t;ye.lastChild=u6t;ye.lastOfType=l6t;ye.left=c6t;ye.link=f6t;ye.onlyChild=h6t;ye.onlyOfType=d6t;ye.optional=p6t;ye.outOfRange=g6t;ye.readOnly=m6t;ye.readWrite=y6t;ye.required=b6t;ye.right=x6t;ye.root=v6t;ye.scope=w6t;ye.target=$6t;ye.valid=C6t;ye.visited=S6t;ye.dir=k6t;ye.lang=E6t;ye.not=_6t;ye.nthChild=A6t;ye.nthLastChild=T6t;ye.nthLastOfType=I6t;ye.nthOfType=D6t;ye.after=N6t;ye.before=F6t;ye.firstLetter=O6t;ye.firstLine=R6t;ye.selection=M6t;ye.backdrop=L6t;ye.placeholder=P6t;ye.cssFor=B6t;ye.attribsFor=z6t;var b5t=IW,x5t=zW(b5t),v5t=DW,BW=Py,w5t=OW,Qh=zW(w5t),Zl=By,$5t=PW,C5t=zW($5t);function zW(e){return e&&e.__esModule?e:{default:e}}function mC(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var Qs=ye.styleSheet=new v5t.StyleSheet;Qs.inject();function S5t(e){return Qs.speedy(e)}var yC=ye.plugins=Qs.plugins=new Zl.PluginSet([Zl.prefixes,Zl.contentWrap,Zl.fallbacks]);yC.media=new Zl.PluginSet;yC.fontFace=new Zl.PluginSet;yC.keyframes=new Zl.PluginSet([Zl.prefixes,Zl.fallbacks]);var UW=!1,UF=typeof window<"u",jW=UW,OQ=!1,RQ=!1;function k5t(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;jW=!!e}function E5t(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return t=(0,Qh.default)(t),t?jW?t.reduce(function(r,i){return r["data-simulate-"+vA(i)]="",r},{}):(OQ||(console.warn("can't simulate without once calling simulations(true)"),OQ=!0),RQ||(console.warn("don't use simulation outside dev"),RQ=!0),{}):{}}var bC=UW;function _5t(e){bC=!!e}function vA(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"";return e.toLowerCase().replace(/[^a-z0-9]/g,t)}function xC(e){var t=JSON.stringify(e),n=(0,C5t.default)(t).toString(36);return e.label&&e.label.length>0&&UW?vA(e.label.join("."),"-")+"-"+n:n}function WW(e){var t=Object.keys(e).filter(function(n){return n!=="toString"});return t.length!==1?!1:!!/data\-css\-([a-zA-Z0-9\-_]+)/.exec(t[0])}function VW(e){var t=Object.keys(e).filter(function(i){return i!=="toString"});if(t.length!==1)throw new Error("not a rule");var n=/data\-css\-([a-zA-Z0-9\-_]+)/,r=n.exec(t[0]);if(!r)throw new Error("not a rule");return r[1]}var A5t=/[(),]|"(?:\\.|[^"\n])*"|'(?:\\.|[^'\n])*'|\/\*[\s\S]*?\*\//g;function zP(e){if(e.indexOf(",")===-1)return[e];for(var t=[],n=[],r=0,i;i=A5t.exec(e);)switch(i[0]){case"(":r++;break;case")":r--;break;case",":if(r)break;t.push(i.index)}for(i=t.length;i--;)n.unshift(e.slice(t[i]+1)),e=e.slice(0,t[i]);return n.unshift(e),n}function MQ(e,t){if(!e)return t.replace(/\&/g,"");if(!t)return".css-"+e+",[data-css-"+e+"]";var n=zP(t).map(function(r){return r.indexOf("&")>=0?[r.replace(/\&/mg,".css-"+e),r.replace(/\&/mg,"[data-css-"+e+"]")].join(","):".css-"+e+r+",[data-css-"+e+"]"+r}).join(",");return jW&&/^\&\:/.exec(t)&&!/\s/.exec(t)&&(n+=",.css-"+e+"[data-simulate-"+vA(t)+"],[data-css-"+e+"][data-simulate-"+vA(t)+"]"),n}function UP(e){var t=e.selector,n=e.style,r=yC.transform({selector:t,style:n});return r.selector+"{"+(0,BW.createMarkupForStyles)(r.style)+"}"}function wA(e){var t=void 0,n=void 0,r=void 0,i=void 0;return Object.keys(e).forEach(function(s){s.indexOf("&")>=0?(n=n||{},n[s]=e[s]):s.indexOf("@media")===0?(r=r||{},r[s]=wA(e[s])):s.indexOf("@supports")===0?(i=i||{},i[s]=wA(e[s])):s==="label"?e.label.length>0&&(t=t||{},t.label=bC?e.label.join("."):""):(t=t||{},t[s]=e[s])}),{plain:t,selects:n,medias:r,supports:i}}function $A(e,t){var n=[],r=t.plain,i=t.selects,s=t.medias,o=t.supports;return r&&n.push(UP({style:r,selector:MQ(e)})),i&&Object.keys(i).forEach(function(a){return n.push(UP({style:i[a],selector:MQ(e,a)}))}),s&&Object.keys(s).forEach(function(a){return n.push(a+"{"+$A(e,s[a]).join("")+"}")}),o&&Object.keys(o).forEach(function(a){return n.push(a+"{"+$A(e,o[a]).join("")+"}")}),n}var Ta=Qs.inserted={};function T5t(e){if(!Ta[e.id]){Ta[e.id]=!0;var t=wA(e.style),n=$A(e.id,t);Ta[e.id]=UF?!0:n,n.forEach(function(r){return Qs.insert(r)})}}var w2=Qs.registered={};function jF(e){w2[e.id]||(w2[e.id]=e)}function I5t(e){if(WW(e)){var t=w2[VW(e)];if(t==null)throw new Error("[glamor] an unexpected rule cache miss occurred. This is probably a sign of multiple glamor instances in your app. See https://github.com/threepointone/glamor/issues/79");return t}return e}var _k={};function D5t(e){if(jF(e),T5t(e),_k[e.id])return _k[e.id];var t=mC({},"data-css-"+e.id,bC&&e.label||"");return Object.defineProperty(t,"toString",{enumerable:!1,value:function(){return"css-"+e.id}}),_k[e.id]=t,t}function N5t(e){for(var t=[":",".","[",">"," "],n=!1,r=e.charAt(0),i=0;i<t.length;i++)if(r===t[i]){n=!0;break}return n||e.indexOf("&")>=0}function LQ(e,t){var n=zP(e).map(function(i){return i.indexOf("&")>=0?i:"&"+i}),r=zP(t).map(function(i){return i.indexOf("&")>=0?i:"&"+i});return r.reduce(function(i,s){return i.concat(n.map(function(o){return s.replace(/\&/g,o)}))},[]).join(",")}function F5t(e,t){return e?"@media "+e.substring(6)+" and "+t.substring(6):t}function O5t(e){return e.indexOf("@media")===0}function R5t(e){return e.indexOf("@supports")===0}function M5t(e,t){return e?"@supports "+e.substring(9)+" and "+t.substring(9):t}function Jve(e){for(var t=[],n=0;n<e.length;n++)Array.isArray(e[n])?t=t.concat(Jve(e[n])):t=t.concat(e[n]);return t}var PQ={"::placeholder":["::-webkit-input-placeholder","::-moz-placeholder","::-ms-input-placeholder"],":fullscreen":[":-webkit-full-screen",":-moz-full-screen",":-ms-fullscreen"]};function Rd(e,t){var n=t.selector,r=n===void 0?"":n,i=t.mq,s=i===void 0?"":i,o=t.supp,a=o===void 0?"":o,u=t.src,l=u===void 0?{}:u;Array.isArray(l)||(l=[l]),l=Jve(l),l.forEach(function(c){if(WW(c)){var f=I5t(c);if(f.type!=="css")throw new Error("cannot merge this rule");c=f.style}c=(0,Qh.default)(c),c&&c.composes&&Rd(e,{selector:r,mq:s,supp:a,src:c.composes}),Object.keys(c||{}).forEach(function(h){if(N5t(h))PQ[h]&&PQ[h].forEach(function(p){return Rd(e,{selector:LQ(r,p),mq:s,supp:a,src:c[h]})}),Rd(e,{selector:LQ(r,h),mq:s,supp:a,src:c[h]});else if(O5t(h))Rd(e,{selector:r,mq:F5t(s,h),supp:a,src:c[h]});else if(R5t(h))Rd(e,{selector:r,mq:s,supp:M5t(a,h),src:c[h]});else if(h!=="composes"){var d=e;a&&(d[a]=d[a]||{},d=d[a]),s&&(d[s]=d[s]||{},d=d[s]),r&&(d[r]=d[r]||{},d=d[r]),h==="label"?bC&&(e.label=e.label.concat(c.label)):d[h]=c[h]}})})}function BQ(e){var t={label:[]};Rd(t,{src:e});var n={id:xC(t),style:t,label:bC?t.label.join("."):"",type:"css"};return D5t(n)}var CA={};Object.defineProperty(CA,"toString",{enumerable:!1,value:function(){return"css-nil"}});var PS=typeof WeakMap<"u"?[CA,new WeakMap,new WeakMap,new WeakMap]:[CA];function L5t(e){return function(t){if(PS[t.length]){for(var n=PS[t.length],r=0;r<t.length-1;)n.has(t[r])||n.set(t[r],new WeakMap),n=n.get(t[r]),r++;if(n.has(t[t.length-1])){var i=n.get(t[r]);if(w2[i.toString().substring(4)])return i}}var s=e(t);if(PS[t.length]){for(var o=0,a=PS[t.length];o<t.length-1;)a=a.get(t[o]),o++;try{a.set(t[o],s)}catch{}}return s}}var P5t=typeof WeakMap<"u"?L5t(BQ):BQ;function Nr(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];if(t[0]&&t[0].length&&t[0].raw)throw new Error("you forgot to include glamor/babel in your babel plugins.");return t=(0,Qh.default)(t),t?P5t(t):CA}Nr.insert=function(e){var t={id:xC(e),css:e,type:"raw"};jF(t),Ta[t.id]||(Qs.insert(t.css),Ta[t.id]=UF?!0:[t.css])};ye.insertRule=Nr.insert;Nr.global=function(e,t){if(t=(0,Qh.default)(t),t)return Nr.insert(UP({selector:e,style:t}))};ye.insertGlobal=Nr.global;function B5t(e){if(!Ta[e.id]){var t=Object.keys(e.keyframes).map(function(r){var i=yC.keyframes.transform({id:e.id,name:r,style:e.keyframes[r]});return i.name+"{"+(0,BW.createMarkupForStyles)(i.style)+"}"}).join(""),n=["-webkit-","-moz-","-o-",""].map(function(r){return"@"+r+"keyframes "+(e.name+"_"+e.id)+"{"+t+"}"});n.forEach(function(r){return Qs.insert(r)}),Ta[e.id]=UF?!0:n}}Nr.keyframes=function(e,t){t||(t=e,e="animation"),t=(0,Qh.default)(t)||{};var n={id:xC({name:e,kfs:t}),type:"keyframes",name:e,keyframes:t};return jF(n),B5t(n),e+"_"+n.id};Nr.fontFace=function(e){e=(0,Qh.default)(e);var t={id:xC(e),type:"font-face",font:e};return jF(t),z5t(t),e.fontFamily};ye.fontFace=Nr.fontFace;ye.keyframes=Nr.keyframes;function z5t(e){if(!Ta[e.id]){var t="@font-face{"+(0,BW.createMarkupForStyles)(e.font)+"}";Qs.insert(t),Ta[e.id]=UF?!0:[t]}}function U5t(e){(0,x5t.default)(Ta,e.reduce(function(t,n){return t[n]=!0,t},{}))}function j5t(){Ta=Qs.inserted={},w2=Qs.registered={},_k={},Qs.flush(),Qs.inject()}ye.presets={mobile:"(min-width: 400px)",Mobile:"@media (min-width: 400px)",phablet:"(min-width: 550px)",Phablet:"@media (min-width: 550px)",tablet:"(min-width: 750px)",Tablet:"@media (min-width: 750px)",desktop:"(min-width: 1000px)",Desktop:"@media (min-width: 1000px)",hd:"(min-width: 1200px)",Hd:"@media (min-width: 1200px)"};var W5t=ye.style=Nr;function GW(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return e?Nr(mC({},e,n)):W5t(n)}ye.$=GW;function V5t(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return Nr(mC({},e+" &",n))}ye.merge=Nr;ye.compose=Nr;function G5t(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return Nr(mC({},"@media "+e,n))}function Ke(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return Nr(mC({},e,n))}function H5t(e){return Ke(":active",e)}function q5t(e){return Ke(":any",e)}function X5t(e){return Ke(":checked",e)}function Y5t(e){return Ke(":disabled",e)}function K5t(e){return Ke(":empty",e)}function Z5t(e){return Ke(":enabled",e)}function J5t(e){return Ke(":default",e)}function Q5t(e){return Ke(":first",e)}function e6t(e){return Ke(":first-child",e)}function t6t(e){return Ke(":first-of-type",e)}function n6t(e){return Ke(":fullscreen",e)}function r6t(e){return Ke(":focus",e)}function i6t(e){return Ke(":hover",e)}function s6t(e){return Ke(":indeterminate",e)}function o6t(e){return Ke(":in-range",e)}function a6t(e){return Ke(":invalid",e)}function u6t(e){return Ke(":last-child",e)}function l6t(e){return Ke(":last-of-type",e)}function c6t(e){return Ke(":left",e)}function f6t(e){return Ke(":link",e)}function h6t(e){return Ke(":only-child",e)}function d6t(e){return Ke(":only-of-type",e)}function p6t(e){return Ke(":optional",e)}function g6t(e){return Ke(":out-of-range",e)}function m6t(e){return Ke(":read-only",e)}function y6t(e){return Ke(":read-write",e)}function b6t(e){return Ke(":required",e)}function x6t(e){return Ke(":right",e)}function v6t(e){return Ke(":root",e)}function w6t(e){return Ke(":scope",e)}function $6t(e){return Ke(":target",e)}function C6t(e){return Ke(":valid",e)}function S6t(e){return Ke(":visited",e)}function k6t(e,t){return Ke(":dir("+e+")",t)}function E6t(e,t){return Ke(":lang("+e+")",t)}function _6t(e,t){var n=e.split(",").map(function(r){return r.trim()}).map(function(r){return":not("+r+")"});return n.length===1?Ke(":not("+e+")",t):GW(n.join(""),t)}function A6t(e,t){return Ke(":nth-child("+e+")",t)}function T6t(e,t){return Ke(":nth-last-child("+e+")",t)}function I6t(e,t){return Ke(":nth-last-of-type("+e+")",t)}function D6t(e,t){return Ke(":nth-of-type("+e+")",t)}function N6t(e){return Ke("::after",e)}function F6t(e){return Ke("::before",e)}function O6t(e){return Ke("::first-letter",e)}function R6t(e){return Ke("::first-line",e)}function M6t(e){return Ke("::selection",e)}function L6t(e){return Ke("::backdrop",e)}function P6t(e){return Nr({"::placeholder":e})}function B6t(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return t=(0,Qh.default)(t),t?t.map(function(r){var i={label:[]};return Rd(i,{src:r}),$A(xC(i),wA(i)).join("")}).join(""):""}function z6t(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];t=(0,Qh.default)(t);var r=t?t.map(function(i){VW(i);var s=Object.keys(i)[0],o=i[s];return s+'="'+(o||"")+'"'}).join(" "):"";return r}var ss={},vC={};Object.defineProperty(vC,"__esModule",{value:!0});function U6t(e){return e.name!=null}vC.isSurfaceInfo=U6t;function j6t(e){return e.drawArea instanceof HTMLElement}vC.isSurface=j6t;var wC={},HW={};function W6t(){}var Ls={},fm=[],zQ=[];function $2(e,t){var n=zQ,r,i,s,o;for(o=arguments.length;o-- >2;)fm.push(arguments[o]);for(t&&t.children!=null&&(fm.length||fm.push(t.children),delete t.children);fm.length;)if((i=fm.pop())&&i.pop!==void 0)for(o=i.length;o--;)fm.push(i[o]);else typeof i=="boolean"&&(i=null),(s=typeof e!="function")&&(i==null?i="":typeof i=="number"?i=String(i):typeof i!="string"&&(s=!1)),s&&r?n[n.length-1]+=i:n===zQ?n=[i]:n.push(i),r=s;var a=new W6t;return a.nodeName=e,a.children=n,a.attributes=t??void 0,a.key=t==null?void 0:t.key,Ls.vnode!==void 0&&Ls.vnode(a),a}function Nf(e,t){for(var n in t)e[n]=t[n];return e}var V6t=typeof Promise=="function"?Promise.resolve().then.bind(Promise.resolve()):setTimeout;function Qve(e,t){return $2(e.nodeName,Nf(Nf({},e.attributes),t),arguments.length>2?[].slice.call(arguments,2):e.children)}var G6t=/acit|ex(?:s|g|n|p|$)|rph|ows|mnc|ntw|ine[ch]|zoo|^ord/i,jP=[];function e2e(e){!e._dirty&&(e._dirty=!0)&&jP.push(e)==1&&(Ls.debounceRendering||V6t)(qW)}function qW(){var e,t=jP;for(jP=[];e=t.pop();)e._dirty&&WF(e)}function H6t(e,t,n){return typeof t=="string"||typeof t=="number"?e.splitText!==void 0:typeof t.nodeName=="string"?!e._componentConstructor&&t2e(e,t.nodeName):n||e._componentConstructor===t.nodeName}function t2e(e,t){return e.normalizedNodeName===t||e.nodeName.toLowerCase()===t.toLowerCase()}function n2e(e){var t=Nf({},e.attributes);t.children=e.children;var n=e.nodeName.defaultProps;if(n!==void 0)for(var r in n)t[r]===void 0&&(t[r]=n[r]);return t}function q6t(e,t){var n=t?document.createElementNS("http://www.w3.org/2000/svg",e):document.createElement(e);return n.normalizedNodeName=e,n}function XW(e){var t=e.parentNode;t&&t.removeChild(e)}function UQ(e,t,n,r,i){if(t==="className"&&(t="class"),t!=="key")if(t==="ref")n&&n(null),r&&r(e);else if(t==="class"&&!i)e.className=r||"";else if(t==="style"){if((!r||typeof r=="string"||typeof n=="string")&&(e.style.cssText=r||""),r&&typeof r=="object"){if(typeof n!="string")for(var s in n)s in r||(e.style[s]="");for(var s in r)e.style[s]=typeof r[s]=="number"&&G6t.test(s)===!1?r[s]+"px":r[s]}}else if(t==="dangerouslySetInnerHTML")r&&(e.innerHTML=r.__html||"");else if(t[0]=="o"&&t[1]=="n"){var o=t!==(t=t.replace(/Capture$/,""));t=t.toLowerCase().substring(2),r?n||e.addEventListener(t,jQ,o):e.removeEventListener(t,jQ,o),(e._listeners||(e._listeners={}))[t]=r}else if(t!=="list"&&t!=="type"&&!i&&t in e)X6t(e,t,r??""),(r==null||r===!1)&&e.removeAttribute(t);else{var a=i&&t!==(t=t.replace(/^xlink:?/,""));r==null||r===!1?a?e.removeAttributeNS("http://www.w3.org/1999/xlink",t.toLowerCase()):e.removeAttribute(t):typeof r!="function"&&(a?e.setAttributeNS("http://www.w3.org/1999/xlink",t.toLowerCase(),r):e.setAttribute(t,r))}}function X6t(e,t,n){try{e[t]=n}catch{}}function jQ(e){return this._listeners[e.type](Ls.event&&Ls.event(e)||e)}var r2e=[],WP=0,tf=!1,SA=!1;function i2e(){for(var e;e=r2e.pop();)Ls.afterMount&&Ls.afterMount(e),e.componentDidMount&&e.componentDidMount()}function s2e(e,t,n,r,i,s){WP++||(tf=i!=null&&i.ownerSVGElement!==void 0,SA=e!=null&&!("__preactattr_"in e));var o=o2e(e,t,n,r,s);return i&&o.parentNode!==i&&i.appendChild(o),--WP||(SA=!1,s||i2e()),o}function o2e(e,t,n,r,i){var s=e,o=tf;if((t==null||typeof t=="boolean")&&(t=""),typeof t=="string"||typeof t=="number")return e&&e.splitText!==void 0&&e.parentNode&&(!e._component||i)?e.nodeValue!=t&&(e.nodeValue=t):(s=document.createTextNode(t),e&&(e.parentNode&&e.parentNode.replaceChild(s,e),Zp(e,!0))),s.__preactattr_=!0,s;var a=t.nodeName;if(typeof a=="function")return Q6t(e,t,n,r);if(tf=a==="svg"?!0:a==="foreignObject"?!1:tf,a=String(a),(!e||!t2e(e,a))&&(s=q6t(a,tf),e)){for(;e.firstChild;)s.appendChild(e.firstChild);e.parentNode&&e.parentNode.replaceChild(s,e),Zp(e,!0)}var u=s.firstChild,l=s.__preactattr_,c=t.children;if(l==null){l=s.__preactattr_={};for(var f=s.attributes,h=f.length;h--;)l[f[h].name]=f[h].value}return!SA&&c&&c.length===1&&typeof c[0]=="string"&&u!=null&&u.splitText!==void 0&&u.nextSibling==null?u.nodeValue!=c[0]&&(u.nodeValue=c[0]):(c&&c.length||u!=null)&&Y6t(s,c,n,r,SA||l.dangerouslySetInnerHTML!=null),K6t(s,t.attributes,l),tf=o,s}function Y6t(e,t,n,r,i){var s=e.childNodes,o=[],a={},u=0,l=0,c=s.length,f=0,h=t?t.length:0,d,p,g,m,y;if(c!==0)for(var b=0;b<c;b++){var v=s[b],x=v.__preactattr_,w=h&&x?v._component?v._component.__key:x.key:null;w!=null?(u++,a[w]=v):(x||(v.splitText!==void 0?!i||v.nodeValue.trim():i))&&(o[f++]=v)}if(h!==0)for(var b=0;b<h;b++){m=t[b],y=null;var w=m.key;if(w!=null)u&&a[w]!==void 0&&(y=a[w],a[w]=void 0,u--);else if(!y&&l<f){for(d=l;d<f;d++)if(o[d]!==void 0&&H6t(p=o[d],m,i)){y=p,o[d]=void 0,d===f-1&&f--,d===l&&l++;break}}y=o2e(y,m,n,r),g=s[b],y&&y!==e&&y!==g&&(g==null?e.appendChild(y):y===g.nextSibling?XW(g):e.insertBefore(y,g))}if(u)for(var b in a)a[b]!==void 0&&Zp(a[b],!1);for(;l<=f;)(y=o[f--])!==void 0&&Zp(y,!1)}function Zp(e,t){var n=e._component;n?VF(n):(e.__preactattr_!=null&&e.__preactattr_.ref&&e.__preactattr_.ref(null),(t===!1||e.__preactattr_==null)&&XW(e),a2e(e))}function a2e(e){for(e=e.lastChild;e;){var t=e.previousSibling;Zp(e,!0),e=t}}function K6t(e,t,n){var r;for(r in n)!(t&&t[r]!=null)&&n[r]!=null&&UQ(e,r,n[r],n[r]=void 0,tf);for(r in t)r!=="children"&&r!=="innerHTML"&&(!(r in n)||t[r]!==(r==="value"||r==="checked"?e[r]:n[r]))&&UQ(e,r,n[r],n[r]=t[r],tf)}var VP={};function Z6t(e){var t=e.constructor.name;(VP[t]||(VP[t]=[])).push(e)}function u2e(e,t,n){var r=VP[e.name],i;if(e.prototype&&e.prototype.render?(i=new e(t,n),C2.call(i,t,n)):(i=new C2(t,n),i.constructor=e,i.render=J6t),r){for(var s=r.length;s--;)if(r[s].constructor===e){i.nextBase=r[s].nextBase,r.splice(s,1);break}}return i}function J6t(e,t,n){return this.constructor(e,n)}function kA(e,t,n,r,i){e._disable||(e._disable=!0,(e.__ref=t.ref)&&delete t.ref,(e.__key=t.key)&&delete t.key,!e.base||i?e.componentWillMount&&e.componentWillMount():e.componentWillReceiveProps&&e.componentWillReceiveProps(t,r),r&&r!==e.context&&(e.prevContext||(e.prevContext=e.context),e.context=r),e.prevProps||(e.prevProps=e.props),e.props=t,e._disable=!1,n!==0&&(n===1||Ls.syncComponentUpdates!==!1||!e.base?WF(e,1,i):e2e(e)),e.__ref&&e.__ref(e))}function WF(e,t,n,r){if(!e._disable){var i=e.props,s=e.state,o=e.context,a=e.prevProps||i,u=e.prevState||s,l=e.prevContext||o,c=e.base,f=e.nextBase,h=c||f,d=e._component,p=!1,g,m,y;if(c&&(e.props=a,e.state=u,e.context=l,t!==2&&e.shouldComponentUpdate&&e.shouldComponentUpdate(i,s,o)===!1?p=!0:e.componentWillUpdate&&e.componentWillUpdate(i,s,o),e.props=i,e.state=s,e.context=o),e.prevProps=e.prevState=e.prevContext=e.nextBase=null,e._dirty=!1,!p){g=e.render(i,s,o),e.getChildContext&&(o=Nf(Nf({},o),e.getChildContext()));var b=g&&g.nodeName,v,x;if(typeof b=="function"){var w=n2e(g);m=d,m&&m.constructor===b&&w.key==m.__key?kA(m,w,1,o,!1):(v=m,e._component=m=u2e(b,w,o),m.nextBase=m.nextBase||f,m._parentComponent=e,kA(m,w,0,o,!1),WF(m,1,n,!0)),x=m.base}else y=h,v=d,v&&(y=e._component=null),(h||t===1)&&(y&&(y._component=null),x=s2e(y,g,o,n||!c,h&&h.parentNode,!0));if(h&&x!==h&&m!==d){var C=h.parentNode;C&&x!==C&&(C.replaceChild(x,h),v||(h._component=null,Zp(h,!1)))}if(v&&VF(v),e.base=x,x&&!r){for(var $=e,S=e;S=S._parentComponent;)($=S).base=x;x._component=$,x._componentConstructor=$.constructor}}if(!c||n?r2e.unshift(e):p||(e.componentDidUpdate&&e.componentDidUpdate(a,u,l),Ls.afterUpdate&&Ls.afterUpdate(e)),e._renderCallbacks!=null)for(;e._renderCallbacks.length;)e._renderCallbacks.pop().call(e);!WP&&!r&&i2e()}}function Q6t(e,t,n,r){for(var i=e&&e._component,s=i,o=e,a=i&&e._componentConstructor===t.nodeName,u=a,l=n2e(t);i&&!u&&(i=i._parentComponent);)u=i.constructor===t.nodeName;return i&&u&&(!r||i._component)?(kA(i,l,3,n,r),e=i.base):(s&&!a&&(VF(s),e=o=null),i=u2e(t.nodeName,l,n),e&&!i.nextBase&&(i.nextBase=e,o=null),kA(i,l,1,n,r),e=i.base,o&&e!==o&&(o._component=null,Zp(o,!1))),e}function VF(e){Ls.beforeUnmount&&Ls.beforeUnmount(e);var t=e.base;e._disable=!0,e.componentWillUnmount&&e.componentWillUnmount(),e.base=null;var n=e._component;n?VF(n):t&&(t.__preactattr_&&t.__preactattr_.ref&&t.__preactattr_.ref(null),e.nextBase=t,XW(t),Z6t(e),a2e(t)),e.__ref&&e.__ref(null)}function C2(e,t){this._dirty=!0,this.context=t,this.props=e,this.state=this.state||{}}Nf(C2.prototype,{setState:function(t,n){var r=this.state;this.prevState||(this.prevState=Nf({},r)),Nf(r,typeof t=="function"?t(r,this.props):t),n&&(this._renderCallbacks=this._renderCallbacks||[]).push(n),e2e(this)},forceUpdate:function(t){t&&(this._renderCallbacks=this._renderCallbacks||[]).push(t),WF(this,2)},render:function(){}});function l2e(e,t,n){return s2e(n,e,{},!1,t,!1)}var ezt={h:$2,createElement:$2,cloneElement:Qve,Component:C2,render:l2e,rerender:qW,options:Ls};const tzt=Object.freeze(Object.defineProperty({__proto__:null,Component:C2,cloneElement:Qve,createElement:$2,default:ezt,h:$2,options:Ls,render:l2e,rerender:qW},Symbol.toStringTag,{value:"Module"})),YW=Qp(tzt);var KW={};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Object.defineProperty(KW,"__esModule",{value:!0});const BS=YW,TR=ye;class Um extends BS.Component{componentDidMount(){const{name:t,tab:n}=this.props;this.props.registerSurface(t,n,this)}componentDidUpdate(){return!1}render(){const{name:t,visible:n,styles:r}=this.props,i=Object.assign({},Um.defaultStyles,r),{width:s,height:o}=i;let{maxHeight:a,maxWidth:u}=i;a=o===Um.defaultStyles.height?a:o,u=s===Um.defaultStyles.width?u:s;const l=TR.css({display:n?"block":"none",backgroundColor:"white",marginTop:"10px",marginBottom:"10px",boxShadow:"0 0 6px -3px #777",padding:"10px !important",height:o,width:s,maxHeight:a,maxWidth:u,overflow:"auto"}),c=TR.css({backgroundColor:"white",boxSizing:"border-box",borderBottom:"1px solid #357EDD",lineHeight:"2em",marginBottom:"20px",fontWeight:"600",textAlign:"center"}),f=TR.css({boxSizing:"border-box"});return BS.h("div",{className:`${l} tf-surface`,ref:h=>this.container=h,"data-visible":n},BS.h("div",{className:`${c} tf-label`,ref:h=>this.label=h},t),BS.h("div",{className:`${f} tf-draw-area`,ref:h=>this.drawArea=h}))}}Um.defaultStyles={maxWidth:"550px",maxHeight:"580px",height:"auto",width:"auto"};KW.SurfaceComponent=Um;var ZW={};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Object.defineProperty(ZW,"__esModule",{value:!0});const Fx=YW,c2e=ye;class nzt extends Fx.Component{render(){const{tabNames:t,activeTab:n,handleClick:r}=this.props,i=t.length>0?t.map(o=>Fx.h(rzt,{key:o,id:o,handleClick:r,isActive:o===n},o)):null,s=c2e.css({overflowX:"scroll",overflowY:"hidden",whiteSpace:"nowrap",borderBottomStyle:"solid",borderBottomWidth:"1px",borderColor:"#eee",paddingBottom:"1rem",marginTop:"1rem"});return Fx.h("div",{className:`${s} visor-tabs`},i)}}ZW.Tabs=nzt;class rzt extends Fx.Component{render(){const{children:t,isActive:n,handleClick:r,id:i}=this.props,s=c2e.css({borderBottomColor:n?"#357EDD":"#AAAAAA",borderBottomWidth:"1px",borderBottomStyle:"solid",cursor:"pointer",":hover":{color:"#357EDD"},display:"inline-block",marginRight:"1rem",padding:".5rem",fontSize:"1rem",fontWeight:"bold"});return Fx.h("a",{className:`${s} tf-tab`,"data-isactive":n,onClick:()=>r(i)},t)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Object.defineProperty(HW,"__esModule",{value:!0});const ua=YW,Xd=ye,izt=KW,szt=ZW;class JW extends ua.Component{static render(t,n,r){return ua.render(ua.h(JW,Object.assign({},r)),t,n)}constructor(t){super(t),this.surfaces=new Map;const n=t.startOpen==null?!0:t.startOpen;this.state={isOpen:n,isFullscreen:!1,activeTab:null,tabs:new Set},this.keyHandler=this.keyHandler.bind(this)}close(){this.setState({isOpen:!1})}open(){this.setState({isOpen:!0})}toggle(){this.setState({isOpen:!this.state.isOpen})}toggleFullScreen(){this.setState({isFullscreen:!this.state.isFullscreen})}isOpen(){return this.state.isOpen}isFullscreen(){return this.state.isFullscreen}getSurface(t,n){const r=this.surfaceId(t,n);let i;if(this.surfaces.has(r))i=this.surfaces.get(r);else throw Error(`Surface not found with id: ${r}`);return{container:i.container,label:i.label,drawArea:i.drawArea}}bindKeys(){document.addEventListener("keydown",this.keyHandler,!1)}unbindKeys(){document.removeEventListener("keydown",this.keyHandler)}surfaceId(t,n){return t+n}setTabs(t){const n=t.map(s=>s.tab),r=this.state.tabs;let i;for(const s of n)r.has(s)||(r.add(s),i=s);i!=null&&this.setState({tabs:r,activeTab:i})}getTabs(){return this.state.tabs}registerSurface(t,n,r){const i=this.surfaceId(t,n);this.surfaces.set(i,r)}keyHandler(t){t.keyCode===192&&(t.shiftKey?this.toggleFullScreen():this.toggle())}setActiveTab(t){this.setState({activeTab:t})}componentDidMount(){this.bindKeys()}componentWillMount(){this.setTabs(this.props.surfaceList)}componentWillReceiveProps(t){this.setTabs(t.surfaceList)}render(){const{isOpen:t,isFullscreen:n,activeTab:r}=this.state,{surfaceList:i}=this.props,s=Array.from(this.getTabs().values()),u=n?"90vw":"550px",l=Xd.css({width:u,height:"100%",backgroundColor:"#fafafa",boxSizing:"border-box",padding:"10px",position:"fixed",top:"0px",transition:"right 0.5s cubic-bezier(0.645, 0.045, 0.355, 1), width 0.5s cubic-bezier(0.645, 0.045, 0.355, 1)",boxShadow:"0 2px 5px rgba(0, 0, 0, 0.12), 0 2px 5px rgba(0, 0, 0, 0.24)",overflow:"auto",fontFamily:"sans-serif",fontSize:"14px",zIndex:1e3}),c=Xd.css({right:"0"}),f=Xd.css({right:`calc(-${u} - 10px)`}),h=t?c:f,d=Xd.css({});return ua.h("div",{className:`${l} ${h} visor`,"data-isopen":t,"data-isfullscreen":n},ua.h(ozt,{fullScreenHandler:this.toggleFullScreen.bind(this),closeHandler:this.close.bind(this),isFullScreen:n}),ua.h(szt.Tabs,{tabNames:s,activeTab:r,handleClick:this.setActiveTab.bind(this)}),ua.h("div",{className:`${d} visor-surfaces`},i.map(p=>ua.h(izt.SurfaceComponent,{key:p.name+p.tab,name:p.name,tab:p.tab,styles:p.styles,registerSurface:this.registerSurface.bind(this),visible:r===p.tab}))))}}HW.VisorComponent=JW;function ozt(e){const{isFullScreen:t,fullScreenHandler:n,closeHandler:r}=e,i=Xd.css({display:"flex",backgroundColor:"white",border:"1px solid white",padding:"6px",paddingTop:"10px",marginBottom:"10px",borderRadius:"6px",marginTop:"-16px"}),s=Xd.css({fontSize:".875rem",borderRadius:".25rem",paddingLeft:"1rem",paddingRight:"1rem",paddingTop:".5rem",paddingBottom:".5rem",textDecoration:"none",transition:"color .15s ease-in",color:"#111"}),o=Xd.css({marginLeft:"auto"});return ua.h("div",{className:`${i} visor-controls`},ua.h("button",{className:`${s}`,onClick:n},t?"Minimize":"Maximize"),ua.h("button",{className:`${s} ${o}`,onClick:r},"Hide"))}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Object.defineProperty(wC,"__esModule",{value:!0});const azt=HW;let zS;const uzt="Visor",IR="tfjs-visor-container";function lzt(){if(typeof document>"u")throw new Error("No document defined. This library needs a browser/dom to work");if(document.getElementById(IR)&&zS!=null)return zS;let e=document.getElementById(IR);e==null&&(e=document.createElement("div"),e.id=IR,document.body.appendChild(e));let t;function n(s,o){let a=null;return t=azt.VisorComponent.render(s,t,{ref:u=>a=u,surfaceList:Array.from(o.values())}),a}const r=new Map,i=n(e,r);return zS=new f2e(i,e,r,n),zS}wC.visor=lzt;class f2e{constructor(t,n,r,i){this.visorComponent=t,this.el=n,this.surfaceList=r,this.renderVisor=i}surface(t){const{name:n}=t,r=t.tab==null?uzt:t.tab;if(n==null||!(typeof n=="string"||n instanceof String))throw new Error("You must pass a config object with a 'name' property to create or retrieve a surface");const i=Object.assign({},t,{tab:r}),s=`${n}-${r}`;return this.surfaceList.has(s)||this.surfaceList.set(s,i),this.renderVisor(this.el,this.surfaceList),this.visorComponent.getSurface(n,r)}isFullscreen(){return this.visorComponent.isFullscreen()}isOpen(){return this.visorComponent.isOpen()}close(){return this.visorComponent.close()}open(){return this.visorComponent.open()}toggle(){return this.visorComponent.toggle()}toggleFullScreen(){return this.visorComponent.toggleFullScreen()}bindKeys(){return this.visorComponent.bindKeys()}unbindKeys(){return this.visorComponent.unbindKeys()}setActiveTab(t){if(!this.visorComponent.state.tabs.has(t))throw new Error(`Tab '${t}' does not exist`);this.visorComponent.setState({activeTab:t})}}wC.Visor=f2e;/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var czt=Je&&Je.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(i,s){function o(l){try{u(r.next(l))}catch(c){s(c)}}function a(l){try{u(r.throw(l))}catch(c){s(c)}}function u(l){l.done?i(l.value):new n(function(c){c(l.value)}).then(o,a)}u((r=r.apply(e,t||[])).next())})};Object.defineProperty(ss,"__esModule",{value:!0});const WQ=vC,fzt=wC;function hzt(e){if(e instanceof HTMLElement)return e;if(WQ.isSurface(e))return e.drawArea;if(WQ.isSurfaceInfo(e))return fzt.visor().surface({name:e.name,tab:e.tab,styles:e.styles}).drawArea;throw new Error("Not a drawable")}ss.getDrawArea=hzt;function dzt(e,t){const n=Object.getOwnPropertyNames(e),r=Object.getOwnPropertyNames(t);if(n.length!==r.length)return!1;for(let i=0;i<n.length;i++){const s=n[i];if(e[s]!==t[s])return!1}return!0}ss.shallowEquals=dzt;function pzt(){return czt(this,void 0,void 0,function*(){yield new Promise(e=>requestAnimationFrame(e))})}ss.nextFrame=pzt;/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Object.defineProperty(Qo,"__esModule",{value:!0});const VQ=ye,gzt=ss,mzt={prepend:!1};function yzt(e,t,n={}){const r=gzt.getDrawArea(e),i=VQ.css({"& canvas":{display:"block"},marginTop:".5rem",marginBottom:".5rem"}),s=VQ.css({backgroundColor:"white",display:"inline-block",boxSizing:"border-box",borderBottom:"1px solid #357EDD",lineHeight:"2em",padding:"0 10px 0 10px",marginBottom:"20px",fontWeight:"600",textAlign:"left"}),o=Object.assign({},mzt,n);let a=r.querySelector(`div[data-name=${t}]`);if(!a){if(a=document.createElement("div"),a.setAttribute("class",`${i}`),a.dataset.name=t,o.title){const u=document.createElement("div");u.setAttribute("class",`subsurface-title ${s}`),u.innerText=o.title,a.appendChild(u)}o.prepend?r.insertBefore(a,r.firstChild):r.appendChild(a)}return a}Qo.subSurface=yzt;function bzt(e){let n=0,r=e;for(;r&&r.clientWidth===0;)r=r.parentElement,n=50;return r.clientWidth-n}Qo.getDefaultWidth=bzt;function xzt(e){return e.clientHeight===0?200:e.clientHeight}Qo.getDefaultHeight=xzt;/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var vzt=Je&&Je.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(i,s){function o(l){try{u(r.next(l))}catch(c){s(c)}}function a(l){try{u(r.throw(l))}catch(c){s(c)}}function u(l){l.done?i(l.value):new n(function(c){c(l.value)}).then(o,a)}u((r=r.apply(e,t||[])).next())})},wzt=Je&&Je.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(b6,"__esModule",{value:!0});const $zt=wzt(Ly),GQ=Qo,US=ss;function Czt(e,t,n={}){return vzt(this,void 0,void 0,function*(){const r=US.getDrawArea(e),i=t,s=Object.assign({},Szt,n);if(DR.has(r)){const m=DR.get(r);if(US.shallowEquals(s,m.lastOptions)){yield US.nextFrame();const y=m.view,b=y.changeset().remove(()=>!0).insert(i);yield y.change("values",b).runAsync();return}}const{xLabel:o,yLabel:a,xType:u,yType:l}=s;let c=null;o!=null&&(c={title:o});let f=null;a!=null&&(f={title:a});const h={actions:!1,mode:"vega-lite",defaultStyle:!1};let d;s.color!=null?Array.isArray(s.color)?d={field:"index",type:"nominal",scale:{range:s.color}}:d={value:s.color}:d={value:"#4C78A0"};const p={width:s.width||GQ.getDefaultWidth(r),height:s.height||GQ.getDefaultHeight(r),padding:0,autosize:{type:"fit",contains:"padding",resize:!0},config:{axis:{labelFontSize:s.fontSize,titleFontSize:s.fontSize},text:{fontSize:s.fontSize},legend:{labelFontSize:s.fontSize,titleFontSize:s.fontSize}},data:{values:i,name:"values"},mark:{type:"bar",tooltip:!0},encoding:{x:{field:"index",type:u,axis:c},y:{field:"value",type:l,axis:f},color:d}};yield US.nextFrame();const g=yield $zt.default(r,p,h);DR.set(r,{view:g.view,lastOptions:s})})}b6.barchart=Czt;const Szt={xLabel:"",yLabel:"",xType:"ordinal",yType:"quantitative",fontSize:11},DR=new Map;var QW={};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var kzt=Je&&Je.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(i,s){function o(l){try{u(r.next(l))}catch(c){s(c)}}function a(l){try{u(r.throw(l))}catch(c){s(c)}}function u(l){l.done?i(l.value):new n(function(c){c(l.value)}).then(o,a)}u((r=r.apply(e,t||[])).next())})},Ezt=Je&&Je.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(QW,"__esModule",{value:!0});const _zt=Ezt(Ly),HQ=Qo,Azt=ss;function Tzt(e,t,n={}){return kzt(this,void 0,void 0,function*(){const r=Object.assign({},Izt,n),i=Azt.getDrawArea(e),s=[],o=t.values,a=t.tickLabels||[],u=a.length===0;let l=!0;for(let d=0;d<o.length;d++){const p=u?`Class ${d}`:a[d];u&&a.push(p);for(let g=0;g<o[d].length;g++){const m=u?`Class ${g}`:a[g],y=o[d][g];d===g&&!r.shadeDiagonal?s.push({label:p,prediction:m,count:y,noFill:!0}):(s.push({label:p,prediction:m,count:y,scaleCount:y}),y!==0&&(l=!1))}}if(!r.shadeDiagonal&&l)for(const d of s)d.noFill===!0&&(d.noFill=!1,d.scaleCount=d.count);const c={actions:!1,mode:"vega-lite",defaultStyle:!1},f={width:r.width||HQ.getDefaultWidth(i),height:r.height||HQ.getDefaultHeight(i),padding:0,autosize:{type:"fit",contains:"padding",resize:!0},config:{axis:{labelFontSize:r.fontSize,titleFontSize:r.fontSize},text:{fontSize:r.fontSize},legend:{labelFontSize:r.fontSize,titleFontSize:r.fontSize}},data:{values:s},encoding:{x:{field:"prediction",type:"ordinal",title:r.xLabel||"prediction",scale:{domain:a}},y:{field:"label",type:"ordinal",title:r.yLabel||"label",scale:{domain:a}}},layer:[{transform:[{filter:"datum.noFill != true"}],mark:{type:"rect"},encoding:{color:{field:"scaleCount",type:"quantitative",scale:{range:r.colorMap}},tooltip:[{field:"label",type:"nominal"},{field:"prediction",type:"nominal"},{field:"count",type:"quantitative"}]}}]};r.shadeDiagonal===!1&&f.layer.push({transform:[{filter:"datum.noFill == true"}],mark:{type:"rect",fill:"white"},encoding:{tooltip:[{field:"label",type:"nominal"},{field:"prediction",type:"nominal"},{field:"count",type:"quantitative"}]}}),r.showTextOverlay&&f.layer.push({mark:{type:"text",baseline:"middle"},encoding:{text:{field:"count",type:"nominal"}}});const h=typeof r.colorMap=="string"?{scheme:r.colorMap}:r.colorMap;f.layer[0].encoding.color.scale.range=h,yield _zt.default(i,f,c)})}QW.confusionMatrix=Tzt;const Izt={xLabel:null,yLabel:null,xType:"nominal",yType:"nominal",shadeDiagonal:!0,fontSize:12,showTextOverlay:!0,height:400,colorMap:["#f7fbff","#4292c6"]};var eV={},Pc={};Object.defineProperty(Pc,"__esModule",{value:!0});/*
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function h2e(e,t){if(!e)throw new Error(typeof t=="string"?t:t())}Pc.assert=h2e;function Dzt(e,t,n=""){h2e(d2e(e,t),n+` Shapes ${e} and ${t} must match`)}Pc.assertShapesMatch=Dzt;function d2e(e,t){if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}Pc.arraysEqual=d2e;Pc.DECIMAL_PLACES_TO_CHECK=4;/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var p2e=Je&&Je.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(i,s){function o(l){try{u(r.next(l))}catch(c){s(c)}}function a(l){try{u(r.throw(l))}catch(c){s(c)}}function u(l){l.done?i(l.value):new n(function(c){c(l.value)}).then(o,a)}u((r=r.apply(e,t||[])).next())})},Nzt=Je&&Je.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var n in e)Object.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t},Fzt=Je&&Je.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(eV,"__esModule",{value:!0});const Ox=Nzt(bae),Ozt=Fzt(Ly),qQ=Qo,S2=Pc,Rzt=ss;function Mzt(e,t,n={}){return p2e(this,void 0,void 0,function*(){const r=Object.assign({},Pzt,n),i=Rzt.getDrawArea(e);let s=t.values;r.rowMajor&&(s=yield Lzt(t.values));const{xTickLabels:o,yTickLabels:a}=t;o!=null&&XQ(s,o,0),a!=null&&XQ(s,a,1);const u="@tfidx@",l=[];if(s instanceof Ox.Tensor){S2.assert(s.rank===2,"Input to renderHeatmap must be a 2d array or Tensor2d");const g=yield s.data(),[m,y]=s.shape;for(let b=0;b<m;b++){const v=o?`${o[b]}${u}${b}`:b;for(let x=0;x<y;x++){const w=a?`${a[x]}${u}${x}`:x,C=b*y+x,$=g[C];l.push({x:v,y:w,value:$})}}}else{const g=s;for(let m=0;m<g.length;m++){const y=o?`${o[m]}${u}${m}`:m;for(let b=0;b<g[m].length;b++){const v=a?`${a[b]}${u}${b}`:b,x=g[m][b];l.push({x:y,y:v,value:x})}}}const c={actions:!1,mode:"vega-lite",defaultStyle:!1},f={width:r.width||qQ.getDefaultWidth(i),height:r.height||qQ.getDefaultHeight(i),padding:0,autosize:{type:"fit",contains:"padding",resize:!0},config:{axis:{labelFontSize:r.fontSize,titleFontSize:r.fontSize},text:{fontSize:r.fontSize},legend:{labelFontSize:r.fontSize,titleFontSize:r.fontSize},scale:{bandPaddingInner:0,bandPaddingOuter:0}},data:{values:l},mark:{type:"rect",tooltip:!0},encoding:{x:{field:"x",type:r.xType,title:r.xLabel,sort:!1},y:{field:"y",type:r.yType,title:r.yLabel,sort:!1},fill:{field:"value",type:"quantitative"}}},h=`${u}\\d+$`,d=new RegExp(h);o&&(f.encoding.x.axis={labelExpr:`replace(datum.value, regexp(/${h}/), '')`}),a&&(f.encoding.y.axis={labelExpr:`replace(datum.value, regexp(/${h}/), '')`}),(o||a)&&(c.tooltip={sanitize:g=>String(g).replace(d,"")});let p;switch(r.colorMap){case"blues":p=["#f7fbff","#4292c6"];break;case"greyscale":p=["#000000","#ffffff"];break;case"viridis":default:p="viridis";break}if(p!=="viridis"){const g=f.encoding.fill;g.scale={range:p}}if(r.domain){const g=f.encoding.fill;g.scale!=null?g.scale=Object.assign({},g.scale,{domain:r.domain}):g.scale={domain:r.domain}}yield Ozt.default(i,f,c)})}eV.heatmap=Mzt;function Lzt(e){return p2e(this,void 0,void 0,function*(){let t,n;e instanceof Ox.Tensor?(t=e.shape,n=e.transpose()):(t=[e.length,e[0].length],n=Ox.tidy(()=>Ox.tensor2d(e).transpose())),S2.assert(n.rank===2,"Input to renderHeatmap must be a 2d array or Tensor2d");const r=yield n.array();n.dispose();const i=[r.length,r[0].length];return S2.assert(t[0]===i[1]&&t[1]===i[0],`Unexpected transposed shape. Original ${t} : Transposed ${i}`),r})}function XQ(e,t,n){const r=e instanceof Ox.Tensor?e.shape:[e.length,e[0].length];n===0?S2.assert(r[0]===t.length,`Length of xTickLabels (${t.length}) must match number of rows (${r[0]})`):n===1&&S2.assert(r[1]===t.length,`Length of yTickLabels (${t.length}) must match number of columns (${r[1]})`)}const Pzt={xLabel:null,yLabel:null,xType:"ordinal",yType:"ordinal",colorMap:"viridis",fontSize:12,domain:null,rowMajor:!1};var $C={};const g2e=Qp(Out);var xl={};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var GF=Je&&Je.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(i,s){function o(l){try{u(r.next(l))}catch(c){s(c)}}function a(l){try{u(r.throw(l))}catch(c){s(c)}}function u(l){l.done?i(l.value):new n(function(c){c(l.value)}).then(o,a)}u((r=r.apply(e,t||[])).next())})};Object.defineProperty(xl,"__esModule",{value:!0});const Jp=bae,vf=Pc;function Bzt(e){if(!Array.isArray(e))throw new Error("input must be an array");if(e.length===0)return{numVals:0,numNans:0,numZeros:0,max:void 0,min:void 0};const t=e.length;let n=-1/0,r=1/0,i=0,s=0,o=0;for(let u=0;u<t;u++){const l=e[u];l>n&&(n=l),l<r&&(r=l),l===0&&(i+=1),isNaN(l)?s+=1:isFinite(l)||(o+=1)}const a={numVals:t,numZeros:i,numNans:s,max:n,min:r,numInfs:o};return a.max===-1/0&&(a.max=NaN),a.min===1/0&&(a.min=NaN),a}xl.arrayStats=Bzt;function zzt(e){return GF(this,void 0,void 0,function*(){const[t,n,r]=Jp.tidy(()=>{const i=Jp.scalar(0,e.dtype),s=e.min(),o=e.max(),a=e.equal(i).sum();return[s,o,a]});return Promise.all([e.data(),t.data(),n.data(),r.data()]).then(([i,s,o,a])=>{const u=i.length;let l=0,c=0;for(let p=0;p<u;p++){const g=i[p];isNaN(g)?l+=1:isFinite(g)||(c+=1)}let f=s[0],h=o[0];return l===u&&(f=NaN,h=NaN),{numVals:u,numZeros:a[0],numNans:l,min:f,max:h,numInfs:c}})})}xl.tensorStats=zzt;function Uzt(e,t,n,r){return GF(this,void 0,void 0,function*(){vf.assert(e.rank===1,"labels must be a 1D tensor"),vf.assert(t.rank===1,"predictions must be a 1D tensor"),vf.assert(e.size===t.size,"labels and predictions must be the same length"),r!=null&&vf.assert(r.size===t.size,"labels and predictions must be the same length");const i=e.cast("int32"),s=t.cast("int32");n==null&&(n=Jp.tidy(()=>Jp.maximum(i.max(),s.max()).cast("int32").dataSync()[0]+1));let o=Promise.resolve(null);return r!=null&&(o=r.data()),Promise.all([i.data(),s.data(),o]).then(([a,u,l])=>{const c=Array(n).fill(0);for(let f=0;f<n;f++)c[f]=Array(n).fill(0);for(let f=0;f<a.length;f++){const h=a[f],d=u[f];l!=null?c[h][d]+=l[f]:c[h][d]+=1}return c})})}xl.confusionMatrix=Uzt;function jzt(e,t){return GF(this,void 0,void 0,function*(){vf.assertShapesMatch(e.shape,t.shape,"Error computing accuracy.");const n=e.equal(t),r=n.mean(),i=(yield r.data())[0];return Jp.dispose([n,r]),i})}xl.accuracy=jzt;function Wzt(e,t,n){return GF(this,void 0,void 0,function*(){return vf.assert(e.rank===1,"labels must be a 1D tensor"),vf.assert(t.rank===1,"predictions must be a 1D tensor"),vf.assert(e.size===t.size,"labels and predictions must be the same length"),n==null&&(n=Jp.tidy(()=>Jp.maximum(e.max(),t.max()).dataSync()[0]+1)),Promise.all([e.data(),t.data()]).then(([r,i])=>{const s=Array(n).fill(0),o=Array(n).fill(0);for(let u=0;u<r.length;u++){const l=r[u],c=i[u];s[l]+=1,l===c&&(o[l]+=1)}const a=[];for(let u=0;u<s.length;u++)a.push({count:s[u],accuracy:s[u]===0?0:o[u]/s[u]});return a})})}xl.perClassAccuracy=Wzt;var zy={},GP="http://www.w3.org/1999/xhtml";const HP={svg:"http://www.w3.org/2000/svg",xhtml:GP,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function tV(e){var t=e+="",n=t.indexOf(":");return n>=0&&(t=e.slice(0,n))!=="xmlns"&&(e=e.slice(n+1)),HP.hasOwnProperty(t)?{space:HP[t],local:e}:e}function Vzt(e){return function(){var t=this.ownerDocument,n=this.namespaceURI;return n===GP&&t.documentElement.namespaceURI===GP?t.createElement(e):t.createElementNS(n,e)}}function Gzt(e){return function(){return this.ownerDocument.createElementNS(e.space,e.local)}}function HF(e){var t=tV(e);return(t.local?Gzt:Vzt)(t)}function Hzt(){}function nV(e){return e==null?Hzt:function(){return this.querySelector(e)}}function qzt(e){typeof e!="function"&&(e=nV(e));for(var t=this._groups,n=t.length,r=new Array(n),i=0;i<n;++i)for(var s=t[i],o=s.length,a=r[i]=new Array(o),u,l,c=0;c<o;++c)(u=s[c])&&(l=e.call(u,u.__data__,c,s))&&("__data__"in u&&(l.__data__=u.__data__),a[c]=l);return new es(r,this._parents)}function Xzt(){return[]}function m2e(e){return e==null?Xzt:function(){return this.querySelectorAll(e)}}function Yzt(e){typeof e!="function"&&(e=m2e(e));for(var t=this._groups,n=t.length,r=[],i=[],s=0;s<n;++s)for(var o=t[s],a=o.length,u,l=0;l<a;++l)(u=o[l])&&(r.push(e.call(u,u.__data__,l,o)),i.push(u));return new es(r,i)}var y2e=function(e){return function(){return this.matches(e)}};if(typeof document<"u"){var Eb=document.documentElement;if(!Eb.matches){var Kzt=Eb.webkitMatchesSelector||Eb.msMatchesSelector||Eb.mozMatchesSelector||Eb.oMatchesSelector;y2e=function(e){return function(){return Kzt.call(this,e)}}}}const b2e=y2e;function Zzt(e){typeof e!="function"&&(e=b2e(e));for(var t=this._groups,n=t.length,r=new Array(n),i=0;i<n;++i)for(var s=t[i],o=s.length,a=r[i]=[],u,l=0;l<o;++l)(u=s[l])&&e.call(u,u.__data__,l,s)&&a.push(u);return new es(r,this._parents)}function x2e(e){return new Array(e.length)}function Jzt(){return new es(this._enter||this._groups.map(x2e),this._parents)}function EA(e,t){this.ownerDocument=e.ownerDocument,this.namespaceURI=e.namespaceURI,this._next=null,this._parent=e,this.__data__=t}EA.prototype={constructor:EA,appendChild:function(e){return this._parent.insertBefore(e,this._next)},insertBefore:function(e,t){return this._parent.insertBefore(e,t)},querySelector:function(e){return this._parent.querySelector(e)},querySelectorAll:function(e){return this._parent.querySelectorAll(e)}};function Qzt(e){return function(){return e}}var YQ="$";function e8t(e,t,n,r,i,s){for(var o=0,a,u=t.length,l=s.length;o<l;++o)(a=t[o])?(a.__data__=s[o],r[o]=a):n[o]=new EA(e,s[o]);for(;o<u;++o)(a=t[o])&&(i[o]=a)}function t8t(e,t,n,r,i,s,o){var a,u,l={},c=t.length,f=s.length,h=new Array(c),d;for(a=0;a<c;++a)(u=t[a])&&(h[a]=d=YQ+o.call(u,u.__data__,a,t),d in l?i[a]=u:l[d]=u);for(a=0;a<f;++a)d=YQ+o.call(e,s[a],a,s),(u=l[d])?(r[a]=u,u.__data__=s[a],l[d]=null):n[a]=new EA(e,s[a]);for(a=0;a<c;++a)(u=t[a])&&l[h[a]]===u&&(i[a]=u)}function n8t(e,t){if(!e)return d=new Array(this.size()),l=-1,this.each(function(C){d[++l]=C}),d;var n=t?t8t:e8t,r=this._parents,i=this._groups;typeof e!="function"&&(e=Qzt(e));for(var s=i.length,o=new Array(s),a=new Array(s),u=new Array(s),l=0;l<s;++l){var c=r[l],f=i[l],h=f.length,d=e.call(c,c&&c.__data__,l,r),p=d.length,g=a[l]=new Array(p),m=o[l]=new Array(p),y=u[l]=new Array(h);n(c,f,g,m,y,d,t);for(var b=0,v=0,x,w;b<p;++b)if(x=g[b]){for(b>=v&&(v=b+1);!(w=m[v])&&++v<p;);x._next=w||null}}return o=new es(o,r),o._enter=a,o._exit=u,o}function r8t(){return new es(this._exit||this._groups.map(x2e),this._parents)}function i8t(e){for(var t=this._groups,n=e._groups,r=t.length,i=n.length,s=Math.min(r,i),o=new Array(r),a=0;a<s;++a)for(var u=t[a],l=n[a],c=u.length,f=o[a]=new Array(c),h,d=0;d<c;++d)(h=u[d]||l[d])&&(f[d]=h);for(;a<r;++a)o[a]=t[a];return new es(o,this._parents)}function s8t(){for(var e=this._groups,t=-1,n=e.length;++t<n;)for(var r=e[t],i=r.length-1,s=r[i],o;--i>=0;)(o=r[i])&&(s&&s!==o.nextSibling&&s.parentNode.insertBefore(o,s),s=o);return this}function o8t(e){e||(e=a8t);function t(f,h){return f&&h?e(f.__data__,h.__data__):!f-!h}for(var n=this._groups,r=n.length,i=new Array(r),s=0;s<r;++s){for(var o=n[s],a=o.length,u=i[s]=new Array(a),l,c=0;c<a;++c)(l=o[c])&&(u[c]=l);u.sort(t)}return new es(i,this._parents).order()}function a8t(e,t){return e<t?-1:e>t?1:e>=t?0:NaN}function u8t(){var e=arguments[0];return arguments[0]=this,e.apply(null,arguments),this}function l8t(){var e=new Array(this.size()),t=-1;return this.each(function(){e[++t]=this}),e}function c8t(){for(var e=this._groups,t=0,n=e.length;t<n;++t)for(var r=e[t],i=0,s=r.length;i<s;++i){var o=r[i];if(o)return o}return null}function f8t(){var e=0;return this.each(function(){++e}),e}function h8t(){return!this.node()}function d8t(e){for(var t=this._groups,n=0,r=t.length;n<r;++n)for(var i=t[n],s=0,o=i.length,a;s<o;++s)(a=i[s])&&e.call(a,a.__data__,s,i);return this}function p8t(e){return function(){this.removeAttribute(e)}}function g8t(e){return function(){this.removeAttributeNS(e.space,e.local)}}function m8t(e,t){return function(){this.setAttribute(e,t)}}function y8t(e,t){return function(){this.setAttributeNS(e.space,e.local,t)}}function b8t(e,t){return function(){var n=t.apply(this,arguments);n==null?this.removeAttribute(e):this.setAttribute(e,n)}}function x8t(e,t){return function(){var n=t.apply(this,arguments);n==null?this.removeAttributeNS(e.space,e.local):this.setAttributeNS(e.space,e.local,n)}}function v8t(e,t){var n=tV(e);if(arguments.length<2){var r=this.node();return n.local?r.getAttributeNS(n.space,n.local):r.getAttribute(n)}return this.each((t==null?n.local?g8t:p8t:typeof t=="function"?n.local?x8t:b8t:n.local?y8t:m8t)(n,t))}function rV(e){return e.ownerDocument&&e.ownerDocument.defaultView||e.document&&e||e.defaultView}function w8t(e){return function(){this.style.removeProperty(e)}}function $8t(e,t,n){return function(){this.style.setProperty(e,t,n)}}function C8t(e,t,n){return function(){var r=t.apply(this,arguments);r==null?this.style.removeProperty(e):this.style.setProperty(e,r,n)}}function S8t(e,t,n){return arguments.length>1?this.each((t==null?w8t:typeof t=="function"?C8t:$8t)(e,t,n??"")):v2e(this.node(),e)}function v2e(e,t){return e.style.getPropertyValue(t)||rV(e).getComputedStyle(e,null).getPropertyValue(t)}function k8t(e){return function(){delete this[e]}}function E8t(e,t){return function(){this[e]=t}}function _8t(e,t){return function(){var n=t.apply(this,arguments);n==null?delete this[e]:this[e]=n}}function A8t(e,t){return arguments.length>1?this.each((t==null?k8t:typeof t=="function"?_8t:E8t)(e,t)):this.node()[e]}function w2e(e){return e.trim().split(/^|\s+/)}function iV(e){return e.classList||new $2e(e)}function $2e(e){this._node=e,this._names=w2e(e.getAttribute("class")||"")}$2e.prototype={add:function(e){var t=this._names.indexOf(e);t<0&&(this._names.push(e),this._node.setAttribute("class",this._names.join(" ")))},remove:function(e){var t=this._names.indexOf(e);t>=0&&(this._names.splice(t,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(e){return this._names.indexOf(e)>=0}};function C2e(e,t){for(var n=iV(e),r=-1,i=t.length;++r<i;)n.add(t[r])}function S2e(e,t){for(var n=iV(e),r=-1,i=t.length;++r<i;)n.remove(t[r])}function T8t(e){return function(){C2e(this,e)}}function I8t(e){return function(){S2e(this,e)}}function D8t(e,t){return function(){(t.apply(this,arguments)?C2e:S2e)(this,e)}}function N8t(e,t){var n=w2e(e+"");if(arguments.length<2){for(var r=iV(this.node()),i=-1,s=n.length;++i<s;)if(!r.contains(n[i]))return!1;return!0}return this.each((typeof t=="function"?D8t:t?T8t:I8t)(n,t))}function F8t(){this.textContent=""}function O8t(e){return function(){this.textContent=e}}function R8t(e){return function(){var t=e.apply(this,arguments);this.textContent=t??""}}function M8t(e){return arguments.length?this.each(e==null?F8t:(typeof e=="function"?R8t:O8t)(e)):this.node().textContent}function L8t(){this.innerHTML=""}function P8t(e){return function(){this.innerHTML=e}}function B8t(e){return function(){var t=e.apply(this,arguments);this.innerHTML=t??""}}function z8t(e){return arguments.length?this.each(e==null?L8t:(typeof e=="function"?B8t:P8t)(e)):this.node().innerHTML}function U8t(){this.nextSibling&&this.parentNode.appendChild(this)}function j8t(){return this.each(U8t)}function W8t(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function V8t(){return this.each(W8t)}function G8t(e){var t=typeof e=="function"?e:HF(e);return this.select(function(){return this.appendChild(t.apply(this,arguments))})}function H8t(){return null}function q8t(e,t){var n=typeof e=="function"?e:HF(e),r=t==null?H8t:typeof t=="function"?t:nV(t);return this.select(function(){return this.insertBefore(n.apply(this,arguments),r.apply(this,arguments)||null)})}function X8t(){var e=this.parentNode;e&&e.removeChild(this)}function Y8t(){return this.each(X8t)}function K8t(){return this.parentNode.insertBefore(this.cloneNode(!1),this.nextSibling)}function Z8t(){return this.parentNode.insertBefore(this.cloneNode(!0),this.nextSibling)}function J8t(e){return this.select(e?Z8t:K8t)}function Q8t(e){return arguments.length?this.property("__data__",e):this.node().__data__}var k2e={},Jl=null;if(typeof document<"u"){var e7t=document.documentElement;"onmouseenter"in e7t||(k2e={mouseenter:"mouseover",mouseleave:"mouseout"})}function t7t(e,t,n){return e=E2e(e,t,n),function(r){var i=r.relatedTarget;(!i||i!==this&&!(i.compareDocumentPosition(this)&8))&&e.call(this,r)}}function E2e(e,t,n){return function(r){var i=Jl;Jl=r;try{e.call(this,this.__data__,t,n)}finally{Jl=i}}}function n7t(e){return e.trim().split(/^|\s+/).map(function(t){var n="",r=t.indexOf(".");return r>=0&&(n=t.slice(r+1),t=t.slice(0,r)),{type:t,name:n}})}function r7t(e){return function(){var t=this.__on;if(t){for(var n=0,r=-1,i=t.length,s;n<i;++n)s=t[n],(!e.type||s.type===e.type)&&s.name===e.name?this.removeEventListener(s.type,s.listener,s.capture):t[++r]=s;++r?t.length=r:delete this.__on}}}function i7t(e,t,n){var r=k2e.hasOwnProperty(e.type)?t7t:E2e;return function(i,s,o){var a=this.__on,u,l=r(t,s,o);if(a){for(var c=0,f=a.length;c<f;++c)if((u=a[c]).type===e.type&&u.name===e.name){this.removeEventListener(u.type,u.listener,u.capture),this.addEventListener(u.type,u.listener=l,u.capture=n),u.value=t;return}}this.addEventListener(e.type,l,n),u={type:e.type,name:e.name,value:t,listener:l,capture:n},a?a.push(u):this.__on=[u]}}function s7t(e,t,n){var r=n7t(e+""),i,s=r.length,o;if(arguments.length<2){var a=this.node().__on;if(a){for(var u=0,l=a.length,c;u<l;++u)for(i=0,c=a[u];i<s;++i)if((o=r[i]).type===c.type&&o.name===c.name)return c.value}return}for(a=t?i7t:r7t,n==null&&(n=!1),i=0;i<s;++i)this.each(a(r[i],t,n));return this}function o7t(e,t,n,r){var i=Jl;e.sourceEvent=Jl,Jl=e;try{return t.apply(n,r)}finally{Jl=i}}function _2e(e,t,n){var r=rV(e),i=r.CustomEvent;typeof i=="function"?i=new i(t,n):(i=r.document.createEvent("Event"),n?(i.initEvent(t,n.bubbles,n.cancelable),i.detail=n.detail):i.initEvent(t,!1,!1)),e.dispatchEvent(i)}function a7t(e,t){return function(){return _2e(this,e,t)}}function u7t(e,t){return function(){return _2e(this,e,t.apply(this,arguments))}}function l7t(e,t){return this.each((typeof t=="function"?u7t:a7t)(e,t))}var sV=[null];function es(e,t){this._groups=e,this._parents=t}function A2e(){return new es([[document.documentElement]],sV)}es.prototype=A2e.prototype={constructor:es,select:qzt,selectAll:Yzt,filter:Zzt,data:n8t,enter:Jzt,exit:r8t,merge:i8t,order:s8t,sort:o8t,call:u8t,nodes:l8t,node:c8t,size:f8t,empty:h8t,each:d8t,attr:v8t,style:S8t,property:A8t,classed:N8t,text:M8t,html:z8t,raise:j8t,lower:V8t,append:G8t,insert:q8t,remove:Y8t,clone:J8t,datum:Q8t,on:s7t,dispatch:l7t};function T2e(e){return typeof e=="string"?new es([[document.querySelector(e)]],[document.documentElement]):new es([[e]],sV)}function c7t(e){return T2e(HF(e).call(document.documentElement))}var f7t=0;function I2e(){return new qP}function qP(){this._="@"+(++f7t).toString(36)}qP.prototype=I2e.prototype={constructor:qP,get:function(e){for(var t=this._;!(t in e);)if(!(e=e.parentNode))return;return e[t]},set:function(e,t){return e[this._]=t},remove:function(e){return this._ in e&&delete e[this._]},toString:function(){return this._}};function oV(){for(var e=Jl,t;t=e.sourceEvent;)e=t;return e}function qF(e,t){var n=e.ownerSVGElement||e;if(n.createSVGPoint){var r=n.createSVGPoint();return r.x=t.clientX,r.y=t.clientY,r=r.matrixTransform(e.getScreenCTM().inverse()),[r.x,r.y]}var i=e.getBoundingClientRect();return[t.clientX-i.left-e.clientLeft,t.clientY-i.top-e.clientTop]}function h7t(e){var t=oV();return t.changedTouches&&(t=t.changedTouches[0]),qF(e,t)}function d7t(e){return typeof e=="string"?new es([document.querySelectorAll(e)],[document.documentElement]):new es([e??[]],sV)}function p7t(e,t,n){arguments.length<3&&(n=t,t=oV().changedTouches);for(var r=0,i=t?t.length:0,s;r<i;++r)if((s=t[r]).identifier===n)return qF(e,s);return null}function g7t(e,t){t==null&&(t=oV().touches);for(var n=0,r=t?t.length:0,i=new Array(r);n<r;++n)i[n]=qF(e,t[n]);return i}const m7t=Object.freeze(Object.defineProperty({__proto__:null,clientPoint:qF,create:c7t,creator:HF,customEvent:o7t,get event(){return Jl},local:I2e,matcher:b2e,mouse:h7t,namespace:tV,namespaces:HP,select:T2e,selectAll:d7t,selection:A2e,selector:nV,selectorAll:m2e,style:v2e,touch:p7t,touches:g7t,window:rV},Symbol.toStringTag,{value:"Module"})),y7t=Qp(m7t);/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Object.defineProperty(zy,"__esModule",{value:!0});const b7t=g2e,KQ=y7t,NR=ye,x7t=ss;function v7t(e,t,n={}){if(t&&t.headers==null)throw new Error('Data to render must have a "headers" property');if(t&&t.values==null)throw new Error('Data to render must have a "values" property');const r=x7t.getDrawArea(e),i=Object.assign({},w7t,n);let s=KQ.select(r).select("table.tf-table");const o=NR.css({fontSize:i.fontSize||".875rem",width:"100%",maxWidth:"64rem",marginRight:"auto",marginLeft:"auto"});if(s.size()===0&&(s=KQ.select(r).append("table"),s.attr("class",` ${o} tf-table`),s.append("thead").append("tr"),s.append("tbody")),s.size()!==1)throw new Error("Error inserting table");const a=NR.css({fontWeight:"600",borderBottomStyle:"solid",borderBottomWidth:"1px",borderColor:"rgba( 0, 0, 0, .2 )",textAlign:"left",paddingBottom:"1rem",paddingRight:"1rem",backgroundColor:"#fff"}),u=s.select("thead").select("tr").selectAll("th").data(t.headers),l=u.enter().append("th").attr("class",`${a}`);u.merge(l).html(m=>m),u.exit().remove();const c=b7t.format(",.4~f"),f=s.select("tbody").selectAll("tr").data(t.values),h=f.enter().append("tr"),d=NR.css({padding:"0.25rem",borderBottomStyle:"solid",borderBottomWidth:"1px",borderColor:"rgba( 0, 0, 0, .2 )"}),p=f.merge(h).selectAll("td").data(m=>m),g=p.enter().append("td").attr("class",`${d}`);p.merge(g).html(m=>typeof m=="number"?c(m):m),p.exit().remove(),f.exit().remove()}zy.table=v7t;const w7t={fontSize:14};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var $7t=Je&&Je.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(i,s){function o(l){try{u(r.next(l))}catch(c){s(c)}}function a(l){try{u(r.throw(l))}catch(c){s(c)}}function u(l){l.done?i(l.value):new n(function(c){c(l.value)}).then(o,a)}u((r=r.apply(e,t||[])).next())})},C7t=Je&&Je.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty($C,"__esModule",{value:!0});const ZQ=g2e,S7t=C7t(Ly),jS=Qo,k7t=xl,E7t=zy,_7t={maxBins:12,fontSize:11};function A7t(e,t,n={}){return $7t(this,void 0,void 0,function*(){const r=I7t(t),i=Object.assign({},_7t,n),s={actions:!1,mode:"vega-lite",defaultStyle:!1},o=jS.subSurface(e,"histogram");if(n.stats!==!1){const l=jS.subSurface(e,"stats",{prepend:!0});let c;n.stats?c=n.stats:c=k7t.arrayStats(r.map(f=>f.value)),T7t(c,l,{fontSize:i.fontSize})}if(r.length===0)return;const a=[];for(let l=0;l<r.length;l++){const c=r[l].value;c!=null&&isFinite(c)&&a.push(r[l])}const u={width:i.width||jS.getDefaultWidth(o),height:i.height||jS.getDefaultHeight(o),padding:0,autosize:{type:"fit",contains:"padding",resize:!0},data:{values:a},mark:{type:"bar",tooltip:!0},config:{axis:{labelFontSize:i.fontSize,titleFontSize:i.fontSize},text:{fontSize:i.fontSize},legend:{labelFontSize:i.fontSize,titleFontSize:i.fontSize}},encoding:{x:{bin:{maxbins:i.maxBins},field:"value",type:"quantitative"},y:{aggregate:"count",type:"quantitative"},color:{value:i.color||"#001B44"}}};return S7t.default(o,u,s)})}$C.histogram=A7t;function T7t(e,t,n){const r=ZQ.format(",.4~f"),i=ZQ.format(".4~p"),s=[],o=[];if(e.numVals!=null&&(s.push("Num Vals"),o.push(r(e.numVals))),e.min!=null&&(s.push("Min"),o.push(r(e.min))),e.max!=null&&(s.push("Max"),o.push(r(e.max))),e.numZeros!=null){s.push("# Zeros");let a="";e.numVals&&(a=e.numZeros>0?`(${i(e.numZeros/e.numVals)})`:""),o.push(`${r(e.numZeros)} ${a}`)}if(e.numNans!=null){s.push("# NaNs");let a="";e.numVals&&(a=e.numNans>0?`(${i(e.numNans/e.numVals)})`:""),o.push(`${r(e.numNans)} ${a}`)}if(e.numInfs!=null){s.push("# Infinity");let a="";e.numVals&&(a=e.numInfs>0?`(${i(e.numInfs/e.numVals)})`:""),o.push(`${r(e.numInfs)} ${a}`)}E7t.table(t,{headers:s,values:[o]},n)}function I7t(e){if(e.length==null)throw new Error("input data must be an array");if(e.length===0)return[];if(typeof e[0]=="object"){if(e[0].value==null)throw new Error("input data must have a value field");return e}else{const t=Array(e.length);for(let n=0;n<e.length;n++)t[n]={value:e[n]};return t}}var XF={};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var D7t=Je&&Je.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(i,s){function o(l){try{u(r.next(l))}catch(c){s(c)}}function a(l){try{u(r.throw(l))}catch(c){s(c)}}function u(l){l.done?i(l.value):new n(function(c){c(l.value)}).then(o,a)}u((r=r.apply(e,t||[])).next())})},N7t=Je&&Je.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(XF,"__esModule",{value:!0});const F7t=N7t(Ly),JQ=Qo,QQ=Pc,O7t=ss;function R7t(e,t,n={}){return D7t(this,void 0,void 0,function*(){const r=Array.isArray(t.values[0])?t.values:[t.values],i=r[0].length,s=t.series?t.series:r.map((g,m)=>`Series ${m+1}`);QQ.assert(s.length===r.length,"Must have an equal number of series labels as there are data series"),n.seriesColors!=null&&QQ.assert(n.seriesColors.length===r.length,"Must have an equal number of series colors as there are data series");const o=[];for(let g=0;g<i;g++){const m={x:g};s.forEach((y,b)=>{const v=r[b][g].y;m[y]=v,m[`${y}-name`]=y}),o.push(m)}const a=Object.assign({},M7t,n),u=()=>{if(a.zoomToFit)return{zero:!1};if(a.yAxisDomain!=null)return{domain:a.yAxisDomain}},l={x:{field:"x",type:a.xType,title:a.xLabel},tooltip:[{field:"x",type:"quantitative"},...s.map(g=>({field:g,type:"quantitative"}))]},c=s.map(g=>({data:void 0,mark:{type:"line",clip:!0},encoding:{y:{field:g,type:a.yType,title:a.yLabel,scale:u()},color:{field:`${g}-name`,type:"nominal",legend:{values:s,title:null},scale:{range:a.seriesColors}}}})),f={mark:"rule",selection:{hover:{type:"single",on:"mouseover",nearest:!0,clear:"mouseout"}},encoding:{color:{value:"grey",condition:{selection:{not:"hover"},value:"transparent"}}}},h=O7t.getDrawArea(e),d={width:a.width||JQ.getDefaultWidth(h),height:a.height||JQ.getDefaultHeight(h),padding:0,autosize:{type:"fit",contains:"padding",resize:!0},config:{axis:{labelFontSize:a.fontSize,titleFontSize:a.fontSize},text:{fontSize:a.fontSize},legend:{labelFontSize:a.fontSize,titleFontSize:a.fontSize}},data:{values:o},encoding:l,layer:[...c,f]},p={actions:!1,mode:"vega-lite",defaultStyle:!1};return yield F7t.default(h,d,p),Promise.resolve()})}XF.linechart=R7t;const M7t={xLabel:"x",yLabel:"y",xType:"quantitative",yType:"quantitative",zoomToFit:!1,fontSize:11};var aV={};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var L7t=Je&&Je.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(i,s){function o(l){try{u(r.next(l))}catch(c){s(c)}}function a(l){try{u(r.throw(l))}catch(c){s(c)}}function u(l){l.done?i(l.value):new n(function(c){c(l.value)}).then(o,a)}u((r=r.apply(e,t||[])).next())})},P7t=Je&&Je.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(aV,"__esModule",{value:!0});const B7t=P7t(Ly),eee=Qo,z7t=Pc,U7t=ss;function j7t(e,t,n={}){return L7t(this,void 0,void 0,function*(){let r=t.values;const i=t.series==null?[]:t.series;r=Array.isArray(r[0])?r:[r];const s=[];r.forEach((h,d)=>{const p=i[d]!=null?i[d]:`Series ${d+1}`,g=h.map(m=>Object.assign({},m,{series:p}));s.push(...g)}),n.seriesColors!=null&&z7t.assert(n.seriesColors.length===r.length,"Must have an equal number of series colors as there are data series");const o=U7t.getDrawArea(e),a=Object.assign({},W7t,n),u={actions:!1,mode:"vega-lite",defaultStyle:!1},l=()=>{if(a.zoomToFit)return{zero:!1};if(a.xAxisDomain!=null)return{domain:a.xAxisDomain}},c=()=>{if(a.zoomToFit)return{zero:!1};if(a.yAxisDomain!=null)return{domain:a.yAxisDomain}},f={width:a.width||eee.getDefaultWidth(o),height:a.height||eee.getDefaultHeight(o),padding:0,autosize:{type:"fit",contains:"padding",resize:!0},config:{axis:{labelFontSize:a.fontSize,titleFontSize:a.fontSize},text:{fontSize:a.fontSize},legend:{labelFontSize:a.fontSize,titleFontSize:a.fontSize}},data:{values:s},mark:{type:"point",clip:!0,tooltip:{content:"data"}},encoding:{x:{field:"x",type:a.xType,title:a.xLabel,scale:l()},y:{field:"y",type:a.yType,title:a.yLabel,scale:c()},color:{field:"series",type:"nominal",scale:{range:a.seriesColors}},shape:{field:"series",type:"nominal"}}};return yield B7t.default(o,f,u),Promise.resolve()})}aV.scatterplot=j7t;const W7t={xLabel:"x",yLabel:"y",xType:"quantitative",yType:"quantitative",zoomToFit:!1,fontSize:11};var YF={};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var D2e=Je&&Je.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(i,s){function o(l){try{u(r.next(l))}catch(c){s(c)}}function a(l){try{u(r.throw(l))}catch(c){s(c)}}function u(l){l.done?i(l.value):new n(function(c){c(l.value)}).then(o,a)}u((r=r.apply(e,t||[])).next())})};Object.defineProperty(YF,"__esModule",{value:!0});const V7t=XF,XP=ss,N2e=Qo;function F2e(e,t,n,r={}){return D2e(this,void 0,void 0,function*(){const i=XP.getDrawArea(e),s={};for(const l of n)if(/val_/.test(l)){const c=l.replace("val_","");tee(s,c);const f=nee(t,l,n.indexOf(l));s[c].series.push(l),s[c].values.push(f)}else{const c=nee(t,l,n.indexOf(l));tee(s,l),s[l].series.push(l),s[l].values.push(c)}const o=Object.keys(s),a=Object.assign({},{xLabel:"Iteration",yLabel:"Value"},r),u=[];for(const l of o){const c=N2e.subSurface(i,l),f=s[l].series,h=s[l].values;f.every(p=>!!p.match("acc"))&&(a.zoomToFitAccuracy?a.zoomToFit=!0:(a.yAxisDomain=[0,1],delete a.zoomToFit));const d=V7t.linechart(c,{values:h,series:f},a);u.push(d)}yield Promise.all(u)})}YF.history=F2e;function tee(e,t){e[t]==null&&(e[t]={series:[],values:[]})}function nee(e,t,n){if(Array.isArray(e)){const r=Array.isArray(e[0])?e[n]:e,i=[];for(let s=0;s<r.length;s++){const o=r[s];i.push({x:s,y:o[t]})}return i}else return e.history[t].map((r,i)=>({x:i,y:r}))}function G7t(e,t,n={}){const r={},i=n.callbacks||["onEpochEnd","onBatchEnd"],s=XP.getDrawArea(e),o=Object.assign({},n);delete o.callbacks;function a(l){return(c,f)=>D2e(this,void 0,void 0,function*(){/batch/i.test(l)?o.xLabel="Batch":/epoch/i.test(l)&&(o.xLabel="Epoch");const h=[],d=[];for(const g of t)if(f[g]!=null){d.push(g);const m=H7t(r,l,g);m.push({[g]:f[g]}),h.push(m)}const p=N2e.subSurface(s,l,{title:l});F2e(p,h,d,o),yield XP.nextFrame()})}const u={};return i.forEach(l=>{u[l]=a(l)}),u}YF.fitCallbacks=G7t;function H7t(e,t,n){return e[t]==null&&(e[t]={}),e[t][n]==null&&(e[t][n]=[]),e[t][n]}var KF={};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var _A=Je&&Je.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(i,s){function o(l){try{u(r.next(l))}catch(c){s(c)}}function a(l){try{u(r.throw(l))}catch(c){s(c)}}function u(l){l.done?i(l.value):new n(function(c){c(l.value)}).then(o,a)}u((r=r.apply(e,t||[])).next())})};Object.defineProperty(KF,"__esModule",{value:!0});const q7t=$C,O2e=ss,R2e=zy,FR=Qo,X7t=xl;function Y7t(e,t){return _A(this,void 0,void 0,function*(){const n=O2e.getDrawArea(e),r=Z7t(t),i=["Layer Name","Output Shape","# Of Params","Trainable"],s=r.layers.map(o=>[o.name,o.outputShape,o.parameters,o.trainable]);R2e.table(n,{headers:i,values:s})})}KF.modelSummary=Y7t;function K7t(e,t){return _A(this,void 0,void 0,function*(){const n=O2e.getDrawArea(e),r=yield Q7t(t),i=["Weight Name","Shape","Min","Max","# Params","# Zeros","# NaNs","# Infinity"],s=FR.subSurface(n,"layer-weights-info"),o=r.map(c=>[c.name,c.shape,c.stats.min,c.stats.max,c.weight.size,c.stats.numZeros,c.stats.numNans,c.stats.numInfs]);R2e.table(s,{headers:i,values:o});const a=FR.subSurface(n,"select-layer"),u=FR.subSurface(n,"param-distribution"),l=c=>_A(this,void 0,void 0,function*(){const h=yield r.filter(d=>d.name===c)[0].weight.data();q7t.histogram(u,h,{height:150,width:460,stats:!1})});e9t(r.map(c=>c.name),a,l)})}KF.layer=K7t;function Z7t(e){return{layers:e.layers.map(J7t)}}function J7t(e){let t;return Array.isArray(e.outputShape[0])?t=`[${e.outputShape.map(r=>YP(r)).join(", ")}]`:t=YP(e.outputShape),{name:e.name,trainable:e.trainable,parameters:e.countParams(),outputShape:t}}function Q7t(e){return _A(this,void 0,void 0,function*(){const t=e.getWeights(),n=e.weights,r=t.map(X7t.tensorStats),i=yield Promise.all(r),s=t.map(o=>o.shape);return t.map((o,a)=>({name:n[a].name,stats:i[a],shape:YP(s[a]),weight:o}))})}function YP(e){const t=e.slice();return t.length===0?"Scalar":(t[0]===null&&(t[0]="batch"),`[${t.join(",")}]`)}function e9t(e,t,n){const s=`<div><button>Show Values Distribution for:</button>${`
    <select>
      ${e.map(u=>`<option value=${u}>${u}</option>`)}
    </select>
  `}</div>`;t.innerHTML=s;const o=t.querySelector("button"),a=t.querySelector("select");o.addEventListener("click",()=>{n(a.selectedOptions[0].label)})}var uV={};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var t9t=Je&&Je.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(i,s){function o(l){try{u(r.next(l))}catch(c){s(c)}}function a(l){try{u(r.throw(l))}catch(c){s(c)}}function u(l){l.done?i(l.value):new n(function(c){c(l.value)}).then(o,a)}u((r=r.apply(e,t||[])).next())})};Object.defineProperty(uV,"__esModule",{value:!0});const n9t=ss,r9t=zy;function i9t(e,t,n){return t9t(this,void 0,void 0,function*(){const r=n9t.getDrawArea(e),i=["Class","Accuracy","# Samples"],s=[];for(let o=0;o<t.length;o++){const a=n?n[o]:o.toString(),u=t[o];s.push([a,u.accuracy,u.count])}return r9t.table(r,{headers:i,values:s})})}uV.perClassAccuracy=i9t;var lV={};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var s9t=Je&&Je.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(i,s){function o(l){try{u(r.next(l))}catch(c){s(c)}}function a(l){try{u(r.throw(l))}catch(c){s(c)}}function u(l){l.done?i(l.value):new n(function(c){c(l.value)}).then(o,a)}u((r=r.apply(e,t||[])).next())})};Object.defineProperty(lV,"__esModule",{value:!0});const o9t=$C,a9t=ss,u9t=xl;function l9t(e,t){return s9t(this,void 0,void 0,function*(){const n=a9t.getDrawArea(e),r=yield u9t.tensorStats(t),i=yield t.data();o9t.histogram(n,i,{height:150,stats:r})})}lV.valuesDistribution=l9t;var cV={};/** @license See the LICENSE file. */Object.defineProperty(cV,"__esModule",{value:!0});const c9t="1.5.1";cV.version=c9t;(function(e){function t(v){for(var x in v)e.hasOwnProperty(x)||(e[x]=v[x])}Object.defineProperty(e,"__esModule",{value:!0});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const n=b6,r=QW,i=eV,s=$C,o=XF,a=aV,u=zy,l=YF,c=KF,f=uV,h=lV,d=xl,p=cV;e.version_vis=p.version;const g={barchart:n.barchart,table:u.table,histogram:s.histogram,linechart:o.linechart,scatterplot:a.scatterplot,confusionMatrix:r.confusionMatrix,heatmap:i.heatmap};e.render=g;const m={accuracy:d.accuracy,perClassAccuracy:d.perClassAccuracy,confusionMatrix:d.confusionMatrix};e.metrics=m;const y={history:l.history,fitCallbacks:l.fitCallbacks,perClassAccuracy:f.perClassAccuracy,valuesDistribution:h.valuesDistribution,layer:c.layer,modelSummary:c.modelSummary};e.show=y;var b=wC;e.visor=b.visor,t(vC)})(yae);const ree=document.getElementById("epoch"),OR=document.getElementById("mean-loss"),f9t=document.getElementById("test-loss"),iee=document.getElementById("train-button"),see=document.getElementById("model-dropdown"),oee=document.getElementById("graph");class h9t{constructor({numEpochs:t,batchSize:n,learningRate:r}){js(this,"_numEpochs");js(this,"_batch_size");js(this,"_learningRate");js(this,"_modelType");js(this,"_trainFeatures");js(this,"_trainTarget");js(this,"_testFeatures");js(this,"_testTarget");this._numEpochs=t,this._batch_size=n,this._learningRate=r,this._modelType=nu.LinearRegressionModel}init(t){const n=Bl(t.trainFeatures),r=Bl(t.testFeatures);this._trainTarget=Bl(t.trainTarget),this._testTarget=Bl(t.testTarget);let{dataMean:i,dataStd:s}=this.determineMeanAndStddev(n);this._trainFeatures=this.normalizeTensor(n,i,s),this._testFeatures=this.normalizeTensor(r,i,s)}get modelLabel(){switch(this._modelType){case nu.LinearRegressionModel:return"Linear Regression Model";case nu.MultiLayerPerceptronRegressionModel1Hidden:return"MLP Regression Model (1 Hidden Layer)";case nu.MultiLayerPerceptronRegressionModel2Hidden:return"MLP Regression Model (2 Hidden Layer)";case nu.multiLayerPerceptronRegressionModel1HiddenNoSigmoid:return"MLP Regression Model (1 Hidden Layer, No Sigmoid)"}}set modelType(t){this._modelType=t}get trainFeatures(){return this._trainFeatures}get trainTarget(){return this._trainTarget}get testFeatures(){return this._testFeatures}get testTarget(){return this._testTarget}get baseline(){const t=this._trainTarget.mean();return this._testTarget.sub(t).square().mean().dataSync()[0]}async trainModel(){const t=this.getModel(this._modelType);iee.disabled=!0,see.disabled=!0,t.compile({optimizer:Hc.sgd(this._learningRate),loss:"meanSquaredError"});let n=[];await t.fit(this.trainFeatures,this.trainTarget,{batchSize:this._batch_size,epochs:this._numEpochs,callbacks:{onEpochEnd:async(r,i)=>{ree.innerHTML=`Epoch: ${r+1} / ${this._numEpochs}`,OR.innerHTML=`Mean Loss: ${i.loss.toFixed(2)}`,n.push(i),yae.show.history(oee,n,["loss"],{xLabel:"Epoch",yLabel:"Mean Loss"}),r+1===this._numEpochs&&(iee.disabled=!1,see.disabled=!1,OR.innerHTML=`Training Set Final Mean Loss: ${i.loss.toFixed(2)}`)}}}),this.testModel(t)}testModel(t){const n=t.predict(this.testFeatures),s=this.testTarget.sub(n).square().mean();f9t.innerHTML=`Test Set Mean Loss: ${s.dataSync()[0].toFixed(2)}`}cleanResult(){ree.innerHTML="",OR.innerHTML="",oee.innerHTML=""}get linearRegressionModel(){const t=IC();return t.add(Bc({inputShape:[this.numFeatures()],units:1})),t.summary(),t}get multiLayerPerceptronRegressionModel1Hidden(){const t=IC();return t.add(Bc({inputShape:[this.numFeatures()],units:50,activation:"sigmoid",kernelInitializer:"leCunNormal"})),t.add(Bc({units:1})),t.summary(),t}get multiLayerPerceptronRegressionModel2Hidden(){const t=IC();return t.add(Bc({inputShape:[this.numFeatures()],units:50,activation:"sigmoid",kernelInitializer:"leCunNormal"})),t.add(Bc({units:50,activation:"sigmoid",kernelInitializer:"leCunNormal"})),t.add(Bc({units:1})),t.summary(),t}get multiLayerPerceptronRegressionModel1HiddenNoSigmoid(){const t=IC();return t.add(Bc({inputShape:[this.numFeatures()],units:50,kernelInitializer:"leCunNormal"})),t.add(Bc({units:1})),t.summary(),t}getModel(t){switch(t){case nu.LinearRegressionModel:return this.linearRegressionModel;case nu.MultiLayerPerceptronRegressionModel1Hidden:return this.multiLayerPerceptronRegressionModel1Hidden;case nu.MultiLayerPerceptronRegressionModel2Hidden:return this.multiLayerPerceptronRegressionModel2Hidden;case nu.multiLayerPerceptronRegressionModel1HiddenNoSigmoid:return this.multiLayerPerceptronRegressionModel1HiddenNoSigmoid}}numFeatures(){return this._trainFeatures.shape[1]}determineMeanAndStddev(t){const n=t.mean(0),o=t.sub(n).square().mean(0).sqrt();return{dataMean:n,dataStd:o}}normalizeTensor(t,n,r){return t.sub(n).div(r)}}const aee=new H2e,jm=new h9t({numEpochs:200,batchSize:40,learningRate:.01});var lee;(lee=document.getElementById("load-button"))==null||lee.addEventListener("click",async()=>{await aee.loadData(),jm.init(aee.dataset);const e=jm.baseline;document.getElementById("base-loss").innerHTML=`Baseline Loss (Mean Squared Error): ${e.toFixed(2)}`,document.getElementById("model-dropdown").disabled=!1});const uee=document.getElementById("model-dropdown");uee.addEventListener("change",()=>{const e=parseInt(uee.value);jm.modelType=e,document.getElementById("model-label").innerHTML=jm.modelLabel,document.getElementById("train-button").disabled=!1,jm.cleanResult()});var cee;(cee=document.getElementById("train-button"))==null||cee.addEventListener("click",()=>jm.trainModel())});export default d9t();
